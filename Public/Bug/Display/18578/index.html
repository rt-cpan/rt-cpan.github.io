<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #18578 for CGI-Session: Possible SQL injection attack</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #18578 for CGI-Session: Possible SQL injection attack</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/CGI-Session/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/CGI-Session/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/CGI-Session/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/CGI-Session/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/CGI-Session">CGI-Session CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">18578</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/CGI-Session/Active/">CGI-Session</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">MARKSTOS [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
dmuey [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-5872-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-5873-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;06&nbsp;17:54:06&nbsp;2006</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Possible SQL injection attack</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">sub remove {
    my $self = shift;
    my &#40;$sid&#41; = @_;
    croak &#34;remove&#40;&#41;: usage error&#34; unless $sid;

    my $dbh = $self-&gt;{Handle};
    my $sql = sprintf&#40;&#34;DELETE FROM %s WHERE id=&#39;%s&#39;&#34;, $self-&gt;table_name,
$sid&#41;;
    unless &#40; $dbh-&gt;do&#40;$sql&#41; &#41; {
        croak &#34;remove&#40;&#41;: \$dbh-&gt;do failed!&#34;;
    }
    
    return 1;
}

woudl be better done with place holders or $dbh-&gt;quote &#40;and maybe the
return value could be more more meaningful and safe&#41;

sub remove {
    my $self = shift;
    my &#40;$sid&#41; = @_;
    croak &#34;remove&#40;&#41;: usage error&#34; unless $sid;

    my $sql = sprintf&#40;&#34;&#41;;
    my $rc = $self-&gt;{Handle}-&gt;do&#40;
        &#39;DELETE FROM&#39; 
        . $self-&gt;{Handle}-&gt;quote&#40;$self-&gt;table_name&#41;
        . &#39; WHERE id=&#39;  
        . $self-&gt;{Handle}-&gt;quote&#40;$sid&#41;
    &#41;;

    # do&#40;DELETE&#41; usually returns 0 even thouh it worked do or croak&#40;&#41;
could cause problems...
    croak &#34;remove&#40;&#41;: \$dbh-&gt;do failed!&#34; if $rc eq &#39;0E0&#39;;

    # maybe not croak and return ??
    return $rc eq &#39;E0E&#39; ? 0 : 1;
}
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;06&nbsp;17:54:59&nbsp;2006</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Oi! this should preserve indentation, the code looks horrid :&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;06&nbsp;17:55:04&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;07&nbsp;08:34:37&nbsp;2006</span>
    <span class="description">mark [...] summersault.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #18578] Possible SQL injection attack</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 7 Apr 2006 08:34:15 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Guest via RT &lt;bug-CGI-Session [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Stosberg &lt;mark [...] summersault.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, Apr 06, 2006 at 05:54:07PM -0400, Guest via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; woudl be better done with place holders or $dbh-&gt;quote &#40;and maybe the
&gt; return value could be more more meaningful and safe&#41;
&gt; 
&gt; sub remove {
&gt;     my $self = shift;
&gt;     my &#40;$sid&#41; = @_;
&gt;     croak &#34;remove&#40;&#41;: usage error&#34; unless $sid;
&gt; 
&gt;     my $sql = sprintf&#40;&#34;&#41;;
&gt;     my $rc = $self-&gt;{Handle}-&gt;do&#40;
&gt;         &#39;DELETE FROM&#39; 
&gt;         . $self-&gt;{Handle}-&gt;quote&#40;$self-&gt;table_name&#41;
&gt;         . &#39; WHERE id=&#39;  
&gt;         . $self-&gt;{Handle}-&gt;quote&#40;$sid&#41;
&gt;     &#41;;
&gt; 
&gt;     # do&#40;DELETE&#41; usually returns 0 even thouh it worked do or croak&#40;&#41;
&gt; could cause problems...
&gt;     croak &#34;remove&#40;&#41;: \$dbh-&gt;do failed!&#34; if $rc eq &#39;0E0&#39;;
&gt; 
&gt;     # maybe not croak and return ??
&gt;     return $rc eq &#39;E0E&#39; ? 0 : 1;
&gt; }
</div>
Good idea. We&#39;ll work something like this in. 

I think the &#39;id&#39; is the field to be concerned most about, as the table
name is controlled by the module user. 

        Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;07&nbsp;10:16:01&nbsp;2006</span>
    <span class="description">MARKSTOS [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;07&nbsp;10:35:06&nbsp;2006</span>
    <span class="description">MARKSTOS [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;07&nbsp;17:05:08&nbsp;2006</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Good idea. We&#39;ll work something like this in. 
&gt; 
&gt; I think the &#39;id&#39; is the field to be concerned most about, as the table
&gt; name is controlled by the module user. 
</div>
It&#39;d still be best *and* safer to properly quote/placeholderize *all* data.

If you don&#39;t there is always a chance it could be exploited, so why not do it right consistently 
and 100% gaurantee that there is no way to do an SQL injection, even if you tried :&#41;

If not, then its a good idea not to use it at all.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;07&nbsp;17:05:08&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;07&nbsp;17:06:19&nbsp;2006</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Good idea. We&#39;ll work something like this in. 
&gt; 
&gt; I think the &#39;id&#39; is the field to be concerned most about, as the table
&gt; name is controlled by the module user. 
</div>
It&#39;d still be best *and* safer to properly quote/placeholderize *all* data.

If you don&#39;t there is always a chance it could be exploited, so why not do it right consistently 
and 100% gaurantee that there is no way to do an SQL injection, even if the module user does 
something stupid that lets an attacker control the table name.

If not, then its a good idea not to use the module at all and use one that is safe.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;07&nbsp;17:34:42&nbsp;2006</span>
    <span class="description">mark [...] summersault.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #18578] Possible SQL injection attack</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 7 Apr 2006 17:34:18 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Guest via RT &lt;bug-CGI-Session [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Stosberg &lt;mark [...] summersault.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, Apr 07, 2006 at 05:05:09PM -0400, Guest via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt;        Queue: CGI-Session
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=18578">http://rt.cpan.org/Ticket/Display.html?id=18578</a></span> &gt;
&gt; 
&gt; 
<div class="message-stanza open">&gt; &gt; Good idea. We&#39;ll work something like this in. 
&gt; &gt; 
&gt; &gt; I think the &#39;id&#39; is the field to be concerned most about, as the table
&gt; &gt; name is controlled by the module user. 
</div>&gt; 
&gt; It&#39;d still be best *and* safer to properly quote/placeholderize *all* data.
</div>
Not necessarily. I did run the table name through quote&#40;&#41; in this case
because it passed by tests, but I wasn&#39;t sure that it would. This is not
valid in PostgreSQL:

 SELECT * from &#39;table_name&#39;;

That&#39;s a case when having quotes around something doesn&#39;t work. Bind
variables don&#39;t work for every kind of SQL construction, and and
quoting&#40;&#41; can be mis-used.

        Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;08&nbsp;18:37:32&nbsp;2006</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Apr 07 17:34:42 2006, mark@summersault.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Fri, Apr 07, 2006 at 05:05:09PM -0400, Guest via RT wrote:
<div class="message-stanza open">&gt; &gt;
&gt; &gt;        Queue: CGI-Session
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=18578">http://rt.cpan.org/Ticket/Display.html?id=18578</a></span> &gt;
&gt; &gt;
&gt; &gt;
<div class="message-stanza open">&gt; &gt; &gt; Good idea. We&#39;ll work something like this in.
&gt; &gt; &gt;
&gt; &gt; &gt; I think the &#39;id&#39; is the field to be concerned most about, as the
</div></div>&gt; table
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; name is controlled by the module user.
</div>&gt; &gt;
&gt; &gt; It&#39;d still be best *and* safer to properly quote/placeholderize
</div>&gt; *all* data.
&gt; 
&gt; Not necessarily. I did run the table name through quote&#40;&#41; in this case
&gt; because it passed by tests, but I wasn&#39;t sure that it would. This is
&gt; not
&gt; valid in PostgreSQL:
&gt; 
&gt;  SELECT * from &#39;table_name&#39;;
&gt; 
&gt; That&#39;s a case when having quotes around something doesn&#39;t work. Bind
&gt; variables don&#39;t work for every kind of SQL construction, and and
&gt; quoting&#40;&#41; can be mis-used.
</div>

Hmm, bummer. Maybe at least big huge red warning to make sure their
table name is only specified by a rigourously hardcoded/verified\/etc
piece of data due to Postgres&#39;s lameness. Or do it right by default and
let the Postgres driver specify their own &#34;not so safe&#34; remove&#40;&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;09&nbsp;03:42:56&nbsp;2006</span>
    <span class="description">sherzodr [...] handalak.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #18578] Possible SQL injection attack </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 9 Apr 2006 03:42:27 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-CGI-Session [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Sherzod Ruzmetov&#34; &lt;sherzodr [...] handalak.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">When table names are quoted, most of the DBI tests failed on my computer.
Should we switch the code back to its previous state?



<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; -----Original Message-----
&gt; From: Guest via RT [mailto:bug-CGI-Session@rt.cpan.org] 
&gt; Sent: Thursday, April 06, 2006 5:54 PM
&gt; To: undisclosed-recipients:
&gt; Subject: [rt.cpan.org #18578] Possible SQL injection attack 
&gt; 
&gt; 
&gt; 
&gt; Thu Apr 06 17:54:06 2006: Request 18578 was acted upon.
&gt; Transaction: Ticket created by guest
&gt;        Queue: CGI-Session
&gt;      Subject: Possible SQL injection attack
&gt;        Owner: Nobody
&gt;   Requestors: DMUEY@cpan.org
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=18578">http://rt.cpan.org/Ticket/Display.html?id=18578</a></span> &gt;
&gt; 
&gt; 
&gt; sub remove {
&gt;     my $self = shift;
&gt;     my &#40;$sid&#41; = @_;
&gt;     croak &#34;remove&#40;&#41;: usage error&#34; unless $sid;
&gt; 
&gt;     my $dbh = $self-&gt;{Handle};
&gt;     my $sql = sprintf&#40;&#34;DELETE FROM %s WHERE id=&#39;%s&#39;&#34;, 
&gt; $self-&gt;table_name, $sid&#41;;
&gt;     unless &#40; $dbh-&gt;do&#40;$sql&#41; &#41; {
&gt;         croak &#34;remove&#40;&#41;: \$dbh-&gt;do failed!&#34;;
&gt;     }
&gt;     
&gt;     return 1;
&gt; }
&gt; 
&gt; woudl be better done with place holders or $dbh-&gt;quote &#40;and 
&gt; maybe the return value could be more more meaningful and safe&#41;
&gt; 
&gt; sub remove {
&gt;     my $self = shift;
&gt;     my &#40;$sid&#41; = @_;
&gt;     croak &#34;remove&#40;&#41;: usage error&#34; unless $sid;
&gt; 
&gt;     my $sql = sprintf&#40;&#34;&#41;;
&gt;     my $rc = $self-&gt;{Handle}-&gt;do&#40;
&gt;         &#39;DELETE FROM&#39; 
&gt;         . $self-&gt;{Handle}-&gt;quote&#40;$self-&gt;table_name&#41;
&gt;         . &#39; WHERE id=&#39;  
&gt;         . $self-&gt;{Handle}-&gt;quote&#40;$sid&#41;
&gt;     &#41;;
&gt; 
&gt;     # do&#40;DELETE&#41; usually returns 0 even thouh it worked do or 
&gt; croak&#40;&#41; could cause problems...
&gt;     croak &#34;remove&#40;&#41;: \$dbh-&gt;do failed!&#34; if $rc eq &#39;0E0&#39;;
&gt; 
&gt;     # maybe not croak and return ??
&gt;     return $rc eq &#39;E0E&#39; ? 0 : 1;
&gt; }
&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;10&nbsp;09:53:47&nbsp;2006</span>
    <span class="description">mark [...] summersault.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients: ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #18578] Possible SQL injection attack</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 10 Apr 2006 09:53:27 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;sherzodr [...] handalak.com via RT&#34; &lt;bug-CGI-Session [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Stosberg &lt;mark [...] summersault.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun, Apr 09, 2006 at 03:42:57AM -0400, sherzodr@handalak.com via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt;        Queue: CGI-Session
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=18578">http://rt.cpan.org/Ticket/Display.html?id=18578</a></span> &gt;
&gt; 
&gt; When table names are quoted, most of the DBI tests failed on my computer.
&gt; Should we switch the code back to its previous state?
</div>
I&#39;ve made these kind of improvements now, which is to trust the table
name, but use a bind variable  for the value. That should be portable.

However, I&#39;m seeing a lot of test failures, and I don&#39;t have time at the
moment to track down if they are related to this or something else. 
Sherzod, if you could do a svn checkout and take a look, that would be
great. 

Using bind variables is certianly portable.

        Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;10&nbsp;09:55:52&nbsp;2006</span>
    <span class="description">mark [...] summersault.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #18578] Possible SQL injection attack</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 10 Apr 2006 09:55:29 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Guest via RT &lt;bug-CGI-Session [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Stosberg &lt;mark [...] summersault.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat, Apr 08, 2006 at 06:37:33PM -0400, Guest via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
<div class="message-stanza open">&gt; &gt;  SELECT * from &#39;table_name&#39;;
&gt; &gt; 
&gt; &gt; That&#39;s a case when having quotes around something doesn&#39;t work. Bind
&gt; &gt; variables don&#39;t work for every kind of SQL construction, and and
&gt; &gt; quoting&#40;&#41; can be mis-used.
</div>&gt; 
&gt; 
&gt; Hmm, bummer. Maybe at least big huge red warning to make sure their
&gt; table name is only specified by a rigourously hardcoded/verified\/etc
&gt; piece of data due to Postgres&#39;s lameness. Or do it right by default and
&gt; let the Postgres driver specify their own &#34;not so safe&#34; remove&#40;&#41;.
</div>
Could you point me to a reference that shows that PostgreSQL behavior
here is non-standard? As far as I&#39;m aware using single quotes to denote
a string constant is SQL-standard behavior.  I would be interested to
clarify the matter.

You could always put your MySQL server into the SQL-compliant mode and
see what happens!

        Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;10&nbsp;10:26:36&nbsp;2006</span>
    <span class="description">webmaster [...] simplemood.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #18578] Possible SQL injection attack</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 10 Apr 2006 09:25:14 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CGI-Session [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> SimpleMood Webmaster &lt;webmaster [...] simplemood.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On Apr 10, 2006, at 8:55 AM, mark@summersault.com via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=18578">http://rt.cpan.org/Ticket/Display.html?id=18578</a></span> &gt;
&gt;
&gt; On Sat, Apr 08, 2006 at 06:37:33PM -0400, Guest via RT wrote:
<div class="message-stanza open">&gt;&gt;
<div class="message-stanza open">&gt;&gt;&gt;  SELECT * from &#39;table_name&#39;;
&gt;&gt;&gt;
&gt;&gt;&gt; That&#39;s a case when having quotes around something doesn&#39;t work. Bind
&gt;&gt;&gt; variables don&#39;t work for every kind of SQL construction, and and
&gt;&gt;&gt; quoting&#40;&#41; can be mis-used.
</div>&gt;&gt;
&gt;&gt;
&gt;&gt; Hmm, bummer. Maybe at least big huge red warning to make sure their
&gt;&gt; table name is only specified by a rigourously hardcoded/verified\/etc
&gt;&gt; piece of data due to Postgres&#39;s lameness. Or do it right by  
&gt;&gt; default and
&gt;&gt; let the Postgres driver specify their own &#34;not so safe&#34; remove&#40;&#41;.
</div>&gt;
&gt; Could you point me to a reference that shows that PostgreSQL behavior
&gt; here is non-standard? As far as I&#39;m aware using single quotes to  
&gt; denote
</div>
Its possible its standard, I just mentioned the need to advertise  
vehemently that the table name
needs specified by a trusted source since its not quoted. That what I  
meant by &#34;not so safe&#34; :&#41;

Doing that and placeholding or quote&#40;&#41;ing the value would be great!

Especially since an unquoted table name is portable, unless DBI  
specified a quote_table&#40;&#41; method or possibly:

# make the table name safe
my $table = $dbh-&gt;quote&#40;$possible_evil_table_name&#41;;

# remove surrounding quotes to make it portable SQL:
$table =~ s{^[`&#39;&#34;]|[`&#39;&#34;]$}g; # untested, proof of concept regex...

Now if they do specify anything but a valid table name no other query  
will run and it will either do nothing or fail with an error.

At least the firey FYI would be great :&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;10&nbsp;10:33:39&nbsp;2006</span>
    <span class="description">mark [...] summersault.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients: ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #18578] Possible SQL injection attack</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 10 Apr 2006 10:33:06 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> SimpleMood Webmaster via RT &lt;bug-CGI-Session [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Stosberg &lt;mark [...] summersault.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, Apr 10, 2006 at 10:26:37AM -0400, SimpleMood Webmaster via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Its possible its standard, I just mentioned the need to advertise  
&gt; vehemently that the table name
&gt; needs specified by a trusted source since its not quoted. That what I  
&gt; meant by &#34;not so safe&#34; :&#41;
</div>
I think &#39;taint&#39; mode would already address this, if someone choses to
all the table name to be specified from an unsafe source. the session ID
usually comes from the user, so is not safe. The table name is given by
the module user-- the one with access to write custom Perl code anyway,
so is not &#39;tainted&#39;. 

 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Doing that and placeholding or quote&#40;&#41;ing the value would be great!
&gt; 
&gt; Especially since an unquoted table name is portable, unless DBI  
&gt; specified a quote_table&#40;&#41; method or possibly:
&gt; 
&gt; # make the table name safe
&gt; my $table = $dbh-&gt;quote&#40;$possible_evil_table_name&#41;;
&gt; 
&gt; # remove surrounding quotes to make it portable SQL:
&gt; $table =~ s{^[`&#39;&#34;]|[`&#39;&#34;]$}g; # untested, proof of concept regex...
&gt; 
&gt; Now if they do specify anything but a valid table name no other query  
&gt; will run and it will either do nothing or fail with an error.
</div>
That looks like an mis-use of quoting to me that I expect coud cause
other problems, because it may modify the table name is a way that might
break it. Using double quotes around a table name /is/ valid, and may
actually be required if the table name has a space in it.

        Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;10&nbsp;11:50:25&nbsp;2006</span>
    <span class="description">webmaster [...] simplemood.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #18578] Possible SQL injection attack</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 10 Apr 2006 09:51:45 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CGI-Session [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> SimpleMood Webmaster &lt;webmaster [...] simplemood.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On Apr 10, 2006, at 9:33 AM, mark@summersault.com via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=18578">http://rt.cpan.org/Ticket/Display.html?id=18578</a></span> &gt;
&gt;
&gt; On Mon, Apr 10, 2006 at 10:26:37AM -0400, SimpleMood Webmaster via  
&gt; RT wrote:
<div class="message-stanza open">&gt;&gt;
&gt;&gt; Its possible its standard, I just mentioned the need to advertise
&gt;&gt; vehemently that the table name
&gt;&gt; needs specified by a trusted source since its not quoted. That what I
&gt;&gt; meant by &#34;not so safe&#34; :&#41;
</div>&gt;
&gt; I think &#39;taint&#39; mode would already address this, if someone choses to
</div>
True but how many people run taint mode?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; all the table name to be specified from an unsafe source. the  
&gt; session ID
&gt; usually comes from the user, so is not safe. The table name is  
&gt; given by
&gt; the module user-- the one with access to write custom Perl code  
&gt; anyway,
&gt; so is not &#39;tainted&#39;.
&gt;
&gt;
<div class="message-stanza open">&gt;&gt; Doing that and placeholding or quote&#40;&#41;ing the value would be great!
&gt;&gt;
&gt;&gt; Especially since an unquoted table name is portable, unless DBI
&gt;&gt; specified a quote_table&#40;&#41; method or possibly:
&gt;&gt;
</div></div>
[snipped so the unwary don&#39;t use it]

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt;
&gt;&gt; Now if they do specify anything but a valid table name no other query
&gt;&gt; will run and it will either do nothing or fail with an error.
</div>&gt;
&gt; That looks like an mis-use of quoting to me that I expect coud cause
&gt; other problems, because it may modify the table name is a way that  
&gt; might
&gt; break it. Using double quotes around a table name /is/ valid, and may
&gt; actually be required if the table name has a space in it.
</div>
I agree too much trouble lurking, just kind of brain storming of what  
would be nice.., looks best just advertise the need to specify it  
from a trusted source and check it very carefully. &#40;they might set a  
table based on an ENV variable, a cookie, a param, etc and without  
taint mode&#41; Yes its their fault for using param&#40;&#39;table_name&#39;&#41; as the  
value directly and not running taint mode but at least then they  
couldn&#39;t say you didn&#39;t warn them :&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;13&nbsp;21:26:28&nbsp;2006</span>
    <span class="description">MARKSTOS [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
