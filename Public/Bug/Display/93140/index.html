<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #93140 for Cache-Memcached-Fast: Problem Getting &#34;Big&#34; Values</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #93140 for Cache-Memcached-Fast: Problem Getting &#34;Big&#34; Values</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Cache-Memcached-Fast/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Cache-Memcached-Fast/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Cache-Memcached-Fast/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Cache-Memcached-Fast/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Cache-Memcached-Fast">Cache-Memcached-Fast CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">93140</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Cache-Memcached-Fast/Active/">Cache-Memcached-Fast</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
damien.chaumette [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-219640-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-219641-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;18&nbsp;11:59:35&nbsp;2014</span>
    <span class="description">damien.chaumette [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Problem Getting &#34;Big&#34; Values</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 18 Feb 2014 16:59:26 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Cache-Memcached-Fast [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Damien Chaumette &lt;damien.chaumette [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi there,

I have been playing around with a few Memcached client libraries recently
and, ideally, would like to stick with Perl, but with decent performance.
*Memcached::Client* is simple enough to use but performance isn&#39;t close
Python or C# libraries offer.

Thinking it was probably due to its pure Perl nature, I then came across
your library.


During the CPAN installation I ran into the following unit test issue: &#34;*Failed
test &#39;Fetch# at t/big_value.t line 40.&#34;*

With the Memcached server I am running, it&#39;s possible to up the default
value-size limit from the default 1MB to 128MB. Doing so and setting the
&#34;max_size&#34; parameter in your library I am able to *set* very large values
without any problem.
The problem comes when I try to *get* them out, it just doesn&#39;t return
anything.
The key&#39;/value most definitely has been set as I can retrieve it with a get
call from *Memcached::Client*.


I&#39;ve placed a code sample here, rather simple but it might help:
<span class="clickylink"><a target="new" rel="nofollow" href="http://pastebin.com/QtBxqMhB">http://pastebin.com/QtBxqMhB</a></span>

My setup:
   - Windows 2012
   - Strawberry Perl 5.16 64bits
   - Cache::Memcached::Fast v0.21
   - Memcached v1.4.5

I&#39;ve had no problem using my Memcached server build with:
   - python-memcached
   - EnyimMemcached &#40;C#&#41;
   - *Memcache::Client*
but it&#39;s worth nothing that *Cache::Memcached* throws up quite a bit of
unit tests failures and therefore hasn&#39;t been tested.


Let me know if this makes any sense and/or if you need more information.

Thanks,
Damien
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;18&nbsp;13:00:46&nbsp;2014</span>
    <span class="description">KROKI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Feb 18 11:59:35 2014, damien.chaumette@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; During the CPAN installation I ran into the following unit test issue:
&gt; &#34;*Failed
&gt; test &#39;Fetch# at t/big_value.t line 40.&#34;*
</div>
This test has been written before memcached acquired -I option to raise 1MB limit.  The test assumes that values slightly below 1MB will be accepted by the server, but slightly above will be rejected.  My guess you run the tests on memcached -I 128m and value &gt;1MB wasn&#39;t rejected by the server, hence the test failure.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; With the Memcached server I am running, it&#39;s possible to up the
&gt; default
&gt; value-size limit from the default 1MB to 128MB. Doing so and setting
&gt; the
&gt; &#34;max_size&#34; parameter in your library I am able to *set* very large
&gt; values
&gt; without any problem.
&gt; The problem comes when I try to *get* them out, it just doesn&#39;t return
&gt; anything.
</div>
Can&#39;t reproduce.  I ran memcached -I 128m -vv &#40;version 1.4.17&#41;, adjusted your code to use 100000 * 1024 value, everything worked on Linux &#40;I don&#39;t have access to any Windows host so can&#39;t test there&#41;:

$ perl /tmp/a.pl
Setting keys with Fast..
done.

Getting keys with Fast..
data_short=1024
data_long=102400000

Getting keys with Client..
data_short=1024
data_long=102400000

Output from memcached:
...
slab class  64: chunk size 134217728 perslab       1
...
&lt;30 new auto-negotiating client connection
30: Client using the ascii protocol 
&lt;30 set data_short 0 0 1024
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;30 STORED
</div>&lt;30 set data_long 0 0 102400000
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;30 STORED
</div>&lt;30 get data_short
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;30 sending key data_short
&gt;30 END
</div>&lt;30 get data_long
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;30 sending key data_long
&gt;30 END
</div>&lt;31 new auto-negotiating client connection
31: Client using the ascii protocol 
&lt;31 get data_short
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;31 sending key data_short
&gt;31 END
</div>&lt;31 get data_long
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;31 sending key data_long
&gt;31 END
</div>&lt;30 connection closed.
&lt;31 connection closed.


Could you please provide the output of memcached -vv when C::M::F fails?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;18&nbsp;13:00:46&nbsp;2014</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;19&nbsp;04:50:58&nbsp;2014</span>
    <span class="description">damien.chaumette [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #93140] Problem Getting &#34;Big&#34; Values</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 19 Feb 2014 09:50:46 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Cache-Memcached-Fast [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Damien Chaumette &lt;damien.chaumette [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 18 February 2014 18:00, Tomash Brechko via RT &lt;
bug-Cache-Memcached-Fast@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=93140">https://rt.cpan.org/Ticket/Display.html?id=93140</a></span> &gt;
&gt;
&gt; On Tue Feb 18 11:59:35 2014, damien.chaumette@gmail.com wrote:
<div class="message-stanza open">&gt; &gt; During the CPAN installation I ran into the following unit test issue:
&gt; &gt; &#34;*Failed
&gt; &gt; test &#39;Fetch# at t/big_value.t line 40.&#34;*
</div>&gt;
&gt; This test has been written before memcached acquired -I option to raise
&gt; 1MB limit.  The test assumes that values slightly below 1MB will be
&gt; accepted by the server, but slightly above will be rejected.  My guess you
&gt; run the tests on memcached -I 128m and value &gt;1MB wasn&#39;t rejected by the
&gt; server, hence the test failure.
</div>

As per the big_value.t file it seems that line 40 isn&#39;t about setting
something larger than 1MB &#40;as this is on line 43&#41; but about getting the
regular test value &#40;$value = &#39;x&#39; x THRESHOLD&#41;. Which seems rather identical
to the problem I experience.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; With the Memcached server I am running, it&#39;s possible to up the
&gt; &gt; default
&gt; &gt; value-size limit from the default 1MB to 128MB. Doing so and setting
&gt; &gt; the
&gt; &gt; &#34;max_size&#34; parameter in your library I am able to *set* very large
&gt; &gt; values
&gt; &gt; without any problem.
&gt; &gt; The problem comes when I try to *get* them out, it just doesn&#39;t return
&gt; &gt; anything.
</div>&gt;
&gt; Can&#39;t reproduce.  I ran memcached -I 128m -vv &#40;version 1.4.17&#41;, adjusted
&gt; your code to use 100000 * 1024 value, everything worked on Linux &#40;I don&#39;t
&gt; have access to any Windows host so can&#39;t test there&#41;:
&gt;
&gt; $ perl /tmp/a.pl
&gt; Setting keys with Fast..
&gt; done.
&gt;
&gt; Getting keys with Fast..
&gt; data_short=1024
&gt; data_long=102400000
&gt;
&gt; Getting keys with Client..
&gt; data_short=1024
&gt; data_long=102400000
&gt;
&gt; Output from memcached:
&gt; ...
&gt; slab class  64: chunk size 134217728 perslab       1
&gt; ...
&gt; &lt;30 new auto-negotiating client connection
&gt; 30: Client using the ascii protocol
&gt; &lt;30 set data_short 0 0 1024
<div class="message-stanza open">&gt; &gt;30 STORED
</div>&gt; &lt;30 set data_long 0 0 102400000
<div class="message-stanza open">&gt; &gt;30 STORED
</div>&gt; &lt;30 get data_short
<div class="message-stanza open">&gt; &gt;30 sending key data_short
&gt; &gt;30 END
</div>&gt; &lt;30 get data_long
<div class="message-stanza open">&gt; &gt;30 sending key data_long
&gt; &gt;30 END
</div>&gt; &lt;31 new auto-negotiating client connection
&gt; 31: Client using the ascii protocol
&gt; &lt;31 get data_short
<div class="message-stanza open">&gt; &gt;31 sending key data_short
&gt; &gt;31 END
</div>&gt; &lt;31 get data_long
<div class="message-stanza open">&gt; &gt;31 sending key data_long
&gt; &gt;31 END
</div>&gt; &lt;30 connection closed.
&gt; &lt;31 connection closed.
&gt;
&gt;
&gt; Could you please provide the output of memcached -vv when C::M::F fails?
&gt;
&gt;
</div>Sure, please find below the output:

...
slab class  64: chunk size 134217728 perslab       1
...
&lt;604 new auto-negotiating client connection
604: Client using the ascii protocol
&lt;604 set data_short 0 0 1024
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;604 STORED
</div>&lt;604 set data_long 0 0 10240000
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;604 STORED
</div>&lt;604 get data_short
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;604 sending key data_short
&gt;604 END
</div>&lt;604 get data_long
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;604 sending key data_long
&gt;604 END
</div>&lt;612 new auto-negotiating client connection
612: Client using the ascii protocol
&lt;612 get data_short
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;612 sending key data_short
&gt;612 END
</div>&lt;612 get data_long
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;612 sending key data_long
&gt;612 END
</div>&lt;612 connection closed.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;608 END
</div>&lt;608 connection closed.

Nothing seems out of the ordinary, except that the C::M::F get for
&#34;data_long&#34; didn&#39;t actually return anything.

Thanks,
Damien
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;19&nbsp;07:05:41&nbsp;2014</span>
    <span class="description">KROKI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Feb 19 04:50:58 2014, damien.chaumette@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As per the big_value.t file it seems that line 40 isn&#39;t about setting
&gt; something larger than 1MB &#40;as this is on line 43&#41; but about getting the
&gt; regular test value &#40;$value = &#39;x&#39; x THRESHOLD&#41;. Which seems rather identical
&gt; to the problem I experience.
</div>
Yup, you are right, I didn&#39;t check with the code.  My final wild guess is that your server is too busy and memcached doesn&#39;t respond quite fast.  Please set io_timeout parameter to zero to disable I/O timeout &#40;default is 1 second&#41;, i.e.

  my $memd_fast = Cache::Memcached::Fast-&gt;new &#40;{ servers =&gt; [ &#39;localhost:11211&#39; ],
                                                 max_size =&gt; 10000 * 1024,
                                                 io_timeout =&gt; 0,
                                               }&#41;;

If this won&#39;t solve the problem then it would be interesting to know the minimum item size that reveals the problem and also if this size is always the same or varies slightly.  However I don&#39;t have any further ideas.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;19&nbsp;07:11:29&nbsp;2014</span>
    <span class="description">KROKI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Feb 19 07:05:41 2014, KROKI wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; My final wild guess
&gt; is that your server is too busy and memcached doesn&#39;t respond quite
&gt; fast.  Please set io_timeout parameter to zero to disable I/O timeout
</div>
Actually, by default close_on_error is enabled, so if it was a timeout issue the connetion would be closed.  However from your memcached output I don&#39;t see close event for 604 at all, which is puzzling.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;19&nbsp;07:31:05&nbsp;2014</span>
    <span class="description">damien.chaumette [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #93140] Problem Getting &#34;Big&#34; Values</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 19 Feb 2014 12:30:53 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Cache-Memcached-Fast [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Damien Chaumette &lt;damien.chaumette [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 19 February 2014 12:11, Tomash Brechko via RT &lt;
bug-Cache-Memcached-Fast@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=93140">https://rt.cpan.org/Ticket/Display.html?id=93140</a></span> &gt;
&gt;
&gt; On Wed Feb 19 07:05:41 2014, KROKI wrote:
<div class="message-stanza open">&gt; &gt; My final wild guess
&gt; &gt; is that your server is too busy and memcached doesn&#39;t respond quite
&gt; &gt; fast.  Please set io_timeout parameter to zero to disable I/O timeout
</div>&gt;
&gt; Actually, by default close_on_error is enabled, so if it was a timeout
&gt; issue the connetion would be closed.  However from your memcached output I
&gt; don&#39;t see close event for 604 at all, which is puzzling.
&gt;
</div>
The server has beefy specs and is otherwise idling, and the same behaviour
was witnessed when client and server was run on my local machine which
again is beefy and not overloaded at all.

I&#39;ve re-run the same script but with only the data_short set and gets and
the C::M::F get connection does close but later in time:
&lt;604 new auto-negotiating client connection
604: Client using the ascii protocol
&lt;604 set data_short 0 0 1024
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;604 STORED
</div>&lt;604 get data_short
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;604 sending key data_short
&gt;604 END
</div>&lt;612 new auto-negotiating client connection
612: Client using the ascii protocol
&lt;612 get data_short
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;612 sending key data_short
&gt;612 END
</div>&lt;612 connection closed.
&lt;*604 connection closed*.

Running the Memcached server in `-vvv` I can see rows and rows of:
604: going from conn_read to conn_waiting
604: going from conn_waiting to conn_read
604: going from conn_read to conn_waiting
604: going from conn_waiting to conn_read
604: going from conn_read to conn_waiting
604: going from conn_waiting to conn_read
604: going from conn_read to conn_waiting
604: going from conn_waiting to conn_read
604: going from conn_read to conn_waiting

Which probably explains why the data isn&#39;t returned and C::M::F connection
isn&#39;t closed in a timely fashion?

Thanks,
Damien
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;19&nbsp;08:35:18&nbsp;2014</span>
    <span class="description">KROKI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Feb 19 07:31:05 2014, damien.chaumette@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ve re-run the same script but with only the data_short set and gets and
&gt; the C::M::F get connection does close but later in time:
&gt; ...
&gt; &lt;612 connection closed.
&gt; &lt;*604 connection closed*.
</div>
I wonder how later the close of 604 happens, simply being after 612 is OK, any delay makes me think of io_timeout.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 604: going from conn_waiting to conn_read
&gt; 604: going from conn_read to conn_waiting
&gt; 
&gt; Which probably explains why the data isn&#39;t returned and C::M::F connection
&gt; isn&#39;t closed in a timely fashion?
</div>
Those lines mean memcached server is reading &#40;or trying to read&#41; from the client.  If they are output during the STORE then this is expected, if after GET then this is puzzling.

Please do one more try before giving up: set io_timeout to zero, do gets from Memcached::Client before gets from C::M::F, and with C::M::F do get&#40;data_long&#41; before get&#40;data_short&#41;, and finally paste output of memcached -vv here.  Upgrading memcached to the latest versions may also help &#40;yes, I know that only C::M::F triggers the problem, but still ;&#41;&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;19&nbsp;09:14:02&nbsp;2014</span>
    <span class="description">damien.chaumette [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #93140] Problem Getting &#34;Big&#34; Values</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 19 Feb 2014 14:13:52 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Cache-Memcached-Fast [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Damien Chaumette &lt;damien.chaumette [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 19 February 2014 13:35, Tomash Brechko via RT &lt;
bug-Cache-Memcached-Fast@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=93140">https://rt.cpan.org/Ticket/Display.html?id=93140</a></span> &gt;
&gt;
&gt; On Wed Feb 19 07:31:05 2014, damien.chaumette@gmail.com wrote:
<div class="message-stanza open">&gt; &gt; 604: going from conn_waiting to conn_read
&gt; &gt; 604: going from conn_read to conn_waiting
&gt; &gt;
&gt; &gt; Which probably explains why the data isn&#39;t returned and C::M::F
</div>&gt; connection
<div class="message-stanza open">&gt; &gt; isn&#39;t closed in a timely fashion?
</div>&gt;
&gt; Those lines mean memcached server is reading &#40;or trying to read&#41; from the
&gt; client.  If they are output during the STORE then this is expected, if
&gt; after GET then this is puzzling.
&gt;
</div>
They are definitely happening at the GET stage, not at the STORE.
On the data_long C::M::F run it&#39;ll go on for ever, I let it go for a few
minutes and it didn&#39;t stop.
To be fair if it is trying to communicate with the client it&#39;s much too
late at this point as we have exited a long time ago.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Please do one more try before giving up: set io_timeout to zero, do gets
&gt; from Memcached::Client before gets from C::M::F, and with C::M::F do
&gt; get&#40;data_long&#41; before get&#40;data_short&#41;, and finally paste output of
&gt; memcached -vv here.  Upgrading memcached to the latest versions may also
&gt; help &#40;yes, I know that only C::M::F triggers the problem, but still ;&#41;&#41;.
&gt;
</div>
I&#39;ve done as requested &#40;first two gets are C::M::F&#41;, behaviour is the same
as per below:
&lt;608 new auto-negotiating client connection
608: Client using the ascii protocol
&lt;608 set data_short 0 0 1024
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;608 STORED
</div>&lt;608 set data_long 0 0 10240000
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;608 STORED
</div>&lt;616 new auto-negotiating client connection
616: Client using the ascii protocol
&lt;616 get data_long
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;616 sending key data_long
&gt;616 END
</div>&lt;616 get data_short
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;616 sending key data_short
&gt;616 END
</div>&lt;608 get data_long
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;608 sending key data_long
&gt;608 END
</div>&lt;620 new auto-negotiating client connection
620: Client using the ascii protocol
&lt;620 get data_short
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;620 sending key data_short
&gt;620 END
</div>&lt;616 connection closed.
&lt;620 connection closed.

There doesn&#39;t seem to be official Windows builds for Memcached any more,
and it&#39;s difficult to justify spending too much time in trying to build
from source when there doesn&#39;t seem to be a known issue with this revision
and other clients aren&#39;t having the same problem.

I understand if you can&#39;t devote more time to find this Windows specific
problem, but could you perhaps point me to the places in the C code I
should look first should I want to troubleshoot myself?

Thanks,
Damien
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;19&nbsp;09:19:43&nbsp;2014</span>
    <span class="description">damien.chaumette [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #93140] Problem Getting &#34;Big&#34; Values</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 19 Feb 2014 14:19:34 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Cache-Memcached-Fast [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Damien Chaumette &lt;damien.chaumette [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 19 February 2014 14:13, Damien Chaumette &lt;damien.chaumette@gmail.com&gt;wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; I&#39;ve done as requested &#40;first two gets are C::M::F&#41;[..]
&gt;
&gt;
</div>Sorry I meant the first two gets are with M::C and the second batch with
C::M::F, as requested.

Thanks,
Damien
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;19&nbsp;10:32:28&nbsp;2014</span>
    <span class="description">damien.chaumette [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #93140] Problem Getting &#34;Big&#34; Values</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 19 Feb 2014 15:32:16 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Cache-Memcached-Fast [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Damien Chaumette &lt;damien.chaumette [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Apologies for the spam, I&#39;ve tried with a Couchbase Memcached bucket &#40;they
seem to provide up to date Windows Memcached&#41; and get the same behaviour.

Thanks,
Damien


On 19 February 2014 14:19, Damien Chaumette &lt;damien.chaumette@gmail.com&gt;wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt;
&gt;
&gt; On 19 February 2014 14:13, Damien Chaumette &lt;damien.chaumette@gmail.com&gt;wrote:
&gt;
<div class="message-stanza open">&gt;&gt;
&gt;&gt; I&#39;ve done as requested &#40;first two gets are C::M::F&#41;[..]
&gt;&gt;
&gt;&gt;
</div>&gt; Sorry I meant the first two gets are with M::C and the second batch with
&gt; C::M::F, as requested.
&gt;
&gt; Thanks,
&gt; Damien
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;19&nbsp;11:17:14&nbsp;2014</span>
    <span class="description">KROKI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Feb 19 09:14:02 2014, damien.chaumette@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; They are definitely happening at the GET stage, not at the STORE.
&gt; On the data_long C::M::F run it&#39;ll go on for ever, I let it go for a few
&gt; minutes and it didn&#39;t stop.
&gt; To be fair if it is trying to communicate with the client it&#39;s much too
&gt; late at this point as we have exited a long time ago.
</div>
C::M::F client sends get request, reads the reply and sends nothing else after that.  If I got you correctly then memcached server is trying to read something from the client, and I don&#39;t understand why.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ve done as requested &#40;first two gets are C::M::F&#41;, behaviour is the same
&gt; as per below:
</div>
What I see from the trace:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;608 new auto-negotiating client connection
&gt; 608: Client using the ascii protocol
&gt; &lt;608 set data_short 0 0 1024
<div class="message-stanza open">&gt; &gt;608 STORED
</div>&gt; &lt;608 set data_long 0 0 10240000
<div class="message-stanza open">&gt; &gt;608 STORED
</div></div>
C::M::F stored two keys in memcached.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;616 new auto-negotiating client connection
&gt; 616: Client using the ascii protocol
&gt; &lt;616 get data_long
<div class="message-stanza open">&gt; &gt;616 sending key data_long
&gt; &gt;616 END
</div>&gt; &lt;616 get data_short
<div class="message-stanza open">&gt; &gt;616 sending key data_short
&gt; &gt;616 END
</div></div>
Other client got two keys.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;608 get data_long
<div class="message-stanza open">&gt; &gt;608 sending key data_long
&gt; &gt;608 END
</div></div>
C::M::F requested data_long and got some error at this point, closed the connection, and requested data_short via another connection:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;620 new auto-negotiating client connection
&gt; 620: Client using the ascii protocol
&gt; &lt;620 get data_short
<div class="message-stanza open">&gt; &gt;620 sending key data_short
&gt; &gt;620 END
</div>&gt; &lt;616 connection closed.
&gt; &lt;620 connection closed.
</div>

Given that you disabled io_timeout I can only guess what error could happen, but C::M::F definitely got one, otherwise it wouldn&#39;t open another connection.  So the question is why C::M::F thinks it got an error, and whether its perception is valid.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; There doesn&#39;t seem to be official Windows builds for Memcached any more,
&gt; and it&#39;s difficult to justify spending too much time in trying to build
&gt; from source when there doesn&#39;t seem to be a known issue with this revision
&gt; and other clients aren&#39;t having the same problem.
</div>
There&#39;s a tiny possibility that C::M::F specifically triggers some race in memcached server that other clients don&#39;t, and race fixes happen almost every memcached release &#40;without detailed description what they could affect&#41;.  But I got your last reply, the problem is reproduceable with the latest memcached.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I understand if you can&#39;t devote more time to find this Windows specific
&gt; problem, but could you perhaps point me to the places in the C code I
&gt; should look first should I want to troubleshoot myself?
</div>
First of all an easier way would be to use another module like Cache::Memcached::libmemcached &#40;provided that it builds on Windows and works&#41; - should be comparably fast.  Debugging Perl modules in C is a pain even on Linux, and simply looking into the code won&#39;t reveal much I think because the problem somehow relates to your setup &#40;I built memcached 1.4.5 here but couldn&#39;t reproduce&#41;.  Value reading happens in src/client.c:read_value&#40;&#41;.  But if you really want to devote time to it, the first thing I would try is to capture network traffic to see actual packet contents &#40;data_long is big, but protocol commands will always be at packet beginnings&#41;, and to trace system calls &#40;on Linux we have strace utility that shows system calls and their results; don&#39;t know what Windows has&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;20&nbsp;04:26:47&nbsp;2014</span>
    <span class="description">damien.chaumette [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #93140] Problem Getting &#34;Big&#34; Values</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 20 Feb 2014 09:26:37 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Cache-Memcached-Fast [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Damien Chaumette &lt;damien.chaumette [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
<div class="message-stanza open">&gt; &gt; I understand if you can&#39;t devote more time to find this Windows specific
&gt; &gt; problem, but could you perhaps point me to the places in the C code I
&gt; &gt; should look first should I want to troubleshoot myself?
</div>&gt;
&gt; First of all an easier way would be to use another module like
&gt; Cache::Memcached::libmemcached &#40;provided that it builds on Windows and
&gt; works&#41; - should be comparably fast.  Debugging Perl modules in C is a pain
&gt; even on Linux, and simply looking into the code won&#39;t reveal much I think
&gt; because the problem somehow relates to your setup &#40;I built memcached 1.4.5
&gt; here but couldn&#39;t reproduce&#41;.  Value reading happens in
&gt; src/client.c:read_value&#40;&#41;.  But if you really want to devote time to it,
&gt; the first thing I would try is to capture network traffic to see actual
&gt; packet contents &#40;data_long is big, but protocol commands will always be at
&gt; packet beginnings&#41;, and to trace system calls &#40;on Linux we have strace
&gt; utility that shows system calls and their results; don&#39;t know what Windows
&gt; has&#41;.
&gt;
</div>
I&#39;ve just had a look at Cache::Memcached::libmemcached on CPAN although
sadly it doesn&#39;t compile out of the box on my Strawberry Perl..
There also seems to be a few Couchbase Perl module on CPAN as well, with a
bit of luck one of them will be in C and compile on Windows.
I&#39;ll try to get C::M::libmemcached to work first, if not then a fast
Couchbase module, failing that I may do some network sniffing around and/or
look into Windows system calls.

Thanks,
Damien
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
