<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #50620 for Digest-Whirlpool: API Non-Conformance and pseudo-random behavior</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #50620 for Digest-Whirlpool: API Non-Conformance and pseudo-random behavior</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Digest-Whirlpool">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Digest-Whirlpool">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Digest-Whirlpool">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Digest-Whirlpool">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Digest-Whirlpool">Digest-Whirlpool CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">50620</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Digest-Whirlpool">Digest-Whirlpool</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
KENTNL [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-11570-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.0.6    </td>
  </tr>
  <tr id="CF-11571-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




self_changing_state.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/678701/349275/self_changing_state.pl">
Sun Oct 18 14:21:46 2009 (1.6k) by KENTNL [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=50620">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-678701" href="/Public/Bug/Display.html?id=50620#txn-678701">#</a>      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;18&nbsp;14:21:46&nbsp;2009</span>
    <span class="description">KENTNL [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> API Non-Conformance and pseudo-random behavior</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/678701/349272/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/349272">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have experienced multiple disorders with whirlpool, some of which I&#39;ve
had trouble to classify and test for. 

I believe I have 2 that I can however test for, that are likely to share
the same cause. 

1. Calling -&gt;hexdigest does not reset the state to empty.

2. Calling -&gt;hexdigest multiple times without manually resetting the
state causes different values to be emitted without adding new data. 

I have not been able to think of a good way to write a Test::More test
that exhibits the behaviour I&#39;m experiencing, but I have however
produced a way to compare Whirlpools behaviour with MD5 as a standard. 

the behaviours are drastically different. 

<span class="clickylink"><a target="new" rel="nofollow" href="http://gist.github.com/212780">http://gist.github.com/212780</a></span>

This GIST contains 

1. Output from my test script, showing how different the values are, esp
with regard to using MD5 as the standard.
2. The test script.
3. Valgrind output 
4. Selected output from valgrind. 

I note there are a few memory leaks that valgrind discovers in Whirlpool
itself, but how significant this is I don&#39;t know. &#40; Its been too long
since I last coded in C, and really not looking forward to going back &#41;.

NB: Only the example script has been attached to this bug report to
reduce mental load for all.

All the best. 
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> self_changing_state.pl</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/678701/349275/self_changing_state.pl">Download self_changing_state.pl</a><br />
<span class="downloadcontenttype">text/x-perl 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl
use strict;
use warnings;

use Digest::Whirlpool;
use Digest::MD5;
use Data::Dump qw&#40; dump &#41;;

my @digesters;

for &#40; 1..5 &#41;{
  push @digesters, { whirlpool =&gt; Digest::Whirlpool-&gt;new&#40;&#41;, md5 =&gt; Digest::MD5-&gt;new&#40;&#41; };
}

# seeing that its constant accross instances.

for &#40; @digesters &#41; {
  print &#34;Whirlpool: \n&#34;;
  my $hex = $_-&gt;{whirlpool}-&gt;hexdigest&#40;&#41;;
  my $hexd = $_-&gt;{whirlpool}-&gt;hexdigest&#40;&#41;;

  if&#40; $hex ne $hexd &#41;{
    print &#34;left ne right, but no input has been added\n&#34;;
    print &#34;left: $hex\n&#34;;
    print &#34;right: $hexd\n&#34;;
  } else {
    print &#34;left eq right\n&#34;;
  }
  print &#34;MD5: \n&#34;;
  $hex = $_-&gt;{md5}-&gt;hexdigest&#40;&#41;;
  $hexd = $_-&gt;{md5}-&gt;hexdigest&#40;&#41;;

  if&#40; $hex ne $hexd &#41;{
    print &#34;left ne right, but no input has been added\n&#34;;
    print &#34;left: $hex\n&#34;;
    print &#34;right: $hexd\n&#34;;
  } else {
    print &#34;left eq right\n&#34;;
  }
  print &#34;\n&#34;;
}

# seeing that within a single digester, the same empty value results in a pseudorandom sequence generation.

$digesters[0]-&gt;{whirlpool}-&gt;reset&#40;&#41;;
$digesters[0]-&gt;{md5}-&gt;reset&#40;&#41;;

for &#40; 1..10 &#41;{
  print &#34;whirlpool $_ : &#34; . $digesters[0]-&gt;{whirlpool}-&gt;hexdigest . &#34;\n&#34;;
}
for &#40; 1..10 &#41;{
  print &#34;md5 $_ : &#34; . $digesters[0]-&gt;{md5}-&gt;hexdigest . &#34;\n&#34;;
}


# seeing that the digester doesn&#39;t conform to the specification that the rest conform to
# with regard to hexdigest resetting the state.
print &#34;\n&#34;;
$digesters[0]-&gt;{whirlpool}-&gt;reset&#40;&#41;;

for &#40; 1..10 &#41;{
  $digesters[0]-&gt;{whirlpool}-&gt;add&#40;&#39;hello&#39;&#41;;
  print &#34;whirlpool $_ : &#34; . $digesters[0]-&gt;{whirlpool}-&gt;hexdigest . &#34;\n&#34;;
}
for &#40; 1..10 &#41;{
  $digesters[0]-&gt;{md5}-&gt;add&#40;&#39;hello&#39;&#41;;
  print &#34;md5 $_ : &#34; . $digesters[0]-&gt;{md5}-&gt;hexdigest . &#34;\n&#34;;
}

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-678757" href="/Public/Bug/Display.html?id=50620#txn-678757">#</a>      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;18&nbsp;16:39:58&nbsp;2009</span>
    <span class="description">avar [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/678757/349309/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/349309">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 748b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Oct 18 14:21:46 2009, KENTNL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 1. Calling -&gt;hexdigest does not reset the state to empty.
&gt; 
&gt; 2. Calling -&gt;hexdigest multiple times without manually resetting the
&gt; state causes different values to be emitted without adding new data. 
</div>
Thanks for the report. These issues were both due to hexdigest&#40;&#41; not 
resetting the digest when called. I&#39;ve fixed this in 1.0.8 which is 
currently being processed by PAUSE and should be on the CPAN soon.

Here&#39;s the commitdiff: <span class="clickylink"><a target="new" rel="nofollow" href="http://git.nix.is/?p=avar/pm/Digest-">http://git.nix.is/?p=avar/pm/Digest-</a></span>
Whirlpool;a=commitdiff;h=892660fdf470cf40942167cc35c15f21820fa06f

And you can check out the new version from 
git://git.nix.is/avar/pm/Digest-Whirlpool

An altered version of your test script is now shipped with the 
distribution.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-678758" href="/Public/Bug/Display.html?id=50620#txn-678758">#</a>      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;18&nbsp;16:39:58&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-678761" href="/Public/Bug/Display.html?id=50620#txn-678761">#</a>      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;18&nbsp;16:39:59&nbsp;2009</span>
    <span class="description">avar [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.320274</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
