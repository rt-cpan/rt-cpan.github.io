<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #35917 for PPI: charsets.t eats all available VM</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #35917 for PPI: charsets.t eats all available VM</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/PPI/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/PPI/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/PPI/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/PPI/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/adamkennedy/PPI/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/PPI">PPI CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">35917</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/PPI/Active/">PPI</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
claco [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-27032-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-27033-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;15&nbsp;18:58:45&nbsp;2008</span>
    <span class="description">claco [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> charsets.t eats all available VM</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">t/14/charsets.t eats VM memory until an out of memory error is reached.


t/14_charsets......................perl&#40;797&#41; malloc: ***
vm_allocate&#40;size=8421376&#41; failed &#40;error code=3&#41;
perl&#40;797&#41; malloc: *** error: can&#39;t allocate region
perl&#40;797&#41; malloc: *** set a breakpoint in szone_error to debug
Out of memory!
perl&#40;797&#41; malloc: *** vm_allocate&#40;size=8421376&#41; failed &#40;error code=3&#41;
perl&#40;797&#41; malloc: *** error: can&#39;t allocate region
perl&#40;797&#41; malloc: *** set a breakpoint in szone_error to debug
Out of memory!
perl&#40;797&#41; malloc: *** vm_allocate&#40;size=8421376&#41; failed &#40;error code=3&#41;
perl&#40;797&#41; malloc: *** error: can&#39;t allocate region
perl&#40;797&#41; malloc: *** set a breakpoint in szone_error to debug
Out of memory!
Callback called exit.
END failed--call queue aborted.

The machine has 4GB of memory installed.
Here is the output from running chartset.t directly:

mbp:~/.cpan/build/PPI-1.203-s5lYEU claco$ perl -Ilib t/14_charsets.t
1..11
ok 1 - Parsed code without accented chars
ok 2 - Function with umlaut



Here&#39;s my perl -V
--
claco@mbp ~ $ perl -V
Summary of my perl5 &#40;revision 5 version 8 subversion 6&#41; configuration:
  Platform:
    osname=darwin, osvers=8.0, archname=darwin-thread-multi-2level
    uname=&#39;darwin b48.apple.com 8.0 darwin kernel version 8.3.0: mon oct
3 20:04:04 pdt 2005; root:xnu-792.6.22.obj~2release_ppc power macintosh
powerpc &#39;
    config_args=&#39;-ds -e -Dprefix=/usr -Dccflags=-g  -pipe 
-Dldflags=-Dman3ext=3pm -Duseithreads -Duseshrplib&#39;
    hint=recommended, useposix=true, d_sigaction=define
    usethreads=define use5005threads=undef useithreads=define
usemultiplicity=define
    useperlio=define d_sfio=undef uselargefiles=define usesocks=undef
    use64bitint=undef use64bitall=undef uselongdouble=undef
    usemymalloc=n, bincompat5005=undef
  Compiler:
    cc=&#39;cc&#39;, ccflags =&#39;-g -pipe -fno-common -DPERL_DARWIN
-no-cpp-precomp -fno-strict-aliasing -I/usr/local/include&#39;,
    optimize=&#39;-O3&#39;,
    cppflags=&#39;-no-cpp-precomp -g -pipe -fno-common -DPERL_DARWIN
-no-cpp-precomp -fno-strict-aliasing -I/usr/local/include&#39;
    ccversion=&#39;&#39;, gccversion=&#39;4.0.1 &#40;Apple Computer, Inc. build 5363&#41;
&#40;+4864187&#41;&#39;, gccosandvers=&#39;&#39;
    intsize=4, longsize=4, ptrsize=4, doublesize=8, byteorder=1234
    d_longlong=define, longlongsize=8, d_longdbl=define, longdblsize=16
    ivtype=&#39;long&#39;, ivsize=4, nvtype=&#39;double&#39;, nvsize=8, Off_t=&#39;off_t&#39;,
lseeksize=8
    alignbytes=8, prototype=define
  Linker and Libraries:
    ld=&#39;env MACOSX_DEPLOYMENT_TARGET=10.3 cc&#39;, ldflags =&#39;-L/usr/local/lib&#39;
    libpth=/usr/local/lib /usr/lib
    libs=-ldbm -ldl -lm -lc
    perllibs=-ldl -lm -lc
    libc=/usr/lib/libc.dylib, so=dylib, useshrplib=true,
libperl=libperl.dylib
    gnulibc_version=&#39;&#39;
  Dynamic Linking:
    dlsrc=dl_dlopen.xs, dlext=bundle, d_dlsymun=undef, ccdlflags=&#39; &#39;
    cccdlflags=&#39; &#39;, lddlflags=&#39;-bundle -undefined dynamic_lookup
-L/usr/local/lib&#39;


Characteristics of this binary &#40;from libperl&#41;: 
  Compile-time options: MULTIPLICITY USE_ITHREADS USE_LARGE_FILES
PERL_IMPLICIT_CONTEXT
  Locally applied patches:
        23953 - fix for File::Path::rmtree CAN-2004-0452 security issue
        33990 - fix for setuid perl security issues
        fix for regcomp CVE-2007-5116 security vulnerability
        SPRINTF0 - fixes for sprintf formatting issues - CVE-2005-3962
  Built under darwin
  Compiled at Nov 26 2007 09:16:22
  %ENV:
    PERL5LIB=&#34;/sw/lib/perl5:/sw/lib/perl5/darwin&#34;
  @INC:
    /sw/lib/perl5/5.8.6/darwin-thread-multi-2level
    /sw/lib/perl5/5.8.6
    /sw/lib/perl5/darwin-thread-multi-2level
    /sw/lib/perl5
    /sw/lib/perl5/darwin
    /System/Library/Perl/5.8.6/darwin-thread-multi-2level
    /System/Library/Perl/5.8.6
    /Library/Perl/5.8.6/darwin-thread-multi-2level
    /Library/Perl/5.8.6
    /Library/Perl
    /Network/Library/Perl/5.8.6/darwin-thread-multi-2level
    /Network/Library/Perl/5.8.6
    /Network/Library/Perl
    /System/Library/Perl/Extras/5.8.6/darwin-thread-multi-2level
    /System/Library/Perl/Extras/5.8.6
    /Library/Perl/5.8.1
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;15&nbsp;21:47:17&nbsp;2008</span>
    <span class="description">chris [...] chrisdolan.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #35917] charsets.t eats all available VM </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 15 May 2008 20:46:55 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PPI [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Chris Dolan &lt;chris [...] chrisdolan.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Chris,

Reproduced on my Mac.  I&#39;m investigating...

Chris

On May 15, 2008, at 5:58 PM, Christopher H. Laco via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Thu May 15 18:58:45 2008: Request 35917 was acted upon.
&gt; Transaction: Ticket created by CLACO
&gt;        Queue: PPI
&gt;      Subject: charsets.t eats all available VM
&gt;    Broken in: &#40;no value&#41;
&gt;     Severity: &#40;no value&#41;
&gt;        Owner: Nobody
&gt;   Requestors: claco@cpan.org
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=35917">http://rt.cpan.org/Ticket/Display.html?id=35917</a></span> &gt;
&gt;
&gt;
&gt; t/14/charsets.t eats VM memory until an out of memory error is  
&gt; reached.
&gt;
&gt;
&gt; t/14_charsets......................perl&#40;797&#41; malloc: ***
&gt; vm_allocate&#40;size=8421376&#41; failed &#40;error code=3&#41;
&gt; perl&#40;797&#41; malloc: *** error: can&#39;t allocate region
&gt; perl&#40;797&#41; malloc: *** set a breakpoint in szone_error to debug
&gt; Out of memory!
&gt; perl&#40;797&#41; malloc: *** vm_allocate&#40;size=8421376&#41; failed &#40;error code=3&#41;
&gt; perl&#40;797&#41; malloc: *** error: can&#39;t allocate region
&gt; perl&#40;797&#41; malloc: *** set a breakpoint in szone_error to debug
&gt; Out of memory!
&gt; perl&#40;797&#41; malloc: *** vm_allocate&#40;size=8421376&#41; failed &#40;error code=3&#41;
&gt; perl&#40;797&#41; malloc: *** error: can&#39;t allocate region
&gt; perl&#40;797&#41; malloc: *** set a breakpoint in szone_error to debug
&gt; Out of memory!
&gt; Callback called exit.
&gt; END failed--call queue aborted.
&gt;
&gt; The machine has 4GB of memory installed.
&gt; Here is the output from running chartset.t directly:
&gt;
&gt; mbp:~/.cpan/build/PPI-1.203-s5lYEU claco$ perl -Ilib t/14_charsets.t
&gt; 1..11
&gt; ok 1 - Parsed code without accented chars
&gt; ok 2 - Function with umlaut
&gt;
&gt;
&gt;
&gt; Here&#39;s my perl -V
&gt; --
&gt; claco@mbp ~ $ perl -V
&gt; Summary of my perl5 &#40;revision 5 version 8 subversion 6&#41; configuration:
&gt;   Platform:
&gt;     osname=darwin, osvers=8.0, archname=darwin-thread-multi-2level
&gt;     uname=&#39;darwin b48.apple.com 8.0 darwin kernel version 8.3.0:  
&gt; mon oct
&gt; 3 20:04:04 pdt 2005; root:xnu-792.6.22.obj~2release_ppc power  
&gt; macintosh
&gt; powerpc &#39;
&gt;     config_args=&#39;-ds -e -Dprefix=/usr -Dccflags=-g  -pipe
&gt; -Dldflags=-Dman3ext=3pm -Duseithreads -Duseshrplib&#39;
&gt;     hint=recommended, useposix=true, d_sigaction=define
&gt;     usethreads=define use5005threads=undef useithreads=define
&gt; usemultiplicity=define
&gt;     useperlio=define d_sfio=undef uselargefiles=define usesocks=undef
&gt;     use64bitint=undef use64bitall=undef uselongdouble=undef
&gt;     usemymalloc=n, bincompat5005=undef
&gt;   Compiler:
&gt;     cc=&#39;cc&#39;, ccflags =&#39;-g -pipe -fno-common -DPERL_DARWIN
&gt; -no-cpp-precomp -fno-strict-aliasing -I/usr/local/include&#39;,
&gt;     optimize=&#39;-O3&#39;,
&gt;     cppflags=&#39;-no-cpp-precomp -g -pipe -fno-common -DPERL_DARWIN
&gt; -no-cpp-precomp -fno-strict-aliasing -I/usr/local/include&#39;
&gt;     ccversion=&#39;&#39;, gccversion=&#39;4.0.1 &#40;Apple Computer, Inc. build 5363&#41;
&gt; &#40;+4864187&#41;&#39;, gccosandvers=&#39;&#39;
&gt;     intsize=4, longsize=4, ptrsize=4, doublesize=8, byteorder=1234
&gt;     d_longlong=define, longlongsize=8, d_longdbl=define,  
&gt; longdblsize=16
&gt;     ivtype=&#39;long&#39;, ivsize=4, nvtype=&#39;double&#39;, nvsize=8, Off_t=&#39;off_t&#39;,
&gt; lseeksize=8
&gt;     alignbytes=8, prototype=define
&gt;   Linker and Libraries:
&gt;     ld=&#39;env MACOSX_DEPLOYMENT_TARGET=10.3 cc&#39;, ldflags =&#39;-L/usr/ 
&gt; local/lib&#39;
&gt;     libpth=/usr/local/lib /usr/lib
&gt;     libs=-ldbm -ldl -lm -lc
&gt;     perllibs=-ldl -lm -lc
&gt;     libc=/usr/lib/libc.dylib, so=dylib, useshrplib=true,
&gt; libperl=libperl.dylib
&gt;     gnulibc_version=&#39;&#39;
&gt;   Dynamic Linking:
&gt;     dlsrc=dl_dlopen.xs, dlext=bundle, d_dlsymun=undef, ccdlflags=&#39; &#39;
&gt;     cccdlflags=&#39; &#39;, lddlflags=&#39;-bundle -undefined dynamic_lookup
&gt; -L/usr/local/lib&#39;
&gt;
&gt;
&gt; Characteristics of this binary &#40;from libperl&#41;:
&gt;   Compile-time options: MULTIPLICITY USE_ITHREADS USE_LARGE_FILES
&gt; PERL_IMPLICIT_CONTEXT
&gt;   Locally applied patches:
&gt;         23953 - fix for File::Path::rmtree CAN-2004-0452 security  
&gt; issue
&gt;         33990 - fix for setuid perl security issues
&gt;         fix for regcomp CVE-2007-5116 security vulnerability
&gt;         SPRINTF0 - fixes for sprintf formatting issues - CVE-2005-3962
&gt;   Built under darwin
&gt;   Compiled at Nov 26 2007 09:16:22
&gt;   %ENV:
&gt;     PERL5LIB=&#34;/sw/lib/perl5:/sw/lib/perl5/darwin&#34;
&gt;   @INC:
&gt;     /sw/lib/perl5/5.8.6/darwin-thread-multi-2level
&gt;     /sw/lib/perl5/5.8.6
&gt;     /sw/lib/perl5/darwin-thread-multi-2level
&gt;     /sw/lib/perl5
&gt;     /sw/lib/perl5/darwin
&gt;     /System/Library/Perl/5.8.6/darwin-thread-multi-2level
&gt;     /System/Library/Perl/5.8.6
&gt;     /Library/Perl/5.8.6/darwin-thread-multi-2level
&gt;     /Library/Perl/5.8.6
&gt;     /Library/Perl
&gt;     /Network/Library/Perl/5.8.6/darwin-thread-multi-2level
&gt;     /Network/Library/Perl/5.8.6
&gt;     /Network/Library/Perl
&gt;     /System/Library/Perl/Extras/5.8.6/darwin-thread-multi-2level
&gt;     /System/Library/Perl/Extras/5.8.6
&gt;     /Library/Perl/5.8.1
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;15&nbsp;21:47:19&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;15&nbsp;22:43:44&nbsp;2008</span>
    <span class="description">chris [...] chrisdolan.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> bug-PPI [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #35917] charsets.t eats all available VM </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 15 May 2008 21:43:23 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Chris Dolan &lt;chris [...] chrisdolan.net&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Chris Dolan &lt;chris [...] chrisdolan.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">OK, this is perhaps one for Adam to tackle.  I&#39;ve found the  
triggering symptom, but not the cause.  This is a very interesting case.

We start with 14_charsets.t
         good_ok&#40; &#39;一&#40;&#41;;&#39;,                   &#34;Function with Chinese  
characters&#34;   &#41;;

which at the very end of tokenization looks like this &#40;right after  
&#34;the perfect crime!&#34;:

$self = PPI::Tokenizer=HASH&#40;0x394c4&#41;
    &#39;class&#39; =&gt; &#39;PPI::Token::Whitespace&#39;
    &#39;line&#39; =&gt; &#39;\x{4E00}&#40;&#41;; &#39;
    &#39;line_count&#39; =&gt; 1
    &#39;line_cursor&#39; =&gt; 5
    &#39;line_length&#39; =&gt; 5
    &#39;source&#39; =&gt; ARRAY&#40;0x1ab72d8&#41;
         empty array
    &#39;source_bytes&#39; =&gt; 4
    &#39;source_eof_chop&#39; =&gt; &#39;&#39;
    &#39;token&#39; =&gt; undef
    &#39;token_cursor&#39; =&gt; 1
    &#39;token_eof&#39; =&gt; 0
    &#39;tokens&#39; =&gt; ARRAY&#40;0x392b4&#41;
       0  PPI::Token::Word=HASH&#40;0x1aefae0&#41;
          &#39;content&#39; =&gt; &#39;\x{4E00}&#39;
       1  PPI::Token::Structure=HASH&#40;0x1afb724&#41;
          &#39;content&#39; =&gt; &#39;&#40;&#41;; &#39;
       2  PPI::Token::Structure=HASH&#40;0x1afb7e4&#41;
          &#39;content&#39; =&gt; &#39;&#41;&#39;
       3  PPI::Token::Structure=HASH&#40;0x1afb824&#41;
          &#39;content&#39; =&gt; &#39;;&#39;
    &#39;v6&#39; =&gt; ARRAY&#40;0x3a274&#41;
         empty array
    &#39;zone&#39; =&gt; &#39;PPI::Token::Whitespace&#39;

The key point is that the content field of tokens[1] is &#39;&#40;&#41;; &#39; when  
it should be &#39;&#40;&#39;.  As consequence, that token answers true to both  
__LEXER__opens and __LEXER__closes, which triggers an infinite loop  
as the lexer repeatedly calls rollback&#40;&#41; and pushes more and more  
empty statements onto the Document instance, thus using all RAM.

So, the question is why does the PPI::Token::Structure go awry and  
pull in too many characters?  I&#39;ve only tested on Mac OS X 10.4 &#40;the  
same as claco&#41; so maybe it&#39;s specific to 5.8.6.  Dunno yet, input  
appreciated.

Chris



On May 15, 2008, at 8:46 PM, Chris Dolan wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi Chris,
&gt;
&gt; Reproduced on my Mac.  I&#39;m investigating...
&gt;
&gt; Chris
&gt;
&gt; On May 15, 2008, at 5:58 PM, Christopher H. Laco via RT wrote:
<div class="message-stanza open">&gt;&gt;
&gt;&gt; Thu May 15 18:58:45 2008: Request 35917 was acted upon.
&gt;&gt; Transaction: Ticket created by CLACO
&gt;&gt;        Queue: PPI
&gt;&gt;      Subject: charsets.t eats all available VM
&gt;&gt;    Broken in: &#40;no value&#41;
&gt;&gt;     Severity: &#40;no value&#41;
&gt;&gt;        Owner: Nobody
&gt;&gt;   Requestors: claco@cpan.org
&gt;&gt;       Status: new
&gt;&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=35917">http://rt.cpan.org/Ticket/Display.html?id=35917</a></span> &gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; t/14/charsets.t eats VM memory until an out of memory error is  
&gt;&gt; reached.
&gt;&gt;
&gt;&gt;
&gt;&gt; t/14_charsets......................perl&#40;797&#41; malloc: ***
&gt;&gt; vm_allocate&#40;size=8421376&#41; failed &#40;error code=3&#41;
&gt;&gt; perl&#40;797&#41; malloc: *** error: can&#39;t allocate region
&gt;&gt; perl&#40;797&#41; malloc: *** set a breakpoint in szone_error to debug
&gt;&gt; Out of memory!
&gt;&gt; perl&#40;797&#41; malloc: *** vm_allocate&#40;size=8421376&#41; failed &#40;error code=3&#41;
&gt;&gt; perl&#40;797&#41; malloc: *** error: can&#39;t allocate region
&gt;&gt; perl&#40;797&#41; malloc: *** set a breakpoint in szone_error to debug
&gt;&gt; Out of memory!
&gt;&gt; perl&#40;797&#41; malloc: *** vm_allocate&#40;size=8421376&#41; failed &#40;error code=3&#41;
&gt;&gt; perl&#40;797&#41; malloc: *** error: can&#39;t allocate region
&gt;&gt; perl&#40;797&#41; malloc: *** set a breakpoint in szone_error to debug
&gt;&gt; Out of memory!
&gt;&gt; Callback called exit.
&gt;&gt; END failed--call queue aborted.
&gt;&gt;
&gt;&gt; The machine has 4GB of memory installed.
&gt;&gt; Here is the output from running chartset.t directly:
&gt;&gt;
&gt;&gt; mbp:~/.cpan/build/PPI-1.203-s5lYEU claco$ perl -Ilib t/14_charsets.t
&gt;&gt; 1..11
&gt;&gt; ok 1 - Parsed code without accented chars
&gt;&gt; ok 2 - Function with umlaut
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; Here&#39;s my perl -V
&gt;&gt; --
&gt;&gt; claco@mbp ~ $ perl -V
&gt;&gt; Summary of my perl5 &#40;revision 5 version 8 subversion 6&#41;  
&gt;&gt; configuration:
&gt;&gt;   Platform:
&gt;&gt;     osname=darwin, osvers=8.0, archname=darwin-thread-multi-2level
&gt;&gt;     uname=&#39;darwin b48.apple.com 8.0 darwin kernel version 8.3.0:  
&gt;&gt; mon oct
&gt;&gt; 3 20:04:04 pdt 2005; root:xnu-792.6.22.obj~2release_ppc power  
&gt;&gt; macintosh
&gt;&gt; powerpc &#39;
&gt;&gt;     config_args=&#39;-ds -e -Dprefix=/usr -Dccflags=-g  -pipe
&gt;&gt; -Dldflags=-Dman3ext=3pm -Duseithreads -Duseshrplib&#39;
&gt;&gt;     hint=recommended, useposix=true, d_sigaction=define
&gt;&gt;     usethreads=define use5005threads=undef useithreads=define
&gt;&gt; usemultiplicity=define
&gt;&gt;     useperlio=define d_sfio=undef uselargefiles=define usesocks=undef
&gt;&gt;     use64bitint=undef use64bitall=undef uselongdouble=undef
&gt;&gt;     usemymalloc=n, bincompat5005=undef
&gt;&gt;   Compiler:
&gt;&gt;     cc=&#39;cc&#39;, ccflags =&#39;-g -pipe -fno-common -DPERL_DARWIN
&gt;&gt; -no-cpp-precomp -fno-strict-aliasing -I/usr/local/include&#39;,
&gt;&gt;     optimize=&#39;-O3&#39;,
&gt;&gt;     cppflags=&#39;-no-cpp-precomp -g -pipe -fno-common -DPERL_DARWIN
&gt;&gt; -no-cpp-precomp -fno-strict-aliasing -I/usr/local/include&#39;
&gt;&gt;     ccversion=&#39;&#39;, gccversion=&#39;4.0.1 &#40;Apple Computer, Inc. build 5363&#41;
&gt;&gt; &#40;+4864187&#41;&#39;, gccosandvers=&#39;&#39;
&gt;&gt;     intsize=4, longsize=4, ptrsize=4, doublesize=8, byteorder=1234
&gt;&gt;     d_longlong=define, longlongsize=8, d_longdbl=define,  
&gt;&gt; longdblsize=16
&gt;&gt;     ivtype=&#39;long&#39;, ivsize=4, nvtype=&#39;double&#39;, nvsize=8,  
&gt;&gt; Off_t=&#39;off_t&#39;,
&gt;&gt; lseeksize=8
&gt;&gt;     alignbytes=8, prototype=define
&gt;&gt;   Linker and Libraries:
&gt;&gt;     ld=&#39;env MACOSX_DEPLOYMENT_TARGET=10.3 cc&#39;, ldflags =&#39;-L/usr/ 
&gt;&gt; local/lib&#39;
&gt;&gt;     libpth=/usr/local/lib /usr/lib
&gt;&gt;     libs=-ldbm -ldl -lm -lc
&gt;&gt;     perllibs=-ldl -lm -lc
&gt;&gt;     libc=/usr/lib/libc.dylib, so=dylib, useshrplib=true,
&gt;&gt; libperl=libperl.dylib
&gt;&gt;     gnulibc_version=&#39;&#39;
&gt;&gt;   Dynamic Linking:
&gt;&gt;     dlsrc=dl_dlopen.xs, dlext=bundle, d_dlsymun=undef, ccdlflags=&#39; &#39;
&gt;&gt;     cccdlflags=&#39; &#39;, lddlflags=&#39;-bundle -undefined dynamic_lookup
&gt;&gt; -L/usr/local/lib&#39;
&gt;&gt;
&gt;&gt;
&gt;&gt; Characteristics of this binary &#40;from libperl&#41;:
&gt;&gt;   Compile-time options: MULTIPLICITY USE_ITHREADS USE_LARGE_FILES
&gt;&gt; PERL_IMPLICIT_CONTEXT
&gt;&gt;   Locally applied patches:
&gt;&gt;         23953 - fix for File::Path::rmtree CAN-2004-0452 security  
&gt;&gt; issue
&gt;&gt;         33990 - fix for setuid perl security issues
&gt;&gt;         fix for regcomp CVE-2007-5116 security vulnerability
&gt;&gt;         SPRINTF0 - fixes for sprintf formatting issues -  
&gt;&gt; CVE-2005-3962
&gt;&gt;   Built under darwin
&gt;&gt;   Compiled at Nov 26 2007 09:16:22
&gt;&gt;   %ENV:
&gt;&gt;     PERL5LIB=&#34;/sw/lib/perl5:/sw/lib/perl5/darwin&#34;
&gt;&gt;   @INC:
&gt;&gt;     /sw/lib/perl5/5.8.6/darwin-thread-multi-2level
&gt;&gt;     /sw/lib/perl5/5.8.6
&gt;&gt;     /sw/lib/perl5/darwin-thread-multi-2level
&gt;&gt;     /sw/lib/perl5
&gt;&gt;     /sw/lib/perl5/darwin
&gt;&gt;     /System/Library/Perl/5.8.6/darwin-thread-multi-2level
&gt;&gt;     /System/Library/Perl/5.8.6
&gt;&gt;     /Library/Perl/5.8.6/darwin-thread-multi-2level
&gt;&gt;     /Library/Perl/5.8.6
&gt;&gt;     /Library/Perl
&gt;&gt;     /Network/Library/Perl/5.8.6/darwin-thread-multi-2level
&gt;&gt;     /Network/Library/Perl/5.8.6
&gt;&gt;     /Network/Library/Perl
&gt;&gt;     /System/Library/Perl/Extras/5.8.6/darwin-thread-multi-2level
&gt;&gt;     /System/Library/Perl/Extras/5.8.6
&gt;&gt;     /Library/Perl/5.8.1
&gt;&gt;
</div>&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;15&nbsp;23:21:17&nbsp;2008</span>
    <span class="description">chris [...] chrisdolan.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #35917] charsets.t eats all available VM </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 15 May 2008 22:20:34 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PPI [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Chris Dolan &lt;chris [...] chrisdolan.net&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">After a little more digging, this looks like a bug in Perl 5.8.6.   
The following evidence is pretty damning:

Debugging while in PPI::Tokenizer::_process_next_char&#40;&#41;, just after  
the first token is done and we&#39;re about to start n the second one.   
The tokenizer looks like this

$self = PPI::Tokenizer=HASH&#40;0x394c4&#41;
    &#39;class&#39; =&gt; &#39;PPI::Token::Whitespace&#39;
    &#39;line&#39; =&gt; &#39;\x{4E00}&#40;&#41;; &#39;
    &#39;line_count&#39; =&gt; 1
    &#39;line_cursor&#39; =&gt; 1
    &#39;line_length&#39; =&gt; 5
    &#39;source&#39; =&gt; ARRAY&#40;0x1ab72d8&#41;
         empty array
    &#39;source_bytes&#39; =&gt; 4
    &#39;source_eof_chop&#39; =&gt; 1
    &#39;token&#39; =&gt; undef
    &#39;token_cursor&#39; =&gt; 0
    &#39;token_eof&#39; =&gt; 0
    &#39;tokens&#39; =&gt; ARRAY&#40;0x392b4&#41;
       0  PPI::Token::Word=HASH&#40;0x1aefae0&#41;
          &#39;content&#39; =&gt; &#39;\x{4E00}&#39;
    &#39;v6&#39; =&gt; ARRAY&#40;0x3a274&#41;
         empty array
    &#39;zone&#39; =&gt; &#39;PPI::Token::Whitespace&#39;


Then we execute this line of code:
639:            my $char = substr&#40; $self-&gt;{line}, $self-&gt; 
{line_cursor}, 1 &#41;;

and get this result:
    $char = &#39;&#40;&#41;; &#39;

WTF???  How does an invocation of substr&#40;&#41; with a length of 1 result  
in a string of length 4?  Attached is the simplest failure case I  
could write to reproduce this bug.  In the process I discovered that  
the error only happens with PPI v1.203.  The same test case &#40;and t/ 
14_charset.t!&#41; works fine with PPI v1.201.

Furthermore, when I run the same test under Perl 5.8.8 on the same  
Mac, the test passes under 1.201 and 1.203.  So, it&#39;s definitely a  
newly exposed bug in Mac OS X 10.4&#39;s Perl 5.8.6.  I don&#39;t have  
another 5.8.6 handy to test to see if it&#39;s Apple&#39;s &#40;slightly patched&#41;  
build or 5.8.6 in general that&#39;s flawed.

Chris
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"></div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;15&nbsp;23:29:03&nbsp;2008</span>
    <span class="description">adamkennedybackup [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #35917] charsets.t eats all available VM</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 16 May 2008 13:23:22 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PPI [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Adam Kennedy &lt;adamkennedybackup [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ll have a look over the weekend if possibly.

I note that while PPI does ostensibly support non-ascii inside of 
strings, it doesn&#39;t necessarily support it everywhere.

So this might be more of a problem of not aborting the parse when we 
should...

Chris, I also want to take another look at at least adding ::Token::BOM 
in soon, although I would rather special-case the parsing rather than 
introducing it as a separate parse class/zone.

Adam K

Chris Dolan via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: PPI
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=35917">http://rt.cpan.org/Ticket/Display.html?id=35917</a></span> &gt;
&gt;
&gt; OK, this is perhaps one for Adam to tackle.  I&#39;ve found the  
&gt; triggering symptom, but not the cause.  This is a very interesting case.
&gt;
&gt; We start with 14_charsets.t
&gt;          good_ok&#40; &#39;一&#40;&#41;;&#39;,                   &#34;Function with Chinese  
&gt; characters&#34;   &#41;;
&gt;
&gt; which at the very end of tokenization looks like this &#40;right after  
&gt; &#34;the perfect crime!&#34;:
&gt;
&gt; $self = PPI::Tokenizer=HASH&#40;0x394c4&#41;
&gt;     &#39;class&#39; =&gt; &#39;PPI::Token::Whitespace&#39;
&gt;     &#39;line&#39; =&gt; &#39;\x{4E00}&#40;&#41;; &#39;
&gt;     &#39;line_count&#39; =&gt; 1
&gt;     &#39;line_cursor&#39; =&gt; 5
&gt;     &#39;line_length&#39; =&gt; 5
&gt;     &#39;source&#39; =&gt; ARRAY&#40;0x1ab72d8&#41;
&gt;          empty array
&gt;     &#39;source_bytes&#39; =&gt; 4
&gt;     &#39;source_eof_chop&#39; =&gt; &#39;&#39;
&gt;     &#39;token&#39; =&gt; undef
&gt;     &#39;token_cursor&#39; =&gt; 1
&gt;     &#39;token_eof&#39; =&gt; 0
&gt;     &#39;tokens&#39; =&gt; ARRAY&#40;0x392b4&#41;
&gt;        0  PPI::Token::Word=HASH&#40;0x1aefae0&#41;
&gt;           &#39;content&#39; =&gt; &#39;\x{4E00}&#39;
&gt;        1  PPI::Token::Structure=HASH&#40;0x1afb724&#41;
&gt;           &#39;content&#39; =&gt; &#39;&#40;&#41;; &#39;
&gt;        2  PPI::Token::Structure=HASH&#40;0x1afb7e4&#41;
&gt;           &#39;content&#39; =&gt; &#39;&#41;&#39;
&gt;        3  PPI::Token::Structure=HASH&#40;0x1afb824&#41;
&gt;           &#39;content&#39; =&gt; &#39;;&#39;
&gt;     &#39;v6&#39; =&gt; ARRAY&#40;0x3a274&#41;
&gt;          empty array
&gt;     &#39;zone&#39; =&gt; &#39;PPI::Token::Whitespace&#39;
&gt;
&gt; The key point is that the content field of tokens[1] is &#39;&#40;&#41;; &#39; when  
&gt; it should be &#39;&#40;&#39;.  As consequence, that token answers true to both  
&gt; __LEXER__opens and __LEXER__closes, which triggers an infinite loop  
&gt; as the lexer repeatedly calls rollback&#40;&#41; and pushes more and more  
&gt; empty statements onto the Document instance, thus using all RAM.
&gt;
&gt; So, the question is why does the PPI::Token::Structure go awry and  
&gt; pull in too many characters?  I&#39;ve only tested on Mac OS X 10.4 &#40;the  
&gt; same as claco&#41; so maybe it&#39;s specific to 5.8.6.  Dunno yet, input  
&gt; appreciated.
&gt;
&gt; Chris
&gt;
&gt;
&gt;
&gt; On May 15, 2008, at 8:46 PM, Chris Dolan wrote:
&gt;   
<div class="message-stanza open">&gt;&gt; Hi Chris,
&gt;&gt;
&gt;&gt; Reproduced on my Mac.  I&#39;m investigating...
&gt;&gt;
&gt;&gt; Chris
&gt;&gt;
&gt;&gt; On May 15, 2008, at 5:58 PM, Christopher H. Laco via RT wrote:
&gt;&gt;     
<div class="message-stanza open">&gt;&gt;&gt; Thu May 15 18:58:45 2008: Request 35917 was acted upon.
&gt;&gt;&gt; Transaction: Ticket created by CLACO
&gt;&gt;&gt;        Queue: PPI
&gt;&gt;&gt;      Subject: charsets.t eats all available VM
&gt;&gt;&gt;    Broken in: &#40;no value&#41;
&gt;&gt;&gt;     Severity: &#40;no value&#41;
&gt;&gt;&gt;        Owner: Nobody
&gt;&gt;&gt;   Requestors: claco@cpan.org
&gt;&gt;&gt;       Status: new
&gt;&gt;&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=35917">http://rt.cpan.org/Ticket/Display.html?id=35917</a></span> &gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; t/14/charsets.t eats VM memory until an out of memory error is  
&gt;&gt;&gt; reached.
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; t/14_charsets......................perl&#40;797&#41; malloc: ***
&gt;&gt;&gt; vm_allocate&#40;size=8421376&#41; failed &#40;error code=3&#41;
&gt;&gt;&gt; perl&#40;797&#41; malloc: *** error: can&#39;t allocate region
&gt;&gt;&gt; perl&#40;797&#41; malloc: *** set a breakpoint in szone_error to debug
&gt;&gt;&gt; Out of memory!
&gt;&gt;&gt; perl&#40;797&#41; malloc: *** vm_allocate&#40;size=8421376&#41; failed &#40;error code=3&#41;
&gt;&gt;&gt; perl&#40;797&#41; malloc: *** error: can&#39;t allocate region
&gt;&gt;&gt; perl&#40;797&#41; malloc: *** set a breakpoint in szone_error to debug
&gt;&gt;&gt; Out of memory!
&gt;&gt;&gt; perl&#40;797&#41; malloc: *** vm_allocate&#40;size=8421376&#41; failed &#40;error code=3&#41;
&gt;&gt;&gt; perl&#40;797&#41; malloc: *** error: can&#39;t allocate region
&gt;&gt;&gt; perl&#40;797&#41; malloc: *** set a breakpoint in szone_error to debug
&gt;&gt;&gt; Out of memory!
&gt;&gt;&gt; Callback called exit.
&gt;&gt;&gt; END failed--call queue aborted.
&gt;&gt;&gt;
&gt;&gt;&gt; The machine has 4GB of memory installed.
&gt;&gt;&gt; Here is the output from running chartset.t directly:
&gt;&gt;&gt;
&gt;&gt;&gt; mbp:~/.cpan/build/PPI-1.203-s5lYEU claco$ perl -Ilib t/14_charsets.t
&gt;&gt;&gt; 1..11
&gt;&gt;&gt; ok 1 - Parsed code without accented chars
&gt;&gt;&gt; ok 2 - Function with umlaut
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Here&#39;s my perl -V
&gt;&gt;&gt; --
&gt;&gt;&gt; claco@mbp ~ $ perl -V
&gt;&gt;&gt; Summary of my perl5 &#40;revision 5 version 8 subversion 6&#41;  
&gt;&gt;&gt; configuration:
&gt;&gt;&gt;   Platform:
&gt;&gt;&gt;     osname=darwin, osvers=8.0, archname=darwin-thread-multi-2level
&gt;&gt;&gt;     uname=&#39;darwin b48.apple.com 8.0 darwin kernel version 8.3.0:  
&gt;&gt;&gt; mon oct
&gt;&gt;&gt; 3 20:04:04 pdt 2005; root:xnu-792.6.22.obj~2release_ppc power  
&gt;&gt;&gt; macintosh
&gt;&gt;&gt; powerpc &#39;
&gt;&gt;&gt;     config_args=&#39;-ds -e -Dprefix=/usr -Dccflags=-g  -pipe
&gt;&gt;&gt; -Dldflags=-Dman3ext=3pm -Duseithreads -Duseshrplib&#39;
&gt;&gt;&gt;     hint=recommended, useposix=true, d_sigaction=define
&gt;&gt;&gt;     usethreads=define use5005threads=undef useithreads=define
&gt;&gt;&gt; usemultiplicity=define
&gt;&gt;&gt;     useperlio=define d_sfio=undef uselargefiles=define usesocks=undef
&gt;&gt;&gt;     use64bitint=undef use64bitall=undef uselongdouble=undef
&gt;&gt;&gt;     usemymalloc=n, bincompat5005=undef
&gt;&gt;&gt;   Compiler:
&gt;&gt;&gt;     cc=&#39;cc&#39;, ccflags =&#39;-g -pipe -fno-common -DPERL_DARWIN
&gt;&gt;&gt; -no-cpp-precomp -fno-strict-aliasing -I/usr/local/include&#39;,
&gt;&gt;&gt;     optimize=&#39;-O3&#39;,
&gt;&gt;&gt;     cppflags=&#39;-no-cpp-precomp -g -pipe -fno-common -DPERL_DARWIN
&gt;&gt;&gt; -no-cpp-precomp -fno-strict-aliasing -I/usr/local/include&#39;
&gt;&gt;&gt;     ccversion=&#39;&#39;, gccversion=&#39;4.0.1 &#40;Apple Computer, Inc. build 5363&#41;
&gt;&gt;&gt; &#40;+4864187&#41;&#39;, gccosandvers=&#39;&#39;
&gt;&gt;&gt;     intsize=4, longsize=4, ptrsize=4, doublesize=8, byteorder=1234
&gt;&gt;&gt;     d_longlong=define, longlongsize=8, d_longdbl=define,  
&gt;&gt;&gt; longdblsize=16
&gt;&gt;&gt;     ivtype=&#39;long&#39;, ivsize=4, nvtype=&#39;double&#39;, nvsize=8,  
&gt;&gt;&gt; Off_t=&#39;off_t&#39;,
&gt;&gt;&gt; lseeksize=8
&gt;&gt;&gt;     alignbytes=8, prototype=define
&gt;&gt;&gt;   Linker and Libraries:
&gt;&gt;&gt;     ld=&#39;env MACOSX_DEPLOYMENT_TARGET=10.3 cc&#39;, ldflags =&#39;-L/usr/ 
&gt;&gt;&gt; local/lib&#39;
&gt;&gt;&gt;     libpth=/usr/local/lib /usr/lib
&gt;&gt;&gt;     libs=-ldbm -ldl -lm -lc
&gt;&gt;&gt;     perllibs=-ldl -lm -lc
&gt;&gt;&gt;     libc=/usr/lib/libc.dylib, so=dylib, useshrplib=true,
&gt;&gt;&gt; libperl=libperl.dylib
&gt;&gt;&gt;     gnulibc_version=&#39;&#39;
&gt;&gt;&gt;   Dynamic Linking:
&gt;&gt;&gt;     dlsrc=dl_dlopen.xs, dlext=bundle, d_dlsymun=undef, ccdlflags=&#39; &#39;
&gt;&gt;&gt;     cccdlflags=&#39; &#39;, lddlflags=&#39;-bundle -undefined dynamic_lookup
&gt;&gt;&gt; -L/usr/local/lib&#39;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Characteristics of this binary &#40;from libperl&#41;:
&gt;&gt;&gt;   Compile-time options: MULTIPLICITY USE_ITHREADS USE_LARGE_FILES
&gt;&gt;&gt; PERL_IMPLICIT_CONTEXT
&gt;&gt;&gt;   Locally applied patches:
&gt;&gt;&gt;         23953 - fix for File::Path::rmtree CAN-2004-0452 security  
&gt;&gt;&gt; issue
&gt;&gt;&gt;         33990 - fix for setuid perl security issues
&gt;&gt;&gt;         fix for regcomp CVE-2007-5116 security vulnerability
&gt;&gt;&gt;         SPRINTF0 - fixes for sprintf formatting issues -  
&gt;&gt;&gt; CVE-2005-3962
&gt;&gt;&gt;   Built under darwin
&gt;&gt;&gt;   Compiled at Nov 26 2007 09:16:22
&gt;&gt;&gt;   %ENV:
&gt;&gt;&gt;     PERL5LIB=&#34;/sw/lib/perl5:/sw/lib/perl5/darwin&#34;
&gt;&gt;&gt;   @INC:
&gt;&gt;&gt;     /sw/lib/perl5/5.8.6/darwin-thread-multi-2level
&gt;&gt;&gt;     /sw/lib/perl5/5.8.6
&gt;&gt;&gt;     /sw/lib/perl5/darwin-thread-multi-2level
&gt;&gt;&gt;     /sw/lib/perl5
&gt;&gt;&gt;     /sw/lib/perl5/darwin
&gt;&gt;&gt;     /System/Library/Perl/5.8.6/darwin-thread-multi-2level
&gt;&gt;&gt;     /System/Library/Perl/5.8.6
&gt;&gt;&gt;     /Library/Perl/5.8.6/darwin-thread-multi-2level
&gt;&gt;&gt;     /Library/Perl/5.8.6
&gt;&gt;&gt;     /Library/Perl
&gt;&gt;&gt;     /Network/Library/Perl/5.8.6/darwin-thread-multi-2level
&gt;&gt;&gt;     /Network/Library/Perl/5.8.6
&gt;&gt;&gt;     /Network/Library/Perl
&gt;&gt;&gt;     /System/Library/Perl/Extras/5.8.6/darwin-thread-multi-2level
&gt;&gt;&gt;     /System/Library/Perl/Extras/5.8.6
&gt;&gt;&gt;     /Library/Perl/5.8.1
&gt;&gt;&gt;
&gt;&gt;&gt;       
</div></div>&gt;
&gt;
&gt;   
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;16&nbsp;00:21:13&nbsp;2008</span>
    <span class="description">chris [...] chrisdolan.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #35917] charsets.t eats all available VM</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 15 May 2008 23:20:34 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PPI [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Chris Dolan &lt;chris [...] chrisdolan.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve got it nailed.  It&#39;s only triggered in a very, very specific  
case &#40;Unicode in PPI::Token::Word on last line of the source file&#41;  
and only affects pre-5.8.8 &#40;not sure about 5.8.7 -- I don&#39;t have a  
build of that version to test&#41;.  I just committed a SKIP for the  
offending test if &#34;require 5.008007&#34; fails.  It&#39;s a small miracle  
that we even had a test that would trigger this bug.  The only reason  
it started manifesting in PPI v1.203 is because of this change in  
PPI::Token::Word:
    <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/diff?from=PPI-1.201&#38;to=PPI-1.203&#38;w=1#lib/">http://search.cpan.org/diff?from=PPI-1.201&#38;to=PPI-1.203&#38;w=1#lib/</a></span> 
PPI/Token/Word.pm

This is a nearly-minimal program that triggers the bug.

#!/usr/bin/perl
use utf8;
my $s = &#39;一&#40;&#41;;&#39;;
my $line = $s . &#39;!&#39;;
substr&#40;$line, 1&#41;;
print substr&#40;$line, 1, 1&#41;, &#34;\n&#34;;


Notes:
  * The BOM is not relevant.  The bug manifests with or without
  * There must be at least three characters after the Chinese glyph.   
If less than three, the bug does not manifest
  * There must be at least one additional character concatenated to  
the string
  * The open ended substr must precede the 1 character substr.

Wow.

Chris


On May 15, 2008, at 10:29 PM, Adam Kennedy via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt;        Queue: PPI
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=35917">http://rt.cpan.org/Ticket/Display.html?id=35917</a></span> &gt;
&gt;
&gt; I&#39;ll have a look over the weekend if possibly.
&gt;
&gt; I note that while PPI does ostensibly support non-ascii inside of
&gt; strings, it doesn&#39;t necessarily support it everywhere.
&gt;
&gt; So this might be more of a problem of not aborting the parse when we
&gt; should...
&gt;
&gt; Chris, I also want to take another look at at least  
&gt; adding ::Token::BOM
&gt; in soon, although I would rather special-case the parsing rather than
&gt; introducing it as a separate parse class/zone.
&gt;
&gt; Adam K
&gt;
&gt; Chris Dolan via RT wrote:
<div class="message-stanza open">&gt;&gt;        Queue: PPI
&gt;&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=35917">http://rt.cpan.org/Ticket/Display.html?id=35917</a></span> &gt;
&gt;&gt;
&gt;&gt; OK, this is perhaps one for Adam to tackle.  I&#39;ve found the
&gt;&gt; triggering symptom, but not the cause.  This is a very interesting  
&gt;&gt; case.
&gt;&gt;
&gt;&gt; We start with 14_charsets.t
&gt;&gt;          good_ok&#40; &#39;一&#40;&#41;;&#39;,                   &#34;Function with Chinese
&gt;&gt; characters&#34;   &#41;;
&gt;&gt;
&gt;&gt; which at the very end of tokenization looks like this &#40;right after
&gt;&gt; &#34;the perfect crime!&#34;:
&gt;&gt;
&gt;&gt; $self = PPI::Tokenizer=HASH&#40;0x394c4&#41;
&gt;&gt;     &#39;class&#39; =&gt; &#39;PPI::Token::Whitespace&#39;
&gt;&gt;     &#39;line&#39; =&gt; &#39;\x{4E00}&#40;&#41;; &#39;
&gt;&gt;     &#39;line_count&#39; =&gt; 1
&gt;&gt;     &#39;line_cursor&#39; =&gt; 5
&gt;&gt;     &#39;line_length&#39; =&gt; 5
&gt;&gt;     &#39;source&#39; =&gt; ARRAY&#40;0x1ab72d8&#41;
&gt;&gt;          empty array
&gt;&gt;     &#39;source_bytes&#39; =&gt; 4
&gt;&gt;     &#39;source_eof_chop&#39; =&gt; &#39;&#39;
&gt;&gt;     &#39;token&#39; =&gt; undef
&gt;&gt;     &#39;token_cursor&#39; =&gt; 1
&gt;&gt;     &#39;token_eof&#39; =&gt; 0
&gt;&gt;     &#39;tokens&#39; =&gt; ARRAY&#40;0x392b4&#41;
&gt;&gt;        0  PPI::Token::Word=HASH&#40;0x1aefae0&#41;
&gt;&gt;           &#39;content&#39; =&gt; &#39;\x{4E00}&#39;
&gt;&gt;        1  PPI::Token::Structure=HASH&#40;0x1afb724&#41;
&gt;&gt;           &#39;content&#39; =&gt; &#39;&#40;&#41;; &#39;
&gt;&gt;        2  PPI::Token::Structure=HASH&#40;0x1afb7e4&#41;
&gt;&gt;           &#39;content&#39; =&gt; &#39;&#41;&#39;
&gt;&gt;        3  PPI::Token::Structure=HASH&#40;0x1afb824&#41;
&gt;&gt;           &#39;content&#39; =&gt; &#39;;&#39;
&gt;&gt;     &#39;v6&#39; =&gt; ARRAY&#40;0x3a274&#41;
&gt;&gt;          empty array
&gt;&gt;     &#39;zone&#39; =&gt; &#39;PPI::Token::Whitespace&#39;
&gt;&gt;
&gt;&gt; The key point is that the content field of tokens[1] is &#39;&#40;&#41;; &#39; when
&gt;&gt; it should be &#39;&#40;&#39;.  As consequence, that token answers true to both
&gt;&gt; __LEXER__opens and __LEXER__closes, which triggers an infinite loop
&gt;&gt; as the lexer repeatedly calls rollback&#40;&#41; and pushes more and more
&gt;&gt; empty statements onto the Document instance, thus using all RAM.
&gt;&gt;
&gt;&gt; So, the question is why does the PPI::Token::Structure go awry and
&gt;&gt; pull in too many characters?  I&#39;ve only tested on Mac OS X 10.4 &#40;the
&gt;&gt; same as claco&#41; so maybe it&#39;s specific to 5.8.6.  Dunno yet, input
&gt;&gt; appreciated.
&gt;&gt;
&gt;&gt; Chris
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; On May 15, 2008, at 8:46 PM, Chris Dolan wrote:
&gt;&gt;
<div class="message-stanza open">&gt;&gt;&gt; Hi Chris,
&gt;&gt;&gt;
&gt;&gt;&gt; Reproduced on my Mac.  I&#39;m investigating...
&gt;&gt;&gt;
&gt;&gt;&gt; Chris
&gt;&gt;&gt;
&gt;&gt;&gt; On May 15, 2008, at 5:58 PM, Christopher H. Laco via RT wrote:
&gt;&gt;&gt;
<div class="message-stanza open">&gt;&gt;&gt;&gt; Thu May 15 18:58:45 2008: Request 35917 was acted upon.
&gt;&gt;&gt;&gt; Transaction: Ticket created by CLACO
&gt;&gt;&gt;&gt;        Queue: PPI
&gt;&gt;&gt;&gt;      Subject: charsets.t eats all available VM
&gt;&gt;&gt;&gt;    Broken in: &#40;no value&#41;
&gt;&gt;&gt;&gt;     Severity: &#40;no value&#41;
&gt;&gt;&gt;&gt;        Owner: Nobody
&gt;&gt;&gt;&gt;   Requestors: claco@cpan.org
&gt;&gt;&gt;&gt;       Status: new
&gt;&gt;&gt;&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=35917">http://rt.cpan.org/Ticket/Display.html?id=35917</a></span> &gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; t/14/charsets.t eats VM memory until an out of memory error is
&gt;&gt;&gt;&gt; reached.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; t/14_charsets......................perl&#40;797&#41; malloc: ***
&gt;&gt;&gt;&gt; vm_allocate&#40;size=8421376&#41; failed &#40;error code=3&#41;
&gt;&gt;&gt;&gt; perl&#40;797&#41; malloc: *** error: can&#39;t allocate region
&gt;&gt;&gt;&gt; perl&#40;797&#41; malloc: *** set a breakpoint in szone_error to debug
&gt;&gt;&gt;&gt; Out of memory!
&gt;&gt;&gt;&gt; perl&#40;797&#41; malloc: *** vm_allocate&#40;size=8421376&#41; failed &#40;error  
&gt;&gt;&gt;&gt; code=3&#41;
&gt;&gt;&gt;&gt; perl&#40;797&#41; malloc: *** error: can&#39;t allocate region
&gt;&gt;&gt;&gt; perl&#40;797&#41; malloc: *** set a breakpoint in szone_error to debug
&gt;&gt;&gt;&gt; Out of memory!
&gt;&gt;&gt;&gt; perl&#40;797&#41; malloc: *** vm_allocate&#40;size=8421376&#41; failed &#40;error  
&gt;&gt;&gt;&gt; code=3&#41;
&gt;&gt;&gt;&gt; perl&#40;797&#41; malloc: *** error: can&#39;t allocate region
&gt;&gt;&gt;&gt; perl&#40;797&#41; malloc: *** set a breakpoint in szone_error to debug
&gt;&gt;&gt;&gt; Out of memory!
&gt;&gt;&gt;&gt; Callback called exit.
&gt;&gt;&gt;&gt; END failed--call queue aborted.
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; The machine has 4GB of memory installed.
&gt;&gt;&gt;&gt; Here is the output from running chartset.t directly:
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; mbp:~/.cpan/build/PPI-1.203-s5lYEU claco$ perl -Ilib t/ 
&gt;&gt;&gt;&gt; 14_charsets.t
&gt;&gt;&gt;&gt; 1..11
&gt;&gt;&gt;&gt; ok 1 - Parsed code without accented chars
&gt;&gt;&gt;&gt; ok 2 - Function with umlaut
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Here&#39;s my perl -V
&gt;&gt;&gt;&gt; --
&gt;&gt;&gt;&gt; claco@mbp ~ $ perl -V
&gt;&gt;&gt;&gt; Summary of my perl5 &#40;revision 5 version 8 subversion 6&#41;
&gt;&gt;&gt;&gt; configuration:
&gt;&gt;&gt;&gt;   Platform:
&gt;&gt;&gt;&gt;     osname=darwin, osvers=8.0, archname=darwin-thread-multi-2level
&gt;&gt;&gt;&gt;     uname=&#39;darwin b48.apple.com 8.0 darwin kernel version 8.3.0:
&gt;&gt;&gt;&gt; mon oct
&gt;&gt;&gt;&gt; 3 20:04:04 pdt 2005; root:xnu-792.6.22.obj~2release_ppc power
&gt;&gt;&gt;&gt; macintosh
&gt;&gt;&gt;&gt; powerpc &#39;
&gt;&gt;&gt;&gt;     config_args=&#39;-ds -e -Dprefix=/usr -Dccflags=-g  -pipe
&gt;&gt;&gt;&gt; -Dldflags=-Dman3ext=3pm -Duseithreads -Duseshrplib&#39;
&gt;&gt;&gt;&gt;     hint=recommended, useposix=true, d_sigaction=define
&gt;&gt;&gt;&gt;     usethreads=define use5005threads=undef useithreads=define
&gt;&gt;&gt;&gt; usemultiplicity=define
&gt;&gt;&gt;&gt;     useperlio=define d_sfio=undef uselargefiles=define  
&gt;&gt;&gt;&gt; usesocks=undef
&gt;&gt;&gt;&gt;     use64bitint=undef use64bitall=undef uselongdouble=undef
&gt;&gt;&gt;&gt;     usemymalloc=n, bincompat5005=undef
&gt;&gt;&gt;&gt;   Compiler:
&gt;&gt;&gt;&gt;     cc=&#39;cc&#39;, ccflags =&#39;-g -pipe -fno-common -DPERL_DARWIN
&gt;&gt;&gt;&gt; -no-cpp-precomp -fno-strict-aliasing -I/usr/local/include&#39;,
&gt;&gt;&gt;&gt;     optimize=&#39;-O3&#39;,
&gt;&gt;&gt;&gt;     cppflags=&#39;-no-cpp-precomp -g -pipe -fno-common -DPERL_DARWIN
&gt;&gt;&gt;&gt; -no-cpp-precomp -fno-strict-aliasing -I/usr/local/include&#39;
&gt;&gt;&gt;&gt;     ccversion=&#39;&#39;, gccversion=&#39;4.0.1 &#40;Apple Computer, Inc. build  
&gt;&gt;&gt;&gt; 5363&#41;
&gt;&gt;&gt;&gt; &#40;+4864187&#41;&#39;, gccosandvers=&#39;&#39;
&gt;&gt;&gt;&gt;     intsize=4, longsize=4, ptrsize=4, doublesize=8, byteorder=1234
&gt;&gt;&gt;&gt;     d_longlong=define, longlongsize=8, d_longdbl=define,
&gt;&gt;&gt;&gt; longdblsize=16
&gt;&gt;&gt;&gt;     ivtype=&#39;long&#39;, ivsize=4, nvtype=&#39;double&#39;, nvsize=8,
&gt;&gt;&gt;&gt; Off_t=&#39;off_t&#39;,
&gt;&gt;&gt;&gt; lseeksize=8
&gt;&gt;&gt;&gt;     alignbytes=8, prototype=define
&gt;&gt;&gt;&gt;   Linker and Libraries:
&gt;&gt;&gt;&gt;     ld=&#39;env MACOSX_DEPLOYMENT_TARGET=10.3 cc&#39;, ldflags =&#39;-L/usr/
&gt;&gt;&gt;&gt; local/lib&#39;
&gt;&gt;&gt;&gt;     libpth=/usr/local/lib /usr/lib
&gt;&gt;&gt;&gt;     libs=-ldbm -ldl -lm -lc
&gt;&gt;&gt;&gt;     perllibs=-ldl -lm -lc
&gt;&gt;&gt;&gt;     libc=/usr/lib/libc.dylib, so=dylib, useshrplib=true,
&gt;&gt;&gt;&gt; libperl=libperl.dylib
&gt;&gt;&gt;&gt;     gnulibc_version=&#39;&#39;
&gt;&gt;&gt;&gt;   Dynamic Linking:
&gt;&gt;&gt;&gt;     dlsrc=dl_dlopen.xs, dlext=bundle, d_dlsymun=undef,  
&gt;&gt;&gt;&gt; ccdlflags=&#39; &#39;
&gt;&gt;&gt;&gt;     cccdlflags=&#39; &#39;, lddlflags=&#39;-bundle -undefined dynamic_lookup
&gt;&gt;&gt;&gt; -L/usr/local/lib&#39;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt; Characteristics of this binary &#40;from libperl&#41;:
&gt;&gt;&gt;&gt;   Compile-time options: MULTIPLICITY USE_ITHREADS USE_LARGE_FILES
&gt;&gt;&gt;&gt; PERL_IMPLICIT_CONTEXT
&gt;&gt;&gt;&gt;   Locally applied patches:
&gt;&gt;&gt;&gt;         23953 - fix for File::Path::rmtree CAN-2004-0452 security
&gt;&gt;&gt;&gt; issue
&gt;&gt;&gt;&gt;         33990 - fix for setuid perl security issues
&gt;&gt;&gt;&gt;         fix for regcomp CVE-2007-5116 security vulnerability
&gt;&gt;&gt;&gt;         SPRINTF0 - fixes for sprintf formatting issues -
&gt;&gt;&gt;&gt; CVE-2005-3962
&gt;&gt;&gt;&gt;   Built under darwin
&gt;&gt;&gt;&gt;   Compiled at Nov 26 2007 09:16:22
&gt;&gt;&gt;&gt;   %ENV:
&gt;&gt;&gt;&gt;     PERL5LIB=&#34;/sw/lib/perl5:/sw/lib/perl5/darwin&#34;
&gt;&gt;&gt;&gt;   @INC:
&gt;&gt;&gt;&gt;     /sw/lib/perl5/5.8.6/darwin-thread-multi-2level
&gt;&gt;&gt;&gt;     /sw/lib/perl5/5.8.6
&gt;&gt;&gt;&gt;     /sw/lib/perl5/darwin-thread-multi-2level
&gt;&gt;&gt;&gt;     /sw/lib/perl5
&gt;&gt;&gt;&gt;     /sw/lib/perl5/darwin
&gt;&gt;&gt;&gt;     /System/Library/Perl/5.8.6/darwin-thread-multi-2level
&gt;&gt;&gt;&gt;     /System/Library/Perl/5.8.6
&gt;&gt;&gt;&gt;     /Library/Perl/5.8.6/darwin-thread-multi-2level
&gt;&gt;&gt;&gt;     /Library/Perl/5.8.6
&gt;&gt;&gt;&gt;     /Library/Perl
&gt;&gt;&gt;&gt;     /Network/Library/Perl/5.8.6/darwin-thread-multi-2level
&gt;&gt;&gt;&gt;     /Network/Library/Perl/5.8.6
&gt;&gt;&gt;&gt;     /Network/Library/Perl
&gt;&gt;&gt;&gt;     /System/Library/Perl/Extras/5.8.6/darwin-thread-multi-2level
&gt;&gt;&gt;&gt;     /System/Library/Perl/Extras/5.8.6
&gt;&gt;&gt;&gt;     /Library/Perl/5.8.1
&gt;&gt;&gt;&gt;
&gt;&gt;&gt;&gt;
</div></div>&gt;&gt;
&gt;&gt;
&gt;&gt;
</div>&gt;
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;16&nbsp;00:35:50&nbsp;2008</span>
    <span class="description">adamkennedybackup [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #35917] charsets.t eats all available VM</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 16 May 2008 14:29:43 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PPI [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Adam Kennedy &lt;adamkennedybackup [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">That is completely nuts...

Fortunately &#40;from an avoidance point of view&#41; we don&#39;t allow unicode in 
words, so at least we can play the &#34;not supported&#34; card.

I wonder if we could actually fix this by using a regex with a preset 
pos&#40;&#41; instead of an open-ended substr.

Adam K

Chris Dolan via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: PPI
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=35917">http://rt.cpan.org/Ticket/Display.html?id=35917</a></span> &gt;
&gt;
&gt; I&#39;ve got it nailed.  It&#39;s only triggered in a very, very specific  
&gt; case &#40;Unicode in PPI::Token::Word on last line of the source file&#41;  
&gt; and only affects pre-5.8.8 &#40;not sure about 5.8.7 -- I don&#39;t have a  
&gt; build of that version to test&#41;.  I just committed a SKIP for the  
&gt; offending test if &#34;require 5.008007&#34; fails.  It&#39;s a small miracle  
&gt; that we even had a test that would trigger this bug.  The only reason  
&gt; it started manifesting in PPI v1.203 is because of this change in  
&gt; PPI::Token::Word:
&gt;     <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/diff?from=PPI-1.201&#38;to=PPI-1.203&#38;w=1#lib/">http://search.cpan.org/diff?from=PPI-1.201&#38;to=PPI-1.203&#38;w=1#lib/</a></span> 
&gt; PPI/Token/Word.pm
&gt;
&gt; This is a nearly-minimal program that triggers the bug.
&gt;
&gt; #!/usr/bin/perl
&gt; use utf8;
&gt; my $s = &#39;一&#40;&#41;;&#39;;
&gt; my $line = $s . &#39;!&#39;;
&gt; substr&#40;$line, 1&#41;;
&gt; print substr&#40;$line, 1, 1&#41;, &#34;\n&#34;;
&gt;
&gt;
&gt; Notes:
&gt;   * The BOM is not relevant.  The bug manifests with or without
&gt;   * There must be at least three characters after the Chinese glyph.   
&gt; If less than three, the bug does not manifest
&gt;   * There must be at least one additional character concatenated to  
&gt; the string
&gt;   * The open ended substr must precede the 1 character substr.
&gt;
&gt; Wow.
&gt;
&gt; Chris
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;16&nbsp;01:00:11&nbsp;2008</span>
    <span class="description">chris [...] chrisdolan.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #35917] charsets.t eats all available VM</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 15 May 2008 23:59:40 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PPI [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Chris Dolan &lt;chris [...] chrisdolan.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Adam,

I thought of something like that &#40;although I thought of a less  
elegant solution of inserting N &#34;.&#34; characters at the start of the  
regex&#41;.  But, neither solution solves the problem &#40;I just tested  
now&#41;.  We could hack the test case by removing the trailing &#34;;&#34;  
character -- that does work and buries the problem  
successfully.  :-/  Unless we can find a better workaround in  
Word.pm, I prefer to leave it broken and just skip the test on known- 
bad Perl versions.

I wrote about this in my journal:
   <span class="clickylink"><a target="new" rel="nofollow" href="http://use.perl.org/~ChrisDolan/journal/36438">http://use.perl.org/~ChrisDolan/journal/36438</a></span>

Thank you, Chris L., for providing such an entertaining distraction  
for this evening.  To think, I had planned on getting actual work  
done.  :-&#41;

Chris


On May 15, 2008, at 11:35 PM, Adam Kennedy via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt;        Queue: PPI
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=35917">http://rt.cpan.org/Ticket/Display.html?id=35917</a></span> &gt;
&gt;
&gt; That is completely nuts...
&gt;
&gt; Fortunately &#40;from an avoidance point of view&#41; we don&#39;t allow  
&gt; unicode in
&gt; words, so at least we can play the &#34;not supported&#34; card.
&gt;
&gt; I wonder if we could actually fix this by using a regex with a preset
&gt; pos&#40;&#41; instead of an open-ended substr.
&gt;
&gt; Adam K
&gt;
&gt; Chris Dolan via RT wrote:
<div class="message-stanza open">&gt;&gt;        Queue: PPI
&gt;&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=35917">http://rt.cpan.org/Ticket/Display.html?id=35917</a></span> &gt;
&gt;&gt;
&gt;&gt; I&#39;ve got it nailed.  It&#39;s only triggered in a very, very specific
&gt;&gt; case &#40;Unicode in PPI::Token::Word on last line of the source file&#41;
&gt;&gt; and only affects pre-5.8.8 &#40;not sure about 5.8.7 -- I don&#39;t have a
&gt;&gt; build of that version to test&#41;.  I just committed a SKIP for the
&gt;&gt; offending test if &#34;require 5.008007&#34; fails.  It&#39;s a small miracle
&gt;&gt; that we even had a test that would trigger this bug.  The only reason
&gt;&gt; it started manifesting in PPI v1.203 is because of this change in
&gt;&gt; PPI::Token::Word:
&gt;&gt;     <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/diff?from=PPI-1.201&#38;to=PPI-1.203&#38;w=1#lib/">http://search.cpan.org/diff?from=PPI-1.201&#38;to=PPI-1.203&#38;w=1#lib/</a></span>
&gt;&gt; PPI/Token/Word.pm
&gt;&gt;
&gt;&gt; This is a nearly-minimal program that triggers the bug.
&gt;&gt;
&gt;&gt; #!/usr/bin/perl
&gt;&gt; use utf8;
&gt;&gt; my $s = &#39;一&#40;&#41;;&#39;;
&gt;&gt; my $line = $s . &#39;!&#39;;
&gt;&gt; substr&#40;$line, 1&#41;;
&gt;&gt; print substr&#40;$line, 1, 1&#41;, &#34;\n&#34;;
&gt;&gt;
&gt;&gt;
&gt;&gt; Notes:
&gt;&gt;   * The BOM is not relevant.  The bug manifests with or without
&gt;&gt;   * There must be at least three characters after the Chinese glyph.
&gt;&gt; If less than three, the bug does not manifest
&gt;&gt;   * There must be at least one additional character concatenated to
&gt;&gt; the string
&gt;&gt;   * The open ended substr must precede the 1 character substr.
&gt;&gt;
&gt;&gt; Wow.
&gt;&gt;
&gt;&gt; Chris
</div>&gt;
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;16&nbsp;02:29:52&nbsp;2008</span>
    <span class="description">adamkennedybackup [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #35917] charsets.t eats all available VM</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 16 May 2008 16:24:03 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PPI [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Adam Kennedy &lt;adamkennedybackup [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The other alternative, if the unicode ends up in a ::Word, is to add a 
check to the Word parser somewhere that checks to make sure that there 
are no non-ascii elements &#40;since there shouldn&#39;t be...&#41;.

Or we have the tokenizer, during it&#39;s pre-parse check for invalid 
characters, refuse to parse anything with non-ascii unless the Perl 
version is 5.8.7 or newer &#40;I like this option more, as there&#39;s no 
per-word cpu penalty&#41;.

Adam K

Chris Dolan via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: PPI
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=35917">http://rt.cpan.org/Ticket/Display.html?id=35917</a></span> &gt;
&gt;
&gt; Adam,
&gt;
&gt; I thought of something like that &#40;although I thought of a less  
&gt; elegant solution of inserting N &#34;.&#34; characters at the start of the  
&gt; regex&#41;.  But, neither solution solves the problem &#40;I just tested  
&gt; now&#41;.  We could hack the test case by removing the trailing &#34;;&#34;  
&gt; character -- that does work and buries the problem  
&gt; successfully.  :-/  Unless we can find a better workaround in  
&gt; Word.pm, I prefer to leave it broken and just skip the test on known- 
&gt; bad Perl versions.
&gt;
&gt; I wrote about this in my journal:
&gt;    <span class="clickylink"><a target="new" rel="nofollow" href="http://use.perl.org/~ChrisDolan/journal/36438">http://use.perl.org/~ChrisDolan/journal/36438</a></span>
&gt;
&gt; Thank you, Chris L., for providing such an entertaining distraction  
&gt; for this evening.  To think, I had planned on getting actual work  
&gt; done.  :-&#41;
&gt;
&gt; Chris
&gt;
&gt;
&gt; On May 15, 2008, at 11:35 PM, Adam Kennedy via RT wrote:
&gt;   
<div class="message-stanza open">&gt;&gt;        Queue: PPI
&gt;&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=35917">http://rt.cpan.org/Ticket/Display.html?id=35917</a></span> &gt;
&gt;&gt;
&gt;&gt; That is completely nuts...
&gt;&gt;
&gt;&gt; Fortunately &#40;from an avoidance point of view&#41; we don&#39;t allow  
&gt;&gt; unicode in
&gt;&gt; words, so at least we can play the &#34;not supported&#34; card.
&gt;&gt;
&gt;&gt; I wonder if we could actually fix this by using a regex with a preset
&gt;&gt; pos&#40;&#41; instead of an open-ended substr.
&gt;&gt;
&gt;&gt; Adam K
&gt;&gt;
&gt;&gt; Chris Dolan via RT wrote:
&gt;&gt;     
<div class="message-stanza open">&gt;&gt;&gt;        Queue: PPI
&gt;&gt;&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=35917">http://rt.cpan.org/Ticket/Display.html?id=35917</a></span> &gt;
&gt;&gt;&gt;
&gt;&gt;&gt; I&#39;ve got it nailed.  It&#39;s only triggered in a very, very specific
&gt;&gt;&gt; case &#40;Unicode in PPI::Token::Word on last line of the source file&#41;
&gt;&gt;&gt; and only affects pre-5.8.8 &#40;not sure about 5.8.7 -- I don&#39;t have a
&gt;&gt;&gt; build of that version to test&#41;.  I just committed a SKIP for the
&gt;&gt;&gt; offending test if &#34;require 5.008007&#34; fails.  It&#39;s a small miracle
&gt;&gt;&gt; that we even had a test that would trigger this bug.  The only reason
&gt;&gt;&gt; it started manifesting in PPI v1.203 is because of this change in
&gt;&gt;&gt; PPI::Token::Word:
&gt;&gt;&gt;     <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/diff?from=PPI-1.201&#38;to=PPI-1.203&#38;w=1#lib/">http://search.cpan.org/diff?from=PPI-1.201&#38;to=PPI-1.203&#38;w=1#lib/</a></span>
&gt;&gt;&gt; PPI/Token/Word.pm
&gt;&gt;&gt;
&gt;&gt;&gt; This is a nearly-minimal program that triggers the bug.
&gt;&gt;&gt;
&gt;&gt;&gt; #!/usr/bin/perl
&gt;&gt;&gt; use utf8;
&gt;&gt;&gt; my $s = &#39;一&#40;&#41;;&#39;;
&gt;&gt;&gt; my $line = $s . &#39;!&#39;;
&gt;&gt;&gt; substr&#40;$line, 1&#41;;
&gt;&gt;&gt; print substr&#40;$line, 1, 1&#41;, &#34;\n&#34;;
&gt;&gt;&gt;
&gt;&gt;&gt;
&gt;&gt;&gt; Notes:
&gt;&gt;&gt;   * The BOM is not relevant.  The bug manifests with or without
&gt;&gt;&gt;   * There must be at least three characters after the Chinese glyph.
&gt;&gt;&gt; If less than three, the bug does not manifest
&gt;&gt;&gt;   * There must be at least one additional character concatenated to
&gt;&gt;&gt; the string
&gt;&gt;&gt;   * The open ended substr must precede the 1 character substr.
&gt;&gt;&gt;
&gt;&gt;&gt; Wow.
&gt;&gt;&gt;
&gt;&gt;&gt; Chris
&gt;&gt;&gt;       
</div>&gt;&gt;     
</div>&gt;
&gt;
&gt;   
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;10&nbsp;04:17:07&nbsp;2009</span>
    <span class="description">krasnoroot [...] mail.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Still not fixed [rt.cpan.org #35917]</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 10 Jan 2009 14:18:58 +0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PPI [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Alexander Krasnorutsky &lt;krasnoroot [...] mail.ru&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello!

This bug is still not fixed &#40;PPI-1.203&#41;.
Should the workaround &#40;increasing the minimum version of perl required
for running this test&#41; be applied to the version of PPI which available
for download from CPAN?

Best regards
--

Alexander Krasnorutsky.
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;25&nbsp;13:10:35&nbsp;2009</span>
    <span class="description">MIKEWHOO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello! 
 
I&#39;m new to CPAN, but was testing the bug prog above and I think I have 
a fix. It involves utf8.pm: 
 
After package utf8; 
add use Encode; 
 
After sub AUTOLOAD... 
add 
 
sub print { 
    BEGIN { utf8::import&#40;&#41; } 
    return  
        CORE::print &#40;encode&#40;&#39;utf-8&#39;, @_[0]&#41;&#41;; 
} 
 
I still get the wide character warnings, but substr works. 
 
Michael 
 
On Sat Jan 10 04:17:07 2009, krasnoroot@mail.ru wrote: 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hello! 
&gt;  
&gt; This bug is still not fixed &#40;PPI-1.203&#41;. 
&gt; Should the workaround &#40;increasing the minimum version of perl 
</div>required 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; for running this test&#41; be applied to the version of PPI which 
</div>available 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; for download from CPAN? 
&gt;  
&gt; Best regards 
&gt; -- 
&gt;  
&gt; Alexander Krasnorutsky. 
</div> 
 
 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;25&nbsp;15:15:39&nbsp;2009</span>
    <span class="description">MIKEWHOO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Opps, spoke a little soon. Those mods failed but this works: 
 
#!/usr/bin/perl 
 use utf8; 
 use Encode; # encode is the fix! 
  
 my $s = &#39;一&#40;&#41;;&#39;; 
 my $line = $s . &#39;!&#39;; 
 print encode&#40;&#39;utf-8&#39;, $line&#41;.&#34;\n&#34;; 
 substr&#40;$line, 1&#41;; 
 $line = substr&#40;$line, 1, 0&#41;;  
 print encode&#40;&#39;utf-8&#39;,$line&#41;.&#34;\n&#34;;  
 print encode&#40;&#39;utf-8&#39;,substr&#40;$line, 0, 1&#41;&#41;.&#34;\n&#34;;  
 print encode&#40;&#39;utf-8&#39;,substr&#40;$line, 1, 1&#41;&#41;.&#34;\n&#34;;  
 
result: 
一&#40;&#41;;! 
&#40;&#41;; 
&#40; 
&#41; 
 
I&#39;m on perl 5.8.5. 
 
Adding this sub to utf8.pm also works, removing the need to have encode 
in the prog above: 
 
sub print { 
    BEGIN { utf8::import&#40;&#41; } 
    return  
        CORE::print &#40;Encode::encode&#40;&#39;utf-8&#39;, $_[0]&#41;&#41;; 
} 
 
Although I am sure I am not implimenting print correctly. 
 
Anyway, I hope this helps. 
 
Michael 
 
On Mon May 25 13:10:35 2009, MIKEWHOO wrote: 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hello!  
&gt;   
&gt; I&#39;m new to CPAN, but was testing the bug prog above and I think I 
</div>have  
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; a fix. It involves utf8.pm:  
&gt;   
&gt; After package utf8;  
&gt; add use Encode;  
&gt;   
&gt; After sub AUTOLOAD...  
&gt; add  
&gt;   
&gt; sub print {  
&gt;     BEGIN { utf8::import&#40;&#41; }  
&gt;     return   
&gt;       CORE::print &#40;encode&#40;&#39;utf-8&#39;, @_[0]&#41;&#41;;  
&gt; }  
&gt;   
&gt; I still get the wide character warnings, but substr works.  
&gt;   
&gt; Michael  
&gt;   
&gt; On Sat Jan 10 04:17:07 2009, krasnoroot@mail.ru wrote:  
<div class="message-stanza open">&gt; &gt; Hello!  
&gt; &gt;   
&gt; &gt; This bug is still not fixed &#40;PPI-1.203&#41;.  
&gt; &gt; Should the workaround &#40;increasing the minimum version of perl  
</div>&gt; required  
<div class="message-stanza open">&gt; &gt; for running this test&#41; be applied to the version of PPI which  
</div>&gt; available  
<div class="message-stanza open">&gt; &gt; for download from CPAN?  
&gt; &gt;   
&gt; &gt; Best regards  
&gt; &gt; --  
&gt; &gt;   
&gt; &gt; Alexander Krasnorutsky.  
</div>&gt;   
&gt;   
&gt;   
</div> 
 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;12&nbsp;08:19:59&nbsp;2014</span>
    <span class="description">MITHALDU [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This was fixed by a patch to t/14_charsets.t
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;12&nbsp;08:20:00&nbsp;2014</span>
    <span class="description">MITHALDU [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
