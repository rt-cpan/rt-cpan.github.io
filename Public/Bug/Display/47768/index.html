<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #47768 for Digest-SHA: Performance compared to Digest::SHA1</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #47768 for Digest-SHA: Performance compared to Digest::SHA1</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Digest-SHA/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Digest-SHA/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Digest-SHA/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Digest-SHA/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Digest-SHA">Digest-SHA CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">47768</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="time worked">
    <td class="label">Worked:</td>
    <td class="value">25 min

</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Digest-SHA/Active/">Digest-SHA</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
justincase [...] yopmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-11544-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-11545-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;10&nbsp;06:00:27&nbsp;2009</span>
    <span class="description">justincase [...] yopmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Performance compared to Digest::SHA1</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">For generating sha1 digests, I&#39;ve preferred using Digest::SHA over
Digest::SHA1 because it had more recent updates and is more
comprehensive. But gisle recently updated Digest::SHA, so I performed a
benchmark and found Digest::SHA to be less than half as fast:

                        Rate   Digest::SHA::sha Digest::SHA1::sha1
Digest::SHA::sha    412559/s                 --               -60%
Digest::SHA1::sha1 1037900/s               152%                 --

----
use strict;
use warnings;
use Digest::SHA &#40;&#41;;
use Digest::SHA1 &#40;&#41;;
use Benchmark qw&#40;cmpthese&#41;;

my $key = 1234567890;

cmpthese -1, {
    &#39;Digest::SHA::sha&#39;   =&gt; sub { Digest::SHA::sha1&#40;$key&#41; },
    &#39;Digest::SHA1::sha1&#39; =&gt; sub { Digest::SHA1::sha1&#40;$key&#41; },
}
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;10&nbsp;10:11:04&nbsp;2009</span>
    <span class="description">mshelor [...] cpan.org -  Correspondence added</span>
    <span class="time-taken">10 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">My experience does not agree with yours: Digest::SHA is still
considerably faster that Digest::SHA1 on all my platforms.  For example,
here are the results on Intel/Linux using Gisle&#39;s benchmark code:

$ digest-bench Digest::SHA1
419bd6d3ee9022c4c9e221494d757b737bc274f5
33554432/1.64555287361145
Digest::SHA1 2.12       19.45 MB/s

$ digest-bench Digest::SHA
419bd6d3ee9022c4c9e221494d757b737bc274f5
33554432/0.341594934463501
Digest::SHA 5.47        93.68 MB/s

The difference is even more dramatic on an old Mac/PPC.

So, for the time being, I&#39;m rejecting this bug.  I take performance very
seriously, and strive to make the code as fast as possible within
portability limits.  If you can supply any more evidence to support your
case, I&#39;ll be happy to work with you.

Regards, Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;10&nbsp;10:11:05&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;10&nbsp;10:11:08&nbsp;2009</span>
    <span class="description">mshelor [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;12&nbsp;13:36:17&nbsp;2009</span>
    <span class="description">justincase [...] yopmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Jul 10 10:11:04 2009, MSHELOR wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; My experience does not agree with yours: Digest::SHA is still
&gt; considerably faster that Digest::SHA1 on all my platforms.  For example,
&gt; here are the results on Intel/Linux using Gisle&#39;s benchmark code:
&gt; 
&gt; $ digest-bench Digest::SHA1
&gt; 419bd6d3ee9022c4c9e221494d757b737bc274f5
&gt; 33554432/1.64555287361145
&gt; Digest::SHA1 2.12       19.45 MB/s
&gt; 
&gt; $ digest-bench Digest::SHA
&gt; 419bd6d3ee9022c4c9e221494d757b737bc274f5
&gt; 33554432/0.341594934463501
&gt; Digest::SHA 5.47        93.68 MB/s
&gt; 
&gt; The difference is even more dramatic on an old Mac/PPC.
&gt; 
&gt; So, for the time being, I&#39;m rejecting this bug.  I take performance very
&gt; seriously, and strive to make the code as fast as possible within
&gt; portability limits.  If you can supply any more evidence to support your
&gt; case, I&#39;ll be happy to work with you.
&gt; 
&gt; Regards, Mark
</div>
The benchmark you used creates a single digest and measure the
throughput on a large piece of data. My benchmark repeatedly creates
digests on smaller pieces of data, which is probably just as common a
use case &#40;think passwords&#41;. Digest::SHA1 seems to be more efficient in
this case.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;12&nbsp;13:36:19&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;12&nbsp;19:11:32&nbsp;2009</span>
    <span class="description">mshelor [...] cpan.org -  Correspondence added</span>
    <span class="time-taken">15 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Gisle crafted his benchmark to use large data sets because that is the
only case where relative digest performance is significant or even
detectable.  The time taken to compute the digest of a small password is
not noticeable, and is almost certainly smaller than the margin of
timing error.

So, even if the use-case of small inputs is far more common, it doesn&#39;t
matter: the performance issue isn&#39;t particularly relevant in that case,
and wouldn&#39;t likely vary much from implementation to implementation, or
even from algorithm to algorithm.

That said, the Digest::SHA module still appears to be faster than
Digest::SHA1, even on small inputs.  Here&#39;s the result I get using your
benchmark code on Intel/Linux:

                       Rate Digest::SHA1::sha1   Digest::SHA::sha
Digest::SHA1::sha1 164549/s                 --               -36%
Digest::SHA::sha   258306/s                57%                 --

Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;12&nbsp;19:11:37&nbsp;2009</span>
    <span class="description">mshelor [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;12&nbsp;12:04:57&nbsp;2013</span>
    <span class="description">victor [...] vsespb.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ubuntu 10.04 64bit Core i7-2600 &#40;Sandy Bridge&#41;
Digest::SHA 5.80
Digest::SHA1 2.13
gcc version 4.4.3 &#40;Ubuntu 4.4.3-4ubuntu5.1&#41;

== For small files Digest::SHA1 is much faster

use strict;
use warnings;
use Digest::SHA &#40;&#41;;
use Digest::SHA1 &#40;&#41;;
use Benchmark qw&#40;cmpthese&#41;; 
my $key = 1234567890;
cmpthese -1, {
&#39;Digest::SHA::sha&#39; =&gt; sub { Digest::SHA::sha1&#40;$key&#41; },
&#39;Digest::SHA1::sha1&#39; =&gt; sub { Digest::SHA1::sha1&#40;$key&#41; },
}


                        Rate   Digest::SHA::sha Digest::SHA1::sha1
Digest::SHA::sha    811471/s                 --               -62%
Digest::SHA1::sha1 2123852/s               162%                 --

== For big files &#40;i.e. more than 1kb&#41; Digest::SHA is faster

use strict;
use warnings;
use Digest::SHA &#40;&#41;;
use Digest::SHA1 &#40;&#41;;
use Benchmark qw&#40;cmpthese&#41;; 
my $key = &#39;x&#39; x &#40;1024*1024*100&#41;;
cmpthese -1, {
&#39;Digest::SHA::sha&#39; =&gt; sub { Digest::SHA::sha1&#40;$key&#41; },
&#39;Digest::SHA1::sha1&#39; =&gt; sub { Digest::SHA1::sha1&#40;$key&#41; },
}

            &#40;warning: too few iterations for a reliable count&#41;
                     Rate Digest::SHA1::sha1   Digest::SHA::sha
Digest::SHA1::sha1 2.27/s                 --               -27%
Digest::SHA::sha   3.12/s                38%                 --


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The time taken to compute the digest of a small password is not
</div>noticeable, and is almost certainly smaller than the margin of timing
error. 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; the performance issue isn&#39;t particularly relevant in that case,
</div>
Not always

1&#41; In case we write code like this

cmpthese -1, {
&#39;Digest::SHA::sha&#39; =&gt; sub { Digest::SHA::sha1&#40;$key&#41; for &#40;1..100&#41; },
&#39;Digest::SHA1::sha1&#39; =&gt; sub { Digest::SHA1::sha1&#40;$key&#41; for &#40;1..100&#41; },
}

there should be any timing error

2&#41; Performance on small inputs is important for example
a&#41; if you generate things like Rainbow tables when writing security
applications.
b&#41; Real example - I had to do _integration_ &#40;regression&#41; test for Tree
Hash based on SHA256 &#40;CPAN Net::Amazon::TreeHash&#41;, so I used small
chunks like ~ 10 bytes,
and this test is slower part of my testsuite. Most time consumed in SHA266.




On Mon Jul 13 03:11:32 2009, MSHELOR wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Gisle crafted his benchmark to use large data sets because that is the
&gt; only case where relative digest performance is significant or even
&gt; detectable.  The time taken to compute the digest of a small password is
&gt; not noticeable, and is almost certainly smaller than the margin of
&gt; timing error.
&gt; 
&gt; So, even if the use-case of small inputs is far more common, it doesn&#39;t
&gt; matter: the performance issue isn&#39;t particularly relevant in that case,
&gt; and wouldn&#39;t likely vary much from implementation to implementation, or
&gt; even from algorithm to algorithm.
&gt; 
&gt; That said, the Digest::SHA module still appears to be faster than
&gt; Digest::SHA1, even on small inputs.  Here&#39;s the result I get using your
&gt; benchmark code on Intel/Linux:
&gt; 
&gt;                        Rate Digest::SHA1::sha1   Digest::SHA::sha
&gt; Digest::SHA1::sha1 164549/s                 --               -36%
&gt; Digest::SHA::sha   258306/s                57%                 --
&gt; 
&gt; Mark
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;12&nbsp;12:04:58&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;13&nbsp;13:39:25&nbsp;2013</span>
    <span class="description">victor [...] vsespb.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Also another observation:

1&#41; Digest::SHA slower than Digest::SHA1 on small inputs
2&#41; Digest::SHA faster than Digest::SHA1 on large inputs

So I might suggest that Digest::SHA initialization time is something
that can be improved.

That will be good, because Amazon AWS Glacier now uses &#39;TreeHash&#39;
algorithm that requires calculation of SHA256 for each 1 MiB chunk.

So to calculate TreeHash for 1 GB of data need 1000 initializations, and
for 1TB need one million..


On Sat Jan 12 21:04:57 2013, vsespb wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Ubuntu 10.04 64bit Core i7-2600 &#40;Sandy Bridge&#41;
&gt; Digest::SHA 5.80
&gt; Digest::SHA1 2.13
&gt; gcc version 4.4.3 &#40;Ubuntu 4.4.3-4ubuntu5.1&#41;
&gt; 
&gt; == For small files Digest::SHA1 is much faster
&gt; 
&gt; use strict;
&gt; use warnings;
&gt; use Digest::SHA &#40;&#41;;
&gt; use Digest::SHA1 &#40;&#41;;
&gt; use Benchmark qw&#40;cmpthese&#41;; 
&gt; my $key = 1234567890;
&gt; cmpthese -1, {
&gt; &#39;Digest::SHA::sha&#39; =&gt; sub { Digest::SHA::sha1&#40;$key&#41; },
&gt; &#39;Digest::SHA1::sha1&#39; =&gt; sub { Digest::SHA1::sha1&#40;$key&#41; },
&gt; }
&gt; 
&gt; 
&gt;                         Rate   Digest::SHA::sha Digest::SHA1::sha1
&gt; Digest::SHA::sha    811471/s                 --               -62%
&gt; Digest::SHA1::sha1 2123852/s               162%                 --
&gt; 
&gt; == For big files &#40;i.e. more than 1kb&#41; Digest::SHA is faster
&gt; 
&gt; use strict;
&gt; use warnings;
&gt; use Digest::SHA &#40;&#41;;
&gt; use Digest::SHA1 &#40;&#41;;
&gt; use Benchmark qw&#40;cmpthese&#41;; 
&gt; my $key = &#39;x&#39; x &#40;1024*1024*100&#41;;
&gt; cmpthese -1, {
&gt; &#39;Digest::SHA::sha&#39; =&gt; sub { Digest::SHA::sha1&#40;$key&#41; },
&gt; &#39;Digest::SHA1::sha1&#39; =&gt; sub { Digest::SHA1::sha1&#40;$key&#41; },
&gt; }
&gt; 
&gt;             &#40;warning: too few iterations for a reliable count&#41;
&gt;                      Rate Digest::SHA1::sha1   Digest::SHA::sha
&gt; Digest::SHA1::sha1 2.27/s                 --               -27%
&gt; Digest::SHA::sha   3.12/s                38%                 --
&gt; 
&gt; 
<div class="message-stanza open">&gt; &gt; The time taken to compute the digest of a small password is not
</div>&gt; noticeable, and is almost certainly smaller than the margin of timing
&gt; error. 
<div class="message-stanza open">&gt; &gt; the performance issue isn&#39;t particularly relevant in that case,
</div>&gt; 
&gt; Not always
&gt; 
&gt; 1&#41; In case we write code like this
&gt; 
&gt; cmpthese -1, {
&gt; &#39;Digest::SHA::sha&#39; =&gt; sub { Digest::SHA::sha1&#40;$key&#41; for &#40;1..100&#41; },
&gt; &#39;Digest::SHA1::sha1&#39; =&gt; sub { Digest::SHA1::sha1&#40;$key&#41; for &#40;1..100&#41; },
&gt; }
&gt; 
&gt; there should be any timing error
&gt; 
&gt; 2&#41; Performance on small inputs is important for example
&gt; a&#41; if you generate things like Rainbow tables when writing security
&gt; applications.
&gt; b&#41; Real example - I had to do _integration_ &#40;regression&#41; test for Tree
&gt; Hash based on SHA256 &#40;CPAN Net::Amazon::TreeHash&#41;, so I used small
&gt; chunks like ~ 10 bytes,
&gt; and this test is slower part of my testsuite. Most time consumed in
</div>SHA266.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; 
&gt; 
&gt; 
&gt; On Mon Jul 13 03:11:32 2009, MSHELOR wrote:
<div class="message-stanza open">&gt; &gt; Gisle crafted his benchmark to use large data sets because that is the
&gt; &gt; only case where relative digest performance is significant or even
&gt; &gt; detectable.  The time taken to compute the digest of a small password is
&gt; &gt; not noticeable, and is almost certainly smaller than the margin of
&gt; &gt; timing error.
&gt; &gt; 
&gt; &gt; So, even if the use-case of small inputs is far more common, it doesn&#39;t
&gt; &gt; matter: the performance issue isn&#39;t particularly relevant in that case,
&gt; &gt; and wouldn&#39;t likely vary much from implementation to implementation, or
&gt; &gt; even from algorithm to algorithm.
&gt; &gt; 
&gt; &gt; That said, the Digest::SHA module still appears to be faster than
&gt; &gt; Digest::SHA1, even on small inputs.  Here&#39;s the result I get using your
&gt; &gt; benchmark code on Intel/Linux:
&gt; &gt; 
&gt; &gt;                        Rate Digest::SHA1::sha1   Digest::SHA::sha
&gt; &gt; Digest::SHA1::sha1 164549/s                 --               -36%
&gt; &gt; Digest::SHA::sha   258306/s                57%                 --
&gt; &gt; 
&gt; &gt; Mark
</div>&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;13&nbsp;20:39:47&nbsp;2013</span>
    <span class="description">mshelor [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Jan 13 13:39:25 2013, vsespb wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Also another observation:
&gt; 
&gt; 1&#41; Digest::SHA slower than Digest::SHA1 on small inputs
&gt; 2&#41; Digest::SHA faster than Digest::SHA1 on large inputs
&gt; 
&gt; So I might suggest that Digest::SHA initialization time is something
&gt; that can be improved.
</div>

There are many many instances of the statement &#34;Module A is faster than
Module B on platform X using compiler Y with data Z.&#34;  When changes are
made to improve performance in one particular instance, it runs the risk
of damaging performance in other instances.

Since you&#39;re using &#39;gcc&#39;, try applying the &#39;-O1 -fomit-frame-pointer&#39;
options.  I currently restrict these to &#39;i[3456]86&#39; platforms but they
might improve your situation as well.  Once you&#39;ve more thoroughly
analyzed the situation and can suggest specific patches &#40;whether they be
in initialization, transform functions, compiler settings, etc&#41;, I&#39;ll be
happy to consider integrating them into Digest::SHA.

Regards, Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;13&nbsp;20:39:47&nbsp;2013</span>
    <span class="description">mshelor [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;14&nbsp;05:48:00&nbsp;2013</span>
    <span class="description">victor [...] vsespb.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jan 14 05:39:47 2013, MSHELOR wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sun Jan 13 13:39:25 2013, vsespb wrote:
<div class="message-stanza open">&gt; &gt; Also another observation:
&gt; &gt; 
&gt; &gt; 1&#41; Digest::SHA slower than Digest::SHA1 on small inputs
&gt; &gt; 2&#41; Digest::SHA faster than Digest::SHA1 on large inputs
&gt; &gt; 
&gt; &gt; So I might suggest that Digest::SHA initialization time is something
&gt; &gt; that can be improved.
</div>&gt; 
&gt; 
&gt; There are many many instances of the statement &#34;Module A is faster than
&gt; Module B on platform X using compiler Y with data Z.&#34;  When changes are
&gt; made to improve performance in one particular instance, it runs the risk
&gt; of damaging performance in other instances.
&gt; 
&gt; Since you&#39;re using &#39;gcc&#39;, try applying the &#39;-O1 -fomit-frame-pointer&#39;
&gt; options.  I currently restrict these to &#39;i[3456]86&#39; platforms but they
&gt; might improve your situation as well.  Once you&#39;ve more thoroughly
&gt; analyzed the situation and can suggest specific patches &#40;whether they be
&gt; in initialization, transform functions, compiler settings, etc&#41;, I&#39;ll be
&gt; happy to consider integrating them into Digest::SHA.
&gt; 
&gt; Regards, Mark
</div>
Ok, thanks.

I tried -O1 -fomit-frame-pointer

for small input
I&#39;ve got 8727/s instead of 8219/s
and Digest::SHA1::sha1 is still 147% faster

I understood that you need a patch, so as I don&#39;t have it, leave in
rejected state for now.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;14&nbsp;05:48:01&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;14&nbsp;07:08:45&nbsp;2013</span>
    <span class="description">mshelor [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
