<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #33125 for Nagios-Object: Nagios 3.x support for Nagios::StatusLog</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #33125 for Nagios-Object: Nagios 3.x support for Nagios::StatusLog</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Nagios-Object">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Nagios-Object">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Nagios-Object">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Nagios-Object">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Nagios-Object">Nagios-Object CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">33125</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Nagios-Object">Nagios-Object</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">duncan_j_ferguson [...] yahoo.co.uk
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
mgagne [...] generationphp.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-22188-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-22189-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




StatusLog.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/455672/224017/StatusLog.diff">
Tue Apr 29 10:26:29 2008 (6.1k) by TOMDAAE [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=33125">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-420304" href="/Public/Bug/Display.html?id=33125#txn-420304">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;11&nbsp;14:16:40&nbsp;2008</span>
    <span class="description">mgagne [...] generationphp.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Nagios 3.x support for Nagios::StatusLog</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 11 Feb 2008 14:16:16 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Nagios-Object [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mathieu GagnÃ© &lt;mgagne [...] generationphp.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/420304/205340/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/205340">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

I&#39;m using Nagios::StatusLog in some scripts for my daily tasks. I&#39;m 
testing Nagios3 and found that Nagios::StatusLog is not compatible with it.

My Perl knowledges is limited for now and I don&#39;t know how to adapt your 
module to the new Nagios version.

I can however provide some informations about the difference between 
Nagios2 and Nagios3 in status.dat

Would it be possible to consider adding support for Nagios3?

------------

Differences for host status:

Block renamed from &#34;host&#34; to &#34;hoststatus&#34;.

Added status properties for &#34;hoststatus&#34;:

check_interval
check_options
check_period
current_event_id
current_notification_id
current_problem_id
last_event_id
last_problem_id
long_plugin_output
notification_period
retry_interval

------------

Differences for service status:

Block renamed from &#34;service&#34; to &#34;servicestatus&#34;.

Added status properties for &#34;servicestatus&#34;:

check_interval
check_options
check_period
current_event_id
current_notification_id
current_problem_id
last_event_id
last_problem_id
long_plugin_output
notification_period
retry_interval

------------

Differences for program status:

Block renamed from &#34;program&#34; to &#34;programstatus&#34;:

Added status properties for &#34;programstatus&#34;:

active_ondemand_host_check_stats
active_ondemand_service_check_stats
active_scheduled_host_check_stats
active_scheduled_service_check_stats
cached_host_check_stats
cached_service_check_stats
external_command_stats
high_external_command_buffer_slots
next_comment_id
next_downtime_id
next_event_id
next_notification_id
next_problem_id
parallel_host_check_stats
passive_host_check_stats
passive_service_check_stats
serial_host_check_stats
total_external_command_buffer_slots
used_external_command_buffer_slots

------------

Thanks for your time.

Best regards,

--
Mathieu GagnÃ©
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-455672" href="/Public/Bug/Display.html?id=33125#txn-455672">#</a>      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;29&nbsp;10:26:27&nbsp;2008</span>
    <span class="description">TOMDAAE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/455672/224014/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/224014">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 992b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve managed to fix compatibility for Nagios v3 by editing the code in
the  StatusLog.pm file. There are more differences between the v2 and v3
status-files than the original requestor describes though, but I hope
I&#39;ve covered them all in this patch.

I don&#39;t consider this code to be very pretty, nor does it implement
functions for all the changes that have been made to the statuslog file,
but it will at the very least make the Nagios::Object module compatible
with Nagios v3 statuslogs.

What you need to do to apply this patch &#40;the attached file&#41;, is run the
command:

patch StatusLog.pm StatusLog.diff

&#40;on linux, at least. I&#39;m afraid I don&#39;t know any equivalent windows
programs&#41; in the directory /share/perl5/vendor_perl/5.8.8/Nagios/ or
wherever your installation has placed the Nagios::Object modules.


I&#39;ll try to check back here once in a while to see if you&#39;re having
problems using this patch.


With kind regards

Tom Daae
UNIX Systems Operator
The University of Oslo, Norway
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/455672/224017/StatusLog.diff">Download StatusLog.diff</a><br />
<span class="downloadcontenttype">text/x-diff 6.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">32a33
&gt;             check_interval check_options check_period current_event_id current_notification_id current_problem_id last_event_id last_problem_id long_plugin_output notification_period retry_interval
37a39
&gt;             check_interval check_options check_period current_event_id current_notification_id current_problem_id last_event_id last_problem_id long_plugin_output notification_period retry_interval
42a45
&gt;             active_ondemand_host_check_stats active_ondemand_service_check_stats active_scheduled_host_check_stats active_scheduled_service_check_stats cached_host_check_stats cached_service_check_stats external_command_stats high_external_command_buffer_slots next_comment_id next_downtime_id next_event_id next_notification_id next_problem_id parallel_host_check_stats passive_host_check_stats passive_service_check_stats serial_host_check_stats total_external_command_buffer_slots used_external_command_buffer_slots
44c47,62
&lt;         Info =&gt; [qw&#40; created version &#41;]
---
&gt;         Contact =&gt; [qw&#40;
&gt;             contact_name modified_attributes modified_host_attributes modified_service_attributes host_notification_period service_notification_period last_host_notification last_service_notification host_notifications_enabled service_notifications_enabled
&gt;         &#41;],
&gt;         Servicecomment =&gt; [qw&#40;
&gt;             host_name service_description entry_type comment_id source persistent entry_time expires expire_time author comment_data
&gt;         &#41;],
&gt;         Hostcomment =&gt; [qw&#40;
&gt;             host_name entry_type comment_id source persistent entry_time expires expire_time author comment_data
&gt;         &#41;],
&gt;         Servicedowntime =&gt; [qw&#40;
&gt;              host_name service_description downtime_id entry_time start_time end_time triggered_by fixed duration author comment
&gt;         &#41;],
&gt;         Hostdowntime =&gt; [qw&#40;
&gt;              host_name downtime_id entry_time start_time end_time triggered_by fixed duration author comment
&gt;         &#41;],
&gt;         Info =&gt; [qw&#40; created version  &#41;]
77c95,96
&lt; pass in the Version =&gt; 2.0 parameter to new&#40;&#41;.
---
&gt; pass in the Version =&gt; 2.0 parameter to new&#40;&#41;. And similarly, pass in the
&gt; Version =&gt; 3.0 parameter to new&#40;&#41; for Nagios version 3.x logs.
93a113,118
&gt;  # for Nagios v3.0
&gt;  my $log = Nagios::StatusLog-&gt;new&#40;
&gt;                 Filename =&gt; &#34;/var/opt/nagios/status.dat&#34;,
&gt;                 Version  =&gt; 3.0
&gt;            &#41;;
&gt; 
128,133c153,163
&lt;         LOGFILE =&gt; $logfile,
&lt;         VERSION =&gt; $version,
&lt;         INFO    =&gt; {},
&lt;         PROGRAM =&gt; {},
&lt;         HOST    =&gt; {},
&lt;         SERVICE =&gt; {}
---
&gt;         LOGFILE         =&gt; $logfile,
&gt;         VERSION         =&gt; $version,
&gt;         INFO            =&gt; {},
&gt; 	CONTACT         =&gt; {},
&gt;         PROGRAM         =&gt; {},
&gt;         HOST            =&gt; {},
&gt;         HOSTCOMMENT     =&gt; {},
&gt;         HOSTDOWNTIME    =&gt; {},
&gt;         SERVICE         =&gt; {},
&gt;         SERVICECOMMENT  =&gt; {},
&gt;         SERVICEDOWNTIME =&gt; {}
149c179,181
&lt;     if &#40; $self-&gt;{VERSION} &gt;= 2 &#41; {
---
&gt;     if &#40; $self-&gt;{VERSION} &gt;= 3 &#41; {
&gt;         return $self-&gt;update_v3&#40; @_ &#41;;
&gt;     } elsif &#40; $self-&gt;{VERSION} &gt;= 2 &#38;&#38; $self-&gt;{VERSION} &lt; 3 &#41; {
302a335,425
&gt; sub update_v3 &#40;$&#41; {
&gt;     my $self = shift;
&gt; 
&gt;     # be compatible with StatusLog which makes sure that references
&gt;     # held in client code remain valid during update &#40;also prevents
&gt;     # some memory leaks&#41;
&gt;     sub _copy3 {
&gt;         my&#40; $from, $to &#41; = @_;
&gt;         foreach my $key &#40; keys %$from &#41; {
&gt;             $to-&gt;{$key} = $from-&gt;{$key};
&gt;         }
&gt;     }
&gt; 
&gt;     my %handlers = &#40;
&gt;         hoststatus =&gt; sub {
&gt;             my $item = shift;
&gt;             my $host = $item-&gt;{host_name};
&gt;             if &#40; !exists $self-&gt;{HOST}{$host} &#41; {
&gt;                 $self-&gt;{HOST}{$host} = {};
&gt;             }
&gt;             _copy3&#40; $item, $self-&gt;{HOST}{$host} &#41;;
&gt;         },
&gt;         servicestatus =&gt; sub {
&gt;             my $item = shift;
&gt;             my $host = $item-&gt;{host_name};
&gt;             my $svc  = $item-&gt;{service_description};
&gt; 
&gt;             if &#40; !exists $self-&gt;{SERVICE}{$host}{$svc} &#41; {
&gt;                 $self-&gt;{SERVICE}{$host}{$svc} = {};
&gt;             }
&gt;             _copy3&#40; $item, $self-&gt;{SERVICE}{$host}{$svc} &#41;;
&gt;         },
&gt;         info =&gt; sub {
&gt;             _copy3&#40; shift, $self-&gt;{INFO} &#41;;
&gt;         },
&gt;         programstatus =&gt; sub {
&gt;             _copy3&#40; shift, $self-&gt;{PROGRAM} &#41;;
&gt;         },
&gt;         contactstatus =&gt; sub {
&gt;             _copy3&#40; shift, $self-&gt;{CONTACT} &#41;;
&gt;         },
&gt;         servicecomment =&gt; sub {
&gt;             _copy3&#40; shift, $self-&gt;{SERVICECOMMENT} &#41;;
&gt;         },
&gt;         hostcomment =&gt; sub {
&gt;             _copy3&#40; shift, $self-&gt;{HOSTCOMMENT} &#41;;
&gt;         },
&gt;         servicedowntime =&gt; sub {
&gt;             _copy3&#40; shift, $self-&gt;{SERVICEDOWNTIME} &#41;;
&gt;         },
&gt;         hostdowntime =&gt; sub {
&gt;             _copy3&#40; shift, $self-&gt;{HOSTDOWNTIME} &#41;;
&gt;         }
&gt; 
&gt;     &#41;;
&gt; 
&gt;     my $log_fh = gensym;
&gt;     open&#40; $log_fh, &#34;&lt;$self-&gt;{LOGFILE}&#34; &#41;
&gt;         || croak &#34;could not open file $self-&gt;{LOGFILE} for reading: $!&#34;;
&gt; 
&gt;     # change the first line of the RE to this:
&gt;     # &#40;info|programstatus|hoststatus|servicestatus|contactstatus|servicecomment|hostcomment|servicedowntime|hostdowntime&#41; \s* {&#40;
&gt;     # to make it a bit more careful, but it has a measurable cost on runtime
&gt;     my $entry_re = qr/
&gt;         # capture the type into $1
&gt;         &#40;\w+&#41; \s*
&gt;         # capture all of the text between the brackets into $2
&gt;         {&#40; .*? &#41;}
&gt;         # match the last bracket only if followed by another definition
&gt;         &#40;?=&#40;?: \s* &#40;?:info|programstatus|hoststatus|servicestatus|contacstatus|servicecomment|hostcomment|servicedowntime|hostdowntime&#41; \s* { | \Z&#41; &#41;
&gt;         # capture remaining text &#40;1-2 lines&#41; into $3 for re-processing
&gt;         &#40;.*&#41;$
&gt;     /xs;
&gt; 
&gt;     my $entry = &#39;&#39;;
&gt;     while &#40; my $line = &lt;$log_fh&gt; &#41; {
&gt;         next if &#40; $line =~ /^\s*#/ &#41;;
&gt;         $entry .= $line;
&gt;         if &#40; $entry =~ m/$entry_re/ &#41; {
&gt;             &#40; my $type, my $text, $entry &#41; = &#40; $1, $2, $3 &#41;;
&gt;             $text =~ s/[\r\n]+\s*/\n/g; # clean up whitespace and newlines
&gt;             my %item = map { split /\s*=\s*/, $_, 2 } split /\n/, $text;
&gt;             $handlers{$type}-&gt;&#40; \%item &#41;;
&gt;         }
&gt;     }
&gt; 
&gt;     close&#40; $log_fh &#41;;
&gt; 
&gt;     1;
&gt; }
&gt; 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-455673" href="/Public/Bug/Display.html?id=33125#txn-455673">#</a>      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;29&nbsp;10:26:33&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-455944" href="/Public/Bug/Display.html?id=33125#txn-455944">#</a>      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;29&nbsp;23:33:52&nbsp;2008</span>
    <span class="description">mgagne [...] generationphp.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #33125] Nagios 3.x support for Nagios::StatusLog</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 29 Apr 2008 23:33:32 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Nagios-Object [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mathieu GagnÃ© &lt;mgagne [...] generationphp.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/455944/224167/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/224167">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

Your patch is working fine and I&#39;m able to parse a Nagios3&#39;s status.dat 
without problem. Thanks a lot.

I find out later that there was more differences than I though between 
the version 2 and version 3. :-/

Mathieu

Tom Daae via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=33125">http://rt.cpan.org/Ticket/Display.html?id=33125</a></span> &gt;
&gt; 
&gt; I&#39;ve managed to fix compatibility for Nagios v3 by editing the code in
&gt; the  StatusLog.pm file. There are more differences between the v2 and v3
&gt; status-files than the original requestor describes though, but I hope
&gt; I&#39;ve covered them all in this patch.
&gt; 
&gt; I don&#39;t consider this code to be very pretty, nor does it implement
&gt; functions for all the changes that have been made to the statuslog file,
&gt; but it will at the very least make the Nagios::Object module compatible
&gt; with Nagios v3 statuslogs.
&gt; 
&gt; What you need to do to apply this patch &#40;the attached file&#41;, is run the
&gt; command:
&gt; 
&gt; patch StatusLog.pm StatusLog.diff
&gt; 
&gt; &#40;on linux, at least. I&#39;m afraid I don&#39;t know any equivalent windows
&gt; programs&#41; in the directory /share/perl5/vendor_perl/5.8.8/Nagios/ or
&gt; wherever your installation has placed the Nagios::Object modules.
&gt; 
&gt; 
&gt; I&#39;ll try to check back here once in a while to see if you&#39;re having
&gt; problems using this patch.
&gt; 
&gt; 
&gt; With kind regards
&gt; 
&gt; Tom Daae
&gt; UNIX Systems Operator
&gt; The University of Oslo, Norway
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-562398" href="/Public/Bug/Display.html?id=33125#txn-562398">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;02&nbsp;11:47:41&nbsp;2009</span>
    <span class="description">duncan_j_ferguson [...] yahoo.co.uk -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-562406" href="/Public/Bug/Display.html?id=33125#txn-562406">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;02&nbsp;11:49:07&nbsp;2009</span>
    <span class="description">duncan_j_ferguson [...] yahoo.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/562406/283997/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/283997">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 339b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Feb 11 14:16:40 2008, mgagne@generationphp.net wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m using Nagios::StatusLog in some scripts for my daily tasks. I&#39;m 
&gt; testing Nagios3 and found that Nagios::StatusLog is not compatible
</div>with it.

Please try the latest version from CPAN &#40;0.21.2&#41; and reopen this ticket
if it doesn&#39;t work correctly for you.

Thanks

  Duncs
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-562409" href="/Public/Bug/Display.html?id=33125#txn-562409">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;02&nbsp;11:49:08&nbsp;2009</span>
    <span class="description">duncan_j_ferguson [...] yahoo.co.uk -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.41528</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
