<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #104106 for MooseX-Storage: collapse handler being called for a non-object</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #104106 for MooseX-Storage: collapse handler being called for a non-object</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=MooseX-Storage">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=MooseX-Storage">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=MooseX-Storage">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=MooseX-Storage">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/MooseX-Storage">MooseX-Storage CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">104106</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=MooseX-Storage">MooseX-Storage</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
todd.bruner [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-43368-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-43369-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.50    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=104106">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1491953" href="/Public/Bug/Display.html?id=104106#txn-1491953">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;29&nbsp;17:32:49&nbsp;2015</span>
    <span class="description">todd.bruner [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Confess message</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 29 Apr 2015 15:32:21 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-MooseX-Storage [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Todd Bruner &lt;todd.bruner [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1491953/794494/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/794494">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 875b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m using David Golden&#39;s Meerkat to create objects and store them in a
MongoDB.
My code works without complaint on my development system.  The
MooseX::Storage version is 0.48 and Meerkat is 0.10 on my dev box.
On my production box, &#40;MooseX::Storage 0.49 and Meerkat 0.10&#41; I get the
following message when I execute this code:

Package MyApp::Collection::Foo;
use Moose 2;
extends &#39;Meerkat::Collection&#39;;

sub create_obj {
    my $self = shift;
    my $href = shift;
    return $self-&gt;create&#40;$href&#41;;
}
1;

Object &#40;1&#41; does not have a &#38;pack method, cannot collapse at
/usr/local/share/perl/5.18.2/MooseX/Storage/Engine.pm line 207.
...stack trace omitted...

The object is created, so this isn&#39;t critical, but the confess stack trace
is annoying.  What do I need to do differently in 0.49 to quiet this
confess?

thanks,
Todd
------------------------------
todd.bruner@gmail.com
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1491953/794495/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/794495">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.2k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1491974" href="/Public/Bug/Display.html?id=104106#txn-1491974">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;29&nbsp;20:00:44&nbsp;2015</span>
    <span class="description">ether [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1491974/794508/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/794508">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2015-04-29 14:32:49, toddbruner wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m using David Golden&#39;s Meerkat to create objects and store them in a
&gt; MongoDB.
&gt; My code works without complaint on my development system.  The
&gt; MooseX::Storage version is 0.48 and Meerkat is 0.10 on my dev box.
&gt; On my production box, &#40;MooseX::Storage 0.49 and Meerkat 0.10&#41; I get the
&gt; following message when I execute this code:
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Object &#40;1&#41; does not have a &#38;pack method, cannot collapse at
&gt; /usr/local/share/perl/5.18.2/MooseX/Storage/Engine.pm line 207.
&gt; ...stack trace omitted...
&gt; 
&gt; The object is created, so this isn&#39;t critical, but the confess stack trace
&gt; is annoying.  What do I need to do differently in 0.49 to quiet this
&gt; confess?
</div>
I&#39;m not sure what Meerkat is doing with its serializers, but the bit of code that you&#39;re hitting &#40;the collapse handler at line 207&#41; should only be getting called for blessed objects. However, the $obj being printed in the error message doesn&#39;t look like it&#39;s blessed.

Can you try editing MooseX::Storage::Engine to include a Data::Dumper of the $obj in the confess message?
And being able to see the full stack trace &#40;that you omitted above&#41; would be quite helpful here too.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1491975" href="/Public/Bug/Display.html?id=104106#txn-1491975">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;29&nbsp;20:00:45&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1491978" href="/Public/Bug/Display.html?id=104106#txn-1491978">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;29&nbsp;20:02:13&nbsp;2015</span>
    <span class="description">ether [...] cpan.org -  Subject changed from &#39;Confess message&#39; to &#39;collapse handler being called for a non-object&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1492286" href="/Public/Bug/Display.html?id=104106#txn-1492286">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;30&nbsp;12:19:30&nbsp;2015</span>
    <span class="description">todd.bruner [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #104106] Confess message</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 30 Apr 2015 10:18:46 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-moosex-storage &lt;bug-MooseX-Storage [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Todd Bruner &lt;todd.bruner [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1492286/794685/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/794685">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Karen:

Thank you for looking into this and creating this PM.  Here&#39;s the dump of
the object as requested and the full stack trace.

MyApp::Collection::System is a subclass of Meerkat::Collection.  Let me
know if you have any questions or I can perform an additional tests.

Todd

Object &#40;1&#41; does not have a &#38;pack method, cannot collapse$VAR1 = bless&#40;
do{\&#40;my $o = 1&#41;}, &#39;JSON::PP::Boolean&#39; &#41;;
 at /usr/local/share/perl/5.18.2/MooseX/Storage/Engine.pm line 208.
MooseX::Storage::Engine::__ANON__&#40;JSON::PP::Boolean=SCALAR&#40;0x4ff0f68&#41;,
HASH&#40;0x4d047e8&#41;&#41; called at
/usr/local/share/perl/5.18.2/MooseX/Storage/Engine.pm line 280
MooseX::Storage::Engine::__ANON__&#40;HASH&#40;0x647a530&#41;, HASH&#40;0x4d047e8&#41;&#41; called
at /usr/local/share/perl/5.18.2/MooseX/Storage/Engine.pm line 249
MooseX::Storage::Engine::__ANON__&#40;ARRAY&#40;0x660f9a0&#41;, HASH&#40;0x4d047e8&#41;&#41; called
at /usr/local/share/perl/5.18.2/MooseX/Storage/Engine.pm line 91
MooseX::Storage::Engine::collapse_attribute_value&#40;MooseX::Storage::Engine=HASH&#40;0x685fca0&#41;,
Moose::Meta::Class::__ANON__::SERIAL::5=HASH&#40;0x6772df8&#41;, HASH&#40;0x4d047e8&#41;&#41;
called at /usr/local/share/perl/5.18.2/MooseX/Storage/Engine.pm line 61
MooseX::Storage::Engine::collapse_attribute&#40;MooseX::Storage::Engine=HASH&#40;0x685fca0&#41;,
Moose::Meta::Class::__ANON__::SERIAL::5=HASH&#40;0x6772df8&#41;, HASH&#40;0x4d047e8&#41;&#41;
called at /usr/local/share/perl/5.18.2/MooseX/Storage/Engine.pm line 144
MooseX::Storage::Engine::map_attributes&#40;MooseX::Storage::Engine=HASH&#40;0x685fca0&#41;,
&#34;collapse_attribute&#34;, HASH&#40;0x4d047e8&#41;&#41; called at
/usr/local/share/perl/5.18.2/MooseX/Storage/Engine.pm line 38
MooseX::Storage::Engine::collapse_object&#40;MooseX::Storage::Engine=HASH&#40;0x685fca0&#41;&#41;
called at /usr/local/share/perl/5.18.2/MooseX/Storage/Basic.pm line 12
MooseX::Storage::Basic::pack&#40;MyApp::Model::System=HASH&#40;0x685fda8&#41;&#41; called
at /usr/local/share/perl/5.18.2/Meerkat/Collection.pm line 327
Meerkat::Collection::_save&#40;MyApp::Collection::System=HASH&#40;0x666e898&#41;,
MyApp::Model::System=HASH&#40;0x685fda8&#41;&#41; called at
../lib/MyApp/Collection/System.pm line 18
MyApp::Collection::System::__ANON__&#40;MyApp::Collection::System=HASH&#40;0x666e898&#41;,
HASH&#40;0x63b1be8&#41;&#41; called at
/usr/local/lib/perl/5.18.2/Moose/Meta/Method/Overridden.pm line 38
MyApp::Collection::System::create&#40;MyApp::Collection::System=HASH&#40;0x666e898&#41;,
HASH&#40;0x63b1be8&#41;&#41; called at ../lib/MyApp/Collection/System.pm line 58
MyApp::Collection::System::create_from_hopper&#40;MyApp::Collection::System=HASH&#40;0x666e898&#41;,
HASH&#40;0x6669078&#41;&#41; called at ../lib/MyApp/Controller/Hopper.pm line 195
MyApp::Controller::Hopper::update_system&#40;MyApp::Controller::Hopper=HASH&#40;0x1683158&#41;,
231058, HASH&#40;0x6669078&#41;&#41; called at ../lib/MyApp/Controller/Hopper.pm line
145
MyApp::Controller::Hopper::run&#40;MyApp::Controller::Hopper=HASH&#40;0x1683158&#41;,
HASH&#40;0x1683278&#41;&#41; called at ./get_foo_updates.pl line 10


------------------------------
todd.bruner@gmail.com

On Wed, Apr 29, 2015 at 6:00 PM, Karen Etheridge via RT &lt;
bug-MooseX-Storage@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=104106">https://rt.cpan.org/Ticket/Display.html?id=104106</a></span> &gt;
&gt;
&gt; On 2015-04-29 14:32:49, toddbruner wrote:
<div class="message-stanza open">&gt; &gt; I&#39;m using David Golden&#39;s Meerkat to create objects and store them in a
&gt; &gt; MongoDB.
&gt; &gt; My code works without complaint on my development system.  The
&gt; &gt; MooseX::Storage version is 0.48 and Meerkat is 0.10 on my dev box.
&gt; &gt; On my production box, &#40;MooseX::Storage 0.49 and Meerkat 0.10&#41; I get the
&gt; &gt; following message when I execute this code:
</div>&gt;
<div class="message-stanza open">&gt; &gt; Object &#40;1&#41; does not have a &#38;pack method, cannot collapse at
&gt; &gt; /usr/local/share/perl/5.18.2/MooseX/Storage/Engine.pm line 207.
&gt; &gt; ...stack trace omitted...
&gt; &gt;
&gt; &gt; The object is created, so this isn&#39;t critical, but the confess stack
</div>&gt; trace
<div class="message-stanza open">&gt; &gt; is annoying.  What do I need to do differently in 0.49 to quiet this
&gt; &gt; confess?
</div>&gt;
&gt; I&#39;m not sure what Meerkat is doing with its serializers, but the bit of
&gt; code that you&#39;re hitting &#40;the collapse handler at line 207&#41; should only be
&gt; getting called for blessed objects. However, the $obj being printed in the
&gt; error message doesn&#39;t look like it&#39;s blessed.
&gt;
&gt; Can you try editing MooseX::Storage::Engine to include a Data::Dumper of
&gt; the $obj in the confess message?
&gt; And being able to see the full stack trace &#40;that you omitted above&#41; would
&gt; be quite helpful here too.
&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1492286/794686/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/794686">with headers</a>
<br />
<span class="downloadcontenttype">text/html 5.1k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1493450" href="/Public/Bug/Display.html?id=104106#txn-1493450">#</a>      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;04&nbsp;19:48:39&nbsp;2015</span>
    <span class="description">ether [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1493450/795403/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/795403">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2015-04-30 09:19:30, toddbruner wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Karen:
&gt; 
&gt; Thank you for looking into this and creating this PM.  Here&#39;s the dump
&gt; of
&gt; the object as requested and the full stack trace.
&gt; 
&gt; MyApp::Collection::System is a subclass of Meerkat::Collection.  Let
&gt; me
&gt; know if you have any questions or I can perform an additional tests.
</div>
Without knowing the details of how you constructed your Meerkat::Collection
object, I cannot reproduce this to run under either 0.48 or 0.49.

However, this error is critically important:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Object &#40;1&#41; does not have a &#38;pack method, cannot collapse$VAR1 = bless&#40;
&gt; do{\&#40;my $o = 1&#41;}, &#39;JSON::PP::Boolean&#39; &#41;;
</div>
It shows that MooseX::Storage doesn&#39;t know how to serialize/deserialize
JSON::PP::Boolean objects - because it hasn&#39;t been instructed how.

While constructing a test case to see how arrayrefs of JSON::PP::Booleans
are handled, I found a bug in the 0.49 changes, but I don&#39;t think that this
fix will directly help you &#40;as the problem is only in new deep expansion code that was added in 0.49.&#41;

Can you send me the Moose type definition of the object you are attempting to
serialize, ideally simplified down to just a few attributes?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1493782" href="/Public/Bug/Display.html?id=104106#txn-1493782">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;05&nbsp;16:13:21&nbsp;2015</span>
    <span class="description">ether [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1493782/795586/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/795586">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2015-05-04 16:48:39, ETHER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2015-04-30 09:19:30, toddbruner wrote:
<div class="message-stanza open">&gt; &gt; Karen:
&gt; &gt;
&gt; &gt; Thank you for looking into this and creating this PM.  Here&#39;s the
&gt; &gt; dump
&gt; &gt; of
&gt; &gt; the object as requested and the full stack trace.
&gt; &gt;
&gt; &gt; MyApp::Collection::System is a subclass of Meerkat::Collection.  Let
&gt; &gt; me
&gt; &gt; know if you have any questions or I can perform an additional tests.
</div>&gt; 
&gt; Without knowing the details of how you constructed your
&gt; Meerkat::Collection
&gt; object, I cannot reproduce this to run under either 0.48 or 0.49.
&gt; 
&gt; However, this error is critically important:
&gt; 
<div class="message-stanza open">&gt; &gt; Object &#40;1&#41; does not have a &#38;pack method, cannot collapse$VAR1 =
&gt; &gt; bless&#40;
&gt; &gt; do{\&#40;my $o = 1&#41;}, &#39;JSON::PP::Boolean&#39; &#41;;
</div>&gt; 
&gt; It shows that MooseX::Storage doesn&#39;t know how to
&gt; serialize/deserialize
&gt; JSON::PP::Boolean objects - because it hasn&#39;t been instructed how.
</div>
You can instruct the engine to pack/unpack these objects thusly:

I suspect that previously &#40;in version 0.48&#41; you were simply getting the numified form of the JSON booleans &#40;i.e. 1 or 0&#41; after packing-&gt;unpacking, so you still had a lossy translation, but this didn&#39;t break your application.

I&#39;ve reverted the deep pack/unpack changes in the new 0.50 release, so you should be back to where you were before in 0.48.  However any reproduction cases that you can provide will still be helpful, as we do want to re-introduce the deep packing/unpacking feature later on, when we can be sure it works properly.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1493803" href="/Public/Bug/Display.html?id=104106#txn-1493803">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;05&nbsp;17:43:06&nbsp;2015</span>
    <span class="description">todd.bruner [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #104106] collapse handler being called for a non-object</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 5 May 2015 15:42:35 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-moosex-storage &lt;bug-MooseX-Storage [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Todd Bruner &lt;todd.bruner [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1493803/795608/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/795608">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I think that you are correct.  The app was building an href from a the
result of a JSON webservice.  Upon dumping the href I can see that some of
the values are JSON::Boolean::false.  Interestingly enough, I really don&#39;t
care about those key/values and wasn&#39;t using them.  The lossy-ness was not
noticed, but welcome! :-&#41;

I&#39;ve been trying to create a mini-example to recreate the problem without
much success.  I&#39;m going to keep trying and will send you the example if I
can reproduce.  I won&#39;t update to 0.5 until I can reproduce.

As for my application, I will explicitly remove those key/value pairs in
the future.

Thank you again for looking into this and for creating this module.

Todd

------------------------------
todd.bruner@gmail.com

On Tue, May 5, 2015 at 2:13 PM, Karen Etheridge via RT &lt;
bug-MooseX-Storage@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=104106">https://rt.cpan.org/Ticket/Display.html?id=104106</a></span> &gt;
&gt;
&gt; On 2015-05-04 16:48:39, ETHER wrote:
<div class="message-stanza open">&gt; &gt; On 2015-04-30 09:19:30, toddbruner wrote:
<div class="message-stanza open">&gt; &gt; &gt; Karen:
&gt; &gt; &gt;
&gt; &gt; &gt; Thank you for looking into this and creating this PM.  Here&#39;s the
&gt; &gt; &gt; dump
&gt; &gt; &gt; of
&gt; &gt; &gt; the object as requested and the full stack trace.
&gt; &gt; &gt;
&gt; &gt; &gt; MyApp::Collection::System is a subclass of Meerkat::Collection.  Let
&gt; &gt; &gt; me
&gt; &gt; &gt; know if you have any questions or I can perform an additional tests.
</div>&gt; &gt;
&gt; &gt; Without knowing the details of how you constructed your
&gt; &gt; Meerkat::Collection
&gt; &gt; object, I cannot reproduce this to run under either 0.48 or 0.49.
&gt; &gt;
&gt; &gt; However, this error is critically important:
&gt; &gt;
<div class="message-stanza open">&gt; &gt; &gt; Object &#40;1&#41; does not have a &#38;pack method, cannot collapse$VAR1 =
&gt; &gt; &gt; bless&#40;
&gt; &gt; &gt; do{\&#40;my $o = 1&#41;}, &#39;JSON::PP::Boolean&#39; &#41;;
</div>&gt; &gt;
&gt; &gt; It shows that MooseX::Storage doesn&#39;t know how to
&gt; &gt; serialize/deserialize
&gt; &gt; JSON::PP::Boolean objects - because it hasn&#39;t been instructed how.
</div>&gt;
&gt; You can instruct the engine to pack/unpack these objects thusly:
&gt;
&gt; I suspect that previously &#40;in version 0.48&#41; you were simply getting the
&gt; numified form of the JSON booleans &#40;i.e. 1 or 0&#41; after packing-&gt;unpacking,
&gt; so you still had a lossy translation, but this didn&#39;t break your
&gt; application.
&gt;
&gt; I&#39;ve reverted the deep pack/unpack changes in the new 0.50 release, so you
&gt; should be back to where you were before in 0.48.  However any reproduction
&gt; cases that you can provide will still be helpful, as we do want to
&gt; re-introduce the deep packing/unpacking feature later on, when we can be
&gt; sure it works properly.
&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1493803/795609/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/795609">with headers</a>
<br />
<span class="downloadcontenttype">text/html 3.2k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1500413" href="/Public/Bug/Display.html?id=104106#txn-1500413">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;26&nbsp;13:21:49&nbsp;2015</span>
    <span class="description">ether [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1500413/799421/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/799421">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 225b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">For anyone else who is reading this ticket - it is my understanding that 0.50 fixes all outstanding issues noted here. Please advise immediately if this is not the case - it is NOT my intention to be shipping broken software.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1500416" href="/Public/Bug/Display.html?id=104106#txn-1500416">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;26&nbsp;13:21:51&nbsp;2015</span>
    <span class="description">ether [...] cpan.org -  Fixed in 0.50 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1504313" href="/Public/Bug/Display.html?id=104106#txn-1504313">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;05&nbsp;14:29:54&nbsp;2015</span>
    <span class="description">ether [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1504313/801656/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/801656">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 42b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Please re-open if there is still an issue.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1504316" href="/Public/Bug/Display.html?id=104106#txn-1504316">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;05&nbsp;14:30:00&nbsp;2015</span>
    <span class="description">ether [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.57502</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
