<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #27187 for Win32: t/Unicode.t failures under Cygwin</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #27187 for Win32: t/Unicode.t failures under Cygwin</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Win32/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Win32/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Win32/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Win32/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Win32">Win32 CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">27187</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Win32/Active/">Win32</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
jdhedden [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-42710-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.29    </td>
  </tr>
  <tr id="CF-42711-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.31    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;18&nbsp;08:45:29&nbsp;2007</span>
    <span class="description">jdhedden [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> t/Unicode.t failures under Cygwin</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">t/Unicode.t fails on &#39;make test&#39; under Cygwin:

Win32-0.29 &gt; make test
cp Win32.pm blib/lib/Win32.pm
/usr/bin/perl.exe /usr/lib/perl5/5.9/ExtUtils/xsubpp  -typemap
/usr/lib/perl5/5.9/ExtUtils/typemap  Win32.xs &gt; Win32.xsc &#38;&#38; mv
Win32.xsc Win32.c
gcc -c   -DPERL_USE_SAFE_PUTENV -U__STRICT_ANSI__ -DNO_MATHOMS
-fno-strict-aliasing -pipe -DUSEIMPORTLIB -O3 -pipe -funit-at-a-time
-mtune=pentium4m -march=pentium4 -mfpmath=sse -mieee-fp -mmmx -msse
-msse2   -DVERSION=\&#34;0.29\&#34; -DXS_VERSION=\&#34;0.29\&#34; 
&#34;-I/usr/lib/perl5/5.9/cygwin/CORE&#34;   Win32.c
Running Mkbootstrap for Win32 &#40;&#41;
chmod 644 Win32.bs
rm -f blib/arch/auto/Win32/Win32.dll
/usr/bin/ld2  -s -L/usr/local/lib Win32.o  -o
blib/arch/auto/Win32/Win32.dll   \
          /usr/lib/perl5/5.9/cygwin/CORE/libperl.dll.a -L/lib/w32api
-lole32 -lversion          \

gcc -shared -o  Win32.dll -Wl,--out-implib=libWin32.dll.a
-Wl,--export-all-symbols -Wl,--enable-auto-import -Wl,--stack,8388608
-Wl,--enable-auto-image-base \
-s -L/usr/local/lib Win32.o 
/usr/lib/perl5/5.9/cygwin/CORE/libperl.dll.a -L/lib/w32api -lole32 -lversion
Creating library file: libWin32.dll.a
mv Win32.dll libWin32.dll.a blib/arch/auto/Win32/
chmod 755 blib/arch/auto/Win32/Win32.dll
cp Win32.bs blib/arch/auto/Win32/Win32.bs
chmod 644 blib/arch/auto/Win32/Win32.bs
/usr/bin/perl.exe &#34;-MExtUtils::Command::MM&#34; &#34;-e&#34; &#34;test_harness&#40;0,
&#39;blib/lib&#39;, &#39;blib/arch&#39;&#41;&#34; t/*.t
t/CreateFile..................ok
t/ExpandEnvironmentStrings....ok
t/GetCurrentThreadId..........skipped
        all skipped: Test requires fork emulation
t/GetFileVersion..............skipped
        all skipped: Only ActivePerl seems to set the perl.exe fileversion
t/GetFolderPath...............ok
t/GetFullPathName.............ok
t/GetLongPathName.............ok
t/GetOSVersion................ok
t/GuidGen.....................ok
t/Unicode.....................# Failed test 1 in t/Unicode.t at line 41
#  t/Unicode.t line 41 is: ok&#40;-d Win32::GetANSIPathName&#40;$dir&#41;&#41;;
# Failed test 2 in t/Unicode.t at line 45
t/Unicode.....................NOK 1/12#  t/Unicode.t line 45 is: ok&#40;-f
Win32::GetANSIPathName&#40;$file&#41;&#41;;
# Failed test 3 in t/Unicode.t at line 48
#  t/Unicode.t line 48 is: ok&#40;opendir&#40;my $dh,
Win32::GetANSIPathName&#40;$dir&#41;&#41;&#41;;
readdir&#40;&#41; attempted on invalid dirhandle $dh at t/Unicode.t line 49.
closedir&#40;&#41; attempted on invalid dirhandle $dh at t/Unicode.t line 53.
# Failed test 5 in t/Unicode.t at line 62
#  t/Unicode.t line 62 is: ok&#40;Win32::SetCwd&#40;$dir&#41;&#41;;
t/Unicode.....................NOK 2/12# Test 6 got:
&#34;E:\\cygwin\\admin\\cpan\\build\\Win32-0.29&#34; &#40;t/Unicode.t at line 63&#41;
t/Unicode.....................NOK 6/12#   Expected:
&#34;E:\\cygwin\\admin\\cpan\\build\\Win32-0.29\\Foo \x{394}\x{419} Bar
\x{5E7}\x{645} Baz&#34;
#  t/Unicode.t line 63 is: ok&#40;Win32::GetLongPathName&#40;Win32::GetCwd&#40;&#41;&#41;,
$long&#41;;
# Test 7 got: &lt;UNDEF&gt; &#40;t/Unicode.t at line 67&#41;
#   Expected: &#34;E:\\cygwin\\admin\\cpan\\build\\Win32-0.29\\Foo
\x{394}\x{419} Bar \x{5E7}\x{645} Baz&#34;
t/Unicode.....................NOK 7/12#  t/Unicode.t line 67 is:
ok&#40;Win32::GetLongPathName&#40;$cwd&#41;, $long&#41;;
# Failed test 10 in t/Unicode.t at line 74
#  t/Unicode.t line 74 is: ok&#40;chdir&#40;Win32::GetANSIPathName&#40;$dir&#41;&#41;&#41;;
# Test 11 got: &#34;E:\\cygwin\\admin\\cpan\\build\\Win32-0.29&#34; &#40;t/Unicode.t
at line 75&#41;
#    Expected: &#34;E:\\cygwin\\admin\\cpan\\build\\Win32-0.29\\Foo
\x{394}\x{419} Bar \x{5E7}\x{645} Baz&#34;
#  t/Unicode.t line 75 is: ok&#40;Win32::GetLongPathName&#40;Win32::GetCwd&#40;&#41;&#41;,
$long&#41;;
t/Unicode.....................FAILED tests 1-3, 5-7, 10-12
        Failed 9/12 tests, 25.00% okay
Failed Test Stat Wstat Total Fail  List of Failed
-------------------------------------------------------------------------------
t/Unicode.t               12    9  1-3 5-7 10-12
2 tests skipped.
Failed 1/10 test scripts. 9/84 subtests failed.
Files=10, Tests=84,  1 wallclock secs &#40; 0.89 cusr +  0.50 csys =  1.39 CPU&#41;
Failed 1/10 test programs. 9/84 subtests failed.
make: *** [test_dynamic] Error 255


Running the test manually produces:

Win32-0.29 &gt; perl -Mblib t/Unicode.t
1..12
# Running under perl version 5.009005 for cygwin
# Current time local: Fri May 18 08:40:24 2007
# Current time GMT:   Fri May 18 12:40:24 2007
# Using Test.pm version 1.25
not ok 1
# Failed test 1 in t/Unicode.t at line 41
#  t/Unicode.t line 41 is: ok&#40;-d Win32::GetANSIPathName&#40;$dir&#41;&#41;;
not ok 2
# Failed test 2 in t/Unicode.t at line 45
#  t/Unicode.t line 45 is: ok&#40;-f Win32::GetANSIPathName&#40;$file&#41;&#41;;
not ok 3
# Failed test 3 in t/Unicode.t at line 48
#  t/Unicode.t line 48 is: ok&#40;opendir&#40;my $dh,
Win32::GetANSIPathName&#40;$dir&#41;&#41;&#41;;
ok 4
not ok 5
# Failed test 5 in t/Unicode.t at line 62
#  t/Unicode.t line 62 is: ok&#40;Win32::SetCwd&#40;$dir&#41;&#41;;
not ok 6
# Test 6 got: &#34;E:\\cygwin\\admin\\cpan\\build\\Win32-0.29&#34; &#40;t/Unicode.t
at line 63&#41;
#   Expected: &#34;E:\\cygwin\\admin\\cpan\\build\\Win32-0.29\\Foo
\x{394}\x{419} Bar \x{5E7}\x{645} Baz&#34;
#  t/Unicode.t line 63 is: ok&#40;Win32::GetLongPathName&#40;Win32::GetCwd&#40;&#41;&#41;,
$long&#41;;
not ok 7
# Test 7 got: &lt;UNDEF&gt; &#40;t/Unicode.t at line 67&#41;
#   Expected: &#34;E:\\cygwin\\admin\\cpan\\build\\Win32-0.29\\Foo
\x{394}\x{419} Bar \x{5E7}\x{645} Baz&#34;
#  t/Unicode.t line 67 is: ok&#40;Win32::GetLongPathName&#40;$cwd&#41;, $long&#41;;
ok 8
ok 9
not ok 10
# Failed test 10 in t/Unicode.t at line 74
#  t/Unicode.t line 74 is: ok&#40;chdir&#40;Win32::GetANSIPathName&#40;$dir&#41;&#41;&#41;;
not ok 11
# Test 11 got: &#34;E:\\cygwin\\admin\\cpan\\build\\Win32-0.29&#34; &#40;t/Unicode.t
at line 75&#41;
#    Expected: &#34;E:\\cygwin\\admin\\cpan\\build\\Win32-0.29\\Foo
\x{394}\x{419} Bar \x{5E7}\x{645} Baz&#34;
#  t/Unicode.t line 75 is: ok&#40;Win32::GetLongPathName&#40;Win32::GetCwd&#40;&#41;&#41;,
$long&#41;;


Note:  I do not compile in a number of extension such as Encode,
Unicode::Normalize, and others &#40;see below&#41;.  If this is the cause, then
the offending tests may need to be conditioned based on available
extensions.

Win32-0.29 &gt; perl -V
Summary of my perl5 &#40;revision 5 version 9 subversion 5 patch 31234&#41;
configuration:
  Platform:
    osname=cygwin, osvers=1.5.24&#40;0.15642&#41;,
archname=cygwin-thread-multi-64int
    uname=&#39;cygwin_nt-5.0 pn100-02-2-054p 1.5.24&#40;0.15642&#41; 2007-01-31
10:57 i686 cygwin &#39;
    config_args=&#39;-de -Dusedevel -Dversiononly=no -Dinstallusrbinperl
-Duse64bitint -Dusethreads -Uusemymalloc -Dnoextensions=attrs IPC/SysV
Sys/Syslog DB_File NDBM_File ODBM_File SDBM_File Devel/DProf Devel/Peek
re XS/APItest XS/Typemap Encode PerlIO/encoding Unicode/Normalize
I18N/Langinfo Text/Soundex Math/BigInt/FastCalc Time/Piece -A
define:optimize=-O3 -pipe -funit-at-a-time -mtune=pentium4m
-march=pentium4 -mfpmath=sse -mieee-fp -mmmx -msse -msse2 -A
define:ld=/usr/bin/ld2 -A append:ccflags= -DNO_MATHOMS&#39;
    hint=recommended, useposix=true, d_sigaction=define
    useithreads=define, usemultiplicity=define
    useperlio=define, d_sfio=undef, uselargefiles=define, usesocks=undef
    use64bitint=define, use64bitall=undef, uselongdouble=undef
    usemymalloc=n, bincompat5005=undef
  Compiler:
    cc=&#39;gcc&#39;, ccflags =&#39;-DPERL_USE_SAFE_PUTENV -U__STRICT_ANSI__
-DNO_MATHOMS -fno-strict-aliasing -pipe&#39;,
    optimize=&#39;-O3 -pipe -funit-at-a-time -mtune=pentium4m
-march=pentium4 -mfpmath=sse -mieee-fp -mmmx -msse -msse2&#39;,
    cppflags=&#39;-DPERL_USE_SAFE_PUTENV -U__STRICT_ANSI__ -DNO_MATHOMS
-fno-strict-aliasing -pipe&#39;
    ccversion=&#39;&#39;, gccversion=&#39;3.4.4 &#40;cygming special, gdc 0.12, using
dmd 0.125&#41;&#39;, gccosandvers=&#39;&#39;
    intsize=4, longsize=4, ptrsize=4, doublesize=8, byteorder=12345678
    d_longlong=define, longlongsize=8, d_longdbl=define, longdblsize=12
    ivtype=&#39;long long&#39;, ivsize=8, nvtype=&#39;double&#39;, nvsize=8,
Off_t=&#39;off_t&#39;, lseeksize=8
    alignbytes=8, prototype=define
  Linker and Libraries:
    ld=&#39;/usr/bin/ld2&#39;, ldflags =&#39; -Wl,--enable-auto-import -s
-L/usr/local/lib&#39;
    libpth=/usr/local/lib /usr/lib /lib
    libs=-lgdbm -ldl -lcrypt -lgdbm_compat
    perllibs=-ldl -lcrypt -lgdbm_compat
    libc=/usr/lib/libc.a, so=dll, useshrplib=true, libperl=libperl.a
    gnulibc_version=&#39;&#39;
  Dynamic Linking:
    dlsrc=dl_dlopen.xs, dlext=dll, d_dlsymun=undef, ccdlflags=&#39; -s&#39;
    cccdlflags=&#39; &#39;, lddlflags=&#39; -s -L/usr/local/lib&#39;


Characteristics of this binary &#40;from libperl&#41;:
  Compile-time options: MULTIPLICITY NO_MATHOMS PERL_DONT_CREATE_GVSV
                        PERL_IMPLICIT_CONTEXT PERL_MALLOC_WRAP
                        PERL_USE_SAFE_PUTENV USE_64_BIT_INT USE_ITHREADS
                        USE_LARGE_FILES USE_PERLIO USE_REENTRANT_API
  Locally applied patches:
        DEVEL
        31234
  Built under cygwin
  Compiled at May 17 2007 08:08:22
  %ENV:
    PERLIO=&#34;perlio&#34;
    CYGWIN=&#34;ntsec&#34;
  @INC:
    /usr/lib/perl5/5.9/cygwin
    /usr/lib/perl5/5.9
    .
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;19&nbsp;11:59:23&nbsp;2007</span>
    <span class="description">jdhedden [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> JDHEDDEN [...] cpan.org</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri May 18 08:45:29 2007, JDHEDDEN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; t/Unicode.t fails on &#39;make test&#39; under Cygwin:
</div>
As posted to p5p, the attached patch causes Unicode.t to be skipped
under Cygwin because it doesn&#39;t support Unicode filename.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- perl-current/ext/Win32/t/Unicode.t.orig	2007-05-19 11:53:26.556875000 -0400
+++ perl-current/ext/Win32/t/Unicode.t	2007-05-19 11:55:27.202125000 -0400
@@ -5,6 +5,10 @@
 use Cwd qw&#40;cwd&#41;;
 
 BEGIN {
+    if &#40;$^O eq &#39;cygwin&#39;&#41; {
+	print &#34;1..0 # Skip: Cygwin doesn&#39;t support Unicode filename\n&#34;;
+	exit 0;
+    }
     unless &#40;defined &#38;Win32::BuildNumber &#38;&#38; Win32::BuildNumber&#40;&#41; &gt;= 820 or $] &gt;= 5.008009&#41; {
 	print &#34;1..0 # Skip: Needs ActivePerl 820 or Perl 5.8.9 or later\n&#34;;
 	exit 0;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;26&nbsp;13:15:02&nbsp;2007</span>
    <span class="description">jdhedden [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [PATCH] t/Unicode.t failures under Cygwin</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> JDHEDDEN [...] cpan.org</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">JDHEDDEN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; t/Unicode.t fails on &#39;make test&#39; under Cygwin:
</div>
With Win32-0.30, t/Unicode.t still fails under Cygwin on a FAT32 drive:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; cd /tmp
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; perl -MWin32 -e &#39;print&#40;join&#40;&#34;\n&#34;, Win32::FsType&#40;&#41;&#41;, &#34;\n&#34;&#41;;&#39;
</div>FAT32
6
255

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; perl /usr/local/src/perl/cpan/build/Win32-0.30/t/Unicode.t
</div>1..12
# Running under perl version 5.009005 for cygwin
# Current time local: Tue Jun 26 12:41:53 2007
# Current time GMT:   Tue Jun 26 16:41:53 2007
# Using Test.pm version 1.25
not ok 1
# Failed test 1 in /usr/local/src/perl/cpan/build/Win32-0.30/t/Unicode.t
at line 41
#  /usr/local/src/perl/cpan/build/Win32-0.30/t/Unicode.t line 41 is:
ok&#40;-d Win32::GetANSIPathName&#40;$dir&#41;&#41;;
not ok 2
# Failed test 2 in /usr/local/src/perl/cpan/build/Win32-0.30/t/Unicode.t
at line 45
#  /usr/local/src/perl/cpan/build/Win32-0.30/t/Unicode.t line 45 is:
ok&#40;-f Win32::GetANSIPathName&#40;$file&#41;&#41;;
not ok 3
# Failed test 3 in /usr/local/src/perl/cpan/build/Win32-0.30/t/Unicode.t
at line 48
#  /usr/local/src/perl/cpan/build/Win32-0.30/t/Unicode.t line 48 is:
ok&#40;opendir&#40;my $dh, Win32::GetANSIPathName&#40;$dir&#41;&#41;&#41;;
ok 4
not ok 5
# Failed test 5 in /usr/local/src/perl/cpan/build/Win32-0.30/t/Unicode.t
at line 62
#  /usr/local/src/perl/cpan/build/Win32-0.30/t/Unicode.t line 62 is:
ok&#40;Win32::SetCwd&#40;$dir&#41;&#41;;
not ok 6
# Test 6 got: &#34;E:\\cygwin\\tmp&#34;
&#40;/usr/local/src/perl/cpan/build/Win32-0.30/t/Unicode.t at line 63&#41;
#   Expected: &#34;E:\\cygwin\\tmp\\Foo \x{394}\x{419} Bar \x{5E7}\x{645} Baz&#34;
#  /usr/local/src/perl/cpan/build/Win32-0.30/t/Unicode.t line 63 is:
ok&#40;Win32::GetLongPathName&#40;Win32::GetCwd&#40;&#41;&#41;, $long&#41;;
ok 7
ok 8
not ok 9
# Test 9 got: &#34;E:\\cygwin\\tmp&#34;
&#40;/usr/local/src/perl/cpan/build/Win32-0.30/t/Unicode.t at line 80&#41;
#   Expected: &#34;E:\\cygwin\\tmp\\Foo \x{394}\x{419} Bar \x{5E7}\x{645} Baz&#34;
#  /usr/local/src/perl/cpan/build/Win32-0.30/t/Unicode.t line 80 is:
ok&#40;Win32::GetLongPathName&#40;$subdir&#41;, $long&#41;;
not ok 10
# Failed test 10 in
/usr/local/src/perl/cpan/build/Win32-0.30/t/Unicode.t at line 83
#  /usr/local/src/perl/cpan/build/Win32-0.30/t/Unicode.t line 83 is:
ok&#40;chdir&#40;Win32::GetANSIPathName&#40;$dir&#41;&#41;&#41;;
not ok 11
# Test 11 got: &#34;E:\\cygwin\\tmp&#34;
&#40;/usr/local/src/perl/cpan/build/Win32-0.30/t/Unicode.t at line 84&#41;
#    Expected: &#34;E:\\cygwin\\tmp\\Foo \x{394}\x{419} Bar \x{5E7}\x{645} Baz&#34;
#  /usr/local/src/perl/cpan/build/Win32-0.30/t/Unicode.t line 84 is:
ok&#40;Win32::GetLongPathName&#40;Win32::GetCwd&#40;&#41;&#41;, $long&#41;;


However, it works on an NTFS drive:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; cd /c/Temp
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; perl -MWin32 -e &#34;print&#40;join&#40;\&#34;\n\&#34;, Win32::FsType&#40;&#41;&#41;, \&#34;\n\&#34;&#41;;&#34;
</div>NTFS
459007
255

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; perl /usr/local/src/perl/cpan/build/Win32-0.30/t/Unicode.t
</div>1..12
# Running under perl version 5.009005 for cygwin
# Current time local: Tue Jun 26 12:42:19 2007
# Current time GMT:   Tue Jun 26 16:42:19 2007
# Using Test.pm version 1.25
ok 1
ok 2
ok 3
ok 4
ok 5
ok 6
ok 7
ok 8
ok 9
ok 10
ok 11
ok 12


The attached patch skips the test on FAT32 drives under Cygwin.

I am posting this patch to p5p, too.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- Win32-0.30/t/Unicode.t.orig	2007-06-26 13:10:02.000000000 -0400
+++ Win32-0.30/t/Unicode.t	2007-06-26 13:11:40.000000000 -0400
@@ -12,6 +12,10 @@
 	print &#34;1..0 # Skip: Filesystem doesn&#39;t support Unicode\n&#34;;
 	exit 0;
     }
+    if &#40;&#40;$^O eq &#39;cygwin&#39;&#41; &#38;&#38; &#40;Win32::FsType&#40;&#41; eq &#39;FAT32&#39;&#41;&#41; {
+	print &#34;1..0 # Skip: FAT32 under Cygwin doesn&#39;t support Unicode\n&#34;;
+	exit 0;
+    }
     unless &#40;&#40;Win32::GetOSVersion&#40;&#41;&#41;[1] &gt; 4&#41; {
 	print &#34;1..0 # Skip: Unicode support requires Windows 2000 or later\n&#34;;
 	exit 0;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;01&nbsp;00:04:45&nbsp;2007</span>
    <span class="description">m.nooning [...] comcast.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> m.nooning [...] comcast.net</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">It fails on Windows XP machines that do not have cygwin installed, too.
Perl 5.8.8 build 820 on Windows XP.
This was a fresh install of Perl.

t/Unicode.....................# Failed test 1 in t/Unicode.t at line 41
t/Unicode.....................NOK 1#  t/Unicode.t line 41 is: ok&#40;-d
Win32::GetANSIPathName&#40;$dir&#41;&#41;;
# Failed test 2 in t/Unicode.t at line 45
t/Unicode.....................NOK 2#  t/Unicode.t line 45 is: ok&#40;-f
Win32::GetANSIPathName&#40;$file&#41;&#41;;
# Failed test 3 in t/Unicode.t at line 48
t/Unicode.....................NOK 3#  t/Unicode.t line 48 is:
ok&#40;opendir&#40;my $dh, Win32::GetANSIPathN
ame&#40;$dir&#41;&#41;&#41;;
t/Unicode.....................ok 4/12# Failed test 5 in t/Unicode.t at
line 62
t/Unicode.....................NOK 5#  t/Unicode.t line 62 is:
ok&#40;Win32::SetCwd&#40;$dir&#41;&#41;;
# Test 6 got: &#34;C:\\webdownload\\perl\\Win32\\Win32-0.30&#34; &#40;t/Unicode.t at
line 63&#41;
t/Unicode.....................NOK 6#   Expected:
&#34;C:\\webdownload\\perl\\Win32\\Win32-0.30\\Foo \x{3
94}\x{419} Bar \x{5E7}\x{645} Baz&#34;
#  t/Unicode.t line 63 is: ok&#40;Win32::GetLongPathName&#40;Win32::GetCwd&#40;&#41;&#41;,
$long&#41;;
# Test 9 got: &#34;C:\\webdownload\\perl\\Win32\\Win32-0.30&#34; &#40;t/Unicode.t at
line 80&#41;
t/Unicode.....................NOK 9#   Expected:
&#34;C:\\webdownload\\perl\\Win32\\Win32-0.30\\Foo \x{3
94}\x{419} Bar \x{5E7}\x{645} Baz&#34;
#  t/Unicode.t line 80 is: ok&#40;Win32::GetLongPathName&#40;$subdir&#41;, $long&#41;;
# Failed test 10 in t/Unicode.t at line 83
t/Unicode.....................NOK 10#  t/Unicode.t line 83 is:
ok&#40;chdir&#40;Win32::GetANSIPathName&#40;$dir&#41;
&#41;&#41;;
# Test 11 got: &#34;C:\\webdownload\\perl\\Win32\\Win32-0.30&#34; &#40;t/Unicode.t
at line 84&#41;
t/Unicode.....................NOK 11#    Expected:
&#34;C:\\webdownload\\perl\\Win32\\Win32-0.30\\Foo \x
{394}\x{419} Bar \x{5E7}\x{645} Baz&#34;
#  t/Unicode.t line 84 is: ok&#40;Win32::GetLongPathName&#40;Win32::GetCwd&#40;&#41;&#41;,
$long&#41;;
t/Unicode.....................FAILED tests 1-3, 5-6, 9-12
        Failed 9/12 tests, 25.00% okay
Failed Test Stat Wstat Total Fail  Failed  List of Failed
-------------------------------------------------------------------------------
t/Unicode.t               12    9  75.00%  1-3 5-6 9-12
Failed 1/11 test scripts, 90.91% okay. 9/93 subtests failed, 90.32% okay.
NMAKE : fatal error U1077: &#39;C:\Perl\bin\perl.exe&#39; : return code &#39;0xff&#39;
Stop.

C:\webdownload\perl\Win32\Win32-0.30&gt;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;01&nbsp;00:04:46&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;01&nbsp;00:22:57&nbsp;2007</span>
    <span class="description">m.nooning [...] comcast.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> m.nooning [...] comcast.net</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Problem solved &#40;for now&#41;.
The url <span class="clickylink"><a target="new" rel="nofollow" href="http://www.gossamer-threads.com/lists/perl/porters/217608">http://www.gossamer-threads.com/lists/perl/porters/217608</a></span>
has quite a bit of discussion on this.  The upshot is that FAT/FAT32 do
not consistently support unicode, and so the file t/Unicode.t must be
patched so that the test is skipped.  I will paste the patch from that
url below.

--------paste patch
--- perl-current/ext/Win32/t/Unicode.t.orig     2007-06-26
15:34:43.907620700 -0400
+++ perl-current/ext/Win32/t/Unicode.t  2007-06-26 15:36:15.622243300 -0400
@@ -8,7 +8,7 @@
        print &#34;1..0 # Skip: Needs ActivePerl 820 or Perl 5.8.9 or later\n&#34;;
        exit 0;
     }
-    unless &#40;&#40;Win32::FsType&#40;&#41;&#41;[1] &#38; 4&#41; {
+    if &#40;&#40;&#40;&#40;Win32::FsType&#40;&#41;&#41;[1] &#38; 4&#41; == 0&#41; || &#40;Win32::FsType&#40;&#41; =~ /^FAT/&#41;&#41; {
        print &#34;1..0 # Skip: Filesystem doesn&#39;t support Unicode\n&#34;;
        exit 0;
     }
--------end paste patch
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;11&nbsp;13:04:00&nbsp;2007</span>
    <span class="description">JDB [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;11&nbsp;13:04:02&nbsp;2007</span>
    <span class="description">JDB [...] cpan.org -  Fixed in 0.31 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
