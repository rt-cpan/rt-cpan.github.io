<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #85844 for Pod-Perldoc: [PATCH] Let mandoc&#40;1&#41; produce UTF-8 output only if the user&#39;s locale asks for it.</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #85844 for Pod-Perldoc: [PATCH] Let mandoc&#40;1&#41; produce UTF-8 output only if the user&#39;s locale asks for it.</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Pod-Perldoc">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Pod-Perldoc">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Pod-Perldoc">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Pod-Perldoc">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Pod-Perldoc">Pod-Perldoc CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">85844</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Pod-Perldoc">Pod-Perldoc</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
schwarze [...] usta.de

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-26136-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-26137-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=85844">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1219974" href="/Public/Bug/Display.html?id=85844#txn-1219974">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;03&nbsp;21:14:20&nbsp;2013</span>
    <span class="description">schwarze [...] usta.de -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [PATCH] Let mandoc&#40;1&#41; produce UTF-8 output only if the user&#39;s locale asks for it.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 4 Jun 2013 03:13:55 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Pod-Perldoc [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ingo Schwarze &lt;schwarze [...] usta.de&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1219974/644272/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/644272">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

when using mandoc&#40;1&#41; as its groffer, perldoc&#40;1&#41; unconditionally
uses the -Tutf8 output mode.  That mode is defined to produce UTF-8
output no matter what the user&#39;s locale is.  So there is no way for
a user to have perldoc&#40;1&#41; _not_ throw UTF-8 at him or her...

I just committed a minimal fix to OpenBSD&#39;s in-tree perl
to use -Tlocale instead of -Tutf8, which will only use UTF-8
when the user&#39;s locale requests it, and ASCII otherwise.

Reading the mandoc-related code in Pod::Perldoc::ToMan, i noticed
some more opportunity for cleanup, so i will likely send a larger
patch shortly.  Feel free to either pull this minimal fix straight
away or to wait for the larger patch, as you like.

Thanks for maintaining Perldoc,
  Ingo

P.S.
Appending some info about my system, just in case, even though
i don&#39;t expect it to be relevant in this context...

-- 
Ingo Schwarze &lt;schwarze@openbsd.org&gt;
mandoc co-author and maintainer

 ----- 8&lt; ----- schnipp ----- &gt;8 ----- 8&lt; ----- schnapp ----- &gt;8 -----

From: Ingo Schwarze &lt;schwarze@openbsd.org&gt;
Date: Mon, 3 Jun 2013 19:24:16 -0400
Subject: [PATCH] Let mandoc&#40;1&#41; produce UTF-8 output only if the user&#39;s locale
 asks for it.

---
 lib/Pod/Perldoc/ToMan.pm | 2 +-
 1 file changed, 1 insertion&#40;+&#41;, 1 deletion&#40;-&#41;

diff --git a/lib/Pod/Perldoc/ToMan.pm b/lib/Pod/Perldoc/ToMan.pm
index 80a944c..52fc2e8 100644
--- a/lib/Pod/Perldoc/ToMan.pm
+++ b/lib/Pod/Perldoc/ToMan.pm
@@ -263,7 +263,7 @@ sub _get_device_switches {
           if&#40; $self-&gt;_is_nroff  &#41;             { qw&#40;&#41;              }
        elsif&#40; $self-&gt;_have_groff_with_utf8 &#41;  { qw&#40;-Kutf8 -Tutf8&#41; }
        elsif&#40; $self-&gt;_is_ebcdic &#41;             { qw&#40;-Tcp1047&#41;      }
-       elsif&#40; $self-&gt;_have_mandoc_with_utf8 &#41; { qw&#40;-Tutf8&#41;        }
+       elsif&#40; $self-&gt;_have_mandoc_with_utf8 &#41; { qw&#40;-Tlocale&#41;      }
        elsif&#40; $self-&gt;_is_mandoc &#41;             { qw&#40;&#41;              }
        else                                   { qw&#40;-Tlatin1&#41;      }
        }
-- 
1.8.2.2

 ----- 8&lt; ----- schnipp ----- &gt;8 ----- 8&lt; ----- schnapp ----- &gt;8 -----

ischwarze@isnote $ pwd
/usr/src/gnu/usr.bin/perl/cpan/Pod-Perldoc/lib/Pod
ischwarze@isnote $ grep &#39;VERSION =&#39; Perldoc.pm  
$VERSION = &#39;3.17&#39;;
ischwarze@isnote $ perl -v | head -n2 | tail -n1 
This is perl 5, version 16, subversion 3 &#40;v5.16.3&#41; built for i386-openbsd
ischwarze@isnote $ uname -a
OpenBSD isnote.usta.de 5.3 GENERIC.MP#5 i386

However, the above patch has been prepared
using git clone and then working on branch master.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1220095" href="/Public/Bug/Display.html?id=85844#txn-1220095">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;04&nbsp;10:08:12&nbsp;2013</span>
    <span class="description">mrallen1 [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1220095/644321/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/644321">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 733b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jun 03 21:14:20 2013, schwarze@usta.de wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I just committed a minimal fix to OpenBSD&#39;s in-tree perl
&gt; to use -Tlocale instead of -Tutf8, which will only use UTF-8
&gt; when the user&#39;s locale requests it, and ASCII otherwise.
</div>
Thanks. I didn&#39;t know about that behavior. 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Reading the mandoc-related code in Pod::Perldoc::ToMan, i noticed
&gt; some more opportunity for cleanup, so i will likely send a larger
&gt; patch shortly.  Feel free to either pull this minimal fix straight
&gt; away or to wait for the larger patch, as you like.
</div>
I have several other things to fix up, so if you don&#39;t mind I would like to wait
for the larger patch.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks for maintaining Perldoc,
</div>
Thanks for sending me a patch to maintain perldoc :&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1220096" href="/Public/Bug/Display.html?id=85844#txn-1220096">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;04&nbsp;10:08:12&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1311985" href="/Public/Bug/Display.html?id=85844#txn-1311985">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;13&nbsp;22:38:03&nbsp;2014</span>
    <span class="description">mrallen1 [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1311985/695309/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/695309">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 536b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jun 03 21:14:20 2013, schwarze@usta.de wrote: 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Reading the mandoc-related code in Pod::Perldoc::ToMan, i noticed
&gt; some more opportunity for cleanup, so i will likely send a larger
&gt; patch shortly.  Feel free to either pull this minimal fix straight
&gt; away or to wait for the larger patch, as you like.
</div>
Hi - just following up on this ticket. I committed your minimal patch to
the tree tonight as f433439 &#40;I haven&#39;t pushed it yet&#41;

Did you ever get around to the larger clean up patch you referenced
last summer?

Thanks.

Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1311988" href="/Public/Bug/Display.html?id=85844#txn-1311988">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;13&nbsp;22:38:03&nbsp;2014</span>
    <span class="description">mrallen1 [...] yahoo.com -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1317104" href="/Public/Bug/Display.html?id=85844#txn-1317104">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;24&nbsp;04:22:59&nbsp;2014</span>
    <span class="description">schwarze [...] usta.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #85844] [PATCH] Let mandoc&#40;1&#41; produce UTF-8 output only if the user&#39;s locale asks for it.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 24 Jan 2014 10:22:39 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Mark Allen via RT &lt;bug-Pod-Perldoc [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ingo Schwarze &lt;schwarze [...] usta.de&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1317104/698321/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/698321">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Mark,

Mark Allen via RT wrote on Mon, Jan 13, 2014 at 10:38:03PM -0500:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=85844">https://rt.cpan.org/Ticket/Display.html?id=85844</a></span> &gt;
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon Jun 03 21:14:20 2013, schwarze@usta.de wrote: 
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; Reading the mandoc-related code in Pod::Perldoc::ToMan, i noticed
&gt;&gt; some more opportunity for cleanup, so i will likely send a larger
&gt;&gt; patch shortly.  Feel free to either pull this minimal fix straight
&gt;&gt; away or to wait for the larger patch, as you like.
</div></div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi - just following up on this ticket. I committed your minimal patch to
&gt; the tree tonight as f433439 &#40;I haven&#39;t pushed it yet&#41;
&gt; 
&gt; Did you ever get around to the larger clean up patch you referenced
&gt; last summer?
</div>
Oh, i actually wrote the patch but got distracted and failed
to send it.  Sorry about that.

So i just rebased and retested it, here it is.

I think the commit message says it all.
In case of doubt, please just ask!

Thank you for the reminder,
  Ingo

P.S.
Weird.
Now i end up sending you a patch i wrote in Toronto - from Dunedin...


 ----- 8&lt; ----- schnipp ----- &gt;8 ----- 8&lt; ----- schnapp ----- &gt;8 -----

commit 34a6a4845206bffa99adb38c8f595ae7c818a19f
Author: Ingo Schwarze &lt;schwarze@openbsd.org&gt;
Date:   Tue Jun 4 16:59:55 2013 -0400

    Cleanup code related to mandoc&#40;1&#41;.
    
    * No need to parse mandoc versions, just ask the program itself
      whether it can handle -Tlocale.
    * Remove some dubious advice.  Mandoc is only preferred on OpenBSD,
      and in that environment, i don&#39;t think using the groff from ports
      is better for formatting pod2man&#40;1&#41;-generated manuals than
      using the mandoc&#40;1&#41; from the base system.
    * No need to pass -mandoc to mandoc&#40;1&#41;, it&#39;s the default and will ever be.
    * No harm done passing -man to mandoc&#40;1&#41;, it just works.

diff --git a/lib/Pod/Perldoc/ToMan.pm b/lib/Pod/Perldoc/ToMan.pm
index 86f45f8..7961ace 100644
--- a/lib/Pod/Perldoc/ToMan.pm
+++ b/lib/Pod/Perldoc/ToMan.pm
@@ -212,34 +212,13 @@ sub _have_groff_with_utf8 {
 sub _have_mandoc_with_utf8 {
        my&#40; $self &#41; = @_;
 
-       return 0 unless $self-&gt;_is_mandoc;
-       my $roffer = $self-&gt;__nroffer;
-
-       my $minimum_mandoc_version = &#39;1.11&#39;;
-
-       my $version_string = `$roffer -V`;
-       my&#40; $version &#41; = $version_string =~ /mandoc &#40;&#40;\d+&#41;\.&#40;\d+&#41;&#41;/;
-       $self-&gt;debug&#40; &#34;Found mandoc $version\n&#34; &#41;;
-
-       # is a string comparison good enough?
-       if&#40; $version lt $minimum_mandoc_version &#41; {
-               $self-&gt;warn&#40;
-                       &#34;You have an older mandoc.&#34; .
-                       &#34; Update to version $minimum_mandoc_version for better Unicode support.\n&#34; .
-                       &#34;If you don&#39;t upgrade, wide characters may come out oddly.\n&#34; .
-                       &#34;Your results still might be odd. If you have groff, that&#39;s even better.\n&#34;
-                        &#41;;
-               }
-
-       $version ge $minimum_mandoc_version;
+       $self-&gt;_is_mandoc and not system &#39;mandoc -Tlocale -V &gt; /dev/null 2&gt;&#38;1&#39;;
        }
 
 sub _collect_nroff_switches {
        my&#40; $self &#41; = shift;
 
-       my @render_switches = $self-&gt;_is_mandoc ? qw&#40;-mandoc&#41; : qw&#40;-man&#41;;
-
-       push @render_switches, $self-&gt;_get_device_switches;
+       my @render_switches = &#40;&#39;-man&#39;, $self-&gt;_get_device_switches&#41;;
 
        # Thanks to Brendan O&#39;Dea for contributing the following block
        if&#40; $self-&gt;_is_roff and -t STDOUT and my &#40;$cols&#41; = $self-&gt;_get_columns &#41; {
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1320112" href="/Public/Bug/Display.html?id=85844#txn-1320112">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;30&nbsp;23:26:54&nbsp;2014</span>
    <span class="description">mrallen1 [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1320112/700103/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/700103">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 236b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Jan 24 04:22:59 2014, schwarze@usta.de wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Oh, i actually wrote the patch but got distracted and failed
&gt; to send it.  Sorry about that.
</div>
No problem. Committed as 81f3e8c in my tree. &#40;Not pushed yet.&#41;

Thanks again.

Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1653514" href="/Public/Bug/Display.html?id=85844#txn-1653514">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;28&nbsp;12:40:16&nbsp;2016</span>
    <span class="description">mrallen1 [...] yahoo.com -  Status changed from &#39;patched&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.420129</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
