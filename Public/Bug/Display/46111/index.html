<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #46111 for perl-ldap: LWP interface does not uspport LDIF</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #46111 for perl-ldap: LWP interface does not uspport LDIF</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/perl-ldap/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/perl-ldap/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/perl-ldap/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/perl-ldap/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/perl-ldap">perl-ldap CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">46111</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/perl-ldap/Active/">perl-ldap</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
yair.lenga [...] citi.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-25226-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-25227-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;15&nbsp;08:02:44&nbsp;2009</span>
    <span class="description">yair.lenga [...] citi.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> LWP interface does not uspport LDIF</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is a mixed bug/request.

The LWP::Protocol::ldap module will only produce HTML data. While this
is useful for certain application, it make it hard to get the actual data.

Will it be possible to use LDIF for the output ? Either as a default, or
by specifying an extension &#40;mode=ldif, following the mode=a for FTP&#41;, or
by passing an special header in the LWP request object.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;15&nbsp;10:02:30&nbsp;2009</span>
    <span class="description">gbarr [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #46111] LWP interface does not uspport LDIF </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 15 May 2009 08:57:36 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-perl-ldap [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Graham Barr &lt;gbarr [...] pobox.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Attached is an UNTESTED attempt to make it support ldif, I would  
appreciate
any feedback.

Currently it uses the extensions part of the url to specify format,  
you need to pass x-format=ldif

extensions are set after the 4th ?

eg

   ldap:///??sub??x-format=ldif

see <span class="clickylink"><a target="new" rel="nofollow" href="http://www.faqs.org/rfcs/rfc2255.html">http://www.faqs.org/rfcs/rfc2255.html</a></span>

Although I am tempted to set ldif as the default as it does seem more  
useful.

Graham.
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"></div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;15&nbsp;10:02:31&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;15&nbsp;13:47:14&nbsp;2009</span>
    <span class="description">yair.lenga [...] citi.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Graham,

Thanks for the prompt response. I tested with RH4 &#40;perl-LDAP 0.31-5&#41;.

On RH4, I switched the code to use the 5.8 open &#40;and skip the optional 
IO::Scalar&#41;. I made my best effort to implement a fallback for old Perl 
&#40;before 5.8&#41;, but I really do not have any way to test. Also, I removed 
the call to write_version. The LDIF seems to put the version 
automatically&#41;.

100a101
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;     require IO::Scalar;
</div>102,110c103
&lt;       my $fh ;
&lt;       if &#40; $] &lt; 5.008 &#41; {
&lt;               require IO::Scalar;
&lt;               my $fh = IO::Scalar-&gt;new&#40;\$content&#41;;
&lt;       } else {
&lt;               $fh = new IO::Handle ;
&lt;               open $fh, &#39;&gt;&#39;, \$content or die ;
&lt;       } ;
&lt; 
---
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;     my $fh = IO::Scalar-&gt;new&#40;\$content&#41;;
</div>112c105
&lt; #REMOVED    $ldif-&gt;write_version;
---
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;     $ldif-&gt;write_version;
</div>
While testing, I&#39;m noticed TWO problems with error handling:

  if &#40;$mesg-&gt;code&#41; {
    my $res = new HTTP::Response &#38;HTTP::Status::RC_BAD_REQUEST,
         &#34;LDAP return code &#34; . $ldap-&gt;code;
    $res-&gt;content_type&#40;&#34;text/plain&#34;&#41;;
# BAD    $res-&gt;content&#40;$ldap-&gt;error&#41;;
    $res-&gt;content&#40;$mesg-&gt;error&#41;;
    return $res;
  }

the &#39;$ldap-&gt;error&#39; should be &#39;$mesg-&gt;error&#39;.

Do you want a separate ticket for this item ? Without it, any error 
will result little information to the user about the real problem. Most 
common error for me was bad password/username, or bad permission.

Attached is my final version, but it&#39;s built from 1.10.

Yair
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"># Copyright &#40;c&#41; 1998-2004 Graham Barr &lt;gbarr@pobox.com&gt;. All rights reserved.
# This program is free software; you can redistribute it and/or
# modify it under the same terms as Perl itself.

package LWP::Protocol::ldap;

use Carp &#40;&#41;;

use HTTP::Status &#40;&#41;;
use HTTP::Negotiate &#40;&#41;;
use HTTP::Response &#40;&#41;;
use LWP::MediaTypes &#40;&#41;;
require LWP::Protocol;
@ISA = qw&#40;LWP::Protocol&#41;;

$VERSION = &#34;1.11&#34;;

use strict;
eval {
  require Net::LDAP;
};
my $init_failed = $@ ? $@ : undef;

sub request {
  my&#40;$self, $request, $proxy, $arg, $size, $timeout&#41; = @_;

  $size = 4096 unless $size;

  LWP::Debug::trace&#40;&#39;&#40;&#41;&#39;&#41;;

  # check proxy
  if &#40;defined $proxy&#41;
  {
    return new HTTP::Response &#38;HTTP::Status::RC_BAD_REQUEST,
                 &#39;You can not proxy through the ldap&#39;;
  }

  my $url = $request-&gt;url;
  if &#40;$url-&gt;scheme ne &#39;ldap&#39;&#41; {
    my $scheme = $url-&gt;scheme;
    return new HTTP::Response &#38;HTTP::Status::RC_INTERNAL_SERVER_ERROR,
            &#34;LWP::Protocol::ldap::request called for &#39;$scheme&#39;&#34;;
  }

  # check method
  my $method = $request-&gt;method;

  unless &#40;$method eq &#39;GET&#39;&#41; {
    return new HTTP::Response &#38;HTTP::Status::RC_BAD_REQUEST,
                 &#39;Library does not allow method &#39; .
                 &#34;$method for &#39;ldap:&#39; URLs&#34;;
  }

  if &#40;$init_failed&#41; {
    return new HTTP::Response &#38;HTTP::Status::RC_INTERNAL_SERVER_ERROR,
            $init_failed;
  }

  my $host     = $url-&gt;host;
  my $port     = $url-&gt;port;
  my &#40;$user, $password&#41; = split&#40;&#34;:&#34;, $url-&gt;userinfo, 2&#41;;

  # Create an initial response object
  my $response = new HTTP::Response &#38;HTTP::Status::RC_OK, &#34;Document follows&#34;;
  $response-&gt;request&#40;$request&#41;;

  my $ldap = new Net::LDAP&#40;$host, port =&gt; $port&#41;;

  my $mesg = $ldap-&gt;bind&#40;$user, password =&gt; $password&#41;;

  if &#40;$mesg-&gt;code&#41; {
    my $res = new HTTP::Response &#38;HTTP::Status::RC_BAD_REQUEST,
         &#34;LDAP return code &#34; . $mesg-&gt;code;
    $res-&gt;content_type&#40;&#34;text/plain&#34;&#41;;
    $res-&gt;content&#40;$mesg-&gt;error&#41;;
    return $res;
  }

  my $dn = $url-&gt;dn;
  my @attrs = $url-&gt;attributes;
  my $scope = $url-&gt;scope || &#34;base&#34;;
  my $filter = $url-&gt;filter;
  my @opts = &#40;scope =&gt; $scope&#41;;
  my %extn = $url-&gt;extensions;
  my $format = lc&#40;$extn{&#39;x-format&#39;} || &#39;html&#39;&#41;;
  
  push @opts, &#34;base&#34; =&gt; $dn if $dn;
  push @opts, &#34;filter&#34; =&gt; $filter if $filter;
  push @opts, &#34;attrs&#34; =&gt; \@attrs if @attrs;

  $mesg = $ldap-&gt;search&#40;@opts&#41;;
  if &#40;$mesg-&gt;code&#41; {
    my $res = new HTTP::Response &#38;HTTP::Status::RC_BAD_REQUEST,
         &#34;LDAP return code &#34; . $mesg-&gt;code;
    $res-&gt;content_type&#40;&#34;text/plain&#34;&#41;;
    $res-&gt;content&#40;$mesg-&gt;error&#41;;
    return $res;
  }
  elsif &#40;$format eq &#39;ldif&#39;&#41; {
    require Net::LDAP::LDIF;
    require IO::Scalar;
    my $content = &#39;&#39;;
    my $fh = IO::Scalar-&gt;new&#40;\$content&#41;;
    my $ldif = Net::LDAP::LDIF-&gt;new&#40;$fh,&#34;w&#34;, version =&gt; 1&#41;;
    $ldif-&gt;write_version;
    while&#40;my $entry = $mesg-&gt;shift_entry&#41; {
      $ldif-&gt;write_entry&#40;$entry&#41;;
    }
    $ldif-&gt;done;
    close&#40;$fh&#41;;
    $response-&gt;header&#40;&#39;Content-Type&#39; =&gt; &#39;text/ldif&#39;&#41;;
    $response-&gt;header&#40;&#39;Content-Length&#39;, length&#40;$content&#41;&#41;;
    $response = $self-&gt;collect_once&#40;$arg, $response, $content&#41;
	if &#40;$method ne &#39;HEAD&#39;&#41;;
  }
  else {
    my $content = &#34;&lt;head&gt;&lt;title&gt;Directory Search Results&lt;/title&gt;&lt;/head&gt;\n&lt;body&gt;&#34;;
    my $entry;
    my $index;

    for&#40;$index = 0 ; $entry = $mesg-&gt;entry&#40;$index&#41; ; $index++ &#41; {
      my $attr;

      $content .= $index ? qq{&lt;tr&gt;&lt;th colspan=&#34;2&#34;&gt;&lt;hr&gt;&#38;nbsp&lt;/tr&gt;\n} : &#34;&lt;table&gt;&#34;;

      $content .= qq{&lt;tr&gt;&lt;th colspan=&#34;2&#34;&gt;} . $entry-&gt;dn . &#34;&lt;/th&gt;&lt;/tr&gt;\n&#34;;

      foreach $attr &#40;$entry-&gt;attributes&#41; {
        my $vals = $entry-&gt;get_value&#40;$attr, asref =&gt; 1&#41;;
        my $val;

        $content .= q{&lt;tr&gt;&lt;td align=&#34;right&#34; valign=&#34;top&#34;};
        $content .= q{ rowspan=&#34;} . scalar&#40;@$vals&#41; . q{&#34;}
          if &#40;@$vals &gt; 1&#41;;
        $content .= &#34;&gt;&#34; . $attr  . &#34;&#38;nbsp&lt;/td&gt;\n&#34;;

        my $j = 0;
        foreach $val &#40;@$vals&#41; {
	  $val = qq!&lt;a href=&#34;$val&#34;&gt;$val&lt;/a&gt;! if $val =~ /^https?:/;
	  $val = qq!&lt;a href=&#34;mailto:$val&#34;&gt;$val&lt;/a&gt;! if $val =~ /^[-\w]+\@[-.\w]+$/;
          $content .= &#34;&lt;tr&gt;&#34; if $j++;
          $content .= &#34;&lt;td&gt;&#34; . $val . &#34;&lt;/td&gt;&lt;/tr&gt;\n&#34;;
        }
      }
    }

    $content .= &#34;&lt;/table&gt;&#34; if $index;
    $content .= &#34;&lt;hr&gt;&#34;;
    $content .= $index ? sprintf&#40;&#34;%s Match%s found&#34;,$index, $index&gt;1 ? &#34;es&#34; : &#34;&#34;&#41;
		       : &#34;&lt;b&gt;No Matches found&lt;/b&gt;&#34;;
    $content .= &#34;&lt;/body&gt;\n&#34;;
    $response-&gt;header&#40;&#39;Content-Type&#39; =&gt; &#39;text/html&#39;&#41;;
    $response-&gt;header&#40;&#39;Content-Length&#39;, length&#40;$content&#41;&#41;;
    $response = $self-&gt;collect_once&#40;$arg, $response, $content&#41;
	if &#40;$method ne &#39;HEAD&#39;&#41;;

  }

  $ldap-&gt;unbind;

  $response;
}

1;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;15&nbsp;13:57:32&nbsp;2009</span>
    <span class="description">gbarr [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #46111] LWP interface does not uspport LDIF </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 15 May 2009 12:56:59 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-perl-ldap [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Graham Barr &lt;gbarr [...] pobox.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On May 15, 2009, at 12:47 PM, yair via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;       Queue: perl-ldap
&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=46111">https://rt.cpan.org/Ticket/Display.html?id=46111</a></span> &gt;
&gt;
&gt; Graham,
&gt;
&gt; Thanks for the prompt response. I tested with RH4 &#40;perl-LDAP 0.31-5&#41;.
&gt;
&gt; On RH4, I switched the code to use the 5.8 open &#40;and skip the optional
&gt; IO::Scalar&#41;. I made my best effort to implement a fallback for old  
&gt; Perl
&gt; &#40;before 5.8&#41;, but I really do not have any way to test. Also, I  
&gt; removed
&gt; the call to write_version. The LDIF seems to put the version
&gt; automatically&#41;.
&gt;
&gt; 100a101
<div class="message-stanza open">&gt;&gt;    require IO::Scalar;
</div>&gt; 102,110c103
&gt; &lt;       my $fh ;
&gt; &lt;       if &#40; $] &lt; 5.008 &#41; {
&gt; &lt;               require IO::Scalar;
&gt; &lt;               my $fh = IO::Scalar-&gt;new&#40;\$content&#41;;
&gt; &lt;       } else {
&gt; &lt;               $fh = new IO::Handle ;
&gt; &lt;               open $fh, &#39;&gt;&#39;, \$content or die ;
</div>
That is actually a syntax error in some versions of perl, which was  
why I opted for IO::Scalar. Of course is it really worth trying to  
support 5.4 anymore though

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; &lt;       } ;
&gt; &lt;
&gt; ---
<div class="message-stanza open">&gt;&gt;    my $fh = IO::Scalar-&gt;new&#40;\$content&#41;;
</div>&gt; 112c105
&gt; &lt; #REMOVED    $ldif-&gt;write_version;
</div>
This was there for the case when the search returns no results.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; ---
<div class="message-stanza open">&gt;&gt;    $ldif-&gt;write_version;
</div>&gt;
&gt; While testing, I&#39;m noticed TWO problems with error handling:
&gt;
&gt;  if &#40;$mesg-&gt;code&#41; {
&gt;    my $res = new HTTP::Response &#38;HTTP::Status::RC_BAD_REQUEST,
&gt;         &#34;LDAP return code &#34; . $ldap-&gt;code;
&gt;    $res-&gt;content_type&#40;&#34;text/plain&#34;&#41;;
&gt; # BAD    $res-&gt;content&#40;$ldap-&gt;error&#41;;
&gt;    $res-&gt;content&#40;$mesg-&gt;error&#41;;
</div>
as this was copy/paste from the html section I can conclude that  
nobody uses this module and that we can default to ldif output :&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt;    return $res;
&gt;  }
&gt;
&gt; the &#39;$ldap-&gt;error&#39; should be &#39;$mesg-&gt;error&#39;.
&gt;
&gt; Do you want a separate ticket for this item ? Without it, any error
&gt; will result little information to the user about the real problem.  
&gt; Most
&gt; common error for me was bad password/username, or bad permission.
&gt;
&gt; Attached is my final version, but it&#39;s built from 1.10.
</div>
Thanks

Graham.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;15&nbsp;14:32:16&nbsp;2009</span>
    <span class="description">yair.lenga [...] citi.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Graham,

Given the choice of working &#34;out of the box&#34; in perl5.8 &#40;RedHat 4 and 
RedHat 5&#41;, or supporting 5.5, I would vote for making the code work in 
5.8 without having to install the &#40;legacy ?&#41; IO::Scalar.

Also, I&#39;ve opened another ticker for adding ldaps support - with some 
suggestions.

If you send me the final version, I&#39;ll be happy to test.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;11&nbsp;21:06:58&nbsp;2010</span>
    <span class="description">GBARR [...] CPAN.ORG -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
