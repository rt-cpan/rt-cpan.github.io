<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #76322 for DBIx-Class-Migration: Unexpected behaviour with TimeStamp component</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #76322 for DBIx-Class-Migration: Unexpected behaviour with TimeStamp component</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=DBIx-Class-Migration">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=DBIx-Class-Migration">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=DBIx-Class-Migration">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=DBIx-Class-Migration">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/jjn1056/DBIx-Class-Migration/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBIx-Class-Migration">DBIx-Class-Migration CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">76322</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=DBIx-Class-Migration">DBIx-Class-Migration</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
frankschwach [...] yahoo.de

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-242612-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.020    </td>
  </tr>
  <tr id="CF-242613-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=76322">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1059110" href="/Public/Bug/Display.html?id=76322#txn-1059110">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;05&nbsp;05:47:19&nbsp;2012</span>
    <span class="description">frankschwach [...] yahoo.de -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Unexpected behaviour with TimeStamp component</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1059110/554377/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/554377">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">DBIx-Class-Migration-0.020 on Ubuntu 10.10

Hi John,

This may actually be an intentional feature but it is not mentioned in
the documentation and it is not intuitive. When using migration scripts
to load demo data into the database &#40;as shown in the tutorial&#41;, it
appears that the TimeStamp component is prevented from injecting a
timestamp when a new record is created without explicitly defining a
value for a date/time field that is not nullable and has the
set_on_create attribute.
This may be intentional to ensure the data is in a known state, which
would not be the case if a current timestamp is inserted at creation
time, but then it should be mentioned and ideally a warning should be
issued otherwise it is difficult to find out what is going wrong.

How to reproduce the error:
Using the distribution of Test-DBIx-Class-0.31
in Test-DBIx-Class top level issue:
$ mkdir /share
$ dbic-migration --schema_class Test::DBIx::Class::Example::Schema -Ilib
prepare
$ touch share/migrations/SQLite/deploy/1/002-data.pl

edit 002-data.pl to match the following:
#!/usr/bin/env perl

use strict;
use warnings;
use DBIx::Class::Migration::RunScript;

migrate {
  my $self = shift;
  $self-&gt;schema-&gt;resultset&#40;&#39;Company&#39;&#41;-&gt;create&#40;{
      company_id =&gt; &#39;123&#39;,
      name =&gt; &#39;some_company&#39;,
#--------------------------------------------------
#       created =&gt; &#39;01/04/2012&#39;,
#-------------------------------------------------- 
    }
  &#41;;
};

attempt to install the schema results in an error, desptie the fact that
the created attribute of the Company Result class has the set_on_create
attribute and should have passed:

$ dbic-migration --schema_class Test::DBIx::Class::Example::Schema -Ilib
install
DBIx::Class::ResultSet::create&#40;&#41;: DBI Exception: DBD::SQLite::st execute
failed: company.company_id may not be NULL [for Statement &#34;INSERT INTO
company &#40; name&#41; VALUES &#40; ? &#41;&#34;] at [..]

uncomment the created line in the script above and installation succeeds.

To verify that creation without passing a value to &#34;created&#34;:

$ touch insert_manually.pl

edit the script to match:

#!/usr/bin/env perl

use strict;
use warnings;

use Test::DBIx::Class::Example::Schema;

my $s =
Test::DBIx::Class::Example::Schema-&gt;connect&#40;&#34;dbi:SQLite:dbname=./share/test-dbix-class-example-schema.db&#34;,&#34;&#34;,&#34;&#34;&#41;;

$s-&gt;resultset&#40;&#39;Company&#39;&#41;-&gt;create&#40;
  {
    company_id =&gt; &#39;345&#39;,
    name       =&gt; &#39;some_other_company&#39;,
  }
&#41;;

run it:
$ perl -Ilib insert_manually.pl 

passes without error and the data is in the DB:
$ sqlite3 share/test-dbix-class-example-schema.db 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">sqlite&gt; select * from company;
</div>123|some_company|01/04/2012
345|some_other_company|2012-04-05 08:59:56


Cheers,

Frank
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1059113" href="/Public/Bug/Display.html?id=76322#txn-1059113">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;05&nbsp;05:50:15&nbsp;2012</span>
    <span class="description">frankschwach [...] yahoo.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> frankschwach [...] yahoo.de</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1059113/554380/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/554380">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">ooops, sorry, copied the wrong error message. What you get when running
the install is of course this:


DBIx::Class::ResultSet::create&#40;&#41;: DBI Exception: DBD::SQLite::st execute
failed: company.created may not be NULL [for Statement &#34;INSERT INTO
company &#40; company_id, name&#41; VALUES &#40; ?, ? &#41;&#34;] 





On Thu Apr 05 05:47:19 2012, fschwach wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; DBIx-Class-Migration-0.020 on Ubuntu 10.10
&gt; 
&gt; Hi John,
&gt; 
&gt; This may actually be an intentional feature but it is not mentioned in
&gt; the documentation and it is not intuitive. When using migration
&gt; scripts
&gt; to load demo data into the database &#40;as shown in the tutorial&#41;, it
&gt; appears that the TimeStamp component is prevented from injecting a
&gt; timestamp when a new record is created without explicitly defining a
&gt; value for a date/time field that is not nullable and has the
&gt; set_on_create attribute.
&gt; This may be intentional to ensure the data is in a known state, which
&gt; would not be the case if a current timestamp is inserted at creation
&gt; time, but then it should be mentioned and ideally a warning should be
&gt; issued otherwise it is difficult to find out what is going wrong.
&gt; 
&gt; How to reproduce the error:
&gt; Using the distribution of Test-DBIx-Class-0.31
&gt; in Test-DBIx-Class top level issue:
&gt; $ mkdir /share
&gt; $ dbic-migration --schema_class Test::DBIx::Class::Example::Schema
&gt; -Ilib
&gt; prepare
&gt; $ touch share/migrations/SQLite/deploy/1/002-data.pl
&gt; 
&gt; edit 002-data.pl to match the following:
&gt; #!/usr/bin/env perl
&gt; 
&gt; use strict;
&gt; use warnings;
&gt; use DBIx::Class::Migration::RunScript;
&gt; 
&gt; migrate {
&gt;   my $self = shift;
&gt;   $self-&gt;schema-&gt;resultset&#40;&#39;Company&#39;&#41;-&gt;create&#40;{
&gt;       company_id =&gt; &#39;123&#39;,
&gt;       name =&gt; &#39;some_company&#39;,
&gt; #--------------------------------------------------
&gt; #       created =&gt; &#39;01/04/2012&#39;,
&gt; #--------------------------------------------------
&gt;     }
&gt;   &#41;;
&gt; };
&gt; 
&gt; attempt to install the schema results in an error, desptie the fact
&gt; that
&gt; the created attribute of the Company Result class has the
&gt; set_on_create
&gt; attribute and should have passed:
&gt; 
&gt; $ dbic-migration --schema_class Test::DBIx::Class::Example::Schema
&gt; -Ilib
&gt; install
&gt; DBIx::Class::ResultSet::create&#40;&#41;: DBI Exception: DBD::SQLite::st
&gt; execute
&gt; failed: company.company_id may not be NULL [for Statement &#34;INSERT INTO
&gt; company &#40; name&#41; VALUES &#40; ? &#41;&#34;] at [..]
&gt; 
&gt; uncomment the created line in the script above and installation
&gt; succeeds.
&gt; 
&gt; To verify that creation without passing a value to &#34;created&#34;:
&gt; 
&gt; $ touch insert_manually.pl
&gt; 
&gt; edit the script to match:
&gt; 
&gt; #!/usr/bin/env perl
&gt; 
&gt; use strict;
&gt; use warnings;
&gt; 
&gt; use Test::DBIx::Class::Example::Schema;
&gt; 
&gt; my $s =
&gt; Test::DBIx::Class::Example::Schema-
<div class="message-stanza open">&gt; &gt;connect&#40;&#34;dbi:SQLite:dbname=./share/test-dbix-class-example-
</div>&gt; schema.db&#34;,&#34;&#34;,&#34;&#34;&#41;;
&gt; 
&gt; $s-&gt;resultset&#40;&#39;Company&#39;&#41;-&gt;create&#40;
&gt;   {
&gt;     company_id =&gt; &#39;345&#39;,
&gt;     name       =&gt; &#39;some_other_company&#39;,
&gt;   }
&gt; &#41;;
&gt; 
&gt; run it:
&gt; $ perl -Ilib insert_manually.pl
&gt; 
&gt; passes without error and the data is in the DB:
&gt; $ sqlite3 share/test-dbix-class-example-schema.db
<div class="message-stanza open">&gt; sqlite&gt; select * from company;
</div>&gt; 123|some_company|01/04/2012
&gt; 345|some_other_company|2012-04-05 08:59:56
&gt; 
&gt; 
&gt; Cheers,
&gt; 
&gt; Frank
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1059223" href="/Public/Bug/Display.html?id=76322#txn-1059223">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;05&nbsp;11:49:28&nbsp;2012</span>
    <span class="description">frankschwach [...] yahoo.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> frankschwach [...] yahoo.de</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1059223/554454/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/554454">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 613b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">and just to add:

the same problem occurs with other components, for exapmle automatic
hashing of passphrases with DBIx::Class::PassphraseColumn is also
bypassed, so it is neccessary to manually create hashed passphrases from
plain text and then to provide the hashed strings as input to passphrase
fields. Otherwise, the plain text is entered as-is and user
authentication against such records will fail.

Of course one would have to do that anyway if using SQL to define the
data to be loaded into the DB but it is unexpected when using the Perl
Result classes themselves. 

Thanks for looking into this!

Frank
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1059253" href="/Public/Bug/Display.html?id=76322#txn-1059253">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;05&nbsp;14:05:09&nbsp;2012</span>
    <span class="description">frankschwach [...] yahoo.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> frankschwach [...] yahoo.de</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1059253/554470/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/554470">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 503b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">ok, the penny just dropped and I can now see why this is all happening -
because, as you point out in the tutorial, the migratoin scripts work
with a fresh schema, generated by the SchemaLoader, not with my Schema
classes. Of course it makes perfect sense then that my additions to the
Result classes are ignored.
Let me change this from a bug report to a documentation request: could
you maybe explicitly mention this potentially unintuitive consequence
for working with DBIx components? 
Thanks!
Frank
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1059272" href="/Public/Bug/Display.html?id=76322#txn-1059272">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;05&nbsp;15:56:37&nbsp;2012</span>
    <span class="description">jjnapiork [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1059272/554478/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/554478">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">It&#39;s really an annoying little problem, isn&#39;t it?

We HAVE to build a schema from the db, but they we get a schema that doesn&#39;t meet 
expectations.  I will try to doc this harder, but I am starting to really think the only way to fix 
this is to serialize the actual schema you are using somehow.  I will confer with Frew, the 
DBICDH author.

I find this gets you in lots of little ways, like I am building a catalyst site that has a user table 
with a sha encoded password &#40;using the DBIC:EncodedColumn comp&#41; and I had to basically 
rewrite that comp just to instert seed data.  Really, frustrating.

If you have any thoughts other than seriailziing the actual db, I would love to hear them.  right 
now I consider this the number 1 pain point.  

John

On Thu Apr 05 14:05:09 2012, fschwach wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; ok, the penny just dropped and I can now see why this is all happening -
&gt; because, as you point out in the tutorial, the migratoin scripts work
&gt; with a fresh schema, generated by the SchemaLoader, not with my Schema
&gt; classes. Of course it makes perfect sense then that my additions to the
&gt; Result classes are ignored.
&gt; Let me change this from a bug report to a documentation request: could
&gt; you maybe explicitly mention this potentially unintuitive consequence
&gt; for working with DBIx components? 
&gt; Thanks!
&gt; Frank
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1059274" href="/Public/Bug/Display.html?id=76322#txn-1059274">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;05&nbsp;15:56:38&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1059292" href="/Public/Bug/Display.html?id=76322#txn-1059292">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;05&nbsp;17:29:57&nbsp;2012</span>
    <span class="description">frankschwach [...] yahoo.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #76322] Unexpected behaviour with TimeStamp component </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 5 Apr 2012 22:29:47 +0100 &#40;BST&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-DBIx-Class-Migration [...] rt.cpan.org&#34; &lt;bug-DBIx-Class-Migration [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Frank Schwach &lt;frankschwach [...] yahoo.de&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1059292/554494/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/554494">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi John,

yes, the password problem mirrors my experience and it IS a major gotcha at the moment. Not sure what the solution could be. I guess you need to be able to infer the Schema from the DB at every point during migration so you can run Perl scripts against the Schema at that point.Â 
Ruby&#39;s ActiveRecord::Migration has a very similar caveat: if you want to use a model during migrations, the recommendation is to create a subsitute model class in the migration class itself and of course in AR the attributes of that class are always dynamically inferred from the rows of the corresponding table.
I&#39;m trying to think how something like that could be done in DBIC but I guess that would mean having to have a copy of all the Schema classes, right? 

Sorry if I can&#39;t be of much help here.

Cheers,

Frank






<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;________________________________
&gt; Von: John Napiorkowski via RT &lt;bug-DBIx-Class-Migration@rt.cpan.org&gt;
&gt;An: frankschwach@yahoo.de 
&gt;Gesendet: 20:56 Donnerstag, 5.April 2012
&gt;Betreff: [rt.cpan.org #76322] Unexpected behaviour with TimeStamp component 
&gt; 
&gt;&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=76322">https://rt.cpan.org/Ticket/Display.html?id=76322</a></span> &gt;
&gt;
&gt;It&#39;s really an annoying little problem, isn&#39;t it?
&gt;
&gt;We HAVE to build a schema from the db, but they we get a schema that doesn&#39;t meet 
&gt;expectations.Â  I will try to doc this harder, but I am starting to really think the only way to fix 
&gt;this is to serialize the actual schema you are using somehow.Â  I will confer with Frew, the 
&gt;DBICDH author.
&gt;
&gt;I find this gets you in lots of little ways, like I am building a catalyst site that has a user table 
&gt;with a sha encoded password &#40;using the DBIC:EncodedColumn comp&#41; and I had to basically 
&gt;rewrite that comp just to instert seed data.Â  Really, frustrating.
&gt;
&gt;If you have any thoughts other than seriailziing the actual db, I would love to hear them.Â  right 
&gt;now I consider this the number 1 pain point.Â  
&gt;
&gt;John
&gt;
&gt;On Thu Apr 05 14:05:09 2012, fschwach wrote:
<div class="message-stanza open">&gt;&gt; ok, the penny just dropped and I can now see why this is all happening -
&gt;&gt; because, as you point out in the tutorial, the migratoin scripts work
&gt;&gt; with a fresh schema, generated by the SchemaLoader, not with my Schema
&gt;&gt; classes. Of course it makes perfect sense then that my additions to the
&gt;&gt; Result classes are ignored.
&gt;&gt; Let me change this from a bug report to a documentation request: could
&gt;&gt; you maybe explicitly mention this potentially unintuitive consequence
&gt;&gt; for working with DBIx components? 
&gt;&gt; Thanks!
&gt;&gt; Frank
</div>&gt;
&gt;
&gt;
&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1059292/554495/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/554495">with headers</a>
<br />
<span class="downloadcontenttype">text/html 3.5k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1059299" href="/Public/Bug/Display.html?id=76322#txn-1059299">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;05&nbsp;17:44:33&nbsp;2012</span>
    <span class="description">jjnapiork [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1059299/554500/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/554500">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Apr 05 17:29:57 2012, fschwach wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi John,
&gt; 
&gt; yes, the password problem mirrors my experience and it IS a major
&gt;    gotcha at the moment. Not sure what the solution could be. I guess
&gt;    you need to be able to infer the Schema from the DB at every point
&gt;    during migration so you can run Perl scripts against the Schema at
&gt;    that point.Â 
</div>
Here&#39;s what I did to deal with the password thing.  It&#39;s ugly but works:

use Modern::Perl;
use Digest;
use DateTime;
use DBIx::Class::Migration::RunScript;

migrate {

  return unless $ENV{SEED_SHUTTERSTOCK_EXCHANGE};

  my $encoder = sub {
    my $digester = Digest-&gt;new&#40;&#39;SHA-256&#39;&#41;;
    my &#40;$plain_text&#41; = @_;
    $digester-&gt;add&#40;$plain_text&#41;;
    return $digester-&gt;b64digest;
  };

  my $person_rs = &#40;my $self = shift&#41;
    -&gt;schema-&gt;resultset&#40;&#39;Person&#39;&#41;;

  my &#40;$john, $logan&#41; = map { $person_rs
     -&gt;create&#40;$_&#41; } &#40;
    { handle =&gt; &#39;John&#39;, email =&gt; &#39;johnn@shutterstock.com&#39;, password =&gt; $encoder-&gt;&#40;&#39;abc123&#39;&#41; 
},
    { handle =&gt; &#39;Logan&#39;, email =&gt; &#39;lbell@shutterstock.com&#39;, password =&gt; $encoder-&gt;&#40;&#39;abc123&#39;&#41; 
},
  &#41;;

  my $why_chicken = $john-&gt;create_related&#40;questions =&gt;
    { title =&gt; &#34;Why did the chicken cross the road?&#34;,
      details =&gt; &#34;I saw this chicken one day&#34;,
        asked_on =&gt; DateTime-&gt;now}&#41;;

  my $answer = $logan-&gt;create_related&#40;answers =&gt;
    { content =&gt; &#34;To get to the other side!&#34;, question_id =&gt; $why_chicken-&gt;id }&#41;;

}

Right now I have no ideal solution, unfortunately.  The problem extends to a certain degree to 
DBIC::Fixtures as well.  All this will need more pondering.  I think at least it was good to get this 
far, and hopefully have something that does solve a lot of basic problems.  Now just the 
problems are more edgy.

John

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Ruby&#39;s ActiveRecord::Migration has a very similar
&gt;    caveat: if you want to use a model during migrations, the
&gt;    recommendation is to create a subsitute model class in the
&gt;    migration class itself and of course in AR the attributes of that
&gt;    class are always dynamically inferred from the rows of the
&gt;    corresponding table.
&gt; I&#39;m trying to think how something like that could be done in DBIC but
&gt;    I guess that would mean having to have a copy of all the Schema
&gt;    classes, right?
&gt; 
&gt; Sorry if I can&#39;t be of much help here.
&gt; 
&gt; Cheers,
&gt; 
&gt; Frank
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
&gt; 
<div class="message-stanza open">&gt; &gt;________________________________
&gt; &gt; Von: John Napiorkowski via RT &lt;bug-DBIx-Class-Migration@rt.cpan.org&gt;
&gt; &gt;An: frankschwach@yahoo.de
&gt; &gt;Gesendet: 20:56 Donnerstag, 5.April 2012
&gt; &gt;Betreff: [rt.cpan.org #76322] Unexpected behaviour with TimeStamp
</div>&gt;    component
<div class="message-stanza open">&gt; &gt;
&gt; &gt;&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=76322">https://rt.cpan.org/Ticket/Display.html?id=76322</a></span> &gt;
&gt; &gt;
&gt; &gt;It&#39;s really an annoying little problem, isn&#39;t it?
&gt; &gt;
&gt; &gt;We HAVE to build a schema from the db, but they we get a schema that
</div>&gt;    doesn&#39;t meet
<div class="message-stanza open">&gt; &gt;expectations.Â  I will try to doc this harder, but I am starting to
</div>&gt;    really think the only way to fix
<div class="message-stanza open">&gt; &gt;this is to serialize the actual schema you are using somehow.Â  I will
</div>&gt;    confer with Frew, the
<div class="message-stanza open">&gt; &gt;DBICDH author.
&gt; &gt;
&gt; &gt;I find this gets you in lots of little ways, like I am building a
</div>&gt;    catalyst site that has a user table
<div class="message-stanza open">&gt; &gt;with a sha encoded password &#40;using the DBIC:EncodedColumn comp&#41; and I
</div>&gt;    had to basically
<div class="message-stanza open">&gt; &gt;rewrite that comp just to instert seed data.Â  Really, frustrating.
&gt; &gt;
&gt; &gt;If you have any thoughts other than seriailziing the actual db, I
</div>&gt;    would love to hear them.Â  right
<div class="message-stanza open">&gt; &gt;now I consider this the number 1 pain point.Â  
&gt; &gt;
&gt; &gt;John
&gt; &gt;
&gt; &gt;On Thu Apr 05 14:05:09 2012, fschwach wrote:
<div class="message-stanza open">&gt; &gt;&gt; ok, the penny just dropped and I can now see why this is all
</div></div>&gt;    happening -
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt; because, as you point out in the tutorial, the migratoin scripts
</div></div>&gt;    work
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt; with a fresh schema, generated by the SchemaLoader, not with my
</div></div>&gt;    Schema
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt; classes. Of course it makes perfect sense then that my additions to
</div></div>&gt;    the
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt; Result classes are ignored.
&gt; &gt;&gt; Let me change this from a bug report to a documentation request:
</div></div>&gt;    could
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt; you maybe explicitly mention this potentially unintuitive
</div></div>&gt;    consequence
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt; for working with DBIx components?
&gt; &gt;&gt; Thanks!
&gt; &gt;&gt; Frank
</div>&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt;
&gt; &gt;
</div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1105436" href="/Public/Bug/Display.html?id=76322#txn-1105436">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;02&nbsp;15:28:11&nbsp;2012</span>
    <span class="description">jjnapiork [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1105436/581214/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/581214">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 198b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">ALthough the general issue is still open, and I am working with frew to discuss approaches, I&#39;m 
going to consider this a caveat to the way the system works for now and close this ticket.  

Thanks!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1105438" href="/Public/Bug/Display.html?id=76322#txn-1105438">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;02&nbsp;15:28:11&nbsp;2012</span>
    <span class="description">jjnapiork [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.480924</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
