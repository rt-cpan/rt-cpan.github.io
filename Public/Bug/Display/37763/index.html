<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #37763 for libintl-perl: Locale::gettext_xs::gettext fails when called via Apache2.2 with mod_perl2</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #37763 for libintl-perl: Locale::gettext_xs::gettext fails when called via Apache2.2 with mod_perl2</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/libintl-perl/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/libintl-perl/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/libintl-perl/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/libintl-perl/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/libintl-perl">libintl-perl CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">37763</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/libintl-perl/Active/">libintl-perl</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">GUIDO [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
svysh [...] pn.sinp.msu.ru

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-18278-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.16    </td>
  </tr>
  <tr id="CF-18279-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




TestModPerlHandler.pm<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/487667/241137/TestModPerlHandler.pm">
Fri Jul 18 07:08:35 2008 (1.7k) by alech [...] cpan.org
</a>
</font></li>
</ul>


TestModPerlHandler_pp.pm<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/488222/241471/TestModPerlHandler_pp.pm">
Mon Jul 21 05:30:18 2008 (4.7k) by GUIDO [...] cpan.org
</a>
</font></li>
</ul>


TestModPerlHandler_pp.zip<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/488211/241462/TestModPerlHandler_pp.zip">
Mon Jul 21 03:00:35 2008 (1.2k) by svysh [...] pn.sinp.msu.ru
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;17&nbsp;12:24:19&nbsp;2008</span>
    <span class="description">svysh [...] pn.sinp.msu.ru -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Locale::gettext_xs::gettext fails when called via Apache2.2 with
 mod_perl2</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">libintl-perl-1.16

perl v5.8.8

freebsd 6.3


Locale::gettext_xs::gettext works ok from regular perl script, and from 
under Apache1.3 with mod_perl, and
from under Apache2.2 with mod_cgi.

It does not work from under Apache2.2 with mod_perl2.

&#34;Does not work&#34; means: it returns supplied argument without translating 
it.
Very similar to the explicit bug &#40;reported as #37762&#41; in 
Locale::Messages::select_package ?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;18&nbsp;02:16:42&nbsp;2008</span>
    <span class="description">GUIDO [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;18&nbsp;02:31:14&nbsp;2008</span>
    <span class="description">GUIDO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I successfully use Locale::gettext_xs with Apache 2.2 and mod_perl2, and
since gettext_xs is a mere wrapper around GNU gettext &#40;runtime&#41;, it&#39;s
very unlikely that the behavior you experience is due to a bug in
libintl-perl.  

You can easily test that yourself:

Install Locale::gettext &#40;the C only version&#41;, and make sure that it can
find your .mo file&#40;s&#41;.  You can verify the latter, by running a simple
test script on the command line.  If it is running, try it under
mod_perl2.  If Locale::gettext has the same problem as
Locale::gettext_xs it is a problem of your installation.

How do you select the locale in your application? Try to hardcode the
locale directly with POSIX::setlocale:

    POSIX::setlocale LC_ALL =&gt; &#39;bg_BG.utf8&#39;;

Make sure that the argument you pass is valid, by checking &#34;locale -a&#34;.

Does the pure Perl version &#40;Locale::gettext_pp&#41; work? If it does, switch
to it until you fixed the issue with:

    Locale::Messages-&gt;select_package &#40;&#39;gettext_pp&#39;&#41;;

Don&#39;t worry too much about performance.  Unless you are constantly
calling __something in loops, the pure Perl version can really compete
with the XS version.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;18&nbsp;02:31:16&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;18&nbsp;07:08:35&nbsp;2008</span>
    <span class="description">alech [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Guido,

thanks for your prompt reply. I work with Sergei on the OpenXPKI project
&#40;an open source trustcenter software&#41;, which is where this bug occurs.

On Fri Jul 18 02:31:14 2008, GUIDO wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I successfully use Locale::gettext_xs with Apache 2.2 and mod_perl2, and
&gt; since gettext_xs is a mere wrapper around GNU gettext &#40;runtime&#41;, it&#39;s
&gt; very unlikely that the behavior you experience is due to a bug in
&gt; libintl-perl.  
</div>
On which system do you use this? We have successfully used it under both
Debian and Solaris 10 with Apache 2.2 and mod_perl2, but it fails both
under FreeBSD &#40;on Sergei&#39;s machine&#41; and Mac OS X &#40;on my machine&#41;.

Our &#40;internal&#41; bug report is here for your reference:
<span class="clickylink"><a target="new" rel="nofollow" href="http://sourceforge.net/tracker/index.php?func=detail&#38;aid=1806325&#38;group_id=150124&#38;atid=776757">http://sourceforge.net/tracker/index.php?func=detail&#38;aid=1806325&#38;group_id=150124&#38;atid=776757</a></span>


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; How do you select the locale in your application? Try to hardcode the
&gt; locale directly with POSIX::setlocale:
&gt; 
&gt;     POSIX::setlocale LC_ALL =&gt; &#39;bg_BG.utf8&#39;;
</div>
We are doing &#40;POSIX::&#41;setlocale for LC_MESSAGES and LC_TIME, see
<span class="clickylink"><a target="new" rel="nofollow" href="http://openxpki.svn.sf.net/viewvc/openxpki/trunk/perl-modules/core/trunk/OpenXPKI/i18n.pm?revision=865&#38;view=markup">http://openxpki.svn.sf.net/viewvc/openxpki/trunk/perl-modules/core/trunk/OpenXPKI/i18n.pm?revision=865&#38;view=markup</a></span>
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Make sure that the argument you pass is valid, by checking &#34;locale -a&#34;.
</div>
Yes, I&#39;ve verified that.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Does the pure Perl version &#40;Locale::gettext_pp&#41; work? If it does, switch
&gt; to it until you fixed the issue with:
&gt; 
&gt;     Locale::Messages-&gt;select_package &#40;&#39;gettext_pp&#39;&#41;;
</div>
Sort of. Sometimes it returns the correct result, sometimes just the
identifier - weird ... - !?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Don&#39;t worry too much about performance.  Unless you are constantly
&gt; calling __something in loops, the pure Perl version can really compete
&gt; with the XS version.
</div>
OK, that sounds promising at least, now we only need to get the PP
version running ...

I&#39;ve attached a mod_perl2 handler that we&#39;ve written while debugging
this problem to rule out Mason as the culprit, I&#39;ve attached that for
your reference. From there you can also see that when running gettext
using the command line, everything works fine, so I think mod_perl2 is
involved somehow ...

Thanks again for your help,
Best regards,
  Alex
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">package OpenXPKI::TestModPerlHandler;

use strict;
use warnings;

use Locale::Messages qw &#40;:locale_h :libintl_h nl_putenv bind_textdomain_filter select_package gettext&#41;;
use Locale::gettext_pp;
use POSIX qw &#40;setlocale&#41;;
use Encode;
use Data::Dumper;

sub handler {
    my $r = shift;

    select_package&#40;&#34;gettext_pp&#34;&#41;;
    my $language = &#39;de_DE&#39;;
    my $locale_prefix = &#39;/Users/klink/usr/local/share/locale&#39;;
    my $loc = &#34;${language}.UTF-8&#34;;
    setlocale&#40;&#39;LC_MESSAGES&#39;, $loc&#41;;
    setlocale&#40;&#39;LC_TIME&#39;,     $loc&#41;;
    setlocale&#40;&#39;LC_ALL&#39;,      $loc&#41;;
    Locale::Messages::nl_putenv&#40;&#34;LC_MESSAGES=$loc&#34;&#41;;
    Locale::Messages::nl_putenv&#40;&#34;LC_TIME=$loc&#34;&#41;;
    Locale::Messages::nl_putenv&#40;&#34;LC_ALL=$loc&#34;&#41;;
    Locale::Messages::nl_putenv&#40;&#34;LANG=$loc&#34;&#41;;
    Locale::Messages::nl_putenv&#40;&#34;LANGUAGE=$loc&#34;&#41;;

    my $eall = $ENV{&#39;LC_ALL&#39;};
    my $emessages = $ENV{&#39;LC_MESSAGES&#39;};
    my $elang = $ENV{&#39;LANG&#39;};
    my $elanguage = $ENV{&#39;LANGUAGE&#39;};

    Locale::Messages::textdomain&#40;&#34;openxpki&#34;&#41;;
    Locale::Messages::bindtextdomain&#40;&#34;openxpki&#34;, $locale_prefix&#41;;
    Locale::Messages::bind_textdomain_codeset&#40;&#34;openxpki&#34;, &#34;UTF-8&#34;&#41;;
## This line fails with Apache-2.x on FreeBSD
    my $data = gettext&#40;&#34;I18N_OPENXPKI_CLIENT_HTML_MASON_API_CERT_INFO_TITLE&#34;&#41;;
    my $data_pp = Locale::gettext_pp::gettext&#40;&#39;I18N_OPENXPKI_CLIENT_HTML_MASON_API_CERT_INFO_TITLE&#39;&#41;;
## The next line is an example of suggested workaround
    my $data_cmd = `export LANG=de_DE.UTF-8 &#38;&#38; export LANGUAGE=de_DE.UTF-8 &#38;&#38; /opt/local/bin/gettext -d openxpki I18N_OPENXPKI_CLIENT_HTML_MASON_API_CERT_INFO_TITLE`;
    Encode::_utf8_on&#40;$data&#41;;
    print &#34;Perl gettext: $data\nCommandline: $data\nPerl gettext_pp: $data_pp\n&#34;;

    $Data::Dumper::Sortkeys = 1;
    print Dumper \%ENV;
    return 0;
}

1;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;18&nbsp;08:12:34&nbsp;2008</span>
    <span class="description">svysh [...] pn.sinp.msu.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> svysh [...] pn.sinp.msu.ru</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

Let me clarify.

For me &#40;freebsd 7.0 or 6.3, Apache2.2, modperl2&#41;
Locale::gettext_pp version works just fine. 

Does it mean that locale settings &#40;from the point of view of  xs version&#41;
could be still incorrect?

What could be the reason for pp working, while xs not working?

Regards, Sergei
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;18&nbsp;09:50:23&nbsp;2008</span>
    <span class="description">alech [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Jul 18 08:12:34 2008, svysh wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Let me clarify.
&gt; 
&gt; For me &#40;freebsd 7.0 or 6.3, Apache2.2, modperl2&#41;
&gt; Locale::gettext_pp version works just fine. 
</div>
Does that mean with the TestModPerlHandler, you get consistent
results of what you would expect?

For the record, here is Guido&#39;s reply on the OpenXPKI tracker and my
followup:

rt.cpan.org has problems, so I reply here.

Please check the return value from setlocale.  My suspicion is that it
fails.

One possible reason is that on BSDish systems locale names are
case-sensitive, while they are case-insensitive in the GNU implementation.

In general, since locale names are not portable at all, you usually have
to do a little guessing, in order to find a match.  In fact, you have to do
a lot of guessing ...

Please check out the CVS version of libintl-perl, at
:pserver:anonymous@guido-flohr.net:/home/cvsroot/perl module
&#34;libintl-perl&#34;.  Use an emtpy password.  You will find a file
Locale/Util.pm which contains some routines that do such guesses, maybe
that helps.  If you use it in your project, please rename it, in order to
avoid future conflicts.

Regards,
Guido Flohr

-----

Guido, thanks for your continued support - the next time I&#39;m in Cologne,
I&#39;ll buy you a beer :-&#41;

Code for checking the result of setlocale has been checked in with r1287.
At least on Mac OS X, it does not throw any exceptions, though. In the end,
we have a fixed list of [&#39;en_GB.UTF-8&#39;, &#39;de_DE.UTF-8&#39;, &#39;ru_RU.UTF-8&#39;]
values that we use with setlocale, so I doubt that this is the problem ...
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;21&nbsp;03:00:34&nbsp;2008</span>
    <span class="description">svysh [...] pn.sinp.msu.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> svysh [...] pn.sinp.msu.ru</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Guido,

To be more specific, attached please find by 
mod_perl2 handler and its output.

See how pp version works while xs fails. 

&#40;&#34;I18N_OPENXPKI_CLIENT_HTML_MASON_API_CERT_INFO_TITLE&#34; is a tag,
and &#34;Zertifikat #__SERIAL__&#34; is a correct translation&#41;

Do you think this could be wrong locale settings?

Regards, Sergei

Птн. Июл. 18 08:12:34 2008, svysh писал:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi,
&gt; 
&gt; Let me clarify.
&gt; 
&gt; For me &#40;freebsd 7.0 or 6.3, Apache2.2, modperl2&#41;
&gt; Locale::gettext_pp version works just fine. 
&gt; 
&gt; Does it mean that locale settings &#40;from the point of view of  xs version&#41;
&gt; could be still incorrect?
&gt; 
&gt; What could be the reason for pp working, while xs not working?
&gt; 
&gt; Regards, Sergei
</div></div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/488211/241462/TestModPerlHandler_pp.zip">Download TestModPerlHandler_pp.zip</a><br />
<span class="downloadcontenttype">application/x-zip-compressed 1.2k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;21&nbsp;05:30:17&nbsp;2008</span>
    <span class="description">GUIDO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I modified the handler a little bit, and the output looks like this here:

Did setlocale succeed?
LC_MESSAGES: de_DE.UTF-8
LC_TIME: de_DE.UTF-8
LC_ALL: de_DE.UTF-8
Today: Montag

Perl gettext from Messages:
I18N_OPENXPKI_CLIENT_HTML_MASON_API_CERT_INFO_TITLE
Pure Perl gettext: I18N_OPENXPKI_CLIENT_HTML_MASON_API_CERT_INFO_TITLE
Command_line: I18N_OPENXPKI_CLIENT_HTML_MASON_API_CERT_INFO_TITLE
XS gettext: I18N_OPENXPKI_CLIENT_HTML_MASON_API_CERT_INFO_TITLE
Command_line: I18N_OPENXPKI_CLIENT_HTML_MASON_API_CERT_INFO_TITLE 

The important part is that the calls to setlocale&#40;&#41; all succeed.  You
can also see that changing LC_TIME also worked, because the day of the
week is output in German.  It is no wonder that nothing else gets
translated, because I don&#39;t have your mo files, but that isn&#39;t important.

I think I have to clarify the meaning of the environment for the GNU
implementation of gettext &#40;and libintl-perl, which is mostly compatible
to GNU gettext&#41;.

The file ABOUT-NLS &#40;see for example
<span class="clickylink"><a target="new" rel="nofollow" href="http://cvs.savannah.gnu.org/viewvc/gettext/gettext-tools/ABOUT-NLS?revision=1.12&#38;root=gettext&#38;view=markup">http://cvs.savannah.gnu.org/viewvc/gettext/gettext-tools/ABOUT-NLS?revision=1.12&#38;root=gettext&#38;view=markup</a></span>,
please read part 1.3 &#34;Using this package&#34;&#41; recommends to users &#40;users!
not programs!&#41; to set the LC_* variables to valid locale identifiers on
their system.  The only reason for that is that an internationalized
program should begin like this:

     setlocale &#40;LC_ALL, &#34;&#34;&#41;;

But this is pure convention, and especially server applications like
yours will usually violate that convention on purpose.  The reason for
that convention is that a POSIX compliant setlocale implementation in
the libc will interpret the empty &#40;empty! not undefined!&#41; second
argument so, that it will inspect the various LC_* environment variables
for setting the locale.

There are two more environment variables, LANG and LANGUAGE which have a
special meaning.  LANG defines the user&#39;s preferred language &#40;language
is a LL_CC combination with LL being the 2-letter language code and CC
the optional two-letter country-code&#41;.  LANG is however ignored, if the
locale is set to anything else but &#34;C&#34; or &#34;POSIX&#34;.  The environment
variable LANGUAGE should contain a colon separated list of languages,
for example &#34;de:bg_BG&#34;.  A trailing charset declaration for a language,
for example &#34;de.utf-8&#34; is gracefully stripped off and ignored.  You can
force a certain charset by setting the environment variable
&#34;OUTPUT_CHARSET&#34; to a valid charset definition.  BTW, if you set
LANGUAGE you should still set LANG, not for gettext but for other system
components, see ABOUT-NLS.

So, how does gettext_pp decide on how to search for a messages catalog,
say $locale_prefix/de_DE/LC_MESSAGES? If the environment variable
LANGUAGE is set, then it is split at colons &#40;:&#41; into a list of language
identifiers to try, otherwise it calls setlocale&#40;&#41; with an undefined
second argument.  The return value is the current locale setting &#40;for
the first argument category&#41;.  If the return value matches the expected
format &#40;LL_CC@region.charset, with everything but LL being optional&#41;,
this value is taken.

What happens on the BSD systems, where things don&#39;t work as expected? I
can only guess, but my guess is that your calls to setlocale&#40;&#41; fail &#40;see
my modified handler for a check for that&#41;.  If you use gettext_pp, these
failures are healed, because you override everything with the
environment variable LANGUAGE.   The behavior of GNU gettext is the same
&#40;I hope so at least&#41;, but your system&#39;s gettext may of course be
implemented slightly different.  So, if you want to rely on the
behavior, that LANGUAGE overrides everything else, you should force the
usage of gettext_pp.

Is the day of the week output in German on your test system? If not,
then it is also no wonder that gettext fails to translate the strings,
becauses it uses more or less the same mechanism.

Remember that you actually do a &#40;legitimate&#41; abuse of gettext, by
hardcoding locale identifiers into your code.  The idea of gettext is
that the identifiers are set in the user&#39;s environment, because their
format is completely system-dependent.  On Windows a German locale may
look like &#34;German_Germany.cp1252&#34; instead of &#34;de_DE.utf-8&#34;.  On some
systems case matters, on others it doesn&#39;t.  The exact spelling of
charset identifiers is also system-dependent &#40;&#34;utf8&#34;, &#34;utf-8&#34;, &#34;UTF-8&#34;,
...&#41;.  So, even if you know the language, the country and the charset,
you still have to take wild guesses at a recognized format, and in the
end you can still have a failure, if the desired locale is not installed
at all on the system.  See the file Locale/Util.pm that I mentioned in
my posting on your sourceforge bugtracking system.

The environment variables LANGUAGE and OUTPUT_CHARSET &#40;if honored by
your gettext&#41; are a way out of that dilemma, because they interface
directly with gettext, so that setlocale&#40;&#41; is bypassed when determining
the desired locale.

Final advice, please s/Locale::gettext_pp::&#40;.*&#41;/Locale::gettext::$1/ for
a test.  You have to install Locale::gettext from CPAN for that.  If
Locale::gettext::gettext&#40;&#41; shows the same behavior as gettext_xs from
libintl-perl you can clearly see that it is not a problem of
libintl-perl, but that your system&#39;s gettext simply does not work as you
expect.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">package TestModPerlHandler_pp;

use strict;
use warnings;

use Locale::Messages qw &#40;:locale_h :libintl_h nl_putenv bind_textdomain_filter select_package gettext&#41;;
use POSIX qw &#40;setlocale&#41;;
use Encode;

use Locale::gettext_pp;

sub handler {
    my $r = shift;

    $r-&gt;content_type &#40;&#34;text/html; charset=utf-8&#34;&#41;;

    # Guido: Workaround for a bug in libintl-perl 1.16: Call select_package&#40;&#41;
    # as a class method.  This will work with future versions, too.
    # See <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=37762">http://rt.cpan.org/Ticket/Display.html?id=37762</a></span> for details.
    my $res = Locale::Messages-&gt;select_package&#40;&#34;gettext_pp&#34;&#41;;
    print &#34;&lt;p&gt;Will call module: $res&lt;/p&gt;&#34;;
    my $language = &#39;de_DE&#39;;
    my $locale_prefix = &#39;/usr/local/share/locale&#39;;
    my $loc = &#34;${language}.UTF-8&#34;;
    
    # Guido: You must _always_ check the return value of setlocale&#40;&#41;,
    # when you try to change the locale.  In nine out of ten cases
    # the call fails.
    my $lc_messages = POSIX::setlocale&#40;&#38;POSIX::LC_MESSAGES, $loc&#41;;
    my $lc_time = POSIX::setlocale&#40;&#38;POSIX::LC_TIME,     $loc&#41;;
    my $today = POSIX::strftime &#40;&#34;%A&#34;, localtime&#41;;
    my $lc_all = POSIX::setlocale&#40;&#38;POSIX::LC_ALL,      $loc&#41;;

    $r-&gt;print &#40;&lt;&lt;EOF&#41;;
&lt;pre&gt;
Did setlocale succeed?
LC_MESSAGES: $lc_messages
LC_TIME: $lc_time
LC_ALL: $lc_all
Today: $today
&lt;/pre&gt;
EOF

    if &#40;0&#41; {
    # Guido: This entire block of code is useless, because the environment is
    # irrelevant here.  The environment is _only_ used, when you call
    # setlocale&#40;&#41; with an empty &#40;empty! not undefined&#41; second argument.
    # In that case, the locale is set according to the corresponding
    # environment variable, for example:
    # 
    #     nl_putenv&#40;&#34;LC_MESSAGES=bg_BG.utf8&#34;&#41;;
    #     setlocale &#40;LC_MESSAGES, &#39;&#39;&#41;;
    #
    # In other words: Modifying the environment is too late here, and
    # besides it is not needed.  You always pass a second argument to
    # setlocale, so there is no need for changing the environment.
    #
    # There is one exception to the above: The environment variable
    # LANGUAGE overrides all locales settings set with setlocale&#40;&#41;,
    # at least in gettext_pp.  Furthermore, its format differs from
    # the other envariables, in that it is a colon separated list of
    # languages &#40;languages! not locale identifiers&#41;.  See the comment
    # on it in ABOUT-NLS that comes with all internationalized software
    # packages.
    Locale::Messages::nl_putenv&#40;&#34;LC_MESSAGES=$loc&#34;&#41;;
    Locale::Messages::nl_putenv&#40;&#34;LC_TIME=$loc&#34;&#41;;
    Locale::Messages::nl_putenv&#40;&#34;LC_ALL=$loc&#34;&#41;;
    Locale::Messages::nl_putenv&#40;&#34;LANG=$loc&#34;&#41;;
    Locale::Messages::nl_putenv&#40;&#34;LANGUAGE=$loc&#34;&#41;;

    my $eall = $ENV{&#39;LC_ALL&#39;};
    my $emessages = $ENV{&#39;LC_MESSAGES&#39;};
    my $elang = $ENV{&#39;LANG&#39;};
    my $elanguage = $ENV{&#39;LANGUAGE&#39;};

    print &#34;&lt;p&gt;Before script works&lt;/p&gt;&#34;;
    print &#34;&lt;p&gt;LC_ALL: $eall&lt;/p&gt;&#34;;
    print &#34;&lt;p&gt;LC_MESSAGES: $emessages&lt;/p&gt;&#34;;
    print &#34;&lt;p&gt;LANG: $elang&lt;/p&gt;&#34;;
    print &#34;&lt;p&gt;LANGUAGE: $elanguage&lt;/p&gt;&#34;;
    }

    Locale::Messages::textdomain&#40;&#34;openxpki&#34;&#41;;
    Locale::Messages::bindtextdomain&#40;&#34;openxpki&#34;, $locale_prefix&#41;;
    Locale::Messages::bind_textdomain_codeset&#40;&#34;openxpki&#34;, &#34;UTF-8&#34;&#41;;
## This line calls gettext_pp via Messages::gettext and works ok with Apache-2.x on FreeBSD
    my $data = Locale::Messages::gettext&#40;&#34;I18N_OPENXPKI_CLIENT_HTML_MASON_API_CERT_INFO_TITLE&#34;&#41;;
    Encode::_utf8_on&#40;$data&#41;;
    $r-&gt;print &#40;&#34;Perl gettext from Messages: $data&lt;br/&gt;&#34;&#41;;

    Locale::gettext_pp::textdomain&#40;&#34;openxpki&#34;&#41;;
    Locale::gettext_pp::bindtextdomain&#40;&#34;openxpki&#34;, $locale_prefix&#41;;
    Locale::gettext_pp::bind_textdomain_codeset&#40;&#34;openxpki&#34;, &#34;UTF-8&#34;&#41;;
## This line calls explicitly gettext_pp and works ok on FreeBSD Apache-2.x and mod_perl2
    my $data2 = Locale::gettext_pp::gettext&#40;&#34;I18N_OPENXPKI_CLIENT_HTML_MASON_API_CERT_INFO_TITLE&#34;&#41;;
    my $data3 = Locale::gettext_xs::gettext&#40;&#34;I18N_OPENXPKI_CLIENT_HTML_MASON_API_CERT_INFO_TITLE&#34;&#41;;
## The next line calls gettext from CL
    my $data_cmd = `export LANG=de_DE.UTF-8 &#38;&#38; export LANGUAGE=de_DE.UTF-8 &#38;&#38; /usr/local/bin/gettext -d openxpki I18N_OPENXPKI_CLIENT_HTML_MASON_API_CERT_INFO_TITLE`;

    # Guido: If you want the utf-8 flag &#40;brrrr&#41; set on output from libintl-perl
    # you should use an output filter:
    
    use Locale::Messages qw &#40;turn_utf_8_on bind_textdomain_filter&#41;;
    bind_textdomain_filter openxpki =&gt; \&#38;turn_utf_8_on;
    if &#40;0&#41; {
    Encode::_utf8_on&#40;$data2&#41;;
    Encode::_utf8_on&#40;$data3&#41;;
    }
    $r-&gt;print &#40;&#34;Pure Perl gettext: $data2&lt;br/&gt;Command_line: $data_cmd &lt;br/&gt;&#34;&#41;;
    $r-&gt;print &#40;&#34;XS gettext: $data3&lt;br/&gt;Command_line: $data_cmd &lt;br/&gt;&#34;&#41;;

    # Guido: See above: The environment is irrelevant.
    #print &#34;&lt;p&gt;After script worked&lt;/p&gt;&#34;;
    #print &#34;&lt;p&gt;LC_ALL: $eall&lt;/p&gt;&#34;;
    #print &#34;&lt;p&gt;LC_MESSAGES: $emessages&lt;/p&gt;&#34;;
    #print &#34;&lt;p&gt;LANG: $elang&lt;/p&gt;&#34;;
    #print &#34;&lt;p&gt;LANGUAGE: $elanguage&lt;/p&gt;&#34;;

    return 0;
}

1;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;21&nbsp;09:26:23&nbsp;2008</span>
    <span class="description">svysh [...] pn.sinp.msu.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> svysh [...] pn.sinp.msu.ru</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Guido,

Thank you so much for your detailed message.
I have modified your version of the script to include Locale::gettext&#40;&#41;
call. Its output:

======================================================
Will call module: gettext_pp
Did setlocale succeed?
LC_MESSAGES: de_DE.UTF-8
LC_TIME: de_DE.UTF-8
LC_ALL: de_DE.UTF-8
Today: Montag
Perl gettext from Messages: Zertifikat #__SERIAL__
Pure Perl gettext: Zertifikat #__SERIAL__
Command_line: Zertifikat #__SERIAL__ 
XS gettext: I18N_OPENXPKI_CLIENT_HTML_MASON_API_CERT_INFO_TITLE
Locale::gettext&#40;&#41;: I18N_OPENXPKI_CLIENT_HTML_MASON_API_CERT_INFO_TITLE
======================================================

Seems that locale is set correctly.
Also it follows advice of the system utility &#34;/usr/bin/locale -a&#34;, 
which calls it exactly as &#34;de_DE.UTF-8&#34; in freebsd.

As you see, both Locale::gettext&#40;&#41; and _xs versions do not work.
Using _pp version is a nice workaround, but it seems that
in our particular case &#40;of openxpki&#41; 
its use alone does not resolve all problems. 

The question is not who is to blame, 
the question is how to set &#40;and check?&#41; 
locale in a correct and dedactic way.
So that BSDs are not mistreated.

Thank you very much for your help again.
Regard, Sergei
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;21&nbsp;17:18:05&nbsp;2008</span>
    <span class="description">GUIDO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Zdrasti, Sergei,

if Locale::gettext shows the same behavior as Locale::gettext_xs, it is
clear that this is not a problem with libintl-perl but with the
underlying C library.  The XS versions of libintl-perl and
Locale::gettext are mere wrappers around the C functions.

Does FreeBSD have a tool similar to strace&#40;&#41; for Linux? If there is such
a tool, you could write a mini Perl script that translates the message
in question, and call it from withing mod_perl with strace &#40;you name it
for FreeBSD&#41;.  From the files it is trying to open, you will probably be
able to find the error.  If there is no equivalent to strace&#40;&#41;, I am
clueless now.  You could only recompile the library that implements
gettext&#40;&#41; and friends, and insert some debugging output.

I may get help from a FreeBSD user tomorrow.  If we can reproduce the
problem and find a fix, I&#39;ll let you know.

Mnogo pozdravi ot Bylgariq,
Guido
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;21&nbsp;17:20:32&nbsp;2008</span>
    <span class="description">GUIDO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Jul 18 02:31:14 2008, GUIDO wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;     POSIX::setlocale LC_ALL =&gt; &#39;bg_BG.utf8&#39;;
</div>
Ouch! This is a very common bug, and I have done it myself: Using the
fat comma &#40;=&gt;&#41; will cause the left-hand side to be interpreted as a
string.  But you must use the numerical constant:

      POSIX::setlocale LC_ALL, &#39;bg_BG.utf8&#39;;

This is just for the records, and has nothing to do with the bug.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;21&nbsp;17:35:04&nbsp;2008</span>
    <span class="description">GUIDO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">By the way, does the problem only occur when running under mod_perl2 or
also in CGI scripts?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;21&nbsp;18:56:56&nbsp;2008</span>
    <span class="description">svysh [...] pn.sinp.msu.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> svysh [...] pn.sinp.msu.ru</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Guido,

Thank you very much for your concern.

As mentioned in the very first message:

Locale::gettext_xs::gettext works ok from regular perl script, and from 
under Apache1.3 with mod_perl, and from under Apache2.2 with mod_cgi.
It does not work from under Apache2.2 with mod_perl2.
&#34;Does not work&#34; means: it returns supplied argument without translating 
it.

Regards, Sergei

Пнд. Июл. 21 17:35:04 2008, GUIDO писал:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; By the way, does the problem only occur when running under mod_perl2 
</div>or
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; also in CGI scripts?
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;22&nbsp;06:38:55&nbsp;2008</span>
    <span class="description">svysh [...] pn.sinp.msu.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> svysh [...] pn.sinp.msu.ru</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Пнд. Июл. 21 17:18:05 2008, GUIDO писал:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Does FreeBSD have a tool similar to strace&#40;&#41; for Linux? 
&gt; you could write a mini Perl script that translates the message
&gt; in question, and call it from withing mod_perl with strace
</div>
Hi Guido,

Yes, in freebsd we have classical strace, truss, and also Devel::STrace 
from CPAN, but I do not see much from the output. 

Could you possibly hint about which mini Perl script do you have in 
mind and what do you want to see from it?

Regards, Sergei
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;22&nbsp;07:52:15&nbsp;2008</span>
    <span class="description">GUIDO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The Perl script should look like this:

use strict;

use Locale::gettext_xs qw &#40;textdomain bindtextdomain gettext&#41;;
use POSIX qw &#40;setlocale LC_ALL&#41;;

textdomain &#39;openxpki&#39;;
bindtextdomain openxpki =&gt; &#39;/usr/local/share/locale&#39;;

my $translated = gettext
&#34;I18N_OPENXPKI_CLIENT_HTML_MASON_API_CERT_INFO_TITLE&#34;;

print $translated;
__END__

When you trace it, you can maybe see from the various open&#40;&#41; calls what
goes wrong.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;23&nbsp;08:52:53&nbsp;2008</span>
    <span class="description">GUIDO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span class="clickylink"><a target="new" rel="nofollow" href="http://www.freebsd.org/cgi/man.cgi?query=setlocale&#38;apropos=0&#38;sektion=0&#38;manpath=FreeBSD+4.5-RELEASE&#38;format=html#end">http://www.freebsd.org/cgi/man.cgi?query=setlocale&#38;apropos=0&#38;sektion=0&#38;manpath=FreeBSD+4.5-RELEASE&#38;format=html#end</a></span>

Could that be the reason? See the section &#34;BUGS&#34;.

Until this is fixed: Could you simply set the environment variable
&#34;LANGUAGE&#34; to the desired language, at least for FreeBSD? That should
fix the problem.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;23&nbsp;09:04:17&nbsp;2008</span>
    <span class="description">svysh [...] pn.sinp.msu.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> svysh [...] pn.sinp.msu.ru</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Guido,

Срд. Июл. 23 08:52:53 2008, GUIDO писал:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.freebsd.org/cgi/">http://www.freebsd.org/cgi/</a></span>
</div>man.cgi?query=setlocale&#38;apropos=0&#38;sektion=0&#38;manpath=FreeBSD+4.5-
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; RELEASE&#38;format=html#end
&gt; 
&gt; Could that be the reason? See the section &#34;BUGS&#34;.
</div>
FreeBSD-4.5 which you quote is many years old and out of support.
I was reporting problems with modern versions 6.3 and 7.0 of FreeBSD.
In these version those BUGS are absent:

<span class="clickylink"><a target="new" rel="nofollow" href="http://www.freebsd.org/cgi/">http://www.freebsd.org/cgi/</a></span>
man.cgi?query=setlocale&#38;apropos=0&#38;sektion=0&#38;manpath=FreeBSD+6.3-
stable&#38;format=html

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Until this is fixed: Could you simply set the environment variable
&gt; &#34;LANGUAGE&#34; to the desired language, at least for FreeBSD? That should
&gt; fix the problem.
</div>
I will try. Thank you very much anyway.
Regards, Sergei
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;23&nbsp;09:26:08&nbsp;2008</span>
    <span class="description">svysh [...] pn.sinp.msu.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> svysh [...] pn.sinp.msu.ru</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Could you simply set the environment variable
&gt; &#34;LANGUAGE&#34; to the desired language, at least for FreeBSD? That should
&gt; fix the problem.
</div>
Sorry, I did not catch the point in my previous answer.

In the very first version of my TestModPerlHandler_pp.pm sent to you,
environment variable &#34;LANGUAGE&#34; &#40;and &#34;LANG&#34; too&#41; was set just in case, 
along with all other imaginable ways to explain to everybody, which 
language to use.

And _xs version did not work. 

Maybe you mean something else?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;23&nbsp;09:30:31&nbsp;2008</span>
    <span class="description">GUIDO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">$LANGUAGE: Okay, when you have tried that already, it doesn&#39;t help.

I think the only way to track town the problem is that you somehow trace
the system calls and check which directories resp. files are checked by
the XS version.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;25&nbsp;11:10:26&nbsp;2009</span>
    <span class="description">GUIDO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Seems to be outdated.  Please reopen, if this is still an issue.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;25&nbsp;11:10:28&nbsp;2009</span>
    <span class="description">GUIDO [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
