<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #117942 for PDF-API2: Add file attachment annotations</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #117942 for PDF-API2: Add file attachment annotations</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=PDF-API2">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=PDF-API2">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=PDF-API2">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=PDF-API2">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/PDF-API2">PDF-API2 CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">117942</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=PDF-API2">PDF-API2</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
jv [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-24958-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.028    </td>
  </tr>
  <tr id="CF-24959-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




fileattachment.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1747925/940220/fileattachment.pl">
Mon Sep 11 03:51:37 2017 (5k) by jvromans [...] squirrel.nl
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/1680647/902166/fileattachment.pl">
Fri Nov 04 03:16:38 2016 (4k) by jv [...] cpan.org
</a>
</font></li>
</ul>


PDF-API2-2.028-Annotation-attachment.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1670202/896359/PDF-API2-2.028-Annotation-attachment.patch">
Sun Sep 18 11:17:55 2016 (1.9k) by jv [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=117942">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1670202" href="/Public/Bug/Display.html?id=117942#txn-1670202">#</a>      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;18&nbsp;11:17:55&nbsp;2016</span>
    <span class="description">jv [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Add file attachment annotations</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1670202/896358/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/896358">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 67b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The following patch against 2.028 adds file attachment annotations.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> PDF-API2-2.028-Annotation-attachment.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1670202/896359/PDF-API2-2.028-Annotation-attachment.patch">Download PDF-API2-2.028-Annotation-attachment.patch</a><br />
<span class="downloadcontenttype">text/x-diff 1.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">*** PDF/API2/Annotation.pm~	2016-06-09 00:24:09.000000000 +0200
--- PDF/API2/Annotation.pm	2016-09-18 17:14:50.732315208 +0200
***************
*** 204,209 ****
--- 204,254 ----
      return&#40;$self&#41;;
  }
  
+ =item $ant-&gt;fileattachment $file, %opts
+ 
+ Defines the annotation as a file attachment with file $file and
+ options %opts &#40;-rect, -border, -content &#40;type&#41;, -icon &#40;name&#41;&#41;.
+ 
+ =cut
+ 
+ sub fileattachment {
+     my &#40; $self, $file, %opts &#41; = @_;
+ 
+     # <span class="clickylink"><a target="new" rel="nofollow" href="https://books.google.nl/books?id=1TpDgwNGIK8C&#38;pg=PA97&#38;lpg=PA97&#38;dq=pdf+embeddedfile+fileattachment&#38;source=bl&#38;ots=oGyUXkDBUT&#38;sig=aftnbcBQlkOwcHLPdYxE4pcBIP4&#38;hl=en&#38;sa=X&#38;ved=0ahUKEwjW2vnmjIrPAhXIfxoKHVsACTAQ6AEIQjAF#v=onepage&#38;q=pdf%20embeddedfile%20fileattachment&#38;f=false">https://books.google.nl/books?id=1TpDgwNGIK8C&#38;pg=PA97&#38;lpg=PA97&#38;dq=pdf+embeddedfile+fileattachment&#38;source=bl&#38;ots=oGyUXkDBUT&#38;sig=aftnbcBQlkOwcHLPdYxE4pcBIP4&#38;hl=en&#38;sa=X&#38;ved=0ahUKEwjW2vnmjIrPAhXIfxoKHVsACTAQ6AEIQjAF#v=onepage&#38;q=pdf%20embeddedfile%20fileattachment&#38;f=false</a></span>
+     #
+     # /Annots
+     #  [ &lt;&lt; /FS &lt;&lt; /EF &lt;&lt; /F 8 0 R &gt;&gt; /F &#40;attachment.txt&#41; /Type /F &gt;&gt;
+     #    /Subtype /FileAttachment
+     #    /Contents &#40;attachment.txt&#41;
+     #    /Rect [ 18 796 45 823 ]
+     #  &gt;&gt; ]
+ 
+     my $contentype = delete $opts{-content};
+     my $icontype   = delete $opts{-icon};
+ 
+     $self-&gt;{Subtype} = PDFName&#40;&#39;FileAttachment&#39;&#41;;
+     if &#40; is_utf8&#40;$file&#41;&#41; {
+         # URI must be 7-bit ascii
+         utf8::downgrade&#40;$file&#41;;
+     }
+     $self-&gt;{Contents} = PDFStr&#40;$file&#41;;
+     $self-&gt;{Name} = PDFName&#40; $icontype || &#39;None&#39;&#41;;
+ 
+     $self-&gt;{FS} = PDFDict&#40;&#41;;
+     $self-&gt;{FS}-&gt;{F} = PDFStr&#40;$file&#41;;
+     $self-&gt;{FS}-&gt;{Type} = PDFName&#40;&#39;F&#39;&#41;;
+     $self-&gt;{FS}-&gt;{EF} = PDFDict&#40;$file&#41;;
+     $self-&gt;{FS}-&gt;{EF}-&gt;{F} = PDFDict&#40;$file&#41;;
+     $self-&gt;{&#39; apipdf&#39;}-&gt;new_obj&#40;$self-&gt;{FS}-&gt;{EF}-&gt;{F}&#41;;
+     $self-&gt;{FS}-&gt;{EF}-&gt;{F}-&gt;{Type} = PDFName&#40;&#39;EmbeddedFile&#39;&#41;;
+     $self-&gt;{FS}-&gt;{EF}-&gt;{F}-&gt;{SubType} = PDFName&#40;$contentype&#41; if $contentype;
+     $self-&gt;{FS}-&gt;{EF}-&gt;{F}-&gt;{&#39; streamfile&#39;}=$file;
+ 
+     $self-&gt;rect&#40;@{$opts{-rect}}&#41; if &#40;defined $opts{-rect}&#41;;
+     $self-&gt;border&#40;@{$opts{-border}}&#41; if &#40;defined $opts{-border}&#41;;
+     return&#40;$self&#41;;
+ }
+ 
  =item $ant-&gt;rect $llx, $lly, $urx, $ury
  
  Sets the rectangle of the annotation.
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1680612" href="/Public/Bug/Display.html?id=117942#txn-1680612">#</a>      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;03&nbsp;19:16:32&nbsp;2016</span>
    <span class="description">steve [...] deefs.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1680612/902146/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/902146">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 40b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Merged, thanks.  This will be in v2.031.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1680613" href="/Public/Bug/Display.html?id=117942#txn-1680613">#</a>      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;03&nbsp;19:16:33&nbsp;2016</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1680616" href="/Public/Bug/Display.html?id=117942#txn-1680616">#</a>      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;03&nbsp;19:16:33&nbsp;2016</span>
    <span class="description">steve [...] deefs.net -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1680620" href="/Public/Bug/Display.html?id=117942#txn-1680620">#</a>      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;03&nbsp;19:36:13&nbsp;2016</span>
    <span class="description">steve [...] deefs.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1680620/902154/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/902154">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 190b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Nov 03 19:16:32 2016, SSIMMS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Merged, thanks.  This will be in v2.031.
</div>
... with a couple of changes:

- renamed fileattachment to file_attachment

- renamed -content to -type
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1680647" href="/Public/Bug/Display.html?id=117942#txn-1680647">#</a>      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;04&nbsp;03:16:38&nbsp;2016</span>
    <span class="description">jv [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1680647/902165/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/902165">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 448b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I forgot about this one... I&#39;ve done a lot of development since and I have attached a much improved version. This version has proper appearance handling, and handles custom icons.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; - renamed fileattachment to file_attachment
</div>
&#34;file_attachment&#34; means to me that it is going to file away &#40;action&#41; an attachment. &#34;fileattachment&#34; is a noun, which corresponds better to what it is. At least I think so, but it is probably not worth the discussion.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> fileattachment.pl</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1680647/902166/fileattachment.pl">Download fileattachment.pl</a><br />
<span class="downloadcontenttype">text/x-perl 4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">sub fileattachment {
    my &#40; $self, $file, %opts &#41; = @_;

    my $icon = $opts{-icon} || &#39;PushPin&#39;;
    my @r = @{ $opts{-rect}   } if defined $opts{-rect};
    my @b = @{ $opts{-border} } if defined $opts{-border};

    $self-&gt;{Subtype} = PDFName&#40;&#39;FileAttachment&#39;&#41;;

    if &#40; is_utf8&#40;$file&#41;&#41; {
	# URI must be 7-bit ascii
	utf8::downgrade&#40;$file&#41;;
    }

    # 9 0 obj &lt;&lt;
    #    /Type /Annot
    #    /Subtype /FileAttachment
    #    /Name /PushPin
    #    /C [ 1 1 0 ]
    #    /Contents &#40;test.txt&#41;
    #    /FS &lt;&lt;
    #        /Type /F
    #        /EF &lt;&lt; /F 10 0 R &gt;&gt;
    #        /F &#40;test.txt&#41;
    #    &gt;&gt;
    #    /Rect [ 100 100 200 200 ]
    #    /Border [ 0 0 1 ]
    # &gt;&gt; endobj
    #
    # 10 0 obj &lt;&lt;
    #    /Type /EmbeddedFile
    #    /Length ...
    # &gt;&gt; stream
    # ...
    # endstream endobj

    $self-&gt;{Contents} = PDFStr&#40;$file&#41;;
    # Name will be ignored if there is an AP.
    $self-&gt;{Name} = PDFName&#40;$icon&#41; unless ref&#40;$icon&#41;;
    # $self-&gt;{F} = PDFNum&#40;0b0&#41;;
    $self-&gt;{C} = PDFArray&#40; map { PDFNum&#40;$_&#41; } 1, 1, 0 &#41;;

    # The File Specification.
    $self-&gt;{FS} = PDFDict&#40;&#41;;
    $self-&gt;{FS}-&gt;{F} = PDFStr&#40;$file&#41;;
    $self-&gt;{FS}-&gt;{Type} = PDFName&#40;&#39;F&#39;&#41;;
    $self-&gt;{FS}-&gt;{EF} = PDFDict&#40;$file&#41;;
    $self-&gt;{FS}-&gt;{EF}-&gt;{F} = PDFDict&#40;$file&#41;;
    $self-&gt;{&#39; apipdf&#39;}-&gt;new_obj&#40;$self-&gt;{FS}-&gt;{EF}-&gt;{F}&#41;;
    $self-&gt;{FS}-&gt;{EF}-&gt;{F}-&gt;{Type} = PDFName&#40;&#39;EmbeddedFile&#39;&#41;;
    $self-&gt;{FS}-&gt;{EF}-&gt;{F}-&gt;{&#39; streamfile&#39;} = $file;

    # Set the annotation rectangle and border.
    $self-&gt;rect&#40;@r&#41; if @r;
    $self-&gt;border&#40;@b&#41; if @b;

    # Set the appearance.
    $self-&gt;appearance&#40;$icon, %opts&#41; if $icon;

    return&#40;$self&#41;;
}

sub appearance {
    my &#40; $self, $icon, %opts &#41; = @_;

    return unless $self-&gt;{Subtype}-&gt;val eq &#39;FileAttachment&#39;;

    my @r = @{ $opts{-rect}} if defined $opts{-rect};
    die &#34;insufficient -rect parameters to annotation-&gt;appearance&#40; &#41; &#34;
      unless&#40;scalar @r == 4&#41;;

    # Handle custom icon type &#39;None&#39;.
    if &#40; $icon eq &#39;None&#39; &#41; {
        # It is not clear what viewers will do, so provide an
        # appearance dict with no graphics content.

	# 9 0 obj &lt;&lt;
	#    ...
	#    /AP &lt;&lt; /D 11 0 R /N 11 0 R /R 11 0 R &gt;&gt;
	#    ...
	# &gt;&gt;
	# 11 0 obj &lt;&lt;
	#    /BBox [ 0 0 100 100 ]
	#    /FormType 1
	#    /Length 6
	#    /Matrix [ 1 0 0 1 0 0 ]
	#    /Resources &lt;&lt;
	#        /ProcSet [ /PDF ]
	#    &gt;&gt;
	# &gt;&gt; stream
	# 0 0 m
	# endstream endobj

	$self-&gt;{AP} = PDFDict&#40;&#41;;
	my $d = PDFDict&#40;&#41;;
	$self-&gt;{&#39; apipdf&#39;}-&gt;new_obj&#40;$d&#41;;
	$d-&gt;{FormType} = PDFNum&#40;1&#41;;
	$d-&gt;{Matrix} = PDFArray&#40; map { PDFNum&#40;$_&#41; } 1, 0, 0, 1, 0, 0 &#41;;
	$d-&gt;{Resources} = PDFDict&#40;&#41;;
	$d-&gt;{Resources}-&gt;{ProcSet} = PDFArray&#40; map { PDFName&#40;$_&#41; } qw&#40;PDF&#41;&#41;;
	$d-&gt;{BBox} = PDFArray&#40; map { PDFNum&#40;$_&#41; } 0, 0, $r[2]-$r[0], $r[3]-$r[1] &#41;;
	$d-&gt;{&#39; stream&#39;} = &#34;0 0 m&#34;;
	$self-&gt;{AP}-&gt;{N} = $d;	# normal appearance
	# Should default to N, but be sure.
	$self-&gt;{AP}-&gt;{R} = $d;	# Rollover
	$self-&gt;{AP}-&gt;{D} = $d;	# Down
    }

    # Handle custom icon.
    elsif &#40; ref $icon &#41; {
        # Provide an appearance dict with the image.

	# 9 0 obj &lt;&lt;
	#    ...
	#    /AP &lt;&lt; /D 11 0 R /N 11 0 R /R 11 0 R &gt;&gt;
	#    ...
	# &gt;&gt;
	# 11 0 obj &lt;&lt;
	#    /BBox [ 0 0 1 1 ]
	#    /FormType 1
	#    /Length 13
	#    /Matrix [ 1 0 0 1 0 0 ]
	#    /Resources &lt;&lt;
	#        /ProcSet [ /PDF /Text /ImageB /ImageC /ImageI ]
	#        /XObject &lt;&lt; /PxCBA 7 0 R &gt;&gt;
	#    &gt;&gt;
	# &gt;&gt; stream
	# q /PxCBA Do Q
	# endstream endobj

	$self-&gt;{AP} = PDFDict&#40;&#41;;
	my $d = PDFDict&#40;&#41;;
	$self-&gt;{&#39; apipdf&#39;}-&gt;new_obj&#40;$d&#41;;
	$d-&gt;{FormType} = PDFNum&#40;1&#41;;
	$d-&gt;{Matrix} = PDFArray&#40; map { PDFNum&#40;$_&#41; } 1, 0, 0, 1, 0, 0 &#41;;
	$d-&gt;{Resources} = PDFDict&#40;&#41;;
	$d-&gt;{Resources}-&gt;{ProcSet} = PDFArray&#40; map { PDFName&#40;$_&#41; } qw&#40;PDF Text ImageB ImageC ImageI&#41;&#41;;
	$d-&gt;{Resources}-&gt;{XObject} = PDFDict&#40;&#41;;
	my $im = $icon-&gt;{Name}-&gt;val;
	$d-&gt;{Resources}-&gt;{XObject}-&gt;{$im} = $icon;
	# Note that the image is scaled to one unit in user space.
	$d-&gt;{BBox} = PDFArray&#40; map { PDFNum&#40;$_&#41; } 0, 0, 1, 1 &#41;;
	$d-&gt;{&#39; stream&#39;} = &#34;q /$im Do Q&#34;;
	$self-&gt;{AP}-&gt;{N} = $d;	# normal appearance

	# Should default to N, but be sure.
	$self-&gt;{AP}-&gt;{R} = $d;	# Rollover
	$self-&gt;{AP}-&gt;{D} = $d;	# Down
    }

    return $self;
}
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1700907" href="/Public/Bug/Display.html?id=117942#txn-1700907">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;26&nbsp;13:20:37&nbsp;2017</span>
    <span class="description">steve [...] deefs.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1700907/913454/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/913454">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 177b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m about to do a release, so I&#39;ve backed out your original patch and my changes, and am switching the status back to &#34;open&#34; so I can review your new patch in more detail later.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1700910" href="/Public/Bug/Display.html?id=117942#txn-1700910">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;26&nbsp;13:20:43&nbsp;2017</span>
    <span class="description">steve [...] deefs.net -  Status changed from &#39;patched&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1705282" href="/Public/Bug/Display.html?id=117942#txn-1705282">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;15&nbsp;13:38:42&nbsp;2017</span>
    <span class="description">jv [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1705282/916066/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/916066">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 13b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Any progress?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1747925" href="/Public/Bug/Display.html?id=117942#txn-1747925">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;11&nbsp;03:51:37&nbsp;2017</span>
    <span class="description">jvromans [...] squirrel.nl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #117942] Add file attachment annotations</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 11 Sep 2017 09:49:57 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PDF-API2 [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Johan Vromans &lt;jvromans [...] squirrel.nl&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1747925/940219/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/940219">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 531b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, 26 Jan 2017 13:20:37 -0500, &#34;Steve Simms via RT&#34;
&lt;bug-PDF-API2@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=117942">https://rt.cpan.org/Ticket/Display.html?id=117942</a></span> &gt;
&gt; 
&gt; I&#39;m about to do a release, so I&#39;ve backed out your original patch and my
&gt; changes, and am switching the status back to &#34;open&#34; so I can review your
&gt; new patch in more detail later.
</div>
Please find attached the most recent version of the fileattachment method.
This one has been in production for some six months and may be considered
pretty stable and solid.

Regards,
        Johan
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1747925/940220/fileattachment.pl">Download fileattachment.pl</a><br />
<span class="downloadcontenttype">text/x-perl 5k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1836284" href="/Public/Bug/Display.html?id=117942#txn-1836284">#</a>      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;04&nbsp;13:42:48&nbsp;2019</span>
    <span class="description">PMPERRY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1836284/987278/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/987278">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 50b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">FYI, &#40;code based on&#41; this is added to PDF::Builder
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.564241</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
