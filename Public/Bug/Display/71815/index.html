<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #71815 for XML-Rabbit: Hashes with empty values</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #71815 for XML-Rabbit: Hashes with empty values</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=XML-Rabbit">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=XML-Rabbit">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=XML-Rabbit">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=XML-Rabbit">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/XML-Rabbit">XML-Rabbit CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">71815</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=XML-Rabbit">XML-Rabbit</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">ROBINS [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
jeffery.m.thompson [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-233482-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.1.0    </td>
  </tr>
  <tr id="CF-233483-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=71815">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-990086" href="/Public/Bug/Display.html?id=71815#txn-990086">#</a>      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;20&nbsp;11:35:38&nbsp;2011</span>
    <span class="description">jeffery.m.thompson [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Hashes with empty values</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/990086/515422/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/515422">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Module id = XML::Rabbit
   CPAN_VERSION 0.001000
   UPLOAD DATE  2011-09-27
   INST_VERSION 0.1.0

perl v5.8.8 for x86_64-linux-thread-multi

Linux zoom 2.6.18-274.3.1.el5.centos.plus #1 SMP Wed Sep 7 05:38:58 EDT
2011 x86_64 x86_64 x86_64 GNU/Linux

When using 
has_xpath_value_map &#39;element&#39; =&gt; &#39;./namespace:element&#39;,
   &#39;.&#39; =&gt; &#39;./@attribute&#39;;

On an element with an optional attribute it fails with the following error.

xpath_key value is empty, please revise your xpath_query at  .....
XML::Rabbit::Trait::XpathValueMap::__ANON__&#40;...
XML::Rabbit::Trait::XPath::__ANON__&#40;...
Class::MOP::MIxing::AttributeCore::default&#40;&#39;Class::MOP::Class::__ANON__::SERIAL::7=HASH&#40;0x20894c0&#41;,
..., called at generated method &#40;unknown origin&#41; line 1
 

The ... are reference to the my code locations.


So I have in the xml
&lt;element attribute = &#34;here&#34;&gt;With attribute&lt;/element&gt;
&lt;element&gt;Without attribute&lt;/element&gt;

To fix this so I could have a hash keyed on the element contents with
the attribute as a value I did the following

has_xpath_value_map &#39;element&#39; =&gt; &#39;./namespace:element&#39;,
   &#39;.&#39; =&gt; &#39;concat&#40;./@type, count&#40;./@type&#41;&#41;&#39;;

This allows me to store a zero in the hash value which I can test
against for existence. I was wondering should the map function include
the ability to have a default value for the mapping to handle these
situations where the xpath would not return a value? 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-990430" href="/Public/Bug/Display.html?id=71815#txn-990430">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;21&nbsp;03:40:03&nbsp;2011</span>
    <span class="description">ROBINS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Optional elements in XML throws exception when used with value_map</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/990430/515662/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/515662">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Oct 20 17:35:38 2011, Jeffery.M.Thompson wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; When using
&gt; has_xpath_value_map &#39;element&#39; =&gt; &#39;./namespace:element&#39;,
&gt;    &#39;.&#39; =&gt; &#39;./@attribute&#39;;
&gt; 
&gt; On an element with an optional attribute it fails with the following
&gt; error.
&gt; 
&gt; xpath_key value is empty, please revise your xpath_query at  .....
&gt; XML::Rabbit::Trait::XpathValueMap::__ANON__&#40;...
&gt; XML::Rabbit::Trait::XPath::__ANON__&#40;...
&gt;
</div>Class::MOP::MIxing::AttributeCore::default&#40;&#39;Class::MOP::Class::__ANON__::SERIAL::7=HASH&#40;0x20894c0&#41;,
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; ..., called at generated method &#40;unknown origin&#41; line 1
&gt; 
&gt; So I have in the xml
&gt; &lt;element attribute = &#34;here&#34;&gt;With attribute&lt;/element&gt;
&gt; &lt;element&gt;Without attribute&lt;/element&gt;
&gt; 
&gt; To fix this so I could have a hash keyed on the element contents with
&gt; the attribute as a value I did the following
&gt; 
&gt; has_xpath_value_map &#39;element&#39; =&gt; &#39;./namespace:element&#39;,
&gt;    &#39;.&#39; =&gt; &#39;concat&#40;./@type, count&#40;./@type&#41;&#41;&#39;;
&gt; 
&gt; This allows me to store a zero in the hash value which I can test
&gt; against for existence. I was wondering should the map function include
&gt; the ability to have a default value for the mapping to handle these
&gt; situations where the xpath would not return a value?
</div>
I was aware that optional attributes can cause problems, and I have been
contemplating what would be the correct approach with them. I&#39;m not
entirely sure what is the best solution, to let them end up as undef
&#40;with a Maybe type constraint&#41; or an empty string either in the _value,
_map or _list constructs. I&#39;m leaning towards an empty string, but then
you&#39;d have that situation where a missing attribute should be handled
different from an empty attribute. Not sure how popular it is to devise
XML formats that use this kind of logic. Do you have any experience with
this?

What would be really awesome is if you can create a minimal test case
together with an example XML file that dies when you try it out.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-990432" href="/Public/Bug/Display.html?id=71815#txn-990432">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;21&nbsp;03:40:04&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Give even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-990433" href="/Public/Bug/Display.html?id=71815#txn-990433">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;21&nbsp;03:40:04&nbsp;2011</span>
    <span class="description">ROBINS [...] cpan.org -  Given to ROBINS</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-990458" href="/Public/Bug/Display.html?id=71815#txn-990458">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;21&nbsp;04:46:47&nbsp;2011</span>
    <span class="description">ROBINS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/990458/515680/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/515680">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 599b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve fixed the problem in this commit:

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/robinsmidsrod/XML-Rabbit/commit/529fab42e2021cacecb08d7489445542f4d96531">https://github.com/robinsmidsrod/XML-Rabbit/commit/529fab42e2021cacecb08d7489445542f4d96531</a></span>

Please verify that it indeed solves your problem.

There was a bug where I actually checked the value of the result of the
xpath_value query instead of the xpath_key query when rejecting an
element for the hash because of missing key. I&#39;ve added a test case for
both has_xpath_value_map and has_xpath_object_map.

I&#39;ve also fixed an unnecessary exception when the xpath_key query
returns an empty result. Now I just skip the element instead of throwing
an exception.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-990460" href="/Public/Bug/Display.html?id=71815#txn-990460">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;21&nbsp;04:46:47&nbsp;2011</span>
    <span class="description">ROBINS [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.305547</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
