<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #69336 for XML-LibXML-Simple: ForceArray option too keen to set forcearray_always</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #69336 for XML-LibXML-Simple: ForceArray option too keen to set forcearray_always</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/XML-LibXML-Simple/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/XML-LibXML-Simple/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/XML-LibXML-Simple/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/XML-LibXML-Simple/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/XML-LibXML-Simple">XML-LibXML-Simple CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">69336</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/XML-LibXML-Simple/Active/">XML-LibXML-Simple</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
Matt.W.Johnson [...] morganstanley.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-220530-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-220531-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;07&nbsp;09:34:47&nbsp;2011</span>
    <span class="description">Matt.W.Johnson [...] morganstanley.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> ForceArray option too keen to set forcearray_always</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 7 Jul 2011 14:34:31 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-XML-LibXML-Simple [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Johnson, Matt W&#34; &lt;Matt.W.Johnson [...] morganstanley.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

There is an option handling bug in XML::LibXML::Simple. If the &#34;list of elements&#34; type of ForceArray is used with exactly one element, the internal $opt{forcearray_always} is erroneously set.

The bug affects all versions of XML::LibXML::Simple, up to and including 0.90.

159     my $fa = delete $opt{forcearray};
160     my @fa = ref $fa eq &#39;ARRAY&#39; ? @$fa : defined $fa ? $fa : &#40;&#41;;
161     $opt{forcearray_always}   = &#40;@fa==1 &#38;&#38; !ref $fa[0] &#38;&#38; $fa[0]&#41;;

Where $fa is either:
        undef or 0 &#40;false&#41;
        1 &#40;or otherwise scalar true&#41;
        a reference to an array with at least 2 elements

...this code works correctly. However, if $fa is a reference to a singleton array:

          $opt{forcearray} = [&#39;element&#39;];
159       my $fa = [&#39;element&#39;];
160     my @fa = &#40;&#39;element&#39;&#41;;
161     $opt{forcearray_always} = &#40;1 &#38;&#38; 1 &#38;&#38; 1&#41;;

161 should check that the original $fa was not a reference, not $fa[0].

161     $opt{forcearray_always}   = &#40;@fa==1 &#38;&#38; !ref $fa &#38;&#38; $fa[0]&#41;;

Patch attached against 0.90.

Matt

Matt W. Johnson   
Morgan Stanley | Enterprise Infrastructure   
25 Cabot Square | Canary Wharf | Floor 02   
London, E14 4QA   
Phone: +44 20 7677-3487   
Matt.W.Johnson@morganstanley.com   

--------------------------------------------------------------------------
NOTICE: Morgan Stanley is not acting as a municipal advisor and the opinions or views contained herein are not intended to be, and do not constitute, advice within the meaning of Section 975 of the Dodd-Frank Wall Street Reform and Consumer Protection Act. If you have received this communication in error, please destroy all electronic and paper copies and notify the sender immediately. Mistransmission is not intended to waive confidentiality or privilege. Morgan Stanley reserves the right, to the extent permitted under applicable law, to monitor electronic communications. This message is subject to terms available at the following link: <span class="clickylink"><a target="new" rel="nofollow" href="http://www.morganstanley.com/disclaimers">http://www.morganstanley.com/disclaimers</a></span>. If you cannot access these links, please notify us by reply message and we will send the contents to you. By messaging with Morgan Stanley you consent to the foregoing.
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;07&nbsp;11:59:41&nbsp;2011</span>
    <span class="description">solutions [...] overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #69336] ForceArray option too keen to set forcearray_always</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 7 Jul 2011 17:59:29 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;Johnson, Matt W via RT&#34; &lt;bug-XML-LibXML-Simple [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;solutions [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Johnson, Matt W via RT &#40;bug-XML-LibXML-Simple@rt.cpan.org&#41; [110707 13:34]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; There is an option handling bug in XML::LibXML::Simple.
</div>
It&#39;s a bug alright, but not the correct fix.  There are a few weird
cases with this option. Probably, the line should be

 -  $opt{forcearray_always} = &#40;@fa==1 &#38;&#38; !ref $fa[0] &#38;&#38; $fa[0]&#41;;
 +  $opt{forcearray_always} = @fa==1 &#38;&#38; $fa[0] eq 1;

It&#39;s quite nasty, because their may be a qr//
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;07&nbsp;11:59:43&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;07&nbsp;12:08:09&nbsp;2011</span>
    <span class="description">Matt.W.Johnson [...] morganstanley.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #69336] ForceArray option too keen to set forcearray_always</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 7 Jul 2011 17:07:54 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-XML-LibXML-Simple [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Johnson, Matt W&#34; &lt;Matt.W.Johnson [...] morganstanley.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Well, indeed, &#40;ref&#40;qr//&#41; eq &#39;Regexp&#39;&#41;, but surely the only case for $opt{forcearray_always} to be set is where $fa &#40;i.e. the original $opt{forcearray}&#41; is not a reference &#40;i.e. not a regexp, nor an arrayref&#41; and that $fa is true? &#40;I&#39;m not quite sure why &#40;!ref $fa&#41; is unsafe in this circumstance.&#41;

I&#39;ve patched around the problem for now, but an updated release with a fix would be very much appreciated.

Thanks

Matt

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; -----Original Message-----
&gt; From: Mark Overmeer via RT [mailto:bug-XML-LibXML-Simple@rt.cpan.org]
&gt; Sent: 07 July 2011 17:00
&gt; To: Johnson, Matt W &#40;Enterprise Infrastructure&#41;
&gt; Subject: Re: [rt.cpan.org #69336] ForceArray option too keen to set
&gt; forcearray_always
&gt; 
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=69336">https://rt.cpan.org/Ticket/Display.html?id=69336</a></span> &gt;
&gt; 
&gt; * Johnson, Matt W via RT &#40;bug-XML-LibXML-Simple@rt.cpan.org&#41; [110707
&gt; 13:34]:
<div class="message-stanza open">&gt; &gt; There is an option handling bug in XML::LibXML::Simple.
</div>&gt; 
&gt; It&#39;s a bug alright, but not the correct fix.  There are a few weird
&gt; cases with this option. Probably, the line should be
&gt; 
&gt;  -  $opt{forcearray_always} = &#40;@fa==1 &#38;&#38; !ref $fa[0] &#38;&#38; $fa[0]&#41;;
&gt;  +  $opt{forcearray_always} = @fa==1 &#38;&#38; $fa[0] eq 1;
&gt; 
&gt; It&#39;s quite nasty, because their may be a qr//
&gt; --
&gt; Regards,
&gt;                MarkOv
&gt; 
&gt; -----------------------------------------------------------------------
&gt; -
&gt;        Mark Overmeer MSc                                MARKOV
&gt; Solutions
&gt;        Mark@Overmeer.net
&gt; solutions@overmeer.net
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
&gt; 
</div>

--------------------------------------------------------------------------
NOTICE: Morgan Stanley is not acting as a municipal advisor and the opinions or views contained herein are not intended to be, and do not constitute, advice within the meaning of Section 975 of the Dodd-Frank Wall Street Reform and Consumer Protection Act. If you have received this communication in error, please destroy all electronic and paper copies and notify the sender immediately. Mistransmission is not intended to waive confidentiality or privilege. Morgan Stanley reserves the right, to the extent permitted under applicable law, to monitor electronic communications. This message is subject to terms available at the following link: <span class="clickylink"><a target="new" rel="nofollow" href="http://www.morganstanley.com/disclaimers">http://www.morganstanley.com/disclaimers</a></span>. If you cannot access these links, please notify us by reply message and we will send the contents to you. By messaging with Morgan Stanley you consent to the foregoing.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;08&nbsp;04:46:48&nbsp;2011</span>
    <span class="description">solutions [...] overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #69336] ForceArray option too keen to set forcearray_always</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 8 Jul 2011 10:46:35 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;Johnson, Matt W via RT&#34; &lt;bug-XML-LibXML-Simple [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;solutions [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Johnson, Matt W via RT &#40;bug-XML-LibXML-Simple@rt.cpan.org&#41; [110707 16:08]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ve patched around the problem for now, but an updated release with
&gt; a fix would be very much appreciated.
</div>
I rewrote it again:

    my $fa = delete $opt{forcearray} || 0;
    my &#40;@fa_regex, %fa_elem&#41;;
    if&#40;ref $fa&#41;
     {   foreach &#40;ref $fa eq &#39;ARRAY&#39; ? @$fa : $fa&#41;
         {   if&#40;ref $_ eq &#39;Regexp&#39;&#41; { push @fa_regex, $_ }
             else { $fa_elem{$_} = 1 }
         }
    }
    else { $opt{forcearray_always} = $fa }
    $opt{forcearray_regex} = \@fa_regex;
    $opt{forcearray_elem}  = \%fa_elem;

Hopefully easier to read.
Can you give it a try?  Then I will release a fixed version today.
-- 
Regards,

               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;08&nbsp;05:05:34&nbsp;2011</span>
    <span class="description">Matt.W.Johnson [...] morganstanley.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #69336] ForceArray option too keen to set forcearray_always</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 8 Jul 2011 10:05:18 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-XML-LibXML-Simple [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Johnson, Matt W&#34; &lt;Matt.W.Johnson [...] morganstanley.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Not easy for me to try here directly, but by inspection it looks like the code does indeed do the right thing!

Thanks

Matt

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; -----Original Message-----
&gt; From: Mark Overmeer via RT [mailto:bug-XML-LibXML-Simple@rt.cpan.org]
&gt; Sent: 08 July 2011 09:47
&gt; To: Johnson, Matt W &#40;Enterprise Infrastructure&#41;
&gt; Subject: Re: [rt.cpan.org #69336] ForceArray option too keen to set
&gt; forcearray_always
&gt; 
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=69336">https://rt.cpan.org/Ticket/Display.html?id=69336</a></span> &gt;
&gt; 
&gt; * Johnson, Matt W via RT &#40;bug-XML-LibXML-Simple@rt.cpan.org&#41; [110707
&gt; 16:08]:
<div class="message-stanza open">&gt; &gt; I&#39;ve patched around the problem for now, but an updated release with
&gt; &gt; a fix would be very much appreciated.
</div>&gt; 
&gt; I rewrote it again:
&gt; 
&gt;     my $fa = delete $opt{forcearray} || 0;
&gt;     my &#40;@fa_regex, %fa_elem&#41;;
&gt;     if&#40;ref $fa&#41;
&gt;      {   foreach &#40;ref $fa eq &#39;ARRAY&#39; ? @$fa : $fa&#41;
&gt;          {   if&#40;ref $_ eq &#39;Regexp&#39;&#41; { push @fa_regex, $_ }
&gt;              else { $fa_elem{$_} = 1 }
&gt;          }
&gt;     }
&gt;     else { $opt{forcearray_always} = $fa }
&gt;     $opt{forcearray_regex} = \@fa_regex;
&gt;     $opt{forcearray_elem}  = \%fa_elem;
&gt; 
&gt; Hopefully easier to read.
&gt; Can you give it a try?  Then I will release a fixed version today.
&gt; --
&gt; Regards,
&gt; 
&gt;                MarkOv
&gt; 
&gt; -----------------------------------------------------------------------
&gt; -
&gt;        Mark Overmeer MSc                                MARKOV
&gt; Solutions
&gt;        Mark@Overmeer.net
&gt; solutions@overmeer.net
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
&gt; 
</div>

--------------------------------------------------------------------------
NOTICE: Morgan Stanley is not acting as a municipal advisor and the opinions or views contained herein are not intended to be, and do not constitute, advice within the meaning of Section 975 of the Dodd-Frank Wall Street Reform and Consumer Protection Act. If you have received this communication in error, please destroy all electronic and paper copies and notify the sender immediately. Mistransmission is not intended to waive confidentiality or privilege. Morgan Stanley reserves the right, to the extent permitted under applicable law, to monitor electronic communications. This message is subject to terms available at the following link: <span class="clickylink"><a target="new" rel="nofollow" href="http://www.morganstanley.com/disclaimers">http://www.morganstanley.com/disclaimers</a></span>. If you cannot access these links, please notify us by reply message and we will send the contents to you. By messaging with Morgan Stanley you consent to the foregoing.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;25&nbsp;08:55:00&nbsp;2012</span>
    <span class="description">MARKOV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">fixed in 0.91, released jul 2011
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;25&nbsp;08:55:01&nbsp;2012</span>
    <span class="description">MARKOV [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
