<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #70651 for IO-Tty: Ability to set TTY size specifically</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #70651 for IO-Tty: Ability to set TTY size specifically</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/IO-Tty/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/IO-Tty/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/IO-Tty/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/IO-Tty/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/IO-Tty">IO-Tty CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">70651</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/IO-Tty/Active/">IO-Tty</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">TODDR [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
leonerd-cpan [...] leonerd.org.uk

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-17260-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-17261-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;31&nbsp;14:55:32&nbsp;2011</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Ability to set TTY size specifically</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">It would be useful if, rather than simply cloning the window size from 
some other TTY, that the size could be directly set.

Either of

  my $pty = IO::Pty-&gt;new&#40; cols =&gt; 100, lines =&gt; 30 &#41;;

or

  $pty-&gt;set_size&#40; cols =&gt; 100, lines =&gt; 30 &#41;;

for instance, would be ideal for me.

I am happy to provide a patch if required.

Thanks,

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;01&nbsp;15:11:05&nbsp;2011</span>
    <span class="description">TODDR [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The authors on this module are overloaded &#40;including me&#41;. A patch would be good. Even better 
fork this and I&#39;ll do the release.

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/toddr/IO-Tty">https://github.com/toddr/IO-Tty</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;01&nbsp;15:11:06&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;05&nbsp;15:05:04&nbsp;2012</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Sep 01 15:11:05 2011, TODDR wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The authors on this module are overloaded &#40;including me&#41;. A patch
&gt; would be good.
</div>
Find attached. :&#41;

I have no idea how to test this one though, short of just create a new 
Pty/Tty pair, set a size, check it can be read. Not sure what you want to 
do in terms of unit testing / configure-time checking.

-- 

Paul Evans
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> rt70651.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">=== modified file &#39;Pty.pm&#39;
--- Pty.pm	2012-01-05 19:19:07 +0000
+++ Pty.pm	2012-01-05 19:59:10 +0000
@@ -141,6 +141,8 @@
 }
 
 *clone_winsize_from = \&#38;IO::Tty::clone_winsize_from;
+*get_winsize = \&#38;IO::Tty::get_winsize;
+*set_winsize = \&#38;IO::Tty::set_winsize;
 *set_raw = \&#38;IO::Tty::set_raw;
 
 1;
@@ -254,6 +256,17 @@
 
 See the C&lt;try&gt; script for example code how to propagate SIGWINCH.
 
+=item get_winsize&#40;&#41;
+
+Returns the terminal size, in a 4-element list.
+
+ &#40;$row, $col, $xpixel, $ypixel&#41; = $tty-&gt;get_winsize&#40;&#41;
+
+=item set_winsize&#40;$row, $col, $xpixel, $ypixel&#41;
+
+Sets the terminal size. If not specified, C&lt;$xpixel&gt; and C&lt;$ypixel&gt; are set to
+0.  As with C&lt;clone_winsize_from&gt;, this must be called upon the I&lt;slave&gt;.
+
 =back
 
 

=== modified file &#39;Tty.pm&#39;
--- Tty.pm	2012-01-05 19:19:07 +0000
+++ Tty.pm	2012-01-05 19:59:10 +0000
@@ -62,6 +62,26 @@
   return undef;
 }
 
+# ioctl&#40;&#41; doesn&#39;t tell us how long the structure is, so we&#39;ll have to trim it
+# after TIOCGWINSZ
+my $SIZEOF_WINSIZE = length IO::Tty::pack_winsize&#40;0,0,0,0&#41;;
+
+sub get_winsize {
+  my $self = shift;
+  ioctl&#40;$self, IO::Tty::Constant::TIOCGWINSZ&#40;&#41;, my $winsize&#41;
+    or croak &#34;Cannot TIOCGWINSZ - $!&#34;;
+  substr&#40;$winsize, $SIZEOF_WINSIZE&#41; = &#34;&#34;;
+  printf STDERR &#34;winsize{%d bytes}: %v02x\n&#34;, length $winsize, $winsize;
+  return IO::Tty::unpack_winsize&#40;$winsize&#41;;
+}
+
+sub set_winsize {
+  my $self = shift;
+  my $winsize = IO::Tty::unpack_winsize&#40;@_&#41;;
+  ioctl&#40;$self, IO::Tty::Constant::TIOCSWINSZ&#40;&#41;, $winsize&#41;
+    or croak &#34;Cannot TIOCSWINSZ - $!&#34;;
+}
+
 sub set_raw&#40;$&#41; {
   require POSIX;
   my $self = shift;

=== modified file &#39;Tty.xs&#39;
--- Tty.xs	2012-01-05 19:19:07 +0000
+++ Tty.xs	2012-01-05 19:59:10 +0000
@@ -803,6 +803,39 @@
     OUTPUT:
 	RETVAL
 
+SV *
+pack_winsize&#40;row, col, xpixel = 0, ypixel = 0&#41;
+	int row
+	int col
+	int xpixel
+	int ypixel
+    INIT:
+	struct winsize ws;
+    CODE:
+	ws.ws_row = row;
+	ws.ws_col = col;
+	ws.ws_xpixel = xpixel;
+	ws.ws_ypixel = ypixel;
+	RETVAL = newSVpvn&#40;&#40;char *&#41;&#38;ws, sizeof&#40;ws&#41;&#41;;
+    OUTPUT:
+	RETVAL
+
+void
+unpack_winsize&#40;winsize&#41;
+	SV *winsize;
+    INIT:
+	struct winsize ws;
+    PPCODE:
+	if&#40;SvCUR&#40;winsize&#41; != sizeof&#40;ws&#41;&#41;
+	    croak&#40;&#34;IO::Tty::unpack_winsize&#40;&#41;: Bad arg length - got %d, expected %d&#34;,
+		SvCUR&#40;winsize&#41;, sizeof&#40;ws&#41;&#41;;
+	Copy&#40;SvPV_nolen&#40;winsize&#41;, &#38;ws, sizeof&#40;ws&#41;, char&#41;;
+	EXTEND&#40;SP, 4&#41;;
+	PUSHs&#40;sv_2mortal&#40;newSViv&#40;ws.ws_row&#41;&#41;&#41;;
+	PUSHs&#40;sv_2mortal&#40;newSViv&#40;ws.ws_col&#41;&#41;&#41;;
+	PUSHs&#40;sv_2mortal&#40;newSViv&#40;ws.ws_xpixel&#41;&#41;&#41;;
+	PUSHs&#40;sv_2mortal&#40;newSViv&#40;ws.ws_ypixel&#41;&#41;&#41;;
+
 
 BOOT:
 {

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;05&nbsp;15:17:15&nbsp;2012</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jan 05 15:05:04 2012, PEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Find attached. :&#41;
</div>
Oops, I just noticed there&#39;s a  printf STDERR  in there that ought to be 
removed first. :&#41;

Find attached again.

-- 

Paul Evans
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> rt70651.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">=== modified file &#39;Pty.pm&#39;
--- Pty.pm	2012-01-05 19:19:07 +0000
+++ Pty.pm	2012-01-05 19:57:57 +0000
@@ -141,6 +141,8 @@
 }
 
 *clone_winsize_from = \&#38;IO::Tty::clone_winsize_from;
+*get_winsize = \&#38;IO::Tty::get_winsize;
+*set_winsize = \&#38;IO::Tty::set_winsize;
 *set_raw = \&#38;IO::Tty::set_raw;
 
 1;
@@ -254,6 +256,17 @@
 
 See the C&lt;try&gt; script for example code how to propagate SIGWINCH.
 
+=item get_winsize&#40;&#41;
+
+Returns the terminal size, in a 4-element list.
+
+ &#40;$row, $col, $xpixel, $ypixel&#41; = $tty-&gt;get_winsize&#40;&#41;
+
+=item set_winsize&#40;$row, $col, $xpixel, $ypixel&#41;
+
+Sets the terminal size. If not specified, C&lt;$xpixel&gt; and C&lt;$ypixel&gt; are set to
+0.  As with C&lt;clone_winsize_from&gt;, this must be called upon the I&lt;slave&gt;.
+
 =back
 
 

=== modified file &#39;Tty.pm&#39;
--- Tty.pm	2012-01-05 19:19:07 +0000
+++ Tty.pm	2012-01-05 20:16:31 +0000
@@ -62,6 +62,25 @@
   return undef;
 }
 
+# ioctl&#40;&#41; doesn&#39;t tell us how long the structure is, so we&#39;ll have to trim it
+# after TIOCGWINSZ
+my $SIZEOF_WINSIZE = length IO::Tty::pack_winsize&#40;0,0,0,0&#41;;
+
+sub get_winsize {
+  my $self = shift;
+  ioctl&#40;$self, IO::Tty::Constant::TIOCGWINSZ&#40;&#41;, my $winsize&#41;
+    or croak &#34;Cannot TIOCGWINSZ - $!&#34;;
+  substr&#40;$winsize, $SIZEOF_WINSIZE&#41; = &#34;&#34;;
+  return IO::Tty::unpack_winsize&#40;$winsize&#41;;
+}
+
+sub set_winsize {
+  my $self = shift;
+  my $winsize = IO::Tty::unpack_winsize&#40;@_&#41;;
+  ioctl&#40;$self, IO::Tty::Constant::TIOCSWINSZ&#40;&#41;, $winsize&#41;
+    or croak &#34;Cannot TIOCSWINSZ - $!&#34;;
+}
+
 sub set_raw&#40;$&#41; {
   require POSIX;
   my $self = shift;

=== modified file &#39;Tty.xs&#39;
--- Tty.xs	2012-01-05 19:19:07 +0000
+++ Tty.xs	2012-01-05 19:31:37 +0000
@@ -803,6 +803,39 @@
     OUTPUT:
 	RETVAL
 
+SV *
+pack_winsize&#40;row, col, xpixel = 0, ypixel = 0&#41;
+	int row
+	int col
+	int xpixel
+	int ypixel
+    INIT:
+	struct winsize ws;
+    CODE:
+	ws.ws_row = row;
+	ws.ws_col = col;
+	ws.ws_xpixel = xpixel;
+	ws.ws_ypixel = ypixel;
+	RETVAL = newSVpvn&#40;&#40;char *&#41;&#38;ws, sizeof&#40;ws&#41;&#41;;
+    OUTPUT:
+	RETVAL
+
+void
+unpack_winsize&#40;winsize&#41;
+	SV *winsize;
+    INIT:
+	struct winsize ws;
+    PPCODE:
+	if&#40;SvCUR&#40;winsize&#41; != sizeof&#40;ws&#41;&#41;
+	    croak&#40;&#34;IO::Tty::unpack_winsize&#40;&#41;: Bad arg length - got %d, expected %d&#34;,
+		SvCUR&#40;winsize&#41;, sizeof&#40;ws&#41;&#41;;
+	Copy&#40;SvPV_nolen&#40;winsize&#41;, &#38;ws, sizeof&#40;ws&#41;, char&#41;;
+	EXTEND&#40;SP, 4&#41;;
+	PUSHs&#40;sv_2mortal&#40;newSViv&#40;ws.ws_row&#41;&#41;&#41;;
+	PUSHs&#40;sv_2mortal&#40;newSViv&#40;ws.ws_col&#41;&#41;&#41;;
+	PUSHs&#40;sv_2mortal&#40;newSViv&#40;ws.ws_xpixel&#41;&#41;&#41;;
+	PUSHs&#40;sv_2mortal&#40;newSViv&#40;ws.ws_ypixel&#41;&#41;&#41;;
+
 
 BOOT:
 {

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;06&nbsp;15:21:23&nbsp;2012</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jan 05 15:17:15 2012, PEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Find attached again.
</div>
And -that- one has an unpack where I meant pack.

Third attempt attached.

&#40;Honestly I do know what I&#39;m doing.. ;&#41; &#41;

-- 

Paul Evans
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> rt70651.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">=== modified file &#39;Pty.pm&#39;
--- Pty.pm	2012-01-05 19:19:07 +0000
+++ Pty.pm	2012-01-05 19:57:57 +0000
@@ -141,6 +141,8 @@
 }
 
 *clone_winsize_from = \&#38;IO::Tty::clone_winsize_from;
+*get_winsize = \&#38;IO::Tty::get_winsize;
+*set_winsize = \&#38;IO::Tty::set_winsize;
 *set_raw = \&#38;IO::Tty::set_raw;
 
 1;
@@ -254,6 +256,17 @@
 
 See the C&lt;try&gt; script for example code how to propagate SIGWINCH.
 
+=item get_winsize&#40;&#41;
+
+Returns the terminal size, in a 4-element list.
+
+ &#40;$row, $col, $xpixel, $ypixel&#41; = $tty-&gt;get_winsize&#40;&#41;
+
+=item set_winsize&#40;$row, $col, $xpixel, $ypixel&#41;
+
+Sets the terminal size. If not specified, C&lt;$xpixel&gt; and C&lt;$ypixel&gt; are set to
+0.  As with C&lt;clone_winsize_from&gt;, this must be called upon the I&lt;slave&gt;.
+
 =back
 
 

=== modified file &#39;Tty.pm&#39;
--- Tty.pm	2012-01-05 19:19:07 +0000
+++ Tty.pm	2012-01-05 23:53:02 +0000
@@ -62,6 +62,25 @@
   return undef;
 }
 
+# ioctl&#40;&#41; doesn&#39;t tell us how long the structure is, so we&#39;ll have to trim it
+# after TIOCGWINSZ
+my $SIZEOF_WINSIZE = length IO::Tty::pack_winsize&#40;0,0,0,0&#41;;
+
+sub get_winsize {
+  my $self = shift;
+  ioctl&#40;$self, IO::Tty::Constant::TIOCGWINSZ&#40;&#41;, my $winsize&#41;
+    or croak &#34;Cannot TIOCGWINSZ - $!&#34;;
+  substr&#40;$winsize, $SIZEOF_WINSIZE&#41; = &#34;&#34;;
+  return IO::Tty::unpack_winsize&#40;$winsize&#41;;
+}
+
+sub set_winsize {
+  my $self = shift;
+  my $winsize = IO::Tty::pack_winsize&#40;@_&#41;;
+  ioctl&#40;$self, IO::Tty::Constant::TIOCSWINSZ&#40;&#41;, $winsize&#41;
+    or croak &#34;Cannot TIOCSWINSZ - $!&#34;;
+}
+
 sub set_raw&#40;$&#41; {
   require POSIX;
   my $self = shift;

=== modified file &#39;Tty.xs&#39;
--- Tty.xs	2012-01-05 19:19:07 +0000
+++ Tty.xs	2012-01-05 19:31:37 +0000
@@ -803,6 +803,39 @@
     OUTPUT:
 	RETVAL
 
+SV *
+pack_winsize&#40;row, col, xpixel = 0, ypixel = 0&#41;
+	int row
+	int col
+	int xpixel
+	int ypixel
+    INIT:
+	struct winsize ws;
+    CODE:
+	ws.ws_row = row;
+	ws.ws_col = col;
+	ws.ws_xpixel = xpixel;
+	ws.ws_ypixel = ypixel;
+	RETVAL = newSVpvn&#40;&#40;char *&#41;&#38;ws, sizeof&#40;ws&#41;&#41;;
+    OUTPUT:
+	RETVAL
+
+void
+unpack_winsize&#40;winsize&#41;
+	SV *winsize;
+    INIT:
+	struct winsize ws;
+    PPCODE:
+	if&#40;SvCUR&#40;winsize&#41; != sizeof&#40;ws&#41;&#41;
+	    croak&#40;&#34;IO::Tty::unpack_winsize&#40;&#41;: Bad arg length - got %d, expected %d&#34;,
+		SvCUR&#40;winsize&#41;, sizeof&#40;ws&#41;&#41;;
+	Copy&#40;SvPV_nolen&#40;winsize&#41;, &#38;ws, sizeof&#40;ws&#41;, char&#41;;
+	EXTEND&#40;SP, 4&#41;;
+	PUSHs&#40;sv_2mortal&#40;newSViv&#40;ws.ws_row&#41;&#41;&#41;;
+	PUSHs&#40;sv_2mortal&#40;newSViv&#40;ws.ws_col&#41;&#41;&#41;;
+	PUSHs&#40;sv_2mortal&#40;newSViv&#40;ws.ws_xpixel&#41;&#41;&#41;;
+	PUSHs&#40;sv_2mortal&#40;newSViv&#40;ws.ws_ypixel&#41;&#41;&#41;;
+
 
 BOOT:
 {

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;10&nbsp;03:15:00&nbsp;2012</span>
    <span class="description">TODDR [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;10&nbsp;03:20:11&nbsp;2012</span>
    <span class="description">TODDR [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Jan 06 15:21:23 2012, PEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu Jan 05 15:17:15 2012, PEVANS wrote:
<div class="message-stanza open">&gt; &gt; Find attached again.
</div>&gt; 
&gt; And -that- one has an unpack where I meant pack.
&gt; 
&gt; Third attempt attached.
&gt; 
&gt; &#40;Honestly I do know what I&#39;m doing.. ;&#41; &#41;
</div>

Thanks, this patch looks good at a glance. The best I can tell, you&#39;ve only added new 
functionality, so the risk is relatively low. I&#39;m hesitant to try set_windowsize in a test module 
for fear it might work and anger cpan and cpan testers users alike. Maybe we should just start 
with some basic sanity tests on the return values from get and go with that. 

I&#39;ll try to get a dev release out in a week or so. 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;05&nbsp;11:36:14&nbsp;2014</span>
    <span class="description">TODDR [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Well, it looks like I just accidentally released my work in progress on this into 1.11. We&#39;ll see how that goes and pull it out if there&#39;s a problem.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;05&nbsp;11:36:15&nbsp;2014</span>
    <span class="description">TODDR [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
