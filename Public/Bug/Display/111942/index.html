<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #111942 for DBD-SQLite: Support for sqlite3 missing column metadata feature</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #111942 for DBD-SQLite: Support for sqlite3 missing column metadata feature</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=DBD-SQLite">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=DBD-SQLite">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=DBD-SQLite">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=DBD-SQLite">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBD-SQLite">DBD-SQLite CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">111942</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=DBD-SQLite">DBD-SQLite</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
vlmarek [...] volny.cz

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-10248-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.48    </td>
  </tr>
  <tr id="CF-10249-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




03_no_column_metadata.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1594519/852226/03_no_column_metadata.patch">
Thu Feb 11 04:26:47 2016 (5.1k) by vlmarek [...] volny.cz
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=111942">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1594519" href="/Public/Bug/Display.html?id=111942#txn-1594519">#</a>      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;11&nbsp;04:26:47&nbsp;2016</span>
    <span class="description">vlmarek [...] volny.cz -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Support for sqlite3 missing column metadata feature</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1594519/852225/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/852225">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 831b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

Second issue I have found while packing DBD::SQLite to Solaris. We ship sqlite without
column metadata feature. That causes two issues

a&#41; DBD::SQLite can&#39;t be compiled, because of the -DSQLITE_ENABLE_COLUMN_METADATA parameter used during build.
b&#41; tests against this feature are failing.

The attached patch tries to detect such a condition and act accordingly. The only way I can think off how to detect the compilation options in Makefile.PL is to run sqlite binary and ask. It tries to find the binary in the same way how sqlite.h is located. If the detection fails, Makefile.PL should behave as before - use -DSQLITE_ENABLE_COLUMN_METADATA compile option.

I have tested this with sqlite library on Solaris which does not have column metadata compiled in. Also I have tested building on Solaris with the builtin sqlite.c.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 03_no_column_metadata.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1594519/852226/03_no_column_metadata.patch">Download 03_no_column_metadata.patch</a><br />
<span class="downloadcontenttype">text/x-diff 5.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- DBD-SQLite-1.48/Makefile.PL	2016-02-11 00:39:32.919514864 -0800
+++ DBD-SQLite-1.48/Makefile.PL	2016-02-11 00:39:23.769957270 -0800
@@ -128,14 +128,15 @@ SCOPE: {
 # the system SQLite. We expect that anyone sophisticated enough to use
 # a system sqlite is also sophisticated enough to have a patching system
 # that can change the if &#40; 0 &#41; to if &#40; 1 &#41;
-my &#40;$sqlite_local, $sqlite_base, $sqlite_lib, $sqlite_inc&#41;;
-if &#40; 1 &#41; {
+my &#40;$sqlite_local, $sqlite_base, $sqlite_lib, $sqlite_inc, $sqlite_bin, $compile_opts&#41;;
+if &#40; 1 &#41; {
 	require File::Spec;
 	if &#40; $sqlite_base = &#40;grep&#40;/SQLITE_LOCATION=.*/, @ARGV&#41;&#41;[0] &#41; {
 		$sqlite_base =~ /=&#40;.*&#41;/;
 		$sqlite_base = $1;
 		$sqlite_lib = File::Spec-&gt;catdir&#40; $sqlite_base, &#39;lib&#39;     &#41;;
 		$sqlite_inc = File::Spec-&gt;catdir&#40; $sqlite_base, &#39;include&#39; &#41;;
+		$sqlite_bin = File::Spec-&gt;catdir&#40; $sqlite_base, &#39;bin&#39; &#41;;
 	}
 	if &#40; $sqlite_local = &#40;grep&#40;/USE_LOCAL_SQLITE=.*/, @ARGV&#41;&#41;[0] &#41; {
 		$sqlite_local =~ /=&#40;.*&#41;/;
@@ -144,6 +145,7 @@ if &#40; 0 &#41; {
 			# Keep these from making into CFLAGS/LDFLAGS
 			undef $sqlite_lib;
 			undef $sqlite_inc;
+			undef $sqlite_bin;
 		}
 	}
 
@@ -183,8 +185,32 @@ if &#40; 0 &#41; {
 			$sqlite_local = 1;
 			undef $sqlite_lib;
 			undef $sqlite_inc;
+			undef $sqlite_bin;
 		} else {
 			print &#34;Looks good\n&#34; if $ENV{AUTOMATED_TESTING};
+
+			use FileHandle;
+			use IPC::Open2;
+			if &#40;defined $sqlite_bin&#41; {
+				$sqlite_bin = File::Spec-&gt;catdir&#40; $sqlite_bin, &#39;sqlite3&#39; &#41;;
+			} else {
+				$sqlite_bin = &#39;sqlite3&#39;;
+			}
+			if &#40; open2&#40;*Reader, *Writer, &#34;$sqlite_bin&#34; &#41; &#41; {
+				print Writer &#34;WITH opts&#40;n, opt&#41; AS &#40;
+				  VALUES&#40;0, NULL&#41;
+				  UNION ALL
+				  SELECT n + 1, sqlite_compileoption_get&#40;n&#41;
+				  FROM opts
+				  WHERE sqlite_compileoption_get&#40;n&#41; IS NOT NULL
+				&#41;
+				SELECT opt
+				FROM opts;&#34;;
+				close Writer; # flush
+				$compile_opts = join &#39;&#39;, &lt;Reader&gt;;
+			} else {
+				warn &#34;Can&#39;t execute &#39;$sqlite_bin&#39;:$!&#34;;
+			}
 		}
 	}
 } else {
@@ -223,12 +249,33 @@ my @CC_DEFINE = &#40;
 	&#39;-DSQLITE_ENABLE_FTS4&#39;,             # for sqlite &gt;= 3.7.4
 	&#39;-DSQLITE_ENABLE_FTS3_PARENTHESIS&#39;, # for sqlite &gt;= 3.6.10
 	&#39;-DSQLITE_ENABLE_RTREE&#39;,            # for sqlite &gt;= 3.6.10
-	&#39;-DSQLITE_ENABLE_COLUMN_METADATA&#39;,
 	&#39;-DSQLITE_ENABLE_STAT3&#39;,            # for sqlite &gt;= 3.7.9
 	&#39;-DSQLITE_ENABLE_STAT4&#39;,            # for sqlite &gt;= 3.8.3.1
 	&#39;-DNDEBUG=1&#39;,
 &#41;;
 
+# If we were able to extract compile options from sqlite3 binary and it
+# contains ENABLE_COLUMN_METADATA, enable this option during our compilation
+# too. If we were not able to extract the compilation options for some reason,
+# enable the option too, as this is long time default behavior of this
+# configure script. If we build local sqlite, enable the option too.
+my $reason;
+if &#40; $sqlite_local &#41; {
+	$reason = &#39;we are building against local sqlite3&#39;;
+} elsif &#40; not defined $compile_opts &#41; {
+	$reason = &#34;we can&#39;t extract compile options out of existing sqlite3 binary&#34;;
+} elsif &#40; $compile_opts =~ m/^ENABLE_COLUMN_METADATA$/m &#41; {
+	$reason = &#34;of it&#39;s support in existing sqlite3 binary&#34;;
+}
+
+print &#34;Column metadata are &#34;;
+if &#40; $reason &#41; {
+	push @CC_DEFINE, &#39;-DSQLITE_ENABLE_COLUMN_METADATA&#39;;
+	print &#34;enabled because $reason.\n&#34;;
+} else {
+	print &#34;disabled.\n&#34;;
+}
+
 if &#40;DEVELOPER_ONLY&#41; {
 	# for sqlite &gt;= 3.8.8
 	push @CC_DEFINE, &#39;-DSQLITE_ENABLE_API_ARMOR&#39;;
--- DBD-SQLite-1.48/t/51_table_column_metadata.t	2016-02-11 00:48:50.345243742 -0800
+++ DBD-SQLite-1.48/t/51_table_column_metadata.t	2016-02-11 00:48:26.452736717 -0800
@@ -10,7 +10,17 @@ use t::lib::Test qw/connect_ok @CALL_FUN
 use Test::More;
 use Test::NoWarnings;
 
-plan tests =&gt; 16 * @CALL_FUNCS + 1;
+my $num_tests;
+my $column_metadata; # defined when columnt metadata feature is available
+
+if &#40;grep /ENABLE_COLUMN_METADATA/, DBD::SQLite::compile_options&#40;&#41;&#41; {
+	$num_tests = 16;
+	$column_metadata = 1;
+} else {
+	$num_tests = 12; 
+}
+
+plan tests =&gt; $num_tests * @CALL_FUNCS + 1;
 for my $call_func &#40;@CALL_FUNCS&#41; {
 	my $dbh = connect_ok&#40;RaiseError =&gt; 1&#41;;
 	$dbh-&gt;do&#40;&#39;create table foo &#40;id integer primary key autoincrement, &#34;name space&#34;, unique_col integer unique&#41;&#39;&#41;;
@@ -18,9 +28,11 @@ for my $call_func &#40;@CALL_FUNCS&#41; {
 	{
 		my $data = $dbh-&gt;$call_func&#40;undef, &#39;foo&#39;, &#39;id&#39;, &#39;table_column_metadata&#39;&#41;;
 		ok $data &#38;&#38; ref $data eq ref {}, &#34;got a metadata&#34;;
-		ok $data-&gt;{auto_increment}, &#34;id is auto incremental&#34;;
-		is $data-&gt;{data_type} =&gt; &#39;integer&#39;, &#34;data type is correct&#34;;
-		ok $data-&gt;{primary}, &#34;id is a primary key&#34;;
+		if &#40; $column_metadata &#41; {
+			ok $data-&gt;{auto_increment}, &#34;id is auto incremental&#34;;
+			is $data-&gt;{data_type} =&gt; &#39;integer&#39;, &#34;data type is correct&#34;;
+			ok $data-&gt;{primary}, &#34;id is a primary key&#34;;
+		}
 		ok !$data-&gt;{not_null}, &#34;id is not null&#34;;
 	}
 
@@ -28,7 +40,9 @@ for my $call_func &#40;@CALL_FUNCS&#41; {
 		my $data = $dbh-&gt;$call_func&#40;undef, &#39;foo&#39;, &#39;name space&#39;, &#39;table_column_metadata&#39;&#41;;
 		ok $data &#38;&#38; ref $data eq ref {}, &#34;got a metadata&#34;;
 		ok !$data-&gt;{auto_increment}, &#34;name space is not auto incremental&#34;;
-		is $data-&gt;{data_type} =&gt; undef, &#34;data type is not defined&#34;;
+		if &#40; $column_metadata &#41; {
+			is $data-&gt;{data_type} =&gt; undef, &#34;data type is not defined&#34;;
+		}
 		ok !$data-&gt;{primary}, &#34;name space is not a primary key&#34;;
 		ok !$data-&gt;{not_null}, &#34;name space is not null&#34;;
 	}
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1594522" href="/Public/Bug/Display.html?id=111942#txn-1594522">#</a>      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;11&nbsp;04:29:20&nbsp;2016</span>
    <span class="description">vlmarek [...] volny.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> vlmarek [...] volny.cz</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1594522/852229/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/852229">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 301b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Uh, oh, sorry, the patch won&#39;t probably apply cleanly, it has enabled linking to system sqlite3.so in Makefile.pl. Please change

-if &#40;1&#41; {
+if &#40;1&#41; {

into

-if &#40;0&#41; {
+if &#40;0&#41; {

That said, I should probably change the order in which I apply the patches locally ...

Sorry for the troubles.

__ 
  Vlad
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1594547" href="/Public/Bug/Display.html?id=111942#txn-1594547">#</a>      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;11&nbsp;05:25:14&nbsp;2016</span>
    <span class="description">vlmarek [...] volny.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> vlmarek [...] volny.cz</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1594547/852248/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/852248">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 226b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Oh, I sent the patch too soon, sorry. When testing on sparc, I found out that I have to disable few more tests in the 51_* file. I&#39;ll rework the patch and attach it again. Another possibility would be to disable all the tests.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1594556" href="/Public/Bug/Display.html?id=111942#txn-1594556">#</a>      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;11&nbsp;06:16:32&nbsp;2016</span>
    <span class="description">ishigaki [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1594556/852255/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/852255">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Feb 11 18:26:47 2016, neuron wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi,
&gt; 
&gt; Second issue I have found while packing DBD::SQLite to Solaris. We
&gt; ship sqlite without
&gt; column metadata feature. That causes two issues
&gt; 
&gt; a&#41; DBD::SQLite can&#39;t be compiled, because of the
&gt; -DSQLITE_ENABLE_COLUMN_METADATA parameter used during build.
&gt; b&#41; tests against this feature are failing.
&gt; 
&gt; The attached patch tries to detect such a condition and act
&gt; accordingly. The only way I can think off how to detect the
&gt; compilation options in Makefile.PL is to run sqlite binary and ask. It
&gt; tries to find the binary in the same way how sqlite.h is located. If
&gt; the detection fails, Makefile.PL should behave as before - use
&gt; -DSQLITE_ENABLE_COLUMN_METADATA compile option.
&gt; 
&gt; I have tested this with sqlite library on Solaris which does not have
&gt; column metadata compiled in. Also I have tested building on Solaris
&gt; with the builtin sqlite.c.
</div>

Thanks for the patch, but it seems &#40;to me&#41; a bit overengineered. Migth it be enough to see if &#40;$^O eq &#39;solaris&#39; &#38;&#38; !$sqlite_local&#41; and remove DSQLITE_ENABLE_COLUMN_METADATA from @CC_DEFINE if true?

As for the test failures because of the lack of ENABLE_COLUMN_METADATA, could you  test the latest 1.50 I shipped today? I suppose they have been fixed already.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1594557" href="/Public/Bug/Display.html?id=111942#txn-1594557">#</a>      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;11&nbsp;06:16:33&nbsp;2016</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1594637" href="/Public/Bug/Display.html?id=111942#txn-1594637">#</a>      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;11&nbsp;11:08:33&nbsp;2016</span>
    <span class="description">vlmarek [...] volny.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> vlmarek [...] volny.cz</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1594637/852318/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/852318">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 929b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks for the patch, but it seems &#40;to me&#41; a bit overengineered.
</div>
Fair enough.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Migth it be enough to see if &#40;$^O eq &#39;solaris&#39; &#38;&#38; !$sqlite_local&#41; and
&gt; remove DSQLITE_ENABLE_COLUMN_METADATA from @CC_DEFINE if true?
</div>
For me, yes, that will work. But I don&#39;t think that the problem is
Solaris centric. Any system with sqlite compiled without the column
metadata option will IMO have the same problem. Another way of detecting
the absence of column metadata would be to link sqlite to a test
program. I believe some symbols would be missing. Another option is to
ignore the problem on the base that it is so minor that it&#39;s not worth
the trouble. That is also fine with me.

Basically I&#39;m happy to move any direction you like :&#41;


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As for the test failures because of the lack of
&gt; ENABLE_COLUMN_METADATA, could you  test the latest 1.50 I shipped
&gt; today? I suppose they have been fixed already.
</div>
Will do, thank you
-- 
        Vlad
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1594752" href="/Public/Bug/Display.html?id=111942#txn-1594752">#</a>      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;11&nbsp;16:45:33&nbsp;2016</span>
    <span class="description">vlmarek [...] volny.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> vlmarek [...] volny.cz</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1594752/852385/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/852385">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 283b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As for the test failures because of the lack of
&gt; ENABLE_COLUMN_METADATA, could you  test the latest 1.50 I shipped
&gt; today? I suppose they have been fixed already.
</div>

Yes, I can confirm that. So the only problem is to detect that condition
before compilation.

Thank you
__ 
  Vlad
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1594781" href="/Public/Bug/Display.html?id=111942#txn-1594781">#</a>      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;11&nbsp;21:29:56&nbsp;2016</span>
    <span class="description">ishigaki [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1594781/852397/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/852397">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Feb 12 01:08:33 2016, neuron wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Thanks for the patch, but it seems &#40;to me&#41; a bit overengineered.
</div>&gt; 
&gt; Fair enough.
&gt; 
<div class="message-stanza open">&gt; &gt; Migth it be enough to see if &#40;$^O eq &#39;solaris&#39; &#38;&#38; !$sqlite_local&#41; and
&gt; &gt; remove DSQLITE_ENABLE_COLUMN_METADATA from @CC_DEFINE if true?
</div>&gt; 
&gt; For me, yes, that will work. But I don&#39;t think that the problem is
&gt; Solaris centric. Any system with sqlite compiled without the column
&gt; metadata option will IMO have the same problem.
</div>
Theoretically yes, but nobody else has asked us to fix that, probably because nobody else has needed to, or it&#39;s more natural for others to remove also -DSQLITE_ENABLE_COLUMN_METADATA when you tweak Makefile.PL &#40;with patch or sed or whatever&#41; to change the if &#40; 0 &#41; to if &#40; 1 &#41;.

Generally speaking, a system-specific tweak to avoid some issue on your system should be added in Makefile.PL only if everyone that uses the system is also affected by the issue &#40;like missing pread&#40;&#41; in HP-UX and zone malloc issue in older OSX etc&#41;. I know this isn&#39;t such an issue because I also know from CPAN Testers that metadata itself can be compiled under Solaris. So, I can accept a minimalistic patch for this, but I&#39;d rather like to ask you to just remove the -DSQLITE_ENABLE_COLUMM_METADATA line in your packaging patch, because IMO it&#39;s more simple for both of us.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Another way of detecting
&gt; the absence of column metadata would be to link sqlite to a test
&gt; program. I believe some symbols would be missing. Another option is to
&gt; ignore the problem on the base that it is so minor that it&#39;s not worth
&gt; the trouble. That is also fine with me.
&gt; 
&gt; Basically I&#39;m happy to move any direction you like :&#41;
&gt; 
&gt; 
<div class="message-stanza open">&gt; &gt; As for the test failures because of the lack of
&gt; &gt; ENABLE_COLUMN_METADATA, could you  test the latest 1.50 I shipped
&gt; &gt; today? I suppose they have been fixed already.
</div>&gt; 
&gt; Will do, thank you
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1594823" href="/Public/Bug/Display.html?id=111942#txn-1594823">#</a>      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;12&nbsp;03:20:23&nbsp;2016</span>
    <span class="description">vlmarek [...] volny.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> vlmarek [...] volny.cz</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1594823/852429/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/852429">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 978b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Theoretically yes, but nobody else has asked us to fix that, probably
&gt; because nobody else has needed to, or it&#39;s more natural for others to
&gt; remove also -DSQLITE_ENABLE_COLUMN_METADATA when you tweak Makefile.PL
&gt; &#40;with patch or sed or whatever&#41; to change the if &#40; 0 &#41; to if &#40; 1 &#41;.
&gt; 
&gt; Generally speaking, a system-specific tweak to avoid some issue on
&gt; your system should be added in Makefile.PL only if everyone that uses
&gt; the system is also affected by the issue &#40;like missing pread&#40;&#41; in HP-
&gt; UX and zone malloc issue in older OSX etc&#41;. I know this isn&#39;t such an
&gt; issue because I also know from CPAN Testers that metadata itself can
&gt; be compiled under Solaris. So, I can accept a minimalistic patch for
&gt; this, but I&#39;d rather like to ask you to just remove the
&gt; -DSQLITE_ENABLE_COLUMM_METADATA line in your packaging patch, because
&gt; IMO it&#39;s more simple for both of us.
</div>
No problem for me, thanks for looking into this. I&#39;m going to close the bug now.

__
        Vlad
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1594825" href="/Public/Bug/Display.html?id=111942#txn-1594825">#</a>      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;12&nbsp;03:21:33&nbsp;2016</span>
    <span class="description">vlmarek [...] volny.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> vlmarek [...] volny.cz</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1594825/852431/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/852431">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 185b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; No problem for me, thanks for looking into this. I&#39;m going to close
&gt; the bug now.
</div>
Hmmm, I don&#39;t see a way to close the bug myself, probably you&#39;ll have to do it.

Cheers
__ 
  Vlad
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1595227" href="/Public/Bug/Display.html?id=111942#txn-1595227">#</a>      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;13&nbsp;05:55:29&nbsp;2016</span>
    <span class="description">ishigaki [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1595227/852704/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/852704">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 9b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Closed :&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1595230" href="/Public/Bug/Display.html?id=111942#txn-1595230">#</a>      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;13&nbsp;05:55:35&nbsp;2016</span>
    <span class="description">ishigaki [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.509854</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
