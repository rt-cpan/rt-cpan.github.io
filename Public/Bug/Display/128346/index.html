<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #128346 for DBD-ODBC: Bug: Cannot use Placeholder for LIMIT or OFFSET expressions</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #128346 for DBD-ODBC: Bug: Cannot use Placeholder for LIMIT or OFFSET expressions</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=DBD-ODBC">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=DBD-ODBC">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=DBD-ODBC">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=DBD-ODBC">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBD-ODBC">DBD-ODBC CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">128346</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=DBD-ODBC">DBD-ODBC</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
david [...] justatheory.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10188-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10189-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




odbc-snowsql.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1830836/984717/odbc-snowsql.txt">
Sat Jan 26 11:29:31 2019 (16k) by david [...] justatheory.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=128346">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1830546" href="/Public/Bug/Display.html?id=128346#txn-1830546">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;24&nbsp;14:53:04&nbsp;2019</span>
    <span class="description">david [...] justatheory.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Bug: Cannot use Placeholder for LIMIT or OFFSET expressions</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 24 Jan 2019 11:43:52 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-ODBC [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> David Wheeler &lt;david [...] justatheory.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1830546/984576/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/984576">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">While developing Snowflake support for Sqitch. When preparing statements, I often use placeholders, which are denoted in the query by a question mark &#40;?&#41;. This works great for, say, WHERE clauses; however, it does not work for LIMIT or OFFSET expressions. Sample script:

#!/usr/bin/env perl -w

use strict;
use warnings;
use v5.10;

use DBI;

my $dsn = &#39;dbi:ODBC:Server=iovation.snowflakecomputing.com;Driver=Snowflake&#39;;
my $dbh = DBI-&gt;connect&#40;$dsn, &#39;dwheeler&#39;, &#39;MLcpLLDDy7T7bVrHxe9W2QgECvY.GK]kJdgFfnvQFp&gt;yT&#41;Zx&#39;, {
    PrintError        =&gt; 0,
    RaiseError        =&gt; 1,
    AutoCommit        =&gt; 1,
    odbc_utf8_on      =&gt; 1,
}&#41;;

$dbh-&gt;do&#40;&#39;USE DATABASE dwheeler&#39;&#41;;
$dbh-&gt;do&#40;&#39;USE WAREHOUSE dwheeler&#39;&#41;;

my $sth = $dbh-&gt;prepare&#40;
    &#39;SELECT table_name FROM information_schema.tables LIMIT ?&#39;
&#41;;

$sth-&gt;execute&#40;3&#41;;
say join &#39;, &#39;, @{ $dbh-&gt;selectcol_arrayref&#40;$sth&#41; };

When I run this script, the output is:  Invalid row count &#39;?&#39; in limit clause &#40;SQL-2201W&#41; at /Users/david/bin/try line 24.  Which makes me think that the ? isn&#39;t being parsed and replaced with the argument to execute&#40;&#41;. Note that this does work with other databases, including those that require an ODBC driver.

So I reported it as a bug to Snowflake back in August; they got back to me today. They said:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; We created a small test application that runs the exact same SQL statement on top of our latest ODBC driver:
&gt; 
&gt; ODBC_Class odbc;
&gt; 
&gt; SQLRETURN rc = SQLConnect&#40;odbc.ConHandle, &#40;SQLCHAR *const&#41;&#34;SnowflakeDSII&#34;, SQL_NTS, nullptr, 0, nullptr, 0&#41;;
&gt; 
&gt; odbc.check_rc&#40;rc, LINE, FILE&#41;;
&gt; rc = SQLAllocHandle&#40;SQL_HANDLE_STMT, odbc.ConHandle, &#38;odbc.StmtHandle&#41;;
&gt; 
&gt; odbc.check_rc&#40;rc, LINE, FILE&#41;;
&gt; 
&gt; rc = SQLPrepare&#40;odbc.StmtHandle, &#40;SQLCHAR *&#41;&#34;SELECT table_name FROM information_schema.tables LIMIT ?;&#34;, SQL_NTS&#41;;
&gt; 
&gt; odbc.check_rc&#40;rc, LINE, FILE&#41;;
&gt; 
&gt; int intVal = 3;
&gt; rc = SQLBindParameter&#40;odbc.StmtHandle, 1, SQL_PARAM_INPUT, SQL_C_LONG, SQL_INTEGER, 0, 0, &#38;intVal, 0, NULL&#41;;
&gt; 
&gt; odbc.check_rc&#40;rc, LINE, FILE&#41;;
&gt; 
&gt; rc = SQLExecute&#40;odbc.StmtHandle&#41;;
&gt; odbc.check_rc&#40;rc, LINE, FILE&#41;;
&gt; 
&gt; odbc.GetResultset&#40;true&#41;;
&gt; 
&gt; SQLDisconnect&#40;odbc.ConHandle&#41;;
&gt; }
&gt; 
&gt; It can print out the correct result and there is no error thrown, so I guess there is something happening in this Perl&#39;s DBD:: ODBC library.
</div>
So now I&#39;m reporting it here. Is this an issue in DBD::ODBC or in the Snowflake ODBC driver?

Thanks,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1830830" href="/Public/Bug/Display.html?id=128346#txn-1830830">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;26&nbsp;07:32:00&nbsp;2019</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1830830/984712/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/984712">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jan 24 14:53:04 2019, david@justatheory.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; While developing Snowflake support for Sqitch. When preparing
&gt; statements, I often use placeholders, which are denoted in the query
&gt; by a question mark &#40;?&#41;. This works great for, say, WHERE clauses;
&gt; however, it does not work for LIMIT or OFFSET expressions. Sample
&gt; script:
&gt; 
&gt; #!/usr/bin/env perl -w
&gt; 
&gt; use strict;
&gt; use warnings;
&gt; use v5.10;
&gt; 
&gt; use DBI;
&gt; 
&gt; my $dsn =
&gt; &#39;dbi:ODBC:Server=iovation.snowflakecomputing.com;Driver=Snowflake&#39;;
&gt; my $dbh = DBI-&gt;connect&#40;$dsn, &#39;dwheeler&#39;,
&gt; &#39;MLcpLLDDy7T7bVrHxe9W2QgECvY.GK]kJdgFfnvQFp&gt;yT&#41;Zx&#39;, {
&gt;     PrintError        =&gt; 0,
&gt;     RaiseError        =&gt; 1,
&gt;     AutoCommit        =&gt; 1,
&gt;     odbc_utf8_on      =&gt; 1,
&gt; }&#41;;
&gt; 
&gt; $dbh-&gt;do&#40;&#39;USE DATABASE dwheeler&#39;&#41;;
&gt; $dbh-&gt;do&#40;&#39;USE WAREHOUSE dwheeler&#39;&#41;;
&gt; 
&gt; my $sth = $dbh-&gt;prepare&#40;
&gt;     &#39;SELECT table_name FROM information_schema.tables LIMIT ?&#39;
&gt; &#41;;
&gt; 
&gt; $sth-&gt;execute&#40;3&#41;;
&gt; say join &#39;, &#39;, @{ $dbh-&gt;selectcol_arrayref&#40;$sth&#41; };
&gt; 
&gt; When I run this script, the output is:  Invalid row count &#39;?&#39; in limit
&gt; clause &#40;SQL-2201W&#41; at /Users/david/bin/try line 24.  Which makes me
&gt; think that the ? isn&#39;t being parsed and replaced with the argument to
&gt; execute&#40;&#41;. Note that this does work with other databases, including
&gt; those that require an ODBC driver.
&gt; 
&gt; So I reported it as a bug to Snowflake back in August; they got back
&gt; to me today. They said:
&gt; 
<div class="message-stanza open">&gt; &gt; We created a small test application that runs the exact same SQL
&gt; &gt; statement on top of our latest ODBC driver:
&gt; &gt;
&gt; &gt; ODBC_Class odbc;
&gt; &gt;
&gt; &gt; SQLRETURN rc = SQLConnect&#40;odbc.ConHandle, &#40;SQLCHAR
&gt; &gt; *const&#41;&#34;SnowflakeDSII&#34;, SQL_NTS, nullptr, 0, nullptr, 0&#41;;
&gt; &gt;
&gt; &gt; odbc.check_rc&#40;rc, LINE, FILE&#41;;
&gt; &gt; rc = SQLAllocHandle&#40;SQL_HANDLE_STMT, odbc.ConHandle,
&gt; &gt; &#38;odbc.StmtHandle&#41;;
&gt; &gt;
&gt; &gt; odbc.check_rc&#40;rc, LINE, FILE&#41;;
&gt; &gt;
&gt; &gt; rc = SQLPrepare&#40;odbc.StmtHandle, &#40;SQLCHAR *&#41;&#34;SELECT table_name FROM
&gt; &gt; information_schema.tables LIMIT ?;&#34;, SQL_NTS&#41;;
&gt; &gt;
&gt; &gt; odbc.check_rc&#40;rc, LINE, FILE&#41;;
&gt; &gt;
&gt; &gt; int intVal = 3;
&gt; &gt; rc = SQLBindParameter&#40;odbc.StmtHandle, 1, SQL_PARAM_INPUT,
&gt; &gt; SQL_C_LONG, SQL_INTEGER, 0, 0, &#38;intVal, 0, NULL&#41;;
&gt; &gt;
&gt; &gt; odbc.check_rc&#40;rc, LINE, FILE&#41;;
&gt; &gt;
&gt; &gt; rc = SQLExecute&#40;odbc.StmtHandle&#41;;
&gt; &gt; odbc.check_rc&#40;rc, LINE, FILE&#41;;
&gt; &gt;
&gt; &gt; odbc.GetResultset&#40;true&#41;;
&gt; &gt;
&gt; &gt; SQLDisconnect&#40;odbc.ConHandle&#41;;
&gt; &gt; }
&gt; &gt;
&gt; &gt; It can print out the correct result and there is no error thrown, so
&gt; &gt; I guess there is something happening in this Perl&#39;s DBD:: ODBC
&gt; &gt; library.
</div>&gt; 
&gt; So now I&#39;m reporting it here. Is this an issue in DBD::ODBC or in the
&gt; Snowflake ODBC driver?
&gt; 
&gt; Thanks,
&gt; 
&gt; David
</div>
Thanks for the report David. By sheer coincidence I was looking at sqitch yesterday.

I can&#39;t think of any reason why this would happen right now. Some C code parses the SQL looking for ? but your SQL of &#34;SELECT table_name FROM information_schema.tables LIMIT ?&#34; is so simple I cannot see why it would fail. I think it is more likely to be something like the ODBC driver not supporting SQLDescribeParam.

Can you set DBI_TRACE=15=x.log and export it then run the sample script and send me the log output please.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1830831" href="/Public/Bug/Display.html?id=128346#txn-1830831">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;26&nbsp;07:32:01&nbsp;2019</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1830836" href="/Public/Bug/Display.html?id=128346#txn-1830836">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;26&nbsp;11:29:31&nbsp;2019</span>
    <span class="description">david [...] justatheory.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #128346] Bug: Cannot use Placeholder for LIMIT or OFFSET expressions</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 26 Jan 2019 08:29:09 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Martin J Evans via RT &lt;bug-DBD-ODBC [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> David Wheeler &lt;david [...] justatheory.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1830836/984716/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/984716">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 20b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Here you go.

David
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1830836/984717/odbc-snowsql.txt">Download odbc-snowsql.txt</a><br />
<span class="downloadcontenttype">text/plain 16k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1830865" href="/Public/Bug/Display.html?id=128346#txn-1830865">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;27&nbsp;08:33:05&nbsp;2019</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1830865/984722/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/984722">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Jan 26 11:29:31 2019, david@justatheory.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Here you go.
&gt; 
&gt; David
</div>
There is a difference between C ODBC calls the snowflake guys sent you and what DBD::ODBC did:

check_for_unicode_param - sql_type=unknown, described=VARCHAR
    -get_param_type
      bind 1 3 value_len=1 maxlen=9 null=0&#41;
      bind 1 value_type:1 VARCHAR cs=16777216 dd=0 bl=1
    SQLBindParameter: idx=1: io_type=1, name=1, value_type=1 &#40;SQL_C_CHAR&#41;, SQLType=12 &#40;VARCHAR&#41;, column_size=16777216, d_digits=0, value_ptr=7fc1dd826d90, buffer_length=1, ind=1, param_size=16777216
      Param value = 3
    -rebind_param
    +dbd_st_execute_iv&#40;7fc1dc843ac8&#41;
    dbd_st_finish&#40;7fc1dc843ac8&#41;
    outparams = 0
    SQLExecute/SQLExecDirect&#40;7fc1dd925100&#41;=-1
    !!dbd_error2&#40;err_rc=-1, what=st_execute/SQLExecute, handles=&#40;7fc1db448e90,7fc1db4492d0,7fc1dd925100&#41;
    !SQLError&#40;7fc1db448e90,7fc1db4492d0,7fc1dd925100&#41; = &#40;2201W, 2010, SQL compilation error:
Invalid row count &#39;?&#39; in limit clause&#41;

The invalid row count &#39;?&#39; mislead us, I think it is whinging that the value supplied for that placeholder is invalid. DBD::ODBC did bind the value 3 to that placeholder but as a VARCHAR and not a number and I suspect that is why it complains.

Their ODBC driver describes the parameter as a VARCHAR:

      SQLDescribeParam 1: SqlType=VARCHAR&#40;12&#41; param_size=16777216 Scale=0 Nullable=1

so that is what DBD::ODBC did.

I would probably argue this is a bug in their driver 1&#41; they described it as a VARCHAR 2&#41; then they refused to accept it as a VARCHAR.

You might be able to workaround it by specifying the bind type when you bind the parameter but I cannot test right now.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1831005" href="/Public/Bug/Display.html?id=128346#txn-1831005">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;28&nbsp;10:52:14&nbsp;2019</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1831005/984792/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/984792">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 287b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2019-01-27 08:33:05, MJEVANS wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I would probably argue this is a bug in their driver 1&#41; they described
&gt; it as a VARCHAR 2&#41; then they refused to accept it as a VARCHAR.
</div>
Sounds right to me. Thanks for the analysis, Martin. I&#39;ve followed up in their support issue.

Best,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1831032" href="/Public/Bug/Display.html?id=128346#txn-1831032">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;28&nbsp;13:35:48&nbsp;2019</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1831032/984803/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/984803">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 496b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jan 28 10:52:14 2019, DWHEELER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2019-01-27 08:33:05, MJEVANS wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; I would probably argue this is a bug in their driver 1&#41; they
&gt; &gt; described
&gt; &gt; it as a VARCHAR 2&#41; then they refused to accept it as a VARCHAR.
</div>&gt; 
&gt; Sounds right to me. Thanks for the analysis, Martin. I&#39;ve followed up
&gt; in their support issue.
&gt; 
&gt; Best,
&gt; 
&gt; David
</div>
No problem David. Glad I could help. The workaround might still work for you until they fix it.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1831092" href="/Public/Bug/Display.html?id=128346#txn-1831092">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;28&nbsp;18:09:45&nbsp;2019</span>
    <span class="description">david [...] justatheory.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #128346] Bug: Cannot use Placeholder for LIMIT or OFFSET expressions</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 28 Jan 2019 10:47:02 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Martin J Evans via RT &lt;bug-DBD-ODBC [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> David Wheeler &lt;david [...] justatheory.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1831092/984831/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/984831">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 338b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, Jan 28, 2019, at 10:35 AM, Martin J Evans via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; No problem David. Glad I could help. The workaround might still work for 
&gt; you until they fix it.
</div>
Oh, Sqitch just inlines the value for now.

  <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/sqitchers/sqitch/blob/660ad175817253c484be0471674e876bbfafae42/lib/App/Sqitch/Engine/snowflake.pm#L392">https://github.com/sqitchers/sqitch/blob/660ad175817253c484be0471674e876bbfafae42/lib/App/Sqitch/Engine/snowflake.pm#L392</a></span>

D
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1831237" href="/Public/Bug/Display.html?id=128346#txn-1831237">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;29&nbsp;12:47:47&nbsp;2019</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1831237/984906/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/984906">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 528b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I heard back from Snowflake:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; We have confirmed that this is an issue on Snowflake ODBC driver.
&gt; 
&gt; For SQLDescribeParam&#40;&#41;, SF ODBC driver would only return the number of parameters and hardcode each param type as SQL_VARCHAR with size 16777216.
&gt; 
&gt; Currently, SF ODBC driver doesn’t support SQLDescribeParam which would contain other metadata information such as data type, etc along with a number of bind parameters. 
</div>
They took on the task of fixing it, so I thin you can close this report. Many thanks, Martin!

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1831437" href="/Public/Bug/Display.html?id=128346#txn-1831437">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;30&nbsp;13:12:54&nbsp;2019</span>
    <span class="description">bohica [...] ntlworld.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1831440" href="/Public/Bug/Display.html?id=128346#txn-1831440">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;30&nbsp;13:16:36&nbsp;2019</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1831440/985019/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/985019">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Jan 29 12:47:47 2019, DWHEELER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I heard back from Snowflake:
&gt; 
<div class="message-stanza open">&gt; &gt; We have confirmed that this is an issue on Snowflake ODBC driver.
&gt; &gt;
&gt; &gt; For SQLDescribeParam&#40;&#41;, SF ODBC driver would only return the number
&gt; &gt; of parameters and hardcode each param type as SQL_VARCHAR with size
&gt; &gt; 16777216.
&gt; &gt;
&gt; &gt; Currently, SF ODBC driver doesn’t support SQLDescribeParam which
&gt; &gt; would contain other metadata information such as data type, etc along
&gt; &gt; with a number of bind parameters.
</div>&gt; 
&gt; They took on the task of fixing it, so I thin you can close this
&gt; report. Many thanks, Martin!
&gt; 
&gt; David
</div>
Thanks for getting back to me David. I&#39;ve closed the RT now. However, I suspect they are going to find fixing this somewhat harder than they might imagine given their comments. Accepting the VARCHAR for an integer parameter might not be too bad but providing a good SQLDescribeParam is not easy at all &#40;and I know as I have some experience of this with other databases and writing ODBC drivers for them&#41;.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.579601</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
