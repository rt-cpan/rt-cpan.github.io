<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #131849 for Net-Telnet: Fix for Net::Telnet sabotaging IO handles in perl 5.10</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #131849 for Net-Telnet: Fix for Net::Telnet sabotaging IO handles in perl 5.10</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-Telnet/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-Telnet/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-Telnet/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-Telnet/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-Telnet">Net-Telnet CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">131849</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">patched</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-Telnet/Active/">Net-Telnet</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
DLAMBLEY [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-23316-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
3.03</li>
<li>
3.04</li>
</ul>
    </td>
  </tr>
  <tr id="CF-23317-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;17&nbsp;08:35:15&nbsp;2020</span>
    <span class="description">DLAMBLEY [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Fix for Net::Telnet sabotaging IO handles in perl 5.10</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

The compatibility for ancient perls in supporting both IO::Handle and Filehandle causes filehandles to be broken in 5.10.1 unless you explicitly pull in Filehandle.pm.

The attached patch fixes this by removing this compatibility, as pre 5.6 perls are unlikely to be of interest these days.

I have pushed a development release to get feedback from CPAN Testers, <span class="clickylink"><a target="new" rel="nofollow" href="http://matrix.cpantesters.org/?dist=Net-Telnet+3.04_01">http://matrix.cpantesters.org/?dist=Net-Telnet+3.04_01</a></span>

I have also created a git repository containing this and a POD fix which you may pull from, <span class="clickylink"><a target="new" rel="nofollow" href="https://repo.or.cz/Net-Telnet.git">https://repo.or.cz/Net-Telnet.git</a></span>

Best regards,
Dave
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> io.diff</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">commit fb801ca53ad5028203c27a29b05a16c436d18906
Author: Dave Lambley &lt;dave@lambley.me.uk&gt;
Date:   Mon Feb 17 13:05:08 2020 +0000

    Avoid breaking IO::Handle methods in Perl 5.10.1
    
    From perl5120delta, &#34;Filehandles are now always blessed into IO::File.&#34;
    
    IO::Socket::INET was added to core in 5.6.0, so we should be able to
    rely on it being present.

diff --git a/ChangeLog b/ChangeLog
index 3950fc9..7cb88ed 100644
--- a/ChangeLog
+++ b/ChangeLog
@@ -1,3 +1,5 @@
+	* Break ancient perl compatibility, fix 5.10.1.
+
 2013-04-21  Jay Rogers  &lt;jay@rgrs.com&gt;
 
 	* Version 3.04 released.
diff --git a/Makefile.PL b/Makefile.PL
index 490b47d..3eb0171 100644
--- a/Makefile.PL
+++ b/Makefile.PL
@@ -1,10 +1,22 @@
 ## -*- Perl -*-
 
+use v5.6;
 use ExtUtils::MakeMaker qw&#40;WriteMakefile&#41;;
 
 WriteMakefile&#40;NAME	   =&gt; &#34;Net::Telnet&#34;,
 	      DISTNAME	   =&gt; &#34;Net-Telnet&#34;,
 	      VERSION_FROM =&gt; &#34;lib/Net/Telnet.pm&#34;,
+	      PREREQ_PM =&gt; {
+	          &#34;IO::Handle&#34; =&gt; 0,
+	          &#34;IO::Socket::INET&#34; =&gt; 0,
+	          &#34;Socket&#34; =&gt; 0,
+	          &#34;Symbol&#34; =&gt; 0,
+	          &#34;parent&#34; =&gt; 0,
+	      },
+	      TEST_REQUIRES =&gt; {
+	          &#34;Test::More&#34; =&gt; 0,
+	          &#34;Test::Exception&#34; =&gt; 0,
+	      },
 	      dist	   =&gt; { COMPRESS =&gt; &#34;gzip&#34;, SUFFIX =&gt; &#34;gz&#34; },
 	      &#40;$] &gt;= 5.005 ?
 	       &#40;ABSTRACT   =&gt; &#34;Interact with TELNET port or other TCP ports&#34;,
diff --git a/lib/Net/Telnet.pm b/lib/Net/Telnet.pm
index f0f20fb..eb9b3df 100644
--- a/lib/Net/Telnet.pm
+++ b/lib/Net/Telnet.pm
@@ -29,20 +29,15 @@ use vars qw&#40;@EXPORT_OK&#41;;
 		TELOPT_EXOPL&#41;;
 
 ## Module import.
+use IO::Socket::INET;
+use IO::Handle;
 use Exporter &#40;&#41;;
 use Socket qw&#40;AF_INET SOCK_STREAM inet_aton sockaddr_in&#41;;
 use Symbol qw&#40;qualify&#41;;
 
 ## Base classes.
-use vars qw&#40;@ISA&#41;;
-@ISA = qw&#40;Exporter&#41;;
-if &#40;&#38;_io_socket_include&#41; {  # successfully required module IO::Socket
-    push @ISA, &#34;IO::Socket::INET&#34;;
-}
-else {  # perl version &lt; 5.004
-    require FileHandle;
-    push @ISA, &#34;FileHandle&#34;;
-}
+use parent qw/ Exporter IO::Socket::INET /;
+
 my $AF_INET6 = &#38;_import_af_inet6&#40;&#41;;
 my $AF_UNSPEC = &#38;_import_af_unspec&#40;&#41; || 0;
 my $AI_ADDRCONFIG = &#38;_import_ai_addrconfig&#40;&#41; || 0;
@@ -3311,13 +3306,7 @@ sub _negotiate_recv_enable {
 
 
 sub _new_handle {
-    if &#40;$INC{&#34;IO/Handle.pm&#34;}&#41; {
-	return IO::Handle-&gt;new;
-    }
-    else {
-	require FileHandle;
-	return FileHandle-&gt;new;
-    }
+  return IO::Handle-&gt;new;
 } # end sub _new_handle
 
 
diff --git a/t/eat-filehandle.t b/t/eat-filehandle.t
new file mode 100644
index 0000000..07c21b0
--- /dev/null
+++ b/t/eat-filehandle.t
@@ -0,0 +1,13 @@
+#!/usr/bin/env perl
+
+use Test::More;
+use Test::Exception;
+use Net::Telnet;
+use IO::Handle;
+
+
+open&#40;my $fh, &#34;&lt;&#34;, &#34;/dev/zero&#34;&#41; or die $!;
+
+lives_ok { $fh-&gt;untaint };
+
+done_testing&#40;&#41;;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;17&nbsp;10:31:44&nbsp;2020</span>
    <span class="description">DLAMBLEY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Feb 17 08:35:15 2020, DLAMBLEY wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hello,
&gt; 
&gt; The compatibility for ancient perls in supporting both IO::Handle and
&gt; Filehandle causes filehandles to be broken in 5.10.1 unless you
&gt; explicitly pull in Filehandle.pm.
</div>
The lost compatibility relates to this change, <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/pod/perl5004delta#Internal-change:-FileHandle-class-based-on-IO::*-classes">https://metacpan.org/pod/perl5004delta#Internal-change:-FileHandle-class-based-on-IO::*-classes</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;17&nbsp;10:56:16&nbsp;2020</span>
    <span class="description">jay [...] rgrs.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for your feedback.  I appreciate it.  perl 5.10.1 was released a long time ago.  I am not aware of any IO::Handle or Filehandle problems with Net::Telnet and perl 5.10.1.  Please provide code demonstrating the problem.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;17&nbsp;10:56:16&nbsp;2020</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;17&nbsp;13:09:13&nbsp;2020</span>
    <span class="description">DLAMBLEY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Feb 17 10:56:16 2020, JROGERS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks for your feedback.  I appreciate it.  perl 5.10.1 was released
&gt; a long time ago.  I am not aware of any IO::Handle or Filehandle
&gt; problems with Net::Telnet and perl 5.10.1.  Please provide code
&gt; demonstrating the problem.
</div>
Hi Jay, thank you for getting back to me.

In the patch above I have added t/eat-filehandle.t which reproduces the problem.

You can reproduce the problem on a Centos 6 machine with the perl-Net-Telnet &#40;this gives you version  package installed.

# perl -MIO::Handle -MNet::Telnet -e&#39;open&#40;my $fh, &#34;&lt;&#34;, &#34;/dev/zero&#34;&#41;; $fh-&gt;untaint&#39;
Can&#39;t locate object method &#34;untaint&#34; via package &#34;FileHandle&#34; at -e line 1.

&#40;I brought up a machine with docker run -it centos:6 /bin/bash&#41;

If you remove &#34;-MNet::Telnet&#34;, you no longer get the error. I can also reproduce this on a Debian VM.

The code I have simplified is for backward compatibility for Perl&#39;s before 5.4, hence lacking this change <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/pod/perl5004delta#Internal-change:-FileHandle-class-based-on-IO::*-classes">https://metacpan.org/pod/perl5004delta#Internal-change:-FileHandle-class-based-on-IO::*-classes</a></span>

The problem was fixed in later versions of Perl by <span class="clickylink"><a target="new" rel="nofollow" href="https://perl5.git.perl.org/perl5.git/blobdiff/7c5c215e1c2227e9a83f8a692fa67abe338df835..31c9a3ace4f559b79a21319b8903e92f53b44868:/sv.c">https://perl5.git.perl.org/perl5.git/blobdiff/7c5c215e1c2227e9a83f8a692fa67abe338df835..31c9a3ace4f559b79a21319b8903e92f53b44868:/sv.c</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;18&nbsp;18:09:13&nbsp;2020</span>
    <span class="description">jay [...] rgrs.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dave, I tracked this down to a bug in perl 5.10.1.  The bug is triggered by the lexical presence of this statement even though it is not executed:

    require FileHandle;

I am adding a workaround to Net:Telnet in the next version to eval those statements i.e.

    eval &#34;require FileHandle&#34;;

I see there are some other Net::Telnet tickets I need to address.  I can&#39;t tell you when the next release will be.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;18&nbsp;18:09:13&nbsp;2020</span>
    <span class="description">jay [...] rgrs.com -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
