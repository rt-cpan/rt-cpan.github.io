<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #4437 for Archive-Tar: Missing leading directories in created archive</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #4437 for Archive-Tar: Missing leading directories in created archive</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Archive-Tar/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Archive-Tar/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Archive-Tar/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Archive-Tar/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Archive-Tar">Archive-Tar CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">4437</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Archive-Tar/Active/">Archive-Tar</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
slaven [...] rezic.de

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-2526-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.07    </td>
  </tr>
  <tr id="CF-2527-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;20&nbsp;07:00:32&nbsp;2003</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Missing leading directories in created archive</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">An archive created by Archive::Tar does not create entries for
leading directories. Those archives are handled alright by recent
tar programs, but have problems with older BSD tar programs.

Here&#39;s an example:

env PERL5LIB=$HOME/lib/perl perl -MArchive::Tar -e &#39;Archive::Tar-&gt;create_archive&#40;&#34;/tmp/test.tar&#34;, 0, glob&#40;&#34;/house/eserte12/test/*&#34;&#41;&#41;&#39;

The created archive looks like this:

tar tfv /tmp/test.tar
tar: Blocksize = 5 records
-rw-r--r-- eserte12/nis      0 Nov 20 05:13 2003 a
-rw-r--r-- eserte12/nis      0 Nov 20 05:13 2003 b
-rw-r--r-- eserte12/nis      0 Nov 20 05:13 2003 c

On other systems it would be &#34;house/eserte12/test/a&#34; etc. When extracting
such an archive with an old BSD tar, the leading directories will *not* be created, and you get everything in a flat directory.

I saw this behavior on NetBSD 1.6 and FreeBSD 4.6, but not on FreeBSD 4.8 and RedHat Linux 8.0.

Regards,
    Slaven
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;24&nbsp;12:54:35&nbsp;2003</span>
    <span class="description">kane [...] cpan.org -  Status changed from &#39;new&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;24&nbsp;12:54:59&nbsp;2003</span>
    <span class="description">kane [...] dwim.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Jos I. Boumans&#34; &lt;kane [...] dwim.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #4437] Missing leading directories in created archive </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 24 Nov 2003 18:54:22 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Archive-Tar [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">RT-Send-Cc:</td>
    <td class="message-header-value"> </td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On 20-nov-03, at 13:00, Guest via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; An archive created by Archive::Tar does not create entries for
&gt; leading directories. Those archives are handled alright by recent
&gt; tar programs, but have problems with older BSD tar programs.
</div>
Although probably true, this is wholly and totally to blame on the  
older BSD tar programs, as they simply do not follow the tar spec.  
Instead, they choose to ignore
the &#39;prefix&#39; field in the tar header, or more accurately, are so old  
they are not
aware this field exists...

From: <span class="clickylink"><a target="new" rel="nofollow" href="http://www.opengroup.org/onlinepubs/007904975/utilities/pax.html">http://www.opengroup.org/onlinepubs/007904975/utilities/pax.html</a></span>

&#34;The name and the prefix fields shall produce the pathname of the file.  
A new pathname shall be formed, if prefix is not an empty string &#40;its  
first character is not NUL&#41;, by concatenating prefix &#40;up to the first  
NUL character&#41;, a slash character, and name; otherwise, name is used  
alone. In either case, name is terminated at the first NUL character.  
If prefix begins with a NUL character, it shall be ignored. In this  
manner, pathnames of at most 256 characters can be supported. If a  
pathname does not fit in the space provided, pax shall notify the user  
of the error, and shall not store any part of the file-header or  
data-on the medium.&#34;

it&#39;s amended with:

&#34;The total size of the name and prefix fields have been set to meet the  
minimum requirements for {PATH_MAX}. If a pathname will fit within the  
name field, it is recommended that the pathname be stored there without  
the use of the prefix field. Although the name field is known to be too  
small to contain {PATH_MAX} characters, the value was not changed in  
this version of the archive file format to retain  
backwards-compatibility, and instead the prefix was introduced. Also,  
because of the earlier version of the format, there is no way to remove  
the restriction on the linkname field being limited in size to just  
that of the name field.&#34;


The solution Archive::Tar implements is a &#39;rather safe than sorry&#39;  
solution, which tries to split out dirs from names to avoid having to  
deal with how paths are exactly built up.
Anything going over the 255 byte length that the headers allows for, is  
put in an extended header &#40;the ././@LongLink entries -- which postdates  
even the &#39;prefix&#39; addition&#41;.
Allowing to be totally compatible with &#39;older&#39; tars, it would mean that  
Archive::Tar could not deal with any files longer than a 100 characters  
&#40;since that&#39;s the number of bytes in the header  allocated for the  
&#39;name&#39; field&#41;, which is an even more undesirable solution i think.

Below the sig is a program that demonstrates what i mean...

Sadly, the only course of action that can be taken here is to upgrade  
to versions of tar/gtar that adhere to the current format spec.

--

Jos Boumans

        &#34;You know you are never more indignant in life than when you&#39;re
        shopping at a store you feel is beneath you and one of the other
        customers mistakes you for one of the employees of that store.&#34;
                - Dennis Miller

        CPANPLUS        <span class="clickylink"><a target="new" rel="nofollow" href="http://cpanplus.sf.net">http://cpanplus.sf.net</a></span>


[kane@coke ~...tmp/leading-dir-bug]$ cat x.pl
use Archive::Tar;
use Data::Dumper;
use strict;

my $file = shift;
my $glob = shift;

Archive::Tar-&gt;create_archive&#40;$file,0,glob&#40;$glob&#41;&#41; or die  
Archive::Tar-&gt;error;

my $tar = Archive::Tar-&gt;new&#40;$file&#41;;
print Dumper $_ for $tar-&gt;get_files;

[kane@coke ~...tmp/leading-dir-bug]$ perlc x.pl test.tar  
&#34;/Users/kane/p4/other/archive-tar-new/tmp/leading-dir-bug/foo/*&#34;
$VAR1 = bless&#40; {
                  &#39;mode&#39; =&gt; 33188,
                  &#39;linkname&#39; =&gt; &#39;&#39;,
                  &#39;gid&#39; =&gt; 502,
                  &#39;magic&#39; =&gt; &#39;ustar&#39;,
                  &#39;data&#39; =&gt; &#39;&#39;,
                  &#39;name&#39; =&gt;  
&#39;Users/kane/p4/other/archive-tar-new/tmp/leading-dir-bug/foo/a&#39;,
                  &#39;mtime&#39; =&gt; 1069695358,
                  &#39;size&#39; =&gt; 0,
                  &#39;uid&#39; =&gt; 502,
                  &#39;version&#39; =&gt; &#39;00&#39;,
                  &#39;raw&#39; =&gt; &#39;a100644000766000766          0 7760440576  
23236  
0ustar00kanekane000000000000Users/kane/p4/other/archive-tar-new/tmp/ 
leading-dir-bug/foo&#39;,
                  &#39;type&#39; =&gt; &#39;0&#39;,
                  &#39;uname&#39; =&gt; &#39;kane&#39;,
                  &#39;devmajor&#39; =&gt; 0,
                  &#39;devminor&#39; =&gt; 0,
                  &#39;prefix&#39; =&gt;  
&#39;Users/kane/p4/other/archive-tar-new/tmp/leading-dir-bug/foo&#39;,
                  &#39;chksum&#39; =&gt; 9886,
                  &#39;gname&#39; =&gt; &#39;kane&#39;
                }, &#39;Archive::Tar::File&#39; &#41;;
$VAR1 = bless&#40; {
                  &#39;mode&#39; =&gt; 33188,
                  &#39;linkname&#39; =&gt; &#39;&#39;,
                  &#39;gid&#39; =&gt; 502,
                  &#39;magic&#39; =&gt; &#39;ustar&#39;,
                  &#39;data&#39; =&gt; &#39;&#39;,
                  &#39;name&#39; =&gt;  
&#39;Users/kane/p4/other/archive-tar-new/tmp/leading-dir-bug/foo/b&#39;,
                  &#39;mtime&#39; =&gt; 1069695358,
                  &#39;size&#39; =&gt; 0,
                  &#39;uid&#39; =&gt; 502,
                  &#39;version&#39; =&gt; &#39;00&#39;,
                  &#39;raw&#39; =&gt; &#39;b100644000766000766          0 7760440576  
23237  
0ustar00kanekane000000000000Users/kane/p4/other/archive-tar-new/tmp/ 
leading-dir-bug/foo&#39;,
                  &#39;type&#39; =&gt; &#39;0&#39;,
                  &#39;uname&#39; =&gt; &#39;kane&#39;,
                  &#39;devmajor&#39; =&gt; 0,
                  &#39;devminor&#39; =&gt; 0,
                  &#39;prefix&#39; =&gt;  
&#39;Users/kane/p4/other/archive-tar-new/tmp/leading-dir-bug/foo&#39;,
                  &#39;chksum&#39; =&gt; 9887,
                  &#39;gname&#39; =&gt; &#39;kane&#39;
                }, &#39;Archive::Tar::File&#39; &#41;;
$VAR1 = bless&#40; {
                  &#39;mode&#39; =&gt; 33188,
                  &#39;linkname&#39; =&gt; &#39;&#39;,
                  &#39;gid&#39; =&gt; 502,
                  &#39;magic&#39; =&gt; &#39;ustar&#39;,
                  &#39;data&#39; =&gt; &#39;&#39;,
                  &#39;name&#39; =&gt;  
&#39;Users/kane/p4/other/archive-tar-new/tmp/leading-dir-bug/foo/c&#39;,
                  &#39;mtime&#39; =&gt; 1069695358,
                  &#39;size&#39; =&gt; 0,
                  &#39;uid&#39; =&gt; 502,
                  &#39;version&#39; =&gt; &#39;00&#39;,
                  &#39;raw&#39; =&gt; &#39;c100644000766000766          0 7760440576  
23240  
0ustar00kanekane000000000000Users/kane/p4/other/archive-tar-new/tmp/ 
leading-dir-bug/foo&#39;,
                  &#39;type&#39; =&gt; &#39;0&#39;,
                  &#39;uname&#39; =&gt; &#39;kane&#39;,
                  &#39;devmajor&#39; =&gt; 0,
                  &#39;devminor&#39; =&gt; 0,
                  &#39;prefix&#39; =&gt;  
&#39;Users/kane/p4/other/archive-tar-new/tmp/leading-dir-bug/foo&#39;,
                  &#39;chksum&#39; =&gt; 9888,
                  &#39;gname&#39; =&gt; &#39;kane&#39;
                }, &#39;Archive::Tar::File&#39; &#41;;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;24&nbsp;12:55:00&nbsp;2003</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;08&nbsp;08:24:05&nbsp;2003</span>
    <span class="description">kane [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
