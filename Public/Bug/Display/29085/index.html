<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #29085 for MIME-tools: $/ as given is currently unsupported</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #29085 for MIME-tools: $/ as given is currently unsupported</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/MIME-tools/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/MIME-tools/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/MIME-tools/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/MIME-tools/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/MIME-tools">MIME-tools CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">29085</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/MIME-tools/Active/">MIME-tools</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">dmo+pause [...] dmo.ca
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
micah [...] riseup.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-21368-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
5.420</li>
<li>
5.420_01</li>
</ul>
    </td>
  </tr>
  <tr id="CF-21369-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;31&nbsp;13:00:12&nbsp;2007</span>
    <span class="description">micah [...] riseup.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> $/ as given is currently unsupported</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m getting this error and its causing a lot of problems: 

$/ as given is currently unsupported at
/usr/share/perl5/MIME/Decoder/NBit.pm line 140

This causes the sympa application to crash. Searching on google, it
seems to affect also RT and OTRS.

Any simple solutions?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;31&nbsp;13:56:38&nbsp;2007</span>
    <span class="description">dmo+pause [...] dmo.ca -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;31&nbsp;13:57:30&nbsp;2007</span>
    <span class="description">dmo+pause [...] dmo.ca -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello Micah,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; $/ as given is currently unsupported at
&gt; /usr/share/perl5/MIME/Decoder/NBit.pm line 140
&gt; This causes the sympa application to crash. Searching on google, it seems
&gt; to affect also RT and OTRS.
&gt; Any simple solutions?
</div>
Oh, that&#39;s a fun one.  Inside IO::ScalarArray&#39;s getline&#40;&#41; method,  we
explicitly croak&#40;&#41; if the value of $/ is something other than undef 
or &#34;\n&#34;.

I&#39;ve been trying to remove the dependency on IO::Scalar and
IO::ScalarArray, but it&#39;s not quite complete yet.  I&#39;ll be uploading
5.420_02 later today, which removes some, but not all, uses of the 
IO-stringy modules.  It might solve your problem, or it might not.

In the meantime, can you figure out what&#39;s changing $/ in your code &#40;and
what the value is&#41; and provide me a simple testcase?

Cheers,
Dave
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;31&nbsp;13:57:32&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;31&nbsp;16:57:27&nbsp;2007</span>
    <span class="description">micah [...] riseup.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> micah [...] riseup.net</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Aug 31 13:57:30 2007, DONEILL wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ve been trying to remove the dependency on IO::Scalar and
&gt; IO::ScalarArray, but it&#39;s not quite complete yet.  I&#39;ll be uploading
&gt; 5.420_02 later today, which removes some, but not all, uses of the 
&gt; IO-stringy modules.  It might solve your problem, or it might not.
&gt; 
&gt; In the meantime, can you figure out what&#39;s changing $/ in your code &#40;and
&gt; what the value is&#41; and provide me a simple testcase?
</div>
After some discussion with a comrade it seems like the following in
perlvar&#40;1&#41;
is appropos:

perlvar&#40;1&#41;:     You should be very careful when modifying the default
values of
                most special variables described in this document. In
most cases you
                want to localize these variables before changing them,
since if you donâ&lt;80&gt;&lt;99&gt;t,
                the change may affect other modules which rely on the
default values of the
                 special variables that you have changed.

So the right way is to do:
        local $/; # enable localized slurp mode
and the wrong way:
        undef $/; # enable slurp mode

$/ is supposed to be &#34;\n&#34;, which makes perl read the streams line per
line, you change $/
when you want to read &#40;e.g.&#41; the whole file or with another seperator

So, looking into sympa&#39;s bounced.pl &#40;attached&#41; to see if it changes
$/ we dont find anyting but false-positives. However, looking into
bounce-lib.pl &#40;also attached&#41; because bounced.pl brings that in, we
find:

        $/ = &#34;\n&#34;;

and another:
        $/ = &#39;&#39;;

so, to fix that we must add a line like this:

        local $/;

to all the sub foo { } blocks where a $/ is used which is what the
attached sympa-bounced-fix.patch does.

I hope this helps, it seems like it is not really a MIME::Tools bug, but
a bug in Sympa &#40;and OTRS and RT&#41;... but if you can work around the
bugginess in IO::ScalarArray to make it go away, then you fix bugs in a
bunch of code :&#41;
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- bounce-lib.pl.orig	2007-08-31 13:28:49.000000000 -0400
+++ bounce-lib.pl	2007-08-31 13:29:57.000000000 -0400
@@ -27,6 +27,7 @@
 sub rfc1891 {
     my &#40;$fic, $result, $from&#41; = @_;
   
+    local $/; # avoid system-wide field seperator contamination
     $/ = &#34;\n&#34;;
 
     my $nbrcpt;
@@ -160,6 +161,8 @@
 	$mercury_143, $altavista, $mercury_131, $type_31, $type_32,$exim_173, $type_38, $type_39,
 	$type_40, $pmdf, $following_recipients, $postfix&#41;;
 
+    local $/;
+
     ## Le champ separateur de paragraphe est un ensemble
     ## de lignes vides
     $/ = &#39;&#39;;
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;31&nbsp;20:36:22&nbsp;2007</span>
    <span class="description">micah [...] riseup.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29085] $/ as given is currently unsupported</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 31 Aug 2007 15:24:50 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> David O&#39;Neill via RT &lt;bug-MIME-tools [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Micah Anderson &lt;micah [...] riseup.net&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* David O&#39;Neill via RT &lt;bug-MIME-tools@rt.cpan.org&gt; [070831 11:42]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=29085">http://rt.cpan.org/Ticket/Display.html?id=29085</a></span> &gt;
&gt; 
&gt; Hello Micah,
&gt; 
<div class="message-stanza open">&gt; &gt; $/ as given is currently unsupported at
&gt; &gt; /usr/share/perl5/MIME/Decoder/NBit.pm line 140
&gt; &gt; This causes the sympa application to crash. Searching on google, it seems
&gt; &gt; to affect also RT and OTRS.
&gt; &gt; Any simple solutions?
</div>&gt; 
&gt; Oh, that&#39;s a fun one.  Inside IO::ScalarArray&#39;s getline&#40;&#41; method,  we
&gt; explicitly croak&#40;&#41; if the value of $/ is something other than undef 
&gt; or &#34;\n&#34;.
&gt; 
&gt; I&#39;ve been trying to remove the dependency on IO::Scalar and
&gt; IO::ScalarArray, but it&#39;s not quite complete yet.  I&#39;ll be uploading
&gt; 5.420_02 later today, which removes some, but not all, uses of the 
&gt; IO-stringy modules.  It might solve your problem, or it might not.
&gt; 
&gt; In the meantime, can you figure out what&#39;s changing $/ in your code &#40;and
&gt; what the value is&#41; and provide me a simple testcase?
</div>
After some discussion with a comrade it seems like the following in perlvar&#40;1&#41; 
is appropos:

perlvar&#40;1&#41;:     You should be very careful when modifying the default values of 
                most special variables described in this document. In most cases you
                want to localize these variables before changing them, since if you don’t, 
                the change may affect other modules which rely on the default values of the 
                 special variables that you have changed.

So the right way is to do:
        local $/; # enable localized slurp mode
and the wrong way:
        undef $/; # enable slurp mode

$/ is supposed to be &#34;\n&#34;, which makes perl read the streams line per line, you change $/ 
when you want to read &#40;e.g.&#41; the whole file or with another seperator

So, looking into sympa&#39;s bounced.pl &#40;attached&#41; to see if it changes
$/ we dont find anyting but false-positives. However, looking into
bounce-lib.pl &#40;also attached&#41; because bounced.pl brings that in, we
find:

        $/ = &#34;\n&#34;;

and another:
        $/ = &#39;&#39;;

so, to fix that we must add a line like this:

        local $/;

to all the sub foo { } blocks where a $/ is used which is what the
attached sympa-bounced-fix.patch does.

I hope this helps, it seems like it is not really a MIME::Tools bug, but
a bug in Sympa &#40;and OTRS and RT&#41;... but if you can work around the
bugginess in IO::ScalarArray to make it go away, then you fix bugs in a
bunch of code :&#41;

Micah
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
