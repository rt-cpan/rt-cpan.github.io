<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #87042 for Math-Prime-FastSieve: several bugs</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #87042 for Math-Prime-FastSieve: several bugs</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Math-Prime-FastSieve/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Math-Prime-FastSieve/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Math-Prime-FastSieve/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Math-Prime-FastSieve/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Math-Prime-FastSieve">Math-Prime-FastSieve CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">87042</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Math-Prime-FastSieve/Active/">Math-Prime-FastSieve</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
jimm [...] renewalcomputerservices.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-241640-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-241641-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;19&nbsp;05:01:43&nbsp;2013</span>
    <span class="description">jimm [...] renewalcomputerservices.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> several bugs</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 19 Jul 2013 02:01:31 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Math-Prime-FastSieve [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Renewal Computer Services &lt;jimm [...] renewalcomputerservices.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
nth_prime&#40;1&#41; gives the first prime, 1, not the first prime in the list 
as specified in the manual.
to fix, the prime number of the lower bound must be added to this 
number. this would mean you would also need to add another method, one 
which provides the

so I would suggest 3 functions in this interface:

- nth_prime&#40;index&#41; which takes a 1-based index into the list of primes 
starting with 1 and returns the nth prime of all the primes starting with 1.

- nth_prime_in_list&#40;index&#41; which takes a 1-based index into the list of 
primes within the bounds of the generated list such as by 
ranged_primes&#40;&#41; and returns the nth prime of that list.

- list_count&#40;index&#41; which returns a count the list of primes within the 
bounds of the generated list such as by ranged_primes&#40;&#41;.

- sieve_count&#40;&#41; which returns a count the of the list of primes starting 
with 1.

- since most people working with primes want to work with huge numbers, 
I would highly suggest that Math::BigInt should be used in this module 
as a requirement.
-- 
Renewal Computer Services &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://RenewalComputerServices.com">http://RenewalComputerServices.com</a></span>&gt;
Jim Michaels, Owner
1303 NE 87th Ave 
&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.mapquest.com/maps/1303+NE+87th+Ave+Vancouver+WA+98664-1959/">http://www.mapquest.com/maps/1303+NE+87th+Ave+Vancouver+WA+98664-1959/</a></span>&gt; 
&#40;87th Ave &#38; 13th St&#41;,
Vancouver, WA, 98664-1959 USA, 1-360-521-2060 Cell 1-10pm
Serving Vancouver, WA
DIY Computer Repair Info: Jesusnjim.com &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://Jesusnjim.com">http://Jesusnjim.com</a></span>&gt;
jimm@RenewalComputerServices.com &lt;mailto:jimm@RenewalComputerServices.com&gt;
jmichae3@yahoo.com &lt;mailto:jmichae3@yahoo.com&gt;
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;20&nbsp;01:52:19&nbsp;2013</span>
    <span class="description">davido [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> dana [...] acm.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for the report.  I need to seek clarification...

On Fri Jul 19 02:01:43 2013, jimm@renewalcomputerservices.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; nth_prime&#40;1&#41; gives the first prime, 1, not the first prime in the list 
&gt; as specified in the manual.
</div>
perl -MMath::Prime::FastSieve -E &#39;say Math::Prime::FastSieve::Sieve-&gt;new&#40;20&#41;-&gt;nth_prime&#40;1&#41;&#39;

This code should yield &#39;2&#39;, as 2 is the first prime number.  And when I run it, it does.  Can you provide sample code where this method misbehaves?

&lt;snip&gt;
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; - since most people working with primes want to work with huge numbers, 
&gt; I would highly suggest that Math::BigInt should be used in this module 
&gt; as a requirement.
</div>
Math::Prime::FastSieve attempts to hold the entire sieve in memory as a bit vector.  This is pretty fast for sieves that don&#39;t take you into swap memory.  But once they begin to get into swap, you&#39;re much better off with a segmented sieve.  Dana Jacobsen&#39;s Math::Prime::Util is probably what you&#39;re looking for when you get into sieves that are big enough for &#34;BigInt&#34; semantics.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;20&nbsp;01:52:20&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;20&nbsp;03:06:32&nbsp;2013</span>
    <span class="description">DANAJ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">My reading of the documentation seems pretty clear that nth_prime returns the absolute nth prime or 0 &#40;if the nth prime is past the sieve range&#41;.  I&#39;ve had no luck reproducing a result of 1 on various perl versions on Linux, Cygwin, and Windows, and there&#39;s nothing in the code that would make me think that would be output.  nth_prime&#40;1&#41; returns either 2 or 0 &#40;if initialized with 0, undef, negative, etc.&#41;.  The lower bound for the sieve is always 2 &#40;the first prime&#41;.

I think perhaps you&#39;re getting the functionality of ranged_primes&#40;lower, upper&#41; confused with the sieving.  The sieve in this module is always from 2 to N.  Then the methods give fast answers within that range.

Regarding Math::BigInt, this should be a non-issue with 64-bit Perl with this module.  I could see the case on a 32-bit Perl where it is restricted to &#40;I believe&#41; ~2 billion, but I suspect that isn&#39;t what you&#39;re talking about.

While it might be inefficient, some of the functions you&#39;re asking for could be done by indexing into the ranged_primes return.  Methods on $sieve:

# Return the absolute nth prime:
  $sieve-&gt;nth_prime&#40;$index&#41;
# Returns the 4th prime in the list &#40;sorry, 0 based&#41;
  $sieve-&gt;ranged_primes&#40;5, 16&#41;-&gt;[3]
# Returns the count for the entire sieve
  $sieve-&gt;sieve_count&#40;&#41;
# Returns the count in this range
  scalar @{$sieve-&gt;ranged_primes&#40;5,16&#41;}

You may want to look at Math::Prime::Util &#40;and Math::Prime::Util::GMP&#41; which has better support for ranged operations and big numbers.  It will happily give you primes between 10**18 and 10**18+n, or 10**101 to 10**101+n, etc.  It also does efficient ranged prime counts.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;22&nbsp;20:13:00&nbsp;2013</span>
    <span class="description">davido [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> dana [...] acm.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m rejecting this ticket because it seems to be based on a misunderstanding of how Math::Prime::FastSieve works.  Furthermore, neither I nor Dana were able to come up with a situation that provides anything but correct results for nth_prime.  The code involved is simple enough, and the existing test suite already tests nth_prime&#40;1&#41;, which was the specific example mentioned in the ticket.

If there is a test case that demonstrates bad behavior, please do let me know.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;22&nbsp;20:13:00&nbsp;2013</span>
    <span class="description">davido [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;26&nbsp;19:12:10&nbsp;2013</span>
    <span class="description">jimm [...] renewalcomputerservices.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #87042] several bugs</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 26 Jul 2013 16:10:46 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Math-Prime-FastSieve [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Renewal Computer Services &lt;jimm [...] renewalcomputerservices.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 7/19/2013 10:52 PM, David J. Oswald via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=87042">https://rt.cpan.org/Ticket/Display.html?id=87042</a></span> &gt;
&gt;
&gt; Thanks for the report.  I need to seek clarification...
&gt;
&gt; On Fri Jul 19 02:01:43 2013, jimm@renewalcomputerservices.com wrote:
<div class="message-stanza open">&gt;&gt; nth_prime&#40;1&#41; gives the first prime, 1, not the first prime in the list
&gt;&gt; as specified in the manual.
</div>&gt; perl -MMath::Prime::FastSieve -E &#39;say Math::Prime::FastSieve::Sieve-&gt;new&#40;20&#41;-&gt;nth_prime&#40;1&#41;&#39;
&gt;
&gt; This code should yield &#39;2&#39;, as 2 is the first prime number.  And when I run it, it does.  Can you provide sample code where this method misbehaves?
&gt;
&gt; &lt;snip&gt;
&gt;   
<div class="message-stanza open">&gt;&gt; - since most people working with primes want to work with huge numbers,
&gt;&gt; I would highly suggest that Math::BigInt should be used in this module
&gt;&gt; as a requirement.
</div>&gt; Math::Prime::FastSieve attempts to hold the entire sieve in memory as a bit vector.  This is pretty fast for sieves that don&#39;t take you into swap memory.  But once they begin to get into swap, you&#39;re much better off with a segmented sieve.  Dana Jacobsen&#39;s Math::Prime::Util is probably what you&#39;re looking for when you get into sieves that are big enough for &#34;BigInt&#34; semantics.
&gt;
&gt;
&gt;
&gt;
</div>perl -MMath::Prime::FastSieve -E &#39;say 
Math::Prime::FastSieve::Sieve-&gt;new&#40;20&#41;-&gt;nth_prime&#40;1&#41;&#39;
does yield 2.

actually, 1 is the first prime number from what little I remember in 
college 20 years ago. but typically with sieves it&#39;s ignored since it&#39;s 
not easily calculable and typically requires an if test and specifically 
adding this to the list of primes manually.


I would also suggest, if possible, use int64_t or uint64_t in &lt;stdint.h&gt; 
if this is compatible as a data type with Perl. at least then you will 
have 64-bit numbers instead of just 32-bit. boost has bigint types of 
numbers.



as for perl data structures,  you should be using dynamic_bitset for 
your data type if you are using gcc. it would reduce your memory 
requirements by a factor of 8. or maybe even 32. you can always 
translate the bits into a bool through your interface. the data 
structure is more densely packed and probably doesn&#39;t waste bits.
<span class="clickylink"><a target="new" rel="nofollow" href="http://gcc.gnu.org/onlinedocs/gcc-4.7.1/libstdc++/api/a00910.html#a6043959b046b04a92027e355ce16562b">http://gcc.gnu.org/onlinedocs/gcc-4.7.1/libstdc++/api/a00910.html#a6043959b046b04a92027e355ce16562b</a></span>


-- 
Renewal Computer Services &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://RenewalComputerServices.com">http://RenewalComputerServices.com</a></span>&gt;
Jim Michaels, Owner
1303 NE 87th Ave 
&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.mapquest.com/maps/1303+NE+87th+Ave+Vancouver+WA+98664-1959/">http://www.mapquest.com/maps/1303+NE+87th+Ave+Vancouver+WA+98664-1959/</a></span>&gt; 
&#40;87th Ave &#38; 13th St&#41;,
Vancouver, WA, 98664-1959 USA, 1-360-521-2060 Cell 1-10pm
Serving Vancouver, WA
DIY Computer Repair Info: Jesusnjim.com &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://Jesusnjim.com">http://Jesusnjim.com</a></span>&gt;
jimm@RenewalComputerServices.com &lt;mailto:jimm@RenewalComputerServices.com&gt;
jmichae3@yahoo.com &lt;mailto:jmichae3@yahoo.com&gt;
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;26&nbsp;19:18:59&nbsp;2013</span>
    <span class="description">jimm [...] renewalcomputerservices.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #87042] several bugs</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 26 Jul 2013 16:18:49 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Math-Prime-FastSieve [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Renewal Computer Services &lt;jimm [...] renewalcomputerservices.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 7/22/2013 5:13 PM, David J. Oswald via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=87042">https://rt.cpan.org/Ticket/Display.html?id=87042</a></span> &gt;
&gt;
&gt; I&#39;m rejecting this ticket because it seems to be based on a misunderstanding of how Math::Prime::FastSieve works.  Furthermore, neither I nor Dana were able to come up with a situation that provides anything but correct results for nth_prime.  The code involved is simple enough, and the existing test suite already tests nth_prime&#40;1&#41;, which was the specific example mentioned in the ticket.
&gt;
&gt; If there is a test case that demonstrates bad behavior, please do let me know.
&gt;
&gt;
</div>I am just going by the specs in the pm. ranged_prime&#39;s lower bound is 
supposed to  work, but it doesn&#39;t, gives me 3 all the time for lower bound.

here is my code, twin-primes.pl, you feed it with commandline args 10000 
500 and it should give you the range 99500..10500 but it gives me 3..10500.

#!/usr/bin/perl
#twinprimes.pl
#Abstract: generate twin primes, and the differences, showing maximum 
difference for the set
#Author: Jim Michaels
#Created: 7/18/2013
#program arguments:
#   positive integer center
#   positive integer offset, less than center above


#I originally did this with C++, but it was too slow with sieve of 
Eratosthenes. this had a fast sieve and it already had range capability.

     use Math::BigInt;
# ----------    The simple interface:    ----------
     use Math::Prime::FastSieve qw&#40; primes &#41;;


     sub help {
         die&#40;&#34;twinprimes.pl - generate list of twin primes with 
differences\n&#34; .
               &#34;usage:\n&#34; .
               &#34;  twinprimes.pl center offset\n&#34; .
               &#34;  perl twinprimes.pl center offset\n&#34; .
               &#34;options:\n&#34; .
               &#34;  center: positive integer which twin primes center 
around\n&#34; .
               &#34;  offset: positive integer which is subtracted from the 
offset and added to the center to provide upper and lower bounds.\n&#34; .
               &#34;\n&#34; .
               &#34;This program generates twin primes in the style of 
primesieve as far as format, but goes 2 steps further:\n&#34; .
               &#34;- this handles BigInt for infinite precision math\n&#34; .
               &#34;- it uses Perl&#39;s very flexible number formatting 
&#40;handles hexadecimal, octal, etc&#41;\n&#34; .
               &#34;- shows the difference between twin primes\n&#34; .
               &#34;- shows the maximum and minimum difference at the end, 
and the count\n&#34; .
               &#34;By Jim Michaels, 7/18/2013\n&#34;
         &#41;;
     }


     if &#40;2 != $#ARGV+1&#41; {
         #provide help, user provided invalid quantity of arguments
         help&#40;&#41;;
     }

     # Obtain an reference to an array containing all primes less than or
     # equal to 5 Million.
     #my $aref = primes&#40; 5_000_000 &#41;;

     my &#40;$center, $offset, $i, $max_difference, $min_difference, 
$difference, $old_i, $upper_bound, $lower_bound,$twin_prine_count,$offset&#41;;
     my @twinprimes = &#40;&#41;;
     $center=$ARGV[0];
     $offset=$ARGV[1];
     $upper_bound = $center+$offset+2;
     $lower_bound = $center-$offset;

     # ----------   The object &#40;far more flexible&#41; interface. ----------

     # Create a new sieve and flag all primes less or equal to n.
     my $sieve = Math::Prime::FastSieve::Sieve-&gt;new&#40; $upper_bound &#41;;

     # Obtain a ref to an array containing all primes &lt;= 5 Million.
     #my $aref = $sieve-&gt;primes&#40; 5_000_000 &#41;;

     # Obtain a ref to an array containing all primes &gt;= 5, and &lt;= 16.
     my $aref = $sieve-&gt;ranged_primes&#40; $lower_bound, $upper_bound&#41;;
     my $num_found = $sieve-&gt;count_sieve&#40;&#41;;
     $twin_prime_count=0;
     $old_i = -1;
     $difference = 0;

     for &#40;$i=1; $i &lt; $num_found - 1; $i++&#41; {
         if &#40;$sieve-&gt;nth_prime&#40;$i&#41;+2==$sieve-&gt;nth_prime&#40;$i+1&#41;&#41; {
             $twin_prime_count++;
             print &#34;&#40;&#34; . $sieve-&gt;nth_prime&#40;$i&#41; . &#34;, &#34; . 
$sieve-&gt;nth_prime&#40;$i+1&#41; . &#34;&#41; index=&#34; . $twin_prime_count;
             #if &#40;-1 != $old_i&#41; {
                 $difference = $i-$old_i;
                 $min_difference = min&#40;$min_difference,$difference&#41;;
                 $max_difference = max&#40;$max_difference,$difference&#41;;
                 print &#34; difference=&#34; . $difference;
             #} else {
             #    $min_difference = $difference;
             #    $max_difference = $difference;
             #}
             print &#34;\n&#34;;
             $old_i = $i;
         }
     }
     print &#34;\n&#34;;
     print &#34;center=&#34; . $center . &#34;\n&#34;;
     print &#34;offset=&#34; . $offset . &#34;\n\n&#34;;
     print &#34;lower bound=&#34; . $lower_bound . &#34;\n&#34;;
     print &#34;upper bound=&#34; . $upper_bound . &#34;\n&#34;;
     print &#34;min difference=&#34; . $min_difference . &#34;\n&#34;;
     print &#34;max difference=&#34; . $max_difference . &#34;\n&#34;;
     print &#34;count=&#34; . $num_found . &#34;\n&#34;;
     print &#34;\n&#34;;


     sub min {
         my&#40;$mn,$i&#41;;
         if &#40;$#_+1 &lt; 1&#41; {
             return 0;
         }
         $mn=$_[0];
         for &#40;$i=0; $i &lt;= $#_; $i++&#41; {
             #if &#40;0 == $i&#41; {
             #    $mn=$_[$i];
             #}
             if &#40;$_[$i] &lt; $mn&#41; {
                 $mn=$_[$i];
             }
         }
         return $mn;
     }


     sub max {
         my&#40;$mx,$i&#41;;
         if &#40;$#_+1 &lt; 1&#41; {
             return 0;
         }
         $mx=$_[0];
         for &#40;$i=0; $i &lt;= $#_; $i++&#41; {
             #if &#40;0 == $i&#41; {
             #    $mx=$_[$i];
             #}
             if &#40;$_[$i] &gt; $mx&#41; {
                 $mx=$_[$i];
             }
         }
         return $mx;
     }




-- 
Renewal Computer Services &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://RenewalComputerServices.com">http://RenewalComputerServices.com</a></span>&gt;
Jim Michaels, Owner
1303 NE 87th Ave 
&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.mapquest.com/maps/1303+NE+87th+Ave+Vancouver+WA+98664-1959/">http://www.mapquest.com/maps/1303+NE+87th+Ave+Vancouver+WA+98664-1959/</a></span>&gt; 
&#40;87th Ave &#38; 13th St&#41;,
Vancouver, WA, 98664-1959 USA, 1-360-521-2060 Cell 1-10pm
Serving Vancouver, WA
DIY Computer Repair Info: Jesusnjim.com &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://Jesusnjim.com">http://Jesusnjim.com</a></span>&gt;
jimm@RenewalComputerServices.com &lt;mailto:jimm@RenewalComputerServices.com&gt;
jmichae3@yahoo.com &lt;mailto:jmichae3@yahoo.com&gt;
</div></div>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;26&nbsp;22:27:26&nbsp;2013</span>
    <span class="description">jimm [...] renewalcomputerservices.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #87042] several bugs</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 26 Jul 2013 19:27:14 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Math-Prime-FastSieve [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Renewal Computer Services &lt;jimm [...] renewalcomputerservices.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 7/20/2013 12:06 AM, Dana Jacobsen via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=87042">https://rt.cpan.org/Ticket/Display.html?id=87042</a></span> &gt;
&gt;
&gt; My reading of the documentation seems pretty clear that nth_prime returns the absolute nth prime or 0 &#40;if the nth prime is past the sieve range&#41;.  I&#39;ve had no luck reproducing a result of 1 on various perl versions on Linux, Cygwin, and Windows, and there&#39;s nothing in the code that would make me think that would be output.  nth_prime&#40;1&#41; returns either 2 or 0 &#40;if initialized with 0, undef, negative, etc.&#41;.  The lower bound for the sieve is always 2 &#40;the first prime&#41;.
&gt;
&gt; I think perhaps you&#39;re getting the functionality of ranged_primes&#40;lower, upper&#41; confused with the sieving.  The sieve in this module is always from 2 to N.  Then the methods give fast answers within that range.
&gt;
&gt; Regarding Math::BigInt, this should be a non-issue with 64-bit Perl with this module.  I could see the case on a 32-bit Perl where it is restricted to &#40;I believe&#41; ~2 billion, but I suspect that isn&#39;t what you&#39;re talking about.
&gt;
&gt; While it might be inefficient, some of the functions you&#39;re asking for could be done by indexing into the ranged_primes return.  Methods on $sieve:
&gt;
&gt; # Return the absolute nth prime:
&gt;    $sieve-&gt;nth_prime&#40;$index&#41;
&gt; # Returns the 4th prime in the list &#40;sorry, 0 based&#41;
&gt;    $sieve-&gt;ranged_primes&#40;5, 16&#41;-&gt;[3]
&gt; # Returns the count for the entire sieve
&gt;    $sieve-&gt;sieve_count&#40;&#41;
&gt; # Returns the count in this range
&gt;    scalar @{$sieve-&gt;ranged_primes&#40;5,16&#41;}
&gt;
&gt; You may want to look at Math::Prime::Util &#40;and Math::Prime::Util::GMP&#41; which has better support for ranged operations and big numbers.  It will happily give you primes between 10**18 and 10**18+n, or 10**101 to 10**101+n, etc.  It also does efficient ranged prime counts.
&gt;
&gt;
</div>when I try to get the $aref or @aref list from ranged_primes&#40;&#41; I get 
various useless results:
size of scalar&#40;@aref&#41;=1 $#aref=0
when I should be getting much larger numbers. the list from this 
function and probably primes also is inaccessible. it appears it is only 
accessible through the API via nth_prime&#40;&#41;. if this is intended, there 
needs to be some forwards/backwards index lookup functionality to make 
ranged_primes&#40;&#41; usable. apparently, it does the whole set of prime 
numbers regardless of the lower bounds I set. this may be by design due 
to sieve algorithm I figure.
Specifically, some sort of functions  that:
- looks up the index of a prime number in the list that augments 
nth_prime&#40;&#41;. it should return failure if it&#39;s not found.
- looks up the specific prime number of an index in the list that 
augments nth_prime&#40;&#41;. it should return failure if it&#39;s not in list.
in other words, some lookup functionality. otherwise, it&#39;s possible that 
range_primes&#40;&#41; should be deleted entirely if we cannot access the list 
of it at all anyway and no functionality to access that list is going to 
be provided.

otherwise, I would be spending my time re-generating the list of primes 
in order to find out what the primes were in that list, and that would 
basically be rewriting your code.

according to the pm file:

SV* Sieve::ranged_primes&#40; long lower, long upper &#41;
upper and lower appears to be a prime number.
when I run my twin-primes.pl code as you see in the bug report,
I get for center 10000 offset +/-500, which gives me:
&#40;3, 5&#41; index=1 difference=3
&#40;5, 7&#41; index=2 difference=1
&#40;11, 13&#41; index=3 difference=2
&#40;17, 19&#41; index=4 difference=2
&#40;29, 31&#41; index=5 difference=3
&#40;41, 43&#41; index=6 difference=3
&#40;59, 61&#41; index=7 difference=4
&#40;71, 73&#41; index=8 difference=3
&#40;101, 103&#41; index=9 difference=6
&#40;107, 109&#41; index=10 difference=2
...
&#40;9857, 9859&#41; index=204 difference=12
&#40;9929, 9931&#41; index=205 difference=8
&#40;10007, 10009&#41; index=206 difference=6
&#40;10037, 10039&#41; index=207 difference=2
&#40;10067, 10069&#41; index=208 difference=3
&#40;10091, 10093&#41; index=209 difference=3
&#40;10139, 10141&#41; index=210 difference=6
&#40;10271, 10273&#41; index=211 difference=16
&#40;10301, 10303&#41; index=212 difference=3
&#40;10331, 10333&#41; index=213 difference=4
&#40;10427, 10429&#41; index=214 difference=8
&#40;10457, 10459&#41; index=215 difference=4

center=10000
offset=500

lower bound=9500
upper bound=10502
min difference=
max difference=24
count=1285

this starts at 3, for a prime number, not 9500 which is consistent with 
nth_prime&#40;&#41;.
no list access API function is provided, and so far, I have been unable 
by any method I have tried to access this array/list returned by 
ranged_primes&#40;&#41;. a list access method/function in the API needed to be 
provided, please. it looks like std::vector&lt;bool&gt;, and I should hope 
that somehow this translates well to Perl, but apparently this does not. 
try it for yourself.

use Math::Prime::FastSieve qw&#40; primes &#41;;
my $sieve = Math::Prime::FastSieve::Sieve-&gt;new&#40;10000&#41;;
my @aref = $sieve-&gt;ranged_primes&#40; 9500, 10500&#41;;
print &#34;size of aref=scalar:&#34; . scalar&#40;@aref&#41; . &#34; \$\#:&#34; . $#aref . &#34;\n&#34;;
for &#40;$i=0; $i &lt;= $#aref; $i++&#41; {
     printf $aref[$i] . &#34;\n&#34;;
}
my $aref2 = $sieve-&gt;ranged_primes&#40; 9500, 10500&#41;;
print &#34;size of aref=scalar:&#34; . scalar&#40;@aref2&#41; . &#34; \$\#:&#34; . $#aref2 . &#34;\n&#34;;
for &#40;$i=0; $i &lt;= scalar&#40;@aref2&#41;; $i++&#41; {
     printf $aref2[$i] . &#34;\n&#34;;
}




-----Documentation:

- I believe the ranged_primes&#40;&#41; example to be wrong, my $aref = returned 
from ranged_primes should be my @aref = if it really is a standard perl 
list.

- undocumented structures etc. I don&#39;t know what&#39;s in these structures 
or data types or macros.
so I don&#39;t know how to access the elements in $aref in the examples. I 
would like to see an example that walks the list and prints out the 
primes for a ranged prime, because what I have doesn&#39;t work, and it&#39;s 
only based on best-guess, not enough info.
the undocumented structure information is critical to accessing the 
list. specifically:
newRV_noinc
AV
newAV
newSVuv
av_push
newSVuv
actual source code is not provided, so I can&#39;t tell what&#39;s in the 
structures.

I think I said before that it would be a good idea to use int64_t. If I 
remember right, Perl without Math::BigInt handles 64-bit numbers. so it 
would be good to:
- use this as your integer number type in all functions &#40;and translate 
as such for return types&#41;
- use this instead of bool? perl doesn&#39;t have bool to my knowledge.

I really like having the ranged_primes functionality &#40;mainly because I 
don&#39;t have to write it myself&#41;. I was just hoping to get it working. I 
was also hoping for some enhancements in addition to the bug report on 
ranged_primes&#40;&#41;.

-- 
Renewal Computer Services &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://RenewalComputerServices.com">http://RenewalComputerServices.com</a></span>&gt;
Jim Michaels, Owner
1303 NE 87th Ave 
&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.mapquest.com/maps/1303+NE+87th+Ave+Vancouver+WA+98664-1959/">http://www.mapquest.com/maps/1303+NE+87th+Ave+Vancouver+WA+98664-1959/</a></span>&gt; 
&#40;87th Ave &#38; 13th St&#41;,
Vancouver, WA, 98664-1959 USA, 1-360-521-2060 Cell 1-10pm
Serving Vancouver, WA
DIY Computer Repair Info: Jesusnjim.com &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://Jesusnjim.com">http://Jesusnjim.com</a></span>&gt;
jimm@RenewalComputerServices.com &lt;mailto:jimm@RenewalComputerServices.com&gt;
jmichae3@yahoo.com &lt;mailto:jmichae3@yahoo.com&gt;
</div></div>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;26&nbsp;23:07:15&nbsp;2013</span>
    <span class="description">jimm [...] renewalcomputerservices.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #87042] several bugs</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 26 Jul 2013 20:07:06 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Math-Prime-FastSieve [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Renewal Computer Services &lt;jimm [...] renewalcomputerservices.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 7/22/2013 5:13 PM, David J. Oswald via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=87042">https://rt.cpan.org/Ticket/Display.html?id=87042</a></span> &gt;
&gt;
&gt; I&#39;m rejecting this ticket because it seems to be based on a misunderstanding of how Math::Prime::FastSieve works.  Furthermore, neither I nor Dana were able to come up with a situation that provides anything but correct results for nth_prime.  The code involved is simple enough, and the existing test suite already tests nth_prime&#40;1&#41;, which was the specific example mentioned in the ticket.
&gt;
&gt; If there is a test case that demonstrates bad behavior, please do let me know.
&gt;
&gt;
</div>you may use these examples for ranged_prime&#40;&#41;, ranged_primes works fine. 
the problem with me was I did not know how to dereference an array. the 
expansion of the size of  the integer would still be useful for whoever 
uses this library.
so,
- there IS a way to access the array that is returned.
- lookup functions would be nice, but are not required. maybe perl 
already provides these.


use Math::Prime::FastSieve qw&#40; primes &#41;;
my $sieve = Math::Prime::FastSieve::Sieve-&gt;new&#40;10500&#41;;
#print list of primes between 9500 and 10500
my $aref = $sieve-&gt;ranged_primes&#40; 9500, 10500&#41;;
for &#40;$i=0; $i &lt;= $#{$aref}; $i++&#41; {
     printf $$aref[$i] . &#34;,&#34;;
}
printf &#34;\n&#34;;

     #print list of twin primes between 9500 and 10500
    my $twin_prime_count=0;
     my $old_i = -1;
     my $difference = 0;
      my $aref = $sieve-&gt;ranged_primes&#40; $lower_bound, $upper_bound&#41;;
     my $num_found = $#{$aref} + 1;
    for &#40;$i=0; $i &lt; $num_found - 1; $i++&#41; {
         if &#40;$$aref[$i]+2==$$aref[$i+1]&#41; {#twin prime?
             $twin_prime_count++;
             print &#34;&#40;&#34; . $$aref[$i] . &#34;, &#34; . $$aref[$i+1] . &#34;&#41;\n&#34;;
             if &#40;-1 != $old_i&#41; {
                 $difference = $i-$old_i;
                 $min_difference = min&#40;$min_difference,$difference&#41;;
                 $max_difference = max&#40;$max_difference,$difference&#41;;
             }
             $old_i = $i;
         }
     }
     print &#34;lower bound=&#34; . $lower_bound . &#34;\n&#34;;
     print &#34;upper bound=&#34; . $upper_bound . &#34;\n&#34;;
     print &#34;min difference=&#34; . $min_difference . &#34;\n&#34;;
     print &#34;max difference=&#34; . $max_difference . &#34;\n&#34;;
     print &#34;count=&#34; . $twin_prime_count . &#34;\n&#34;;

     sub min {
         my&#40;$mn,$i&#41;;
         if &#40;$#_+1 &lt; 1&#41; {
             return 0;
         }
         $mn=int&#40;$_[0]&#41;;
         for &#40;$i=0; $i &lt;= $#_; $i++&#41; {
             #if &#40;0 == $i&#41; {
             #    $mn=$_[$i];
             #}
             if &#40;int&#40;$_[$i]&#41; &lt; $mn&#41; {
                 $mn=int&#40;$_[$i]&#41;;
             }
         }
         return $mn;
     }


     sub max {
         my&#40;$mx,$i&#41;;
         if &#40;$#_+1 &lt; 1&#41; {
             return 0;
         }
         $mx=int&#40;$_[0]&#41;;
         for &#40;$i=0; $i &lt;= $#_; $i++&#41; {
             #if &#40;0 == $i&#41; {
             #    $mx=$_[$i];
             #}
             if &#40;int&#40;$_[$i]&#41; &gt; $mx&#41; {
                 $mx=int&#40;$_[$i]&#41;;
             }
         }
         return $mx;
     }

-- 
Renewal Computer Services &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://RenewalComputerServices.com">http://RenewalComputerServices.com</a></span>&gt;
Jim Michaels, Owner
1303 NE 87th Ave 
&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.mapquest.com/maps/1303+NE+87th+Ave+Vancouver+WA+98664-1959/">http://www.mapquest.com/maps/1303+NE+87th+Ave+Vancouver+WA+98664-1959/</a></span>&gt; 
&#40;87th Ave &#38; 13th St&#41;,
Vancouver, WA, 98664-1959 USA, 1-360-521-2060 Cell 1-10pm
Serving Vancouver, WA
DIY Computer Repair Info: Jesusnjim.com &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://Jesusnjim.com">http://Jesusnjim.com</a></span>&gt;
jimm@RenewalComputerServices.com &lt;mailto:jimm@RenewalComputerServices.com&gt;
jmichae3@yahoo.com &lt;mailto:jmichae3@yahoo.com&gt;
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;27&nbsp;00:58:26&nbsp;2013</span>
    <span class="description">davido [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> dana [...] acm.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Jul 26 16:12:10 2013, jimm@renewalcomputerservices.com wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; perl -MMath::Prime::FastSieve -E &#39;say
&gt; Math::Prime::FastSieve::Sieve-&gt;new&#40;20&#41;-&gt;nth_prime&#40;1&#41;&#39;
&gt; does yield 2.
&gt; 
&gt; actually, 1 is the first prime number from what little I remember in
&gt; college 20 years ago. but typically with sieves it&#39;s ignored since
&gt; it&#39;s not easily calculable and typically requires an if test and
&gt; specifically adding this to the list of primes manually.
</div>
<span class="clickylink"><a target="new" rel="nofollow" href="http://en.wikipedia.org/wiki/Prime_numbers#Primality_of_one">http://en.wikipedia.org/wiki/Prime_numbers#Primality_of_one</a></span>

Apparently the last &#34;professional mathematician to call 1 prime&#34; died in 1941.  I&#39;m not a professional mathematician, but I&#39;ll trust that since nobody else has stepped up to take is place in that niche the concept has been laid to rest as well.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I would also suggest, if possible, use int64_t or uint64_t in
&gt; &lt;stdint.h&gt;
&gt; if this is compatible as a data type with Perl. at least then you will
&gt; have 64-bit numbers instead of just 32-bit. boost has bigint types of
&gt; numbers.
</div>
We&#39;re not going to support Math::BigInt, or BigInt.  If you need that, use Math::Prime::Util, which, because it offers a segmented sieve, is a much better fit for truly huge integers.  We do, however, already support 64-bit integers, and would gain nothing aside from a possible reduction of portability if we specifically used int64_t or uint64_t &#40;that would make the module inaccessible to users of 32-bit builds of Perl&#41;.

As a case in point: We can safely assert that 5_000_000_000 &#40;5 billion&#41; is outside the range of even an unsigned 32-bit integer.  So consider this code:

use Math::Prime::FastSieve;

my $sieve = Math::Prime::FastSieve::Sieve-&gt;new&#40;5_000_000_000&#41;;

my $primes_ref = $sieve-&gt;ranged_primes&#40; 4_999_999_500, 5_000_000_000 &#41;;

print scalar @{$primes_ref}, &#34;\n&#34;;
print &#34;$_\n&#34; for @{$primes_ref};

The output on a 64-bit Perl build will be:

21
4999999547
4999999573
4999999607
4999999621
4999999643
4999999679
4999999717
4999999729
4999999751
4999999759
4999999789
4999999799
4999999801
4999999811
4999999817
4999999859
4999999861
4999999867
4999999883
4999999903
4999999937

Clearly, 4_999_999_937 is out of the range that could be expressed in 32 bits.  Because we&#39;re using a 64 bit Perl, and because we&#39;re compiling using the machine&#39;s native long, which should in almost all cases on a 64 bit machine be a 64 bit container, we get 64 bit semantics.  But I do want to point out that this test code, on my reasonably fast machine, takes 24 seconds to run.  Math::Prime::Util offers a segmented sieve, where you could specify a range from 4_999_999_500 to 5_000_000_000, and the sieve would only be built for that specific range.  Instead of taking 24 seconds to run, it would take a small fraction of a second.  If you need primes in the 64-bit range and beyond, you probably should be using Math::Prime::Util, not Math::Prime::FastSieve.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; as for perl data structures,  you should be using dynamic_bitset for
&gt; your data type if you are using gcc. it would reduce your memory
&gt; requirements by a factor of 8. or maybe even 32. you can always
&gt; translate the bits into a bool through your interface. the data
&gt; structure is more densely packed and probably doesn&#39;t waste bits.
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://gcc.gnu.org/onlinedocs/gcc-">http://gcc.gnu.org/onlinedocs/gcc-</a></span>
&gt; 4.7.1/libstdc++/api/a00910.html#a6043959b046b04a92027e355ce16562b
</div>
I&#39;m currently holding the sieve in a vector&lt;bool&gt;, which, although it&#39;s a much maligned contaner, doesn&#39;t consume 8-bits per bool, it consumes one bit per bool, plus a little meta-data that is constant regardless of container size.  A vector&lt;bool&gt; is a dynamic bit vector, essentially.  The &#34;bool&#34; specialization of the std::vector template is considered a 2nd class citizen among the STL container classes, but the way we&#39;re using it doesn&#39;t touch any of the areas considered deficient.

Specifically using a GCC feature would either add code complexity &#40;preprocessor directives to use some code for GCC, and other code for everyone else&#41;, or diminish portability, which is against the design objective.

If you&#39;re suggesting that instead of an array-ref I should be passing back a bit-vector directly to Perl, that goes against the design philosophy of this module.  The concept is for the sieve to be encapsulated within the C++ code, and for the &#34;prime&#34; characteristics to be available by querying the sieve through accessors.  If I wanted to expose the sieve directly to Perl, I give the Sieve object an accessor that returns a Bit::Vector object.  But I don&#39;t see that feature as being useful enough to justify the extra dependency.

Please remember that Math::Prime::FastSieve was designed as a simple, fast prime sieve, and also as a proof of concept demonstrating that Inline::CPP can be used as a dependency for a CPAN module.  If M::P::FastSieve wanted to be Math::Prime::Util, it could be rewritten, but then it would cease to be a simple example of Inline::CPP at work.  ...and Math::Prime::Util already exists.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;27&nbsp;01:14:36&nbsp;2013</span>
    <span class="description">davido [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> dana [...] acm.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Jul 26 16:18:59 2013, jimm@renewalcomputerservices.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; my $aref = $sieve-&gt;ranged_primes&#40; $lower_bound, $upper_bound&#41;;
</div>
The code you posted takes $sieve-&gt;ranged_primes&#40;&#41; return value into the scalar value $aref, and then never uses $aref again.  It would be impossible to make any kind of determination whether or not ranged_primes&#40;&#41; is working properly if its return value is never used for anything.

The test suite tests the range_primes&#40;&#41; method with nine different ranges, some of them intentionally illegal for the sieve size used in the test, and in each case, the output is as expected/documented.  See t/03sieve_object.t lines 39 through 66.

If you can show a test in the form of:

use Math::Prime::FastSieve;

my $sieve_size = ***some integer***;
my $min = *** some integer within the sieve ***;
my $max = *** some integer within the sieve ***;

my $sieve = Math::Prime::FastSieve::Sieve-&gt;new&#40; $sieve_size &#41;;
my $range_aref = $sieve-&gt;ranged_primes&#40; $min, $max &#41;;
print &#34;$_\n&#34; for @{$range_aref};

...where the output is anything other than what it should be, you will have found a bug.  If you can demonstrate some other documented use of the module that causes ranged_primes to misbehave, that would also be a bug.  But calling ranged_primes and not using its return value... that&#39;s not a Math::Prime::FastSieve bug.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;27&nbsp;01:28:33&nbsp;2013</span>
    <span class="description">davido [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Jul 26 20:07:15 2013, jimm@renewalcomputerservices.com wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; you may use these examples for ranged_prime&#40;&#41;, ranged_primes works
&gt; fine. the problem with me was I did not know how to dereference an 
&gt; array. the expansion of the size of the integer would still be 
&gt; useful for whoever uses this library. so,
</div>
So rejecting the RT ticket was the correct thing to do.  ranged_primes works as documented.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; use Math::Prime::FastSieve qw&#40; primes &#41;;
&gt; my $sieve = Math::Prime::FastSieve::Sieve-&gt;new&#40;10500&#41;;
&gt; #print list of primes between 9500 and 10500
&gt; my $aref = $sieve-&gt;ranged_primes&#40; 9500, 10500&#41;;
&gt; for &#40;$i=0; $i &lt;= $#{$aref}; $i++&#41; {
&gt;      printf $$aref[$i] . &#34;,&#34;;
&gt; }
&gt; printf &#34;\n&#34;;
</div>
That&#39;s just proof that you can program C in Perl. ;&#41;  You may use this example... it&#39;s more Perlish.

# print list of primes between 9500 and 10500

my $aref = $sieve-&gt;ranged_primes&#40; 9500, 10500 &#41;;
print &#34;$_\n&#34; for @{$aref};

...or...

print &#34;$_\n&#34; for @{ $sieve-&gt;ranged_primes&#40; 9500, 10500 &#41; };

...or even...

say for @{ $sieve-&gt;ranged_primes&#40; 9500, 10500 &#41; };

...or...

{
  local $&#34; = &#34;\n&#34;;
  print &#34;@{$sieve-&gt;ranged_primes&#40;9500,10500&#41;}\n&#34;;
}
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;27&nbsp;01:42:48&nbsp;2013</span>
    <span class="description">DANAJ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">If I may add my two cents,

On Fri Jul 26 19:12:10 2013, jimm@renewalcomputerservices.com wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; actually, 1 is the first prime number [...]
</div>
David gave the link to Wikipedia, but for good measure:
 - Apostol 1976 &#34;A prime number is a number greater than 1 whose only divisors are 1 and the number itself.&#34;  
 - Hardy and Wright 6th edition 2008, &#34;A number p is said to be prime if &#40;i&#41; p &gt; 1, &#40;ii&#41; p has no positive divisors except 1 and p.&#34;  ... &#34;It is important to observe that 1 is not reckoned as a prime.&#34;
 - Crandall and Pomerance 2nd edition 2010, &#34;The number 1 is considered neither prime nor composite&#34;.

If 1 is considered prime, then most functions dealing with primes end up having to have special cases added to them.  It isn&#39;t just sieving, it&#39;s basically any algorithm that wants a prime or factors that would have to have &#34;p &gt; 1&#34; added to them.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I would also suggest, if possible, use int64_t or uint64_t in
&gt; &lt;stdint.h&gt;
&gt; if this is compatible as a data type with Perl. at least then you will
&gt; have 64-bit numbers instead of just 32-bit. boost has bigint types of
&gt; numbers.
</div>
What I found from my code was that using UV/IV types saved me a lot of trouble.  That&#39;s the integer type Perl is compiled for, and saves me from having to deal with the portability issues around different types and compilers.  If they&#39;re on a 32-bit machine where &#34;unsigned long&#34; is 32-bit but using a 64-bit Perl, then we&#39;ll be 64-bit.

I&#39;m testing this with Math::Prime::FastSieve right now, as I have such a platform, and ... &#40;queue Jeopardy theme, as this is a really slow Atom netbook&#41; ... Indeed, prints the wrong answer.  UV is an unsigned long long here.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; as for perl data structures,  you should be using dynamic_bitset for
&gt; your data type if you are using gcc. it would reduce your memory
&gt; requirements by a factor of 8. or maybe even 32. you can always
&gt; translate the bits into a bool through your interface. the data
&gt; structure is more densely packed and probably doesn&#39;t waste bits.
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://gcc.gnu.org/onlinedocs/gcc-">http://gcc.gnu.org/onlinedocs/gcc-</a></span>
&gt; 4.7.1/libstdc++/api/a00910.html#a6043959b046b04a92027e355ce16562b
</div>
If I remember right, I made a version of Math::Prime::FastSieve that used bit twiddling, just like I would with C, and it didn&#39;t change much.  gcc seems able to figure out the std::vector&lt;bool&gt; pretty well and generate the right code.  It&#39;s definitely not using a character or word per entry.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;27&nbsp;03:01:15&nbsp;2013</span>
    <span class="description">DANAJ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">If you want really big ranges, you can use Math::Prime::Util&#39;s primes&#40;begin,end&#41; function, where they can be bigints &#40;but for 64-bit values there isn&#39;t any real need&#41;.  I use the same &#34;return an array reference&#34; for that function, since David showed me it really saved time with large ranges.  However in simple scripts I&#39;ll often just use:

  my @primes = @{primes&#40;$begin,$end&#41;};

so I don&#39;t worry about it.  Noting that this probably uses twice the memory as leaving it in an array reference, but with ranges of 1000 it&#39;s completely irrelevant.  It&#39;s meaningful when the list is many millions of numbers.

If you just want twin primes without writing any code, MPU comes with a primes.pl program that will output twins, triplets, quadruplets, cousins, sexy, safe, Sophia Germain, Lucas, Fibonacci, Lucky, etc. &#40;and combinations&#41;, taking an expression as arguments.  E.g.

  primes.pl  --twin  10**27-5000  10**27+5000

For differences, you could decorate it with something like:

primes.pl --twin 10**27-5000 10**27+5000 | perl -Mbigint -nE &#39;$n = 0+$_; say &#34;$n diff: &#34;, $last ? $n-$last : 0; $last = $n;&#39;

If you want to write it yourself, I recommend &#40;1&#41; look at List::Util for min, max, etc. &#40;2&#41; look at the examples/twin_primes.pl program in the latest Math::Prime::Util.  It includes a twin primes iterator, which may or may not be of any interest.

You may also find that simple next_prime, is_prime, etc. may work for your needs, and then use prime_precalc to speed them up if the endpoint is reasonable &#40;e.g. under a few billion&#41;.


Lastly, if you&#39;re in some sort of reasonable range, then primesieve will be the fastest solution.  It has a faster sieve than ... well, anything.  But at some point you&#39;re too big for a sieve to be an effective solution &#40;you can debate at what point past 2^64 this occurs&#41;.  Most of them just plain don&#39;t support operation on anything more than 64-bits &#40;I&#39;m not sure anything does other than perhaps TOS&#39;s private code&#41;.  At this point you&#39;re *way* past the point of Math::Prime::FastSieve or Math::Prime::XS or Math::Big.  You&#39;re left with Math::Primality, Math::Prime::Util &#40;pure Perl&#41;, and Math::Prime::Util::GMP.  Or skip Perl and write your own GMP code or use David Cleaver&#39;s mpz_prp code.  I think Math::Prime::Util::GMP is the best solution &#40;or use the GMP code from it&#41;, but I&#39;m biased.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
