<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #40561 for Log-Dispatch: dispatch disregards individual output level settings</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #40561 for Log-Dispatch: dispatch disregards individual output level settings</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Log-Dispatch/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Log-Dispatch/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Log-Dispatch/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Log-Dispatch/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/houseabsolute/Log-Dispatch/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/Log-Dispatch">Log-Dispatch CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">40561</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Log-Dispatch/Active/">Log-Dispatch</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
steve [...] opensauce.de

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-19400-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.21    </td>
  </tr>
  <tr id="CF-19401-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
2.23    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;31&nbsp;07:05:54&nbsp;2008</span>
    <span class="description">steve [...] opensauce.de -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> dispatch disregards individual output level settings</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">My understanding is that each output specifies which levels it accepts
and should only be given valid messages. In Log::Dispatch 2.21 the log
method only checks if ANY of the outputs will accept the new message.
This results in messages appearing in outputs in which they should not
be expected.

Log::Dispatch::log checks logging levels across all outputs.
If the check succeeds, it then calls _log_to&#40;&#41; which sends the message
to all outputs regardless of their individual min_level and/or max_level
settings.

This can be fixed by adding a _should_log&#40;&#41; check in
Log::Dispatch::_log_to&#40;&#41; before sending the message to each output &#40;see
patch&#41;

I&#39;ve also included a simple test script which demonstrates this problem.

Steve
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Log.t</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl

use strict;
use warnings;
use YAML;
use Test::More;

use FindBin qw&#40; $RealBin &#41;;
use lib &#34;$RealBin/../../lib&#34;;
use SDE::Log

plan&#40; &#39;tests&#39; =&gt; 21 &#41;;

my $dispatcher = SDE::Log-&gt;dispatcher&#40;&#41;;

$dispatcher-&gt;add&#40; LogTester-&gt;new&#40;
                                &#39;name&#39;      =&gt; &#39;debug&#39;,
                                &#39;min_level&#39; =&gt; &#39;debug&#39;,
                                &#39;max_level&#39; =&gt; &#39;info&#39;,
                                &#41;
                &#41;;

$dispatcher-&gt;add&#40; LogTester-&gt;new&#40;
                                &#39;name&#39;      =&gt; &#39;runtime&#39;,
                                &#39;min_level&#39; =&gt; &#39;warning&#39;,
                                &#39;max_level&#39; =&gt; &#39;critical&#39;,
                                &#41;
                &#41;;

isa_ok&#40; $dispatcher, &#39;Log::Dispatch&#39;, &#39;Expect a Log::Dispatch object&#39; &#41;;

ok&#40;   $dispatcher-&gt;would_log&#40; &#39;debug&#39;     &#41;, &#39;debug     should not be logged&#39;  &#41;;
ok&#40;   $dispatcher-&gt;would_log&#40; &#39;info&#39;      &#41;, &#39;info      should not be logged&#39;  &#41;;
ok&#40; ! $dispatcher-&gt;would_log&#40; &#39;notice&#39;    &#41;, &#39;notice    should not be logged&#39;  &#41;;
ok&#40;   $dispatcher-&gt;would_log&#40; &#39;warning&#39;   &#41;, &#39;warning   should be logged&#39;      &#41;;
ok&#40;   $dispatcher-&gt;would_log&#40; &#39;error&#39;     &#41;, &#39;error     should be logged&#39;      &#41;;
ok&#40;   $dispatcher-&gt;would_log&#40; &#39;critical&#39;  &#41;, &#39;critical  should be logged&#39;      &#41;;
ok&#40; ! $dispatcher-&gt;would_log&#40; &#39;alert&#39;     &#41;, &#39;alert     should not be logged&#39;  &#41;;
ok&#40; ! $dispatcher-&gt;would_log&#40; &#39;emergency&#39; &#41;, &#39;emergency should not be logged&#39;  &#41;;

$dispatcher-&gt;log&#40; &#39;level&#39; =&gt; &#39;debug&#39;,     &#39;message&#39; =&gt; &#39;debug message&#39;     &#41;;
$dispatcher-&gt;log&#40; &#39;level&#39; =&gt; &#39;info&#39;,      &#39;message&#39; =&gt; &#39;info message&#39;      &#41;;
$dispatcher-&gt;log&#40; &#39;level&#39; =&gt; &#39;notice&#39;,    &#39;message&#39; =&gt; &#39;notice message&#39;    &#41;;
$dispatcher-&gt;log&#40; &#39;level&#39; =&gt; &#39;warning&#39;,   &#39;message&#39; =&gt; &#39;warning message&#39;   &#41;;
$dispatcher-&gt;log&#40; &#39;level&#39; =&gt; &#39;error&#39;,     &#39;message&#39; =&gt; &#39;error message&#39;     &#41;;
$dispatcher-&gt;log&#40; &#39;level&#39; =&gt; &#39;critical&#39;,  &#39;message&#39; =&gt; &#39;critical message&#39;  &#41;;
$dispatcher-&gt;log&#40; &#39;level&#39; =&gt; &#39;alert&#39;,     &#39;message&#39; =&gt; &#39;alert message&#39;     &#41;;
$dispatcher-&gt;log&#40; &#39;level&#39; =&gt; &#39;emergency&#39;, &#39;message&#39; =&gt; &#39;emergency message&#39; &#41;;

my @debug_messages   = $dispatcher-&gt;output&#40; &#39;debug&#39; &#41;-&gt;messages&#40;&#41;;

is&#40; $#debug_messages, 1, &#39;two debugging messages&#39; &#41;;
is&#40; $debug_messages[0]{&#39;level&#39;},    &#39;debug&#39;,            &#39;first debug message should have the level: debug&#39; &#41;;
is&#40; $debug_messages[0]{&#39;message&#39;},  &#39;debug message&#39;,    &#39;first debug message should have been a debug message&#39; &#41;;
is&#40; $debug_messages[1]{&#39;level&#39;},    &#39;info&#39;,             &#39;second debug message should have the level: info&#39; &#41;;
is&#40; $debug_messages[1]{&#39;message&#39;},  &#39;info message&#39;,     &#39;second debug message should have been an info message&#39; &#41;;

my @runtime_messages = $dispatcher-&gt;output&#40; &#39;runtime&#39; &#41;-&gt;messages&#40;&#41;;

is&#40; $#runtime_messages, 2, &#39;three runtime messages&#39; &#41;;
is&#40; $runtime_messages[0]{&#39;level&#39;},    &#39;warning&#39;,           &#39;first runtime message should have the level: debug&#39; &#41;;
is&#40; $runtime_messages[0]{&#39;message&#39;},  &#39;warning message&#39;,   &#39;first runtime message should have been a debug message&#39; &#41;;
is&#40; $runtime_messages[1]{&#39;level&#39;},    &#39;error&#39;,             &#39;second runtime message should have the level: error&#39; &#41;;
is&#40; $runtime_messages[1]{&#39;message&#39;},  &#39;error message&#39;,     &#39;second runtime message should have been an error message&#39; &#41;;
is&#40; $runtime_messages[2]{&#39;level&#39;},    &#39;critical&#39;,          &#39;third runtime message should have the level: critical&#39; &#41;;
is&#40; $runtime_messages[2]{&#39;message&#39;},  &#39;critical message&#39;,  &#39;third runtime message should have been a critical message&#39; &#41;;

exit&#40; 0 &#41;;

package LogTester;

use YAML;
use Log::Dispatch::Output;
use base qw&#40; Log::Dispatch::Output &#41;;

sub new
    {
        my $class = shift;
        my $self  = bless {}, $class;
        $self-&gt;_basic_init&#40; @_ &#41;;
        $self-&gt;{&#39;messages&#39;} = [];
        return $self;
    }

sub log
{
    my $self    = shift;
    my $message = { @_ };

    push&#40; @{$self-&gt;{&#39;messages&#39;}}, $message &#41;;
}

sub messages
{
    my $self = shift;
    return @{$self-&gt;{&#39;messages&#39;}};
}
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> level_check.patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git a/lib/Log/Dispatch.pm b/lib/Log/Dispatch.pm
index 0ad463c..a98f041 100755
--- a/lib/Log/Dispatch.pm
+++ b/lib/Log/Dispatch.pm
@@ -146,7 +146,7 @@ sub _log_to
 
     if &#40;exists $self-&gt;{outputs}{$name}&#41;
     {
-        $self-&gt;{outputs}{$name}-&gt;log&#40;@_&#41;;
+        $self-&gt;{outputs}{$name}-&gt;log&#40;@_&#41; if $self-&gt;{outputs}{$name}-&gt;_should_log&#40;$p{level}&#41;;
     }
     elsif &#40;$^W&#41;
     {
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;31&nbsp;07:54:58&nbsp;2008</span>
    <span class="description">steve [...] opensauce.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> steve [...] opensauce.de</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">oops - uploaded the wrong version of Log.t
This one uses Log::Dispatch instead of my derived class.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl

use strict;
use warnings;
use YAML;
use Test::More;

use Log::Dispatch;

plan&#40; &#39;tests&#39; =&gt; 21 &#41;;

my $dispatcher = Log::Dispatch-&gt;new&#40;&#41;;

$dispatcher-&gt;add&#40; LogTester-&gt;new&#40;
                                &#39;name&#39;      =&gt; &#39;debug&#39;,
                                &#39;min_level&#39; =&gt; &#39;debug&#39;,
                                &#39;max_level&#39; =&gt; &#39;info&#39;,
                                &#41;
                &#41;;

$dispatcher-&gt;add&#40; LogTester-&gt;new&#40;
                                &#39;name&#39;      =&gt; &#39;runtime&#39;,
                                &#39;min_level&#39; =&gt; &#39;warning&#39;,
                                &#39;max_level&#39; =&gt; &#39;critical&#39;,
                                &#41;
                &#41;;

isa_ok&#40; $dispatcher, &#39;Log::Dispatch&#39;, &#39;Expect a Log::Dispatch object&#39; &#41;;

ok&#40;   $dispatcher-&gt;would_log&#40; &#39;debug&#39;     &#41;, &#39;debug     should not be logged&#39;  &#41;;
ok&#40;   $dispatcher-&gt;would_log&#40; &#39;info&#39;      &#41;, &#39;info      should not be logged&#39;  &#41;;
ok&#40; ! $dispatcher-&gt;would_log&#40; &#39;notice&#39;    &#41;, &#39;notice    should not be logged&#39;  &#41;;
ok&#40;   $dispatcher-&gt;would_log&#40; &#39;warning&#39;   &#41;, &#39;warning   should be logged&#39;      &#41;;
ok&#40;   $dispatcher-&gt;would_log&#40; &#39;error&#39;     &#41;, &#39;error     should be logged&#39;      &#41;;
ok&#40;   $dispatcher-&gt;would_log&#40; &#39;critical&#39;  &#41;, &#39;critical  should be logged&#39;      &#41;;
ok&#40; ! $dispatcher-&gt;would_log&#40; &#39;alert&#39;     &#41;, &#39;alert     should not be logged&#39;  &#41;;
ok&#40; ! $dispatcher-&gt;would_log&#40; &#39;emergency&#39; &#41;, &#39;emergency should not be logged&#39;  &#41;;

$dispatcher-&gt;log&#40; &#39;level&#39; =&gt; &#39;debug&#39;,     &#39;message&#39; =&gt; &#39;debug message&#39;     &#41;;
$dispatcher-&gt;log&#40; &#39;level&#39; =&gt; &#39;info&#39;,      &#39;message&#39; =&gt; &#39;info message&#39;      &#41;;
$dispatcher-&gt;log&#40; &#39;level&#39; =&gt; &#39;notice&#39;,    &#39;message&#39; =&gt; &#39;notice message&#39;    &#41;;
$dispatcher-&gt;log&#40; &#39;level&#39; =&gt; &#39;warning&#39;,   &#39;message&#39; =&gt; &#39;warning message&#39;   &#41;;
$dispatcher-&gt;log&#40; &#39;level&#39; =&gt; &#39;error&#39;,     &#39;message&#39; =&gt; &#39;error message&#39;     &#41;;
$dispatcher-&gt;log&#40; &#39;level&#39; =&gt; &#39;critical&#39;,  &#39;message&#39; =&gt; &#39;critical message&#39;  &#41;;
$dispatcher-&gt;log&#40; &#39;level&#39; =&gt; &#39;alert&#39;,     &#39;message&#39; =&gt; &#39;alert message&#39;     &#41;;
$dispatcher-&gt;log&#40; &#39;level&#39; =&gt; &#39;emergency&#39;, &#39;message&#39; =&gt; &#39;emergency message&#39; &#41;;

my @debug_messages   = $dispatcher-&gt;output&#40; &#39;debug&#39; &#41;-&gt;messages&#40;&#41;;

is&#40; $#debug_messages, 1, &#39;two debugging messages&#39; &#41;;
is&#40; $debug_messages[0]{&#39;level&#39;},    &#39;debug&#39;,            &#39;first debug message should have the level: debug&#39; &#41;;
is&#40; $debug_messages[0]{&#39;message&#39;},  &#39;debug message&#39;,    &#39;first debug message should have been a debug message&#39; &#41;;
is&#40; $debug_messages[1]{&#39;level&#39;},    &#39;info&#39;,             &#39;second debug message should have the level: info&#39; &#41;;
is&#40; $debug_messages[1]{&#39;message&#39;},  &#39;info message&#39;,     &#39;second debug message should have been an info message&#39; &#41;;

my @runtime_messages = $dispatcher-&gt;output&#40; &#39;runtime&#39; &#41;-&gt;messages&#40;&#41;;

is&#40; $#runtime_messages, 2, &#39;three runtime messages&#39; &#41;;
is&#40; $runtime_messages[0]{&#39;level&#39;},    &#39;warning&#39;,           &#39;first runtime message should have the level: debug&#39; &#41;;
is&#40; $runtime_messages[0]{&#39;message&#39;},  &#39;warning message&#39;,   &#39;first runtime message should have been a debug message&#39; &#41;;
is&#40; $runtime_messages[1]{&#39;level&#39;},    &#39;error&#39;,             &#39;second runtime message should have the level: error&#39; &#41;;
is&#40; $runtime_messages[1]{&#39;message&#39;},  &#39;error message&#39;,     &#39;second runtime message should have been an error message&#39; &#41;;
is&#40; $runtime_messages[2]{&#39;level&#39;},    &#39;critical&#39;,          &#39;third runtime message should have the level: critical&#39; &#41;;
is&#40; $runtime_messages[2]{&#39;message&#39;},  &#39;critical message&#39;,  &#39;third runtime message should have been a critical message&#39; &#41;;

exit&#40; 0 &#41;;

package LogTester;

use YAML;
use Log::Dispatch::Output;
use base qw&#40; Log::Dispatch::Output &#41;;

sub new
    {
        my $class = shift;
        my $self  = bless {}, $class;
        $self-&gt;_basic_init&#40; @_ &#41;;
        $self-&gt;{&#39;messages&#39;} = [];
        return $self;
    }

sub log
{
    my $self    = shift;
    my $message = { @_ };

    push&#40; @{$self-&gt;{&#39;messages&#39;}}, $message &#41;;
}

sub messages
{
    my $self = shift;
    return @{$self-&gt;{&#39;messages&#39;}};
}
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;11&nbsp;12:39:51&nbsp;2008</span>
    <span class="description">DROLSKY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Oct 31 07:05:54 2008, cobber wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; My understanding is that each output specifies which levels it accepts
&gt; and should only be given valid messages. In Log::Dispatch 2.21 the log
&gt; method only checks if ANY of the outputs will accept the new message.
&gt; This results in messages appearing in outputs in which they should not
&gt; be expected.
&gt; 
&gt; Log::Dispatch::log checks logging levels across all outputs.
&gt; If the check succeeds, it then calls _log_to&#40;&#41; which sends the message
&gt; to all outputs regardless of their individual min_level and/or max_level
&gt; settings.
&gt; 
&gt; This can be fixed by adding a _should_log&#40;&#41; check in
&gt; Log::Dispatch::_log_to&#40;&#41; before sending the message to each output &#40;see
&gt; patch&#41;
&gt; 
&gt; I&#39;ve also included a simple test script which demonstrates this problem.
</div>
If you look at the log&#40;&#41; method in Log::Dispatch::Output, you&#39;ll see
that it handles this.

When you make a custom output, you need to provide a log_message method,
not override log.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;11&nbsp;12:39:55&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;11&nbsp;12:41:31&nbsp;2008</span>
    <span class="description">DROLSKY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m marking this resolved. If you have further questions, please reply
to me directly, as replying to this ticket will re-open it.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;11&nbsp;12:41:37&nbsp;2008</span>
    <span class="description">DROLSKY [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;12&nbsp;05:02:06&nbsp;2008</span>
    <span class="description">steve [...] opensauce.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #40561] dispatch disregards individual output level settings </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 12 Nov 2008 11:01:47 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Log-Dispatch [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Stephen Riehm &lt;steve [...] opensauce.de&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Dave,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m marking this resolved. If you have further questions, please reply
&gt; to me directly, as replying to this ticket will re-open it.
</div>
Thanks for taking the time to look at this issue.
Of course you&#39;re right, &#40;I just changed log&#40;&#41; to log_message&#40;&#41; in my  
test case and it works fine&#41;, however, I re-traced what I did and  
discovered the cause for my derailment.

In Log/Dispatch.pm it states:

        Making your own logging objects

        Making your own logging object is generally as simple as  
subclassing
        Log::Dispatch::Output and overriding the &#34;new&#34; and &#34;log&#34;  
methods.  See
        the Log::Dispatch::Output docs for more details.

&#40;which of course, I did ;-&#41;
Also, when you look at the documentation for Log::Dispatch::Output,  
only the public methods are described in detail.

So, here&#39;s a different small patch that I&#39;d like to suggest for the  
next release, changing &#34;log&#34; to &#34;log_message&#34; in the above sentence in  
Log/Dispatch.pm and making the subclassing details in Log/Dispatch/ 
Output.pm a bit clearer. &#40;see attached patch file&#41;.
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">


PS: I noticed that you updated Log::Dispatch::Output since I reported  
this issue - it&#39;s a start, but its right at the very bottom of the  
file and contradicts the information from Log::Dispatch.

Thanks,

Steve
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;12&nbsp;05:02:09&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;12&nbsp;18:11:13&nbsp;2009</span>
    <span class="description">DROLSKY [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;12&nbsp;18:11:20&nbsp;2009</span>
    <span class="description">DROLSKY [...] cpan.org -  Fixed in 2.23 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
