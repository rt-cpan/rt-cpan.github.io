<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #52098 for Finance-Quote: New MLC fund module</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #52098 for Finance-Quote: New MLC fund module</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Finance-Quote/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Finance-Quote/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Finance-Quote/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Finance-Quote/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Finance-Quote">Finance-Quote CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">52098</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Finance-Quote/Active/">Finance-Quote</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
philip.john.haynes [...] googlemail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-13576-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.17    </td>
  </tr>
  <tr id="CF-13577-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
1.17    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;26&nbsp;15:20:00&nbsp;2009</span>
    <span class="description">philip.john.haynes [...] googlemail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> New MLC fund module</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,
I have implemented a module called MLC.pm &#40;and one called APIR.pm which
it uses, although APIR could just be pasted into MLC if it was not
useful anywhere else&#41; for the purpose of downloading prices from the MLC
fund manager in Australia. I thought they might be of value to someone
else and so I have uploaded them here. Feel free to add them to the
Finance::Quote package or not.

I currently use them from within gnucash to retrieve prices for half a
dozen MLC funds on a regular basis using the APIR code as the commodity
value. I hope that it should work just as well with ISIN as the key but
it is not tested.

I am not in a position to commit to maintain them going forward although
I will probably have to keep them working for my own purposes if the
website changes and would push those changes back in here if desired.

Regards...

Environment:
Finance::Quote-&gt;VERSION = 1.17
Linux odin 2.6.28-16-generic #55-Ubuntu SMP Tue Oct 20 19:48:32 UTC 2009
x86_64 GNU/Linux
This is perl, v5.10.0 built for x86_64-linux-gnu-thread-multi
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> APIR.pm</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl -w
#
#    Copyright &#40;C&#41; 1998, Dj Padzensky &lt;djpadz@padz.net&gt;
#    Copyright &#40;C&#41; 1998, 1999 Linas Vepstas &lt;linas@linas.org&gt;
#    Copyright &#40;C&#41; 2000, Yannick LE NY &lt;y-le-ny@ifrance.com&gt;
#    Copyright &#40;C&#41; 2000, Paul Fenwick &lt;pjf@cpan.org&gt;
#    Copyright &#40;C&#41; 2000, Brent Neal &lt;brentn@users.sourceforge.net&gt;
#    Copyright &#40;C&#41; 2001, Leigh Wedding &lt;leigh.wedding@telstra.com&gt;
#    Copyright &#40;C&#41; 2003, Ian Dall &lt;ian@beware.dropbear.id.au&gt;
#    Copyright &#40;C&#41; 2009, Philip Haynes &lt;philip@london.mine.nu&gt;
#
#    This program is free software; you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation; either version 2 of the License, or
#    &#40;at your option&#41; any later version.
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU General Public License for more details.
#
#    You should have received a copy of the GNU General Public License
#    along with this program; if not, write to the Free Software
#    Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
#    02111-1307, USA
#
#
# This code derived from Padzensky&#39;s work on package Finance::YahooQuote,
# but extends its capabilites to additional data sources.
#
# This code was developed as part of GnuCash &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.gnucash.org/">http://www.gnucash.org/</a></span>&gt;

require 5.005;

use strict;

package Finance::Quote::APIR;

use HTTP::Request::Common;
use LWP::UserAgent;
use HTML::TableExtract;
use WWW::Mechanize;

use vars qw/$APIR_SEARCH_URL $APIR_RESULTS_URL $VERSION/;

$VERSION = &#39;0.1&#39;;

$APIR_SEARCH_URL = &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.apir.com.au/public/investmentFundSearch.jsp&#39;">http://www.apir.com.au/public/investmentFundSearch.jsp&#39;</a></span>;
$APIR_RESULTS_URL = &#39;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.apir.com.au/public/investmentFundSearchResults.jsp&#39;">http://www.apir.com.au/public/investmentFundSearchResults.jsp&#39;</a></span>;

# APIR provides a site that maps the names of Funds into their own
# specific APIR code and the ISIN of the fund through their website.
sub apir_map {
	my $searchString = shift;
	my $name_munge = shift;

	my $mech = WWW::Mechanize-&gt;new&#40;&#41;;
	$mech-&gt;get&#40;$APIR_SEARCH_URL&#41;;
	$mech-&gt;submit_form&#40;
		with_fields    =&gt; { name  =&gt; $searchString, }
	&#41;;
	my $rowCount = 0;
	my $lastRowCount = -1;
	my %map = {};
	while &#40;$rowCount != $lastRowCount&#41; {
		$mech-&gt;get&#40;$APIR_RESULTS_URL . &#34;?placeHolder=1&#38;name=&#34; . $searchString . &#34;&#38;start=&#34; . $rowCount&#41;;
		my $map_response = $mech-&gt;response&#40;&#41;;
		my $te = HTML::TableExtract-&gt;new&#40;
			headers =&gt; [&#34;APIR. Code&#34;, &#34;ISIN&#34;, &#34;Product name&#34;]
		&#41;;
		$te-&gt;parse&#40;$map_response-&gt;content&#41;;
		$lastRowCount = $rowCount;
		foreach my $row &#40;$te-&gt;rows&#41; {
			my &#40;$APIR, $ISIN, $apir_name&#41; = @$row;
			my $mlc_name = &#38;$name_munge&#40;$apir_name&#41;;
			%map-&gt;{$mlc_name, &#34;name&#34;} = $mlc_name;
			%map-&gt;{$mlc_name, &#34;APIR&#34;} = $APIR;
			%map-&gt;{$mlc_name, &#34;ISIN&#34;} = $ISIN;
			%map-&gt;{$ISIN, &#34;name&#34;} = $mlc_name;
			%map-&gt;{$ISIN, &#34;APIR&#34;} = $APIR;
			%map-&gt;{$ISIN, &#34;ISIN&#34;} = $ISIN;
			%map-&gt;{$APIR, &#34;name&#34;} = $mlc_name;
			%map-&gt;{$APIR, &#34;APIR&#34;} = $APIR;
			%map-&gt;{$APIR, &#34;ISIN&#34;} = $ISIN;
			#print &#34;DBG: in apir_map:&#34; . $map{$APIR, &#34;ISIN&#34;} . &#34;:\n&#34;;
			$rowCount++;
		}
	}
	return %map if wantarray;
	return \%map;

}

sub find_fund {
	my &#40;$searchString, $fundKey&#41; = @_;
	my %map = apir_map&#40;$searchString&#41;;
	return &#40;$map{$fundKey, &#34;name&#34;}, $map{$fundKey, &#34;APIR&#34;}, $map{$fundKey, &#34;ISIN&#34;}&#41;; 
}
1;

=head1 NAME

Finance::Quote::APIR	- Obtain fund name mapping from the APIR

=head1 SYNOPSIS

    use Finance::Quote;
    use Finance::Quote::APIR;

    %m = Finance::Quote::APIR::apir_map&#40;&lt;search string&gt;&#41;;
    
    where &lt;search string&gt; is a string by which to constrain the funds to map. This will
    ensure that you get the right ISIN and APIR when there are the same fund names for different
    MLC products that can have different prices.

    $stock_code = $m{&#34;My Fund Name&#34;, &#34;APIR&#34;};
    $stock_isin = $m{&#34;My Fund Name&#34;, &#34;ISIN&#34;};
    $stock_name = $m{&#34;ISINCODE001&#34;, &#34;name&#34;};

    $q = Finance::Quote-&gt;new;
    %stockinfo = $q-&gt;fetch&#40;&#34;MLC&#34;, $stock_code&#41;;	   # Only query MLC

=head1 DESCRIPTION

MLC is an Australian fund manager that provides end of day prices for their funds on their
website. However, they only provide the prices indexed by fund name and the same product,
say &#34;Balanced Portfolio Fund&#34; is offered in many different packages under different ISIN
and as a result with potentially different prices. In order to use these funds in Finance::Quote
it is useful if not necessary to map between the name of the fund and the actual ISIN or
APIR code that should be used to identify the specific instance of the product in which to
denominate a holding in the fund, such as &#34;commodity&#34; in GNUCash.

To that end this module, provides the ability to connect to a company called APIR and download
a subset of funds and from that subset produce a mapping of Name, APIR Code and ISIN to solve
this problem.

=head1 SEE ALSO

APIR, <span class="clickylink"><a target="new" rel="nofollow" href="http://www.apir.com.au">http://www.apir.com.au</a></span>

=cut
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> MLC.pm</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl -w
#
#    Copyright &#40;C&#41; 1998, Dj Padzensky &lt;djpadz@padz.net&gt;
#    Copyright &#40;C&#41; 1998, 1999 Linas Vepstas &lt;linas@linas.org&gt;
#    Copyright &#40;C&#41; 2000, Yannick LE NY &lt;y-le-ny@ifrance.com&gt;
#    Copyright &#40;C&#41; 2000, Paul Fenwick &lt;pjf@cpan.org&gt;
#    Copyright &#40;C&#41; 2000, Brent Neal &lt;brentn@users.sourceforge.net&gt;
#    Copyright &#40;C&#41; 2001, Leigh Wedding &lt;leigh.wedding@telstra.com&gt;
#    Copyright &#40;C&#41; 2003, Ian Dall &lt;ian@beware.dropbear.id.au&gt;
#    Copyright &#40;C&#41; 2009, Philip Haynes &lt;philip@london.mine.nu&gt;
#
#    This program is free software; you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation; either version 2 of the License, or
#    &#40;at your option&#41; any later version.
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU General Public License for more details.
#
#    You should have received a copy of the GNU General Public License
#    along with this program; if not, write to the Free Software
#    Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
#    02111-1307, USA
#
#
# This code derived from Padzensky&#39;s work on package Finance::YahooQuote,
# but extends its capabilites to additional data sources.
#
# This code was developed as part of GnuCash &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.gnucash.org/">http://www.gnucash.org/</a></span>&gt;

require 5.005;

use strict;

package Finance::Quote::MLC;

use HTTP::Request::Common;
use LWP::UserAgent;
use HTML::TableExtract;
use WWW::Mechanize;
use Finance::Quote::APIR;

use vars qw/$MLC_URL $MLC_EXCHANGE $VERSION/;

$VERSION = &#39;0.1&#39;;

$MLC_URL = &#39;<span class="clickylink"><a target="new" rel="nofollow" href="https://www.mlc.com.au/masterkeyWeb/execute/UnitPrices&#39;">https://www.mlc.com.au/masterkeyWeb/execute/UnitPrices&#39;</a></span>;
$MLC_EXCHANGE = &#34;MLC Asset Management&#34;;

sub methods {
	return &#40;
		mlc =&gt; \&#38;mlc_masterkey_investment_service,
		mlc_masterkey_unit_trust =&gt; \&#38;mlc_masterkey_unit_trust,
		mlc_masterkey_allocated_pension =&gt; \&#38;mlc_masterkey_allocated_pension,
		mlc_masterkey_investment_service =&gt; \&#38;mlc_masterkey_investment_service,
		mlc_masterkey_investment_service_fundamentals =&gt; \&#38;mlc_masterkey_investment_service_fundamentals
	&#41;
}

{
	my @labels = qw/name last bid ask date isodate currency/;

	sub labels {
		return &#40;
			mlc                                            =&gt; \@labels,
			mlc_masterkey_unit_trust                       =&gt; \@labels,
			mlc_masterkey_investment_service               =&gt; \@labels,
			mlc_masterkey_investment_service_fundamentals  =&gt; \@labels
		&#41;;
	}
}

# MLC Asset Management &#40;MLC&#41;
# MLC provides free end of day quotes through their webpage.
#
sub mlc_generic {
	my $productMLC = shift;
	my $apirSearch = shift;
	my $name_munge = shift;
	my $quoter = shift;
	my @stocks = @_;
	return unless @stocks;
	my %info;

	my $ua = $quoter-&gt;user_agent;
	my $response = $ua-&gt;request&#40;GET $MLC_URL&#41;;

	unless &#40;$response-&gt;is_success&#41; {
		foreach my $stock &#40;@stocks&#41; {
			$info{$stock,&#34;success&#34;} = 0;
			$info{$stock,&#34;errormsg&#34;} = &#34;HTTP session failed&#34;;
		}
		return wantarray&#40;&#41; ? %info : \%info;
	}

	my @rows;
	foreach &#40;split &#34;\\n&#34;, $response-&gt;content&#41; {
		chomp;
		chop;
		if &#40;$_ =~ /product[0-9]*funds\[[0-9]*\]=.*/&#41; {
			s/&#34;//g;
			my &#40;$arrayString, @info&#41; = split &#34;[=,]&#34;, $_;
			push @rows, [@info];
		}
	}
	unless &#40;@rows&#41; {
		foreach my $stock &#40;@stocks&#41; {
			$info{$stock,&#34;success&#34;} = 0;
			$info{$stock,&#34;errormsg&#34;} = &#34;Failed to parse HTML table.&#34;;
		}
		return wantarray&#40;&#41; ? %info : \%info;
	}

	my %map = Finance::Quote::APIR::apir_map&#40;$apirSearch, $name_munge&#41;;
	# Pack the resulting data into our structure.
	foreach my $row &#40;@rows&#41; {
	    	my $name = shift&#40;@$row&#41;;
		next if !defined&#40;$name&#41;;
	    	my $product = shift&#40;@$row&#41;;
		next if !&#40;$product eq $productMLC&#41;;
		# Delete spaces and &#39;*&#39; which sometimes appears after the code.
		# Also delete high bit characters.
		$name =~ tr/ \000-\037\200-\377/ /s;
		$name =~ s/^ *//;
		$name =~ s/ *$//;
		my $stock = $map{$name, &#34;APIR&#34;};
		if &#40;! $stock&#41; { next };
		$info{$stock,&#39;symbol&#39;} = $stock;
		$info{$stock,&#39;name&#39;} = $name;

		#ignore records with any interest rate denominated values, indicated by a 
		#&#34;%&#34; symbol at the end of the price
		next if join&#40;&#39;,&#39;, @$row&#41; =~ /,[0-9.]+\%/;
		foreach my $label &#40;qw/date bid ask/&#41; {
			$info{$stock,$label} = shift&#40;@$row&#41;;
			# Again, get rid of nasty high-bit characters.
			$info{$stock,$label} =~ tr/\200-\377//d 
				unless &#40;$label eq &#34;name&#34;&#41;;
		}
		
		$info{$stock,&#39;last&#39;} = $info{$stock,&#39;bid&#39;};
		$quoter-&gt;store_date&#40;\%info, $stock, {eurodate =&gt; $info{$stock,&#39;date&#39;}}&#41;;
		$info{$stock, &#34;currency&#34;} = &#34;AUD&#34;;
		$info{$stock, &#34;method&#34;} = &#40;reverse&#40;split&#40;/:+/, &#40;caller&#40;1&#41;&#41;[3]&#41;&#41;&#41;[0] ;
		$info{$stock, &#34;exchange&#34;} = $MLC_EXCHANGE;
		$info{$stock, &#34;product&#34;} = $product;
		$info{$stock, &#34;price&#34;} = $info{$stock,&#34;last&#34;};
		$info{$stock, &#34;success&#34;} = 1;
	}
	return %info if wantarray;
	return \%info;
}

sub unit_trust_name_munge {
	my $name = shift;
	$name =~ s/MasterKey Unit Trust - //;
	$name =~ s/MLC MasterKey Unit Trust Horizon/MLC MasterKey Horizon/;
	return $name;
};

sub mlc_masterkey_investment_service {
	my $quoter = shift;
	my @stocks = @_;
	return unless @stocks;
	return mlc_generic&#40;&#34;MasterKey Investment Service&#34;, &#34;MLC%20MasterKey%20Unit%20Trust&#34;, \&#38;unit_trust_name_munge, $quoter, @stocks&#41;
}

# This one is broken, FIX the function to do the fund name munging
sub mlc_masterkey_investment_service_fundamentals {
	my $quoter = shift;
	my @stocks = @_;
	return unless @stocks;
	return mlc_generic&#40;&#34;MasterKey Investment Service Fundamentals&#34;, &#34;MLC%20MasterKey%20Unit%20Trust&#34;, \&#38;unit_trust_name_munge, $quoter, @stocks&#41;
}

sub mlc_masterkey_unit_trust {
	my $quoter = shift;
	my @stocks = @_;
	return unless @stocks;
	return mlc_generic&#40;&#34;MasterKey Unit Trust&#34;, &#34;MLC%20MasterKey%20Unit%20Trust&#34;, \&#38;unit_trust_name_munge, $quoter, @stocks&#41;
}

sub mlc_masterkey_allocated_pension {
	my $quoter = shift;
	my @stocks = @_;
	return unless @stocks;
	return mlc_generic&#40;&#34;MasterKey Allocated Pension&#34;, &#34;MLC%20MasterKey%20Allocated&#34;, \&#38;unit_trust_name_munge, $quoter, @stocks&#41;
}

1;

=head1 NAME

Finance::Quote::MLC	- Obtain quotes from the MLC Asset Management.

=head1 SYNOPSIS

    use Finance::Quote;

    $q = Finance::Quote-&gt;new;

    %stockinfo = $q-&gt;fetch&#40;&#34;MLC&#34;,&#34;MLC0011AU&#34;&#41;;	   # Only query MLC

=head1 DESCRIPTION

This module obtains information from the MLC Financial Planning organisation, the
wealth management division of the National Australia Bank
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.mlc.com.au/mlc">http://www.mlc.com.au/mlc</a></span>

This module is loaded by default on a Finance::Quote object.  It&#39;s
also possible to load it explicity by placing &#34;MLC&#34; in the argument
list to Finance::Quote-&gt;new&#40;&#41;. Unfortunately MLC has a mechanism by which the same
fund names are offered under several &#34;products&#34; and these funds have different prices
depending on the product under which they are offered.

=head2 MLC GENERIC LOOKUP FUNCTION

This function B&lt;mlc_generic&#40;&#41;&gt; implements a generic lookup on the MLC website to retrieve some prices of MLC funds.
It takes 5 parameters;

=over

=item MLC Product

The text string that identifies the MLC product under which the funds are offered. Whilst technically
this is just a string that is matched against the name of the funds published by MLC, it probably makes
sense to constrain it to the known values of the different products in their offering. This includes;
MasterKey Investment Service

=item APIR Search String

The text string that represents the equivalent section of the APIR product database to return the correct
prices for the given MLC product. The specific mappings must be known by the programmers adding instances
of specific MLC lookup functions.

=item Name Munging Function

A reference to the function that will munge the APIR name into the MLC name to allow straightforward
matching of funds in the two systems. These functions should receive a single paramter, a text string,
that is the name of the fund and return a single text string that is the new name as thhe MLC website
publishes it.

=item Quoter

A reference to the Quoter object from the L&lt;Finance::Quote|Finance::Quote&gt; package.

=item Stocks

The list of stock codes for which prices should be found.

=back

=head1 LABELS RETURNED

The following labels may be returned by Finance::Quote::MLC:
name, date, bid, ask, last, currency and price.

=head1 SEE ALSO

MLC Asset Management, <span class="clickylink"><a target="new" rel="nofollow" href="http://www.mlc.com.au/mlc">http://www.mlc.com.au/mlc</a></span>

=cut
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;24&nbsp;19:51:26&nbsp;2010</span>
    <span class="description">KRYDE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I made a Finance::Quote::MLC module too, available on cpan, which may be
of some value.

I combined the fund and product name parts in the &#34;symbol&#34;.  It comes
out very long, but I couldn&#39;t spot any shorter symbols etc in the web
site at the time.  The names have seemed fairly stable over the years
though.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;24&nbsp;19:51:28&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
