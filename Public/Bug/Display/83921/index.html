<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #83921 for mod_perl: 5.17.6 new hash scheme requires update</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #83921 for mod_perl: 5.17.6 new hash scheme requires update</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=mod_perl">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=mod_perl">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=mod_perl">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=mod_perl">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/mod_perl">mod_perl CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">83921</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=mod_perl">mod_perl</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
zefram [...] fysh.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-21786-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-21787-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




no_rehash.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1190506/628072/no_rehash.patch">
Wed Mar 13 10:23:31 2013 (1.3k) by zefram [...] fysh.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=83921">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1190506" href="/Public/Bug/Display.html?id=83921#txn-1190506">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;13&nbsp;10:23:31&nbsp;2013</span>
    <span class="description">zefram [...] fysh.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 5.17.6 new hash scheme requires update</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 13 Mar 2013 14:23:17 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-mod_perl [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Zefram &lt;zefram [...] fysh.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1190506/628071/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/628071">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 137b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Perl 5.17.6 and above, hash seeding has changed, and HvREHASH has
disappeared.  Attached patch updates mod_perl accordingly.

-zefram
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1190506/628072/no_rehash.patch">Download no_rehash.patch</a><br />
<span class="downloadcontenttype">text/x-diff 1.3k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1190844" href="/Public/Bug/Display.html?id=83921#txn-1190844">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;14&nbsp;05:06:44&nbsp;2013</span>
    <span class="description">shay [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1190844/628272/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/628272">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 927b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for the patch. Testing looks good so far, but I&#39;m confused by the
perl versions in this patch.

The comment above modperl_hash_seed_set&#40;&#41; &#40;which your patch doesn&#39;t
update, btw -- it would be helpful if it did&#41; speaks of different
behaviour before 5.8.1 compared to 5.8.1 onwards, and yet the original
code picked out just 5.8.1 for special treatment, which looks odd. Was
that wrong to start with? Should it have said #if
MP_PERL_VERSION_AT_LEAST&#40;5, 8, 1&#41; rather than #if MP_PERL_VERSION&#40;5, 8, 1&#41;?

In your patched version you now refer to #if MP_PERL_VERSION_AT_LEAST&#40;5,
8, 2&#41;, i.e. 5.8.2 onwards, which is different again. Is that intentional?

Also, am I correct in thinking that the change which this patch is for
only went into 5.17.6, and was not part of the rehash security fix that
also went into 5.14.4 and 5.16.3? &#40;I think so, not least since mp2
builds fine on those versions, but I&#39;m just double-checking...&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1190847" href="/Public/Bug/Display.html?id=83921#txn-1190847">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;14&nbsp;05:06:45&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1190911" href="/Public/Bug/Display.html?id=83921#txn-1190911">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;14&nbsp;07:38:36&nbsp;2013</span>
    <span class="description">zefram [...] fysh.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #83921] 5.17.6 new hash scheme requires update</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 14 Mar 2013 11:38:12 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Steve Hay via RT &lt;bug-mod_perl [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Zefram &lt;zefram [...] fysh.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1190911/628307/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/628307">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Steve Hay via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;                                              speaks of different
&gt;behaviour before 5.8.1 compared to 5.8.1 onwards, and yet the original
&gt;code picked out just 5.8.1 for special treatment, which looks odd. Was
&gt;that wrong to start with?
</div>
Picking out a single version is pretty much never the right way to
construct a perl version condition.  You should almost always compare $]
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;= constant &#40;or, for the opposite sense, $] &lt; constant&#41;.  Of the macros
</div>you have for this, only MP_PERL_VERSION_AT_LEAST&#40;&#41; performs this preferred
type of comparison.

In this particular case, it&#39;s complicated.  5.8.2 and above, until
the change in 5.17.6, have hash_seed and rehash_seed.  5.8.1 has
only hash_seed.  5.8.0 and below have *neither*, so neither version of
the code there is correct.  On those versions the outer conditional,
MP_NEED_HASH_SEED_FIXUP, must be false, which it is by virtue of a
MP_PERL_VERSION_AT_MOST&#40;5, 8, 0&#41; in the logic defining it.

So the existing logic is extensionally correct, in that it produces the
correct result on each Perl version.  But it&#39;s in a misleading form; it
*looks* wrong.  In the course of adding the new branch to the conditional,
with a condition that must be a range check, it seemed least confusing,
albeit strictly unncessary, to reformulate the existing condition into
the standard form.  This way the conditions take the same form, they
best express the way changes occur between versions, and the branches
of the conditional appear in strict descending order of version range.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;                          Should it have said #if
&gt;MP_PERL_VERSION_AT_LEAST&#40;5, 8, 1&#41; rather than #if MP_PERL_VERSION&#40;5, 8, 1&#41;?
</div>
No, that would have been incorrect, because that condition
needs to be false on 5.8.2 and above.  It could have correctly
been MP_PERL_VERSION_AT_MOST&#40;5, 8, 1&#41;.  The range check behind
MP_NEED_HASH_SEED_FIXUP could &#40;and ideally should&#41; be expressed
as MP_PERL_VERSION_AT_LEAST&#40;5, 8, 1&#41; rather than the present
!MP_PERL_VERSION_AT_MOST&#40;5, 8, 0&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;In your patched version you now refer to #if MP_PERL_VERSION_AT_LEAST&#40;5,
&gt;8, 2&#41;, i.e. 5.8.2 onwards, which is different again. Is that intentional?
</div>
This is just doing the &#40;correct&#41; range check the preferred way round.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;Also, am I correct in thinking that the change which this patch is for
&gt;only went into 5.17.6, and was not part of the rehash security fix that
&gt;also went into 5.14.4 and 5.16.3?
</div>
Yes.  Such a radical change isn&#39;t allowed in maint releases these days;
it&#39;s not like the 5.8.1 days.  5.16.3 just tweaks the existing hash
mechanism, but 5.17.6 replaces it wholesale.

-zefram
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1191252" href="/Public/Bug/Display.html?id=83921#txn-1191252">#</a>      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;15&nbsp;05:14:25&nbsp;2013</span>
    <span class="description">shay [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1191252/628501/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/628501">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Mar 14 07:38:36 2013, zefram@fysh.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Steve Hay via RT wrote:
<div class="message-stanza open">&gt; &gt;                                              speaks of different
&gt; &gt;behaviour before 5.8.1 compared to 5.8.1 onwards, and yet the original
&gt; &gt;code picked out just 5.8.1 for special treatment, which looks odd. Was
&gt; &gt;that wrong to start with?
</div>&gt; 
&gt; Picking out a single version is pretty much never the right way to
&gt; construct a perl version condition.  You should almost always compare $]
<div class="message-stanza open">&gt; &gt;= constant &#40;or, for the opposite sense, $] &lt; constant&#41;.  Of the macros
</div>&gt; you have for this, only MP_PERL_VERSION_AT_LEAST&#40;&#41; performs this preferred
&gt; type of comparison.
&gt; 
&gt; In this particular case, it&#39;s complicated.  5.8.2 and above, until
&gt; the change in 5.17.6, have hash_seed and rehash_seed.  5.8.1 has
&gt; only hash_seed.  5.8.0 and below have *neither*, so neither version of
&gt; the code there is correct.  On those versions the outer conditional,
&gt; MP_NEED_HASH_SEED_FIXUP, must be false, which it is by virtue of a
&gt; MP_PERL_VERSION_AT_MOST&#40;5, 8, 0&#41; in the logic defining it.
&gt; 
&gt; So the existing logic is extensionally correct, in that it produces the
&gt; correct result on each Perl version.  But it&#39;s in a misleading form; it
&gt; *looks* wrong.  In the course of adding the new branch to the conditional,
&gt; with a condition that must be a range check, it seemed least confusing,
&gt; albeit strictly unncessary, to reformulate the existing condition into
&gt; the standard form.  This way the conditions take the same form, they
&gt; best express the way changes occur between versions, and the branches
&gt; of the conditional appear in strict descending order of version range.
</div>
Thanks for the clarification. I agree it looks much better now :-&#41;


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt;                          Should it have said #if
&gt; &gt;MP_PERL_VERSION_AT_LEAST&#40;5, 8, 1&#41; rather than #if MP_PERL_VERSION&#40;5,
</div></div>8, 1&#41;?
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; No, that would have been incorrect, because that condition
&gt; needs to be false on 5.8.2 and above.  It could have correctly
&gt; been MP_PERL_VERSION_AT_MOST&#40;5, 8, 1&#41;.  The range check behind
&gt; MP_NEED_HASH_SEED_FIXUP could &#40;and ideally should&#41; be expressed
&gt; as MP_PERL_VERSION_AT_LEAST&#40;5, 8, 1&#41; rather than the present
&gt; !MP_PERL_VERSION_AT_MOST&#40;5, 8, 0&#41;.
</div>
Ah, now that I understand, I would not have asked that question! That&#39;s
how misleading it *was*!...


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt;In your patched version you now refer to #if MP_PERL_VERSION_AT_LEAST&#40;5,
&gt; &gt;8, 2&#41;, i.e. 5.8.2 onwards, which is different again. Is that intentional?
</div>&gt; 
&gt; This is just doing the &#40;correct&#41; range check the preferred way round.
&gt; 
<div class="message-stanza open">&gt; &gt;Also, am I correct in thinking that the change which this patch is for
&gt; &gt;only went into 5.17.6, and was not part of the rehash security fix that
&gt; &gt;also went into 5.14.4 and 5.16.3?
</div>&gt; 
&gt; Yes.  Such a radical change isn&#39;t allowed in maint releases these days;
&gt; it&#39;s not like the 5.8.1 days.  5.16.3 just tweaks the existing hash
&gt; mechanism, but 5.17.6 replaces it wholesale.
&gt; 
</div>
Ok, it looks good to me then, but I will actually test it with various
perl versions before committing it. I will do that over this coming
weekend and then maybe see if we can get a 2.0.8 release rolled soon.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1191982" href="/Public/Bug/Display.html?id=83921#txn-1191982">#</a>      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;17&nbsp;22:08:56&nbsp;2013</span>
    <span class="description">shay [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1191982/628917/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/628917">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 82b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks again for the patch. Now committed to mod_perl&#39;s trunk as
revision 1457618.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1191985" href="/Public/Bug/Display.html?id=83921#txn-1191985">#</a>      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;17&nbsp;22:08:58&nbsp;2013</span>
    <span class="description">shay [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.412557</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
