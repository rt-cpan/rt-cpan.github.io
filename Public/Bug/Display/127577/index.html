<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #127577 for Test-Smoke: Test-Smoke smoked incorrect branch</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #127577 for Test-Smoke: Test-Smoke smoked incorrect branch</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Test-Smoke/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Test-Smoke/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Test-Smoke/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Test-Smoke/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Test-Smoke">Test-Smoke CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">127577</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Test-Smoke/Active/">Test-Smoke</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
jkeenan [...] pobox.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-31598-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-31599-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




defective-20181105.tar.gz<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1818360/978340/defective-20181105.tar.gz">
Mon Nov 05 18:02:50 2018 (60.8k) by jkeenan [...] pobox.com
</a>
</font></li>
</ul>


rtc-125927-problem-2.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1818360/978341/rtc-125927-problem-2.txt">
Mon Nov 05 18:02:50 2018 (8.1k) by jkeenan [...] pobox.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;05&nbsp;18:02:50&nbsp;2018</span>
    <span class="description">jkeenan [...] pobox.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Test-Smoke smoked incorrect branch</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 5 Nov 2018 18:02:26 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-Smoke [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> James E Keenan &lt;jkeenan [...] pobox.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Once again I have to report a situation where Test-Smoke did not smoke 
the branch I requested.

I reported an instance of this problem several months ago as &#34;Problem 2&#34; 
in <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=125927">https://rt.cpan.org/Ticket/Display.html?id=125927</a></span>.  Most of my 
subsequent posts in that ticket concerned &#34;Problem 1&#34;.  I haven&#39;t had a 
response to either problem, but since Problem 2 has reoccurred let&#39;s put 
all discussion of that problem in one new ticket.  My original statement 
of Problem 2 is attached.

Here is the new instance.

I manually kick off smoke-test runs of blead and other branches on a 
FreeBSD-11.2-STABLE host, &#39;perlmonger.nycbug.org&#39;.  The 2 most recent 
runs on that platform &#40;as of the composition of this message, and as 
displayed at <span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/search">http://perl5.test-smoke.org/search</a></span> with appropriate 
drop-down selections&#41; are:

#####
URL|Git-id|Branch|Smoke date|Status
<span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/report/73583">http://perl5.test-smoke.org/report/73583</a></span>|v5.29.4-34-g328d907979|blead|2018-11-05 
00:23:31+00|PASS
<span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/report/73607">http://perl5.test-smoke.org/report/73607</a></span>|v5.26.2-85-gadf1b5d28a|smoke-me/jkeenan/cleanup-t-io-fs|2018-11-05 
13:07:31+00|PASS
#####

Now, just looking at that, you might wonder about the &#34;v5.26.2&#34; in the 
Git-id of run 73607.  For one thing, another run on that page lists a 
run of the &#34;smoke-me/jkeenan/cleanup-t-io-fs&#34; branch but with a Git-id 
beginning &#34;v5.29.4&#34;.

#####
URL|Git-id|Branch|Smoke date|Status
<span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/report/73178">http://perl5.test-smoke.org/report/73178</a></span>|v5.29.4-22-g167698623c|smoke-me/jkeenan/cleanup-t-io-fs|2018-10-29 
22:40:15+00|PASS
#####

Here&#39;s the problem:  What I *wanted* to test earlier today was the 
&#39;maint-5.26&#39; branch, *not* the smoke-me/jkeenan/cleanup-t-io-fs branch. 
In my &#39;smokecurrent.gitbranch&#39; file the first 3 entries at the point 
when I kicked off the smoke-test run were:

#####
maint-5.26
blead
smoke-me/jkeenan/cleanup-t-io-fs
#####

&#40;See tarball attached for 
&#39;defective-20181105/adf1b5d2/smokecurrent.gitbranch&#39; and other files 
subsequently mentioned in this report.&#41;

Suppose that I go into the &#39;git-perl&#39; directory of my Test-Smoke rig and 
call &#39;git status&#39;.  As recorded in 
defective-20181105/adf1b5d2/git-perl.git.status.txt, I get:

#####
On branch maint-5.26
Your branch is up to date with &#39;origin/maint-5.26&#39;.

nothing to commit, working tree clean
#####

Everything fine there.  Now supposed I go next door to the 
&#39;perl-current&#39; directory in which the run is executed.  As recorded in 
defective-20181105/adf1b5d2/perl-current.git.status.txt, I get:

#####
$ cat perl-current.git.status.txt
On branch smoke-me/jkeenan/cleanup-t-io-fs
Your branch and &#39;origin/smoke-me/jkeenan/cleanup-t-io-fs&#39; have diverged,
and have 323 and 3496 different commits each, respectively.
   &#40;use &#34;git pull&#34; to merge the remote branch into yours&#41;

Changes not staged for commit:
   &#40;use &#34;git add &lt;file&gt;...&#34; to update what will be committed&#41;
   &#40;use &#34;git checkout -- &lt;file&gt;...&#34; to discard changes in working directory&#41;

        modified:   patchlevel.h

Untracked files:
   &#40;use &#34;git add &lt;file&gt;...&#34; to include in what will be committed&#41;

        mktest.jsn
        mktest.out
        mktest.rpt
        patchlevel.bak

no changes added to commit &#40;use &#34;git add&#34; and/or &#34;git commit -a&#34;&#41;
#####

Big problem!  The &#39;perl-current&#39; directory was not updated to hold 
&#39;maint-5.26&#39;.  Worse, it&#39;s not even holding blead any more.  For some 
reason it appears to have done a checkout of a branch from more than a 
week ago!

We can also spot problems developing in the log file.  I&#39;ve included 
both the full .log file and a &#39;head&#39; of it in the tarball.  If we look 
at defective-20181105/adf1b5d2/adf1b5d2.head.log, we see:

#####
[2018-11-05 13:07:26+0000] ==&gt; Starting synctree
[2018-11-05 13:07:26+0000] qx[/usr/local/bin/git remote update --prune 2&gt;&#38;1]
[2018-11-05 13:07:28+0000] qx[/usr/local/bin/git checkout maint-5.26
[2018-11-05 13:07:28+0000]  2&gt;&#38;1]
Switched to a new branch &#39;maint-5.26&#39;
[2018-11-05 13:07:29+0000] qx[/usr/local/bin/git reset --hard 
origin/maint-5.26
[2018-11-05 13:07:29+0000]  2&gt;&#38;1]
[2018-11-05 13:07:29+0000] qx[/usr/local/bin/git clean -dfx 2&gt;&#38;1]
[2018-11-05 13:07:29+0000] qx[/usr/local/bin/git fetch origin 2&gt;&#38;1]
[2018-11-05 13:07:30+0000] qx[/usr/local/bin/git checkout maint-5.26
[2018-11-05 13:07:30+0000]  2&gt;&#38;1]
#####

So far so good.

#####
error: Your local changes to the following files would be overwritten by 
checkout:
        patchlevel.h
Please commit your changes or stash them before you switch branches.
Aborting
#####

I get that on every smoke test run.

#####
[2018-11-05 13:07:30+0000] qx[/usr/local/bin/git reset --hard 
origin/maint-5.26
[2018-11-05 13:07:30+0000]  2&gt;&#38;1]
[2018-11-05 13:07:31+0000] qx[/usr/local/bin/perl5 
Porting/make_dot_patch.pl &gt; .patch]
[2018-11-05 13:07:31+0000] /home/jkeenan/p5smoke/perl-current is now up 
to patchlevel adf1b5d28a4fd0e20bbbb72cab062fdd520cb065
#####

Everything *looks* good here. Commit adf1b5d28 was the then-current head 
of the maint-5.26 branch:

#####
commit adf1b5d28a4fd0e20bbbb72cab062fdd520cb065 &#40;origin/maint-5.26&#41;
Author:     Steve Hay &lt;steve.m.hay@googlemail.com&gt;
AuthorDate: Sun Nov 4 20:55:50 2018 +0000
Commit:     Steve Hay &lt;steve.m.hay@googlemail.com&gt;
CommitDate: Sun Nov 4 20:55:50 2018 +0000

     Import perl5280delta.pod
#####

Continuing:

#####
[2018-11-05 13:07:31+0000] ==&gt; Starting runsmoke
[2018-11-05 13:07:31+0000] [./tssmokeperl.pl] 
chdir&#40;/home/jkeenan/p5smoke/perl-current&#41;
[2018-11-05 13:07:31+0000] Setup alarm: Mon Nov  5 19:07:31 2018
[2018-11-05 13:07:31+0000] qx[/usr/local/bin/perl5 -e &#34;require 
q[/home/jkeenan/p5smoke/perl-current/cpan/Test-Harness/lib/Test/Harness.pm];print 
Test::Harness-&gt;VERSION&#34; 2&gt;&#38;1]
[2018-11-05 13:07:31+0000] Found: Test::Harness version 3.38.
[2018-11-05 13:07:31+0000] Reading build configurations from 
/home/jkeenan/p5smoke/perlcurrent.cfg
[2018-11-05 13:07:31+0000] Reading &#39;Policy.sh&#39; from default content &#40;v=1&#41;
[2018-11-05 13:07:31+0000] Running test suite only with &#39;harness&#39;
[2018-11-05 13:07:31+0000] make distclean ...
[2018-11-05 13:07:31+0000] Smoking patch 
adf1b5d28a4fd0e20bbbb72cab062fdd520cb065 v5.26.2-85-gadf1b5d28a
#####

Again, everything *looks* good.  But on the very next line we see:

#####
[2018-11-05 13:07:31+0000] Smoking branch smoke-me/jkeenan/cleanup-t-io-fs
#####

Where did that come from?

I grepped in the source code for those log messages and found this:

#####
$ ack &#39;Smoking &#40;branch|patch&#41;&#39; lib/Test
lib/Test/Smoke.pm
179:        $smoker-&gt;ttylog&#40;&#34;Smoking patch $patch-&gt;[0] $patch-&gt;[1]\n&#34;&#41;;
180:        $smoker-&gt;ttylog&#40;&#34;Smoking branch $patch-&gt;[2]\n&#34;&#41; if $patch-&gt;[2];

lib/Test/Smoke/Reporter.pm
272:        if &#40;/^Smoking branch &#40;\S+&#41;/&#41; {

lib/Test/Smoke/App/RunSmoke.pm
103:        $smoker-&gt;ttylog&#40;&#34;Smoking patch $patch-&gt;[0] 
@{[$patch-&gt;[1]||&#39;&#39;]}\n&#34;&#41;;
104:        $smoker-&gt;ttylog&#40;&#34;Smoking branch $patch-&gt;[2]\n&#34;&#41; if $patch-&gt;[2];
#####

Now, I don&#39;t know whether the smoke run was working in lib/Test/Smoke.pm 
or lib/Test/Smoke/App/RunSmoke.pm.  But it appears that in either case 
$patch is a hashref which is populated by reading a hidden file in the 
perl-current directory: .patch.  I&#39;ve included that in the tarball but 
for visibility I&#39;ve called in &#39;dot.patch&#39;.  For the problematic 
smoke-test run its contents were:

#####
smoke-me/jkeenan/cleanup-t-io-fs 2018-11-04.20:55:50 
adf1b5d28a4fd0e20bbbb72cab062fdd520cb065 v5.26.2-85-gadf1b5d28a
#####

Splitting on the whitespace, we have:

* The name of the branch that got smoked -- but which was not the branch 
designated in smokecurrent.gitbranch.

* A datestamp which I think was the time of the *start* of the 
*previous* smoke run, i.e., the run reported in 
<span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/report/73583">http://perl5.test-smoke.org/report/73583</a></span>.

* The SHA of head of the branch which *should have been run* but which 
was not.

* The Git-id of the SHA in the preceding item.

This discrepancy is also reflected in the other files output by 
Test-Smoke in the problematic run.  For example, in 
defective-20181105/adf1b5d2/outadf1b5d28a4fd0e20bbbb72cab062fdd520cb065.out, 
we have:

#####
Smoking patch adf1b5d28a4fd0e20bbbb72cab062fdd520cb065 
v5.26.2-85-gadf1b5d28a
Smoking branch smoke-me/jkeenan/cleanup-t-io-fs
#####

The &#34;patch&#34; line reports the SHA and Git-id of the branch I wanted to 
smoke.  The &#34;branch&#34; line shows the branch actually and mistakenly smoked.

This is as far as I&#39;ve been able to diagnose this so far.  Since I want 
to resume smoke-testing blead on this machine, I&#39;ll soon be overwriting 
the contents of my &#39;git-perl&#39; and &#39;perl-current&#39; directories.  I will do 
that in 24 hours, so that if there&#39;s any information you need from those 
directories that I have not already provided in the tarball, please let 
me know ASAP.

Thank you very much.
Jim Keenan
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1818360/978340/defective-20181105.tar.gz">Download defective-20181105.tar.gz</a><br />
<span class="downloadcontenttype">application/gzip 60.8k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;05&nbsp;18:05:42&nbsp;2018</span>
    <span class="description">jkeenan [...] cpan.org -  Reference to ticket #125927 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;05&nbsp;18:05:42&nbsp;2018</span>
    <span class="description">jkeenan [...] cpan.org -  Reference to ticket #120008 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;05&nbsp;18:27:51&nbsp;2018</span>
    <span class="description">jkeenan [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Nov 05 18:02:50 2018, jkeenan@pobox.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Once again I have to report a situation where Test-Smoke did not smoke
&gt; the branch I requested.
&gt; 
&gt; I reported an instance of this problem several months ago as &#34;Problem
&gt; 2&#34;
&gt; in <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=125927">https://rt.cpan.org/Ticket/Display.html?id=125927</a></span>.  Most of my
&gt; subsequent posts in that ticket concerned &#34;Problem 1&#34;.  I haven&#39;t had
&gt; a
&gt; response to either problem, but since Problem 2 has reoccurred let&#39;s
&gt; put
&gt; all discussion of that problem in one new ticket.  My original
&gt; statement
&gt; of Problem 2 is attached.
&gt; 
&gt; Here is the new instance.
&gt; 
&gt; I manually kick off smoke-test runs of blead and other branches on a
&gt; FreeBSD-11.2-STABLE host, &#39;perlmonger.nycbug.org&#39;.  The 2 most recent
&gt; runs on that platform &#40;as of the composition of this message, and as
&gt; displayed at <span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/search">http://perl5.test-smoke.org/search</a></span> with appropriate
&gt; drop-down selections&#41; are:
&gt; 
&gt; #####
&gt; URL|Git-id|Branch|Smoke date|Status
&gt;  <span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/report/73583">http://perl5.test-smoke.org/report/73583</a></span>|v5.29.4-34-
&gt; g328d907979|blead|2018-11-05
&gt; 00:23:31+00|PASS
&gt;  <span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/report/73607">http://perl5.test-smoke.org/report/73607</a></span>|v5.26.2-85-
&gt; gadf1b5d28a|smoke-me/jkeenan/cleanup-t-io-fs|2018-11-05
&gt; 13:07:31+00|PASS
&gt; #####
&gt; 
&gt; Now, just looking at that, you might wonder about the &#34;v5.26.2&#34; in the
&gt; Git-id of run 73607.  For one thing, another run on that page lists a
&gt; run of the &#34;smoke-me/jkeenan/cleanup-t-io-fs&#34; branch but with a Git-id
&gt; beginning &#34;v5.29.4&#34;.
&gt; 
&gt; #####
&gt; URL|Git-id|Branch|Smoke date|Status
&gt;  <span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/report/73178">http://perl5.test-smoke.org/report/73178</a></span>|v5.29.4-22-
&gt; g167698623c|smoke-me/jkeenan/cleanup-t-io-fs|2018-10-29
&gt; 22:40:15+00|PASS
&gt; #####
&gt; 
&gt; Here&#39;s the problem:  What I *wanted* to test earlier today was the
&gt; &#39;maint-5.26&#39; branch, *not* the smoke-me/jkeenan/cleanup-t-io-fs
&gt; branch.
&gt; In my &#39;smokecurrent.gitbranch&#39; file the first 3 entries at the point
&gt; when I kicked off the smoke-test run were:
&gt; 
&gt; #####
&gt; maint-5.26
&gt; blead
&gt; smoke-me/jkeenan/cleanup-t-io-fs
&gt; #####
&gt; 
&gt; &#40;See tarball attached for
&gt; &#39;defective-20181105/adf1b5d2/smokecurrent.gitbranch&#39; and other files
&gt; subsequently mentioned in this report.&#41;
&gt; 
&gt; Suppose that I go into the &#39;git-perl&#39; directory of my Test-Smoke rig
&gt; and
&gt; call &#39;git status&#39;.  As recorded in
&gt; defective-20181105/adf1b5d2/git-perl.git.status.txt, I get:
&gt; 
&gt; #####
&gt; On branch maint-5.26
&gt; Your branch is up to date with &#39;origin/maint-5.26&#39;.
&gt; 
&gt; nothing to commit, working tree clean
&gt; #####
&gt; 
&gt; Everything fine there.  Now supposed I go next door to the
&gt; &#39;perl-current&#39; directory in which the run is executed.  As recorded in
&gt; defective-20181105/adf1b5d2/perl-current.git.status.txt, I get:
&gt; 
&gt; #####
&gt; $ cat perl-current.git.status.txt
&gt; On branch smoke-me/jkeenan/cleanup-t-io-fs
&gt; Your branch and &#39;origin/smoke-me/jkeenan/cleanup-t-io-fs&#39; have
&gt; diverged,
&gt; and have 323 and 3496 different commits each, respectively.
&gt;    &#40;use &#34;git pull&#34; to merge the remote branch into yours&#41;
&gt; 
&gt; Changes not staged for commit:
&gt;    &#40;use &#34;git add &lt;file&gt;...&#34; to update what will be committed&#41;
&gt;    &#40;use &#34;git checkout -- &lt;file&gt;...&#34; to discard changes in working
&gt; directory&#41;
&gt; 
&gt; modified:   patchlevel.h
&gt; 
&gt; Untracked files:
&gt;    &#40;use &#34;git add &lt;file&gt;...&#34; to include in what will be committed&#41;
&gt; 
&gt; mktest.jsn
&gt; mktest.out
&gt; mktest.rpt
&gt; patchlevel.bak
&gt; 
&gt; no changes added to commit &#40;use &#34;git add&#34; and/or &#34;git commit -a&#34;&#41;
&gt; #####
&gt; 
&gt; Big problem!  The &#39;perl-current&#39; directory was not updated to hold
&gt; &#39;maint-5.26&#39;.  Worse, it&#39;s not even holding blead any more.  For some
&gt; reason it appears to have done a checkout of a branch from more than a
&gt; week ago!
&gt; 
&gt; We can also spot problems developing in the log file.  I&#39;ve included
&gt; both the full .log file and a &#39;head&#39; of it in the tarball.  If we look
&gt; at defective-20181105/adf1b5d2/adf1b5d2.head.log, we see:
&gt; 
&gt; #####
&gt; [2018-11-05 13:07:26+0000] ==&gt; Starting synctree
&gt; [2018-11-05 13:07:26+0000] qx[/usr/local/bin/git remote update --prune
<div class="message-stanza open">&gt; 2&gt;&#38;1]
</div>&gt; [2018-11-05 13:07:28+0000] qx[/usr/local/bin/git checkout maint-5.26
&gt; [2018-11-05 13:07:28+0000]  2&gt;&#38;1]
&gt; Switched to a new branch &#39;maint-5.26&#39;
&gt;  [2018-11-05 13:07:29+0000] qx[/usr/local/bin/git reset --hard
&gt; origin/maint-5.26
&gt; [2018-11-05 13:07:29+0000]  2&gt;&#38;1]
&gt; [2018-11-05 13:07:29+0000] qx[/usr/local/bin/git clean -dfx 2&gt;&#38;1]
&gt; [2018-11-05 13:07:29+0000] qx[/usr/local/bin/git fetch origin 2&gt;&#38;1]
&gt; [2018-11-05 13:07:30+0000] qx[/usr/local/bin/git checkout maint-5.26
&gt; [2018-11-05 13:07:30+0000]  2&gt;&#38;1]
&gt; #####
&gt; 
&gt; So far so good.
&gt; 
&gt; #####
&gt; error: Your local changes to the following files would be overwritten
&gt; by
&gt; checkout:
&gt;        patchlevel.h
&gt; Please commit your changes or stash them before you switch branches.
&gt; Aborting
&gt; #####
&gt; 
&gt; I get that on every smoke test run.
&gt; 
&gt; #####
&gt; [2018-11-05 13:07:30+0000] qx[/usr/local/bin/git reset --hard
&gt; origin/maint-5.26
&gt; [2018-11-05 13:07:30+0000]  2&gt;&#38;1]
&gt; [2018-11-05 13:07:31+0000] qx[/usr/local/bin/perl5
&gt; Porting/make_dot_patch.pl &gt; .patch]
&gt; [2018-11-05 13:07:31+0000] /home/jkeenan/p5smoke/perl-current is now
&gt; up
&gt; to patchlevel adf1b5d28a4fd0e20bbbb72cab062fdd520cb065
&gt; #####
&gt; 
&gt; Everything *looks* good here. Commit adf1b5d28 was the then-current
&gt; head
&gt; of the maint-5.26 branch:
&gt; 
&gt; #####
&gt; commit adf1b5d28a4fd0e20bbbb72cab062fdd520cb065 &#40;origin/maint-5.26&#41;
&gt; Author:     Steve Hay &lt;steve.m.hay@googlemail.com&gt;
&gt; AuthorDate: Sun Nov 4 20:55:50 2018 +0000
&gt; Commit:     Steve Hay &lt;steve.m.hay@googlemail.com&gt;
&gt; CommitDate: Sun Nov 4 20:55:50 2018 +0000
&gt; 
&gt; Import perl5280delta.pod
&gt; #####
&gt; 
&gt; Continuing:
&gt; 
&gt; #####
&gt; [2018-11-05 13:07:31+0000] ==&gt; Starting runsmoke
&gt;  [2018-11-05 13:07:31+0000] [./tssmokeperl.pl]
&gt; chdir&#40;/home/jkeenan/p5smoke/perl-current&#41;
&gt; [2018-11-05 13:07:31+0000] Setup alarm: Mon Nov  5 19:07:31 2018
&gt;  [2018-11-05 13:07:31+0000] qx[/usr/local/bin/perl5 -e &#34;require
&gt;  q[/home/jkeenan/p5smoke/perl-current/cpan/Test-
&gt; Harness/lib/Test/Harness.pm];print
&gt; Test::Harness-&gt;VERSION&#34; 2&gt;&#38;1]
&gt; [2018-11-05 13:07:31+0000] Found: Test::Harness version 3.38.
&gt;  [2018-11-05 13:07:31+0000] Reading build configurations from
&gt; /home/jkeenan/p5smoke/perlcurrent.cfg
&gt; [2018-11-05 13:07:31+0000] Reading &#39;Policy.sh&#39; from default content
&gt; &#40;v=1&#41;
&gt; [2018-11-05 13:07:31+0000] Running test suite only with &#39;harness&#39;
&gt; [2018-11-05 13:07:31+0000] make distclean ...
&gt;  [2018-11-05 13:07:31+0000] Smoking patch
&gt; adf1b5d28a4fd0e20bbbb72cab062fdd520cb065 v5.26.2-85-gadf1b5d28a
&gt; #####
&gt; 
&gt; Again, everything *looks* good.  But on the very next line we see:
&gt; 
&gt; #####
&gt; [2018-11-05 13:07:31+0000] Smoking branch smoke-me/jkeenan/cleanup-t-
&gt; io-fs
&gt; #####
&gt; 
&gt; Where did that come from?
&gt; 
&gt; I grepped in the source code for those log messages and found this:
&gt; 
&gt; #####
&gt; $ ack &#39;Smoking &#40;branch|patch&#41;&#39; lib/Test
&gt; lib/Test/Smoke.pm
&gt; 179:        $smoker-&gt;ttylog&#40;&#34;Smoking patch $patch-&gt;[0] $patch-
<div class="message-stanza open">&gt; &gt;[1]\n&#34;&#41;;
</div>&gt; 180:        $smoker-&gt;ttylog&#40;&#34;Smoking branch $patch-&gt;[2]\n&#34;&#41; if $patch-
<div class="message-stanza open">&gt; &gt;[2];
</div>&gt; 
&gt; lib/Test/Smoke/Reporter.pm
&gt; 272:        if &#40;/^Smoking branch &#40;\S+&#41;/&#41; {
&gt; 
&gt; lib/Test/Smoke/App/RunSmoke.pm
&gt;  103:        $smoker-&gt;ttylog&#40;&#34;Smoking patch $patch-&gt;[0]
&gt; @{[$patch-&gt;[1]||&#39;&#39;]}\n&#34;&#41;;
&gt; 104:        $smoker-&gt;ttylog&#40;&#34;Smoking branch $patch-&gt;[2]\n&#34;&#41; if $patch-
<div class="message-stanza open">&gt; &gt;[2];
</div>&gt; #####
&gt; 
&gt; Now, I don&#39;t know whether the smoke run was working in
&gt; lib/Test/Smoke.pm
&gt; or lib/Test/Smoke/App/RunSmoke.pm.  But it appears that in either case
&gt; $patch is a hashref which is populated by reading a hidden file in the
&gt; perl-current directory: .patch.  I&#39;ve included that in the tarball but
&gt; for visibility I&#39;ve called in &#39;dot.patch&#39;.  For the problematic
&gt; smoke-test run its contents were:
&gt; 
&gt; #####
&gt; smoke-me/jkeenan/cleanup-t-io-fs 2018-11-04.20:55:50
&gt; adf1b5d28a4fd0e20bbbb72cab062fdd520cb065 v5.26.2-85-gadf1b5d28a
&gt; #####
&gt; 
&gt; Splitting on the whitespace, we have:
&gt; 
&gt; * The name of the branch that got smoked -- but which was not the
&gt; branch
&gt; designated in smokecurrent.gitbranch.
&gt; 
&gt; * A datestamp which I think was the time of the *start* of the
&gt; *previous* smoke run, i.e., the run reported in
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/report/73583">http://perl5.test-smoke.org/report/73583</a></span>.
&gt; 
&gt; * The SHA of head of the branch which *should have been run* but which
&gt; was not.
&gt; 
&gt; * The Git-id of the SHA in the preceding item.
&gt; 
&gt; This discrepancy is also reflected in the other files output by
&gt; Test-Smoke in the problematic run.  For example, in
&gt; defective-
&gt; 20181105/adf1b5d2/outadf1b5d28a4fd0e20bbbb72cab062fdd520cb065.out,
&gt; we have:
&gt; 
&gt; #####
&gt; Smoking patch adf1b5d28a4fd0e20bbbb72cab062fdd520cb065
&gt; v5.26.2-85-gadf1b5d28a
&gt; Smoking branch smoke-me/jkeenan/cleanup-t-io-fs
&gt; #####
&gt; 
&gt; The &#34;patch&#34; line reports the SHA and Git-id of the branch I wanted to
&gt; smoke.  The &#34;branch&#34; line shows the branch actually and mistakenly
&gt; smoked.
&gt; 
&gt; This is as far as I&#39;ve been able to diagnose this so far.  Since I
&gt; want
&gt; to resume smoke-testing blead on this machine, I&#39;ll soon be
&gt; overwriting
&gt; the contents of my &#39;git-perl&#39; and &#39;perl-current&#39; directories.  I will
&gt; do
&gt; that in 24 hours, so that if there&#39;s any information you need from
&gt; those
&gt; directories that I have not already provided in the tarball, please
&gt; let
&gt; me know ASAP.
&gt; 
&gt; Thank you very much.
&gt; Jim Keenan
</div>
I have just now been able to reproduce this problem on a different host and on a different operating system.

On my linode my last previous smoke test run was:

#####
URL|Git-id|Branch|Smoke date|Status
<span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/report/72937">http://perl5.test-smoke.org/report/72937</a></span>|v5.29.4-11-g36b19dd|blead|2018-10-23 17:03:16+00|FAIL
#####

Just now I edited my smokecurrent.gitbranch file to place &#39;maint-5.26&#39; in the first row.

#####
$ head -3 smokecurrent.gitbranch 
maint-5.26
blead
smoke-me/jkeenan/133586-file-glob-glob
#####

I then kicked off a new smoke test run.  It has not completed, but from examining the log file I can already see that the branch actually being smoked &#40;incorrectly&#41; is the 3rd branch listed in smokecurrent.gitbranch -- not the first.

#####
[li796-253:perl-current] 527 $ git status | head -3
On branch smoke-me/jkeenan/133586-file-glob-glob
Your branch and &#39;origin/smoke-me/jkeenan/133586-file-glob-glob&#39; have diverged,
and have 323 and 3406 different commits each, respectively.
#####

#####
[li796-253:perl-current] 528 $ cat .patch
smoke-me/jkeenan/133586-file-glob-glob 2018-11-04.20:55:50 adf1b5d28a4fd0e20bbbb72cab062fdd520cb065 v5.26.2-85-gadf1b5d
#####

Thank you very much.
Jim Keenan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;05&nbsp;18:27:52&nbsp;2018</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;05&nbsp;19:39:22&nbsp;2018</span>
    <span class="description">jkeenan [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Nov 05 18:27:51 2018, JKEENAN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon Nov 05 18:02:50 2018, jkeenan@pobox.com wrote:
<div class="message-stanza open">&gt; &gt; Once again I have to report a situation where Test-Smoke did not
&gt; &gt; smoke
&gt; &gt; the branch I requested.
&gt; &gt;
&gt; &gt; I reported an instance of this problem several months ago as &#34;Problem
&gt; &gt; 2&#34;
&gt; &gt; in <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=125927">https://rt.cpan.org/Ticket/Display.html?id=125927</a></span>.  Most of my
&gt; &gt; subsequent posts in that ticket concerned &#34;Problem 1&#34;.  I haven&#39;t had
&gt; &gt; a
&gt; &gt; response to either problem, but since Problem 2 has reoccurred let&#39;s
&gt; &gt; put
&gt; &gt; all discussion of that problem in one new ticket.  My original
&gt; &gt; statement
&gt; &gt; of Problem 2 is attached.
&gt; &gt;
&gt; &gt; Here is the new instance.
&gt; &gt;
&gt; &gt; I manually kick off smoke-test runs of blead and other branches on a
&gt; &gt; FreeBSD-11.2-STABLE host, &#39;perlmonger.nycbug.org&#39;.  The 2 most recent
&gt; &gt; runs on that platform &#40;as of the composition of this message, and as
&gt; &gt; displayed at <span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/search">http://perl5.test-smoke.org/search</a></span> with appropriate
&gt; &gt; drop-down selections&#41; are:
&gt; &gt;
&gt; &gt; #####
&gt; &gt; URL|Git-id|Branch|Smoke date|Status
&gt; &gt;  <span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/report/73583">http://perl5.test-smoke.org/report/73583</a></span>|v5.29.4-34-
&gt; &gt; g328d907979|blead|2018-11-05
&gt; &gt; 00:23:31+00|PASS
&gt; &gt;  <span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/report/73607">http://perl5.test-smoke.org/report/73607</a></span>|v5.26.2-85-
&gt; &gt; gadf1b5d28a|smoke-me/jkeenan/cleanup-t-io-fs|2018-11-05
&gt; &gt; 13:07:31+00|PASS
&gt; &gt; #####
&gt; &gt;
&gt; &gt; Now, just looking at that, you might wonder about the &#34;v5.26.2&#34; in
&gt; &gt; the
&gt; &gt; Git-id of run 73607.  For one thing, another run on that page lists a
&gt; &gt; run of the &#34;smoke-me/jkeenan/cleanup-t-io-fs&#34; branch but with a Git-
&gt; &gt; id
&gt; &gt; beginning &#34;v5.29.4&#34;.
&gt; &gt;
&gt; &gt; #####
&gt; &gt; URL|Git-id|Branch|Smoke date|Status
&gt; &gt;  <span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/report/73178">http://perl5.test-smoke.org/report/73178</a></span>|v5.29.4-22-
&gt; &gt; g167698623c|smoke-me/jkeenan/cleanup-t-io-fs|2018-10-29
&gt; &gt; 22:40:15+00|PASS
&gt; &gt; #####
&gt; &gt;
&gt; &gt; Here&#39;s the problem:  What I *wanted* to test earlier today was the
&gt; &gt; &#39;maint-5.26&#39; branch, *not* the smoke-me/jkeenan/cleanup-t-io-fs
&gt; &gt; branch.
&gt; &gt; In my &#39;smokecurrent.gitbranch&#39; file the first 3 entries at the point
&gt; &gt; when I kicked off the smoke-test run were:
&gt; &gt;
&gt; &gt; #####
&gt; &gt; maint-5.26
&gt; &gt; blead
&gt; &gt; smoke-me/jkeenan/cleanup-t-io-fs
&gt; &gt; #####
&gt; &gt;
&gt; &gt; &#40;See tarball attached for
&gt; &gt; &#39;defective-20181105/adf1b5d2/smokecurrent.gitbranch&#39; and other files
&gt; &gt; subsequently mentioned in this report.&#41;
&gt; &gt;
&gt; &gt; Suppose that I go into the &#39;git-perl&#39; directory of my Test-Smoke rig
&gt; &gt; and
&gt; &gt; call &#39;git status&#39;.  As recorded in
&gt; &gt; defective-20181105/adf1b5d2/git-perl.git.status.txt, I get:
&gt; &gt;
&gt; &gt; #####
&gt; &gt; On branch maint-5.26
&gt; &gt; Your branch is up to date with &#39;origin/maint-5.26&#39;.
&gt; &gt;
&gt; &gt; nothing to commit, working tree clean
&gt; &gt; #####
&gt; &gt;
&gt; &gt; Everything fine there.  Now supposed I go next door to the
&gt; &gt; &#39;perl-current&#39; directory in which the run is executed.  As recorded
&gt; &gt; in
&gt; &gt; defective-20181105/adf1b5d2/perl-current.git.status.txt, I get:
&gt; &gt;
&gt; &gt; #####
&gt; &gt; $ cat perl-current.git.status.txt
&gt; &gt; On branch smoke-me/jkeenan/cleanup-t-io-fs
&gt; &gt; Your branch and &#39;origin/smoke-me/jkeenan/cleanup-t-io-fs&#39; have
&gt; &gt; diverged,
&gt; &gt; and have 323 and 3496 different commits each, respectively.
&gt; &gt;    &#40;use &#34;git pull&#34; to merge the remote branch into yours&#41;
&gt; &gt;
&gt; &gt; Changes not staged for commit:
&gt; &gt;    &#40;use &#34;git add &lt;file&gt;...&#34; to update what will be committed&#41;
&gt; &gt;    &#40;use &#34;git checkout -- &lt;file&gt;...&#34; to discard changes in working
&gt; &gt; directory&#41;
&gt; &gt;
&gt; &gt; modified:   patchlevel.h
&gt; &gt;
&gt; &gt; Untracked files:
&gt; &gt;    &#40;use &#34;git add &lt;file&gt;...&#34; to include in what will be committed&#41;
&gt; &gt;
&gt; &gt; mktest.jsn
&gt; &gt; mktest.out
&gt; &gt; mktest.rpt
&gt; &gt; patchlevel.bak
&gt; &gt;
&gt; &gt; no changes added to commit &#40;use &#34;git add&#34; and/or &#34;git commit -a&#34;&#41;
&gt; &gt; #####
&gt; &gt;
&gt; &gt; Big problem!  The &#39;perl-current&#39; directory was not updated to hold
&gt; &gt; &#39;maint-5.26&#39;.  Worse, it&#39;s not even holding blead any more.  For some
&gt; &gt; reason it appears to have done a checkout of a branch from more than
&gt; &gt; a
&gt; &gt; week ago!
&gt; &gt;
&gt; &gt; We can also spot problems developing in the log file.  I&#39;ve included
&gt; &gt; both the full .log file and a &#39;head&#39; of it in the tarball.  If we
&gt; &gt; look
&gt; &gt; at defective-20181105/adf1b5d2/adf1b5d2.head.log, we see:
&gt; &gt;
&gt; &gt; #####
&gt; &gt; [2018-11-05 13:07:26+0000] ==&gt; Starting synctree
&gt; &gt; [2018-11-05 13:07:26+0000] qx[/usr/local/bin/git remote update
&gt; &gt; --prune
<div class="message-stanza open">&gt; &gt; 2&gt; &#38;1]
</div>&gt; &gt; [2018-11-05 13:07:28+0000] qx[/usr/local/bin/git checkout maint-5.26
&gt; &gt; [2018-11-05 13:07:28+0000]  2&gt;&#38;1]
&gt; &gt; Switched to a new branch &#39;maint-5.26&#39;
&gt; &gt;  [2018-11-05 13:07:29+0000] qx[/usr/local/bin/git reset --hard
&gt; &gt; origin/maint-5.26
&gt; &gt; [2018-11-05 13:07:29+0000]  2&gt;&#38;1]
&gt; &gt; [2018-11-05 13:07:29+0000] qx[/usr/local/bin/git clean -dfx 2&gt;&#38;1]
&gt; &gt; [2018-11-05 13:07:29+0000] qx[/usr/local/bin/git fetch origin 2&gt;&#38;1]
&gt; &gt; [2018-11-05 13:07:30+0000] qx[/usr/local/bin/git checkout maint-5.26
&gt; &gt; [2018-11-05 13:07:30+0000]  2&gt;&#38;1]
&gt; &gt; #####
&gt; &gt;
&gt; &gt; So far so good.
&gt; &gt;
&gt; &gt; #####
&gt; &gt; error: Your local changes to the following files would be overwritten
&gt; &gt; by
&gt; &gt; checkout:
&gt; &gt;        patchlevel.h
&gt; &gt; Please commit your changes or stash them before you switch branches.
&gt; &gt; Aborting
&gt; &gt; #####
&gt; &gt;
&gt; &gt; I get that on every smoke test run.
&gt; &gt;
&gt; &gt; #####
&gt; &gt; [2018-11-05 13:07:30+0000] qx[/usr/local/bin/git reset --hard
&gt; &gt; origin/maint-5.26
&gt; &gt; [2018-11-05 13:07:30+0000]  2&gt;&#38;1]
&gt; &gt; [2018-11-05 13:07:31+0000] qx[/usr/local/bin/perl5
&gt; &gt; Porting/make_dot_patch.pl &gt; .patch]
&gt; &gt; [2018-11-05 13:07:31+0000] /home/jkeenan/p5smoke/perl-current is now
&gt; &gt; up
&gt; &gt; to patchlevel adf1b5d28a4fd0e20bbbb72cab062fdd520cb065
&gt; &gt; #####
&gt; &gt;
&gt; &gt; Everything *looks* good here. Commit adf1b5d28 was the then-current
&gt; &gt; head
&gt; &gt; of the maint-5.26 branch:
&gt; &gt;
&gt; &gt; #####
&gt; &gt; commit adf1b5d28a4fd0e20bbbb72cab062fdd520cb065 &#40;origin/maint-5.26&#41;
&gt; &gt; Author:     Steve Hay &lt;steve.m.hay@googlemail.com&gt;
&gt; &gt; AuthorDate: Sun Nov 4 20:55:50 2018 +0000
&gt; &gt; Commit:     Steve Hay &lt;steve.m.hay@googlemail.com&gt;
&gt; &gt; CommitDate: Sun Nov 4 20:55:50 2018 +0000
&gt; &gt;
&gt; &gt; Import perl5280delta.pod
&gt; &gt; #####
&gt; &gt;
&gt; &gt; Continuing:
&gt; &gt;
&gt; &gt; #####
&gt; &gt; [2018-11-05 13:07:31+0000] ==&gt; Starting runsmoke
&gt; &gt;  [2018-11-05 13:07:31+0000] [./tssmokeperl.pl]
&gt; &gt; chdir&#40;/home/jkeenan/p5smoke/perl-current&#41;
&gt; &gt; [2018-11-05 13:07:31+0000] Setup alarm: Mon Nov  5 19:07:31 2018
&gt; &gt;  [2018-11-05 13:07:31+0000] qx[/usr/local/bin/perl5 -e &#34;require
&gt; &gt;  q[/home/jkeenan/p5smoke/perl-current/cpan/Test-
&gt; &gt; Harness/lib/Test/Harness.pm];print
&gt; &gt; Test::Harness-&gt;VERSION&#34; 2&gt;&#38;1]
&gt; &gt; [2018-11-05 13:07:31+0000] Found: Test::Harness version 3.38.
&gt; &gt;  [2018-11-05 13:07:31+0000] Reading build configurations from
&gt; &gt; /home/jkeenan/p5smoke/perlcurrent.cfg
&gt; &gt; [2018-11-05 13:07:31+0000] Reading &#39;Policy.sh&#39; from default content
&gt; &gt; &#40;v=1&#41;
&gt; &gt; [2018-11-05 13:07:31+0000] Running test suite only with &#39;harness&#39;
&gt; &gt; [2018-11-05 13:07:31+0000] make distclean ...
&gt; &gt;  [2018-11-05 13:07:31+0000] Smoking patch
&gt; &gt; adf1b5d28a4fd0e20bbbb72cab062fdd520cb065 v5.26.2-85-gadf1b5d28a
&gt; &gt; #####
&gt; &gt;
&gt; &gt; Again, everything *looks* good.  But on the very next line we see:
&gt; &gt;
&gt; &gt; #####
&gt; &gt; [2018-11-05 13:07:31+0000] Smoking branch smoke-me/jkeenan/cleanup-t-
&gt; &gt; io-fs
&gt; &gt; #####
&gt; &gt;
&gt; &gt; Where did that come from?
&gt; &gt;
&gt; &gt; I grepped in the source code for those log messages and found this:
&gt; &gt;
&gt; &gt; #####
&gt; &gt; $ ack &#39;Smoking &#40;branch|patch&#41;&#39; lib/Test
&gt; &gt; lib/Test/Smoke.pm
&gt; &gt; 179:        $smoker-&gt;ttylog&#40;&#34;Smoking patch $patch-&gt;[0] $patch-
<div class="message-stanza open">&gt; &gt; &gt; [1]\n&#34;&#41;;
</div>&gt; &gt; 180:        $smoker-&gt;ttylog&#40;&#34;Smoking branch $patch-&gt;[2]\n&#34;&#41; if
&gt; &gt; $patch-
<div class="message-stanza open">&gt; &gt; &gt; [2];
</div>&gt; &gt;
&gt; &gt; lib/Test/Smoke/Reporter.pm
&gt; &gt; 272:        if &#40;/^Smoking branch &#40;\S+&#41;/&#41; {
&gt; &gt;
&gt; &gt; lib/Test/Smoke/App/RunSmoke.pm
&gt; &gt;  103:        $smoker-&gt;ttylog&#40;&#34;Smoking patch $patch-&gt;[0]
&gt; &gt; @{[$patch-&gt;[1]||&#39;&#39;]}\n&#34;&#41;;
&gt; &gt; 104:        $smoker-&gt;ttylog&#40;&#34;Smoking branch $patch-&gt;[2]\n&#34;&#41; if
&gt; &gt; $patch-
<div class="message-stanza open">&gt; &gt; &gt; [2];
</div>&gt; &gt; #####
&gt; &gt;
&gt; &gt; Now, I don&#39;t know whether the smoke run was working in
&gt; &gt; lib/Test/Smoke.pm
&gt; &gt; or lib/Test/Smoke/App/RunSmoke.pm.  But it appears that in either
&gt; &gt; case
&gt; &gt; $patch is a hashref which is populated by reading a hidden file in
&gt; &gt; the
&gt; &gt; perl-current directory: .patch.  I&#39;ve included that in the tarball
&gt; &gt; but
&gt; &gt; for visibility I&#39;ve called in &#39;dot.patch&#39;.  For the problematic
&gt; &gt; smoke-test run its contents were:
&gt; &gt;
&gt; &gt; #####
&gt; &gt; smoke-me/jkeenan/cleanup-t-io-fs 2018-11-04.20:55:50
&gt; &gt; adf1b5d28a4fd0e20bbbb72cab062fdd520cb065 v5.26.2-85-gadf1b5d28a
&gt; &gt; #####
&gt; &gt;
&gt; &gt; Splitting on the whitespace, we have:
&gt; &gt;
&gt; &gt; * The name of the branch that got smoked -- but which was not the
&gt; &gt; branch
&gt; &gt; designated in smokecurrent.gitbranch.
&gt; &gt;
&gt; &gt; * A datestamp which I think was the time of the *start* of the
&gt; &gt; *previous* smoke run, i.e., the run reported in
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/report/73583">http://perl5.test-smoke.org/report/73583</a></span>.
&gt; &gt;
&gt; &gt; * The SHA of head of the branch which *should have been run* but
&gt; &gt; which
&gt; &gt; was not.
&gt; &gt;
&gt; &gt; * The Git-id of the SHA in the preceding item.
&gt; &gt;
&gt; &gt; This discrepancy is also reflected in the other files output by
&gt; &gt; Test-Smoke in the problematic run.  For example, in
&gt; &gt; defective-
&gt; &gt; 20181105/adf1b5d2/outadf1b5d28a4fd0e20bbbb72cab062fdd520cb065.out,
&gt; &gt; we have:
&gt; &gt;
&gt; &gt; #####
&gt; &gt; Smoking patch adf1b5d28a4fd0e20bbbb72cab062fdd520cb065
&gt; &gt; v5.26.2-85-gadf1b5d28a
&gt; &gt; Smoking branch smoke-me/jkeenan/cleanup-t-io-fs
&gt; &gt; #####
&gt; &gt;
&gt; &gt; The &#34;patch&#34; line reports the SHA and Git-id of the branch I wanted to
&gt; &gt; smoke.  The &#34;branch&#34; line shows the branch actually and mistakenly
&gt; &gt; smoked.
&gt; &gt;
&gt; &gt; This is as far as I&#39;ve been able to diagnose this so far.  Since I
&gt; &gt; want
&gt; &gt; to resume smoke-testing blead on this machine, I&#39;ll soon be
&gt; &gt; overwriting
&gt; &gt; the contents of my &#39;git-perl&#39; and &#39;perl-current&#39; directories.  I will
&gt; &gt; do
&gt; &gt; that in 24 hours, so that if there&#39;s any information you need from
&gt; &gt; those
&gt; &gt; directories that I have not already provided in the tarball, please
&gt; &gt; let
&gt; &gt; me know ASAP.
&gt; &gt;
&gt; &gt; Thank you very much.
&gt; &gt; Jim Keenan
</div>&gt; 
&gt; I have just now been able to reproduce this problem on a different
&gt; host and on a different operating system.
&gt; 
&gt; On my linode my last previous smoke test run was:
&gt; 
&gt; #####
&gt; URL|Git-id|Branch|Smoke date|Status
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/report/72937">http://perl5.test-smoke.org/report/72937</a></span>|v5.29.4-11-
&gt; g36b19dd|blead|2018-10-23 17:03:16+00|FAIL
&gt; #####
&gt; 
&gt; Just now I edited my smokecurrent.gitbranch file to place &#39;maint-5.26&#39;
&gt; in the first row.
&gt; 
&gt; #####
&gt; $ head -3 smokecurrent.gitbranch
&gt; maint-5.26
&gt; blead
&gt; smoke-me/jkeenan/133586-file-glob-glob
&gt; #####
&gt; 
&gt; I then kicked off a new smoke test run.  It has not completed, but
&gt; from examining the log file I can already see that the branch actually
&gt; being smoked &#40;incorrectly&#41; is the 3rd branch listed in
&gt; smokecurrent.gitbranch -- not the first.
&gt; 
&gt; #####
&gt; [li796-253:perl-current] 527 $ git status | head -3
&gt; On branch smoke-me/jkeenan/133586-file-glob-glob
&gt; Your branch and &#39;origin/smoke-me/jkeenan/133586-file-glob-glob&#39; have
&gt; diverged,
&gt; and have 323 and 3406 different commits each, respectively.
&gt; #####
&gt; 
&gt; #####
&gt; [li796-253:perl-current] 528 $ cat .patch
&gt; smoke-me/jkeenan/133586-file-glob-glob 2018-11-04.20:55:50
&gt; adf1b5d28a4fd0e20bbbb72cab062fdd520cb065 v5.26.2-85-gadf1b5d
&gt; #####
&gt; 
&gt; Thank you very much.
&gt; Jim Keenan
</div>
The latest run of an erroneously tested branch:
<span class="clickylink"><a target="new" rel="nofollow" href="http://perl5.test-smoke.org/report/73636">http://perl5.test-smoke.org/report/73636</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;09&nbsp;07:25:46&nbsp;2018</span>
    <span class="description">abeltje [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Jim,

Sorry for the late reaction, I&#39;m kept quite busy by the day-time-job :&#40;

I&#39;ve looked at your log and see what&#39;s going on, but I havent been able to reproduce that.
The only thing I can think of is some setting in your .gitconfig that I do not have, but we should be inert to those in the smoke process.

It is by design that we update `patchlevel.h` before we start the smoke, so we must deal with the concequences of that.

To make sure we start updating the working-directory &#40;perl-current&#41; on a clean state, I&#39;ll add anotther `git reset --hard HEAD` as a first command.

Another thing I noticed is that you have multiple branches in your .gitbranch-file. You should realise that Test::Smoke::Syncer::Git only ever reads the 1st line of that file.

I&#39;ll try and get a Beta out this weekend.

Thanks for reporting your problem

Good luck,
-- Abe.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;09&nbsp;08:56:44&nbsp;2018</span>
    <span class="description">jkeenan [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Nov 09 07:25:46 2018, ABELTJE wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi Jim,
&gt; 
&gt; Sorry for the late reaction, I&#39;m kept quite busy by the day-time-job
&gt; :&#40;
&gt; 
&gt; I&#39;ve looked at your log and see what&#39;s going on, but I havent been
&gt; able to reproduce that.
&gt; The only thing I can think of is some setting in your .gitconfig that
&gt; I do not have, but we should be inert to those in the smoke process.
&gt; 
&gt; It is by design that we update `patchlevel.h` before we start the
&gt; smoke, so we must deal with the concequences of that.
&gt; 
&gt; To make sure we start updating the working-directory &#40;perl-current&#41; on
&gt; a clean state, I&#39;ll add anotther `git reset --hard HEAD` as a first
&gt; command.
&gt; 
</div>
Thanks, I look forward to that.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Another thing I noticed is that you have multiple branches in your
&gt; .gitbranch-file. You should realise that Test::Smoke::Syncer::Git only
&gt; ever reads the 1st line of that file.
&gt; 
</div>
Yes, but this enables me to keep a crude log of which branches I&#39;ve smoked.  &#40;I kick off my smokes manually rather than by cron.&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ll try and get a Beta out this weekend.
&gt; 
&gt; Thanks for reporting your problem
&gt; 
&gt; Good luck,
&gt; -- Abe.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;14&nbsp;20:49:55&nbsp;2018</span>
    <span class="description">jkeenan [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Nov 09 07:25:46 2018, ABELTJE wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi Jim,
&gt; 
&gt; Sorry for the late reaction, I&#39;m kept quite busy by the day-time-job
&gt; :&#40;
&gt; 
&gt; I&#39;ve looked at your log and see what&#39;s going on, but I havent been
&gt; able to reproduce that.
&gt; The only thing I can think of is some setting in your .gitconfig that
&gt; I do not have, but we should be inert to those in the smoke process.
&gt; 
&gt; It is by design that we update `patchlevel.h` before we start the
&gt; smoke, so we must deal with the concequences of that.
&gt; 
&gt; To make sure we start updating the working-directory &#40;perl-current&#41; on
&gt; a clean state, I&#39;ll add anotther `git reset --hard HEAD` as a first
&gt; command.
&gt; 
&gt; Another thing I noticed is that you have multiple branches in your
&gt; .gitbranch-file. You should realise that Test::Smoke::Syncer::Git only
&gt; ever reads the 1st line of that file.
&gt; 
&gt; I&#39;ll try and get a Beta out this weekend.
&gt; 
&gt; Thanks for reporting your problem
&gt; 
&gt; Good luck,
&gt; -- Abe.
</div>
Today I spent time evaluating Test-Smoke-1.72_06.  As reported in other RT tickets &#40;e.g., <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Attachment/1819494/978982/smoke-tests-with-1.72_06.csv&#41;">https://rt.cpan.org/Ticket/Attachment/1819494/978982/smoke-tests-with-1.72_06.csv&#41;</a></span>, I conducted a series of smoke-test runs for different branches or commits on FreeBSD-11.  Between these runs the only change I made to my configuration was to move the branch in question to the top line of &#39;smokecurrent.gitbranch&#39;.   AFAICT in each instance the branch that I designated for smoking was the branch that actually got smoked.

So I think this ticket will be closable once a Test-Smoke-1.73 holding your revisions is made to CPAN.

&#40;Of course, since we&#39;ve seen this problem before, this may not be the last we see of this. :-&#40; &#41;.

Thank you very much.
Jim Keenan
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
