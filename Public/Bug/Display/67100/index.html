<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #67100 for CGI: charset applied to every content-type</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #67100 for CGI: charset applied to every content-type</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/CGI/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/CGI/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/CGI/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/CGI/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/leejo/CGI.pm/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/CGI">CGI CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">67100</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/CGI/Active/">CGI</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">MARKSTOS [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
cpan [...] jibsheet.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
trs [...] bestpractical.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-230860-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
3.51</li>
<li>
3.52</li>
<li>
3.55</li>
</ul>
    </td>
  </tr>
  <tr id="CF-230861-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;30&nbsp;18:28:17&nbsp;2011</span>
    <span class="description">cpan [...] jibsheet.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> trs [...] bestpractical.com</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> charset applied to every content-type</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Successfully installed CGI.pm-3.50

$  perl -MCGI -le &#39;my $q = CGI-&gt;new; print $q-&gt;header&#40;&#34;image/gif&#34;&#41;;&#39;
Content-Type: image/gif


Successfully installed CGI.pm-3.52 &#40;upgraded from 3.50&#41;

$  perl -MCGI -le &#39;my $q = CGI-&gt;new; print $q-&gt;header&#40;&#34;image/gif&#34;&#41;;&#39;
Content-Type: image/gif; charset=ISO-8859-1


falcone@transom:~$ perl -v
This is perl 5, version 12, subversion 3 &#40;v5.12.3&#41; built for darwin-2level


serving the ISO-8859-1 on images seems.... wrong.
This actually fails for us on some application/javascript which wasn&#39;t forcing a charset, and I&#39;ll 
fix that, but I&#39;m not sure why CGI started adding that on between 3.50 and 3.51
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;31&nbsp;09:07:20&nbsp;2011</span>
    <span class="description">mark [...] summersault.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #67100] charset applied to every content-type</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 31 Mar 2011 09:07:11 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CGI [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Stosberg &lt;mark [...] summersault.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
Kevin,

Thanks for the report. I agree it looks like a mistake to set a charset
for a non &#34;text/*&#34; type.

   Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;31&nbsp;09:07:21&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;04&nbsp;16:50:41&nbsp;2011</span>
    <span class="description">cpan [...] jibsheet.com -  Broken in 3.55 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Take odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;15&nbsp;22:38:13&nbsp;2012</span>
    <span class="description">MARKSTOS [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;15&nbsp;22:38:38&nbsp;2012</span>
    <span class="description">MARKSTOS [...] cpan.org -  Reference to ticket #57945 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;15&nbsp;22:41:42&nbsp;2012</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This actually fails for us on some application/javascript which wasn&#39;t
&gt; forcing a charset, and I&#39;ll
&gt; fix that, but I&#39;m not sure why CGI started adding that on between 3.50
&gt; and 3.51
</div>
The reason for the change was documented in &#34;Changes&#34;, which referenced 
the related RT ticket, which in turn referenced HTTP RFCs to justify the 
change.  Here&#39;s the entry from &#34;Changes&#34;

  [BUG FIXES]
  - Setting charset&#40;&#41; now works for all content types, not just 
&#34;text/*&#34;.
    &#40;RT#57945, Thanks to Yanick and Gerv.&#41;

Unless there are other RFC references which counter what we found 
through the previous ticket, the current behavior will stay. 

For now I&#39;m marking this change request as &#34;rejected&#34;, but feel free to 
re-open if you find RFC support for reverting the behavior. 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;15&nbsp;22:41:43&nbsp;2012</span>
    <span class="description">MARKSTOS [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;16&nbsp;12:36:04&nbsp;2012</span>
    <span class="description">trs [...] bestpractical.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #67100] charset applied to every content-type</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 16 Aug 2012 09:36:02 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CGI [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Thomas Sibley &lt;trs [...] bestpractical.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 08/15/2012 07:41 PM, MARKSTOS via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=67100">https://rt.cpan.org/Ticket/Display.html?id=67100</a></span> &gt;
&gt; 
<div class="message-stanza open">&gt;&gt; This actually fails for us on some application/javascript which
&gt;&gt; wasn&#39;t forcing a charset, and I&#39;ll fix that, but I&#39;m not sure why
&gt;&gt; CGI started adding that on between 3.50 and 3.51
</div>&gt; 
&gt; The reason for the change was documented in &#34;Changes&#34;, which
&gt; referenced the related RT ticket, which in turn referenced HTTP RFCs
&gt; to justify the change.  Here&#39;s the entry from &#34;Changes&#34;
&gt; 
&gt; [BUG FIXES] - Setting charset&#40;&#41; now works for all content types, not
&gt; just &#34;text/*&#34;. &#40;RT#57945, Thanks to Yanick and Gerv.&#41;
</div>
I think there&#39;s some confusion here.  The bug fix and ticket you mention
above is about *allowing* a charset to be sent on non-text/ types.

This bug is that CGI.pm is sending a default charset of ISO-8859-1 on
*any* content-type even when *no charset* is set by the code.

It seems, from first glance, that the change you quote above to always
respect the charset has caused the side effect that the default textual
charset is always sent, regardless of content-type.

By example:

tom@whaam ~ $ perl -MV=CGI
CGI
        /opt/perlbrew/perls/perl-5.14.1/lib/5.14.1/CGI.pm: 3.50
tom@whaam ~ $ perl -MCGI -le &#39;my $q = CGI-&gt;new; print $q-&gt;header&#40;&#34;text/plain&#34;&#41;;&#39;
Content-Type: text/plain; charset=ISO-8859-1


tom@whaam ~ $ perl -MCGI -le &#39;my $q = CGI-&gt;new; print $q-&gt;header&#40;&#34;image/gif&#34;&#41;;&#39;
Content-Type: image/gif


tom@whaam ~ $ cpanm -q M/MA/MARKSTOS/CGI.pm-3.51.tar.gz
Successfully installed CGI.pm-3.51
1 distribution installed
tom@whaam ~ $ perl -MV=CGI
CGI
        /opt/perlbrew/perls/perl-5.14.1/lib/5.14.1/CGI.pm: 3.51
tom@whaam ~ $ perl -MCGI -le &#39;my $q = CGI-&gt;new; print $q-&gt;header&#40;&#34;text/plain&#34;&#41;;&#39;
Content-Type: text/plain; charset=ISO-8859-1


tom@whaam ~ $ perl -MCGI -le &#39;my $q = CGI-&gt;new; print $q-&gt;header&#40;&#34;image/gif&#34;&#41;;&#39;
Content-Type: image/gif; charset=ISO-8859-1
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;16&nbsp;12:36:05&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;16&nbsp;12:51:59&nbsp;2012</span>
    <span class="description">mark [...] summersault.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #67100] charset applied to every content-type</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 16 Aug 2012 12:51:41 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CGI [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Stosberg &lt;mark [...] summersault.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
Thanks for the clarification, Tom.

I see what you are saying. The two bug reports were not opposite of each
other as I first thought. As you&#39;ve clarified, it appears the last
change &#34;over-fixed&#34; issue, and it should be dialed back some.

Tests and a patch would be welcome. Otherwise, I&#39;ll get to it as time
permits myself.

  Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;16&nbsp;13:10:07&nbsp;2012</span>
    <span class="description">trs [...] bestpractical.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #67100] charset applied to every content-type</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 16 Aug 2012 10:10:06 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CGI [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Thomas Sibley &lt;trs [...] bestpractical.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 08/16/2012 09:52 AM, mark@summersault.com via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I see what you are saying. The two bug reports were not opposite of each
&gt; other as I first thought. As you&#39;ve clarified, it appears the last
&gt; change &#34;over-fixed&#34; issue, and it should be dialed back some.
</div>
Agreed.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Tests and a patch would be welcome. Otherwise, I&#39;ll get to it as time
&gt; permits myself.
</div>
Here&#39;s a couple tests.  I don&#39;t have time at the moment to track down
and fix the bug itself.
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;16&nbsp;13:52:51&nbsp;2012</span>
    <span class="description">mark [...] summersault.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #67100] charset applied to every content-type</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 16 Aug 2012 13:52:33 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CGI [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Stosberg &lt;mark [...] summersault.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for the tests!

Maybe there&#39;s a college CS student out there somewhere who would like to
apprentice as a CGI.pm maintainer...

  Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;11&nbsp;21:20:45&nbsp;2013</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt; This actually fails for us on some application/javascript which
&gt; &gt;&gt; wasn&#39;t forcing a charset, and I&#39;ll fix that, but I&#39;m not sure why
&gt; &gt;&gt; CGI started adding that on between 3.50 and 3.51
</div>&gt; &gt;
&gt; &gt; The reason for the change was documented in &#34;Changes&#34;, which
&gt; &gt; referenced the related RT ticket, which in turn referenced HTTP RFCs
&gt; &gt; to justify the change.  Here&#39;s the entry from &#34;Changes&#34;
&gt; &gt;
&gt; &gt; [BUG FIXES] - Setting charset&#40;&#41; now works for all content types, not
&gt; &gt; just &#34;text/*&#34;. &#40;RT#57945, Thanks to Yanick and Gerv.&#41;
</div>&gt; 
&gt; I think there&#39;s some confusion here.  The bug fix and ticket you
&gt; mention
&gt; above is about *allowing* a charset to be sent on non-text/ types.
&gt; 
&gt; This bug is that CGI.pm is sending a default charset of ISO-8859-1 on
&gt; *any* content-type even when *no charset* is set by the code.
&gt; 
&gt; It seems, from first glance, that the change you quote above to always
&gt; respect the charset has caused the side effect that the default
&gt; textual
&gt; charset is always sent, regardless of content-type.
</div>
I reviewed this again tonight.

I also agree with your point that it&#39;s a waste of bandwidth to send
charset on a image/gif type by default where it doesn&#39;t apply.

Reading the old ticket one more time, the request then wasn&#39;t that the
charset be set for every content-type by default, it was that it was
*allowed to be changed* via $self-&gt;charset&#40;&#41; for non &#34;text/*&#34; types. It
already worked for non-text types if the charset was supplied in every
call to header&#40;&#41;.

Internally, perhaps the problem is the way the code is structured, it
can&#39;t tell whether $self-&gt;charset&#40;&#41; contains a value that is the global
default, or one set by the user. Thus, some kind of re-working is
required to provide the ideal solution.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;15&nbsp;13:46:03&nbsp;2013</span>
    <span class="description">trs [...] bestpractical.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #67100] charset applied to every content-type</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 15 Jan 2013 10:45:58 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CGI [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Thomas Sibley &lt;trs [...] bestpractical.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 01/11/2013 06:20 PM, MARKSTOS via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I reviewed this again tonight.
&gt; 
&gt; I also agree with your point that it&#39;s a waste of bandwidth to send
&gt; charset on a image/gif type by default where it doesn&#39;t apply.
&gt; 
&gt; Reading the old ticket one more time, the request then wasn&#39;t that the
&gt; charset be set for every content-type by default, it was that it was
&gt; *allowed to be changed* via $self-&gt;charset&#40;&#41; for non &#34;text/*&#34; types. It
&gt; already worked for non-text types if the charset was supplied in every
&gt; call to header&#40;&#41;.
</div>
Yep, that was my understanding as well, and what I was trying to express
in my mail you quoted.  I&#39;m glad we&#39;re on the same page. :&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Internally, perhaps the problem is the way the code is structured, it
&gt; can&#39;t tell whether $self-&gt;charset&#40;&#41; contains a value that is the global
&gt; default, or one set by the user. Thus, some kind of re-working is
&gt; required to provide the ideal solution.
</div>
Correct.  Back when this ticket was previously active, I dug into the
CGI internals to try and come up with a quick patch.  Unfortunately, I
came to the same conclusion: the global default is indistinguishable
from a user set default, so the entire method of -&gt;charset&#40;&#41; handling
needs reworking.  It&#39;s unfortunately not enough to simply compare the
current -&gt;charset&#40;&#41; to the global default, since the user may have
explicitly specified the global default which should be respected.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;23&nbsp;23:42:48&nbsp;2013</span>
    <span class="description">ANAZAWA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I think header&#40;&#41; should be a subset of HTTP::Headers,
and so charset&#40;&#41; attribute should be read-only.
In CGI.pm, the default value of the Content-Type header
is set to &#34;text/html; charset=ISO-8859-1&#34;.
That&#39;s why charset&#40;&#41; *returns* &#34;ISO-8859-1&#34; by default.

By the way, why is HTTP::Headers::content_type_charset&#40;&#41; read-only?
In other words, how can we make CGI::charset&#40;&#41; writable?
In my opinion, charset&#40;&#41; attribute of CGI.pm isn&#39;t writable.
In fact, you can&#39;t set charset&#40;&#41; in the following situation:

  my $q = CGI-&gt;new;
  $q-&gt;charset&#40; &#39;utf-8&#39; &#41;; # set

  print $q-&gt;header&#40; -type =&gt; &#39;text/plain; charSet=EUC-JP&#39; &#41;;

  # [STDOUT]
  # Content-Type: text/plain; charSet=EUC-JP; charset=utf-8
  #

In CGI.pm, the Content-Type header is separated into two properties:
&#39;-type&#39; and &#39;-charset&#39;.ã€€To begin with, I don&#39;t think we can&#39;t *separate* 
the Content-Type header into two properties, while I don&#39;t know
how to fix this problem ;&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;22&nbsp;08:10:50&nbsp;2014</span>
    <span class="description">LEEJO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This issue has been copied to: <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/leejo/CGI.pm/issues/84">https://github.com/leejo/CGI.pm/issues/84</a></span> please take all future correspondence there.
This ticket will remain open but please do not reply here.
This ticket will be closed when the github issue is dealt with.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;17&nbsp;09:53:16&nbsp;2014</span>
    <span class="description">LEEJO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve taken the path of least disruption here and amended the perldoc to headers to explain that passing -charset =&gt; &#39;&#39; is the workaround to nonsensical charsets.

commit 37ad1ed2164635c9ed358493c33ae90c91448bfc
Author: Lee Johnson &lt;lee@givengain.ch&gt;
Date:   Fri Oct 17 15:49:06 2014 +0200

    resolve #84 [rt.cpan.org #67100] - document default charset

    being nonsensical in some situations and the workaround being to pass
    in -charset =&gt; &#39;&#39; in those cases. this is the path of least disruption
    as there is currently no way to tell if the default charset is one
    set by the user or the module, and the alternative of checking the
    content type against the charset is a no go IMO

 Changes          |  7 +++++++
 lib/CGI.pm       |  8 +++++++-
 t/headers/type.t | 30 ++++++++++++++++++++++++++++++
 3 files changed, 44 insertions&#40;+&#41;, 1 deletion&#40;-&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;17&nbsp;09:53:19&nbsp;2014</span>
    <span class="description">LEEJO [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
