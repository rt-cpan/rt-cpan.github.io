<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #61484 for Win32-EventLog: missing results with Win32::EventLog</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #61484 for Win32-EventLog: missing results with Win32::EventLog</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Win32-EventLog/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Win32-EventLog/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Win32-EventLog/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Win32-EventLog/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Win32-EventLog">Win32-EventLog CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">61484</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Win32-EventLog/Active/">Win32-EventLog</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
paul [...] sennovation.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-221776-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-221777-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




example.out5.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/833641/431822/example.out5.txt">
Mon Sep 20 10:05:52 2010 (6.2k) by paul [...] sennovation.com
</a>
</font></li>
</ul>


exampleEventLog.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/834157/432097/exampleEventLog.pl">
Tue Sep 21 05:43:52 2010 (1.5k) by dolmen [...] cpan.org
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/833641/431823/exampleEventLog.pl">
Mon Sep 20 10:05:52 2010 (1.2k) by paul [...] sennovation.com
</a>
</font></li>
</ul>


RT61484.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/834987/432533/RT61484.patch">
Wed Sep 22 13:26:17 2010 (8.5k) by dolmen [...] cpan.org
</a>
</font></li>
</ul>


snap447.png<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/833641/431824/snap447.png">
Mon Sep 20 10:05:52 2010 (37.1k) by paul [...] sennovation.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;20&nbsp;10:05:52&nbsp;2010</span>
    <span class="description">paul [...] sennovation.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> missing results with Win32::EventLog</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 20 Sep 2010 10:05:39 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Win32-EventLog [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Paul Faulstich &lt;paul [...] sennovation.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I am finding that Win32::EventLog does not consistently pull all the
data from the event log.  I suspect this may be because I am pulling
data from remote machines.  I have looked though the source code for a
place that might have a hidden timeout or synchronization issue that
is causing events to be dropped, but I am not seeing it. Also, I can
run my script over and over, and I get the same results, which I
wouldn&#39;t expect with a timeout or synchronization problem.

I also wonder if it has to do with needing to change the value of
other parameters, such as NumberOfBytesToRead, which I don&#39;t appear to
be able to set.  See
<span class="clickylink"><a target="new" rel="nofollow" href="http://msdn.microsoft.com/en-us/library/aa363674%28VS.85%29.aspx">http://msdn.microsoft.com/en-us/library/aa363674%28VS.85%29.aspx</a></span>

Enclosed are three files:
* my example perl script. This script prints details of all events
whose Source includes the string &#34;Symantec&#34;. For other events, it
prints just the Source name. &#40;exampleEventLog.pl&#41;
* the results from running the perl script, which contains only 4
entries with a source of Symantec Antivirus &#40;example.out5.txt&#41;
* a screenshot of the EventViewer for that machine, which shows far
more than 4 entries for Symantec Antivirus, including entries
interspersed between those that the perl script found. &#40;snap447.png&#41;

Please let me know if there are other tests I can do to help resolve
this problem.  I guess the good news is my results are consistent with
any given PC.

Thanks,

Paul

--
Paul Faulstich, GIAC GSEC
SEnnovation.com
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/833641/431824/snap447.png">Download snap447.png</a><br />
<span class="downloadcontenttype">image/png 37.1k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;21&nbsp;05:43:52&nbsp;2010</span>
    <span class="description">dolmen [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> libwin32 [...] perl.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #61484] missing results with Win32::EventLog</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 21 Sep 2010 11:43:15 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Win32-EventLog [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Olivier Mengué &lt;dolmen [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Paul

It looks like the use of the EVENT_SEQUENTIAL_READ flag is what causes the
skip.
I&#39;ve modified your script to use explicit offset calculation and all events
appear. I only used the example from Win32::Log&#39;s perldoc as a reference.
See attached file.

Olivier Mengué.


2010/9/20 Paul Faulstich via RT &lt;bug-Win32-EventLog@rt.cpan.org&gt;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Mon Sep 20 10:05:52 2010: Request 61484 was acted upon.
&gt; Transaction: Ticket created by paul@sennovation.com
&gt;       Queue: Win32-EventLog
&gt;     Subject: missing results with Win32::EventLog
&gt;   Broken in: &#40;no value&#41;
&gt;    Severity: &#40;no value&#41;
&gt;       Owner: Nobody
&gt;  Requestors: paul@sennovation.com
&gt;      Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=61484">https://rt.cpan.org/Ticket/Display.html?id=61484</a></span> &gt;
&gt;
&gt;
&gt; I am finding that Win32::EventLog does not consistently pull all the
&gt; data from the event log.  I suspect this may be because I am pulling
&gt; data from remote machines.  I have looked though the source code for a
&gt; place that might have a hidden timeout or synchronization issue that
&gt; is causing events to be dropped, but I am not seeing it. Also, I can
&gt; run my script over and over, and I get the same results, which I
&gt; wouldn&#39;t expect with a timeout or synchronization problem.
&gt;
&gt; I also wonder if it has to do with needing to change the value of
&gt; other parameters, such as NumberOfBytesToRead, which I don&#39;t appear to
&gt; be able to set.  See
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://msdn.microsoft.com/en-us/library/aa363674%28VS.85%29.aspx">http://msdn.microsoft.com/en-us/library/aa363674%28VS.85%29.aspx</a></span>
&gt;
&gt; Enclosed are three files:
&gt; * my example perl script. This script prints details of all events
&gt; whose Source includes the string &#34;Symantec&#34;. For other events, it
&gt; prints just the Source name. &#40;exampleEventLog.pl&#41;
&gt; * the results from running the perl script, which contains only 4
&gt; entries with a source of Symantec Antivirus &#40;example.out5.txt&#41;
&gt; * a screenshot of the EventViewer for that machine, which shows far
&gt; more than 4 entries for Symantec Antivirus, including entries
&gt; interspersed between those that the perl script found. &#40;snap447.png&#41;
&gt;
&gt; Please let me know if there are other tests I can do to help resolve
&gt; this problem.  I guess the good news is my results are consistent with
&gt; any given PC.
&gt;
&gt; Thanks,
&gt;
&gt; Paul
&gt;
&gt; --
&gt; Paul Faulstich, GIAC GSEC
&gt; SEnnovation.com
&gt;
&gt;
&gt; Machine: BG60246
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: SecurityCenter
&gt; !!!!!
&gt; Source: ccSvcHst
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: Offline Files
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: RCONSVC
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; ====================================================
&gt; Sat Sep 18 22:51:59 2010 BG60246[12] Symantec AntiVirus:INFORMATION
&gt;
&gt;
&gt; Changed value &#39;HKLM\SOFTWARE\Symantec\Symantec Endpoint
&gt; Protection\AV\Storages\MicrosoftExchangeClient\RealTimeScan\FileType&#39; from
&gt; &#39;0&#39; to &#39;1&#39;
&gt; ====================================================
&gt; Sat Sep 18 22:51:59 2010 BG60246[12] Symantec AntiVirus:INFORMATION
&gt;
&gt;
&gt; New Value &#39;HKLM\SOFTWARE\Symantec\Symantec Endpoint
&gt; Protection\AV\Quarantine\ForwardingPort&#39; = &#39;33&#39;
&gt; ====================================================
&gt; Sat Sep 18 22:51:52 2010 BG60246[14] Symantec AntiVirus:INFORMATION
&gt;
&gt;
&gt; Symantec Endpoint Protection services startup was successful.
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: ccSvcHst
&gt; !!!!!
&gt; Source: SescLU
&gt; !!!!!
&gt; Source: RCONSVC
&gt; ====================================================
&gt; Fri Sep 17 23:17:43 2010 BG60246[14] Symantec AntiVirus:INFORMATION
&gt;
&gt;
&gt; Symantec Endpoint Protection services startup was successful.
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: UPHClean
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: UPHClean
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: Folder Redirection
&gt; !!!!!
&gt; Source: RCONSVC
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: Outlook
&gt; !!!!!
&gt; Source: RCONSVC
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: Outlook
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: UPHClean
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: WinMgmt
&gt; !!!!!
&gt; Source: WinMgmt
&gt; !!!!!
&gt; Source: RCONSVC
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: WinMgmt
&gt; !!!!!
&gt; Source: WinMgmt
&gt; !!!!!
&gt; Source: WinMgmt
&gt; !!!!!
&gt; Source: WinMgmt
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: crypt32
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: LoadPerf
&gt; !!!!!
&gt; Source: System.ServiceModel.Install 3.0.0.0
&gt; !!!!!
&gt; Source: System.ServiceModel.Install 3.0.0.0
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: MsiInstaller
&gt; !!!!!
&gt; Source: UPHClean
&gt;
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;21&nbsp;05:43:53&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;21&nbsp;09:01:05&nbsp;2010</span>
    <span class="description">dolmen [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> libwin32 [...] perl.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">My solution above was a workaround.

However there is a real bug in the Win32::EventLog code.
The lpEvtLog-&gt;CurEntryNum member is incorrectly incremented in
ReadEventLog. It should be incremented by just 1 instead of LogBuf-&gt;Length.

See
<span class="clickylink"><a target="new" rel="nofollow" href="http://code.google.com/p/libwin32/source/browse/trunk/Win32-EventLog/EventLog.xs#351">http://code.google.com/p/libwin32/source/browse/trunk/Win32-EventLog/EventLog.xs#351</a></span>

-- 
Olivier Mengué - <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~dolmen/">http://search.cpan.org/~dolmen/</a></span> <span class="clickylink"><a target="new" rel="nofollow" href="http://github.com/dolmen/">http://github.com/dolmen/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;21&nbsp;10:04:50&nbsp;2010</span>
    <span class="description">paul [...] sennovation.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #61484] missing results with Win32::EventLog</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 21 Sep 2010 10:04:36 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Win32-EventLog [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Paul Faulstich &lt;paul [...] sennovation.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks!  I was working off the example in the O&#39;Reilly perl sysadm
book <span class="clickylink"><a target="new" rel="nofollow" href="http://oreilly.com/catalog/perlsysadm/chapter/ch09.html">http://oreilly.com/catalog/perlsysadm/chapter/ch09.html</a></span>

Good catching the bug.  Worth noting in the module documentation,
since others may miss it.

Thanks for your help.  I will use your approach of manually counting
backwards through the entries.

Paul

2010/9/21 Olivier &#39;dolmen&#39; Mengué via RT &lt;bug-Win32-EventLog@rt.cpan.org&gt;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=61484">https://rt.cpan.org/Ticket/Display.html?id=61484</a></span> &gt;
&gt;
&gt; My solution above was a workaround.
&gt;
&gt; However there is a real bug in the Win32::EventLog code.
&gt; The lpEvtLog-&gt;CurEntryNum member is incorrectly incremented in
&gt; ReadEventLog. It should be incremented by just 1 instead of LogBuf-&gt;Length.
&gt;
&gt; See
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://code.google.com/p/libwin32/source/browse/trunk/Win32-EventLog/EventLog.xs#351">http://code.google.com/p/libwin32/source/browse/trunk/Win32-EventLog/EventLog.xs#351</a></span>
&gt;
&gt; --
&gt; Olivier Mengué - <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~dolmen/">http://search.cpan.org/~dolmen/</a></span> <span class="clickylink"><a target="new" rel="nofollow" href="http://github.com/dolmen/">http://github.com/dolmen/</a></span>
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;22&nbsp;13:26:17&nbsp;2010</span>
    <span class="description">dolmen [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [patch] missing results with Win32::EventLog</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> libwin32 [...] perl.org</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Le Mar 21 Sep 2010 10:04:50, paul@sennovation.com a écrit :
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Good catching the bug.
</div>
Well... My proposed fix did not work. I&#39;ve been trapped by the variable
names. Anyway I finally found the problem.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Worth noting in the module documentation,
&gt; since others may miss it.
</div>
A real fix is always better than documentation.
So here is the full patch &#40;really tested this time&#41;, with a test case.

Jan: can I have a commit bit on the libwin32 repository?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks!  I was working off the example in the O&#39;Reilly perl sysadm
&gt; book <span class="clickylink"><a target="new" rel="nofollow" href="http://oreilly.com/catalog/perlsysadm/chapter/ch09.html">http://oreilly.com/catalog/perlsysadm/chapter/ch09.html</a></span>
</div>
Thanks for this reference. It helped me to fix the bug while preserving
compatibility with this book sample.


-- 
Olivier Mengué - <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~dolmen/">http://search.cpan.org/~dolmen/</a></span> <span class="clickylink"><a target="new" rel="nofollow" href="http://github.com/dolmen/">http://github.com/dolmen/</a></span>
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RT61484.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Index: t/RT61484.t
===================================================================
--- t/RT61484.t	&#40;revision 0&#41;
+++ t/RT61484.t	&#40;revision 0&#41;
@@ -0,0 +1,98 @@
+use strict;
+use warnings;
+
+use Test::More tests =&gt; 122;
+
+
+{
+    package TestLogSeq;
+    use Win32::EventLog;
+
+    sub new
+    {
+        my $class = shift;
+        #$class = &#40;ref $class&#41; ? &#40;ref $class&#41; : $class;
+        my $log = Win32::EventLog-&gt;new&#40;&#39;Application&#39;, &#39;&#39;&#41;;
+        Test::More::isa_ok&#40;$log, &#39;Win32::EventLog&#39;, &#34;$class log&#34;&#41;;
+        return bless {
+            log =&gt; $log,
+            flags =&gt; &#40;EVENTLOG_SEQUENTIAL_READ | EVENTLOG_BACKWARDS_READ&#41;,
+        }, $class;
+    }
+
+    sub _next_offset
+    {
+        0
+    }
+
+    sub read
+    {
+        my $self = shift;
+        local $Win32::EventLog::GetMessageText = 1;
+        my &#40;$flags, $offset&#41; = &#40;$self-&gt;{flags}, $self-&gt;_next_offset&#41;;
+        #printf &#34;# %s: 0x%X %d\n&#34;, &#40;ref $self&#41;, $flags, $offset;
+        $self-&gt;{log}-&gt;Read&#40;$flags, $offset, my $entry&#41; or die &#34;Read failure&#34;;
+        Test::More::is&#40;ref $entry, &#39;HASH&#39;, &#34;entry is HASHREF&#34;&#41;;
+        Test::More::ok&#40;exists $entry-&gt;{RecordNumber}, &#34;entry has RecordNumber&#34;&#41;;
+        if &#40;$offset &gt; 1&#41; {
+            Test::More::is&#40;$entry-&gt;{RecordNumber}, $offset, &#34;RecordNumber is $offset&#34;&#41;;
+        }
+        return $entry;
+    }
+
+    sub DESTROY
+    {
+        $_[0]-&gt;{log}-&gt;Close;
+    }
+}
+
+{
+    package TestLogSeek;
+    use Win32::EventLog;
+    use Test::More;
+
+    our @ISA = qw&#40;TestLogSeq&#41;;
+
+    sub new
+    {
+        my $class = shift;
+        my $self = TestLogSeq::new&#40;$class, @_&#41;;
+        $self-&gt;{flags} = &#40;EVENTLOG_SEEK_READ | EVENTLOG_BACKWARDS_READ&#41;;
+
+        my $log = $self-&gt;{log};
+
+        my &#40;$oldest, $lastRec&#41;;
+        $log-&gt;GetOldest&#40;$oldest&#41;;
+        $log-&gt;GetNumber&#40;$lastRec&#41;;
+        $self-&gt;{offset} = $oldest + $lastRec;
+
+        return $self;
+    }
+
+    sub _next_offset
+    {
+        return --$_[0]-&gt;{offset};
+    }
+}
+
+
+sub check_entries
+{
+    my &#40;$a, $b&#41; = @_;
+    is&#40;scalar localtime $a-&gt;{TimeGenerated}, scalar localtime $b-&gt;{TimeGenerated}, &#39;check TimeGenerated is &#34;&#39;.scalar&#40;localtime $a-&gt;{TimeGenerated}&#41;.&#39;&#34;&#39;&#41;;
+    #foreach my $attr &#40;qw&#40;RecordNumber Computer Source EventType Category EventID Message&#41;&#41; {
+    foreach my $attr &#40;qw&#40;RecordNumber&#41;&#41; {
+        is&#40;$a-&gt;{$attr}, $b-&gt;{$attr}, &#34;check $attr is $b-&gt;{$attr}&#34;&#41;;
+    }
+}
+
+
+my $log_seq = TestLogSeq-&gt;new;
+my $log_seek = TestLogSeek-&gt;new;
+
+foreach &#40;1..15&#41; {
+    pass &#34;== Read $_ ==&#34;;
+    check_entries&#40;$log_seq-&gt;read, $log_seek-&gt;read&#41;;
+}
+
+# vim:set et sw=4 sts=4:
Index: Changes
===================================================================
--- Changes	&#40;revision 502&#41;
+++ Changes	&#40;working copy&#41;
@@ -1,5 +1,14 @@
 Revision history for Perl extension Win32::EventLog.
 
+0.077
+      - fix for skipped record when reading in SEQUENTIAL mode
+        &#40;RT#61484&#41; by Olivier Mengue
+      - the OFFSET argument is now completely ignored in SEQUENTIAL read
+        as in the underlying Win32 implementation. A &#39;0&#39; value previously
+        had a special behaviour which bypassed the cache and so gave
+        unpredictable results. Olivier Mengue.
+      - added test for RT#61484 by Olivier Mengue
+
 0.076 Wed Jul 02 2008 &#40;Jan Dubois&#41;
       - Make sure the regression tests are properly skipped on Win95
 
Index: EventLog.xs
===================================================================
--- EventLog.xs	&#40;revision 502&#41;
+++ EventLog.xs	&#40;working copy&#41;
@@ -26,9 +26,8 @@
     BOOL   wideEntries;			/* has unicode character entries */
     LPBYTE BufPtr;			/* pointer to data buffer */
     DWORD  BufLen;			/* size of buffer */
-    DWORD  NumEntries;			/* number of entries in buffer */
-    DWORD  CurEntryNum;			/* next entry to return */
     EVENTLOGRECORD *CurEntry;		/* point to next entry to return */
+    EVENTLOGRECORD *EndEntry;		/* point to after the last entry read */
     DWORD  Flags;			/* read flags for ReadEventLog */
 } EvtLogCtlBuf, *lpEvtLogCtlBuf;
 
@@ -278,12 +277,14 @@
     lpEvtLog = SVE&#40;handle&#41;;
     if &#40;&#40;lpEvtLog != NULL&#41; &#38;&#38; &#40;lpEvtLog-&gt;dwID == EVTLOGID&#41;&#41; {
 	DWORD NumRead, Required;
-	if &#40;Flags != lpEvtLog-&gt;Flags&#41; {
+	if &#40;  &#40;Flags != lpEvtLog-&gt;Flags&#41;
+           || &#40;lpEvtLog-&gt;CurEntry &gt;= lpEvtLog-&gt;EndEntry&#41;
+           || &#40;&#40;&#40;Flags &#38; EVENTLOG_SEEK_READ&#41; == EVENTLOG_SEEK_READ&#41; &#38;&#38; Record != lpEvtLog-&gt;CurEntry-&gt;RecordNumber&#41;&#41; {
 	    /* Reset to new read mode &#38; force a re-read call */
 	    lpEvtLog-&gt;Flags      = Flags;
-	    lpEvtLog-&gt;NumEntries = 0;
+	    lpEvtLog-&gt;EndEntry = &#40;EVENTLOGRECORD*&#41; lpEvtLog-&gt;BufPtr;
 	}
-	if &#40;&#40;lpEvtLog-&gt;NumEntries == 0&#41; || &#40;Record != 0&#41;&#41; {
+	if &#40;lpEvtLog-&gt;CurEntry &gt;= lpEvtLog-&gt;EndEntry&#41; {
 	redo_read:
             result = ReadEventLogA&#40;lpEvtLog-&gt;hLog, Flags, Record,
                                    lpEvtLog-&gt;BufPtr, lpEvtLog-&gt;BufLen,
@@ -291,9 +292,9 @@
             lpEvtLog-&gt;wideEntries = FALSE;
 
 	    if &#40;result&#41;
-		lpEvtLog-&gt;NumEntries = NumRead;
+		lpEvtLog-&gt;EndEntry = &#40;EVENTLOGRECORD*&#41; &#40;lpEvtLog-&gt;BufPtr + NumRead&#41;;
 	    else {
-		lpEvtLog-&gt;NumEntries = 0;
+		lpEvtLog-&gt;EndEntry = &#40;EVENTLOGRECORD*&#41; lpEvtLog-&gt;BufPtr;
 		if &#40;Required &gt; lpEvtLog-&gt;BufLen
 		    &#38;&#38; GetLastError&#40;&#41; == ERROR_INSUFFICIENT_BUFFER&#41;
 		{
@@ -302,12 +303,12 @@
 		    goto redo_read;
 		}
 	    }
-	    lpEvtLog-&gt;CurEntryNum = 0;
-	    lpEvtLog-&gt;CurEntry    = &#40;EVENTLOGRECORD*&#41;lpEvtLog-&gt;BufPtr;
+	    lpEvtLog-&gt;CurEntry = &#40;EVENTLOGRECORD*&#41; lpEvtLog-&gt;BufPtr;
 	}
 
-	if &#40;lpEvtLog-&gt;CurEntryNum &lt; lpEvtLog-&gt;NumEntries&#41; {
+	if &#40;lpEvtLog-&gt;CurEntry &lt; lpEvtLog-&gt;EndEntry&#41; {
 	    EVENTLOGRECORD *LogBuf;
+	    /*printf&#40;&#34;# CurEntryNum: %d   NumEntries: %d\n&#34;, lpEvtLog-&gt;CurEntryNum, lpEvtLog-&gt;NumEntries&#41;;*/
 	    LogBuf = lpEvtLog-&gt;CurEntry;
 	    SETPVN&#40;3, &#40;char*&#41;LogBuf, LogBuf-&gt;Length&#41;;
 	    if &#40;lpEvtLog-&gt;wideEntries&#41; {
@@ -348,13 +349,7 @@
 		SETPVN&#40;8, &#40;&#40;LPBYTE&#41;LogBuf&#41;+LogBuf-&gt;StringOffset, LogBuf-&gt;DataOffset-LogBuf-&gt;StringOffset&#41;;
 
 	    /* to next entry in buffer */
-	    lpEvtLog-&gt;CurEntryNum += LogBuf-&gt;Length;
 	    lpEvtLog-&gt;CurEntry = &#40;EVENTLOGRECORD*&#41;&#40;&#40;&#40;LPBYTE&#41;LogBuf&#41; + LogBuf-&gt;Length&#41;;
-	    if &#40;lpEvtLog-&gt;CurEntryNum == lpEvtLog-&gt;NumEntries&#41; {
-		lpEvtLog-&gt;NumEntries  = 0;
-		lpEvtLog-&gt;CurEntryNum = 0;
-		lpEvtLog-&gt;CurEntry    = NULL;
-	    }
 	    RETVAL = TRUE;
 	}
     }
@@ -684,9 +679,8 @@
     if &#40;lpEvtLog-&gt;hLog&#41; {
 	/* return info... */
 	lpEvtLog-&gt;dwID          = EVTLOGID;
-	lpEvtLog-&gt;NumEntries    = 0;
-	lpEvtLog-&gt;CurEntryNum   = 0;
-	lpEvtLog-&gt;CurEntry      = NULL;
+	lpEvtLog-&gt;CurEntry      = &#40;EVENTLOGRECORD*&#41; lpEvtLog-&gt;BufPtr;
+	lpEvtLog-&gt;EndEntry      = &#40;EVENTLOGRECORD*&#41; lpEvtLog-&gt;BufPtr;
 	lpEvtLog-&gt;Flags         = 0;
 	hEventLog = &#40;size_t&#41;lpEvtLog;
 	RETVAL = TRUE;
@@ -718,9 +712,8 @@
     if &#40;lpEvtLog-&gt;hLog&#41; {
 	/* return info... */
 	lpEvtLog-&gt;dwID          = EVTLOGID;
-	lpEvtLog-&gt;NumEntries    = 0;
-	lpEvtLog-&gt;CurEntryNum   = 0;
-	lpEvtLog-&gt;CurEntry      = NULL;
+	lpEvtLog-&gt;CurEntry      = &#40;EVENTLOGRECORD*&#41; lpEvtLog-&gt;BufPtr;
+	lpEvtLog-&gt;EndEntry      = &#40;EVENTLOGRECORD*&#41; lpEvtLog-&gt;BufPtr;
 	lpEvtLog-&gt;Flags         = 0;
 	hEventLog = &#40;size_t&#41;lpEvtLog;
 	RETVAL = TRUE;
Index: EventLog.pm
===================================================================
--- EventLog.pm	&#40;revision 502&#41;
+++ EventLog.pm	&#40;working copy&#41;
@@ -9,7 +9,7 @@
 
 use strict;
 use vars qw&#40;$VERSION $AUTOLOAD @ISA @EXPORT $GetMessageText&#41;;
-$VERSION = &#39;0.076&#39;;
+$VERSION = &#39;0.077&#39;;
 
 require Exporter;
 require DynaLoader;
@@ -276,6 +276,21 @@
 The Read&#40;&#41; method read an EventLog entry from the EventLog represented
 by $handle.
 
+When using EVENTLOG_SEQUENTIAL_READ, OFFSET must have the following values:
+
+=over 4
+
+=item 1
+
+Reset read from start &#40;either first or last record depending on
+EVENTLOG_FORWARDS_READ / EVENTLOG_BACKWARDS_READ flags&#41;
+
+=item 0
+
+Read the next item.
+
+=back
+
 =item $handle-&gt;Close&#40;&#41;;
 
 The Close&#40;&#41; method closes the EventLog represented by $handle. After
@@ -459,13 +474,15 @@
 
 =head1 BUGS
 
-None currently known.
+See L&lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/NoAuth/Bugs.html?Dist=Win32-EventLog">https://rt.cpan.org/NoAuth/Bugs.html?Dist=Win32-EventLog</a></span>&gt;
 
 The test script for &#39;make test&#39; should be re-written to use the
 EventLog object.
 
 =head1 AUTHOR
 
-Original code by Jesse Dougherty for HiP Communications. Additional
-fixes and updates attributed to Martin Pauley
-&lt;martin.pauley@ulsterbank.ltd.uk&gt;&#41; and Bret Giddings &#40;bret@essex.ac.uk&#41;.
+Original code by Jesse Dougherty for HiP Communications.
+
+Additional fixes and updates attributed to Martin Pauley
+&lt;martin.pauley@ulsterbank.ltd.uk&gt;&#41;, Bret Giddings &#40;&lt;bret@essex.ac.uk&gt;&#41;
+and Olivier MenguE&lt;eacute&gt; &#40;&lt;dolmen@cpan.org&gt;&#41;.
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;23&nbsp;05:45:55&nbsp;2010</span>
    <span class="description">dolmen [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> libwin32 [...] perl.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Patch committed in r506.

-- 
Olivier Mengué - <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~dolmen/">http://search.cpan.org/~dolmen/</a></span> <span class="clickylink"><a target="new" rel="nofollow" href="http://github.com/dolmen/">http://github.com/dolmen/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;01&nbsp;18:41:39&nbsp;2010</span>
    <span class="description">jand [...] ActiveState.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #61484] missing results with Win32::EventLog </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 1 Oct 2010 15:41:30 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Win32-EventLog [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Jan Dubois&#34; &lt;jand [...] activestate.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, 23 Sep 2010, Olivier &#39;dolmen&#39; Mengué via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Patch committed in r506.
</div>
I was just running the new test you wrote for this bug &#40;r505&#41;, and
it doesn&#39;t fail for me with the old version of Win32::EventLog.

That means it doesn&#39;t actually show that the new patch makes any
difference.

I haven&#39;t looked into the details though; any ideas what may be going
on.  Tested with plain ActivePerl 5.12.2.1202 on Windows 2000.

Cheers,
-Jan
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
