<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #53325 for Net-DNS: if /etc/resolv.conf is not readable then importing Net::DNS fails</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #53325 for Net-DNS: if /etc/resolv.conf is not readable then importing Net::DNS fails</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Net-DNS">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Net-DNS">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Net-DNS">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Net-DNS">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-DNS">Net-DNS CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">53325</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Net-DNS">Net-DNS</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
arekm [...] maven.pl

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-22454-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-22455-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




net-dns-noresolvconf.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/773914/400684/net-dns-noresolvconf.patch">
Fri May 07 19:34:58 2010 (855b) by mss [...] apache.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=53325">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-714725" href="/Public/Bug/Display.html?id=53325#txn-714725">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;03&nbsp;16:30:40&nbsp;2010</span>
    <span class="description">arekm [...] maven.pl -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> if /etc/resolv.conf is not readable then importing Net::DNS fails</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 3 Jan 2010 22:30:13 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-DNS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Arkadiusz Miskiewicz &lt;arekm [...] maven.pl&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/714725/368864/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/368864">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 771b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
If /etc/resolv.conf is not readable &#40;for example due to SELinux policy&#41; then even &#34;use Net::DNS&#34; fails.

[builder@ymir-builder ~]$ perl
use Net::DNS;
Could not open /etc/resolv.conf: Permission denied at /usr/lib64/perl5/vendor_perl/5.10.0/x86_64-pld-linux-thread-multi/Net/DNS.pm line 91
Compilation failed in require at /usr/lib64/perl5/vendor_perl/5.10.0/x86_64-pld-linux-thread-multi/Net/DNS.pm line 91.
BEGIN failed--compilation aborted at /usr/lib64/perl5/vendor_perl/5.10.0/x86_64-pld-linux-thread-multi/Net/DNS.pm line 91.
Compilation failed in require at - line 1.
BEGIN failed--compilation aborted at - line 1.

At least import should success in such case.

-- 
Arkadiusz MiÅ›kiewicz        PLD/Linux Team
arekm / maven.pl            <span class="clickylink"><a target="new" rel="nofollow" href="http://ftp.pld-linux.org/">http://ftp.pld-linux.org/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-714931" href="/Public/Bug/Display.html?id=53325#txn-714931">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;04&nbsp;10:06:32&nbsp;2010</span>
    <span class="description">rwfranks [...] acm.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rwfranks [...] acm.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/714931/368985/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/368985">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Before doing anything else, could you try the following &#40;as an unprivileged user&#41;:&lt;br /&gt;
&lt;br /&gt;
cat /etc/resolv.conf&lt;br /&gt;
&lt;br /&gt;
If this fails, then the problem is entirely yours, and not a bug in Net::DNS.&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
Otherwise, more information is required:&lt;br /&gt;
&lt;br /&gt;
Which version of Net::DNS are you using?&lt;br /&gt;
What platform is this running on?&lt;br /&gt;
Perl version appears to be 5.10.0&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
In the absence of this useful information, I attempted to reproduce the problem using Net::DNS 0.65 running on a newly installed Fedora12 x64 with all applicable patches.&lt;br /&gt;
&lt;br /&gt;
Resolver config file is normally publicly readable, but the file is not required for Net::DNS to work.&lt;br /&gt;
&lt;br /&gt;
-rw-r--r--. 1 root root 53 2010-01-04 11:04 /etc/resolv.conf&lt;br /&gt;
&lt;br /&gt;
Changing permissions&lt;br /&gt;
&lt;br /&gt;
----------. 1 root root 53 2010-01-04 11:04 /etc/resolv.conf&lt;br /&gt;
&lt;br /&gt;
or deleting file forces Net::DNS resolver to direct queries to BIND named running on local host. This will also disrupt the resolver components in the C library.&lt;br /&gt;
&lt;br /&gt;
If named is not running, the resolver hangs for a long time.&lt;br /&gt;
&lt;br /&gt;
Neither scenario produces the compilation failure that you describe.&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
--Dick&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
On Sun Jan 03 16:30:40 2010, arekm@maven.pl wrote: &lt;br /&gt;
&#38;gt;  &lt;br /&gt;
&#38;gt; If /etc/resolv.conf is not readable &#40;for example due to SELinux &lt;br /&gt;
&#38;gt; policy&#41; then even &#38;quot;use Net::DNS&#38;quot; fails. &lt;br /&gt;
&#38;gt;  &lt;br /&gt;
&#38;gt; [builder@ymir-builder ~]$ perl &lt;br /&gt;
&#38;gt; use Net::DNS; &lt;br /&gt;
&#38;gt; Could not open /etc/resolv.conf: Permission denied at &lt;br /&gt;
&#38;gt; /usr/lib64/perl5/vendor_perl/5.10.0/x86_64-pld-linux-thread- &lt;br /&gt;
&#38;gt; multi/Net/DNS.pm line 91 &lt;br /&gt;
&#38;gt; Compilation failed in require at &lt;br /&gt;
&#38;gt; /usr/lib64/perl5/vendor_perl/5.10.0/x86_64-pld-linux-thread- &lt;br /&gt;
&#38;gt; multi/Net/DNS.pm line 91. &lt;br /&gt;
&#38;gt; BEGIN failed--compilation aborted at &lt;br /&gt;
&#38;gt; /usr/lib64/perl5/vendor_perl/5.10.0/x86_64-pld-linux-thread- &lt;br /&gt;
&#38;gt; multi/Net/DNS.pm line 91. &lt;br /&gt;
&#38;gt; Compilation failed in require at - line 1. &lt;br /&gt;
&#38;gt; BEGIN failed--compilation aborted at - line 1. &lt;br /&gt;
&#38;gt;  &lt;br /&gt;
&#38;gt; At least import should success in such case. &lt;br /&gt;
&#38;gt;  &lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-714934" href="/Public/Bug/Display.html?id=53325#txn-714934">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;04&nbsp;10:06:34&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-714935" href="/Public/Bug/Display.html?id=53325#txn-714935">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;04&nbsp;10:13:58&nbsp;2010</span>
    <span class="description">rwfranks [...] acm.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rwfranks [...] acm.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/714935/368988/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/368988">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 28b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
FCKeditor is clearly FCKed!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-714938" href="/Public/Bug/Display.html?id=53325#txn-714938">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;04&nbsp;10:25:38&nbsp;2010</span>
    <span class="description">rwfranks [...] acm.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rwfranks [...] acm.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/714938/368991/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/368991">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#40;second attempt&#41;

Before doing anything else, could you try the following &#40;as an unprivileged user&#41;:

cat /etc/resolv.conf

If this fails, then the problem is entirely yours, and not a bug in Net::DNS.

Otherwise, more information is required:

Which version of Net::DNS are you using?

What platform is this running on?

Perl version appears to be 5.10.0

In the absence of this useful information, I attempted to reproduce
the problem using Net::DNS 0.65 running on a newly installed Fedora12
x64 with all applicable patches.

Resolver config file is normally publicly readable, but the file is
not required for Net::DNS to work.

-rw-r--r--. 1 root root 53 2010-01-04 11:04 /etc/resolv.conf

Changing permissions

----------. 1 root root 53 2010-01-04 11:04 /etc/resolv.conf

or deleting file forces Net::DNS resolver to direct queries to BIND
named running on local host. This will also disrupt the resolver
components in the C library.

If named is not running, the resolver hangs for a long time.

Neither scenario produces the compilation failure that you describe.

--Dick
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-714957" href="/Public/Bug/Display.html?id=53325#txn-714957">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;04&nbsp;11:14:29&nbsp;2010</span>
    <span class="description">arekm [...] maven.pl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #53325] if /etc/resolv.conf is not readable then importing Net::DNS fails</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 4 Jan 2010 17:14:05 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-DNS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Arkadiusz Miskiewicz &lt;arekm [...] maven.pl&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/714957/369005/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/369005">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Monday 04 of January 2010, you wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=53325">https://rt.cpan.org/Ticket/Display.html?id=53325</a></span> &gt;
&gt; 
&gt; &#40;second attempt&#41;
&gt; 
&gt; Before doing anything else, could you try the following &#40;as an unprivileged
&gt;  user&#41;:
&gt; 
&gt; cat /etc/resolv.conf
&gt; 
&gt; If this fails, then the problem is entirely yours, and not a bug in
&gt;  Net::DNS.
</div>
It works.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Otherwise, more information is required:
</div>
 But user builder &#40;from which I test use directive&#41; has no read access to 
/etc/resolv.conf due to filesystem ACL rules. perl &#34;-r&#34; test doesn&#39;t seem to 
handle ACLs and it &#34;lies&#34;.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Which version of Net::DNS are you using?
</div>
0.65

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; What platform is this running on?
</div>
Linux 2.6, PLD distro

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Perl version appears to be 5.10.0
&gt; 
&gt; In the absence of this useful information, I attempted to reproduce
&gt; the problem using Net::DNS 0.65 running on a newly installed Fedora12
&gt; x64 with all applicable patches.
&gt; 
&gt; Resolver config file is normally publicly readable, but the file is
&gt; not required for Net::DNS to work.
&gt; 
&gt; -rw-r--r--. 1 root root 53 2010-01-04 11:04 /etc/resolv.conf
</div>
Leave such permissions and then do:

setfacl -m u:youruser:--- /etc/resolv.conf

&#40;assuming /etc filesystem supports ACL&#41;

then try cat /etc/resolv.conf from &#34;youruser&#34;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; --Dick
</div>

-- 
Arkadiusz MiÅ›kiewicz        PLD/Linux Team
arekm / maven.pl            <span class="clickylink"><a target="new" rel="nofollow" href="http://ftp.pld-linux.org/">http://ftp.pld-linux.org/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-715015" href="/Public/Bug/Display.html?id=53325#txn-715015">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;04&nbsp;13:54:58&nbsp;2010</span>
    <span class="description">rwfranks [...] acm.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rwfranks [...] acm.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/715015/369048/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/369048">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 325b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
Aha, I see that ACLs really do mess things up!

I assume you would like the resolver to skip silently over config files rendered inaccessible either by ACLs or the traditional Unix permission mechanism.

The code involved is in Base.pm, so some care will be needed to make sure that the solution is fully portable.

--Dick
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-716576" href="/Public/Bug/Display.html?id=53325#txn-716576">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;07&nbsp;05:01:24&nbsp;2010</span>
    <span class="description">arekm [...] maven.pl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #53325] if /etc/resolv.conf is not readable then importing Net::DNS fails</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 7 Jan 2010 11:00:55 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-DNS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Arkadiusz Miskiewicz &lt;arekm [...] maven.pl&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/716576/369871/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/369871">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Monday 04 of January 2010, you wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=53325">https://rt.cpan.org/Ticket/Display.html?id=53325</a></span> &gt;
&gt; 
&gt; 
&gt; Aha, I see that ACLs really do mess things up!
&gt; 
&gt; I assume you would like the resolver to skip silently over config files
&gt;  rendered inaccessible either by ACLs or the traditional Unix permission
&gt;  mechanism.
&gt; 
&gt; The code involved is in Base.pm, so some care will be needed to make sure
&gt;  that the solution is fully portable.
</div>
I use this hack for now:

--- Net-DNS-0.65.orig/lib/Net/DNS/Resolver/UNIX.pm      2009-01-26 18:31:42.000000000 +0100
+++ Net-DNS-0.65/lib/Net/DNS/Resolver/UNIX.pm   2010-01-03 22:51:12.393805390 +0100
@@ -21,7 +21,17 @@
 sub init {
        my &#40;$class&#41; = @_;
        
+       eval {
        $class-&gt;read_config_file&#40;$resolv_conf&#41; if -f $resolv_conf &#38;&#38; -r _; 
+       };
+       if &#40; $@ &#41; {
+               if &#40; $@ =~ /^Could not open / &#41; {
+                       # we ignore this problem
+                       #warn &#34;$@&#34;;
+               } else {
+                       die $@;
+               }
+       }
        
        foreach my $dir &#40;@config_path&#41; {
                my $file = &#34;$dir/$dotfile&#34;;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; --Dick
&gt; 
</div>

-- 
Arkadiusz MiÅ›kiewicz        PLD/Linux Team
arekm / maven.pl            <span class="clickylink"><a target="new" rel="nofollow" href="http://ftp.pld-linux.org/">http://ftp.pld-linux.org/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-716719" href="/Public/Bug/Display.html?id=53325#txn-716719">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;07&nbsp;10:43:26&nbsp;2010</span>
    <span class="description">rwfranks [...] acm.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rwfranks [...] acm.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/716719/369944/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/369944">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The same result can be achieved more easily by the following one line change:

*** Base.pm-0.65        2009-01-26 17:31:42.000000000 +0000
--- Base.pm     2010-01-07 15:20:53.996194891 +0000
***************
*** 230,250 ****
  sub read_config_file {
        my &#40;$invocant, $file&#41; = @_;
        my $config            = ref $invocant ? $invocant : $invocant-&gt;defaults;
  
        
        my @ns;
        my @searchlist;
        
        local *FILE;
  
!       open&#40;FILE, &#34;&lt; $file&#34;&#41; or croak &#34;Could not open $file: $!&#34;;
        local $/ = &#34;\n&#34;;
        local $_;
        
        while &#40;&lt;FILE&gt;&#41; {
                s/\s*[;#].*//;
                
                # Skip ahead unless there&#39;s non-whitespace characters 
                next unless m/\S/;
  
                SWITCH: {
--- 230,250 ----
  sub read_config_file {
        my &#40;$invocant, $file&#41; = @_;
        my $config            = ref $invocant ? $invocant : $invocant-&gt;defaults;
  
        
        my @ns;
        my @searchlist;
        
        local *FILE;
  
!       open&#40;FILE, &#34;&lt; $file&#34;&#41; || return;
        local $/ = &#34;\n&#34;;
        local $_;
        
        while &#40;&lt;FILE&gt;&#41; {
                s/\s*[;#].*//;
                
                # Skip ahead unless there&#39;s non-whitespace characters 
                next unless m/\S/;
  
                SWITCH: {
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-716749" href="/Public/Bug/Display.html?id=53325#txn-716749">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;07&nbsp;11:13:12&nbsp;2010</span>
    <span class="description">rwfranks [...] acm.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rwfranks [...] acm.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/716749/369964/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/369964">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">If you can find it!&lt;br /&gt;
&lt;br /&gt;
On Thu Jan 07 10:43:26 2010, rwfranks@acm.org wrote: &lt;br /&gt;
&#38;gt; The same result can be achieved more easily by the following one line &lt;br /&gt;
&#38;gt; change: &lt;br /&gt;
&#38;gt;  &lt;br /&gt;
&#38;gt; *** Base.pm-0.65   2009-01-26 17:31:42.000000000 +0000 &lt;br /&gt;
&#38;gt; --- Base.pm        2010-01-07 15:20:53.996194891 +0000 &lt;br /&gt;
&#38;gt; *************** &lt;br /&gt;
&#38;gt; *** 230,250 **** &lt;br /&gt;
&#38;gt;   sub read_config_file { &lt;br /&gt;
&#38;gt;    my &#40;$invocant, $file&#41; = @_; &lt;br /&gt;
&#38;gt;    my $config            = ref $invocant ? $invocant : $invocant- &lt;br /&gt;
&#38;gt; &#38;gt;defaults; &lt;br /&gt;
&#38;gt;  &lt;br /&gt;
&#38;gt;  &lt;br /&gt;
&#38;gt;    my @ns; &lt;br /&gt;
&#38;gt;    my @searchlist; &lt;br /&gt;
&#38;gt;  &lt;br /&gt;
&#38;gt;    local *FILE; &lt;br /&gt;
&#38;gt;  &lt;br /&gt;
&#38;gt; !  open&#40;FILE, &#38;quot;&#38;lt; $file&#38;quot;&#41; or croak &#38;quot;Could not open $file: $!&#38;quot;; &lt;br /&gt;
&#38;gt;    local $/ = &#38;quot;\n&#38;quot;; &lt;br /&gt;
&#38;gt;    local $_; &lt;br /&gt;
&#38;gt;  &lt;br /&gt;
&#38;gt;    while &#40;&#38;lt;FILE&#38;gt;&#41; { &lt;br /&gt;
&#38;gt;                    s/\s*[;#].*//; &lt;br /&gt;
&#38;gt;  &lt;br /&gt;
&#38;gt;            # Skip ahead unless there&#39;s non-whitespace characters &lt;br /&gt;
&#38;gt;            next unless m/\S/; &lt;br /&gt;
&#38;gt;  &lt;br /&gt;
&#38;gt;            SWITCH: { &lt;br /&gt;
&#38;gt; --- 230,250 ---- &lt;br /&gt;
&#38;gt;   sub read_config_file { &lt;br /&gt;
&#38;gt;    my &#40;$invocant, $file&#41; = @_; &lt;br /&gt;
&#38;gt;    my $config            = ref $invocant ? $invocant : $invocant- &lt;br /&gt;
&#38;gt; &#38;gt;defaults; &lt;br /&gt;
&#38;gt;  &lt;br /&gt;
&#38;gt;  &lt;br /&gt;
&#38;gt;    my @ns; &lt;br /&gt;
&#38;gt;    my @searchlist; &lt;br /&gt;
&#38;gt;  &lt;br /&gt;
&#38;gt;    local *FILE; &lt;br /&gt;
&#38;gt;  &lt;br /&gt;
&#38;gt; !  open&#40;FILE, &#38;quot;&#38;lt; $file&#38;quot;&#41; || return; &lt;br /&gt;
&#38;gt;    local $/ = &#38;quot;\n&#38;quot;; &lt;br /&gt;
&#38;gt;    local $_; &lt;br /&gt;
&#38;gt;  &lt;br /&gt;
&#38;gt;    while &#40;&#38;lt;FILE&#38;gt;&#41; { &lt;br /&gt;
&#38;gt;                    s/\s*[;#].*//; &lt;br /&gt;
&#38;gt;  &lt;br /&gt;
&#38;gt;            # Skip ahead unless there&#39;s non-whitespace characters &lt;br /&gt;
&#38;gt;            next unless m/\S/; &lt;br /&gt;
&#38;gt;  &lt;br /&gt;
&#38;gt;            SWITCH: { &lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-773914" href="/Public/Bug/Display.html?id=53325#txn-773914">#</a>      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;07&nbsp;19:34:58&nbsp;2010</span>
    <span class="description">mss [...] apache.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> mss [...] apache.org</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/773914/400683/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/400683">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 262b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Out of boredom, here&#39;s a patch wich implements the previously 
non-unified one while keeping the old behaviour of the public API 
N::D::R::new&#40;config_file =&gt; ...&#41; &#40;I assume that 
N::D::R::Base::read_config_file was no public API since it is 
documented nowhere&#41;.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> net-dns-noresolvconf.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/773914/400684/net-dns-noresolvconf.patch">Download net-dns-noresolvconf.patch</a><br />
<span class="downloadcontenttype">text/x-diff 855b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git a/lib/Net/DNS/Resolver/Base.pm b/lib/Net/DNS/Resolver/Base.pm
index a756947..588ebcb 100644
--- a/lib/Net/DNS/Resolver/Base.pm
+++ b/lib/Net/DNS/Resolver/Base.pm
@@ -168,7 +168,8 @@ sub _process_args {
 	my &#40;$self, %args&#41; = @_;
 	
 	if &#40;$args{&#39;config_file&#39;}&#41; {
-		$self-&gt;read_config_file&#40;$args{&#39;config_file&#39;}&#41;;
+		my $file = $args{&#39;config_file&#39;};
+		$self-&gt;read_config_file&#40;$file&#41; or croak &#34;Could not open $file: $!&#34;;
 	}
 	
 	foreach my $attr &#40;keys %args&#41; {
@@ -237,7 +238,7 @@ sub read_config_file {
 	
 	local *FILE;
 
-	open&#40;FILE, &#34;&lt; $file&#34;&#41; or croak &#34;Could not open $file: $!&#34;;
+	open&#40;FILE, &#34;&lt;&#34;, $file&#41; or return;
 	local $/ = &#34;\n&#34;;
 	local $_;
 	
@@ -272,6 +273,8 @@ sub read_config_file {
 		
 		$config-&gt;{&#39;nameservers&#39;} = [ @ns ]         if @ns;
 		$config-&gt;{&#39;searchlist&#39;}  = [ @searchlist ] if @searchlist;
+
+		return 1;
 	    }
  
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-884285" href="/Public/Bug/Display.html?id=53325#txn-884285">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;20&nbsp;09:37:10&nbsp;2011</span>
    <span class="description">willem [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> mss [...] apache.org, rwfranks [...] acm.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/884285/458296/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/458296">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 320b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Arkadiusz,

Indeed Net::DNS should at least load even when /etc/resolv.conf is for
some mysterious reason not readable. I have applied Malte&#39;s patch, that
still gives the error when the the config file &#40;/etc/resolv,conf or some
other file&#41; is explicitly given on instantiating an Net::DNS::Resolver.

Regards, Willem
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-884289" href="/Public/Bug/Display.html?id=53325#txn-884289">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;20&nbsp;09:37:11&nbsp;2011</span>
    <span class="description">willem [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.606634</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
