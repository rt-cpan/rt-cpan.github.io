<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #124842 for Net-eBay: Error and Suggestion</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #124842 for Net-eBay: Error and Suggestion</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-eBay/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-eBay/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-eBay/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-eBay/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-eBay">Net-eBay CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">124842</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">new</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-eBay/Active/">Net-eBay</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
jpuruckherr [...] cyberport.de

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-22534-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-22535-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;21&nbsp;05:58:25&nbsp;2018</span>
    <span class="description">jpuruckherr [...] cyberport.de -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Error and Suggestion</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 21 Mar 2018 09:57:04 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;&#39;bug-net-ebay [...] rt.cpan.org&#39;&#34; &lt;bug-net-ebay [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Puruckherr Jens &lt;jpuruckherr [...] cyberport.de&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

we are using Net::eBay for managing our eBay sellings, which works fine.
Unfortunatly I have to copy the module local into our applications to make some modifications to the code which, are not solvable by inheritance.
It would be great if that would not be necessary in the future because these issues are solved in the module:


UTF8:
The used function utf8::upgrade does not work proper in some cases:
perldoc utf8:
&#34; ... Note that this function does not handle arbitrary encodings. Therefore Encode is recommended for the general purposes; see also Encode. ...&#34;

And indeed: using the trademark sign &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.fileformat.info/info/unicode/char/2122/index.htm&#41;">http://www.fileformat.info/info/unicode/char/2122/index.htm&#41;</a></span> results in ebay-error 20400: Invalid request encoding. Please use utf-8 encoding and eliminate any non utf-8 encoding in request
content.

Using this &#40;instead of: utf8::upgrade&#40;$x&#41;&#41;

use Encode;
my $decoded = decode&#40;&#39;utf8&#39;, $x&#41;;
my $encoded  = encode&#40;&#39;utf8&#39;, $decoded&#41;;
return $encoded;

works fine in all cases. Unfortunately I cannot overwrite the UTF8 â€“ function by inheritance â€“ the original version is used. May be my perl experience is not sufficient enough?
So, it would be fine, if you make the UTF8 â€“ function overwritable or use Encode directly.


Xml::Simple:

The module provides the ability to force given xml-nodes parsing into arrayrefs instead into hashref â€“ even the node exists only once.
This is very convenient, so you can rely in your app on an fixed response-structure from Net::eBay.

In function submitRequest:
$result = XMLin&#40; $content &#41;;

Versus:

$result = XMLin&#40; $content, ForceArray =&gt; [ &#39;Errors&#39;, &#39;OrderArray&#39;, &#39;Order&#39;, &#39;TransactionArray&#39;,&#39;Transaction&#39;, &#39;ExternalTransaction&#39;, &#39;Dispute&#39;, &#39;ProductSuggestion&#39; ] &#41;;

I can overwrite this function by inheritance. But the internal used submitRequestGetText&#40;&#41; used the UTF8-function mentioned above and we are back on start ðŸ˜Š
So it would nice, if submitRequest&#40;&#41; would accept an optional list with node names to ForceArray. So is no need to overwrite the submitRequest&#40;&#41; â€“ function.
But the UTF8-problem is not solved so.

Thanks a lot!

Jens


Here is my inheritaded class for your  interest:

package Common::Net::eBay;
use utf8;
use strict;
use warnings;
use base &#39;Net::eBay&#39;;

use XML::Simple;
use Encode;

sub submitRequest {
    my &#40;$this&#41; = @_;

    # UGLY! calling the parent works not by SUPER::submitRequestGetText
    my $content = Net::eBay::submitRequestGetText&#40; @_ &#41;;

    $this-&gt;{last_result_xml} = $content;

    $@ = &#34;&#34;;
    my $result = undef;
    eval {
        # original
        #$result = XMLin&#40; $content &#41;;

        # my version
        $result = XMLin&#40; $content, ForceArray =&gt; [ &#39;Errors&#39;, &#39;OrderArray&#39;, &#39;Order&#39;, &#39;TransactionArray&#39;,&#39;Transaction&#39;, &#39;ExternalTransaction&#39;, &#39;Dispute&#39;, &#39;ProductSuggestion&#39; ] &#41;;

        #print &#34;perl result=$result.\n&#34;;
    };

    $this-&gt;{_last_text} = $content;

    return $result if $result;

    warn &#34;Error parsing XML &#40;$@&#41;. REF&#40;content&#41; = &#34; . ref&#40; $content &#41; . &#34; CONTENT=$content\n&#34;;
    return $content;
}

# gets never used!
sub UTF8 {
    my $x = shift @_;
    return $x unless defined $x;

    #original
    #utf8::upgrade&#40;$x&#41;;
    #return $x;

    # my version
    my $decoded = decode&#40;&#39;utf8&#39;, $x&#41;;
    my $encoded  = encode&#40;&#39;utf8&#39;, $decoded&#41;;
    return $encoded;
}
1;





</div></div>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
