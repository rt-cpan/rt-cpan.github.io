<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #87352 for App-FatPacker: Erroneous handling of .packlist files</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #87352 for App-FatPacker: Erroneous handling of .packlist files</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/App-FatPacker/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/App-FatPacker/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/App-FatPacker/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/App-FatPacker/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/App-FatPacker">App-FatPacker CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">87352</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/App-FatPacker/Active/">App-FatPacker</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
MAXS [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-232270-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.009017    </td>
  </tr>
  <tr id="CF-232271-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;26&nbsp;10:22:17&nbsp;2013</span>
    <span class="description">MAXS [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Erroneous handling of .packlist files</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

I tried to pack a module that use AnyEvent. All AnyEvent modules are packed with an incorrect module path.

For example for AnyEvent.pm, it appears as &#34;mach/AnyEvent.pm&#34; on FreeBSD and &#34;i486-linux-gnu-thread-multi/AnyEvent.pm&#34; on Linux, in the %fatpacked hash.

At the compilation phase of the fatpacked resulting script, the module AnyEvent.pm is not found...

Note that the problem occurs for each module that uses .packlist file, not only AnyEvent.

The attached patch correct the problem.

I just typed &#34;fatpack pack myscript.pl&#34;, so I don&#39;t think I am misusing fatpack...

Tested on:
- FreeBSD 8.4 amd64 / perl 5.12.5
  @INC:
    /home/max/perl5/lib/perl5/amd64-freebsd
    /home/max/perl5/lib/perl5
    /usr/local/lib/perl5/5.12/BSDPAN
    /usr/local/lib/perl5/site_perl/5.12/mach &lt;- AnyEvent.pm installed here
    /usr/local/lib/perl5/site_perl/5.12
    /usr/local/lib/perl5/5.12/mach
    /usr/local/lib/perl5/5.12
- Linux debian 2.6.26-2-686 / perl 5.10.0
  @INC:
    /home/max/perl5/lib/perl5/i486-linux-gnu-thread-multi &lt;- AnyEvent.pm installed here
    /home/max/perl5/lib/perl5
    /etc/perl
    /usr/local/lib/perl/5.10.0
    /usr/local/share/perl/5.10.0
    /usr/lib/perl5
    /usr/share/perl5
    /usr/lib/perl/5.10
    /usr/share/perl/5.10
    /usr/local/lib/site_perl

Best regards,

Max.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> FatPacker.pm.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- FatPacker.pm~	2013-05-30 03:46:30.000000000 +0200
+++ FatPacker.pm	2013-07-26 15:34:33.000000000 +0200
@@ -173,8 +173,8 @@
     my $pack_base;
     PART: foreach my $p &#40;0 .. $#dir_parts&#41; {
       if &#40;$dir_parts[$p] eq &#39;auto&#39;&#41; {
-        # $p-2 since it&#39;s &lt;wanted path&gt;/$Config{archname}/auto
-        $pack_base = catpath $vol, catdir @dir_parts[0..$p-2];
+        # $p-1 since it&#39;s &lt;wanted path&gt;/$Config{archname}/auto
+        $pack_base = catpath $vol, catdir @dir_parts[0..$p-1];
         last PART;
       }
     }
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;29&nbsp;09:23:17&nbsp;2013</span>
    <span class="description">dolmen [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Le 2013-07-26 16:22:17, MAXS a écrit :
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; For example for AnyEvent.pm, it appears as &#34;mach/AnyEvent.pm&#34; on
&gt; FreeBSD and &#34;i486-linux-gnu-thread-multi/AnyEvent.pm&#34; on Linux, in the
&gt; %fatpacked hash.
&gt; 
</div>
Reproduced on Ubuntu with system perl 5.14.2.

It appears that AnyEvent is one module &#40;the only one on my @INC&#41; that, while being pure perl, still install its .pm files in $Config{archname}.
In fact it has the following in its Makefile.PL:

    PM =&gt; {
        &#39;lib/AE.pm&#39;                      =&gt; &#39;$&#40;INST_LIBDIR&#41;/AE.pm&#39;,
        &#39;lib/AnyEvent.pm&#39;                =&gt; &#39;$&#40;INST_LIBDIR&#41;/AnyEvent.pm&#39;,
        ...
        &#39;lib/AnyEvent/Util/uts46data.pl&#39; =&gt; &#39;$&#40;INST_LIBDIR&#41;/AnyEvent/Util/uts46data.pl&#39;,
        &#39;lib/AnyEvent/constants.pl&#39;      =&gt; &#39;$&#40;INST_ARCHLIBDIR&#41;/AnyEvent/constants.pl&#39;,
    },



Usually we skip any distribution installed in archlib because those distributions have XS code that can&#39;t be fully fatpacked. So AnyEvent seems to be one singular distribution that is affected by the bug.

-- 
Olivier Mengué - <span class="clickylink"><a target="new" rel="nofollow" href="http://perlresume.org/DOLMEN">http://perlresume.org/DOLMEN</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;29&nbsp;09:23:19&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;29&nbsp;10:03:52&nbsp;2013</span>
    <span class="description">dolmen [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Le 2013-07-26 16:22:17, MAXS a écrit :
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The attached patch correct the problem.
</div>
The patch only fixes the problem for modules installed in $ARCHDIR.
So in practice, only AnyEvent.
But it breaks App::FatPacker for the other more common cases.

A better universal patch is needed.

-- 
Olivier Mengué - <span class="clickylink"><a target="new" rel="nofollow" href="http://perlresume.org/DOLMEN">http://perlresume.org/DOLMEN</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;29&nbsp;10:59:03&nbsp;2013</span>
    <span class="description">ether [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #87352] Erroneous handling of .packlist files</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 29 Jul 2013 07:58:50 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Olivier Mengué via RT &lt;bug-App-FatPacker [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Karen Etheridge &lt;ether [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, Jul 29, 2013 at 09:23:19AM -0400, Olivier Mengu? via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It appears that AnyEvent is one module &#40;the only one on my @INC&#41; that, while being pure perl, still install its .pm files in $Config{archname}.
&gt; In fact it has the following in its Makefile.PL:
</div>
This sounds like a problem with AnyEvent. Why should it need to install
into $Config{archname}?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Usually we skip any distribution installed in archlib because those distributions have XS code that can&#39;t be fully fatpacked.
</div>
In the absence of any spec that says otherwise, this sounds like a
reasonable assumption.

I would suggest patching AnyEvent.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;29&nbsp;11:03:06&nbsp;2013</span>
    <span class="description">MAXS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> ether [...] cpan.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Le Lun 29 Jui 2013 10:59:03, ETHER a écrit :
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon, Jul 29, 2013 at 09:23:19AM -0400, Olivier Mengu? via RT wrote:
<div class="message-stanza open">&gt; &gt; It appears that AnyEvent is one module &#40;the only one on my @INC&#41;
&gt; &gt; that, while being pure perl, still install its .pm files in
&gt; &gt; $Config{archname}.
&gt; &gt; In fact it has the following in its Makefile.PL:
</div>&gt; 
&gt; This sounds like a problem with AnyEvent. Why should it need to
&gt; install
&gt; into $Config{archname}?
</div>
Perhaps because AnyEvent/constants.pl content depends on the achitecture?...

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt; Usually we skip any distribution installed in archlib because those
&gt; &gt; distributions have XS code that can&#39;t be fully fatpacked.
</div>&gt; 
&gt; In the absence of any spec that says otherwise, this sounds like a
&gt; reasonable assumption.
&gt; 
&gt; I would suggest patching AnyEvent.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;29&nbsp;12:45:35&nbsp;2013</span>
    <span class="description">dolmen [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Le 2013-07-29 16:03:52, DOLMEN a écrit :

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; A better universal patch is needed.
</div>
Here is the patch, committed in the RT87352-packlist-paths-abs2rel branch:
<span class="clickylink"><a target="new" rel="nofollow" href="http://git.shadowcat.co.uk/gitweb/gitweb.cgi?p=p5sagit/App-FatPacker.git;a=commitdiff;h=db59036820f26d1d9240b1ce8d469a4679fdcfaf">http://git.shadowcat.co.uk/gitweb/gitweb.cgi?p=p5sagit/App-FatPacker.git;a=commitdiff;h=db59036820f26d1d9240b1ce8d469a4679fdcfaf</a></span>


-- 
Olivier Mengué - <span class="clickylink"><a target="new" rel="nofollow" href="http://perlresume.org/DOLMEN">http://perlresume.org/DOLMEN</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;31&nbsp;15:47:43&nbsp;2013</span>
    <span class="description">rt-cpan [...] trout.me.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jul 29 12:45:35 2013, DOLMEN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Le 2013-07-29 16:03:52, DOLMEN a écrit :
&gt; 
<div class="message-stanza open">&gt; &gt; A better universal patch is needed.
</div>&gt; 
&gt; Here is the patch, committed in the RT87352-packlist-paths-abs2rel
&gt; branch:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://git.shadowcat.co.uk/gitweb/gitweb.cgi?p=p5sagit/App-">http://git.shadowcat.co.uk/gitweb/gitweb.cgi?p=p5sagit/App-</a></span>
&gt; FatPacker.git;a=commitdiff;h=db59036820f26d1d9240b1ce8d469a4679fdcfaf
</div>
It seems like that would pick up modules in arch/ in general?

We intentionally don&#39;t do that, because normally things in arch/ are perl/architecture specific, so they aren&#39;t safe to pack.

&#40;if I&#39;m missing something here, please say&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;01&nbsp;02:59:15&nbsp;2013</span>
    <span class="description">MAXS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Le Mer 31 Jui 2013 15:47:43, MSTROUT a écrit :
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon Jul 29 12:45:35 2013, DOLMEN wrote:
<div class="message-stanza open">&gt; &gt; Le 2013-07-29 16:03:52, DOLMEN a écrit :
&gt; &gt;
<div class="message-stanza open">&gt; &gt; &gt; A better universal patch is needed.
</div>&gt; &gt;
&gt; &gt; Here is the patch, committed in the RT87352-packlist-paths-abs2rel
&gt; &gt; branch:
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://git.shadowcat.co.uk/gitweb/gitweb.cgi?p=p5sagit/App-">http://git.shadowcat.co.uk/gitweb/gitweb.cgi?p=p5sagit/App-</a></span>
&gt; &gt; FatPacker.git;a=commitdiff;h=db59036820f26d1d9240b1ce8d469a4679fdcfaf
</div>&gt; 
&gt; It seems like that would pick up modules in arch/ in general?
&gt; 
&gt; We intentionally don&#39;t do that, because normally things in arch/ are
&gt; perl/architecture specific, so they aren&#39;t safe to pack.
&gt; 
&gt; &#40;if I&#39;m missing something here, please say&#41;
</div>
In fact you do. At this time, fatpack accepts to pack arch/ modules without a warning and produce a wrong packed program.

Olivier&#39;s patch corrects the packed program.

Why not emit a warning, to say that this behaviour is not supported and that the resulting fatpacked program will not be portable? Or even perhaps won&#39;t work...

But please, don&#39;t forbid the &#34;feature&#34;...

Max.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;02&nbsp;10:52:09&nbsp;2013</span>
    <span class="description">ether [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #87352] Erroneous handling of .packlist files</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 2 Aug 2013 07:51:55 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Maxime Soulé via RT &lt;bug-App-FatPacker [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Karen Etheridge &lt;ether [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, Aug 01, 2013 at 02:59:16AM -0400, Maxime Soul? via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; In fact you do. At this time, fatpack accepts to pack arch/ modules without a warning and produce a wrong packed program.
&gt; Olivier&#39;s patch corrects the packed program.
&gt; 
&gt; Why not emit a warning, to say that this behaviour is not supported and that the resulting fatpacked program will not be portable? Or even perhaps won&#39;t work...
&gt; But please, don&#39;t forbid the &#34;feature&#34;...
</div>
I&#39;d be in favour of disallowing this in normal cases &#40;i.e. die, not warn&#41;,
unless a flag was passed to indicate &#34;I do want to pack arch-specific
things, and I understand the risks&#34;. That way the normal user is protected
from doing something that probably won&#39;t work, but people who want to
create pack files targeted towards a particular architecture can still do
so.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Aug&nbsp;11&nbsp;01:02:20&nbsp;2013</span>
    <span class="description">MIYAGAWA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I had the exact same problem when fatpacking Path::Tiny on perl &lt; 5.16 because it depends on File::Spec 3.4 which is installed into archdir &#40;because the dist has XS in Cwd&#41;.

File::Spec itself is pure perl, and Cwd.pm loads fine when binary files are missing, so I ended up patching the resulted fatpack to strip the archname path.

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/miyagawa/carton/compare/6c3e161851a8...520305ad21e6#L0R52">https://github.com/miyagawa/carton/compare/6c3e161851a8...520305ad21e6#L0R52</a></span>

I know that this doesn&#39;t work for all arch-dependent modules, and should be handled case-by-case, but a flag or list of optional modules to pack would be useful.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
