<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #122925 for Net-SIP: Allow extending of StatelessProxy __forward_packet_final method</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #122925 for Net-SIP: Allow extending of StatelessProxy __forward_packet_final method</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-SIP/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-SIP/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-SIP/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-SIP/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-SIP">Net-SIP CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">122925</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-SIP/Active/">Net-SIP</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Steffen_Ullrich [...] genua.de
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
richard.carver [...] cloudmont.co.uk

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-42110-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-42111-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;30&nbsp;01:09:26&nbsp;2017</span>
    <span class="description">richard.carver [...] cloudmont.co.uk -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Allow extending of StatelessProxy __forward_packet_final method</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 29 Aug 2017 13:34:44 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Net-SIP [...] rt.cpan.org&#34; &lt;bug-Net-SIP [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Richard Carver &lt;richard.carver [...] cloudmont.co.uk&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Net::SIP::StatelessProxy doesn&#39;t call __forward_packet_final in a way that allows it to be overridden in an inherited class. The following patch makes this possible.

The reason I need this is that one side of my SIP proxy uses a URI which has multiple AAAA records for load balancing, and often my CANCEL requests are sent to a different IP address to the INVITE and are not recognised. In order to fix this I am caching the DNS results for the URI lookup on a per-call basis so that all requests for a call-id go to the same IP, but each new call does a fresh DNS lookup.  To do this I have a class that inherits from Net::SIP::StatelessProxy. It overrides __forward_packet_final to cache the result and overrides __forward_request_getdaddr to use the cached value if needed.


--- /usr/local/share/perl5/Net/SIP/StatelessProxy.pm.orig       2017-08-29 11:52:38.207617148 +0000
+++ /usr/local/share/perl5/Net/SIP/StatelessProxy.pm    2017-08-29 11:53:58.815522681 +0000
@@ -339,7 +339,7 @@
            ip_parts2string&#40;$entry-&gt;{dst_addr}[0]&#41;&#41;;
        return;
     }
-    __forward_packet_final&#40; $self,$entry &#41;;
+    $self-&gt;__forward_packet_final&#40; $entry &#41;;
}


@@ -457,7 +457,7 @@
            [ \&#38;__forward_request_2,$self,$entry ]
        &#41;;
     } else {
-       __forward_packet_final&#40;$self,$entry&#41;;
+       $self-&gt;__forward_packet_final&#40;$entry&#41;;
     }
}

@@ -483,7 +483,7 @@

     return unless @$dst_addr; # nothing could be resolved

-    __forward_packet_final&#40; $self,$entry &#41;;
+    $self-&gt;__forward_packet_final&#40; $entry &#41;;
}
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;21&nbsp;14:59:42&nbsp;2017</span>
    <span class="description">Steffen_Ullrich [...] genua.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Am Mi 30. Aug 2017, 01:09:26, richard.carver@cloudmont.co.uk schrieb:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Net::SIP::StatelessProxy doesn&#39;t call __forward_packet_final in a way
&gt; that allows it to be overridden in an inherited class. The following
&gt; patch makes this possible.
&gt; 
&gt; The reason I need this is that one side of my SIP proxy uses a URI
&gt; which has multiple AAAA records for load balancing, and often my
&gt; CANCEL requests are sent to a different IP address to the INVITE and
&gt; are not recognised. In order to fix this I am caching the DNS results
&gt; for the URI lookup on a per-call basis so that all requests for a
&gt; call-id go to the same IP, but each new call does a fresh DNS lookup.
&gt; To do this I have a class that inherits from Net::SIP::StatelessProxy.
&gt; It overrides __forward_packet_final to cache the result and overrides
&gt; __forward_request_getdaddr to use the cached value if needed.
&gt; 
</div>
I don&#39;t think this is the correct approach. The case of a multihomed client you describe should in my opinion be instead handled by adding a received and rport parameter to the Via header and then using these information to send the response back to the correct client. This last part should already be implemented and I&#39;ve tried to implement the first part &#40;adding the parameters to the Via header&#41; in branch rt122925. Could you please check if this solves the problem you have: <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/noxxi/p5-net-sip/tree/rt122925">https://github.com/noxxi/p5-net-sip/tree/rt122925</a></span>

Regards,
Steffen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;21&nbsp;14:59:42&nbsp;2017</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;21&nbsp;15:12:04&nbsp;2017</span>
    <span class="description">Steffen_Ullrich [...] genua.de -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;15&nbsp;13:13:11&nbsp;2017</span>
    <span class="description">richard.carver [...] cloudmont.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #122925] Allow extending of StatelessProxy __forward_packet_final method</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 15 Nov 2017 15:37:55 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Net-SIP [...] rt.cpan.org&#34; &lt;bug-Net-SIP [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Richard Carver &lt;richard.carver [...] cloudmont.co.uk&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sorry for the delay in responding. I think the problem you are solving may not the problem I am having, or else I have misunderstood.

This is my scenario:
A &lt;--&gt; B &#40;Net::SIP proxy&#41; &lt;--&gt; C

A is a single server. B is a single server instance of Net::SIP::StatelessProxy with my additional business logic. C is a collection of SIP proxy servers using DNS A record round-robin for load balancing. The DNS server for C returns a single A record with a 30s TTL chosen from a pool of A records that it has available. After the 30s TTL expires another lookup will be made and a different single A record will be returned. This is out of my control to influence.

A sends an INVITE to B.

B has business logic to work out where to send it, and sends it to C using a FQDN. This maps to a single IP address and is sent to that server.

A then sends a CANCEL to B. This has no Route headers and a single Via header inserted by A.

As there is no route information in this CANCEL it goes through the same business logic and is sent to C using DNS lookup. If the 30s TTL has expired then this DNS lookup will return a different IP address and the CANCEL will be sent to a different server that has no knowledge of the dialog.

For BYE there would be Route headers and this would not be an issue - it&#39;s just the CANCEL scenario where I need to cache the DNS lookup.

Regards,
    Richard Carver

Cloudmont Limited
Tel: 033 0001 0436
Mob: +44 &#40;0&#41; 7803 005932
Email/Skype for Business: Richard.Carver@cloudmont.co.uk

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Steffen Ullrich via RT [mailto:bug-Net-SIP@rt.cpan.org] 
Sent: 21 October 2017 20:00
To: Richard Carver &lt;richard.carver@cloudmont.co.uk&gt;
Subject: [rt.cpan.org #122925] Allow extending of StatelessProxy __forward_packet_final method

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=122925">https://rt.cpan.org/Ticket/Display.html?id=122925</a></span> &gt;

Am Mi 30. Aug 2017, 01:09:26, richard.carver@cloudmont.co.uk schrieb:
<div class="message-stanza open">&gt; Net::SIP::StatelessProxy doesn&#39;t call __forward_packet_final in a way 
&gt; that allows it to be overridden in an inherited class. The following 
&gt; patch makes this possible.
&gt; 
&gt; The reason I need this is that one side of my SIP proxy uses a URI 
&gt; which has multiple AAAA records for load balancing, and often my 
&gt; CANCEL requests are sent to a different IP address to the INVITE and 
&gt; are not recognised. In order to fix this I am caching the DNS results 
&gt; for the URI lookup on a per-call basis so that all requests for a 
&gt; call-id go to the same IP, but each new call does a fresh DNS lookup.
&gt; To do this I have a class that inherits from Net::SIP::StatelessProxy.
&gt; It overrides __forward_packet_final to cache the result and overrides 
&gt; __forward_request_getdaddr to use the cached value if needed.
&gt; 
</div>
I don&#39;t think this is the correct approach. The case of a multihomed client you describe should in my opinion be instead handled by adding a received and rport parameter to the Via header and then using these information to send the response back to the correct client. This last part should already be implemented and I&#39;ve tried to implement the first part &#40;adding the parameters to the Via header&#41; in branch rt122925. Could you please check if this solves the problem you have: <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/noxxi/p5-net-sip/tree/rt122925">https://github.com/noxxi/p5-net-sip/tree/rt122925</a></span>

Regards,
Steffen
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;22&nbsp;03:07:56&nbsp;2017</span>
    <span class="description">Steffen_Ullrich [...] genua.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Am Mi 15. Nov 2017, 13:13:11, richard.carver@cloudmont.co.uk schrieb:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Sorry for the delay in responding. I think the problem you are solving
&gt; may not the problem I am having, or else I have misunderstood.
&gt; ...
</div>
Now I think I&#39;ve understood the problem.

I&#39;m still not really comfortable with this path because it let other rely on the specific behavior of an internal function &#40;i.e. no official API&#41;. Still, I&#39;ve made the change in commit 22b9728f. But be aware that this is still no official API you are using so the chance is higher that things will inadvertently break in the future.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;22&nbsp;03:07:56&nbsp;2017</span>
    <span class="description">Steffen_Ullrich [...] genua.de -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;22&nbsp;03:25:32&nbsp;2017</span>
    <span class="description">richard.carver [...] cloudmont.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #122925] Allow extending of StatelessProxy __forward_packet_final method</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 22 Nov 2017 08:24:59 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Net-SIP [...] rt.cpan.org&#34; &lt;bug-Net-SIP [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Richard Carver &lt;richard.carver [...] cloudmont.co.uk&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I agree that it is risky extending an internal function like this.

Net::SIP:: Dispatcher supports providing an alternative resolver - what do you think about updating Net::SIP:: Dispatcher to pass the call-id or packet or some other identifying information into the resolver so I could implement this per-call cache there?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Steffen Ullrich via RT [mailto:bug-Net-SIP@rt.cpan.org] 
Sent: 22 November 2017 08:08
To: Richard Carver &lt;richard.carver@cloudmont.co.uk&gt;
Subject: [rt.cpan.org #122925] Allow extending of StatelessProxy __forward_packet_final method

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=122925">https://rt.cpan.org/Ticket/Display.html?id=122925</a></span> &gt;

Am Mi 15. Nov 2017, 13:13:11, richard.carver@cloudmont.co.uk schrieb:
<div class="message-stanza open">&gt; Sorry for the delay in responding. I think the problem you are solving 
&gt; may not the problem I am having, or else I have misunderstood.
&gt; ...
</div>
Now I think I&#39;ve understood the problem.

I&#39;m still not really comfortable with this path because it let other rely on the specific behavior of an internal function &#40;i.e. no official API&#41;. Still, I&#39;ve made the change in commit 22b9728f. But be aware that this is still no official API you are using so the chance is higher that things will inadvertently break in the future.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;05&nbsp;06:04:55&nbsp;2018</span>
    <span class="description">Steffen_Ullrich [...] genua.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Am Mi 22. Nov 2017, 03:25:32, richard.carver@cloudmont.co.uk schrieb:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I agree that it is risky extending an internal function like this.
&gt; 
&gt; Net::SIP:: Dispatcher supports providing an alternative resolver -
&gt; what do you think about updating Net::SIP:: Dispatcher to pass the
&gt; call-id or packet or some other identifying information into the
&gt; resolver so I could implement this per-call cache there?
</div>

While this might work I think this is just another hack specifically for your use case.
I think the main problem is that you are trying to use StatelessProxy in some stateful
way, i.e. against the explicit stateless design.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
