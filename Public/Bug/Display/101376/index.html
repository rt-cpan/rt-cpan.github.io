<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #101376 for Library-CallNumber-LC: LC Callnumber normalization for sorting incorrect</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #101376 for Library-CallNumber-LC: LC Callnumber normalization for sorting incorrect</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Library-CallNumber-LC/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Library-CallNumber-LC/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Library-CallNumber-LC/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Library-CallNumber-LC/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Library-CallNumber-LC">Library-CallNumber-LC CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">101376</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Library-CallNumber-LC/Active/">Library-CallNumber-LC</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
kyle [...] bywatersolutions.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-234360-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-234361-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;07&nbsp;10:22:51&nbsp;2015</span>
    <span class="description">kyle [...] bywatersolutions.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> dbw2 [...] calvin.edu</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> LC Callnumber normalization for sorting incorrect</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 7 Jan 2015 10:22:42 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Library-CallNumber-LC [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kyle Hall &lt;kyle [...] bywatersolutions.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">It appears that LC Callnumber sort normalization is not quite correct.

The issue is that cutter numbers are sorted decimally, and as such we need
to pad out the numbers with 0&#39;s to make them sort correctly.

For example: take this two callnumbers that have been normalized:

PS3561.I4 A3 =&gt; PS3561 I4 A3 PS3561.I48 O5 =&gt; PS3561 I48 O5
These will sort incorrectly, as the second callnumber will be first for an
alphanumeric sort, but should be last when sorted by LCC rules.

They should be: PS3561.I4 A3 =&gt; PS3561 I40 A3 PS3561.I48 O5 =&gt; PS3561 I48 O5
in order to preserve the correct sort order. In fact, we will need to pad
out both cutters since they are actually decimal numbers &#40; .4 and .48
respectively &#41;. Is there any reasonable limit to the length of a cutter
number? That is, what&#39;s the longest one you&#39;ve seen ever? Here&#39;s the same
callnumbers with the cutters padded to 10 digits: PS3561.I4 A3 =&gt; PS3561
I4000000000 A3 PS3561.I48 O5 =&gt; PS3561 I4800000000 O5

I cannot imagine anything going beyond 10 digits.

The following diff fixes the issue &#40; I believe &#41;:

--- /usr/local/share/perl/5.10.1/Library/CallNumber/LC.pm 2015-01-07
10:21:20.000000000 -0500
+++ /usr/local/share/perl/5.10.1/Library/CallNumber/LC.pm.new 2015-01-07
10:21:06.000000000 -0500
@@ -275,6 +275,11 @@

   my &#40;$alpha, $num, $dec, $othernum, $c1dec, $c1alpha, $c1num, $c2alpha,
$c2num, $c3alpha, $c3num, $extra&#41; = &#40;$1, $2, $3, $4, $5, $6, $7, $8, $9,
$10, $11, $12&#41;;

+  # cutter numbers are decimal sorted, pad out to 10 digits
+  $c1num .= &#39;0&#39; x &#40; 10 - length $c1num &#41; if $c1num;
+  $c2num .= &#39;0&#39; x &#40; 10 - length $c2num &#41; if $c2num;
+  $c3num .= &#39;0&#39; x &#40; 10 - length $c3num &#41; if $c3num;
+
   no warnings;
   my $class = $alpha;
   $class .= sprintf&#40;&#39;%04s&#39;, $num&#41; if $num;
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;07&nbsp;11:35:44&nbsp;2015</span>
    <span class="description">DBWELLS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello Kyle,

Thanks for the bug report.  The sort keys are designed to sort using standard ascii rules, and if you try it, you will see that the current generated keys actually sort fine, as the &#34;space&#34; comes before the &#34;8&#34;:

PS3561 I4 A3
PS3561 I48 O5

The module design takes advantage of the fact that, when sorting, &#34;the first difference is all that matters&#34;.  Each component of the sort key is separated by a space, and in an ascii sort, the space will come before any letter or number.  For this reason, there is never a reason to right-pad decimal numbers, because once you hit a space in the string comparison, that is equivalent to an infinite number of zeros &#40;for sorting purposes&#41;, as it always goes to the top.

If for some strange reason you are on a system which doesn&#39;t treat spaces as &#34;less than&#34; letters and numbers, the module let&#39;s you set a different global &#34;$topper&#34; variable which will be then used to separate the call number components.

Hope this helps,
Dan

On Wed Jan 07 10:22:51 2015, kyle@bywatersolutions.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It appears that LC Callnumber sort normalization is not quite correct.
&gt; 
&gt; The issue is that cutter numbers are sorted decimally, and as such we need
&gt; to pad out the numbers with 0&#39;s to make them sort correctly.
&gt; 
&gt; For example: take this two callnumbers that have been normalized:
&gt; 
&gt; PS3561.I4 A3 =&gt; PS3561 I4 A3 PS3561.I48 O5 =&gt; PS3561 I48 O5
&gt; These will sort incorrectly, as the second callnumber will be first for an
&gt; alphanumeric sort, but should be last when sorted by LCC rules.
&gt; 
&gt; They should be: PS3561.I4 A3 =&gt; PS3561 I40 A3 PS3561.I48 O5 =&gt; PS3561 I48 O5
&gt; in order to preserve the correct sort order. In fact, we will need to pad
&gt; out both cutters since they are actually decimal numbers &#40; .4 and .48
&gt; respectively &#41;. Is there any reasonable limit to the length of a cutter
&gt; number? That is, what&#39;s the longest one you&#39;ve seen ever? Here&#39;s the same
&gt; callnumbers with the cutters padded to 10 digits: PS3561.I4 A3 =&gt; PS3561
&gt; I4000000000 A3 PS3561.I48 O5 =&gt; PS3561 I4800000000 O5
&gt; 
&gt; I cannot imagine anything going beyond 10 digits.
&gt; 
&gt; The following diff fixes the issue &#40; I believe &#41;:
&gt; 
&gt; --- /usr/local/share/perl/5.10.1/Library/CallNumber/LC.pm 2015-01-07
&gt; 10:21:20.000000000 -0500
&gt; +++ /usr/local/share/perl/5.10.1/Library/CallNumber/LC.pm.new 2015-01-07
&gt; 10:21:06.000000000 -0500
&gt; @@ -275,6 +275,11 @@
&gt; 
&gt;    my &#40;$alpha, $num, $dec, $othernum, $c1dec, $c1alpha, $c1num, $c2alpha,
&gt; $c2num, $c3alpha, $c3num, $extra&#41; = &#40;$1, $2, $3, $4, $5, $6, $7, $8, $9,
&gt; $10, $11, $12&#41;;
&gt; 
&gt; +  # cutter numbers are decimal sorted, pad out to 10 digits
&gt; +  $c1num .= &#39;0&#39; x &#40; 10 - length $c1num &#41; if $c1num;
&gt; +  $c2num .= &#39;0&#39; x &#40; 10 - length $c2num &#41; if $c2num;
&gt; +  $c3num .= &#39;0&#39; x &#40; 10 - length $c3num &#41; if $c3num;
&gt; +
&gt;    no warnings;
&gt;    my $class = $alpha;
&gt;    $class .= sprintf&#40;&#39;%04s&#39;, $num&#41; if $num;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;07&nbsp;11:35:44&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;07&nbsp;11:35:50&nbsp;2015</span>
    <span class="description">DBWELLS [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
