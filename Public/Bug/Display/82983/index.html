<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #82983 for Mail-Box: Failed to open IMAP4 folder using Mail::Box::Manager: Couldn&#39;t select IMAP4 folder</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #82983 for Mail-Box: Failed to open IMAP4 folder using Mail::Box::Manager: Couldn&#39;t select IMAP4 folder</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Mail-Box">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Mail-Box">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Mail-Box">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Mail-Box">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Mail-Box">Mail-Box CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">82983</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Mail-Box">Mail-Box</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
rotkraut [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-19874-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.107    </td>
  </tr>
  <tr id="CF-19875-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
2.118    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




Mail-Box-IMAP-folder.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1174657/619530/Mail-Box-IMAP-folder.patch">
Sun Jan 27 09:42:15 2013 (483b) by rotkraut [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=82983">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1174657" href="/Public/Bug/Display.html?id=82983#txn-1174657">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;27&nbsp;09:42:15&nbsp;2013</span>
    <span class="description">rotkraut [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Failed to open IMAP4 folder using Mail::Box::Manager: Couldn&#39;t
 select IMAP4 folder</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1174657/619529/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/619529">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Problem describtion
===================

I can successfully open an IMAP4 folder, using Mail::Box::IMAP4 directly
in the following way:

  use Mail::Box::IMAP4;

  my $imaphost = &#39;mail.example.org&#39;;
  my $imapuser = &#39;USER&#39;;
  my $imappass = &#39;PASS&#39;;
  my $mailbox = &#39;INBOX&#39;;

  my $folder= new Mail::Box::IMAP4&#40;server_name =&gt; $imaphost, 
                                   username =&gt; $imapuser, 
                                   password =&gt; $imappass, 
                                   folder =&gt; $mailbox&#41;;
  print $folder-&gt;nrMessages, &#34; messages\n&#34;;

But when I try to use Mail::Box::Manager instead, the following code
fails:

  use Mail::Box::Manager;

  my $imaphost = &#39;mail.example.org&#39;;
  my $imapuser = &#39;USER&#39;;
  my $imappass = &#39;PASS&#39;;
  my $mailbox = &#39;INBOX&#39;;

  my $url = &#34;imap4://$imapuser:$imappass\@$imaphost/$mailbox&#34;;

  my $mgr = Mail::Box::Manager-&gt;new;
  my $folder = $mgr-&gt;open&#40;folder =&gt; $url&#41;;
  print $folder-&gt;nrMessages, &#34; messages\n&#34;;

I get the following error message:

  ERROR: Couldn&#39;t select IMAP4 folder imap4://USER@mail.example.org:143
  ERROR: Couldn&#39;t select IMAP4 folder imap4://USER@mail.example.org:143
  WARNING: Folder does not exist, failed opening imap4 folder
imap4://USER@mail.example.org:143.


Analysis
========

The problem seem to be caused by the differences in the semantic of
the &#39;folder&#39; argument between Mail::Box::Manager and Mail::Box::IMAP4.
In Mail::Box::Manager assumes the &#34;folder&#34; argument to be the url,
while Mail::Box::IMAP4 assumes the folder to be just the IMAP4 mailbox
part, &#34;/INBOX&#34; in this example.

Digging through the code, I see that Mail::Box::Manager correctly
decodes the folder url in sub open in line 141:

        my %decoded = $self-&gt;decodeFolderURL&#40;$name&#41;;
        if&#40;keys %decoded&#41;
        {   # accept decoded info
            @args{keys %decoded} = values %decoded;
        }

which results in

  %args = &#40;
    authentication =&gt; &#39;AUTO&#39;,
    folder =&gt; &#39;/INBOX&#39;
    password =&gt; &#39;PASS&#39;,
    server_name =&gt; &#39;mail.example.org&#39;,
    server_port =&gt; undef,
    type =&gt; &#39;imap4&#39;,
    username =&gt; &#39;USER&#39;,
  &#41;;

This is just fine and could perfectly be passed to Mail::Box::IMAP4
this way.  But then, Mail::Box::Manager overwrites the folder in line
174:

    elsif&#40;$type eq &#39;imap4&#39;&#41;
    {   my $un   = $args{username}    ||= $ENV{USER} || $ENV{LOGIN};
        my $srv  = $args{server_name} ||= &#39;localhost&#39;;
        my $port = $args{server_port} ||= 143;
        $args{folder} = $name = &#34;imap4://$un\@$srv:$port&#34;;
    }

This is just plain wrong.  As a consequence, Mail::Box::IMAP4-&gt;new
gets called with the following arguments:

  %args = &#40;
    access =&gt; &#39;r&#39;,
    authentication =&gt; &#39;AUTO&#39;,
    folder =&gt; &#39;imap4://USER@mail.example.org:143&#39;,
    folderdir =&gt; &#39;.&#39;,
    manager =&gt; Mail::Box::Manager=HASH&#40;0x1409580&#41;,
    password =&gt; &#39;PASS&#39;,
    server_name =&gt; &#39;mail.example.org&#39;,
    server_port =&gt; 143,
    type =&gt; &#39;imap4&#39;,
    username =&gt; &#39;USER&#39;,
  &#41;;

which obviously leads to the above-mentioned error.


Fix
===

Do not overwrite the folder in Mail::Box::Manager, see attached patch.
After applying the patch, opening an IMAP4 folder using
Mail::Box::Manager with the example code above works fine for me.

Note: the code code for POP3 in Mail::Box::Manager looks similar and
might contain the same error.  But I do not have access to any POP3
server, so I can&#39;t try this out.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Mail-Box-IMAP-folder.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1174657/619530/Mail-Box-IMAP-folder.patch">Download Mail-Box-IMAP-folder.patch</a><br />
<span class="downloadcontenttype">text/x-diff 483b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- lib/Mail/Box/Manager.pm.orig	2012-11-28 12:28:35.000000000 +0100
+++ lib/Mail/Box/Manager.pm	2013-01-27 15:26:51.312252501 +0100
@@ -171,7 +171,7 @@
     {   my $un   = $args{username}    ||= $ENV{USER} || $ENV{LOGIN};
         my $srv  = $args{server_name} ||= &#39;localhost&#39;;
         my $port = $args{server_port} ||= 143;
-        $args{folder} = $name = &#34;imap4://$un\@$srv:$port&#34;;
+        $name = &#34;imap4://$un\@$srv:$port&#34;;
     }
 
     unless&#40;defined $name &#38;&#38; length $name&#41;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1175022" href="/Public/Bug/Display.html?id=82983#txn-1175022">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;28&nbsp;05:15:31&nbsp;2013</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #82983] Failed to open IMAP4 folder using Mail::Box::Manager: Couldn&#39;t  select IMAP4 folder</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 28 Jan 2013 11:15:10 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Rolf Krahl via RT &lt;bug-Mail-Box [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1175022/619739/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/619739">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Rolf Krahl via RT &#40;bug-Mail-Box@rt.cpan.org&#41; [130127 14:42]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Sun Jan 27 09:42:15 2013: Request 82983 was acted upon.
&gt; Transaction: Ticket created by ROTKRAUT
&gt;      Subject: Failed to open IMAP4 folder using Mail::Box::Manager: Couldn&#39;t
&gt;  select IMAP4 folder
</div>   ...

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This is just fine and could perfectly be passed to Mail::Box::IMAP4
&gt; this way.  But then, Mail::Box::Manager overwrites the folder in line
&gt; 174:
&gt; 
&gt;     elsif&#40;$type eq &#39;imap4&#39;&#41;
&gt;     {   my $un   = $args{username}    ||= $ENV{USER} || $ENV{LOGIN};
&gt;         my $srv  = $args{server_name} ||= &#39;localhost&#39;;
&gt;         my $port = $args{server_port} ||= 143;
&gt;         $args{folder} = $name = &#34;imap4://$un\@$srv:$port&#34;;
&gt;     }
&gt; 
&gt; This is just plain wrong.  As a consequence, Mail::Box::IMAP4-&gt;new
&gt; gets called with the following arguments:
</div>
Isn&#39;t the only problem that the password is not included in the
new folder url?

We cannot leave the original &#34;folder&#34; parameter in-tact, because that
may not exist and may need some defaults added.  The latter to be able
to reduce the risk that the same folder gets opened twice with nearly
the same name.  The folder option is designed to be more flexible.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; --- lib/Mail/Box/Manager.pm.orig      2012-11-28 12:28:35.000000000 +0100
&gt; +++ lib/Mail/Box/Manager.pm   2013-01-27 15:26:51.312252501 +0100
&gt; -        $args{folder} = $name = &#34;imap4://$un\@$srv:$port&#34;;
&gt; +        $name = &#34;imap4://$un\@$srv:$port&#34;;
&gt;      }
</div>
Not applied &#40;yet&#41;
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1175025" href="/Public/Bug/Display.html?id=82983#txn-1175025">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;28&nbsp;05:15:35&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1175102" href="/Public/Bug/Display.html?id=82983#txn-1175102">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;28&nbsp;09:29:17&nbsp;2013</span>
    <span class="description">rotkraut [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #82983] Failed to open IMAP4 folder using Mail::Box::Manager: Couldn&#39;t  select IMAP4 folder</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 28 Jan 2013 15:28:47 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Mail-Box [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Rolf Krahl &lt;rotkraut [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1175102/619789/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/619789">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Am Montag, 28. Januar 2013, 05:15:32 schrieben Sie:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; * Rolf Krahl via RT &#40;bug-Mail-Box@rt.cpan.org&#41; [130127 14:42]:
&gt; 
<div class="message-stanza open">&gt; &gt; This is just fine and could perfectly be passed to Mail::Box::IMAP4
&gt; &gt; this way.  But then, Mail::Box::Manager overwrites the folder in line
&gt; &gt; 174:
&gt; &gt; 
&gt; &gt;     elsif&#40;$type eq &#39;imap4&#39;&#41;
&gt; &gt;     {   my $un   = $args{username}    ||= $ENV{USER} || $ENV{LOGIN};
&gt; &gt;         my $srv  = $args{server_name} ||= &#39;localhost&#39;;
&gt; &gt;         my $port = $args{server_port} ||= 143;
&gt; &gt;         $args{folder} = $name = &#34;imap4://$un\@$srv:$port&#34;;
&gt; &gt;     }
&gt; &gt; 
&gt; &gt; This is just plain wrong.  As a consequence, Mail::Box::IMAP4-&gt;new
&gt; &gt; gets called with the following arguments:
</div>&gt; 
&gt; Isn&#39;t the only problem that the password is not included in the
&gt; new folder url?
</div>
No, the problem is that Mail::Box::Manager and Mail::Box::IMAP4 are
incompatible with respect to the meaning of the folder argument in
their respective methods open and new.

Just to make terms and definitions clear, lets assume the following
settings:

  my $imaphost = &#39;mail.example.org&#39;;
  my $imapuser = &#39;USER&#39;;
  my $imappass = &#39;PASS&#39;;
  my $mailbox = &#39;INBOX&#39;; 

  my $url = &#34;imap4://$imapuser:$imappass\@$imaphost/$mailbox&#34;; 

Mail::Box::Manager-&gt;open may be called in different ways, but in
general, a folder is the full folder url in terms of
Mail::Box::Manager.


Mail::Box::IMAP4-&gt;new is not able to deal with folder urls at all.  It
must be called with all the components in separate arguments, in this
way:

  Mail::Box::IMAP4-&gt;new&#40;server_name =&gt; $imaphost,
                        username =&gt; $imapuser,
                        password =&gt; $imappass,
                        folder =&gt; $mailbox&#41;;

In particular, in Mail::Box::IMAP4, the folder is always the mailbox
name, $mailbox at the IMAP server.


At this point of the code, the password is present in $args{password}.
In fact, the example script logs in succesfully to the IMAP server.
But then it tries to open a mailbox by the name
&#34;imap4://USER@mail.example.org:143&#34;, which obviously does not exist at
the IMAP server and that&#39;s the point, the script fails.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; We cannot leave the original &#34;folder&#34; parameter in-tact, because that
&gt; may not exist and may need some defaults added.
</div>
At this point in the code, the &#34;folder&#34; parameter does not contain the
original argument from the call to $mgr-&gt;open any more.  It has
already been processed, all defaults are already applied, and the
&#34;folder&#34; parameter, as well as the other components in %args are the
result of the call to decodeFolderURL in line 141.  This decoding of
the url already split up all components in their respective fields,
just the way it need to be set up in order to call
Mail::Box::IMAP4-&gt;new.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1756415" href="/Public/Bug/Display.html?id=82983#txn-1756415">#</a>      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;08&nbsp;05:39:28&nbsp;2017</span>
    <span class="description">MARKOV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1756415/945081/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/945081">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 16b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Resolved in 2015
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1756417" href="/Public/Bug/Display.html?id=82983#txn-1756417">#</a>      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;08&nbsp;05:39:28&nbsp;2017</span>
    <span class="description">MARKOV [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1756419" href="/Public/Bug/Display.html?id=82983#txn-1756419">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;08&nbsp;05:39:28&nbsp;2017</span>
    <span class="description">MARKOV [...] cpan.org -  Fixed in 2.118 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.417857</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
