<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #44455 for CPAN: CPAN requirement on File::HomeDir on OSX breaks 64-bit perl</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #44455 for CPAN: CPAN requirement on File::HomeDir on OSX breaks 64-bit perl</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/CPAN/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/CPAN/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/CPAN/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/CPAN/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/CPAN">CPAN CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">44455</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/CPAN/Active/">CPAN</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
TJENNESS [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-8164-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-8165-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;20&nbsp;20:14:17&nbsp;2009</span>
    <span class="description">TJENNESS [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> CPAN requirement on File::HomeDir on OSX breaks 64-bit perl</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">CPAN now has a build dependency on File::HomeDir when using a darwin/OSX system. This is 
fine on 32-bit perl but if you are unlucky enough to be using a 64-bit perl on OSX &#40;which is a 
trivial thing to do&#41; you can now no longer update CPAN using the CPAN shell because 
File::HomeDir does not pass its tests on 64-bit &#40;see RT #43549&#41;. The reason for this is that it 
uses Mac::Files to locate files and that uses Mac::Carbon which has no 64-bit implementation 
&#40;RT #43551&#41;.

The real fix is for an implementation of Mac::Files to exist that is based on Cocoa. The next layer 
of fix is to fix File::HomeDir so that it will at least skip some of the tests if it is on 64-bit.  The 
final hack is to make CPAN work the old way if it sees that it&#39;s got a 64-bit perl on darwin.

Note that most people have not noticed yet because perl5.10 does not have the correct 
configure switches in place to let the -Duse64bitall option work. Back porting the patch from 
blead fixes it so I assume that this will become a bit of an issue when 5.10.1 comes out.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;21&nbsp;01:32:21&nbsp;2009</span>
    <span class="description">ANDK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">And does CPAN.pm work sufficiently well on such a 64bit system without
File::HomeDir? Or what breaks if you force install it and simply use it?
I mean, can we get away with simply dropping the dependency or do we
need code changes too?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;21&nbsp;01:32:22&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;21&nbsp;02:26:04&nbsp;2009</span>
    <span class="description">TJENNESS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #44455] CPAN requirement on File::HomeDir on OSX  breaks 64-bit perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 20 Mar 2009 20:25:47 -1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CPAN [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Tim Jenness &lt;tjenness [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The CPAN module works fine in bleadperl, and it&#39;s only when trying to update
CPAN itself from the CPAN shell that things go wrong. It&#39;s close enough to a
normal BSD system that things will work and you&#39;ll just get complaints about
the same things that people were complaining about that resulted in
File::HomeDir being used in the first place.

So removing the dependency on File::HomeDir will probably be fine. I&#39;d be
happy if the dependency was only dropped when you knew you had 64-bit
pointers as well as darwin.

Tim

On Fri, Mar 20, 2009 at 7:32 PM, Andreas Koenig via RT &lt;bug-CPAN@rt.cpan.org
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; wrote:
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=44455">https://rt.cpan.org/Ticket/Display.html?id=44455</a></span> &gt;
&gt;
&gt; And does CPAN.pm work sufficiently well on such a 64bit system without
&gt; File::HomeDir? Or what breaks if you force install it and simply use it?
&gt; I mean, can we get away with simply dropping the dependency or do we
&gt; need code changes too?
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;22&nbsp;08:35:37&nbsp;2009</span>
    <span class="description">dagolden [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #44455] CPAN requirement on File::HomeDir on OSX  breaks 64-bit perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 22 Mar 2009 08:35:22 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CPAN [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> David Golden &lt;dagolden [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat, Mar 21, 2009 at 2:26 AM, TJENNESS via RT &lt;bug-CPAN@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So removing the dependency on File::HomeDir will probably be fine. I&#39;d be
&gt; happy if the dependency was only dropped when you knew you had 64-bit
&gt; pointers as well as darwin.
</div>
I&#39;d rather try to fix this upstream -- at least in File-HomeDir --
than make yet another change to how CPAN.pm handles home directory
detection.  File-HomeDir is in Alias&#39; open repo, so I just patched it
to fall back to Unix mode.

Tim -- can you check out this SVN repo and tell me if it passes tests?
 &#40;I don&#39;t have Darwin available to test.&#41;

<span class="clickylink"><a target="new" rel="nofollow" href="http://svn.ali.as/cpan/trunk/File-HomeDir/">http://svn.ali.as/cpan/trunk/File-HomeDir/</a></span>

-- David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;23&nbsp;17:14:51&nbsp;2009</span>
    <span class="description">tim.jenness [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #44455] CPAN requirement on File::HomeDir on OSX  breaks 64-bit perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 23 Mar 2009 09:43:21 -1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CPAN [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;tim.jenness&#34; &lt;tim.jenness [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On Mar 22, 2009, at 2:35 AM, David Golden via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://svn.ali.as/cpan/trunk/File-HomeDir/">http://svn.ali.as/cpan/trunk/File-HomeDir/</a></span>
</div>

I&#39;m clearly being a bit stupid since the Makefile.PL file in that  
checkout doesn&#39;t work in the normal way. Regardless, this line in  
Makefile.PL:

} elsif &#40; $^O eq &#39;darwin&#39; &#41; {
        requires &#39;Mac::Carbon&#39; =&gt; &#39;0.77&#39;;
        requires &#39;Mac::Files&#39;  =&gt; &#39;1.09&#39;;

will cause trouble before we even get to the point of running the  
module. That dependency will force Mac::Carbon to be installed from  
the CPAN shell which will cause an install failure on 64-bit.

PS I reported this problem for the CPAN distribution since I wasn&#39;t  
sure whether anyone had noticed my earlier report on File::HomeDir  
&#40;I&#39;m guilty of ignoring bug reports as well&#41; and it really was an  
issue with cpan in the short term.

-- 
Tim Jenness
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;23&nbsp;18:39:59&nbsp;2009</span>
    <span class="description">dagolden [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #44455] CPAN requirement on File::HomeDir on OSX  breaks 64-bit perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 23 Mar 2009 18:33:06 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CPAN [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> David Golden &lt;dagolden [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, Mar 23, 2009 at 5:14 PM, tim.jenness via RT
&lt;bug-CPAN@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m clearly being a bit stupid since the Makefile.PL file in that
&gt; checkout doesn&#39;t work in the normal way. Regardless, this line in
&gt; Makefile.PL:
</div>
You just need to install Module::Install and then it&#39;ll work more or
less like normal.  &#40;Welcome to the Borg.  You will be assimilated.&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; PS I reported this problem for the CPAN distribution since I wasn&#39;t
&gt; sure whether anyone had noticed my earlier report on File::HomeDir
&gt; &#40;I&#39;m guilty of ignoring bug reports as well&#41; and it really was an
&gt; issue with cpan in the short term.
</div>
No problem.  Generally, for anything in the ali.as repo, my approach
is to patch first, then nudge Adam to do a release.  ;-&#41;  &#40;If you
don&#39;t have a commit bit there, just email him with your CPAN id and
ask.  He hands them out like candy.&#41;

-- David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;23&nbsp;21:29:43&nbsp;2009</span>
    <span class="description">tim.jenness [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #44455] CPAN requirement on File::HomeDir on OSX  breaks 64-bit perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 23 Mar 2009 15:29:26 -1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CPAN [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;tim.jenness&#34; &lt;tim.jenness [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On Mar 23, 2009, at 12:39 PM, David Golden via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=44455">http://rt.cpan.org/Ticket/Display.html?id=44455</a></span> &gt;
&gt;
&gt; On Mon, Mar 23, 2009 at 5:14 PM, tim.jenness via RT
&gt; &lt;bug-CPAN@rt.cpan.org&gt; wrote:
<div class="message-stanza open">&gt;&gt; I&#39;m clearly being a bit stupid since the Makefile.PL file in that
&gt;&gt; checkout doesn&#39;t work in the normal way. Regardless, this line in
&gt;&gt; Makefile.PL:
</div>&gt;
&gt; You just need to install Module::Install and then it&#39;ll work more or
&gt; less like normal.  &#40;Welcome to the Borg.  You will be assimilated.&#41;
&gt;
</div>
--- lib/File/HomeDir.pm &#40;revision 5739&#41;
+++ lib/File/HomeDir.pm &#40;working copy&#41;
@@ -5,7 +5,7 @@
  use 5.00503;
  use strict;
  use Carp       &#40;&#41;;
-use Config     &#40;&#41;;
+use Config;
  use File::Spec &#40;&#41;;

  # Globals

Otherwise %Config is not imported.

That and the fix to PREREQ_PM passes all tests.

Although this line:

t/11_darwin.t ... skipped: Not running on Darwin

is amusing. Maybe that should say &#34;Not running on 32-bit Darwin&#34; or  
something.

-- 
Tim Jenness
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;23&nbsp;21:36:36&nbsp;2009</span>
    <span class="description">dagolden [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #44455] CPAN requirement on File::HomeDir on OSX  breaks 64-bit perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 23 Mar 2009 21:36:21 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CPAN [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> David Golden &lt;dagolden [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, Mar 23, 2009 at 9:29 PM, tim.jenness via RT
&lt;bug-CPAN@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; -use Config     &#40;&#41;;
&gt; +use Config;
</div>
I went the other way and did $Config::Config{...} to keep the package
namespace clean.  Also committed the other changes you suggested.

Please check the latest trunk.  If that works, then we can ask Adam to
put out a dev release.

-- David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;23&nbsp;21:44:27&nbsp;2009</span>
    <span class="description">tim.jenness [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #44455] CPAN requirement on File::HomeDir on OSX  breaks 64-bit perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 23 Mar 2009 15:44:09 -1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CPAN [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;tim.jenness&#34; &lt;tim.jenness [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
Works for me. Thanks.

On Mar 23, 2009, at 3:36 PM, David Golden via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=44455">https://rt.cpan.org/Ticket/Display.html?id=44455</a></span> &gt;
&gt;
&gt; On Mon, Mar 23, 2009 at 9:29 PM, tim.jenness via RT
&gt; &lt;bug-CPAN@rt.cpan.org&gt; wrote:
<div class="message-stanza open">&gt;&gt; -use Config     &#40;&#41;;
&gt;&gt; +use Config;
</div>&gt;
&gt; I went the other way and did $Config::Config{...} to keep the package
&gt; namespace clean.  Also committed the other changes you suggested.
&gt;
&gt; Please check the latest trunk.  If that works, then we can ask Adam to
&gt; put out a dev release.
&gt;
&gt; -- David
&gt;
</div>
-- 
Tim Jenness
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;13&nbsp;15:51:13&nbsp;2009</span>
    <span class="description">ANDK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">1.93_52 released, ticket look like resolved. Please re-open if something
is missing. Thanks!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;13&nbsp;15:51:15&nbsp;2009</span>
    <span class="description">ANDK [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;23&nbsp;10:53:13&nbsp;2009</span>
    <span class="description">jjnapiork [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Mar 20 20:14:17 2009, TJENNESS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; CPAN now has a build dependency on File::HomeDir when using a
&gt; darwin/OSX system. This is
&gt; fine on 32-bit perl but if you are unlucky enough to be using a 64-bit
&gt; perl on OSX &#40;which is a
&gt; trivial thing to do&#41; you can now no longer update CPAN using the CPAN
&gt; shell because
&gt; File::HomeDir does not pass its tests on 64-bit &#40;see RT #43549&#41;. The
&gt; reason for this is that it
&gt; uses Mac::Files to locate files and that uses Mac::Carbon which has no
&gt; 64-bit implementation
&gt; &#40;RT #43551&#41;.
&gt; 
&gt; The real fix is for an implementation of Mac::Files to exist that is
&gt; based on Cocoa. The next layer
&gt; of fix is to fix File::HomeDir so that it will at least skip some of
&gt; the tests if it is on 64-bit.  The
&gt; final hack is to make CPAN work the old way if it sees that it&#39;s got a
&gt; 64-bit perl on darwin.
&gt; 
&gt; Note that most people have not noticed yet because perl5.10 does not
&gt; have the correct
&gt; configure switches in place to let the -Duse64bitall option work. Back
&gt; porting the patch from
&gt; blead fixes it so I assume that this will become a bit of an issue
&gt; when 5.10.1 comes out.
</div>

Hey,

I hate to be a spoiler, but this is still broken on my Mac OS 10.4.11,
with Perl 5.8.8 installed.  Also, I am not sure this is restricted to 64
bit only.  Anyway, here is my &#40;abbreviated&#41; report when I try to
&#39;install CPAN&#39; from the CPAN shell.

First it unpacks CPAN and detects a missing dependency:

    CPAN.pm: Going to build A/AN/ANDK/CPAN-1.9402.tar.gz

  Checking if your kit is complete...
  Looks good
  Writing Makefile for CPAN

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">  ---- Unsatisfied dependencies detected during ----
  ----          ANDK/CPAN-1.9402.tar.gz         ----
      File::HomeDir [requires]
  Shall I follow them and prepend them to the queue
  of modules we are processing right now? [yes]

Next it trys to install File::HomeDir:

    CPAN.pm: Going to build A/AD/ADAMK/File-HomeDir-0.86.tar.gz

  Checking if your kit is complete...
  Looks good
  Writing Makefile for File::HomeDir

<div class="message-stanza open">  ---- Unsatisfied dependencies detected during ----
  ----      ADAMK/File-HomeDir-0.86.tar.gz      ----
      Mac::Carbon [requires]
      Mac::Files [requires]
  Shall I follow them and prepend them to the queue
  of modules we are processing right now? [yes] 

Here is where we get into trouble.  These two modules are totally
unreliable and have not been maintained for years.  I&#39;ve tried
installing them on several Macs, from 10.3x through 10.5x and I couldn&#39;t
get them to install anywhere.  What buggers me the most is that even
without these dependencies, CPAN seems to pass all it&#39;s tests:

  Result: PASS
    ADAMK/File-HomeDir-0.86.tar.gz
  Tests succeeded but 2 dependencies missing &#40;Mac::Files,Mac::Carbon&#41;
    ADAMK/File-HomeDir-0.86.tar.gz
    [dependencies] -- NA
  Running make install
    make test had returned bad status, won&#39;t install

So, File::HomeDir is only using a tiny bit of the bad Mac stuff, and
CPAN is only using part of File::HomeDir, yet the whole thing is blowing
up.  Now, what happens when I force install File::HomeDir and then try
to install CPAN normally?

    ANDK/CPAN-1.9402.tar.gz
    make install  -- OK

It installs without any trouble, passing all the tests.  

Another related issue here is how in a Mac, due to File::HomeDir, can
actually end up creating multiple .cpan directories?  How does this
happen?  Well, in CPAN::HandleConfig, it will try to use File::HomeDir
to locate where to put the .cpan directory.  On a Mac this will return

  $home/Library/Application Support/.cpan

rather than in:

  $home/.cpan

Yet the &#34;$home/.cpan&#34; directory is also create somehow.   I guess this
is an Apple standard, but it&#39;s confusing to most perl people.  In fact,
I have noticed that the vast majority of applications ignore the Apple
standard and just drop the &#39;dot&#39; directories in $home where Unix people
expect it to be.

CPAN::HandleConfig will fall back to locating the parent folder of .cpan
by looking for a $ENV{HOME}, which is how I guess we end up with .cpan
is more than one place.  I guess this could be a problem with Windows as
well

Anyway, sorry this is rambling, but I&#39;ve spent the last two days playing
with this trying to make a new Catalyst installer that actually works
correctly on the Mac.  I guess from my perspect two things:

1&#41; File::HomeDir&#39;s dependency of the Mac::* stuff is very problematic.
2&#41; for platforms like the Mac where &#39;dotfiles&#39; are not dropped into the
$home directory, we need to make sure we don&#39;t have both $home/cpan and
$home/Application Support/.cpan

For 1&#41;, I dropped an email to the File::HomeDir maintainer offering to
take a shot at adding the minimal XS to get the files portion of the Mac
stuf working.  I definitely don&#39;t have time to fix the entire Mac::*
stuff, but from my perspective there&#39;s like a half dozen functions here
that we really need.

For 2&#41; we need a way to disambiguate between the two, and have some sort
of detection and offer to either let the user choose or migrate to
whichever is preferred.  Right now having two causes tons of install
problems for my on the Macs I have to maintain.

I&#39;m willing to help with either/or, please let me know if my assessment
is correct.  Thank you!
</div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;23&nbsp;10:53:14&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;22&nbsp;12:12:55&nbsp;2011</span>
    <span class="description">dolmen [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> dagolden [...] cpan.org, tim.jenness [...] gmail.com, tjenness [...] cpan.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">RT#43549 &#40;in the File::HomeDir queue&#41; has been fixed long time ago.

We should probably close this bug too.

-- 
Olivier Mengué - <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~dolmen/">http://search.cpan.org/~dolmen/</a></span> <span class="clickylink"><a target="new" rel="nofollow" href="http://github.com/dolmen/">http://github.com/dolmen/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;22&nbsp;12:19:45&nbsp;2011</span>
    <span class="description">dagolden [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Yes, and the dev version of CPAN has new code to try to avoid creating
extra directories when one already exists.

Closing the ticket.

Thank you!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;22&nbsp;12:19:46&nbsp;2011</span>
    <span class="description">dagolden [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
