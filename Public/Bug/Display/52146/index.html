<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #52146 for Math-Pari: [PATCH] Building Math::Pari on Win32/strawberry perl</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #52146 for Math-Pari: [PATCH] Building Math::Pari on Win32/strawberry perl</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Math-Pari/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Math-Pari/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Math-Pari/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Math-Pari/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Math-Pari">Math-Pari CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">52146</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Math-Pari/Active/">Math-Pari</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
kmx [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-20832-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-20833-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;28&nbsp;05:22:52&nbsp;2009</span>
    <span class="description">kmx [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [PATCH] Building Math::Pari on Win32/strawberry perl</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

please consider applying the enclosed patch that makes Math::Pari
2.01080602 installable on Win32/strawberry perl.

Thanks.

--
kmx
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> math-pari.patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -r -u Math-Pari-2.01080602.orig/utils/Math/PariBuild.pm Math-Pari-2.01080602/utils/Math/PariBuild.pm
--- Math-Pari-2.01080602.orig/utils/Math/PariBuild.pm	2009-11-08 11:21:06.000000000 +0100
+++ Math-Pari-2.01080602/utils/Math/PariBuild.pm	2009-11-28 11:18:31.708043800 +0100
@@ -37,7 +37,9 @@
 use strict;
 use Config;
 use File::Copy &#39;copy&#39;;
+use File::Spec &#39;devnull&#39;;
 use File::Basename &#39;basename&#39;;
+use ExtUtils::MakeMaker &#39;prompt&#39;;
 
 =head1 NAME
 
@@ -275,11 +277,9 @@
 Make sure you have a large scrollback buffer to see the messages, or `tee&#39;
 the STDOUT/STDERR to a file.
 
-Fetch? &#40;y/n, press Enter&#41;
 EOP
-      chomp $mess;
       print &#34;$mess &#34;;
-      my $ans = &lt;STDIN&gt;;
+      my $ans = prompt &#34;Fetch? &#40;Y/n&#41; ?&#34;, &#39;Y&#39;;
       if &#40;$ans !~ /y/i&#41; {
 	my &#40;$eA, $eM, $tI, $tO, $tE, $pO, $pE&#41;
 	  = &#40;@ENV{ qw&#40;AUTOMATED_TESTING PERL_MM_USE_DEFAULT&#41; },
@@ -511,7 +511,7 @@
   my &#40;$rc, $p&#41; = &#39;&#39;;
   my $patch = $Config{gnupatch} || &#39;patch&#39;;
   foreach $p &#40;@patches&#41; {
-    my $cmd = &#34;cd $dir ; $patch -p1 &lt; ../$p&#34;;
+    my $cmd = &#40;$^O eq &#39;MSWin32&#39;&#41; ? &#34;cd $dir &#38; $patch -p1 --binary &lt; ..\\$p&#34; : &#34;cd $dir ; $patch -p1 &lt; ../$p&#34;;
     print &#34;$cmd\n&#34;;
     system &#34;$cmd&#34;
       and warn &#34;...Could not patch: \$?=$?, $!; continuing anyway...\n&#34;;
@@ -860,6 +860,7 @@
 
 sub find_machine_architecture &#40;&#41; {
   my $os = &#40;split &#39; &#39;, $Config{myuname}&#41;[0];
+  my $devnull = File::Spec-&gt;devnull&#40;&#41;;
 
   my $machine = $os;		# Handles fx2800
   if &#40;$os =~ /^irix/&#41; {
@@ -952,9 +953,9 @@
       =~ /\b&#40;sun3|sparcv7|sparcv8_micro|sparcv8_super|alpha|hppa|[ix]\d86&#41;\b/&#41; {
     $machine = $1;
   } elsif &#40;not defined $machine&#41; {
-    chomp&#40;$machine = `uname -m`&#41;;
+    chomp&#40;$machine = `uname -m 2&gt;$devnull`&#41;;
   }
-  $machine =~ s/[ix]\d86/ix86/ if defined $machine;
+  $machine =~ s/[ix]\d86.*/ix86/ if defined $machine;
 
   print &#34;...Processor of family `$machine&#39; detected\n&#34;;
   return $machine;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;28&nbsp;06:04:30&nbsp;2009</span>
    <span class="description">nospam-abuse [...] ilyaz.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients: ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #52146] [PATCH] Building Math::Pari on Win32/strawberry perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 28 Nov 2009 03:04:12 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> kmx via RT &lt;bug-Math-Pari [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;nospam-abuse [...] ilyaz.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat, Nov 28, 2009 at 05:22:53AM -0500, kmx via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; please consider applying the enclosed patch that makes Math::Pari
&gt; 2.01080602 installable on Win32/strawberry perl.
</div>
a&#41; I would prefer to avoid the dependence on more modules...

b&#41; What is `uname -m` on strawberry?

Thanks,
Ilya
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;28&nbsp;06:04:30&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;28&nbsp;06:48:37&nbsp;2009</span>
    <span class="description">kmx [...] volny.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #52146] [PATCH] Building Math::Pari on Win32/strawberry perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 28 Nov 2009 12:48:00 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Math-Pari [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> kmx &lt;kmx [...] volny.cz&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; a&#41; I would prefer to avoid the dependence on more modules...
&gt;   
</div>OK,  using File::Spec-&gt;devnull was just cosmetics hiding the error message.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; b&#41; What is `uname -m` on strawberry?
&gt;
&gt;   
</div>Well, strawberry itself does not have uname at all, quite often people
&#40;like me&#41; have installed uname from gnuwin32 which returns:
i686-pc

One more comment on strawberry&#39;s $Config{myuname}
- before Oct2009 is $Config{myuname}empty
- since Oct2009 release contains:
Win32 strawberryperl 5.10.1.0 #1 30 i386

--
kmx
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;28&nbsp;08:43:07&nbsp;2009</span>
    <span class="description">nospam-abuse [...] ilyaz.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients: ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #52146] [PATCH] Building Math::Pari on Win32/strawberry perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 28 Nov 2009 05:42:34 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> kmx via RT &lt;bug-Math-Pari [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;nospam-abuse [...] ilyaz.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat, Nov 28, 2009 at 06:48:38AM -0500, kmx via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Math-Pari
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=52146">http://rt.cpan.org/Ticket/Display.html?id=52146</a></span> &gt;
&gt; 
&gt; Hi,
&gt; 
<div class="message-stanza open">&gt; &gt; a&#41; I would prefer to avoid the dependence on more modules...
</div></div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; OK,  using File::Spec-&gt;devnull was just cosmetics hiding the error message.
</div>
It&#39;ll work much better if I know which changes are needed, and which
are cosmetic.  For example, why --binary on patch?  Is prompt&#40;&#41;
actually needed, and why?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; b&#41; What is `uname -m` on strawberry?
</div></div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Well, strawberry itself does not have uname at all, quite often people
&gt; &#40;like me&#41; have installed uname from gnuwin32 which returns:
&gt; i686-pc
</div>
So without it, it would default to portable build?  Likewise for patch?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; One more comment on strawberry&#39;s $Config{myuname}
&gt; - before Oct2009 is $Config{myuname}empty
&gt; - since Oct2009 release contains:
&gt; Win32 strawberryperl 5.10.1.0 #1 30 i386
</div>
If there were a chance to parse this...

Thanks,
Ilya
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;28&nbsp;11:15:22&nbsp;2009</span>
    <span class="description">kmx [...] volny.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #52146] [PATCH] Building Math::Pari on Win32/strawberry perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 28 Nov 2009 17:14:59 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Math-Pari [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> kmx &lt;kmx [...] volny.cz&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It&#39;ll work much better if I know which changes are needed, and which
&gt; are cosmetic.  For example, why --binary on patch?  Is prompt&#40;&#41;
&gt; actually needed, and why?
&gt;
&gt;   
</div>a&#41; absolutely crucial is &#34;patch-part&#34;
- on Win32 the command separator is not &#34;;&#34; but &#34;&#38;&#34;
- patch option --binary is necessary for win32 patch to correctly
process a *.patch file with
  UNIX-like newlines &#40;= &lt;LF&gt;&#41;; without this option it fails as it
expects &lt;CR&gt;&lt;LF&gt; newlines
- without applying patches the module is not installed correctly on Win32

b&#41; as for the &#34;prompt-part&#34;
- using prompt is AFAIK the recommended best-practice for cpan install
scripts
- your old code will ignore for example setting PERL_MM_USE_DEFAULT=1
- your old code will fail with most automated testing scripts as it has
not a reasonable default

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; Well, strawberry itself does not have uname at all, quite often people
&gt;&gt; &#40;like me&#41; have installed uname from gnuwin32 which returns:
&gt;&gt; i686-pc
&gt;&gt;     
</div>&gt; So without it, it would default to portable build?
</div>Yes.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; One more comment on strawberry&#39;s $Config{myuname}
&gt;&gt; - before Oct2009 is $Config{myuname}empty
&gt;&gt; - since Oct2009 release contains:
&gt;&gt; Win32 strawberryperl 5.10.1.0 #1 30 i386
&gt;&gt;     
</div>&gt; If there were a chance to parse this...
&gt;   
</div>Not part of my patch but you can test e.g. if $machine variable contains
&#34;Win32&#34; or you can test RE match $Config{myuname} =~ /strawberryperl.*?i386/

--
kmx
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;28&nbsp;14:30:57&nbsp;2009</span>
    <span class="description">nospam-abuse [...] ilyaz.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients: ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #52146] [PATCH] Building Math::Pari on Win32/strawberry perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 28 Nov 2009 11:30:38 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> kmx via RT &lt;bug-Math-Pari [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;nospam-abuse [...] ilyaz.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat, Nov 28, 2009 at 11:15:22AM -0500, kmx via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; a&#41; absolutely crucial is &#34;patch-part&#34;
&gt; - on Win32 the command separator is not &#34;;&#34; but &#34;&#38;&#34;
</div>
Would &#38;&#38; work?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; - patch option --binary is necessary for win32 patch to correctly
&gt; process a *.patch file with
&gt;   UNIX-like newlines &#40;= &lt;LF&gt;&#41;; without this option it fails as it
&gt; expects &lt;CR&gt;&lt;LF&gt; newlines
</div>
Hmm, sounds like a misnomer.  Without &#34;binary mode&#34;, it should read in
text mode, so do not care about line endings...  Maybe there is --text option?

Using --binary is a very dangerous choice.  What if untar/unzip
extracts with conversion of newlines?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; - without applying patches the module is not installed correctly on Win32
</div>
In which way?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; b&#41; as for the &#34;prompt-part&#34;
&gt; - using prompt is AFAIK the recommended best-practice for cpan install
&gt; scripts
&gt; - your old code will ignore for example setting PERL_MM_USE_DEFAULT=1
</div>
Note the version 2.010805 and later...  &#40;Current one is 2.01080603&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; - your old code will fail with most automated testing scripts as it has
&gt; not a reasonable default
</div>
Not as experience shows...  &#40;At least from 2.010802&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Not part of my patch but you can test e.g. if $machine variable contains
&gt; &#34;Win32&#34;
</div>
I already know this from $^O...

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; or you can test RE match $Config{myuname} =~ /strawberryperl.*?i386/
</div>
I would probably test for SPACE whatever86 if `uname -m` fails...

Thanks,
Ilya
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;28&nbsp;14:57:44&nbsp;2009</span>
    <span class="description">kmx [...] volny.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #52146] [PATCH] Building Math::Pari on Win32/strawberry perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 28 Nov 2009 20:57:22 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Math-Pari [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> kmx &lt;kmx [...] volny.cz&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; - on Win32 the command separator is not &#34;;&#34; but &#34;&#38;&#34;
&gt;&gt;     
</div>&gt; Would &#38;&#38; work?
&gt;   
</div>Yes.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hmm, sounds like a misnomer.  Without &#34;binary mode&#34;, it should read in
&gt; text mode, so do not care about line endings...  Maybe there is --text option?
&gt;   
</div>Unfortunately no --text option. It seems to be a feature of patch on
Win32 system.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; - without applying patches the module is not installed correctly on Win32
&gt;&gt;     
</div>&gt; In which way?
&gt;   
</div>Apart from the errors when trying to run &#34;uname&#34; or &#34;patch&#34; I thought
that there were some failing tests; but I have ran the installation
again right now and it seems to install ok with all tests passed.

So perhaps all this RT was not necessary :&#40;

--
kmx
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;10&nbsp;20:22:13&nbsp;2009</span>
    <span class="description">nospam-abuse [...] ilyaz.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients: ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #52146] [PATCH] Building Math::Pari on Win32/strawberry perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 10 Dec 2009 17:21:40 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> kmx via RT &lt;bug-Math-Pari [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;nospam-abuse [...] ilyaz.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat, Nov 28, 2009 at 05:22:53AM -0500, kmx via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; please consider applying the enclosed patch that makes Math::Pari
&gt; 2.01080602 installable on Win32/strawberry perl.
</div>
I see

-    my $cmd = &#34;cd $dir ; $patch -p1 &lt; ../$p&#34;;
+    my $cmd = &#40;$^O eq &#39;MSWin32&#39;&#41; ? &#34;cd $dir &#38; $patch -p1 --binary &lt; ..\\$p&#34; : &#34;cd $dir ; $patch -p1 &lt; ../$p&#34;;

This looks very strange to me, since $p contains slash...  How comes?

Yours,
Ilya
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;10&nbsp;21:36:52&nbsp;2009</span>
    <span class="description">nospam-abuse [...] ilyaz.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients: ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #52146] [PATCH] Building Math::Pari on Win32/strawberry perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 10 Dec 2009 18:36:33 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> kmx via RT &lt;bug-Math-Pari [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;nospam-abuse [...] ilyaz.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat, Nov 28, 2009 at 05:22:53AM -0500, kmx via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; please consider applying the enclosed patch that makes Math::Pari
&gt; 2.01080602 installable on Win32/strawberry perl.
</div>
Could you check how 2.01080603 behaves?  It is supposed to be better
than what your patches did...  Could you also check it with option
  version23_ok=1
to Makefile.PL &#40;in a separate build directory&#41;?

Thanks,
Ilya
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;11&nbsp;12:13:50&nbsp;2009</span>
    <span class="description">kmx [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; -    my $cmd = &#34;cd $dir ; $patch -p1 &lt; ../$p&#34;;
&gt; +    my $cmd = &#40;$^O eq &#39;MSWin32&#39;&#41; ? &#34;cd $dir &#38; $patch -p1 --binary &lt;
&gt; ..\\$p&#34; : &#34;cd $dir ; $patch -p1 &lt; ../$p&#34;;
&gt; 
&gt; This looks very strange to me, since $p contains slash...  How comes?
</div>
You are right, backslashes are not necessary, you can use:

my $cmd = &#40;$^O eq &#39;MSWin32&#39;&#41; ? &#34;cd $dir &#38; $patch -p1 --binary &lt; ../$p&#34; :
&#34;cd $dir ; $patch -p1 &lt; ../$p&#34;;


--
kmx
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;11&nbsp;12:22:00&nbsp;2009</span>
    <span class="description">kmx [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Could you check how 2.01080603 behaves?  It is supposed to be better
&gt; than what your patches did...
</div>
Unfortunately the install attempt ends like this:

Looking for patches for 2.1.7...
Patching...
can&#39;t find file to patch at input line 3
Perhaps you should have used the -p or --strip option?
The text leading up to this was:
--------------------------
|--- utils/inc.h        Tue Sep 25 07:17:18 2001
|+++ utils/inc.h1       Thu Dec 10 16:44:36 2009
--------------------------
File to patch:


There is probably missing -p1 option when calling patch on Win32.

--
kmx
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;11&nbsp;13:53:50&nbsp;2009</span>
    <span class="description">nospam-abuse [...] ilyaz.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients: ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #52146] [PATCH] Building Math::Pari on Win32/strawberry perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 11 Dec 2009 10:53:32 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> kmx via RT &lt;bug-Math-Pari [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;nospam-abuse [...] ilyaz.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, Dec 11, 2009 at 12:22:00PM -0500, kmx via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Looking for patches for 2.1.7...
&gt; Patching...
&gt; can&#39;t find file to patch at input line 3
&gt; Perhaps you should have used the -p or --strip option?
&gt; The text leading up to this was:
&gt; --------------------------
&gt; |--- utils/inc.h        Tue Sep 25 07:17:18 2001
&gt; |+++ utils/inc.h1       Thu Dec 10 16:44:36 2009
&gt; --------------------------
&gt; File to patch:
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; There is probably missing -p1 option when calling patch on Win32.
</div>
Aha!  Thanks for the suggestion.  Could you manually add -p1 to line
510 of utils/Math/PariBuild.pm?  I suspect one needs also to add ./ to
file names inside utils/inc_h.diff ...

Could you report?

Thanks,
Ilya
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;11&nbsp;13:56:19&nbsp;2009</span>
    <span class="description">nospam-abuse [...] ilyaz.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients: ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #52146] [PATCH] Building Math::Pari on Win32/strawberry perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 11 Dec 2009 10:56:02 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> kmx via RT &lt;bug-Math-Pari [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;nospam-abuse [...] ilyaz.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, Dec 11, 2009 at 12:13:51PM -0500, kmx via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Math-Pari
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=52146">https://rt.cpan.org/Ticket/Display.html?id=52146</a></span> &gt;
&gt; 
<div class="message-stanza open">&gt; &gt; -    my $cmd = &#34;cd $dir ; $patch -p1 &lt; ../$p&#34;;
&gt; &gt; +    my $cmd = &#40;$^O eq &#39;MSWin32&#39;&#41; ? &#34;cd $dir &#38; $patch -p1 --binary &lt;
&gt; &gt; ..\\$p&#34; : &#34;cd $dir ; $patch -p1 &lt; ../$p&#34;;
&gt; &gt; 
&gt; &gt; This looks very strange to me, since $p contains slash...  How comes?
</div>&gt; 
&gt; You are right, backslashes are not necessary, you can use:
&gt; 
&gt; my $cmd = &#40;$^O eq &#39;MSWin32&#39;&#41; ? &#34;cd $dir &#38; $patch -p1 --binary &lt; ../$p&#34; :
&gt; &#34;cd $dir ; $patch -p1 &lt; ../$p&#34;;
</div>
This is very surprising!  I thought that cmd.exe treated / as &#34;a
zero-length argument separator&#34;...

Is it documented/mentioned somewhere that slashes may be used in
redirection filenames?  From when?

Thanks,
Ilya
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;12&nbsp;05:16:23&nbsp;2009</span>
    <span class="description">kmx [...] volny.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #52146] [PATCH] Building Math::Pari on Win32/strawberry perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 12 Dec 2009 11:15:41 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Math-Pari [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> kmx &lt;kmx [...] volny.cz&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Aha!  Thanks for the suggestion.  Could you manually add -p1 to line
&gt; 510 of utils/Math/PariBuild.pm?  I suspect one needs also to add ./ to
&gt; file names inside utils/inc_h.diff ...
&gt;   
</div>It is necessary to make the following change:

-  system &#34;$patch --binary &lt; $p&#34;
+  system &#34;$patch -p0 --binary &lt; $p&#34;

After that Math-Pari-2.01080603 installs fine on Win32.

PLEASE, consider using standard prompt function for user interaction as
the current version does not comply with best-practice.

See <span class="clickylink"><a target="new" rel="nofollow" href="http://www.perlfoundation.org/perl5/index.cgi?cpan_packaging">http://www.perlfoundation.org/perl5/index.cgi?cpan_packaging</a></span>
&#40;section &#34;Use prompt&#40;&#41; for build interaction.&#34;&#41;.

--
kmx
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;12&nbsp;05:27:56&nbsp;2009</span>
    <span class="description">kmx [...] volny.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #52146] [PATCH] Building Math::Pari on Win32/strawberry perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 12 Dec 2009 11:26:58 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Math-Pari [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> kmx &lt;kmx [...] volny.cz&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This is very surprising!  I thought that cmd.exe treated / as &#34;a
&gt; zero-length argument separator&#34;...
&gt;
&gt; Is it documented/mentioned somewhere that slashes may be used in
&gt; redirection filenames?  From when?
</div>Well I do not know since when but using &#34;command &lt; ../path/to/file.txt&#34;
works at least on my WinXP box.

See a long discussion at:
<span class="clickylink"><a target="new" rel="nofollow" href="http://bytes.com/topic/python/answers/23123-when-did-windows-start-accepting-forward-slash-path-separator">http://bytes.com/topic/python/answers/23123-when-did-windows-start-accepting-forward-slash-path-separator</a></span>

--
kmx
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;12&nbsp;12:16:14&nbsp;2009</span>
    <span class="description">nospam-abuse [...] ilyaz.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients: ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #52146] [PATCH] Building Math::Pari on Win32/strawberry perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 12 Dec 2009 09:15:53 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> kmx via RT &lt;bug-Math-Pari [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;nospam-abuse [...] ilyaz.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat, Dec 12, 2009 at 05:16:24AM -0500, kmx via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It is necessary to make the following change:
&gt; 
&gt; -  system &#34;$patch --binary &lt; $p&#34;
&gt; +  system &#34;$patch -p0 --binary &lt; $p&#34;
&gt; 
&gt; After that Math-Pari-2.01080603 installs fine on Win32.
</div>
Thanks!

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; PLEASE, consider using standard prompt function for user interaction as
&gt; the current version does not comply with best-practice.
</div>
What happens which &#34;does not comply&#34;?

Yours,
Ilya
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;12&nbsp;12:44:20&nbsp;2009</span>
    <span class="description">nospam-abuse [...] ilyaz.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients: ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #52146] [PATCH] Building Math::Pari on Win32/strawberry perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 12 Dec 2009 09:44:04 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> kmx via RT &lt;bug-Math-Pari [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;nospam-abuse [...] ilyaz.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat, Dec 12, 2009 at 05:27:56AM -0500, kmx via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Math-Pari
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=52146">http://rt.cpan.org/Ticket/Display.html?id=52146</a></span> &gt;
&gt; 
&gt; 
<div class="message-stanza open">&gt; &gt; This is very surprising!  I thought that cmd.exe treated / as &#34;a
&gt; &gt; zero-length argument separator&#34;...
&gt; &gt;
&gt; &gt; Is it documented/mentioned somewhere that slashes may be used in
&gt; &gt; redirection filenames?  From when?
</div>&gt; Well I do not know since when but using &#34;command &lt; ../path/to/file.txt&#34;
&gt; works at least on my WinXP box.
&gt; 
&gt; See a long discussion at:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://bytes.com/topic/python/answers/23123-when-did-windows-start-accepting-forward-slash-path-separator">http://bytes.com/topic/python/answers/23123-when-did-windows-start-accepting-forward-slash-path-separator</a></span>
</div>
IIRC, there are exactly 2 posts which describe BOTH the behaviour and
the version of the OS/shell...  I would say the discussion is pretty
useless...  &#40;And it concentrates on chdir - which is an internal
command - not on redirection applied to an arbitrary program.&#41;

Thanks anyway,
Ilya
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;02&nbsp;05:44:39&nbsp;2010</span>
    <span class="description">kmx [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza">Hi Ilya,<br>

<br>

I am back again with MS Windows issues in Math-Pari.<br>

<br>

I have dome more testing with the new gcc toolchain we (strawberry perl project) are about to use with upcoming perl 5.12. This new toolchain is based on gcc-4.4.3 compiler and C runtime libraries provided by mingw-w64 project (they deliver both 32-bit/64-bit runtimes).<br>

<br>

It turned out that there are some additional issues that need to be handled in order to support MS Windows platform with the old gcc3 toolchain (by mingw.org project) as well as the new gcc4 toolchain (by mingw-w64.sf.net project).<br>

<br>

IMPORTANT: I am trying to fix just issues concerning 32-bit MS Windows. With the enclosed patch I am able to compile your module also on 64-bit platform but the bunch of warnings indicates that libpari-2.1.7 does not have proper 64-bit support for MS Windows. After fixing Windows 32bit support we can open a new RT on Windows 64bit support.<br>

<br>

So what needs to be patched:<br>

<br>

1) missing patch option -p0 discussed above<br>

<br>

2) I have added 32bit MS Windows detection in this way<br>

... if ($Config{archname} eq 'MSWin32-x86-multi-thread' or $Config{cc} =~ /gcc/)<br>

<br>

3) The patch for pari-2.1.7 was necessary - I have added patches/diff_2.1.7_mingw-w64<br>

The fixed problems mostly concern colisions between pari macros and windows.h macros + an issue with using small as variable name (I have not investigated why but it seems like &quot;small&quot; is gcc4 keyword or macro included from some header). Anyway I have set this new patch to conditionally apply only on MSWin32.<br>

<br>

4) I have fixed this issue in Pari.xs<br>

Pari.xs: In function 'XS_Math__Pari_dumpStack':<br>

Pari.xs:3798: warning: passing argument 2 of '(*Perl_IStdIO_ptr((struct PerlInterpreter *)Perl_get_context()))-&gt;pPuts' from incompatible pointer type<br>

Pari.xs:3798: note: expected 'struct FILE *' but argument is of type 'char *'<br>

Pari.xs:3798: warning: passing argument 3 of '(*Perl_IStdIO_ptr((struct PerlInterpreter *)Perl_get_context()))-&gt;pPuts' from incompatible pointer type<br>

Pari.xs:3798: note: expected 'const char *' but argument is of type 'struct FILE *'<br>

<br>

The changes I am proposing you can find in the enclosed files:<br>

- Math-Pari-2.01080603.patch<br>

- diff_2.1.7_mingw-w64<br>

<br>

--<br>

kmx<br>
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Math-Pari-2.01080603.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -ru Math-Pari-2.01080603.orig/Pari.xs Math-Pari-2.01080603_patched/Pari.xs
--- Math-Pari-2.01080603.orig/Pari.xs	2009-12-11 03:18:24.000000000 +0100
+++ Math-Pari-2.01080603_patched/Pari.xs	2010-01-29 16:06:22.351979000 +0100
@@ -3795,7 +3795,7 @@
 		SvREFCNT_dec&#40;tmp&#41;;
 	    }
 	    if&#40;GIMME_V == G_VOID&#41; {
-		fputs&#40;SvPV_nolen&#40;ret&#41;,stdout&#41;;
+		fputs&#40;stdout,SvPV_nolen&#40;ret&#41;&#41;;
 		SvREFCNT_dec&#40;ret&#41;;
 		XSRETURN&#40;0&#41;;
 	    } else {
Pouze v Math-Pari-2.01080603_patched/patches: diff_2.1.7_mingw-w64
diff -ru Math-Pari-2.01080603.orig/utils/Math/PariBuild.pm Math-Pari-2.01080603_patched/utils/Math/PariBuild.pm
--- Math-Pari-2.01080603.orig/utils/Math/PariBuild.pm	2009-12-11 02:45:28.000000000 +0100
+++ Math-Pari-2.01080603_patched/utils/Math/PariBuild.pm	2010-01-29 15:54:08.843275700 +0100
@@ -481,6 +481,7 @@
 			      &#39;patches/diff_2.1.6_no-common&#39;],
 		 &#39;2.1.7&#39; =&gt;  [
 			&#40;$^O =~ /darwin/i ? &#39;patches/diff_2.1.6_no-common&#39; : &#40;&#41;&#41;,
+			&#40;$^O eq &#39;MSWin32&#39; ? &#39;patches/diff_2.1.7_mingw-w64&#39; : &#40;&#41;&#41;,
 			      &#39;patches/patch-pari-unnormalized-float&#39;,
 			      &#39;patches/diff_2.1.7_-O&#39;,
 			      &#39;patches/diff_2.1.7_div&#39;,
@@ -507,7 +508,7 @@
   return &#39;/&#39; unless $^O =~ /win32/i;
   my&#40;$patch, $p&#41; = &#40;shift, &#39;utils/inc_h.diff&#39;&#41;;
   $p =~ s,/,\\,g;
-  system &#34;$patch --binary &lt; $p&#34;
+  system &#34;$patch -p0 --binary &lt; $p&#34;
     or warn&#40;&#34;... Apparently, your patch takes flag --binary...\n&#34;&#41;,
        return &#40;&#39;\\&#39;, &#39;--binary&#39;&#41;;
   return &#39;\\&#39;;
@@ -887,6 +888,8 @@
 	   or $os eq &#39;freebsd&#39; or $os =~ /^cygwin/&#41; {
     chomp&#40;$machine = `uname -m`&#41;;
     $machine ||= &#39;ix86&#39;;
+  } elsif &#40;$Config{archname} eq &#39;MSWin32-x86-multi-thread&#39; or $Config{cc} =~ /gcc/&#41; {
+    $machine = &#39;ix86&#39;;
   } elsif &#40;0 and $os =~ /win32/i and not $Config{gccversion}&#41; {
     # Not needed with rename of kernel1.s to kernel1.c?
     $machine = &#39;port&#39;; # Win32 compilers would not understand the assmebler anyway
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> diff_2.1.7_mingw-w64</td>
  </tr>
</table>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;02&nbsp;17:51:47&nbsp;2010</span>
    <span class="description">nospam-abuse [...] ilyaz.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients: ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #52146] [PATCH] Building Math::Pari on Win32/strawberry perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 2 Feb 2010 14:50:26 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> kmx via RT &lt;bug-Math-Pari [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;nospam-abuse [...] ilyaz.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue, Feb 02, 2010 at 05:44:41AM -0500, kmx via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 3&#41; The patch for pari-2.1.7 was necessary - I have added
&gt; patches/diff_2.1.7_mingw-w64
&gt; The fixed problems mostly concern colisions between pari macros and windows.h
&gt; macros + an issue with using small as variable name &#40;I have not investigated
&gt; why but it seems like &#34;small&#34; is gcc4 keyword or macro included from some
&gt; header&#41;. Anyway I have set this new patch to conditionally apply only on
&gt; MSWin32.
</div>
Should not this `small&#39; issue be reported to mingw team?

  [use options -E -dD of compiler to find where things are introduced]

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 4&#41; I have fixed this issue in Pari.xs
&gt; Pari.xs: In function &#39;XS_Math__Pari_dumpStack&#39;:
&gt; Pari.xs:3798: warning: passing argument 2 of &#39;&#40;*Perl_IStdIO_ptr&#40;&#40;struct
&gt; PerlInterpreter *&#41;Perl_get_context&#40;&#41;&#41;&#41;-&gt;pPuts&#39; from incompatible pointer type
&gt; Pari.xs:3798: note: expected &#39;struct FILE *&#39; but argument is of type &#39;char *&#39;
&gt; Pari.xs:3798: warning: passing argument 3 of &#39;&#40;*Perl_IStdIO_ptr&#40;&#40;struct
&gt; PerlInterpreter *&#41;Perl_get_context&#40;&#41;&#41;&#41;-&gt;pPuts&#39; from incompatible pointer type
&gt; Pari.xs:3798: note: expected &#39;const char *&#39; but argument is of type &#39;struct
&gt; FILE *&#39;
</div>
Can it be corrected in Perl&#39;s headers as well?  I reported it &#40;maybe
even several times&#41; with no effect...

 <span class="clickylink"><a target="new" rel="nofollow" href="http://groups.google.com/group/comp.lang.perl.modules/browse_thread/thread/d77eaeb571959545/93159c24f5633757#93159c24f5633757">http://groups.google.com/group/comp.lang.perl.modules/browse_thread/thread/d77eaeb571959545/93159c24f5633757#93159c24f5633757</a></span>

Ilya
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;03&nbsp;02:45:56&nbsp;2010</span>
    <span class="description">kmx [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza">Further analysis:<br>

<br>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Should not this `small' issue be reported to mingw team? <br>

&gt;  <br>

&gt;   [use options -E -dD of compiler to find where things are introduced] <br>
</div>It turned out that small definition that causes the collision comes from &lt;windows.h&gt;<br>

<br>

The solution I have tested on small test case is to define<br>

#define WIN32_LEAN_AND_MEAN<br>

before including &lt;windows.h&gt;<br>

<br>

However the problem may occur when somebody includes &lt;windows.h&gt; before &lt;pari.h&gt; without defining WIN32_LEAN_AND_MEAN.<br>

<br>

The other problem also occur when somebody includes &lt;pari.h&gt; after &lt;windows.h&gt; as pari.h defines some macros like lpsi which breaks &lt;windows.h&gt; (this was the reason why I have included &lt;windows.h&gt; at the beginning of &lt;pari.h&gt; at the point when these conflicting macros were not defined yet).<br>

<br>

So not easy to fix.<br>

<br>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Can it be corrected in Perl's headers as well?  I reported it (maybe <br>

&gt; even several times) with no effect... <br>
</div>Hmmm, you are right. I have just mechanically satisfied the warning. Have you asked at perl5portes mailing list?<br>

<br>

--<br>

kmx<br>

<br>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;03&nbsp;03:18:54&nbsp;2010</span>
    <span class="description">nospam-abuse [...] ilyaz.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients: ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #52146] [PATCH] Building Math::Pari on Win32/strawberry perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 3 Feb 2010 00:18:25 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> kmx via RT &lt;bug-Math-Pari [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;nospam-abuse [...] ilyaz.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed, Feb 03, 2010 at 02:46:01AM -0500, kmx via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Can it be corrected in Perl&#39;s headers as well? I reported it &#40;maybe
&gt; &gt; even several times&#41; with no effect...
</div></div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hmmm, you are right. I have just mechanically satisfied the warning. Have you
&gt; asked at perl5portes mailing list?
</div>
I think I might have &#40;5 or 10 years ago...&#41;; can&#39;t be sure now...

Yours,
Ilya
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;11&nbsp;14:56:53&nbsp;2010</span>
    <span class="description">kmx [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Have you asked at perl5portes mailing list? <br>
</div>&gt;  <br>

&gt; I think I might have (5 or 10 years ago...); can't be sure now... <br>
</div><br>

So here is my try:<br>

<span class="clickylink"><a target="new" rel="nofollow" href="http://rt.perl.org/rt3/Ticket/Display.html?id=72704">http://rt.perl.org/rt3/Ticket/Display.html?id=72704</a></span><br>

<br>

--<br>

kmx<br>

<br>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;02&nbsp;14:17:51&nbsp;2010</span>
    <span class="description">csjewell [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">OK. I just got pointed to this &#40;kmx has been acting on my behalf, as
Math::Pari is important enough to Strawberry&#39;s functionality [it&#39;s
needed for what I call the &#34;crypto toolchain&#34;, IIRC, as well as a few
other things]&#41; that not having it be able to build is a blocker to us,
and he&#39;s been the one working with the mingw64/gcc4 toolchain getting
things shaken out so that when perl 5.12.0 happens, we can release both
32 and 64-bit versions of Strawberry Perl.

1. Because you do not use prompt&#40;&#41; &#40;at least, that&#39;s what I see in the
earlier messages - that may have changed&#41;, we need to precompile a .par
with a half-built version, and then run the full build again, whenever
Strawberry wants to support a new major version of Perl, a different
compiler, or include a new version of Math::Pari. &#40;We can&#39;t have
interaction when we do our builds, but we CAN pass parameters to the
Makefile.PL.&#41;

This is tedious, but it&#39;s a &#34;one-time&#34; thing. The problem with that is
that it is easily forgotten about.

If you use prompt&#40;&#41;, we can set the appropriate environment variable and
Makefile.PL options and go our merry way, and we don&#39;t have to remember
to build a new .par, we could just use our normal build process and
Math::Pari will automatically be up-to-date as of the build date/time of
the mirror we use to build Strawberry.

2. As for patch.exe needing --binary - my assumption is that anything
that is not CRLF-ended is considered &#34;binary&#34;, and we&#39;re stuck with it. :&#40;

3. #define WIN32_LEAN_AND_MEAN - I remember that from my bouts of C and
C++ programming, and it&#39;s so highly recommended by Microsoft &#40;it&#39;s
defined by default when you create a VC++ application or dll&#41; as to be
almost a default, for exactly the reasons kmx has illustrated
&#40;conflicting definitions without it&#41;.

If there are any particular problems with the patches kmx has submitted,
and you have suggestions about different implementations, please let us
know and we&#39;ll create new ones that we can use.

I&#39;m just starting to look into this myself - I&#39;ve just starred this so
it&#39;s on my watch list. Will keep in touch.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;02&nbsp;14:30:19&nbsp;2010</span>
    <span class="description">csjewell [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have one correction to the earlier patches:

+  } elsif &#40;$Config{archname} eq &#39;MSWin32-x86-multi-thread&#39; or
$Config{cc} =~ /gcc/&#41; {
+    $machine = &#39;ix86&#39;;

That &#34;or&#34;, I think, needs to be an &#34;and&#34;. &#40;GCC does not only run on x86
machines.&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;02&nbsp;14:36:24&nbsp;2010</span>
    <span class="description">csjewell [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Also, kmx: will just applying #define WIN32_LEAN_AND_MEAN in the
appropriate place make the patches for pari-2.1.7 much less intrusive? I
think that&#39;s what I, at least, &#40;I can&#39;t speak for Ilya&#41; would prefer to
see, if that&#39;s possible.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;02&nbsp;14:42:07&nbsp;2010</span>
    <span class="description">nospam-abuse [...] ilyaz.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients: ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #52146] [PATCH] Building Math::Pari on Win32/strawberry perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 2 Mar 2010 11:41:08 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Curtis Jewell via RT &lt;bug-Math-Pari [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;nospam-abuse [...] ilyaz.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue, Mar 02, 2010 at 02:17:52PM -0500, Curtis Jewell via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Math-Pari
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=52146">https://rt.cpan.org/Ticket/Display.html?id=52146</a></span> &gt;
&gt; 
&gt; OK. I just got pointed to this &#40;kmx has been acting on my behalf, as
&gt; Math::Pari is important enough to Strawberry&#39;s functionality [it&#39;s
&gt; needed for what I call the &#34;crypto toolchain&#34;, IIRC, as well as a few
&gt; other things]&#41; that not having it be able to build is a blocker to us,
&gt; and he&#39;s been the one working with the mingw64/gcc4 toolchain getting
&gt; things shaken out so that when perl 5.12.0 happens, we can release both
&gt; 32 and 64-bit versions of Strawberry Perl.
&gt; 
&gt; 1. Because you do not use prompt&#40;&#41; &#40;at least, that&#39;s what I see in the
&gt; earlier messages - that may have changed&#41;, we need to precompile a .par
&gt; with a half-built version, and then run the full build again, whenever
&gt; Strawberry wants to support a new major version of Perl, a different
&gt; compiler, or include a new version of Math::Pari. &#40;We can&#39;t have
&gt; interaction when we do our builds, but we CAN pass parameters to the
&gt; Makefile.PL.&#41;
&gt; 
&gt; This is tedious, but it&#39;s a &#34;one-time&#34; thing. The problem with that is
&gt; that it is easily forgotten about.
&gt; 
&gt; If you use prompt&#40;&#41;, we can set the appropriate environment variable and
&gt; Makefile.PL options and go our merry way, and we don&#39;t have to remember
&gt; to build a new .par, we could just use our normal build process and
&gt; Math::Pari will automatically be up-to-date as of the build date/time of
&gt; the mirror we use to build Strawberry.
</div>
Irrelevant nowadays, I believe.

The rest is in my queue.

Ilya

P.S.  I got a 64-bit assember enabler patch for x86 &#40;for 2.3.*&#41;.
      Attached.  Testing and feedback is appreciated.
</div></div>
<div class="messageattachments">
<div class="message-stanza plain-text-white-space">
</div><table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: Math::Pari: Problem with Assembler detection</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 27 Feb 2010 10:03:12 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;ilya [...] math.berkeley.edu&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Alexander Haeckel &lt;alexanderhaeckel [...] lavabit.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Here comes the patch:
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- old/Math-Pari-2.01080603/utils/Math/PariBuild.pm	2009-12-11 02:45:28.000000000 +0100
+++ Math-Pari-2.01080603/utils/Math/PariBuild.pm	2010-02-27 09:38:41.000000000 +0100
@@ -1029,6 +1029,7 @@ sub inline_headers_arr {     # These fil
 	       # ppc is not done yet &#40;2.0.15&#41;
 	&#40;$pari_version &gt; 2002007
 		? &#40;ppc		     =&gt; [&#39;ppc/asm0.h&#39;, &#39;none/divll.h&#39;],
+                   x86_64            =&gt; [&#39;x86_64/asm0.h&#39;,&#39;none/level1.h&#39;],
 		   ia64		     =&gt; [&#39;ia64/asm0.h&#39;,&#39;ia64/asm1.h&#39;]&#41;
 		: &#40;&#41;&#41;,
 	       sparcv7	      =&gt; [&#39;none/asm0.h&#39;,&#39;none/level1.h&#39;],
@@ -1125,7 +1126,7 @@ sub choose_and_report_assembler {
 			       ? &#39;hppa&#39; : &#39;none&#39;&#41;,
 	     &#41;;
   my $asmarch = $asmarch{$machine} || $machine; # Temporary only
-  my %skip64 = &#40;alpha =&gt; 1, none =&gt; 1, ia64 =&gt; 1&#41;;
+  my %skip64 = &#40;alpha =&gt; 1, none =&gt; 1, ia64 =&gt; 1, x86_64 =&gt; 1,&#41;;
   if &#40;not $skip64{$asmarch}
       and &#40;$Config{longsize} || 0&#41; == 8&#41; {
     $asmarch .= &#39;_64&#39;;
@@ -1601,7 +1602,7 @@ sub code_C_translator {
   my @t = ExtUtils::Constant::constant_types&#40;&#41;; # macro defs
   my @tt =
     ExtUtils::Constant::C_constant&#40;
-	  &#39;Math::Pari::func_type&#39;, 
+	  &#39;Math::Pari::func_type&#39;,
           &#39;func_ord_by_type&#39;, undef, undef, undef, undef,
           map {{name =&gt; $_, value =&gt; $codes{$_}, macro =&gt; 1}} keys %codes&#41;;
 
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
According to pari-2.3.5/CHANGES-2.2 the patch should work beginning with
version 2.2.8, but the earliest I could find on
<span class="clickylink"><a target="new" rel="nofollow" href="http://pari.math.u-bordeaux.fr/pub/pari/unix/">http://pari.math.u-bordeaux.fr/pub/pari/unix/</a></span> was 2.3.0. So please take
this as a warning that something could break. But I don&#39;t expect this
to happen.

Thank you very much for this excellent module,
Alexander


Ilya Zakharevich &lt;ilya@math.berkeley.edu&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; For best result, could you also send me results of
&gt;
&gt;    diff -pu old_file new_file
&gt;
&gt; for these edits?
</div></div></div>
</div>
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;02&nbsp;17:28:47&nbsp;2010</span>
    <span class="description">kmx [...] volny.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> kmx [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #52146] [PATCH] Building Math::Pari on Win32/strawberry perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 02 Mar 2010 23:27:46 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Math-Pari [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> kmx &lt;kmx [...] volny.cz&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If you use prompt&#40;&#41;, we can set the appropriate environment variable and
&gt; Makefile.PL options and go our merry way, and we don&#39;t have to remember
&gt; to build a new .par, we could just use our normal build process and
&gt; Math::Pari will automatically be up-to-date as of the build date/time of
&gt; the mirror we use to build Strawberry.
&gt;   
</div>AFAIK Math::Pari handles env variables AUTOMATED_TESTING +
PERL_MM_USE_DEFAULT itself which I also do not consider a good idea &#40;as
you can see from my previous posts :&#41; but it works.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 2. As for patch.exe needing --binary - my assumption is that anything
&gt; that is not CRLF-ended is considered &#34;binary&#34;, and we&#39;re stuck with it. :&#40;
&gt;   
</div>For this we have used in Alien::SDL the following platform independent
trick:

$patch_file = ......;
system&#40;&#34;$^X -pe &#39;&#39; -- $patch_file | patch -N -p1 -u&#34;&#41;;

Just an idea, of course you might not like it.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 3. #define WIN32_LEAN_AND_MEAN ...
</div>I have not got further with this.


--
kmx
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;02&nbsp;22:00:40&nbsp;2010</span>
    <span class="description">nospam-abuse [...] ilyaz.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients: ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #52146] [PATCH] Building Math::Pari on Win32/strawberry perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 2 Mar 2010 19:00:05 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> kmx via RT &lt;bug-Math-Pari [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;nospam-abuse [...] ilyaz.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue, Mar 02, 2010 at 05:28:48PM -0500, kmx via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; $patch_file = ......;
&gt; system&#40;&#34;$^X -pe &#39;&#39; -- $patch_file | patch -N -p1 -u&#34;&#41;;
</div>
This looks very fragile and baroque.  Why not

  system qq&#40;$^X -pe0 -- &#34;$patch_file&#34; | patch -p1&#41;

AFAIK, -u is not portable; -N is too error-forgiving...

Yours,
Ilya
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;03&nbsp;03:46:36&nbsp;2010</span>
    <span class="description">kmx [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> csjewell [...] cpan.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza">Hi Ilya,<br>

<br>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; system(&quot;$^X -pe '' -- $patch_file | patch -N -p1 -u&quot;); <br>
</div>&gt;  <br>

&gt; This looks very fragile and baroque.  Why not <br>

&gt;  <br>

&gt;   system qq($^X -pe0 -- &quot;$patch_file&quot; | patch -p1) <br>

&gt;  <br>

&gt; AFAIK, -u is not portable; -N is too error-forgiving... <br>
</div><br>

To be honest I am not the author of that idea, but you are right, your suggestion seems better.<br>

<br>

Anyway WHAT IS IMPORTANT - I&nbsp;have finally prepared the smallest possible patch for Math-Pari-2.01080603 to work with both:<br>

1/ 32bit gcc3 toolchain by mingw.org<br>

2/ 32bit gcc4 toolchain by mingw-w64.sf.net<br>

<br>

See attached Math-Pari-2.01080603_kmx.patch + releasing it on CPAN.<br>

<br>

Please, please consider accepting this patch<br>

<br>

The patch is soo simple &amp; clear &amp; nice that I cannot imagine a better one :)<br>

<br>

--<br>

kmx<br>

<br>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;03&nbsp;03:47:22&nbsp;2010</span>
    <span class="description">kmx [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Math-Pari-2.01080603_kmx.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -ru Math-Pari-2.01080603\Pari.xs Math-Pari-2.01080603.patched\Pari.xs
--- Math-Pari-2.01080603\Pari.xs	Fri Dec 11 03:18:24 2009
+++ Math-Pari-2.01080603.patched\Pari.xs	Wed Mar 03 09:21:26 2010
@@ -1,3 +1,9 @@
+/* we need to include windows.h quite early to avoid some macro name collisions */
+#ifdef _WIN32
+#  define WIN32_LEAN_AND_MEAN
+#  include &lt;windows.h&gt;
+#endif
+
 #  include &lt;pari.h&gt;
 #  include &lt;graph/rect.h&gt;
 #  include &lt;language/anal.h&gt;
diff -ru Math-Pari-2.01080603\patches\diff_2.1.7_mingw-w64 Math-Pari-2.01080603.patched\patches\diff_2.1.7_mingw-w64
--- Math-Pari-2.01080603\patches\diff_2.1.7_mingw-w64	Wed Mar 03 09:35:45 2010
+++ Math-Pari-2.01080603.patched\patches\diff_2.1.7_mingw-w64	Wed Mar 03 09:26:18 2010
@@ -0,0 +1,17 @@
+diff -ru pari-2.1.7.orig\src\gp\highlvl.c pari-2.1.7\src\gp\highlvl.c
+--- pari-2.1.7.orig\src\gp\highlvl.c Tue Apr 23 17:29:37 2002
++++ pari-2.1.7\src\gp\highlvl.c Wed Mar 03 09:21:11 2010
+@@ -18,6 +18,13 @@
+ /*        SOME GP FUNCTION THAT MAY BE USEFUL OUTSIDE OF IT        */
+ /*                                                                 */
+ /*******************************************************************/
++
++/* we need to include windows.h quite early to avoid some macro name collisions */
++#ifdef _WIN32
++#  define WIN32_LEAN_AND_MEAN
++#  include &lt;windows.h&gt;
++#endif
++
+ #include &#34;pari.h&#34;
+ #ifdef macintosh
+ #  include &#34;rect.h&#34;
diff -ru Math-Pari-2.01080603\utils\Math\PariBuild.pm Math-Pari-2.01080603.patched\utils\Math\PariBuild.pm
--- Math-Pari-2.01080603\utils\Math\PariBuild.pm	Fri Dec 11 02:45:28 2009
+++ Math-Pari-2.01080603.patched\utils\Math\PariBuild.pm	Tue Mar 02 23:02:12 2010
@@ -481,6 +481,7 @@
 			      &#39;patches/diff_2.1.6_no-common&#39;],
 		 &#39;2.1.7&#39; =&gt;  [
 			&#40;$^O =~ /darwin/i ? &#39;patches/diff_2.1.6_no-common&#39; : &#40;&#41;&#41;,
+			&#40;$^O eq &#39;MSWin32&#39; ? &#39;patches/diff_2.1.7_mingw-w64&#39; : &#40;&#41;&#41;,
 			      &#39;patches/patch-pari-unnormalized-float&#39;,
 			      &#39;patches/diff_2.1.7_-O&#39;,
 			      &#39;patches/diff_2.1.7_div&#39;,
@@ -507,7 +508,7 @@
   return &#39;/&#39; unless $^O =~ /win32/i;
   my&#40;$patch, $p&#41; = &#40;shift, &#39;utils/inc_h.diff&#39;&#41;;
   $p =~ s,/,\\,g;
-  system &#34;$patch --binary &lt; $p&#34;
+  system &#34;$patch -p0 --binary &lt; $p&#34;
     or warn&#40;&#34;... Apparently, your patch takes flag --binary...\n&#34;&#41;,
        return &#40;&#39;\\&#39;, &#39;--binary&#39;&#41;;
   return &#39;\\&#39;;
@@ -887,6 +888,8 @@
 	   or $os eq &#39;freebsd&#39; or $os =~ /^cygwin/&#41; {
     chomp&#40;$machine = `uname -m`&#41;;
     $machine ||= &#39;ix86&#39;;
+  } elsif &#40;&#40;$Config{archname} eq &#39;MSWin32-x86-multi-thread&#39;&#41; &#38;&#38; &#40;$Config{cc} =~ /gcc/&#41;&#41; {
+    $machine = &#39;ix86&#39;;
   } elsif &#40;0 and $os =~ /win32/i and not $Config{gccversion}&#41; {
     # Not needed with rename of kernel1.s to kernel1.c?
     $machine = &#39;port&#39;; # Win32 compilers would not understand the assmebler anyway
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;03&nbsp;06:49:27&nbsp;2010</span>
    <span class="description">kmx [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza">The same idea from previous post applied to Math-Pari-2.0304_01080603<br>

<br>

Works fine with:<br>

1/ 32bit ggc3 toolchain from mingw.org<br>

2/ 32bit gcc4 toolchain from mingw-w64.sf.net<br>

<br>

Unfortunately bad news as for 64bit MS Windows. When tried to compile on this platform (64bit gcc4 toolchain from mingw-w64.sf.net) i got more that 2000 (two thousand) warnings like:<br>

- warning: cast to pointer from integer of different size<br>

- warning: cast from pointer to integer of differ<br>

<br>

The point is that on 64bit MS Windows there is:<br>

- size of int = 4 bytes (!!!)<br>

- size of *void = 8 bytes<br>

<br>

So casting between integer and pointer is not generally safe.<br>

<br>

In the end math::Pari compiles however nearly all tests end with perl.exe crash.<br>

<br>

--<br>

kmx<br>
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Math-Pari-2.0304_01080603_kmx.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -ru Math-Pari-2.0304_01080603.orig\Pari.xs Math-Pari-2.0304_01080603.new\Pari.xs
--- Math-Pari-2.0304_01080603.orig\Pari.xs	Fri Dec 11 03:18:24 2009
+++ Math-Pari-2.0304_01080603.new\Pari.xs	Wed Mar 03 12:29:27 2010
@@ -1,3 +1,9 @@
+/* we need to include windows.h quite early to avoid some macro name collisions */
+#ifdef _WIN32
+#  define WIN32_LEAN_AND_MEAN
+#  include &lt;windows.h&gt;
+#endif
+
 #  include &lt;pari.h&gt;
 #  include &lt;graph/rect.h&gt;
 #  include &lt;language/anal.h&gt;
diff -ru Math-Pari-2.0304_01080603.orig\patches\diff_2.1.7_mingw-w64 Math-Pari-2.0304_01080603.new\patches\diff_2.1.7_mingw-w64
--- Math-Pari-2.0304_01080603.orig\patches\diff_2.1.7_mingw-w64	Wed Mar 03 12:39:46 2010
+++ Math-Pari-2.0304_01080603.new\patches\diff_2.1.7_mingw-w64	Wed Mar 03 09:26:18 2010
@@ -0,0 +1,17 @@
+diff -ru pari-2.1.7.orig\src\gp\highlvl.c pari-2.1.7\src\gp\highlvl.c
+--- pari-2.1.7.orig\src\gp\highlvl.c Tue Apr 23 17:29:37 2002
++++ pari-2.1.7\src\gp\highlvl.c Wed Mar 03 09:21:11 2010
+@@ -18,6 +18,13 @@
+ /*        SOME GP FUNCTION THAT MAY BE USEFUL OUTSIDE OF IT        */
+ /*                                                                 */
+ /*******************************************************************/
++
++/* we need to include windows.h quite early to avoid some macro name collisions */
++#ifdef _WIN32
++#  define WIN32_LEAN_AND_MEAN
++#  include &lt;windows.h&gt;
++#endif
++
+ #include &#34;pari.h&#34;
+ #ifdef macintosh
+ #  include &#34;rect.h&#34;
diff -ru Math-Pari-2.0304_01080603.orig\patches\diff_2.3.5_mingw-w64 Math-Pari-2.0304_01080603.new\patches\diff_2.3.5_mingw-w64
--- Math-Pari-2.0304_01080603.orig\patches\diff_2.3.5_mingw-w64	Wed Mar 03 12:39:41 2010
+++ Math-Pari-2.0304_01080603.new\patches\diff_2.3.5_mingw-w64	Wed Mar 03 12:31:39 2010
@@ -0,0 +1,17 @@
+diff -ru pari-2.3.5.orig\src\gp\highlvl.c pari-2.3.5\src\gp\highlvl.c
+--- pari-2.3.5.orig\src\gp\highlvl.c    Thu Feb 04 11:55:42 2010
++++ pari-2.3.5\src\gp\highlvl.c Wed Mar 03 12:28:18 2010
+@@ -18,6 +18,13 @@
+ /*        SOME GP FUNCTION THAT MAY BE USEFUL OUTSIDE OF IT        */
+ /*                                                                 */
+ /*******************************************************************/
++
++/* we need to include windows.h quite early to avoid some macro name collisions */
++#ifdef _WIN32
++#  define WIN32_LEAN_AND_MEAN
++#  include &lt;windows.h&gt;
++#endif
++
+ #include &#34;pari.h&#34;
+ #include &#34;paripriv.h&#34;
+ #include &#34;../graph/rect.h&#34;
diff -ru Math-Pari-2.0304_01080603.orig\utils\Math\PariBuild.pm Math-Pari-2.0304_01080603.new\utils\Math\PariBuild.pm
--- Math-Pari-2.0304_01080603.orig\utils\Math\PariBuild.pm	Fri Dec 11 02:45:28 2009
+++ Math-Pari-2.0304_01080603.new\utils\Math\PariBuild.pm	Wed Mar 03 12:34:57 2010
@@ -481,11 +481,14 @@
 			      &#39;patches/diff_2.1.6_no-common&#39;],
 		 &#39;2.1.7&#39; =&gt;  [
 			&#40;$^O =~ /darwin/i ? &#39;patches/diff_2.1.6_no-common&#39; : &#40;&#41;&#41;,
+			&#40;$^O eq &#39;MSWin32&#39; ? &#39;patches/diff_2.1.7_mingw-w64&#39; : &#40;&#41;&#41;,
 			      &#39;patches/patch-pari-unnormalized-float&#39;,
 			      &#39;patches/diff_2.1.7_-O&#39;,
 			      &#39;patches/diff_2.1.7_div&#39;,
 			      &#39;patches/diff_2.1.6_align_power_of_2&#39;,
 			      &#39;patches/diff_2.1.7_restart&#39;],
+		 &#39;2.3.5&#39; =&gt;  [
+			&#40;$^O eq &#39;MSWin32&#39; ? &#39;patches/diff_2.3.5_mingw-w64&#39; : &#40;&#41;&#41;],
 		&#41;;
   print &#34;Looking for patches for $v...\n&#34;;
   my @p = $patches{$v} ? @{$patches{$v}} : &#40;&#41;;
@@ -507,7 +510,7 @@
   return &#39;/&#39; unless $^O =~ /win32/i;
   my&#40;$patch, $p&#41; = &#40;shift, &#39;utils/inc_h.diff&#39;&#41;;
   $p =~ s,/,\\,g;
-  system &#34;$patch --binary &lt; $p&#34;
+  system &#34;$patch -p0 --binary &lt; $p&#34;
     or warn&#40;&#34;... Apparently, your patch takes flag --binary...\n&#34;&#41;,
        return &#40;&#39;\\&#39;, &#39;--binary&#39;&#41;;
   return &#39;\\&#39;;
@@ -887,6 +890,8 @@
 	   or $os eq &#39;freebsd&#39; or $os =~ /^cygwin/&#41; {
     chomp&#40;$machine = `uname -m`&#41;;
     $machine ||= &#39;ix86&#39;;
+  } elsif &#40;&#40;$Config{archname} eq &#39;MSWin32-x86-multi-thread&#39;&#41; &#38;&#38; &#40;$Config{cc} =~ /gcc/&#41;&#41; {
+    $machine = &#39;ix86&#39;; 
   } elsif &#40;0 and $os =~ /win32/i and not $Config{gccversion}&#41; {
     # Not needed with rename of kernel1.s to kernel1.c?
     $machine = &#39;port&#39;; # Win32 compilers would not understand the assmebler anyway
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;03&nbsp;08:13:36&nbsp;2010</span>
    <span class="description">csjewell [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Unfortunately bad news as for 64bit MS Windows. When tried to compile
&gt; on this
&gt; platform &#40;64bit gcc4 toolchain from mingw-w64.sf.net&#41; i got more that
&gt; 2000 &#40;two
&gt; thousand&#41; warnings like:
&gt; - warning: cast to pointer from integer of different size
&gt; - warning: cast from pointer to integer of differ
</div>
A little incestuous, maybe, but is there a __int64 type &#40;or something of
the like, I&#39;m not looking at a C reference as I&#39;m typing, and its 0600
here&#41; that we could #ifdef &#39;int&#39; to in 64-bit builds?

[on side note: 64-bit may have to STAY in beta through April 2009
release cycle.]
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;03&nbsp;17:14:03&nbsp;2010</span>
    <span class="description">nospam-abuse [...] ilyaz.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients: ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #52146] [PATCH] Building Math::Pari on Win32/strawberry perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 3 Mar 2010 14:13:01 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> kmx via RT &lt;bug-Math-Pari [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;nospam-abuse [...] ilyaz.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed, Mar 03, 2010 at 03:46:38AM -0500, kmx via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Anyway WHAT IS IMPORTANT - I have finally prepared the smallest possible patch
&gt; for Math-Pari-2.01080603 to work with both:
&gt; 1/ 32bit gcc3 toolchain by mingw.org
&gt; 2/ 32bit gcc4 toolchain by mingw-w64.sf.net
&gt; 
&gt; See attached Math-Pari-2.01080603_kmx.patch + releasing it on CPAN.
</div>
A lot of thanks.  Included &#40;slightly modded&#41; in
Math-Pari-2.01080604.tar.gz.

Please test.

Yours,
Ilya
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;03&nbsp;18:31:31&nbsp;2010</span>
    <span class="description">nospam-abuse [...] ilyaz.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients: ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #52146] [PATCH] Building Math::Pari on Win32/strawberry perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 3 Mar 2010 15:30:34 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> kmx via RT &lt;bug-Math-Pari [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;nospam-abuse [...] ilyaz.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, Feb 11, 2010 at 02:56:55PM -0500, kmx via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Math-Pari
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=52146">https://rt.cpan.org/Ticket/Display.html?id=52146</a></span> &gt;
&gt; 
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; Have you asked at perl5portes mailing list?
</div>&gt; &gt;
&gt; &gt; I think I might have &#40;5 or 10 years ago...&#41;; can&#39;t be sure now...
</div>&gt; 
&gt; So here is my try:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.perl.org/rt3/Ticket/Display.html?id=72704">http://rt.perl.org/rt3/Ticket/Display.html?id=72704</a></span>
</div>
I see &#40;maybe you do too ;-[ &#41;.  My experience with perlbug is that the
bugs are eventually closed with &#40;practically&#41; no human intervention.

IIRC, I reported on p5p...

Yours,
Ilya
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;04&nbsp;03:17:28&nbsp;2010</span>
    <span class="description">kmx [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> csjewell [...] cpan.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; A lot of thanks.  Included (slightly modded) in <br>

&gt; Math-Pari-2.01080604.tar.gz. <br>

&gt;  <br>

&gt; Please test. <br>
</div><br>

Math-Pari-2.01080604 builds fine + all test pass on both 32bit gcc toolchains.<br>

<br>

However the latest dev version Math-Pari-2.0305_01080604a fails to build. See my patch Math-Pari-2.0304_01080603_kmx.patch enclosed ti this RT - another diff_2.3.5_mingw-w64 needs to be added).<br>

<br>

Anyway many thanks for making the stable Math::Pari version work well on Win32+gcc(3|4) platform.<br>

<br>

--<br>

kmx<br>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;04&nbsp;15:35:49&nbsp;2010</span>
    <span class="description">nospam-abuse [...] ilyaz.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> undisclosed-recipients: ;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #52146] [PATCH] Building Math::Pari on Win32/strawberry perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 4 Mar 2010 12:35:03 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> kmx via RT &lt;bug-Math-Pari [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;nospam-abuse [...] ilyaz.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, Mar 04, 2010 at 03:17:29AM -0500, kmx via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Math-Pari-2.01080604 builds fine + all test pass on both 32bit gcc toolchains.
&gt; 
&gt; However the latest dev version Math-Pari-2.0305_01080604a fails to build. See
&gt; my patch Math-Pari-2.0304_01080603_kmx.patch enclosed ti this RT - another
&gt; diff_2.3.5_mingw-w64 needs to be added&#41;.
</div>
A lot of thanks for your testing and improvements.  However, could you
please send the patch via email?

Yours,
Ilya
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;05&nbsp;00:13:45&nbsp;2010</span>
    <span class="description">kmx [...] volny.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #52146] [PATCH] Building Math::Pari on Win32/strawberry perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 05 Mar 2010 06:10:48 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Math-Pari [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> kmx &lt;kmx [...] volny.cz&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
Dne 4.3.2010 21:35, Ilya Zakharevich via RT napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=52146">https://rt.cpan.org/Ticket/Display.html?id=52146</a></span> &gt;
&gt;
&gt; On Thu, Mar 04, 2010 at 03:17:29AM -0500, kmx via RT wrote:
&gt;   
<div class="message-stanza open">&gt;&gt; Math-Pari-2.01080604 builds fine + all test pass on both 32bit gcc toolchains.
&gt;&gt;
&gt;&gt; However the latest dev version Math-Pari-2.0305_01080604a fails to build. See
&gt;&gt; my patch Math-Pari-2.0304_01080603_kmx.patch enclosed ti this RT - another
&gt;&gt; diff_2.3.5_mingw-w64 needs to be added&#41;.
&gt;&gt;     
</div>&gt; A lot of thanks for your testing and improvements.  However, could you
&gt; please send the patch via email?
&gt;   
</div>
Hi Ilya,

on top of Math-Pari-2.0305_01080604 you need to:

1/ patch utils\Math\PariBuild.pm - see attached PariBuild.pm.patch

2/ add the attached diff_2.3.5_mingw-w64 to &#39;patches&#39; subdir

--
kmx
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;12&nbsp;12:39:21&nbsp;2014</span>
    <span class="description">RIVY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Mar 05 00:13:45 2010, kmx@volny.cz wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Dne 4.3.2010 21:35, Ilya Zakharevich via RT napsal&#40;a&#41;:
<div class="message-stanza open">&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=52146">https://rt.cpan.org/Ticket/Display.html?id=52146</a></span> &gt;
&gt; &gt;
&gt; &gt; On Thu, Mar 04, 2010 at 03:17:29AM -0500, kmx via RT wrote:
&gt; &gt;
<div class="message-stanza open">&gt; &gt;&gt; Math-Pari-2.01080604 builds fine + all test pass on both 32bit gcc
&gt; &gt;&gt; toolchains.
&gt; &gt;&gt;
&gt; &gt;&gt; However the latest dev version Math-Pari-2.0305_01080604a fails to
&gt; &gt;&gt; build. See
&gt; &gt;&gt; my patch Math-Pari-2.0304_01080603_kmx.patch enclosed ti this RT -
&gt; &gt;&gt; another
&gt; &gt;&gt; diff_2.3.5_mingw-w64 needs to be added&#41;.
&gt; &gt;&gt;
</div>&gt; &gt; A lot of thanks for your testing and improvements.  However, could
&gt; &gt; you
&gt; &gt; please send the patch via email?
&gt; &gt;
</div>&gt; 
&gt; Hi Ilya,
&gt; 
&gt; on top of Math-Pari-2.0305_01080604 you need to:
&gt; 
&gt; 1/ patch utils\Math\PariBuild.pm - see attached PariBuild.pm.patch
&gt; 
&gt; 2/ add the attached diff_2.3.5_mingw-w64 to &#39;patches&#39; subdir
&gt; 
&gt; --
&gt; kmx
</div>
In email discussion with Ilya and browsing the module code, it looks like these patches were all applied long ago.

There is a more fundamental problem with the pari library code involving 64-bit compiler differences with integer / pointer sizes and indiscriminate type casting.

In newer versions of the pari library &#40;see URLref: <span class="clickylink"><a target="new" rel="nofollow" href="http://megrez.math.u-bordeaux.fr">http://megrez.math.u-bordeaux.fr</a></span>&#41;, they seem to be addressing some 64-bit issues &#40;at least, there&#39;s some 64-bit specific code&#41;. But, as it&#39;s autoconf based, it&#39;s complicated to get the library to build under Windows/gcc-mingw. And I&#39;ve been unable to accomplish a build.

Once a successful build/test of the original pari library code is accomplished within Windows/gcc-mingw &#40;64-bit&#41;, patches to this module might succeed. But I doubt it&#39;ll ever happen unless that is done first.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;17&nbsp;11:18:28&nbsp;2014</span>
    <span class="description">vvm [...] tut.by -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> &#34;Ilya Zakharevich&#34; &lt;ilya [...] math.berkeley.edu&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Fw: Building Math::Pari on Strawberry Perl on 64bit MS Windows &#40; rt.cpan.org #52146&#41;  Fw: 64bit MS Windows Re: [rt.cpan.org #52146] [PATCH] Building Math::Pari on Win32/strawberry perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 17 Apr 2014 18:17:58 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;\&#34;Ilya Zakharevich via RT\&#34;&#34; &lt;bug-Math-Pari [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Victor Miasnikov&#34; &lt;vvm [...] tut.by&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;17&nbsp;11:31:52&nbsp;2014</span>
    <span class="description">vvm [...] tut.by -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Fw: 64bit MS Windows Re: [rt.cpan.org #52146] [PATCH] Building Math::Pari on Win32/strawberry perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 17 Apr 2014 18:31:34 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;\&#34;Ilya Zakharevich via RT\&#34;&#34; &lt;bug-Math-Pari [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Victor Miasnikov&#34; &lt;vvm [...] tut.by&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi!

==
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Math::Pari needs heavy patching - namely the underlaying pari library is
&gt; absolutely not ready for MSWin/x64 where sizeof&#40;int&#41; != sizeof&#40;void*&#41;
</div>

 But
sizeof&#40; long long&#41; = sizeof&#40;void*&#41;
==


 Problem:
==
The point is that on 64bit MS Windows there is:
- size of int = 4 bytes &#40;!!!&#41;
- size of *void = 8 bytes
==


 May be solution:
==
  . . .
+#define PARITEMPL_O_NG&#40;x&#41; &#40;x##LL&#41;
+#define PARITEMPUL_O_NG&#40;x&#41; &#40;x##ULL&#41;
+typedef long long paritemplong_t;
+
+typedef long long mp_l_o_ng;
+typedef unsigned long long mp_ul_o_ng;

  . . .
==


<span class="clickylink"><a target="new" rel="nofollow" href="http://pari.math.u-bordeaux.fr/archives/pari-dev-0907/msg00003.html">http://pari.math.u-bordeaux.fr/archives/pari-dev-0907/msg00003.html</a></span>
 =}
===
From: Jason Moxham
...
I&#39;ve got Pari-svn running on Windows with/without GMP/MPIR in 64bit mode. This 
is with MSVC , and when MinGW/MSYS goes 64bit it will work with that :&#41;
The main problem with Windows64 is that it uses a LLP data model rather than 
the usual LP data model , this means that long&#39;s are 32 bit. I&#39;m doing this 
for the Sage project but it would be nice if the changes could be 
incorporated back into Pari , so I propose this.

Introduce a new type and macro &#40; with signed and unsigned versions&#41;
typedef long paritemplong_t;
#define PARITEMPLONG&#40;x&#41; &#40;x##L&#41;

replace all occurances of long with paritemplong_t and   numberL with 
PARITEMPLONG&#40;number&#41;

The above is all just simple text replacement and although it means changes to 
every file it will have no &#34;real&#34; changes.

Then for WIN64 only we change the definition

typedef long long paritemplong_t;
#define PARITEMPLONG&#40;x&#41; &#40;x##LL&#41;
...
===

  +

==
 . . .
On Mon, Nov 04, 2002 at 08:07:31PM +0100, Bill Allombert wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Fri, Nov 01, 2002 at 12:13:16AM -0800, Ilya Zakharevich wrote:
<div class="message-stanza open">&gt; &gt; On which architectures can PARI run with sizeof&#40;long&#41; &gt; sizeof&#40;long*&#41;?
&gt; &gt; I tested, and it does not work on x86.
</div>&gt; 
&gt; None, as far as I know.
&gt; None of the 11 architectures I have access to exhibit this behaviour.
</div>
This patch kinda-allows compiling with GEN = long long*.  The result
of make bench is
  . . .
==


===
...
Before applying the patch, a massive replace should be made, e.g., by
running &#40;pfind is available from my directory &#39;scripts&#39; on CPAN&#41;:

pfind src &#39;/\.[ch]$/&#39; &#39;=~ s/\b&#40;unsigned\s+|u&#41;long\b/PARI_uword/g&#39;
pfind src &#39;/\.[ch]$/&#39; &#39;=~ s/\blong\b/PARI_word/g&#39;
pfind src &#39;/\.[ch]$/&#39; &#39;=~ s/\b&#40;\d+|0[0-7]+|0x[\da-fA-F]&#41;&#40;U?&#41;L\b/as_${2}WORD&#40;$1&#41;/g&#39;
pfind src &#39;/\.[ch]$/&#39;  &#39;=~ s/&#40;%[.0-9]*&#41;l&#40;[ux]&#41;\&#34;/$1\&#34;UW${2}f/g&#39;
pfind src &#39;/\.[ch]$/&#39;  &#39;=~ s/&#40;%[.0-9]*&#41;l&#40;[d]&#41;\&#34;/$1\&#34;IW${2}f/g&#39;
pfind src &#39;/\.[ch]$/&#39;  &#39;=~ s/&#40;%[.0-9]*&#41;l&#40;[ux]&#41;/$1\&#34;UW${2}f\&#34;/g&#39;
pfind src &#39;/\.[ch]$/&#39;  &#39;=~ s/&#40;%[.0-9]*&#41;l&#40;[d]&#41;/$1\&#34;IW${2}f\&#34;/g&#39;
...
===

 . . .
==



Best regards, Victor Miasnikov
Blog:  <span class="clickylink"><a target="new" rel="nofollow" href="http://vvm.blog.tut.by/">http://vvm.blog.tut.by/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;25&nbsp;04:20:27&nbsp;2014</span>
    <span class="description">nospam-abuse [...] ilyaz.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: Fw: 64bit MS Windows Re: [rt.cpan.org #52146] [PATCH] Building Math::Pari on Win32/strawberry perl</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 25 Apr 2014 01:20:15 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Victor Miasnikov via RT &lt;bug-Math-Pari [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Ilya Zakharevich &lt;nospam-abuse [...] ilyaz.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, Apr 17, 2014 at 11:31:52AM -0400, Victor Miasnikov via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Math-Pari
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=52146">https://rt.cpan.org/Ticket/Display.html?id=52146</a></span> &gt;
&gt; 
&gt; Hi!
&gt; 
&gt; ==
<div class="message-stanza open">&gt; &gt; Math::Pari needs heavy patching - namely the underlaying pari library is
&gt; &gt; absolutely not ready for MSWin/x64 where sizeof&#40;int&#41; != sizeof&#40;void*&#41;
</div>&gt; 
&gt; 
&gt;  But
&gt; sizeof&#40; long long&#41; = sizeof&#40;void*&#41;
&gt; ==
&gt; 
&gt; 
&gt;  Problem:
&gt; ==
&gt; The point is that on 64bit MS Windows there is:
&gt; - size of int = 4 bytes &#40;!!!&#41;
&gt; - size of *void = 8 bytes
&gt; ==
&gt; 
&gt; 
&gt;  May be solution:
</div>
Sorry, Victor,

It looks like in the foreseeable future I would not be able to spend
much time on PARI.

Thanks,
Ilya
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
