<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #66386 for Google-Voice: PATCH: Enable and disable phones</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #66386 for Google-Voice: PATCH: Enable and disable phones</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Google-Voice/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Google-Voice/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Google-Voice/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Google-Voice/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Google-Voice">Google-Voice CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">66386</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">new</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Google-Voice/Active/">Google-Voice</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
bitcard.org [...] munkynet.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-234872-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.02    </td>
  </tr>
  <tr id="CF-234873-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;04&nbsp;15:04:59&nbsp;2011</span>
    <span class="description">bitcard.org [...] munkynet.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> PATCH: Enable and disable phones</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Added a call in the login method to fetch phone info.

Added methods enable_phone and disable_phone which take phone names. They look up the 
name in the phone info. In the case where more than one phone has the same name, only one of 
them is enabled or disabled. &#40;This could be considered a bug.&#41;

Hope you find this useful.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> p5-google-voice-enable-disable-phones.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -ur Google-Voice-0.02/lib/Google/Voice.pm Google-Voice-0.02.NEW/lib/Google/Voice.pm
--- Google-Voice-0.02/lib/Google/Voice.pm	2011-02-21 22:44:30.000000000 -0500
+++ Google-Voice-0.02.NEW/lib/Google/Voice.pm	2011-03-04 14:55:19.000000000 -0500
@@ -5,6 +5,7 @@
 
 use Mojo::Client;
 use Mojo::JSON;
+use Mojo::URL;
 use IO::Socket::SSL 1.37;
 
 use Google::Voice::Feed;
@@ -14,7 +15,7 @@
 
 our $VERSION = 0.02;
 
-__PACKAGE__-&gt;attr&#40;[qw/ client rnr_se /]&#41;;
+__PACKAGE__-&gt;attr&#40;[qw/ client rnr_se phones /]&#41;;
 
 sub new {
     my $self = bless {}, shift;
@@ -54,6 +55,12 @@
     return unless $el;
 
     $self-&gt;rnr_se&#40;$el-&gt;attrs-&gt;{value}&#41;;
+    
+    #sam# Get phone info for later enable/disable operations
+    my $cfg = Mojo::JSON-&gt;new-&gt;decode&#40;
+    	$c-&gt;get&#40;&#39;<span class="clickylink"><a target="new" rel="nofollow" href="https://www.google.com/voice/settings/tab/phones&#39;&#41;">https://www.google.com/voice/settings/tab/phones&#39;&#41;</a></span>
+    		-&gt;res-&gt;dom-&gt;at&#40;&#39;json&#39;&#41;-&gt;text&#41;;
+    $self-&gt;phones&#40;$cfg-&gt;{phones}&#41;;
 
     return $self;
 }
@@ -129,6 +136,42 @@
     return Google::Voice::Call-&gt;new&#40;@_, $self-&gt;rnr_se, $self-&gt;client&#41;;
 }
 
+sub enable_phone {
+	return &#40;shift&#41;-&gt;_enable_or_disable_phone&#40;1, @_&#41;;
+}
+
+sub disable_phone {
+	return &#40;shift&#41;-&gt;_enable_or_disable_phone&#40;0, @_&#41;;
+}
+
+sub _find_phone_by_name {
+	my $self = shift;
+	my &#40;$name&#41; = @_;
+	
+	my &#40;$id&#41; = grep { $self-&gt;{phones}{$_}{name} eq $name } keys %{$self-&gt;phones};
+	return $id;
+}
+
+sub _enable_or_disable_phone {
+	my $self = shift;
+	my &#40;$state, $name&#41; = @_;
+	
+	my $id = $self-&gt;_find_phone_by_name&#40;$name&#41;;
+	die &#34;$name: phone not found&#34; unless defined $id;
+	
+    my $json = $self-&gt;client-&gt;post_form&#40;
+        &#39;<span class="clickylink"><a target="new" rel="nofollow" href="https://www.google.com/voice/settings/editDefaultForwarding/&#39;">https://www.google.com/voice/settings/editDefaultForwarding/&#39;</a></span> =&gt; {
+            phoneId =&gt; $id,
+            enabled =&gt; $state,
+            _rnr_se =&gt; $self-&gt;rnr_se
+        }
+    &#41;-&gt;res-&gt;json;
+    
+    $@ = $json-&gt;{error} and return unless $json-&gt;{ok};
+    
+    return $state;
+}
+
 1;
 
 =head1 NAME
</div></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
