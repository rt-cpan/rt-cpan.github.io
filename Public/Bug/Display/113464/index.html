<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #113464 for MailTools: Mail::Header incorrect decoding</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #113464 for MailTools: Mail::Header incorrect decoding</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=MailTools">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=MailTools">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=MailTools">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=MailTools">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/MailTools">MailTools CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">113464</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=MailTools">MailTools</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
andrew [...] topdog.za.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-20244-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-20245-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
2.15    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




MailTools-2.15.tar.gz<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1617969/866245/MailTools-2.15.tar.gz">
Fri Apr 15 03:59:48 2016 (53.8k) by Mark [...] Overmeer.net
</a>
</font></li>
</ul>


signature.asc<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1613702/863648/signature.asc">
Fri Apr 01 23:14:38 2016 (181b) by mark [...] msapiro.net
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/1613056/863203/signature.asc">
Wed Mar 30 18:31:32 2016 (841b) by andrew [...] topdog.za.net
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/1613036/863188/signature.asc">
Wed Mar 30 18:02:47 2016 (841b) by andrew [...] topdog.za.net
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/1613029/863180/signature.asc">
Wed Mar 30 17:31:48 2016 (841b) by andrew [...] topdog.za.net
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=113464">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1613029" href="/Public/Bug/Display.html?id=113464#txn-1613029">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;30&nbsp;17:31:48&nbsp;2016</span>
    <span class="description">andrew [...] topdog.za.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Mail::Header incorrect decoding</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 30 Mar 2016 23:31:25 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-MailTools [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Andrew Colin Kissa &lt;andrew [...] topdog.za.net&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1613029/863179/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/863179">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi

Messages containing crafted mime headers do not get decoded correctly allowing for
malware loaded attachments to slip through filtering systems.

Content-Disposition: attachment; filename=&#34;Kebbekus1958_payment_38C587.rar&#34;
Content-Type: application/x-rar-compressed; x-unix-mode=0600;
name=&#34;Kebbekus1958_payment_38C587.rar&#34;
Content-Transfer-Encoding: base64

When a message with the above is parsed, the file Kebbekus1958_payment_38C587.rar
contains the base64 encoded data instead of the actual RAR file.

The proper mime header i believe should be.

Content-Disposition: attachment; filename=&#34;Kebbekus1958_payment_38C587.rar&#34;
Content-Type: application/x-rar-compressed; x-unix-mode=0600;
       name=&#34;Kebbekus1958_payment_38C587.rar&#34;
Content-Transfer-Encoding: base64

Because the attachment is not decoded correctly, systems that extract archives to
check files inside can be bypassed to deliver malware payloads in the archive
attachments.

Maintainer of MIME-Tools indicates the issue is in Mail::Header and suggested i
report this to the upstream which is MailTools.

- Andrew
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1613029/863180/signature.asc">Download signature.asc</a><br />
<span class="downloadcontenttype">application/pgp-signature 841b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1613032" href="/Public/Bug/Display.html?id=113464#txn-1613032">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;30&nbsp;17:54:31&nbsp;2016</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #113464] Mail::Header incorrect decoding</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 30 Mar 2016 23:54:13 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Andrew Colin Kissa via RT &lt;bug-MailTools [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1613032/863183/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/863183">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Andrew Colin Kissa via RT &#40;bug-MailTools@rt.cpan.org&#41; [160330 21:32]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Wed Mar 30 17:31:48 2016: Request 113464 was acted upon.
&gt; Transaction: Ticket created by andrew@topdog.za.net
&gt;        Queue: MailTools
&gt;      Subject: Mail::Header incorrect decoding
&gt;   Requestors: andrew@topdog.za.net
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=113464">https://rt.cpan.org/Ticket/Display.html?id=113464</a></span> &gt;
&gt; 
&gt; Messages containing crafted mime headers do not get decoded correctly
&gt; allowing for malware loaded attachments to slip through filtering systems.
&gt; 
&gt; Content-Disposition: attachment; filename=&#34;Kebbekus1958_payment_38C587.rar&#34;
&gt; Content-Type: application/x-rar-compressed; x-unix-mode=0600;
&gt;    name=&#34;Kebbekus1958_payment_38C587.rar&#34;
&gt; Content-Transfer-Encoding: base64
&gt; 
&gt; When a message with the above is parsed, the file
&gt; Kebbekus1958_payment_38C587.rar
&gt; contains the base64 encoded data instead of the actual RAR file.
</div>
Yes: Mail::Header is 30 years old, even before MIME was published as
RFC.  It does not handle Content-Transfer-Encoding.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The proper mime header i believe should be.
&gt; 
&gt; Content-Disposition: attachment; filename=&#34;Kebbekus1958_payment_38C587.rar&#34;
&gt; Content-Type: application/x-rar-compressed; x-unix-mode=0600;
&gt;        name=&#34;Kebbekus1958_payment_38C587.rar&#34;
&gt; Content-Transfer-Encoding: base64
</div>
I do not see the difference.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Because the attachment is not decoded correctly, systems that extract
&gt; archives to check files inside can be bypassed to deliver malware payloads
&gt; in the archive attachments.
</div>
If the application uses any MailTools component alone, it will not be able
to process complex messages.  Applications based on MailTools modules need
additional logic to look at the MIME headers for additional processing,
like base64 decoding.  For instance, MIME-Tools logic.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Maintainer of MIME-Tools indicates the issue is in Mail::Header and
&gt; suggested i report this to the upstream which is MailTools.
</div>
I see no way to exploit this.  Can you detail you someone would be
able to use it?

I advice everyone not to use this ancient module for process modern
emails.  There are many very capable alternatives on CPAN, like MailBox.
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1613033" href="/Public/Bug/Display.html?id=113464#txn-1613033">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;30&nbsp;17:54:31&nbsp;2016</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1613036" href="/Public/Bug/Display.html?id=113464#txn-1613036">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;30&nbsp;18:02:47&nbsp;2016</span>
    <span class="description">andrew [...] topdog.za.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #113464] Mail::Header incorrect decoding</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 31 Mar 2016 00:02:32 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-MailTools [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Andrew Colin Kissa &lt;andrew [...] topdog.za.net&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1613036/863187/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/863187">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 358b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On 30 Mar 2016, at 11:54 PM, &#34;Mark Overmeer via RT&#34; &lt;bug-MailTools@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I see no way to exploit this.  Can you detail you someone would be
&gt; able to use it?
</div>
It is not an exploit per say, the bug is used to bypass filtering of prohibited attachments,
which then reach the end user who may open the attachment and get infected by malware.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1613036/863188/signature.asc">Download signature.asc</a><br />
<span class="downloadcontenttype">application/pgp-signature 841b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1613053" href="/Public/Bug/Display.html?id=113464#txn-1613053">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;30&nbsp;18:25:56&nbsp;2016</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #113464] Mail::Header incorrect decoding</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 31 Mar 2016 00:25:33 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Andrew Colin Kissa via RT &lt;bug-MailTools [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1613053/863198/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/863198">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Andrew Colin Kissa via RT &#40;bug-MailTools@rt.cpan.org&#41; [160330 22:04]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: MailTools
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=113464">https://rt.cpan.org/Ticket/Display.html?id=113464</a></span> &gt;
&gt; 
<div class="message-stanza open">&gt; &gt; I see no way to exploit this.  Can you detail you someone would be
&gt; &gt; able to use it?
</div>&gt; 
&gt; It is not an exploit per say, the bug is used to bypass filtering
&gt; of prohibited attachments,
&gt; which then reach the end user who may open the attachment and get
&gt; infected by malware.
</div>
Why would it by-pass the filters?

An application which scans for spam and malware must first prepare the
content of the message to make it possible to scan.  Well, when that
code uses MailTools, it needs to do the base64 decoing itself.  If it
does not, that application has a bug.  It&#39;s not MailTools fault if it
is used incorrectly.  It&#39;s a very limited module.

So: no, lacking of handling of Content-Transfer-Encoding does not
not have any effect on filtering software.
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1613056" href="/Public/Bug/Display.html?id=113464#txn-1613056">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;30&nbsp;18:31:32&nbsp;2016</span>
    <span class="description">andrew [...] topdog.za.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #113464] Mail::Header incorrect decoding</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 31 Mar 2016 00:31:17 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-MailTools [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Andrew Colin Kissa &lt;andrew [...] topdog.za.net&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1613056/863202/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/863202">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 520b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On 31 Mar 2016, at 12:25 AM, &#34;Mark Overmeer via RT&#34; &lt;bug-MailTools@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; An application which scans for spam and malware must first prepare the
&gt; content of the message to make it possible to scan.  Well, when that
&gt; code uses MailTools, it needs to do the base64 decoing itself.  If it
&gt; does not, that application has a bug.  It&#39;s not MailTools fault if it
&gt; is used incorrectly.  It&#39;s a very limited module.
</div>
Thanks, i guess this needs to be fixed in MIME-Tools which is what sub classes
MailTools.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1613056/863203/signature.asc">Download signature.asc</a><br />
<span class="downloadcontenttype">application/pgp-signature 841b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1613081" href="/Public/Bug/Display.html?id=113464#txn-1613081">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;30&nbsp;18:49:48&nbsp;2016</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #113464] Mail::Header incorrect decoding</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 31 Mar 2016 00:49:35 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Andrew Colin Kissa via RT &lt;bug-MailTools [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1613081/863214/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/863214">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Andrew Colin Kissa via RT &#40;bug-MailTools@rt.cpan.org&#41; [160330 22:31]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: MailTools
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=113464">https://rt.cpan.org/Ticket/Display.html?id=113464</a></span> &gt;
&gt; 
&gt; Thanks, i guess this needs to be fixed in MIME-Tools which is what
&gt; sub classes MailTools.
</div>
I have no knowledge about MIME-Tools, but a quick scan shows
<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~dskoll/MIME-tools-5.507/lib/MIME/Body.pm">http://search.cpan.org/~dskoll/MIME-tools-5.507/lib/MIME/Body.pm</a></span>

   ### Dump the ENCODED body data to a filehandle:
   $body-&gt;print&#40;\*STDOUT&#41;;

   ### Slurp all the UNENCODED data in, and put it in a scalar:
   $string = $body-&gt;as_string;

   ### Slurp all the UNENCODED data in, and put it in an array of lines:
   @lines = $body-&gt;as_lines;

So, the latted two options are documented to decode base64, and the
first is not.  It is documented, hence not a bug of the module.
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1613086" href="/Public/Bug/Display.html?id=113464#txn-1613086">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;30&nbsp;19:02:23&nbsp;2016</span>
    <span class="description">dfs+pause [...] roaringpenguin.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1613086/863219/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/863219">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 871b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

No, here&#39;s the issue... Mail::Header stops parsing headers if it encounters
the line:

name=&#34;whatever&#34;;

because it doesn&#39;t match the $FIELD_NAME regex.  It should really
only stop when it hits a blank line &#40;or have an option to do so.&#41;

I don&#39;t really know how it can intelligently handle a malformed line
in the middle of a bunch of headers.  Ignore it, maybe?  Report it back
somehow?

To summarize, when Mail::Header is fed:

Content-Disposition: attachment; filename=&#34;Kebbekus1958_payment_38C587.rar&#34;
Content-Type: application/x-rar-compressed; x-unix-mode=0600;
name=&#34;Kebbekus1958_payment_38C587.rar&#34;
Content-Transfer-Encoding: base64

It stops at the name= line and the only headers we get back are:

Content-Disposition: attachment; filename=&#34;Kebbekus1958_payment_38C587.rar&#34;
Content-Type: application/x-rar-compressed; x-unix-mode=0600;

Regards,

Dianne.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1613089" href="/Public/Bug/Display.html?id=113464#txn-1613089">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;30&nbsp;19:10:20&nbsp;2016</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #113464] Mail::Header incorrect decoding</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 31 Mar 2016 01:10:01 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Dianne Skoll via RT &lt;bug-MailTools [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1613089/863222/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/863222">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Dianne Skoll via RT &#40;bug-MailTools@rt.cpan.org&#41; [160330 23:02]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: MailTools
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=113464">https://rt.cpan.org/Ticket/Display.html?id=113464</a></span> &gt;
&gt; 
&gt; No, here&#39;s the issue... Mail::Header stops parsing headers if it encounters
&gt; the line:
&gt; name=&#34;whatever&#34;;
&gt; 
&gt; because it doesn&#39;t match the $FIELD_NAME regex.  It should really
&gt; only stop when it hits a blank line &#40;or have an option to do so.&#41;
&gt; 
&gt; I don&#39;t really know how it can intelligently handle a malformed line
&gt; in the middle of a bunch of headers.  Ignore it, maybe?  Report it back
&gt; somehow?
</div>
Ah, that&#39;s a clearer report.

Usually, you stop when you cannot handle mistakes automatically.  Do the
other lines end-up in the body?  I have no idea about the logic you use
around it: there are a many ways.

As far as I can see in the code, you get

    croak &#34;Bad RFC822 field name &#39;$tag&#39;\n&#34;;

So, the program needs to eval the header reading, and decide what to do.
Probably best to trash the whole message.
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1613702" href="/Public/Bug/Display.html?id=113464#txn-1613702">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;01&nbsp;23:14:38&nbsp;2016</span>
    <span class="description">mark [...] msapiro.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #113464] Mail::Header incorrect decoding</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 1 Apr 2016 20:14:16 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-MailTools [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Sapiro &lt;mark [...] msapiro.net&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #113464] Mail::Header incorrect decoding</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-MailTools [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Sapiro &lt;mark [...] msapiro.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1613702/863647/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/863647">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dianne wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; To summarize, when Mail::Header is fed:
&gt; 
&gt; Content-Disposition: attachment; filename=&#34;Kebbekus1958_payment_38C587.rar&#34;
&gt; Content-Type: application/x-rar-compressed; x-unix-mode=0600;
&gt; name=&#34;Kebbekus1958_payment_38C587.rar&#34;
&gt; Content-Transfer-Encoding: base64
&gt; 
&gt; It stops at the name= line and the only headers we get back are:
&gt; 
&gt; Content-Disposition: attachment; filename=&#34;Kebbekus1958_payment_38C587.rar&#34;
&gt; Content-Type: application/x-rar-compressed; x-unix-mode=0600;
</div>

Just to add a bit, this issue exists with both the extract method and
the read method of Mail::Header.

The issue is that the first line encountered which is not a continuation
of a folded header &#40;begins with whitespace&#41; or a &#39;Field-Name:&#39; line
stops processing of the headers. RFC 5322, section 2.1 and it&#39;s
predecessors are clear that only an empty line marks the end of the headers.

Granted there are broken agents that may not leave an empty line at the
end of the headers, but at least the code could look ahead at the line
following the non-whitespace, non-header line and if that is a
&#39;Field-Name:&#39; line, continue processing with it.

-- 
Mark Sapiro &lt;mark@msapiro.net&gt;        The highway is for gamblers,
San Francisco Bay Area, California    better use your sense - B. Dylan
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1613702/863648/signature.asc">Download signature.asc</a><br />
<span class="downloadcontenttype">application/pgp-signature 181b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1614660" href="/Public/Bug/Display.html?id=113464#txn-1614660">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;04&nbsp;09:40:59&nbsp;2016</span>
    <span class="description">cpan [...] perl.wizbit.be -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> cpan [...] perl.wizbit.be</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1614660/864258/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/864258">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As far as I can see in the code, you get
&gt; 
&gt; croak &#34;Bad RFC822 field name &#39;$tag&#39;\n&#34;;
&gt; 
&gt; So, the program needs to eval the header reading, and decide what to
&gt; do.
&gt; Probably best to trash the whole message.
</div>
That does not appear to be the case..

Since example code is always clearer:


#!/usr/bin/perl

use strict;
use warnings;
use Mail::Header;
use File::Temp qw# tempfile #;


my $headers = &lt;&lt;EOF;
Content-Disposition: inline; filename=&#34;testing.txt&#34;
Content-Type: text/ascii; x-unix-mode=0600;
name=&#34;testing.txt&#34;
Content-Transfer-Encoding: base64

EOF

my &#40;$fh_out, $filename&#41; = tempfile&#40;&#41;;
print $fh_out $headers;
close $fh_out;

open my $fh_in, &#34;&lt;&#34;, $filename or die &#34;Can&#39;t open $filename: $!&#34;;


my $obj = Mail::Header-&gt;new&#40;[ split m/\n/, $headers ]&#41;;
print &#34;Extract method:\n&#34;;
print &#34;---------------\n&#34;;
print $obj-&gt;as_string, &#34;\n&#34;;
print &#34;\n&#34;;

print &#34;Read method:\n&#34;;
print &#34;------------\n&#34;;
my $obj2 = Mail::Header-&gt;new&#40;$fh_in&#41;;
print $obj2-&gt;as_string, &#34;\n&#34;;


__END__

Running this will show:
        Extract method:
        ---------------
        Content-Disposition: inline; filename=&#34;testing.txt&#34;
        Content-Type: text/ascii; x-unix-mode=0600;
        
        
        Read method:
        ------------
        Content-Disposition: inline; filename=&#34;testing.txt&#34;
        Content-Type: text/ascii; x-unix-mode=0600;
        
        
        
=&gt; No fatal error is given;

When this module is used via MIME::Parser: it has extra code to detect that Mail::Header did not consume all input &#40;and thus all headers&#41;; it does flag this as an error but in the default configuration it continues processing the message.

The body that followed after the above header was base64 encoded, MIME::Parser however will not base64 decode it since the parsed headers do *not* include &#39;Content-Transfer-Encoding: base64&#39;.
Checking with some mail clients: &#40;i.e. mime part with the above headers + base64 encoded content&#41;: both Outlook and Thunderbird are forgiving and base64 decodes the attachment anyway..

There is a case to be made to fixing this but I guess there is also a case to be made for not fixing it &#40;since it are not valid headers&#41;..
Looking at this from the point of view of a mail filter such as amavisd: it uses MIME::Parser &#40;which then uses Mail::Header&#41;
amavisd does check the result of MIME::Parser &#40;which did record the error&#41; and in a default setup it would reject the mail because of the bad header;
The bad header check however can be disabled &#40;or address can be white-listed&#41; and if that happens then other features of amavisd will no longer work correctly..
For example: if the attachment is a ZIP archive then it will attempt to extract it but if the headers are mangled then this will not work since the body is still base64 encoded which will make it impossible to extract/check the archive.. &#40;i.e. virus scanning&#41;



Possible patch:

--- Mail/Header.pm.orig 2016-04-04 12:36:23.000000000 +0200
+++ Mail/Header.pm      2016-04-04 15:20:36.000000000 +0200
@@ -282,9 +282,11 @@
 {   my &#40;$self, $lines&#41; = @_;
     $self-&gt;empty;
 
-    while&#40;@$lines &#38;&#38; $lines-&gt;[0] =~ /^&#40;$FIELD_NAME|From &#41;/o&#41;
-    {    my $tag  = $1;
-         my $line = shift @$lines;
+    while&#40;@$lines&#41;
+    {    my $line = shift @$lines;
+         $line =~ /^&#40;$FIELD_NAME|From &#41;/o or next;
+         my $tag  = $1;
+
          $line   .= shift @$lines
              while @$lines &#38;&#38; $lines-&gt;[0] =~ /^[ \t]+/o;
 
@@ -320,10 +322,12 @@
         {   &#40;$tag, $line&#41; = _fmt_line $self, $tag, $line;
             _insert $self, $tag, $line, -1
                if defined $line;
+            $line = undef;
+            $tag = undef;          
         }
 
-        defined $ln &#38;&#38; $ln =~ /^&#40;$FIELD_NAME|From &#41;/o
-            or last;
+        defined $ln or last;
+        $ln =~ /^&#40;$FIELD_NAME|From &#41;/o or next;
 
         &#40;$tag, $line&#41; = &#40;$1, $ln&#41;;
     }



Running with the above script:
        Extract method:
        ---------------
        Content-Disposition: inline; filename=&#34;testing.txt&#34;
        Content-Type: text/ascii; x-unix-mode=0600;
        Content-Transfer-Encoding: base64


        Read method:
        ------------
        Content-Disposition: inline; filename=&#34;testing.txt&#34;
        Content-Type: text/ascii; x-unix-mode=0600;
        Content-Transfer-Encoding: base64
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1614873" href="/Public/Bug/Display.html?id=113464#txn-1614873">#</a>      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;05&nbsp;10:42:47&nbsp;2016</span>
    <span class="description">mark [...] nluug.nl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #113464] Mail::Header incorrect decoding</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 5 Apr 2016 16:41:27 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;cpan [...] perl.wizbit.be via RT&#34; &lt;bug-MailTools [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] nluug.nl&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1614873/864387/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/864387">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">* cpan@perl.wizbit.be via RT &#40;bug-MailTools@rt.cpan.org&#41; [160404 13:41]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; That does not appear to be the case..
</div>
I cannot deny someone who put so much effort in it ;-&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; =&gt; No fatal error is given;
</div>
_fmt_line does that, but apparently only when the field-name gets
accepted first.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; both Outlook and Thunderbird are forgiving and base64 decodes the
&gt; attachment anyway..
</div>
Wow, that looks to me as a security risk.  You cannot expect all virus/spam-
filters to do the same.  Amavisd should also get this automatic behavior to
be safe.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Possible patch:
</div>
Patch applied with small change:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; @@ -320,10 +322,12 @@
&gt;          {   &#40;$tag, $line&#41; = _fmt_line $self, $tag, $line;
&gt;              _insert $self, $tag, $line, -1
&gt;               if defined $line;
&gt; +            $line = undef;
&gt; +            $tag = undef;          
</div>
               &#40;$line, $tag&#41; = &#40;&#41;;

We could also add the fragment which is incorrectly folder to its field
line... but that may have security consequences as well.  I think that
throwing it away is safer.

When you agree, I&#39;ll make a release
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1615148" href="/Public/Bug/Display.html?id=113464#txn-1615148">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;06&nbsp;15:39:41&nbsp;2016</span>
    <span class="description">cpan [...] perl.wizbit.be -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> cpan [...] perl.wizbit.be</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1615148/864545/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/864545">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; We could also add the fragment which is incorrectly folder to its field
&gt; line... but that may have security consequences as well.  I think that
&gt; throwing it away is safer.
&gt; 
</div>
I have no real opinion about that; for my use case the fragment is irrelevant so throwing it away is good; adding it to the previous line would also be good..


But thinking about the issue and patch some more:

There might be two extra things that need to be considered:

a&#41; &#40;ab&#41;using Mail::Header to detect incorrect MIME headers

Before the patch Mail::Header would stop processing the input and this made it possible to detect
that the headers were not fully correct.

Of course this lead to the bug of missing headers.
After the patch the valid headers are added &#40;which is good&#41; but there is no indication that some of the content was bogus..

The docs of the module does mention:
        &#34;Mail::Header does not always follow the RFCs strict enough, ...&#34;

So someone using it to check that a message follows the RFCs would already be missing some cases I guess..
I suppose extra code could be added to set a particular flag and/or an extra method to check the value of this flag..
Not sure how good/clean that would be..


b&#41; using Mail::Header on the full mail message

When someone uses Mail::Header on the full email message &#40;and not just on the headers&#41; then it would result in a different behaviour..

Consider the code:

        #!/usr/bin/perl
        
        use strict;
        use warnings;
        use Mail::Header;
        use File::Temp qw# tempfile #;
        
        
        my $msg = &lt;&lt;EOF;
        Subject: foo
        From: &lt;bar\@bar.bar&gt;
        Content-Type: text/plain
        
        This is the
        mail body
        Foo: bar
        baz
        
        EOF
        
        my &#40;$fh_out, $filename&#41; = tempfile&#40;&#41;;
        print $fh_out $msg;
        close $fh_out;
        
        open my $fh_in, &#34;&lt;&#34;, $filename or die &#34;Can&#39;t open $filename: $!&#34;;
        
        my @headers = split m/\n/, $msg;
        my $obj = Mail::Header-&gt;new&#40;&#41;;
        $obj-&gt;extract&#40;\@headers&#41;;
        print &#34;Extract method &#40;headers&#41;:\n&#34;;
        print &#34;-------------------------\n&#34;;
        print $obj-&gt;as_string, &#34;\n&#34;;
        print &#34;\n&#34;;
        print &#34;Extract method &#40;body&#41;:\n&#34;;
        print &#34;----------------------\n&#34;;
        print join&#40;&#34;\n&#34;, @headers, &#34;&#34;&#41;;
        print &#34;\n&#34;;
        print &#34;\n&#34;;
        
        
        print &#34;Read method &#40;headers&#41;:\n&#34;;
        print &#34;----------------------\n&#34;;
        my $obj2 = Mail::Header-&gt;new&#40;$fh_in&#41;;
        print $obj2-&gt;as_string, &#34;\n&#34;;
        
        my $body = do { local $/; &lt;$fh_in&gt; };
        $body = &#34;&#34; if not defined $body;
        
        print &#34;Read method &#40;body&#41;:\n&#34;;
        print &#34;-------------------\n&#34;;
        print $body;
        
        __END__


Before the patch this would output:
        Extract method &#40;headers&#41;:
        -------------------------
        Subject: foo
        From: &lt;bar@bar.bar&gt;
        Content-Type: text/plain
        
        
        Extract method &#40;body&#41;:
        ----------------------
        This is the
        mail body
        Foo: bar
        baz
        
        
        Read method &#40;headers&#41;:
        ----------------------
        Subject: foo
        From: &lt;bar@bar.bar&gt;
        Content-Type: text/plain
        
        Read method &#40;body&#41;:
        -------------------
        This is the
        mail body
        Foo: bar
        baz
        
        

After the patch the output would be:
        Extract method &#40;headers&#41;:
        -------------------------
        Subject: foo
        From: &lt;bar@bar.bar&gt;
        Content-Type: text/plain
        Foo: bar
        
        
        Extract method &#40;body&#41;:
        ----------------------
        
        
        Read method &#40;headers&#41;:
        ----------------------
        Subject: foo
        From: &lt;bar@bar.bar&gt;
        Content-Type: text/plain
        Foo: bar
        
        Read method &#40;body&#41;:
        -------------------

So for someone &#40;ab&#41;using Mail::Header in that way the patch may break their code...
Of course their code is already broken in case there are invalid headers

What I do not know:
* is there anyone that &#40;ab&#41;uses Mail::Header in such way?
* is this behaviour that you want to support/maintain/recommend?
* ...

A possible &#39;fix&#39; for it would be to stop at and empty line..
i.e. for the extract method:
         $line !~ /\A\Z/o or last;
         $line =~ /^&#40;$FIELD_NAME|From &#41;/o or next;
         my $tag  = $1;

and for the read method:
        defined $ln or last;                   
        $ln !~ /\A\Z/o or last;                
        $ln =~ /^&#40;$FIELD_NAME|From &#41;/o or next;

i.e.:
* stop on an empty line
* skip invalid headers
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1617969" href="/Public/Bug/Display.html?id=113464#txn-1617969">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;15&nbsp;03:59:48&nbsp;2016</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #113464] Mail::Header incorrect decoding</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 15 Apr 2016 09:59:32 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;cpan [...] perl.wizbit.be via RT&#34; &lt;bug-MailTools [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1617969/866244/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/866244">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">* cpan@perl.wizbit.be via RT &#40;bug-MailTools@rt.cpan.org&#41; [160406 19:39]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: MailTools
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=113464">https://rt.cpan.org/Ticket/Display.html?id=113464</a></span> &gt;
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; There might be two extra things that need to be considered:
&gt; a&#41; &#40;ab&#41;using Mail::Header to detect incorrect MIME headers
</div>     ...
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The docs of the module does mention:
&gt;   &#34;Mail::Header does not always follow the RFCs strict enough, ...&#34;
</div>
There is are a few reasons that there are multiple implementations for email
processors.  One of the reasons is that not everyone needs the same features.

As I explained before: MailTools dates from pre-MIME.  That&#39;s very old.  In
the time that attachements were rare and spam volume low.  It is only kept
because many book show examples with this module

You could, for instance, go for the very powerful MailBox suite.  That
module is maintained to grow and if it does not already fulfil your needs,
it probably will get extended.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; b&#41; using Mail::Header on the full mail message
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So for someone &#40;ab&#41;using Mail::Header in that way the patch may break
&gt; their code...
&gt; 
&gt; What I do not know:
&gt; * is there anyone that &#40;ab&#41;uses Mail::Header in such way?
&gt; * is this behaviour that you want to support/maintain/recommend?
&gt; * ...
</div>
I think that everyone is using the code that way.  It was a serious bug
in our change.  I am very glad we did not release it yet ;-&#41;
I am planning to release the attached version.
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1617969/866245/MailTools-2.15.tar.gz">Download MailTools-2.15.tar.gz</a><br />
<span class="downloadcontenttype">application/x-tar-gz 53.8k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1618387" href="/Public/Bug/Display.html?id=113464#txn-1618387">#</a>      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;16&nbsp;16:34:51&nbsp;2016</span>
    <span class="description">cpan [...] perl.wizbit.be -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> cpan [...] perl.wizbit.be</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1618387/866478/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/866478">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 345b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I think that everyone is using the code that way.  It was a serious
&gt; bug
&gt; in our change.  I am very glad we did not release it yet ;-&#41;
&gt; I am planning to release the attached version.
</div>
I&#39;ve tested the attached version with my test cases &#40;I&#39;m sure you did the same but can never hurt to double check&#41; and it does produce the expected output.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1618775" href="/Public/Bug/Display.html?id=113464#txn-1618775">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;18&nbsp;08:11:58&nbsp;2016</span>
    <span class="description">solutions [...] overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #113464] Mail::Header incorrect decoding</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 18 Apr 2016 14:11:44 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;cpan [...] perl.wizbit.be via RT&#34; &lt;bug-MailTools [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;solutions [...] overmeer.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1618775/866728/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/866728">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 876b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">* cpan@perl.wizbit.be via RT &#40;bug-MailTools@rt.cpan.org&#41; [160416 20:35]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: MailTools
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=113464">https://rt.cpan.org/Ticket/Display.html?id=113464</a></span> &gt;
&gt; 
<div class="message-stanza open">&gt; &gt; I think that everyone is using the code that way.  It was a serious
&gt; &gt; bug
&gt; &gt; in our change.  I am very glad we did not release it yet ;-&#41;
&gt; &gt; I am planning to release the attached version.
</div>&gt; 
&gt; I&#39;ve tested the attached version with my test cases &#40;I&#39;m sure you did the same but can never hurt to double check&#41; and it does produce the expected output.
&gt; 
</div>
Release as 2.15
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1756474" href="/Public/Bug/Display.html?id=113464#txn-1756474">#</a>      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;08&nbsp;07:13:52&nbsp;2017</span>
    <span class="description">MARKOV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1756474/945115/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/945115">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 46b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">This change to 2.15 broke many applications...
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1756476" href="/Public/Bug/Display.html?id=113464#txn-1756476">#</a>      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;08&nbsp;07:13:53&nbsp;2017</span>
    <span class="description">MARKOV [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1756478" href="/Public/Bug/Display.html?id=113464#txn-1756478">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;08&nbsp;07:13:53&nbsp;2017</span>
    <span class="description">MARKOV [...] cpan.org -  Fixed in 2.15 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.999039</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
