<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #34644 for Text-CSV_XS: Missing double quote</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #34644 for Text-CSV_XS: Missing double quote</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Text-CSV_XS/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Text-CSV_XS/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Text-CSV_XS/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Text-CSV_XS/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Text-CSV_XS">Text-CSV_XS CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">34644</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Text-CSV_XS/Active/">Text-CSV_XS</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">HMBRAND [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
charles [...] modernterminals.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-31868-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.34    </td>
  </tr>
  <tr id="CF-31869-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.34    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




conv_utf8_file.csv<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/443238/217379/conv_utf8_file.csv">
Thu Apr 03 04:21:55 2008 (12k) by charles [...] modernterminals.com
</a>
</font></li>
</ul>


orignal_GB2312_file.XLS<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/443238/217373/orignal_GB2312_file.XLS">
Thu Apr 03 04:21:55 2008 (31.5k) by charles [...] modernterminals.com
</a>
</font></li>
</ul>


xls2csv.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/443238/217376/xls2csv.pl">
Thu Apr 03 04:21:55 2008 (6.8k) by charles [...] modernterminals.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;03&nbsp;04:21:55&nbsp;2008</span>
    <span class="description">charles [...] modernterminals.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Missing double quote</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space"> Dear Sir



 We encountered a problem when converting a GB2312 XLS file to UTF-8  
 CSV file with xls2csv.pl &#40;see attached files&#41;


 The command is as follows:-

 xls2csv.pl -x original_GB2312_file.XLS -b GB2312 -c 
conv_utf8_file.csv -a UTF-8

 The xls2csv.pl uses TEXT-CSV_XLS &#40;0.34&#41; modules to write the CSV file.

 A record was found missing double quote &#40;the second column&#41; as 
follows:-


 /* quote */

 140645,红|FB|R12036|,ADD,20080402,933104786,&#34;深圳市海X物流有限公
司&#34;,2225,,&#34;蓝&#34;,&#34;林XX&#34;,26473005,&#34;林XX&#34;,26473006

 /* unquote */

 Your help is appreciated

 Thank you

 Regards

 Charles
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> orignal_GB2312_file.XLS</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/443238/217373/orignal_GB2312_file.XLS">Download orignal_GB2312_file.XLS</a><br />
<span class="downloadcontenttype">application/vnd.ms-excel 31.5k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> xls2csv.pl</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl
use strict;
use 5.006;

use Getopt::Std;
use Locale::Recode;
use Spreadsheet::ParseExcel;
use Spreadsheet::ParseExcel::FmtUnicode;
use Text::CSV_XS;

our $VERSION = &#39;1.06&#39;;

=head1 NAME

xls2csv - A script that recodes a spreadsheet&#39;s charset and saves as CSV.

=head1 DESCRIPTION

This script will recode a spreadsheet into a different character set
and output the recoded data as a csv file.

The script came about after many headaches from dealing with Excel spreadsheets
from clients that were being received in various character sets.

=head1 OPTIONS

	-x     : filename of the source spreadsheet
	-b     : the character set the source spreadsheet is in &#40;before&#41;
	-c     : the filename to save the generated csv file as
	-a     : the character set the csv file should be converted to &#40;after&#41;
	-q     : quiet mode
	-s     : print a list of supported character sets
	-h     : print help message
	-v     : get version information
	-W     : list worksheets in the spreadsheet specified by -x
	-w     : specify the worksheet name to convert &#40;defaults to the first worksheet&#41;

=head1 EXAMPLE USAGE

The following example will convert a spreadsheet that is in the WINDOWS-1252 character set &#40;WinLatin1&#41;
and save it as a csv file in the UTF-8 character set.

	xls2csv -x &#34;1252spreadsheet.xls&#34; -b WINDOWS-1252 -c &#34;ut8csvfile.csv&#34; -a UTF-8

This example with convert the worksheet named &#34;Users&#34; in the given spreadsheet.

	xls2csv -x &#34;multi_worksheet_spreadsheet.xls&#34; -w &#34;Users&#34; -c &#34;users.csv&#34; 

=head1 NOTES

The spreadsheet&#39;s charset &#40;-b&#41; will default to UTF-8 if not set.

If the csv&#39;s charset &#40;-a&#41; is not set, the CSV file will be created using the same charset as the spreadsheet.

=head1 REQUIRED MODULES

This script requires the following modules:

	Locale::Recode
	Unicode::Map
	Spreadsheet::ParseExcel
	Spreadsheet::ParseExcel::FmtUnicode &#40;should be included with Spreadsheet::ParseExcel&#41;
	Text::CSV_XS

=head1 CAVEATS

It probably will not work work with spreadsheets that use formulas.

A line in the spreadsheet is assumed to be blank if there is nothing in the first column.

Some users have reported problems trying to convert a spreadsheet while it was opened in a different application.
You should probably make sure that no other programs are working with the spreadsheet while you are converting it.

=cut

$Getopt::Std::STANDARD_HELP_VERSION = 1;

my %O;
getopts&#40;&#39;x:b:c:a:qshvWw:&#39;, \%O&#41;;
HELP_MESSAGE&#40;&#41; if !%O or $O{&#39;h&#39;};
VERSION_MESSAGE&#40;&#41; if $O{&#39;v&#39;};

if &#40;$O{&#39;s&#39;}&#41;
{
	print &#34;\nThe following character sets are supported:\n\n&#34;;
	my $Supported = Locale::Recode-&gt;getSupported;
	foreach my $CharSet &#40;sort @$Supported&#41;
	{
		print &#34;$CharSet\n&#34;;
	}
	print &#34;\n&#34;;
	exit;
}

my $SourceFilename = $O{&#39;x&#39;} || die &#34;The filename of the spreadsheet &#40;-x&#41; is required.&#34;;
my $SourceCharset = $O{&#39;b&#39;};
$SourceCharset = &#39;UTF-8&#39; unless $SourceCharset;

unless &#40;$O{&#39;q&#39;}&#41;
{
	print &#34;Now reading \&#34;$SourceFilename\&#34; as $SourceCharset.\n&#34;;
}

my $XLS = new IO::File;
$XLS-&gt;open&#40;&#34;&lt; $SourceFilename&#34;&#41; || die &#34;Cannot open spreadsheet: $!&#34;;
my $Formatter = Spreadsheet::ParseExcel::FmtUnicode-&gt;new&#40;Unicode_Map =&gt; $SourceCharset&#41;;
my $Book = Spreadsheet::ParseExcel::Workbook-&gt;Parse&#40;$XLS, $Formatter&#41; || die &#34;Can&#39;t read spreadsheet!&#34;;

if &#40;$O{&#39;W&#39;}&#41; 
{
	print &#34;\nThe following &#34; . &#40;$Book-&gt;{SheetCount}&gt;1 ? &#34;$Book-&gt;{SheetCount} worksheets are&#34; : &#34;worksheet is&#34;&#41;  . &#34; defined in the spreadsheet:\n\n&#34;;
	foreach my $Sheet &#40;@{$Book-&gt;{Worksheet}}&#41; 
	{
		print &#34;$Sheet-&gt;{Name}\n&#34;;
	}
	print &#34;\n&#34;;
	exit;       
}

my $DestFilename = $O{&#39;c&#39;} || die &#34;The filename to save the csv file as &#40;-c&#41; is required.&#34;;
my $DestCharset = $O{&#39;a&#39;};
$DestCharset = $SourceCharset unless $DestCharset;

my $Sheet;
if &#40;$O{&#39;w&#39;}&#41; 
{
	$Sheet = $Book-&gt;Worksheet&#40;$O{&#39;w&#39;}&#41;;
	die &#34;Invalid worksheet&#34; if !defined $Sheet;
	unless &#40;$O{&#39;q&#39;}&#41;
	{
		print qq|Converting the &#34;$Sheet-&gt;{Name}&#34; worksheet.\n|;
	}
}
else
{
	&#40;$Sheet&#41; = @{$Book-&gt;{Worksheet}};
	if &#40;!$O{&#39;q&#39;} &#38;&#38; $Book-&gt;{SheetCount}&gt;1&#41;
	{
		print qq|Multiple worksheets found. Will convert the &#34;$Sheet-&gt;{Name}&#34; worksheet.\n|;
	}
}

open CSV, &#34;&gt; $DestFilename&#34; || die &#34;Cannot create csv file: $!&#34; ;
binmode CSV;
my $Csv = Text::CSV_XS-&gt;new&#40;{
	&#39;quote_char&#39;  =&gt; &#39;&#34;&#39;,
	&#39;escape_char&#39; =&gt; &#39;&#34;&#39;,
	&#39;sep_char&#39;    =&gt; &#39;,&#39;,
	&#39;binary&#39;      =&gt; 1,
}&#41;;

my $Recoder;
if &#40;$O{&#39;a&#39;}&#41;
{
	$Recoder = Locale::Recode-&gt;new&#40;from=&gt;$SourceCharset, to=&gt;$DestCharset&#41;;
}

for &#40; my $Row = $Sheet-&gt;{MinRow} ; defined $Sheet-&gt;{MaxRow} &#38;&#38; $Row &lt;= $Sheet-&gt;{MaxRow} ; $Row++ &#41;
{
	my @Row;
	for &#40; my $Col = $Sheet-&gt;{MinCol} ; defined $Sheet-&gt;{MaxCol} &#38;&#38; $Col &lt;= $Sheet-&gt;{MaxCol} ; $Col++ &#41;
	{
		my $Cell = $Sheet-&gt;{Cells}[$Row][$Col];
		
		my $Value = &#34;&#34;;
		if &#40;$Cell&#41;
		{
			$Value = $Cell-&gt;Value;
			if &#40;$Value eq &#39;GENERAL&#39;&#41;
			{
				# Sometimes numbers are read incorrectly as &#34;GENERAL&#34;.
				# In this case, the correct value should be in -&gt;{Val}.
				$Value = $Cell-&gt;{Val};
			}
			if &#40;$O{&#39;a&#39;}&#41;
			{
				$Recoder-&gt;recode&#40;$Value&#41;;
			}
		}
		
		# We assume the line is blank if there is nothing in the first column.
		last if $Col == $Sheet-&gt;{MinCol} and !$Value;
		
		push&#40;@Row, $Value&#41;;
	}
	
	next unless @Row;
	
	my $Status = $Csv-&gt;combine&#40;@Row&#41;;
	
	if &#40;!$O{&#39;q&#39;} and !defined $Status&#41;
	{
		my $Error = $Csv-&gt;error_input&#40;&#41;;
		warn &#34;ERROR FOUND!: $Error&#34;;
	}
	
	if &#40;defined $Status&#41;
	{
		my $Line = $Csv-&gt;string&#40;&#41;;
		print CSV &#34;$Line\n&#34;;
	}
}

close CSV;
$XLS-&gt;close;

unless &#40;$O{&#39;q&#39;}&#41;
{
	print &#34;The spreadsheet has been converted to $DestCharset and saved as \&#34;$DestFilename\&#34;.\n&#34;;
}

sub VERSION_MESSAGE
{
	print &lt;&lt; &#34;EOF&#34;;

This is xls2csv version $VERSION

Copyright &#40;C&#41; 2005 Ken Prows. All rights reserved.

This script is free software; you can redistribute it and\\or modify it under the same terms as Perl itself.

For help, use &#34;xls2csv -h&#34;

EOF
	exit;
}

sub HELP_MESSAGE
{
	print &lt;&lt; &#34;EOF&#34;;

xls2csv - Recode a spreadsheet&#39;s charset and save as CSV.

usage: xls2csv -x spreadsheet.xls [-w worksheet] [-b charset] [-c csvfile.csv] [-a charset] [-qshvW]

-x  : filename of the source spreadsheet
-b  : the character set the source spreadsheet is in &#40;before&#41;
-c  : the filename to save the generated csv file as
-a  : the character set the csv file should be converted to &#40;after&#41;
-q  : quiet mode
-s  : print a list of supported character sets
-h  : this help message
-v  : get version information
-W  : list worksheets in the spreadsheet specified by -x
-w  : specify the worksheet name to convert &#40;defaults to the first worksheet&#41;

example: xls2csv -x &#34;spreadsheet.xls&#34; -b WINDOWS-1252 -c &#34;csvfile.csv&#34; -a UTF-8

More detailed help is in &#34;perldoc xls2csv&#34;

EOF
	exit;
}

=head1 AUTHOR

Ken Prows &#40;perl@xev.net&#41;

=head1 COPYRIGHT

Copyright &#40;C&#41; 2005 Ken Prows. All rights reserved.

This script is free software; you can redistribute it and/or modify it under the same terms as Perl itself.

=cut
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> conv_utf8_file.csv</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/443238/217379/conv_utf8_file.csv">Download conv_utf8_file.csv</a><br />
<span class="downloadcontenttype">application/vnd.ms-excel 12k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;03&nbsp;08:03:04&nbsp;2008</span>
    <span class="description">h.m.brand [...] xs4all.nl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #34644] Missing double quote</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 3 Apr 2008 13:55:06 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Text-CSV_XS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;H.Merijn Brand&#34; &lt;h.m.brand [...] xs4all.nl&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, 03 Apr 2008 04:22:01 -0400, &#34;Charles C. via RT&#34;
&lt;bug-Text-CSV_XS@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  We encountered a problem when converting a GB2312 XLS file to UTF-8  
&gt;  CSV file with xls2csv.pl &#40;see attached files&#41;
&gt; 
&gt;  The command is as follows:-
&gt; 
&gt;  xls2csv.pl -x original_GB2312_file.XLS -b GB2312 -c conv_utf8_file.csv -a UTF-8
&gt; 
&gt;  The xls2csv.pl uses TEXT-CSV_XLS &#40;0.34&#41; modules to write the CSV file.
</div>
Consider upgrading to 0.37, it has a memory leak fixed

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  A record was found missing double quote &#40;the second column&#41; as follows:-
</div>
Technically, this line doesn&#39;t need any quotation, as there is no
possible conflicting situation when using binary =&gt; 1

Quotes are only forced when the field contains *bytes* ...

        * 0x00 .. 0x1f
        * 0x7f .. 0xa0
        * equal to quote_char
        * equal to sep_char
        * equal to escape_char

not diving into the encoded data, I suspect that all the other quoted
fields have a *byte* in the range of 0x7f .. 0xa0. Text::CSV_XS has no
knowledge about encoding.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  /* quote */
&gt; 
&gt;  140645,红|FB|R12036|,ADD,20080402,933104786,&#34;深圳市海X物流有限公
&gt; 司&#34;,2225,,&#34;蓝&#34;,&#34;林XX&#34;,26473005,&#34;林XX&#34;,26473006
&gt; 
&gt;  /* unquote */
</div>
$ xlscat -v5 -R74 -c orignal_GB2312_file.XLS
ReadData &#40;orignal_GB2312_file.XLS, debug 0 clip 1&#41;;
Opened orignal_GB2312_file.XLS with 1 sheets
Opening sheet 1 ...
orignal_GB2312_file.XLS - 01: [ Sheet0                         ]  13 Cols,    87 Rows
1:74 &#39;140645&#39; / &#39;140645&#39;
2:74 &#39;~¢|FB|R12036|&#39; / &#39;红|FB|R12036|&#39;
3:74 &#39;ADD&#39; / &#39;ADD&#39;
4:74 &#39;20080402&#39; / &#39;20080402&#39;
5:74 &#39;933104786&#39; / &#39;933104786&#39;
6:74 &#39;mñW3^mwl§rimAg    PQlSø&#39; / &#39;深圳市海沧物流有限公司&#39;
7:74 &#39;2225&#39; / &#39;2225&#39;
8:74 &#39;&#39; / &#39;&#39;
9:74 &#39;Ý&#39; / &#39;蓝&#39;
10:74 &#39;g_×N&#39; / &#39;林志东&#39;
11:74 &#39;26473005&#39; / &#39;26473005&#39;
12:74 &#39;g_×N&#39; / &#39;林志东&#39;
13:74 &#39;26473006&#39; / &#39;26473006&#39;
140645,红|FB|R12036|,ADD,20080402,933104786,&#34;深圳市海沧物流有限公司&#34;,2225,,&#34;蓝&#34;,&#34;林志东&#34;,26473005,&#34;林志东&#34;,26473006

$ xlscat -R74 -c orignal_GB2312_file.XLS &gt; test.csv
$ xlscat -s&#34;\n&#34; test.csv
140645
红|FB|R12036|
ADD
20080402
933104786
深圳市海沧物流有限公司
2225

蓝
林志东
26473005
林志东
26473006
    13 x      1
$

I&#39;ve added the encoding options to xlscat &#40;included in the
Text::CSV_XS module&#41; like this:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; xlscat --help
</div>usage: xlscat [-s &lt;sep&gt;] [-L] [-u] [ Selection ] file.xls
              [-c | -m]       [-u] [ Selection ] file.xls
               -i                  [ -S sheets ] file.xls
    Generic options:
       -v[#]       Set verbose level &#40;xlscat&#41;
       -d[#]       Set debug   level &#40;Spreadsheet::Read&#41;
       -u          Use unformatted values
       --noclip    Do not strip empty sheets and
                   trailing empty rows and columns
        -e &lt;enc&gt;    Set encoding for input and output
        -b &lt;enc&gt;    Set encoding for input
        -a &lt;enc&gt;    Set encoding for output
    Input CSV:
       --in-sep=c  Set input sep_char for CSV
    Output Text &#40;default&#41;:
       -s &lt;sep&gt;    Use separator &lt;sep&gt;. Default &#39;|&#39;, \n allowed
       -L          Line up the columns
    Output Index only:
       -i          Show sheet names and size only
    Output CSV:
       -c          Output CSV, separator = &#39;,&#39;
       -m          Output CSV, separator = &#39;;&#39;
    Selection:
       -S &lt;sheets&gt; Only print sheets &lt;sheets&gt;. &#39;all&#39; is a valid set
                   Default only prints the first sheet
       -R &lt;rows&gt;   Only print rows    &lt;rows&gt;. Default is &#39;all&#39;
       -C &lt;cols&gt;   Only print columns &lt;cols&gt;. Default is &#39;all&#39;
       -F &lt;flds&gt;   Only fields &lt;flds&gt; e.g. -FA3,B16

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  Your help is appreciated
&gt;  Thank you
&gt;  Regards
&gt;  Charles
</div>
-- 
H.Merijn Brand         Amsterdam Perl Mongers &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://amsterdam.pm.org/&#41;">http://amsterdam.pm.org/&#41;</a></span>
using &#38; porting perl 5.6.2, 5.8.x, 5.10.x  on HP-UX 10.20, 11.00, 11.11,
&#38; 11.23, SuSE 10.1 &#38; 10.2, AIX 5.2, and Cygwin.       <span class="clickylink"><a target="new" rel="nofollow" href="http://qa.perl.org">http://qa.perl.org</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="http://mirrors.develooper.com/hpux/">http://mirrors.develooper.com/hpux/</a></span>            <span class="clickylink"><a target="new" rel="nofollow" href="http://www.test-smoke.org">http://www.test-smoke.org</a></span>
                        <span class="clickylink"><a target="new" rel="nofollow" href="http://www.goldmark.org/jeff/stupid-disclaimers/">http://www.goldmark.org/jeff/stupid-disclaimers/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;03&nbsp;08:05:17&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;03&nbsp;08:05:27&nbsp;2008</span>
    <span class="description">HMBRAND [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  The xls2csv.pl uses TEXT-CSV_XLS &#40;0.34&#41; modules to write the CSV 
</div>file.  

Consider upgrading to 0.37, it has a memory leak fixed

Technically, this line doesn&#39;t need any quotation, as there is no
possible conflicting situation when using binary =&gt; 1

Quotes are only forced when the field contains *bytes* ...

        * 0x00 .. 0x1f
        * 0x7f .. 0xa0
        * equal to quote_char
        * equal to sep_char
        * equal to escape_char

not diving into the encoded data, I suspect that all the other quoted
fields have a *byte* in the range of 0x7f .. 0xa0. Text::CSV_XS has no
knowledge about encoding.

$ xlscat -v5 -R74 -c orignal_GB2312_file.XLS
ReadData &#40;orignal_GB2312_file.XLS, debug 0 clip 1&#41;;
Opened orignal_GB2312_file.XLS with 1 sheets
Opening sheet 1 ...
orignal_GB2312_file.XLS - 01: [ Sheet0                         ]  13 
Cols,    87 Rows
1:74 &#39;140645&#39; / &#39;140645&#39;
2:74 &#39;~¢|FB|R12036|&#39; / &#39;红|FB|R12036|&#39;
3:74 &#39;ADD&#39; / &#39;ADD&#39;
4:74 &#39;20080402&#39; / &#39;20080402&#39;
5:74 &#39;933104786&#39; / &#39;933104786&#39;
6:74 &#39;mñW3^mwl§rimAg    PQlSø&#39; / &#39;深圳市海沧物流有限公司&#39;
7:74 &#39;2225&#39; / &#39;2225&#39;
8:74 &#39;&#39; / &#39;&#39;
9:74 &#39;Ý&#39; / &#39;蓝&#39;
10:74 &#39;g_×N&#39; / &#39;林志东&#39;
11:74 &#39;26473005&#39; / &#39;26473005&#39;
12:74 &#39;g_×N&#39; / &#39;林志东&#39;
13:74 &#39;26473006&#39; / &#39;26473006&#39;
140645,红|FB|R12036|,ADD,20080402,933104786,&#34;深圳市海沧物流有限公
司&#34;,2225,,&#34;蓝&#34;,&#34;林志东&#34;,26473005,&#34;林志东&#34;,26473006

$ xlscat -R74 -c orignal_GB2312_file.XLS &gt; test.csv
$ xlscat -s&#34;\n&#34; test.csv
140645
红|FB|R12036|
ADD
20080402
933104786
深圳市海沧物流有限公司
2225

蓝
林志东
26473005
林志东
26473006
    13 x      1
$

I&#39;ve added the encoding options to xlscat &#40;included in the
Spreadsheet::Read module&#41; like this:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; xlscat --help  
</div>usage: xlscat [-s &lt;sep&gt;] [-L] [-u] [ Selection ] file.xls
              [-c | -m]       [-u] [ Selection ] file.xls
               -i                  [ -S sheets ] file.xls
    Generic options:
       -v[#]       Set verbose level &#40;xlscat&#41;
       -d[#]       Set debug   level &#40;Spreadsheet::Read&#41;
       -u          Use unformatted values
       --noclip    Do not strip empty sheets and
                   trailing empty rows and columns
        -e &lt;enc&gt;    Set encoding for input and output
        -b &lt;enc&gt;    Set encoding for input
        -a &lt;enc&gt;    Set encoding for output
    Input CSV:
       --in-sep=c  Set input sep_char for CSV
    Output Text &#40;default&#41;:
       -s &lt;sep&gt;    Use separator &lt;sep&gt;. Default &#39;|&#39;, \n allowed
       -L          Line up the columns
    Output Index only:
       -i          Show sheet names and size only
    Output CSV:
       -c          Output CSV, separator = &#39;,&#39;
       -m          Output CSV, separator = &#39;;&#39;
    Selection:
       -S &lt;sheets&gt; Only print sheets &lt;sheets&gt;. &#39;all&#39; is a valid set
                   Default only prints the first sheet
       -R &lt;rows&gt;   Only print rows    &lt;rows&gt;. Default is &#39;all&#39;
       -C &lt;cols&gt;   Only print columns &lt;cols&gt;. Default is &#39;all&#39;
       -F &lt;flds&gt;   Only fields &lt;flds&gt; e.g. -FA3,B16
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;03&nbsp;08:06:51&nbsp;2008</span>
    <span class="description">HMBRAND [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Give even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;03&nbsp;08:08:34&nbsp;2008</span>
    <span class="description">HMBRAND [...] cpan.org -  Given to HMBRAND</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;03&nbsp;08:09:00&nbsp;2008</span>
    <span class="description">HMBRAND [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  The xls2csv.pl uses TEXT-CSV_XLS &#40;0.34&#41; modules to write the CSV 
</div>file.  

Consider upgrading to 0.37, it has a memory leak fixed

Technically, this line doesn&#39;t need any quotation, as there is no
possible conflicting situation when using binary =&gt; 1

Quotes are only forced when the field contains *bytes* ...

        * 0x00 .. 0x1f
        * 0x7f .. 0xa0
        * equal to quote_char
        * equal to sep_char
        * equal to escape_char

not diving into the encoded data, I suspect that all the other quoted
fields have a *byte* in the range of 0x7f .. 0xa0. Text::CSV_XS has no
knowledge about encoding.

$ xlscat -v5 -R74 -c orignal_GB2312_file.XLS
ReadData &#40;orignal_GB2312_file.XLS, debug 0 clip 1&#41;;
Opened orignal_GB2312_file.XLS with 1 sheets
Opening sheet 1 ...
orignal_GB2312_file.XLS - 01: [ Sheet0                         ]  13 
Cols,    87 Rows
1:74 &#39;140645&#39; / &#39;140645&#39;
2:74 &#39;~¢|FB|R12036|&#39; / &#39;红|FB|R12036|&#39;
3:74 &#39;ADD&#39; / &#39;ADD&#39;
4:74 &#39;20080402&#39; / &#39;20080402&#39;
5:74 &#39;933104786&#39; / &#39;933104786&#39;
6:74 &#39;mñW3^mwl§rimAg    PQlSø&#39; / &#39;深圳市海沧物流有限公司&#39;
7:74 &#39;2225&#39; / &#39;2225&#39;
8:74 &#39;&#39; / &#39;&#39;
9:74 &#39;Ý&#39; / &#39;蓝&#39;
10:74 &#39;g_×N&#39; / &#39;林志东&#39;
11:74 &#39;26473005&#39; / &#39;26473005&#39;
12:74 &#39;g_×N&#39; / &#39;林志东&#39;
13:74 &#39;26473006&#39; / &#39;26473006&#39;
140645,红|FB|R12036|,ADD,20080402,933104786,&#34;深圳市海沧物流有限公
司&#34;,2225,,&#34;蓝&#34;,&#34;林志东&#34;,26473005,&#34;林志东&#34;,26473006

$ xlscat -R74 -c orignal_GB2312_file.XLS &gt; test.csv
$ xlscat -s&#34;\n&#34; test.csv
140645
红|FB|R12036|
ADD
20080402
933104786
深圳市海沧物流有限公司
2225

蓝
林志东
26473005
林志东
26473006
    13 x      1
$

I&#39;ve added the encoding options to xlscat &#40;included in the
Spreadsheet::Read module&#41; like this:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; xlscat --help  
</div>usage: xlscat [-s &lt;sep&gt;] [-L] [-u] [ Selection ] file.xls
              [-c | -m]       [-u] [ Selection ] file.xls
               -i                  [ -S sheets ] file.xls
    Generic options:
       -v[#]       Set verbose level &#40;xlscat&#41;
       -d[#]       Set debug   level &#40;Spreadsheet::Read&#41;
       -u          Use unformatted values
       --noclip    Do not strip empty sheets and
                   trailing empty rows and columns
        -e &lt;enc&gt;    Set encoding for input and output
        -b &lt;enc&gt;    Set encoding for input
        -a &lt;enc&gt;    Set encoding for output
    Input CSV:
       --in-sep=c  Set input sep_char for CSV
    Output Text &#40;default&#41;:
       -s &lt;sep&gt;    Use separator &lt;sep&gt;. Default &#39;|&#39;, \n allowed
       -L          Line up the columns
    Output Index only:
       -i          Show sheet names and size only
    Output CSV:
       -c          Output CSV, separator = &#39;,&#39;
       -m          Output CSV, separator = &#39;;&#39;
    Selection:
       -S &lt;sheets&gt; Only print sheets &lt;sheets&gt;. &#39;all&#39; is a valid set
                   Default only prints the first sheet
       -R &lt;rows&gt;   Only print rows    &lt;rows&gt;. Default is &#39;all&#39;
       -C &lt;cols&gt;   Only print columns &lt;cols&gt;. Default is &#39;all&#39;
       -F &lt;flds&gt;   Only fields &lt;flds&gt; e.g. -FA3,B16
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;03&nbsp;08:09:55&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;03&nbsp;08:13:25&nbsp;2008</span>
    <span class="description">HMBRAND [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  The xls2csv.pl uses TEXT-CSV_XLS &#40;0.34&#41; modules to write the CSV 
</div>file.  

Consider upgrading to 0.37, it has a memory leak fixed

Technically, this line doesn&#39;t need any quotation, as there is no
possible conflicting situation when using binary =&gt; 1

Quotes are only forced when the field contains *bytes* ...

        * 0x00 .. 0x1f
        * 0x7f .. 0xa0
        * equal to quote_char
        * equal to sep_char
        * equal to escape_char

not diving into the encoded data, I suspect that all the other quoted
fields have a *byte* in the range of 0x7f .. 0xa0. Text::CSV_XS has no
knowledge about encoding.

$ xlscat -v5 -R74 -c orignal_GB2312_file.XLS
ReadData &#40;orignal_GB2312_file.XLS, debug 0 clip 1&#41;;
Opened orignal_GB2312_file.XLS with 1 sheets
Opening sheet 1 ...
orignal_GB2312_file.XLS - 01: [ Sheet0                         ]  13 
Cols,    87 Rows
1:74 &#39;140645&#39; / &#39;140645&#39;
2:74 &#39;~¢|FB|R12036|&#39; / &#39;红|FB|R12036|&#39;
3:74 &#39;ADD&#39; / &#39;ADD&#39;
4:74 &#39;20080402&#39; / &#39;20080402&#39;
5:74 &#39;933104786&#39; / &#39;933104786&#39;
6:74 &#39;mñW3^mwl§rimAg    PQlSø&#39; / &#39;深圳市海沧物流有限公司&#39;
7:74 &#39;2225&#39; / &#39;2225&#39;
8:74 &#39;&#39; / &#39;&#39;
9:74 &#39;Ý&#39; / &#39;蓝&#39;
10:74 &#39;g_×N&#39; / &#39;林志东&#39;
11:74 &#39;26473005&#39; / &#39;26473005&#39;
12:74 &#39;g_×N&#39; / &#39;林志东&#39;
13:74 &#39;26473006&#39; / &#39;26473006&#39;
140645,红|FB|R12036|,ADD,20080402,933104786,&#34;深圳市海沧物流有限公
司&#34;,2225,,&#34;蓝&#34;,&#34;林志东&#34;,26473005,&#34;林志东&#34;,26473006

$ xlscat -R74 -c orignal_GB2312_file.XLS &gt; test.csv
$ xlscat -s&#34;\n&#34; test.csv
140645
红|FB|R12036|
ADD
20080402
933104786
深圳市海沧物流有限公司
2225

蓝
林志东
26473005
林志东
26473006
    13 x      1
$

I&#39;ve added the encoding options to xlscat &#40;included in the
Spreadsheet::Read module&#41; like this:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; xlscat --help  
</div>usage: xlscat [-s &lt;sep&gt;] [-L] [-u] [ Selection ] file.xls
              [-c | -m]       [-u] [ Selection ] file.xls
               -i                  [ -S sheets ] file.xls
    Generic options:
       -v[#]       Set verbose level &#40;xlscat&#41;
       -d[#]       Set debug   level &#40;Spreadsheet::Read&#41;
       -u          Use unformatted values
       --noclip    Do not strip empty sheets and
                   trailing empty rows and columns
        -e &lt;enc&gt;    Set encoding for input and output
        -b &lt;enc&gt;    Set encoding for input
        -a &lt;enc&gt;    Set encoding for output
    Input CSV:
       --in-sep=c  Set input sep_char for CSV
    Output Text &#40;default&#41;:
       -s &lt;sep&gt;    Use separator &lt;sep&gt;. Default &#39;|&#39;, \n allowed
       -L          Line up the columns
    Output Index only:
       -i          Show sheet names and size only
    Output CSV:
       -c          Output CSV, separator = &#39;,&#39;
       -m          Output CSV, separator = &#39;;&#39;
    Selection:
       -S &lt;sheets&gt; Only print sheets &lt;sheets&gt;. &#39;all&#39; is a valid set
                   Default only prints the first sheet
       -R &lt;rows&gt;   Only print rows    &lt;rows&gt;. Default is &#39;all&#39;
       -C &lt;cols&gt;   Only print columns &lt;cols&gt;. Default is &#39;all&#39;
       -F &lt;flds&gt;   Only fields &lt;flds&gt; e.g. -FA3,B16
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;03&nbsp;08:13:33&nbsp;2008</span>
    <span class="description">HMBRAND [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;03&nbsp;08:14:43&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;03&nbsp;08:17:44&nbsp;2008</span>
    <span class="description">HMBRAND [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;04&nbsp;00:37:23&nbsp;2008</span>
    <span class="description">charles [...] modernterminals.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #34644] Missing double quote</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 4 Apr 2008 12:36:38 +0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Text-CSV_XS [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Chu, Charles&#34; &lt;charles [...] ModernTerminals.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dear Mr. H. M. Brand

Thank you for your advices~!

Actually, I am pretty fresh in PERL development and overlook some information in CPAN.

I thought the always_quote option would help to solve our problem.

Besides, I would take your advice to upgrade 0.34 to 0.37.

Thank you

Regards

Charles

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: h.m.brand@xs4all.nl via RT [mailto:bug-Text-CSV_XS@rt.cpan.org] 
Sent: Thursday, April 03, 2008 20:06
To: charles@modernterminals.com
Subject: Re: [rt.cpan.org #34644] Missing double quote


&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=34644">http://rt.cpan.org/Ticket/Display.html?id=34644</a></span> &gt;

On Thu, 03 Apr 2008 04:22:01 -0400, &#34;Charles C. via RT&#34;
&lt;bug-Text-CSV_XS@rt.cpan.org&gt; wrote:

<div class="message-stanza open">&gt;  We encountered a problem when converting a GB2312 XLS file to UTF-8  
&gt;  CSV file with xls2csv.pl &#40;see attached files&#41;
&gt; 
&gt;  The command is as follows:-
&gt; 
&gt;  xls2csv.pl -x original_GB2312_file.XLS -b GB2312 -c conv_utf8_file.csv -a UTF-8
&gt; 
&gt;  The xls2csv.pl uses TEXT-CSV_XLS &#40;0.34&#41; modules to write the CSV file.
</div>
Consider upgrading to 0.37, it has a memory leak fixed

<div class="message-stanza open">&gt;  A record was found missing double quote &#40;the second column&#41; as follows:-
</div>
Technically, this line doesn&#39;t need any quotation, as there is no
possible conflicting situation when using binary =&gt; 1

Quotes are only forced when the field contains *bytes* ...

        * 0x00 .. 0x1f
        * 0x7f .. 0xa0
        * equal to quote_char
        * equal to sep_char
        * equal to escape_char

not diving into the encoded data, I suspect that all the other quoted
fields have a *byte* in the range of 0x7f .. 0xa0. Text::CSV_XS has no
knowledge about encoding.

<div class="message-stanza open">&gt;  /* quote */
&gt; 
&gt;  140645,红|FB|R12036|,ADD,20080402,933104786,&#34;深圳市海X物流有限公
&gt; 司&#34;,2225,,&#34;蓝&#34;,&#34;林XX&#34;,26473005,&#34;林XX&#34;,26473006
&gt; 
&gt;  /* unquote */
</div>
$ xlscat -v5 -R74 -c orignal_GB2312_file.XLS
ReadData &#40;orignal_GB2312_file.XLS, debug 0 clip 1&#41;;
Opened orignal_GB2312_file.XLS with 1 sheets
Opening sheet 1 ...
orignal_GB2312_file.XLS - 01: [ Sheet0                         ]  13 Cols,    87 Rows
1:74 &#39;140645&#39; / &#39;140645&#39;
2:74 &#39;~¢|FB|R12036|&#39; / &#39;红|FB|R12036|&#39;
3:74 &#39;ADD&#39; / &#39;ADD&#39;
4:74 &#39;20080402&#39; / &#39;20080402&#39;
5:74 &#39;933104786&#39; / &#39;933104786&#39;
6:74 &#39;mñW3^mwl§rimAg    PQlSø&#39; / &#39;深圳市海沧物流有限公司&#39;
7:74 &#39;2225&#39; / &#39;2225&#39;
8:74 &#39;&#39; / &#39;&#39;
9:74 &#39;Ý&#39; / &#39;蓝&#39;
10:74 &#39;g_×N&#39; / &#39;林志东&#39;
11:74 &#39;26473005&#39; / &#39;26473005&#39;
12:74 &#39;g_×N&#39; / &#39;林志东&#39;
13:74 &#39;26473006&#39; / &#39;26473006&#39;
140645,红|FB|R12036|,ADD,20080402,933104786,&#34;深圳市海沧物流有限公司&#34;,2225,,&#34;蓝&#34;,&#34;林志东&#34;,26473005,&#34;林志东&#34;,26473006

$ xlscat -R74 -c orignal_GB2312_file.XLS &gt; test.csv
$ xlscat -s&#34;\n&#34; test.csv
140645
红|FB|R12036|
ADD
20080402
933104786
深圳市海沧物流有限公司
2225

蓝
林志东
26473005
林志东
26473006
    13 x      1
$

I&#39;ve added the encoding options to xlscat &#40;included in the
Text::CSV_XS module&#41; like this:

<div class="message-stanza open">&gt; xlscat --help
</div>usage: xlscat [-s &lt;sep&gt;] [-L] [-u] [ Selection ] file.xls
              [-c | -m]       [-u] [ Selection ] file.xls
               -i                  [ -S sheets ] file.xls
    Generic options:
       -v[#]       Set verbose level &#40;xlscat&#41;
       -d[#]       Set debug   level &#40;Spreadsheet::Read&#41;
       -u          Use unformatted values
       --noclip    Do not strip empty sheets and
                   trailing empty rows and columns
        -e &lt;enc&gt;    Set encoding for input and output
        -b &lt;enc&gt;    Set encoding for input
        -a &lt;enc&gt;    Set encoding for output
    Input CSV:
       --in-sep=c  Set input sep_char for CSV
    Output Text &#40;default&#41;:
       -s &lt;sep&gt;    Use separator &lt;sep&gt;. Default &#39;|&#39;, \n allowed
       -L          Line up the columns
    Output Index only:
       -i          Show sheet names and size only
    Output CSV:
       -c          Output CSV, separator = &#39;,&#39;
       -m          Output CSV, separator = &#39;;&#39;
    Selection:
       -S &lt;sheets&gt; Only print sheets &lt;sheets&gt;. &#39;all&#39; is a valid set
                   Default only prints the first sheet
       -R &lt;rows&gt;   Only print rows    &lt;rows&gt;. Default is &#39;all&#39;
       -C &lt;cols&gt;   Only print columns &lt;cols&gt;. Default is &#39;all&#39;
       -F &lt;flds&gt;   Only fields &lt;flds&gt; e.g. -FA3,B16

<div class="message-stanza open">&gt;  Your help is appreciated
&gt;  Thank you
&gt;  Regards
&gt;  Charles
</div>
-- 
H.Merijn Brand         Amsterdam Perl Mongers &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://amsterdam.pm.org/&#41;">http://amsterdam.pm.org/&#41;</a></span>
using &#38; porting perl 5.6.2, 5.8.x, 5.10.x  on HP-UX 10.20, 11.00, 11.11,
&#38; 11.23, SuSE 10.1 &#38; 10.2, AIX 5.2, and Cygwin.       <span class="clickylink"><a target="new" rel="nofollow" href="http://qa.perl.org">http://qa.perl.org</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="http://mirrors.develooper.com/hpux/">http://mirrors.develooper.com/hpux/</a></span>            <span class="clickylink"><a target="new" rel="nofollow" href="http://www.test-smoke.org">http://www.test-smoke.org</a></span>
                        <span class="clickylink"><a target="new" rel="nofollow" href="http://www.goldmark.org/jeff/stupid-disclaimers/">http://www.goldmark.org/jeff/stupid-disclaimers/</a></span>

</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;04&nbsp;00:37:33&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;19&nbsp;13:39:22&nbsp;2008</span>
    <span class="description">HMBRAND [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;21&nbsp;18:44:52&nbsp;2008</span>
    <span class="description">HMBRAND [...] cpan.org -  Fixed in 0.34 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
