<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #41915 for Fey-Loader: Fey::Loader feature request w/patch for Pg Databases</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #41915 for Fey-Loader: Fey::Loader feature request w/patch for Pg Databases</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Fey-Loader/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Fey-Loader/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Fey-Loader/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Fey-Loader/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Fey-Loader">Fey-Loader CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">41915</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Fey-Loader/Active/">Fey-Loader</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
edl [...] aweber.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-220504-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.06    </td>
  </tr>
  <tr id="CF-220505-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;23&nbsp;14:29:32&nbsp;2008</span>
    <span class="description">edl [...] aweber.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Fey::Loader feature request w/patch for Pg Databases</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This patch includes the following:
 * support non-default pg search path
 * support tables that use OIDs as the PK

Patch For:
 Fey::Loader v0.06

Other Version Information:
 perl, v5.8.8 built for i486-linux-gnu-thread-multi
 Fey::ORM v0.15
 Fey v0.18
 Moose v0.63
 DBD::Pg v2.11.7

OS:
Ubuntu 
Linux localhost 2.6.24-19-server #1 SMP Sat Jul 12 00:40:01 UTC 2008
i686 GNU/Linux
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> fey_loader_0.06_pg_dbi_patch.patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -ur Pg.pm patched-Pg.pm
--- Pg.pm	2008-12-23 13:39:04.000000000 -0500
+++ /patched-Pg.pm	2008-12-23 13:36:34.000000000 -0500
@@ -11,8 +11,13 @@
 use Fey::Literal;
 use Scalar::Util qw&#40; looks_like_number &#41;;
 
-
-sub _schema_name { &#39;public&#39; }
+has &#39;_schema_name&#39; =&gt; &#40;
+    is =&gt; &#39;ro&#39;,
+    isa =&gt; &#39;Str&#39;,
+    required =&gt; 1,
+    default =&gt; &#39;public&#39;,
+    init_arg =&gt; &#39;schema&#39;,
+&#41;;
 
 sub _column_params
 {
diff -ur DBI.pm patched-DBI.pm
--- DBI.pm	2008-12-23 13:39:04.000000000 -0500
+++ /patched-DBI.pm	2008-12-23 13:37:42.000000000 -0500
@@ -200,13 +200,17 @@
     {
         # KEY_SEQ refers to the &#34;position&#34; of the column in the table,
         # not in the key, and so may start at any random number.
+
+        # ignore OID as pkey
+        next if $pk_col-&gt;{KEY_SEQ} == -2;
         $pk{ $pk_col-&gt;{KEY_SEQ} } =
             $self-&gt;_unquote_identifier&#40; $pk_col-&gt;{COLUMN_NAME} &#41;;
     }
 
     my @pk = @pk{ sort keys %pk };
 
-    $table-&gt;add_candidate_key&#40;@pk&#41;
+    # The defined check is another Pg workaround.
+    $table-&gt;add_candidate_key&#40;grep { defined } @pk&#41;
         if @pk;
 }
 
@@ -229,6 +233,8 @@
     my %ck;
     while &#40; my $ck_col = $key_info-&gt;fetchrow_hashref&#40;&#41; &#41;
     {
+        # ignore OID as a candidate key
+        next if $ck_col-&gt;{COLUMN_NAME} eq &#39;oid&#39;;
         $ck{ $ck_col-&gt;{INDEX_NAME} } ||= [];
 
         $ck{ $ck_col-&gt;{INDEX_NAME} }[ $ck_col-&gt;{ORDINAL_POSITION} - 1 ] =
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;12&nbsp;11:39:43&nbsp;2009</span>
    <span class="description">DROLSKY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Dec 23 14:29:32 2008, pianoman19403 wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This patch includes the following:
&gt;  * support non-default pg search path
&gt;  * support tables that use OIDs as the PK
&gt; 
&gt; Patch For:
&gt;  Fey::Loader v0.06
&gt; 
&gt; Other Version Information:
&gt;  perl, v5.8.8 built for i486-linux-gnu-thread-multi
&gt;  Fey::ORM v0.15
&gt;  Fey v0.18
&gt;  Moose v0.63
&gt;  DBD::Pg v2.11.7
&gt; 
&gt; OS:
&gt; Ubuntu 
&gt; Linux localhost 2.6.24-19-server #1 SMP Sat Jul 12 00:40:01 UTC 2008
&gt; i686 GNU/Linux
</div>
Woah, I just realized this has been sitting here forever.

I&#39;d like to include this, but it really needs some tests, I think.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;12&nbsp;11:39:44&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;24&nbsp;15:07:02&nbsp;2009</span>
    <span class="description">DROLSKY [...] cpan.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;30&nbsp;16:24:49&nbsp;2010</span>
    <span class="description">perl [...] evancarroll.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I think my patch offers a better method of adding this functionality

<span class="clickylink"><a target="new" rel="nofollow" href="http://github.com/EvanCarroll/Fey-Loader/compare/0b9f9125ecb4a0f8ed63864d9d039a2f73da85a1...HEAD">http://github.com/EvanCarroll/Fey-Loader/compare/0b9f9125ecb4a0f8ed63864d9d039a2f73da85a1...HEAD</a></span>

Prime difference being it adds the functionality to the DBI base class
and leaves the default schema intact, it also includes doc patches. It
also works &#40;adds the schema to the table objects&#41;. And, applies cleanly
to 0.11

-- 
Evan Carroll
System Lord of the Internets
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.evancarroll.com">http://www.evancarroll.com</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;30&nbsp;16:24:51&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;31&nbsp;06:31:48&nbsp;2010</span>
    <span class="description">dev [...] archonet.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> dev [...] archonet.com</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Mar 30 16:24:49 2010, ECARROLL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I think my patch offers a better method of adding this functionality
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://github.com/EvanCarroll/Fey-">http://github.com/EvanCarroll/Fey-</a></span>
&gt; Loader/compare/0b9f9125ecb4a0f8ed63864d9d039a2f73da85a1...HEAD
&gt; 
&gt; Prime difference being it adds the functionality to the DBI base class
&gt; and leaves the default schema intact, it also includes doc patches. It
&gt; also works &#40;adds the schema to the table objects&#41;. And, applies
&gt; cleanly
&gt; to 0.11
</div>
Ah - they mentioned someone else asking about Pg support on IRC.

Your patch certainly looks more thorough than mine. The tests in my
patch specifically check populating and checking against an actual Pg
schema - might be useful.

Patches should apply to 0.11 with -p0 if I&#39;ve done this right...
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> fey_test.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -r -c Fey-Test-0.07/lib/Fey/Test/Pg.pm ../Fey-Test-0.07/lib/Fey/Test/Pg.pm
*** Fey-Test-0.07/lib/Fey/Test/Pg.pm	2009-11-17 19:27:31.000000000 +0000
--- ../Fey-Test-0.07/lib/Fey/Test/Pg.pm	2010-03-31 11:07:16.000000000 +0100
***************
*** 26,31 ****
--- 26,34 ----
  use File::Temp &#40;&#41;;
  
  
+ our @Schema_Names_To_Test = &#40;&#39;public&#39;, &#39;TestSchema&#39;&#41;;
+ 
+ 
  {
      my $DBH;
      sub dbh
***************
*** 47,67 ****
  
          # Shuts up &#34;NOTICE&#34; warnings from Pg.
          local $dbh-&gt;{PrintWarn} = 0;
!         $class-&gt;_run_ddl&#40;$dbh&#41;;
  
          return $DBH = $dbh;
      }
  }
  
! sub _run_ddl
  {
      my $class = shift;
      my $dbh   = shift;
  
      for my $ddl &#40; $class-&gt;_sql&#40;&#41; &#41;
      {
          $dbh-&gt;do&#40;$ddl&#41;;
      }
  }
  
  sub _sql
--- 50,82 ----
  
          # Shuts up &#34;NOTICE&#34; warnings from Pg.
          local $dbh-&gt;{PrintWarn} = 0;
!         for my $s &#40;@Schema_Names_To_Test&#41; {
!             $class-&gt;_run_ddl_in_schema&#40;$s, $dbh&#41;;
!         }
  
          return $DBH = $dbh;
      }
  }
  
! sub _run_ddl_in_schema
  {
      my $class = shift;
+     my $schema= shift;
      my $dbh   = shift;
  
+     # Build our tables in the correct schema
+     if &#40;$schema ne &#39;public&#39;&#41; {
+         $dbh-&gt;do&#40;qq&#40;CREATE SCHEMA &#34;$schema&#34;&#41;&#41;;
+     }
+     $dbh-&gt;do&#40;qq&#40;SET search_path = &#34;$schema&#34;&#41;&#41;;
+ 
      for my $ddl &#40; $class-&gt;_sql&#40;&#41; &#41;
      {
          $dbh-&gt;do&#40;$ddl&#41;;
      }
+ 
+     # Tidy up behind ourselves
+     $dbh-&gt;do&#40;&#39;RESET search_path&#39;&#41;;
  }
  
  sub _sql
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> fey_loader.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -r -c Fey-Loader-0.11/lib/Fey/Loader/Pg.pm ../Fey-Loader-0.11/lib/Fey/Loader/Pg.pm
*** Fey-Loader-0.11/lib/Fey/Loader/Pg.pm	2009-11-17 19:35:52.000000000 +0000
--- ../Fey-Loader-0.11/lib/Fey/Loader/Pg.pm	2010-03-31 10:12:08.000000000 +0100
***************
*** 14,19 ****
--- 14,22 ----
  use Scalar::Util qw&#40; looks_like_number &#41;;
  
  
+ has &#39;schema_name&#39; =&gt; &#40; is =&gt; &#39;ro&#39;, isa =&gt; &#39;Str&#39;, reader =&gt; &#39;_schema_name&#39;, default =&gt; &#39;public&#39; &#41;;
+ 
+ 
  sub _build_dbh_name
  {
      my $self = shift;
***************
*** 21,28 ****
      return $self-&gt;dbh&#40;&#41;-&gt;selectrow_arrayref&#40;&#39;SELECT CURRENT_DATABASE&#40;&#41;&#39;&#41;-&gt;[0];
  }
  
- sub _schema_name { &#39;public&#39; }
- 
  sub _column_params
  {
      my $self     = shift;
--- 24,29 ----
diff -r -c Fey-Loader-0.11/t/Loader/Pg.t ../Fey-Loader-0.11/t/Loader/Pg.t
*** Fey-Loader-0.11/t/Loader/Pg.t	2009-11-17 19:35:52.000000000 +0000
--- ../Fey-Loader-0.11/t/Loader/Pg.t	2010-03-31 11:06:40.000000000 +0100
***************
*** 5,17 ****
  use Fey::Test::Loader;
  use Fey::Test::Pg;
  
! use Test::More tests =&gt; 156;
  
  use Fey::Loader;
  
  
  {
!     my $loader = Fey::Loader-&gt;new&#40; dbh =&gt; Fey::Test::Pg-&gt;dbh&#40;&#41; &#41;;
  
      my $schema1 = $loader-&gt;make_schema&#40; name =&gt; &#39;Test&#39; &#41;;
      my $schema2 = Fey::Test-&gt;mock_test_schema_with_fks&#40;&#41;;
--- 5,47 ----
  use Fey::Test::Loader;
  use Fey::Test::Pg;
  
! use Test::More tests =&gt; 155 * scalar&#40;@Fey::Test::Pg::Schema_Names_To_Test&#41; + 1 + 1;
  
  use Fey::Loader;
  
+ use Data::Dumper;
+ 
+ 
+ {
+     for my $s &#40;@Fey::Test::Pg::Schema_Names_To_Test&#41; {
+         compare_schemas&#40;$s&#41;;
+     }
+ }
+ 
+ {
+     my $loader = Fey::Loader-&gt;new&#40;
+         dbh =&gt; Fey::Test::Pg-&gt;dbh&#40;&#41;,
+         schema_name =&gt; &#39;missing_schema&#39;
+     &#41;;
+     my $schema = $loader-&gt;make_schema&#40; name =&gt; &#39;ShouldBeEmpty&#39; &#41;;
+     my $num_tables = $schema-&gt;tables;
+     is&#40; $num_tables, 0, &#34;Shouldn&#39;t be any tables if schema isn&#39;t in database&#34; &#41;;
+ }
  
  {
!     my $def = Fey::Loader::Pg-&gt;_default&#40;&#39;NULL&#39;&#41;;
!     isa_ok&#40; $def, &#39;Fey::Literal::Null&#39;&#41;;
! }
! 
! exit;
! 
! sub compare_schemas
! {
!     my $schema_name = shift;
! 
!     my %loader_params = &#40; dbh =&gt; Fey::Test::Pg-&gt;dbh&#40;&#41; &#41;;
!     if &#40;$schema_name&#41; { $loader_params{schema_name} = $schema_name; }
!     my $loader = Fey::Loader-&gt;new&#40; %loader_params &#41;;
  
      my $schema1 = $loader-&gt;make_schema&#40; name =&gt; &#39;Test&#39; &#41;;
      my $schema2 = Fey::Test-&gt;mock_test_schema_with_fks&#40;&#41;;
***************
*** 34,41 ****
      is&#40; $loader-&gt;_build_dbh_name&#40;&#41;, &#39;test_fey&#39;,
          &#39;database name is test_fey&#39; &#41;;
  }
- 
- {
-     my $def = Fey::Loader::Pg-&gt;_default&#40;&#39;NULL&#39;&#41;;
-     isa_ok&#40; $def, &#39;Fey::Literal::Null&#39;&#41;;
- }
--- 64,66 ----
</div></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
