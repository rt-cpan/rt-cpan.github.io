<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #35888 for Net-SFTP-Foreign: put&#40;&#41; on hpux fails with: Connection to remote server is broken</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #35888 for Net-SFTP-Foreign: put&#40;&#41; on hpux fails with: Connection to remote server is broken</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-SFTP-Foreign/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-SFTP-Foreign/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-SFTP-Foreign/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-SFTP-Foreign/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-SFTP-Foreign">Net-SFTP-Foreign CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">35888</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="time worked">
    <td class="label">Worked:</td>
    <td class="value">16 hours (960 min)

</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-SFTP-Foreign/Active/">Net-SFTP-Foreign</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
Tom.Warkentin [...] intecbilling.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-23164-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-23165-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




stderr.dbg_2048_2<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/461904/227298/stderr.dbg_2048_2">
Thu May 15 19:17:58 2008 (20.4k) by Tom.Warkentin [...] intecbilling.com
</a>
</font></li>
</ul>


stderr.dbg_483_1<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/461904/227297/stderr.dbg_483_1">
Thu May 15 19:17:58 2008 (30.9k) by Tom.Warkentin [...] intecbilling.com
</a>
</font></li>
</ul>


stderr.dbg_484_noque<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/461904/227299/stderr.dbg_484_noque">
Thu May 15 19:17:58 2008 (25.8k) by Tom.Warkentin [...] intecbilling.com
</a>
</font></li>
</ul>


stderr.dbg_noblk_noque<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/461904/227296/stderr.dbg_noblk_noque">
Thu May 15 19:17:57 2008 (24.6k) by Tom.Warkentin [...] intecbilling.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;14&nbsp;16:09:29&nbsp;2008</span>
    <span class="description">Tom.Warkentin [...] intecbilling.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> put&#40;&#41; on hpux fails with: Connection to remote server is broken</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 14 May 2008 14:07:51 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Net-SFTP-Foreign [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Tom Warkentin&#34; &lt;Tom.Warkentin [...] intecbilling.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Distribution: Net-SFTP-Foreign-1.35

Perl Version: 5.8.7 built for PA-RISC2.0-LP64

Operating System: HP-UX bmw B.11.11 U 9000/800 1121911527 unlimited-user
license

Local SSH Version: OpenSSH_4.3p2-hpn, OpenSSL 0.9.7i 14 Oct 2005

HP-UX Secure Shell-A.04.30.006, HP-UX Secure Shell version

Remote SSH Version: OpenSSH_4.5p1+sftpfilecontrol-v1.1-hpn12v14, OpenSSL
0.9.7l 28 Sep 2006

HP-UX Secure Shell-A.04.50.003, HP-UX Secure Shell version

 

Sending a file using the Net::SFTP::Foreign::put method consistently
fails with &#34;Connection to remote server is broken&#34; with largish files.
After further debugging, it appears that the remote server just closes
the connection when largish packets of data are sent.  

 

A work around is to pass in a block_size of 483 to get rid of this
error.  However, this does not result in a successful transfer.  After
explicitly setting the block size, I got errors like &#34;bad packet
sequence, expected 11, got 12&#34;.  The sequence numbers were not the same
each time the error was produced.  By passing in a queue_size of 1, I
was able to finally get a successful &#34;put&#34; of a file larger than 483
bytes.

 

The same problem occurs on a &#34;put&#34; transfer from an AIX machine.  If you
want the OS/SSH/Perl details for this as well, I can dig it up when I
get some time.  The only difference is that the magic number is not 483
bytes but some other slightly larger value &#40;I haven&#39;t figured out the
limit by trial and error on AIX but it is somewhere between 483 and 1000
bytes&#41;.

 

&#34;get&#34; transfers do not have this problem on any OSes tested.  Also, the
sftp command that comes with OpenSSH works fine for sending or receiving
files.  This leads me to believe that there is some logic error in the
put method that is causing this problem but I have not yet been able to
track it down.

 

If you need any more information or have ideas to try, let me know...

 

Thanks,

Tom

This e-mail and any attachments are confidential and may also be legally
privileged and/or copyright material of Intec Telecom Systems PLC &#40;or its
affiliated companies&#41;. If you are not an intended or authorised recipient
of this e-mail or have received it in error, please delete it immediately
and notify the sender by e-mail. In such a case, reading, reproducing,
printing or further dissemination of this e-mail or its contents is strictly
prohibited and may be unlawful.
Intec Telecom Systems PLC does not represent or warrant that an attachment
hereto is free from computer viruses or other defects. The opinions
expressed in this e-mail and any attachments may be those of the author and
are not necessarily those of Intec Telecom Systems PLC.
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;15&nbsp;18:03:30&nbsp;2008</span>
    <span class="description">salva [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> salva [...] cpan.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed May 14 16:09:29 2008, Tom.Warkentin@intecbilling.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Distribution: Net-SFTP-Foreign-1.35
&gt; 
&gt; Perl Version: 5.8.7 built for PA-RISC2.0-LP64
&gt; 
&gt; Operating System: HP-UX bmw B.11.11 U 9000/800 1121911527 unlimited-user
&gt; license
&gt; 
&gt; Local SSH Version: OpenSSH_4.3p2-hpn, OpenSSL 0.9.7i 14 Oct 2005
&gt; 
&gt; HP-UX Secure Shell-A.04.30.006, HP-UX Secure Shell version
&gt; 
&gt; Remote SSH Version: OpenSSH_4.5p1+sftpfilecontrol-v1.1-hpn12v14, OpenSSL
&gt; 0.9.7l 28 Sep 2006
&gt; 
&gt; HP-UX Secure Shell-A.04.50.003, HP-UX Secure Shell version
&gt; 
&gt; Sending a file using the Net::SFTP::Foreign::put method consistently
&gt; fails with &#34;Connection to remote server is broken&#34; with largish files.
&gt; After further debugging, it appears that the remote server just closes
&gt; the connection when largish packets of data are sent.  
</div>
how is your script handling authentication to the remote server? are you
using public-keys or a password?


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; A work around is to pass in a block_size of 483 to get rid of this
&gt; error.  However, this does not result in a successful transfer.  After
&gt; explicitly setting the block size, I got errors like &#34;bad packet
&gt; sequence, expected 11, got 12&#34;.  The sequence numbers were not the same
&gt; each time the error was produced.  By passing in a queue_size of 1, I
&gt; was able to finally get a successful &#34;put&#34; of a file larger than 483
&gt; bytes.
</div>
Net::SFTP::Foreign aggressively pipelines SFTP commands in order to
maximize the throughput and probably the server doesn&#39;t like it.

Have you tried reducing both values at the same time to something
reasonable, for instance: block_size =&gt; 2048, queue_size =&gt; 2.

Anyway, in order to generate debugging information, set...

  $Net::SFTP::Foreign::debug = 25;

at the beginning of the script, and send me the generated output for
both failing cases &#40;not setting the block size and setting it to 483&#41;.


Cheers,

 - Salva
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;15&nbsp;18:03:32&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;15&nbsp;19:17:56&nbsp;2008</span>
    <span class="description">Tom.Warkentin [...] intecbilling.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #35888] put&#40;&#41; on hpux fails with: Connection to remote server is broken </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 15 May 2008 17:17:31 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Net-SFTP-Foreign [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Tom Warkentin&#34; &lt;Tom.Warkentin [...] intecbilling.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">My script is configurable to use username/password authentication or public-keys.  Either method of authentication works fine for retrieving file listing information and for transferring small files without specifying the magic 483 byte block size and queue size of 1.

Based on your suggestions below, I ran four tests with debug to transfer a 5200 byte file.  All tests used username/password authentication using Expect to wait for the appropriate prompts.  I added the code to set the debug value after the SFTP Foreign object was created with a transport passed as the only parameter to the constructor.  When using Expect, I seem to remember the debug output confusing Expect so that is why I did this.

The first test did not pass in a block_size or queue_size and the transfer failed with the &#34;Connection to remote server is broken&#34; error.  See the stderr.dbg_noblk_noque file for the debug output.

The second test passed in a block_size of 2048 and a queue_size of 2.  The transfer failed with the same error.  See the stderr.dbg_2048_2 file for the debug output.

The third test passed in a block_size of 484 but no queue_size and it failed with the error.  See the stderr.dbg_484_noque file for the debug output.

The fourth test passed in a block size of 483 and a queue_size of 1.  The transfer completed successfully.  See the stderr.dbg_483_1 file for the debug output.

Let me know if there are any other scenarios you&#39;d like me to try.  I have also requested that OpenSSH/OpenSSL on the box be upgraded to the latest versions supported by HP.  If this resolves the issue, I will keep you posted...

Cheers,
Tom

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Salvador Fandino Garcia via RT [mailto:bug-Net-SFTP-Foreign@rt.cpan.org] 
Sent: Thursday, May 15, 2008 4:04 PM
To: Tom Warkentin
Subject: [rt.cpan.org #35888] put&#40;&#41; on hpux fails with: Connection to remote server is broken 


&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=35888">http://rt.cpan.org/Ticket/Display.html?id=35888</a></span> &gt;

On Wed May 14 16:09:29 2008, Tom.Warkentin@intecbilling.com wrote:
<div class="message-stanza open">&gt; Distribution: Net-SFTP-Foreign-1.35
&gt; 
&gt; Perl Version: 5.8.7 built for PA-RISC2.0-LP64
&gt; 
&gt; Operating System: HP-UX bmw B.11.11 U 9000/800 1121911527 unlimited-user
&gt; license
&gt; 
&gt; Local SSH Version: OpenSSH_4.3p2-hpn, OpenSSL 0.9.7i 14 Oct 2005
&gt; 
&gt; HP-UX Secure Shell-A.04.30.006, HP-UX Secure Shell version
&gt; 
&gt; Remote SSH Version: OpenSSH_4.5p1+sftpfilecontrol-v1.1-hpn12v14, OpenSSL
&gt; 0.9.7l 28 Sep 2006
&gt; 
&gt; HP-UX Secure Shell-A.04.50.003, HP-UX Secure Shell version
&gt; 
&gt; Sending a file using the Net::SFTP::Foreign::put method consistently
&gt; fails with &#34;Connection to remote server is broken&#34; with largish files.
&gt; After further debugging, it appears that the remote server just closes
&gt; the connection when largish packets of data are sent.  
</div>
how is your script handling authentication to the remote server? are you
using public-keys or a password?


<div class="message-stanza open">&gt; A work around is to pass in a block_size of 483 to get rid of this
&gt; error.  However, this does not result in a successful transfer.  After
&gt; explicitly setting the block size, I got errors like &#34;bad packet
&gt; sequence, expected 11, got 12&#34;.  The sequence numbers were not the same
&gt; each time the error was produced.  By passing in a queue_size of 1, I
&gt; was able to finally get a successful &#34;put&#34; of a file larger than 483
&gt; bytes.
</div>
Net::SFTP::Foreign aggressively pipelines SFTP commands in order to
maximize the throughput and probably the server doesn&#39;t like it.

Have you tried reducing both values at the same time to something
reasonable, for instance: block_size =&gt; 2048, queue_size =&gt; 2.

Anyway, in order to generate debugging information, set...

  $Net::SFTP::Foreign::debug = 25;

at the beginning of the script, and send me the generated output for
both failing cases &#40;not setting the block size and setting it to 483&#41;.


Cheers,

 - Salva

This e-mail and any attachments are confidential and may also be legally
privileged and/or copyright material of Intec Telecom Systems PLC &#40;or its
affiliated companies&#41;. If you are not an intended or authorised recipient
of this e-mail or have received it in error, please delete it immediately
and notify the sender by e-mail. In such a case, reading, reproducing,
printing or further dissemination of this e-mail or its contents is strictly
prohibited and may be unlawful.
Intec Telecom Systems PLC does not represent or warrant that an attachment
hereto is free from computer viruses or other defects. The opinions
expressed in this e-mail and any attachments may be those of the author and
are not necessarily those of Intec Telecom Systems PLC.
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/461904/227296/stderr.dbg_noblk_noque">Download stderr.dbg_noblk_noque</a><br />
<span class="downloadcontenttype">application/octet-stream 24.6k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/461904/227297/stderr.dbg_483_1">Download stderr.dbg_483_1</a><br />
<span class="downloadcontenttype">application/octet-stream 30.9k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/461904/227298/stderr.dbg_2048_2">Download stderr.dbg_2048_2</a><br />
<span class="downloadcontenttype">application/octet-stream 20.4k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/461904/227299/stderr.dbg_484_noque">Download stderr.dbg_484_noque</a><br />
<span class="downloadcontenttype">application/octet-stream 25.8k</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;16&nbsp;06:53:53&nbsp;2008</span>
    <span class="description">sfandino [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #35888] put&#40;&#41; on hpux fails with: Connection to remote server is broken</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 16 May 2008 03:53:03 -0700 &#40;PDT&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-SFTP-Foreign [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Salvador Fandino &lt;sfandino [...] yahoo.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

The debugging output on your last mail doesn&#39;t show the precise cause of the problem, I believe that it is in the _do_io_unix function that probably has hidden dependencies on Linux semantics for some IO operations.

I will send you a new version of the module with improved debugging support in a private email.

Install it and set...

  $Net::SFTP::Foreign::debug = 1|2|32|64;

... and run the tests again. Hopefully, this time we will get more interesting information.

To minimize the possible causes of the problem, don&#39;t use Expect, just
let the script ask for the password on the command line or use
public-key authentication.

It would also help if you could capture the script interaction with the OS using strace, truss or ktrace &#40;or whatever HP-UX has to monitor processes&#41;, but don&#39;t trace the child ssh processes.

Cheers and thank you for your collaboration!

- Salva


      
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;22&nbsp;17:21:42&nbsp;2008</span>
    <span class="description">salva [...] cpan.org -  Correspondence added</span>
    <span class="time-taken">960 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The bug is solved in the new module version 1.37_06 available from CPAN.

Now the interprocess communication performed through a PTY is limited to
the authentication phase. Afterwards, a regular pipe is used.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;22&nbsp;17:21:46&nbsp;2008</span>
    <span class="description">salva [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
