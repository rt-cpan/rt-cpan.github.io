<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #97358 for Encode: Encode Should Accept Noncharacters as Unicode</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #97358 for Encode: Encode Should Accept Noncharacters as Unicode</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Encode/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Encode/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Encode/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Encode/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Encode">Encode CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">97358</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Encode/Active/">Encode</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
dwheeler [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
pali [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-12062-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-12063-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;20&nbsp;01:04:20&nbsp;2014</span>
    <span class="description">dwheeler [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Encode Should Accept Noncharacters as Unicode</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 19 Jul 2014 22:03:59 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Encode [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;dwheeler [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I think this is a bug:

   perl -MEncode -E &#39;say Encode::decode&#40;&#34;UTF-8&#34;, &#34;\xEF\xBF\xBF&#34;, Encode::FB_CROAK&#41;&#39; 
   utf8 &#34;\xFFFF&#34; does not map to Unicode at /usr/local/lib/perl5/site_perl/5.20.0/darwin-thread-multi-2level/Encode.pm line 175.

\xFFFF is, in fact, a part of UTF-8. It is one of a family of “Noncharacters”, and, according to [Corrigendum 9]&#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.unicode.org/versions/corrigendum9.html&#41;">http://www.unicode.org/versions/corrigendum9.html&#41;</a></span>, reserved noncharacters now are allowed to appear in UTF-8 strings.

Related discussions:

  <span class="clickylink"><a target="new" rel="nofollow" href="http://grokbase.com/t/perl/perl5-porters/147gfvrd2n/encode-vs-json">http://grokbase.com/t/perl/perl5-porters/147gfvrd2n/encode-vs-json</a></span>
  <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.perl.org/Public/Bug/Display.html?id=121937">https://rt.perl.org/Public/Bug/Display.html?id=121937</a></span>.

Thanks,

David
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;20&nbsp;06:58:08&nbsp;2014</span>
    <span class="description">DANKOGAI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">If it were are a bug, it belongs to perl core because the strictness of UTF8 is #defined in the value of  UTF8_DISALLOW_ILLEGAL_INTERCHANGE which is defined in perl core:

<span class="clickylink"><a target="new" rel="nofollow" href="http://perldoc.perl.org/perlapi.html#Unicode-Support">http://perldoc.perl.org/perlapi.html#Unicode-Support</a></span>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; * utf8n_to_uvchr
&gt; Certain code points are considered problematic. 
&gt; These are Unicode surrogates, Unicode non-characters, 
&gt; and code points above the Unicode maximum of 0x10FFFF. 
&gt; By default these are considered regular code points, 
&gt; but certain situations warrant special handling for them.
&gt; If flags contains UTF8_DISALLOW_ILLEGAL_INTERCHANGE, 
&gt; all three classes are treated as malformations and handled as such. 
&gt; The flags UTF8_DISALLOW_SURROGATE, UTF8_DISALLOW_NONCHAR, 
&gt; and UTF8_DISALLOW_SUPER &#40;meaning above the legal Unicode maximum&#41; 
&gt; can be set to disallow these categories individually.
</div>
In other words, Encode faithfully believes perl core with that respect.  And I want to leave Encode that way.  If it is to be fixed, it should be fixed by redefining UTF8_DISALLOW_ILLEGAL_INTERCHANGE to exclude UTF8_DISALLOW_NONCHAR in perl core.

Dan the Encode Maintainer

On Sun Jul 20 01:04:20 2014, DWHEELER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I think this is a bug:
&gt; 
&gt; perl -MEncode -E &#39;say Encode::decode&#40;&#34;UTF-8&#34;, &#34;\xEF\xBF\xBF&#34;,
&gt; Encode::FB_CROAK&#41;&#39;
&gt; utf8 &#34;\xFFFF&#34; does not map to Unicode at
&gt; /usr/local/lib/perl5/site_perl/5.20.0/darwin-thread-multi-
&gt; 2level/Encode.pm line 175.
&gt; 
&gt; \xFFFF is, in fact, a part of UTF-8. It is one of a family of
&gt; “Noncharacters”, and, according to [Corrigendum
&gt; 9]&#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.unicode.org/versions/corrigendum9.html&#41;">http://www.unicode.org/versions/corrigendum9.html&#41;</a></span>, reserved
&gt; noncharacters now are allowed to appear in UTF-8 strings.
&gt; 
&gt; Related discussions:
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://grokbase.com/t/perl/perl5-porters/147gfvrd2n/encode-vs-json">http://grokbase.com/t/perl/perl5-porters/147gfvrd2n/encode-vs-json</a></span>
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.perl.org/Public/Bug/Display.html?id=121937">https://rt.perl.org/Public/Bug/Display.html?id=121937</a></span>.
&gt; 
&gt; Thanks,
&gt; 
&gt; David
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;20&nbsp;06:58:09&nbsp;2014</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;20&nbsp;06:58:22&nbsp;2014</span>
    <span class="description">DANKOGAI [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;21&nbsp;14:35:03&nbsp;2014</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #97358] Encode Should Accept Noncharacters as Unicode</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 21 Jul 2014 11:34:37 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Encode [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;dwheeler [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Jul 20, 2014, at 3:58 AM, Dan Kogai via RT &lt;bug-Encode@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; In other words, Encode faithfully believes perl core with that respect.  And I want to leave Encode that way. If it is to be fixed, it should be fixed by redefining UTF8_DISALLOW_ILLEGAL_INTERCHANGE to exclude UTF8_DISALLOW_NONCHAR in perl core.
</div>
Thanks. I have taken this up with Perl 5 Porters.

David
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;07&nbsp;12:30:37&nbsp;2014</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Followup from the p5p thread:

  <span class="clickylink"><a target="new" rel="nofollow" href="http://grokbase.com/t/perl/perl5-porters/147gfvrd2n/encode-vs-json">http://grokbase.com/t/perl/perl5-porters/147gfvrd2n/encode-vs-json</a></span>

I think we need an interface to tell Encode to exclude UTF8_DISALLOW_NONCHAR from UTF8_DISALLOW_ILLEGAL_INTERCHANGE.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;07&nbsp;12:30:38&nbsp;2014</span>
    <span class="description">dwheeler [...] cpan.org -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;05&nbsp;12:24:44&nbsp;2015</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2014-10-07 12:30:37, DWHEELER wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Followup from the p5p thread:
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://grokbase.com/t/perl/perl5-porters/147gfvrd2n/encode-vs-json">http://grokbase.com/t/perl/perl5-porters/147gfvrd2n/encode-vs-json</a></span>
&gt; 
&gt; I think we need an interface to tell Encode to exclude
&gt; UTF8_DISALLOW_NONCHAR from UTF8_DISALLOW_ILLEGAL_INTERCHANGE.
</div>
Hey Dan, any chance we could see this functionality integrated soon?

Thanks,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;13&nbsp;17:49:28&nbsp;2016</span>
    <span class="description">pali [...] cpan.org -  Cc PALI added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;13&nbsp;18:02:06&nbsp;2016</span>
    <span class="description">pali [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Ned Júl 20 01:04:20 2014, DWHEELER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I think this is a bug:
&gt; 
&gt; perl -MEncode -E &#39;say Encode::decode&#40;&#34;UTF-8&#34;, &#34;\xEF\xBF\xBF&#34;,
&gt; Encode::FB_CROAK&#41;&#39;
&gt; utf8 &#34;\xFFFF&#34; does not map to Unicode at
&gt; /usr/local/lib/perl5/site_perl/5.20.0/darwin-thread-multi-
&gt; 2level/Encode.pm line 175.
</div>
I would say this is correct and expected behaviour.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; \xFFFF is, in fact, a part of UTF-8. It is one of a family of
&gt; “Noncharacters”, and, according to [Corrigendum
&gt; 9]&#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.unicode.org/versions/corrigendum9.html&#41;">http://www.unicode.org/versions/corrigendum9.html&#41;</a></span>, reserved
&gt; noncharacters now are allowed to appear in UTF-8 strings.
</div>
Above function convert UTF-8 octet string to perl Unicode string. And &#34;\xFFFF&#34; is really not valid Unicode character.

If you want to replace invalid Unicode characters by Unicode replacement character &#34;\xFFFD&#34;, then call decode method with FB_DEFAULT flag &#40;also equivalent of calling with none flags&#41;. FB_CROAK is there to croak when input strict cannot be correctly converted.

Anyway, &#34;UTF-8&#34; encoding implements strict UTF-8 encoding and non-characters and invalid sequences must not be accepted. I would suggest you to read about utf8 vs UTF-8 in perl: <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/pod/Encode#UTF-8-vs.-utf8-vs.-UTF8">https://metacpan.org/pod/Encode#UTF-8-vs.-utf8-vs.-UTF8</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;14&nbsp;07:13:09&nbsp;2016</span>
    <span class="description">dwheeler [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> pali [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #97358] Encode Should Accept Noncharacters as Unicode</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 14 Jul 2016 12:12:55 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Encode [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;David E. Wheeler&#34; &lt;dwheeler [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Jul 13, 2016, at 11:02 PM, Pali via RT &lt;bug-Encode@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Above function convert UTF-8 octet string to perl Unicode string. And &#34;\xFFFF&#34; is really not valid Unicode character.
</div>
Hey, thanks for your comments, pali. You’re correct that it’s not a Unicode character. In fact, it’s specifically identified as a “noncharacter”.

There was a fair bit of discussion of this issue on p5p, which you can see in the link upthread in this ticket. It’s clear that there’s some disagreement over the interpretation of corrigendum 9, which says that noncharacters *should* be allowed in UTF-8 strings.

The upshot is that sometimes one needs an option to tell Encode to exclude UTF8_DISALLOW_NONCHAR from UTF8_DISALLOW_ILLEGAL_INTERCHANGE. This will help when dealing with services that allow noncharacters in their output and they need to be preserved by the Perl code processing that string.

Best,

David
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;14&nbsp;12:08:50&nbsp;2016</span>
    <span class="description">pali [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Štv Júl 14 07:13:09 2016, DWHEELER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Jul 13, 2016, at 11:02 PM, Pali via RT &lt;bug-Encode@rt.cpan.org&gt;
&gt; wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; Above function convert UTF-8 octet string to perl Unicode string. And
&gt; &gt; &#34;\xFFFF&#34; is really not valid Unicode character.
</div>&gt; 
&gt; Hey, thanks for your comments, pali. You’re correct that it’s not a
&gt; Unicode character. In fact, it’s specifically identified as a
&gt; “noncharacter”.
&gt; 
&gt; There was a fair bit of discussion of this issue on p5p, which you can
&gt; see in the link upthread in this ticket. It’s clear that there’s some
&gt; disagreement over the interpretation of corrigendum 9, which says that
&gt; noncharacters *should* be allowed in UTF-8 strings.
</div>
I do not if standard/specification allow or not them in UTF-8, but personally I&#39;m avoiding to send or use such UTF-8 sequence.

But it it not important if it is allowed or not in UTF-8. Here you we are dealing with conversion from UTF-8 to Unicode &#40;not what is allowed in UTF-8&#41;. And that problematic sequence is not Unicode character and therefore throwing error is expected behaviour... That is similar problem if you want to convert e.g. UTF-8 to Latin1. Some characters can be converted and some not...

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The upshot is that sometimes one needs an option to tell Encode to
&gt; exclude UTF8_DISALLOW_NONCHAR from UTF8_DISALLOW_ILLEGAL_INTERCHANGE.
&gt; This will help when dealing with services that allow noncharacters in
&gt; their output and they need to be preserved by the Perl code processing
&gt; that string.
</div>
If you in some case really want to have those character in output perl &#40;unicoded&#41; string, then strict &#34;UTF-8&#34; encoder is not for you. There is &#34;utf8&#34; one, as mentioned in previous link about UTF-8 vs utf8.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;07&nbsp;09:33:01&nbsp;2017</span>
    <span class="description">pali [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ok, Unicode Standard, Version 9.0 at <span class="clickylink"><a target="new" rel="nofollow" href="http://www.unicode.org/versions/Unicode9.0.0/">http://www.unicode.org/versions/Unicode9.0.0/</a></span> in chapter 3.9 Unicode Encoding Forms says:

* Any UTF-8 byte sequence that does not match the patterns listed in Table 3-7 is ill-formed.

* A conformant encoding form conversion will treat any ill-formed code unit sequence as an error condition.

Table 3-7 contains Well-Formed UTF-8 Byte Sequences *without* noncharacters.

So no, noncharacters cannot be allowed in UTF-8.

Because in Encode module supports also &#34;utf8&#34; encoding &#40;which allows noncharacters&#41; and &#34;UTF-8&#34; cannot allow noncharacters, this bug can be closed as invalid.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;07&nbsp;10:50:01&nbsp;2017</span>
    <span class="description">DANKOGAI [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
