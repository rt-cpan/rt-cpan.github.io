<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #29701 for reaper: reaper doesn&#39;t work with waitpid function</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #29701 for reaper: reaper doesn&#39;t work with waitpid function</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/reaper/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/reaper/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/reaper/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/reaper/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/reaper">reaper CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">29701</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/reaper/Active/">reaper</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
jonathon.eastman [...] wellpoint.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-27646-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.00    </td>
  </tr>
  <tr id="CF-27647-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
1.00    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;01&nbsp;18:57:09&nbsp;2007</span>
    <span class="description">jonathon.eastman [...] wellpoint.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> reaper doesn&#39;t work with waitpid function</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I’ve been using th reaper perl modules to get the exit status for a
forked exec call.   It works as long as I don’t use the waitpid
function.   I&#39;m not sure if this a bug or end-user ignorance, but is
there a way around this?

I&#39;m on AIX 5.3
Using Perl 5.8.8

here&#39;s my code, if i take out my waitpid function and put a sleep in for
the expected run-time of t1.pl, it works:

use Reaper qw&#40; reaper reapPid pidStatus &#41;;
{
        my $pid = fork;
        if &#40; $pid == 0 &#41; { # child
          exec &#34;perl t1.pl&#34;;
        }
        reapPid &#40; $pid &#41;;
        
        waitpid&#40;$pid,0&#41;;
        
        if &#40; defined&#40;my $exit = pidStatus&#40;$pid&#41;&#41; &#41; {
           print &#34;CHILD OK\n&#34;;
        }
        else {
                print &#34;NOT OK\n&#34;;
        }
}
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;01&nbsp;23:37:37&nbsp;2007</span>
    <span class="description">jeremy [...] jkslade.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #29701] reaper doesn&#39;t work with waitpid function</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 01 Oct 2007 21:37:01 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-reaper [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jeremy Slade &lt;jeremy [...] jkslade.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Reaper is intended for situations where the child can exit at any
&#40;unknown&#41; time -- e.g. when you aren&#39;t specifically waiting for it.
What happens with waitpid&#40;&#41; is the waitpid&#40;&#41; waits until the process is
done, and gets the exit status from the kernel &#40;stored in $?&#41;.  So some
time later when Reaper also calls waitpid&#40;&#41;, the status has already been
retrieved so it&#39;s no longer available...

Calling waitpid&#40;&#41; yourself is really not compatible with Reaper.  If you
want to waitpid&#40;&#41; for the process yourself, the exit status is available
immediately after waitpid&#40;&#41; returns as $?


  waitpid&#40;$pid,0&#41;;
  my $exit = $?;
  if &#40; $exit &#41; {
    # non-zero exit status...
  } else {
    # exit = 0, child ok
  }


Jeremy


Jonathon Eastman via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Mon Oct 01 18:57:09 2007: Request 29701 was acted upon.
&gt; Transaction: Ticket created by slackeast
&gt;        Queue: reaper
&gt;      Subject: reaper doesn&#39;t work with waitpid function
&gt;    Broken in: 1.00
&gt;     Severity: Normal
&gt;        Owner: Nobody
&gt;   Requestors: jonathon.eastman@wellpoint.com
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=29701">http://rt.cpan.org/Ticket/Display.html?id=29701</a></span> &gt;
&gt; 
&gt; 
&gt; I’ve been using th reaper perl modules to get the exit status for a
&gt; forked exec call.   It works as long as I don’t use the waitpid
&gt; function.   I&#39;m not sure if this a bug or end-user ignorance, but is
&gt; there a way around this?
&gt; 
&gt; I&#39;m on AIX 5.3
&gt; Using Perl 5.8.8
&gt; 
&gt; here&#39;s my code, if i take out my waitpid function and put a sleep in for
&gt; the expected run-time of t1.pl, it works:
&gt; 
&gt; use Reaper qw&#40; reaper reapPid pidStatus &#41;;
&gt; {
&gt;       my $pid = fork;
&gt;       if &#40; $pid == 0 &#41; { # child
&gt;         exec &#34;perl t1.pl&#34;;
&gt;       }
&gt;       reapPid &#40; $pid &#41;;
&gt;       
&gt;       waitpid&#40;$pid,0&#41;;
&gt;       
&gt;       if &#40; defined&#40;my $exit = pidStatus&#40;$pid&#41;&#41; &#41; {
&gt;          print &#34;CHILD OK\n&#34;;
&gt;       }
&gt;       else {
&gt;               print &#34;NOT OK\n&#34;;
&gt;       }
&gt; }
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;01&nbsp;23:37:43&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;02&nbsp;14:11:23&nbsp;2007</span>
    <span class="description">jonathon.eastman [...] wellpoint.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #29701] reaper doesn&#39;t work with waitpid function</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 2 Oct 2007 11:10:43 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-reaper [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Eastman, Jonathon&#34; &lt;Jonathon.Eastman [...] wellpoint.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for your quick response.    I used the $? Predefined variable and
it works well on my windows computer.   However, it doesn&#39;t work on
AIX-5.3.  It returns only a -1.  Must be an AIX POSIX compliance issue.
So I just created my own waitpid function and in combination with
reaper, it works great.

Thanks for all your help!

Jonathon Eastman

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Jeremy Slade via RT [mailto:bug-reaper@rt.cpan.org] 
Sent: Monday, October 01, 2007 8:38 PM
To: Eastman, Jonathon
Subject: Re: [rt.cpan.org #29701] reaper doesn&#39;t work with waitpid
function


&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=29701">http://rt.cpan.org/Ticket/Display.html?id=29701</a></span> &gt;

Reaper is intended for situations where the child can exit at any
&#40;unknown&#41; time -- e.g. when you aren&#39;t specifically waiting for it.
What happens with waitpid&#40;&#41; is the waitpid&#40;&#41; waits until the process is
done, and gets the exit status from the kernel &#40;stored in $?&#41;.  So some
time later when Reaper also calls waitpid&#40;&#41;, the status has already been
retrieved so it&#39;s no longer available...

Calling waitpid&#40;&#41; yourself is really not compatible with Reaper.  If you
want to waitpid&#40;&#41; for the process yourself, the exit status is available
immediately after waitpid&#40;&#41; returns as $?


  waitpid&#40;$pid,0&#41;;
  my $exit = $?;
  if &#40; $exit &#41; {
    # non-zero exit status...
  } else {
    # exit = 0, child ok
  }


Jeremy


Jonathon Eastman via RT wrote:
<div class="message-stanza open">&gt; Mon Oct 01 18:57:09 2007: Request 29701 was acted upon.
&gt; Transaction: Ticket created by slackeast
&gt;        Queue: reaper
&gt;      Subject: reaper doesn&#39;t work with waitpid function
&gt;    Broken in: 1.00
&gt;     Severity: Normal
&gt;        Owner: Nobody
&gt;   Requestors: jonathon.eastman@wellpoint.com
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=29701">http://rt.cpan.org/Ticket/Display.html?id=29701</a></span> &gt;
&gt; 
&gt; 
&gt; I&#39;ve been using th reaper perl modules to get the exit status for a
&gt; forked exec call.   It works as long as I don&#39;t use the waitpid
&gt; function.   I&#39;m not sure if this a bug or end-user ignorance, but is
&gt; there a way around this?
&gt; 
&gt; I&#39;m on AIX 5.3
&gt; Using Perl 5.8.8
&gt; 
&gt; here&#39;s my code, if i take out my waitpid function and put a sleep in
</div>for
<div class="message-stanza open">&gt; the expected run-time of t1.pl, it works:
&gt; 
&gt; use Reaper qw&#40; reaper reapPid pidStatus &#41;;
&gt; {
&gt;       my $pid = fork;
&gt;       if &#40; $pid == 0 &#41; { # child
&gt;         exec &#34;perl t1.pl&#34;;
&gt;       }
&gt;       reapPid &#40; $pid &#41;;
&gt;       
&gt;       waitpid&#40;$pid,0&#41;;
&gt;       
&gt;       if &#40; defined&#40;my $exit = pidStatus&#40;$pid&#41;&#41; &#41; {
&gt;          print &#34;CHILD OK\n&#34;;
&gt;       }
&gt;       else {
&gt;               print &#34;NOT OK\n&#34;;
&gt;       }
&gt; }
</div>


CONFIDENTIALITY NOTICE: This e-mail message, including any attachments, is for the sole use of the intended recipient&#40;s&#41; and may contain confidential and privileged information or otherwise protected by law. Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please contact the sender by reply e-mail and destroy all copies of the original message.
</div></div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
