<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #76437 for Catalyst-Runtime: Test failures with bleadperl &#40;Can&#39;t use an undefined value as an ARRAY reference&#41;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #76437 for Catalyst-Runtime: Test failures with bleadperl &#40;Can&#39;t use an undefined value as an ARRAY reference&#41;</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Catalyst-Runtime">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Catalyst-Runtime">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Catalyst-Runtime">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Catalyst-Runtime">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Catalyst-Runtime">Catalyst-Runtime CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">76437</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Catalyst-Runtime">Catalyst-Runtime</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
SREZIC [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
bobtfish [...] bobtfish.net

<br />
rafl [...] debian.org

<br />
nigel.metheringham [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-40040-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
5.90011    </td>
  </tr>
  <tr id="CF-40041-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




open_b9jAUjzS.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1069688/562622/open_b9jAUjzS.txt">
Thu Apr 19 13:04:02 2012 (687b) by $_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=76437">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1065738" href="/Public/Bug/Display.html?id=76437#txn-1065738">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;09&nbsp;06:14:37&nbsp;2012</span>
    <span class="description">SREZIC [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Test failures with bleadperl &#40;Can&#39;t use an undefined value as an
 ARRAY reference&#41;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1065738/560294/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/560294">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 461b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The t/live_app.t test fails with bleadperl. The matrix overview
<span class="clickylink"><a target="new" rel="nofollow" href="http://matrix.cpantesters.org/?dist=Catalyst-Authentication-Credential-HTTP-1.014">http://matrix.cpantesters.org/?dist=Catalyst-Authentication-Credential-HTTP-1.014</a></span>
suggests that the failures started with 5.15.5 &#40;the PASSes there are
probably from systems where Test::WWW::Mechanize::Catalyst is not
installed and the problematic test is skipped&#41;.

A sample test report with a FAIL:
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpantesters.org/cpan/report/5541ece2-80e5-11e1-a9f1-a8f3163997d5">http://www.cpantesters.org/cpan/report/5541ece2-80e5-11e1-a9f1-a8f3163997d5</a></span>

Regards,
    Slaven
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1066161" href="/Public/Bug/Display.html?id=76437#txn-1066161">#</a>      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;10&nbsp;06:18:08&nbsp;2012</span>
    <span class="description">nigel.metheringham [...] gmail.com -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1066162" href="/Public/Bug/Display.html?id=76437#txn-1066162">#</a>      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;10&nbsp;06:18:41&nbsp;2012</span>
    <span class="description">nigel.metheringham [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1066162/560543/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/560543">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 40b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m building the stuff to look at this.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1066165" href="/Public/Bug/Display.html?id=76437#txn-1066165">#</a>      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;10&nbsp;06:18:47&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1068321" href="/Public/Bug/Display.html?id=76437#txn-1068321">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;16&nbsp;16:55:32&nbsp;2012</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1068321/561747/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/561747">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 122b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">A maybe related failure in another Catalyst module:
<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=76610">https://rt.cpan.org/Ticket/Display.html?id=76610</a></span>

Regards,
    Slaven
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1068680" href="/Public/Bug/Display.html?id=76437#txn-1068680">#</a>      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;17&nbsp;16:47:14&nbsp;2012</span>
    <span class="description">ANDK [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> sprout [...] cpan.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1068680/561958/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/561958">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 298b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">A bisect points to v5.15.4-401-gf45b078. Note that one more prerequisite
must be met than the declared ones to produce the fail,
Test::WWW::Mechanize::Catalyst must be there. In my case it is 0.57 for
both perls. v5.15.4-400-g3973654 has all tests pass,
v5.15.4-401-gf45b078 the cited diagnostics.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1069024" href="/Public/Bug/Display.html?id=76437#txn-1069024">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;18&nbsp;11:30:46&nbsp;2012</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1069024/562160/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/562160">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I tried adding this to t/live_app.t and running it with 5.14.2 and 5.15.9:

BEGIN { *CORE::GLOBAL::bless = sub &#40;$;$&#41; { Carp&#39;cluck join &#34; &#34;, caller if $_[1] eq &#39;AuthTestApp&#39;; 
goto &#38;CORE::bless } }

The resulting backtraces differ at this point:

5.14.2:

        AuthTestApp::new&#40;&#39;AuthTestApp&#39;, &#39;HASH&#40;0xeea8c0&#41;&#39;&#41; called at 
/Users/sprout/.cpan/build/Catalyst-Runtime-5.90011-wEvMJu/blib/lib/Catalyst.pm line 
2024
        Catalyst::prepare&#40;&#39;AuthTestApp&#39;, &#39;env&#39;, &#39;HASH&#40;0xf0e3e0&#41;&#39;, &#39;response_cb&#39;, 
&#39;CODE&#40;0xf0eab0&#41;&#39;&#41; called at /Users/sprout/.cpan/build/Catalyst-Runtime-5.90011-
wEvMJu/blib/lib/Catalyst.pm line 1986

5.15.9:

        Class::Accessor::new&#40;&#39;AuthTestApp&#39;, &#39;HASH&#40;0xf51870&#41;&#39;&#41; called at 
/Users/sprout/.cpan/build/Catalyst-Runtime-5.90011-oJnh2Y/blib/lib/Catalyst.pm line 
2029
        Catalyst::prepare&#40;&#39;AuthTestApp&#39;, &#39;env&#39;, &#39;HASH&#40;0xf50fa0&#41;&#39;, &#39;response_cb&#39;, 
&#39;CODE&#40;0xf51420&#41;&#39;&#41; called at /Users/sprout/.cpan/build/Catalyst-Runtime-5.90011-
oJnh2Y/blib/lib/Catalyst.pm line 1991

The code in question seems to be this in Catalyst::prepare:

    # XXX
    # After the app/ctxt split, this should become an attribute based on something passed
    # into the application.
    $class-&gt;context_class&#40; ref $class || $class &#41; unless $class-&gt;context_class;

    my $uploadtmp = $class-&gt;config-&gt;{uploadtmp};
    my $c = $class-&gt;context_class-&gt;new&#40;{ $uploadtmp ? &#40;_uploadtmp =&gt; $uploadtmp&#41; : &#40;&#41;}&#41;;

So apparently context_class is set incorrectly.  I’ll keep digging.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1069030" href="/Public/Bug/Display.html?id=76437#txn-1069030">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;18&nbsp;11:44:16&nbsp;2012</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1069030/562166/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/562166">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 371b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Apr 18 11:30:46 2012, SPROUT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I tried adding this to t/live_app.t and running it with 5.14.2 and
&gt; 5.15.9:
&gt; 
&gt; BEGIN { *CORE::GLOBAL::bless = sub &#40;$;$&#41; { Carp&#39;cluck join &#34; &#34;, caller
&gt; if $_[1] eq &#39;AuthTestApp&#39;;
&gt; goto &#38;CORE::bless } }
</div>
Except I had to use CORE::bless&#40;$_[0], @_ == 2 ? $_[1] : caller&#41; on 5.14.2, rather than goto 
&#38;CORE::bless, of course.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1069054" href="/Public/Bug/Display.html?id=76437#txn-1069054">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;18&nbsp;12:51:35&nbsp;2012</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1069054/562180/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/562180">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Apr 18 11:30:46 2012, SPROUT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I tried adding this to t/live_app.t and running it with 5.14.2 and
&gt; 5.15.9:
&gt; 
&gt; BEGIN { *CORE::GLOBAL::bless = sub &#40;$;$&#41; { Carp&#39;cluck join &#34; &#34;, caller
&gt; if $_[1] eq &#39;AuthTestApp&#39;;
&gt; goto &#38;CORE::bless } }
&gt; 
&gt; The resulting backtraces differ at this point:
&gt; 
&gt; 5.14.2:
&gt; 
&gt;       AuthTestApp::new&#40;&#39;AuthTestApp&#39;, &#39;HASH&#40;0xeea8c0&#41;&#39;&#41; called at
&gt; /Users/sprout/.cpan/build/Catalyst-Runtime-5.90011-
&gt; wEvMJu/blib/lib/Catalyst.pm line
&gt; 2024
&gt;       Catalyst::prepare&#40;&#39;AuthTestApp&#39;, &#39;env&#39;, &#39;HASH&#40;0xf0e3e0&#41;&#39;,
&gt; &#39;response_cb&#39;,
&gt; &#39;CODE&#40;0xf0eab0&#41;&#39;&#41; called at /Users/sprout/.cpan/build/Catalyst-
&gt; Runtime-5.90011-
&gt; wEvMJu/blib/lib/Catalyst.pm line 1986
&gt; 
&gt; 5.15.9:
&gt; 
&gt;       Class::Accessor::new&#40;&#39;AuthTestApp&#39;, &#39;HASH&#40;0xf51870&#41;&#39;&#41; called at
&gt; /Users/sprout/.cpan/build/Catalyst-Runtime-5.90011-
&gt; oJnh2Y/blib/lib/Catalyst.pm line
&gt; 2029
&gt;       Catalyst::prepare&#40;&#39;AuthTestApp&#39;, &#39;env&#39;, &#39;HASH&#40;0xf50fa0&#41;&#39;,
&gt; &#39;response_cb&#39;,
&gt; &#39;CODE&#40;0xf51420&#41;&#39;&#41; called at /Users/sprout/.cpan/build/Catalyst-
&gt; Runtime-5.90011-
&gt; oJnh2Y/blib/lib/Catalyst.pm line 1991
&gt; 
&gt; The code in question seems to be this in Catalyst::prepare:
&gt; 
&gt;     # XXX
&gt;     # After the app/ctxt split, this should become an attribute based
&gt; on something passed
&gt;     # into the application.
&gt;     $class-&gt;context_class&#40; ref $class || $class &#41; unless $class-
<div class="message-stanza open">&gt; &gt;context_class;
</div>&gt; 
&gt;     my $uploadtmp = $class-&gt;config-&gt;{uploadtmp};
&gt;     my $c = $class-&gt;context_class-&gt;new&#40;{ $uploadtmp ? &#40;_uploadtmp =&gt;
&gt; $uploadtmp&#41; : &#40;&#41;}&#41;;
&gt; 
&gt; So apparently context_class is set incorrectly.  I’ll keep digging.
</div>
$class-&gt;context_class is AuthTestApp in both cases.  So somehow AuthTestApp is getting its 
own new method under 5.14.2, but not 5.15.9.

The mro is different, too:

5.14.2: AuthTestApp Catalyst::Plugin::Authentication Moose::Object Catalyst 
Catalyst::Component Catalyst::Controller MooseX::MethodAttributes::Inheritable

5.15.9: AuthTestApp Catalyst::Plugin::Authentication Class::Accessor::Fast Class::Accessor 
Catalyst Catalyst::Component Moose::Object Catalyst::Controller 
MooseX::MethodAttributes::Inheritable

Which leads me here:

  DB&lt;11&gt; x \@Catalyst::Plugin::Authentication::ISA
0  ARRAY&#40;0x241e020&#41;
   0  &#39;Moose::Object&#39;

  DB&lt;10&gt; x \@Catalyst::Plugin::Authentication::ISA
0  ARRAY&#40;0x24f4580&#41;
   0  &#39;Class::Accessor::Fast&#39;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1069057" href="/Public/Bug/Display.html?id=76437#txn-1069057">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;18&nbsp;12:56:29&nbsp;2012</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1069057/562183/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/562183">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Apr 18 12:51:35 2012, SPROUT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Which leads me here:
&gt; 
</div>
5.14.2:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;   DB&lt;11&gt; x \@Catalyst::Plugin::Authentication::ISA
&gt; 0  ARRAY&#40;0x241e020&#41;
&gt;    0  &#39;Moose::Object&#39;
&gt; 
</div>
5.15.9:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;   DB&lt;10&gt; x \@Catalyst::Plugin::Authentication::ISA
&gt; 0  ARRAY&#40;0x24f4580&#41;
&gt;    0  &#39;Class::Accessor::Fast&#39;
</div>
Next step:

5.14.2:
  DB&lt;1&gt; w @Catalyst::Plugin::Authentication::ISA 
  DB&lt;2&gt; c
Watchpoint 0:   @Catalyst::Plugin::Authentication::ISA changed:
    old value:  &#39;&#39;
    new value:  &#39;Moose::Object&#39;
Class::MOP::Class::superclasses&#40;/Users/sprout/.cpan/build/Moose-2.0403-
yf4L1V/blib/lib/Class/MOP/Class.pm:948&#41;:
948:            my $class = $self-&gt;name;
  DB&lt;2&gt; T
. = Class::MOP::Class::superclasses&#40;ref&#40;Moose::Meta::Class&#41;, &#39;Moose::Object&#39;&#41; called from file 
`/Users/sprout/.cpan/build/Moose-2.0403-yf4L1V/blib/lib/Moose/Meta/Class.pm&#39; line 559
. = Moose::Meta::Class::superclasses&#40;undef, &#39;Moose::Object&#39;&#41; called from file 
`/Users/sprout/.cpan/build/Moose-2.0403-yf4L1V/blib/lib/Moose.pm&#39; line 215
. = Moose::init_meta&#40;&#39;Moose&#39;, &#39;for_class&#39;, &#39;Catalyst::Plugin::Authentication&#39;, &#39;metaclass&#39;, undef, 
&#39;meta_name&#39;, &#39;meta&#39;&#41; called from file `/Users/sprout/.cpan/build/Moose-2.0403-
yf4L1V/blib/lib/Moose/Exporter.pm&#39; line 435
$ = Moose::Exporter::__ANON__[/Users/sprout/.cpan/build/Moose-2.0403-
yf4L1V/blib/lib/Moose/Exporter.pm:468]&#40;&#39;Moose&#39;&#41; called from file 
`/Users/sprout/.cpan/build/Catalyst-Plugin-Authentication-0.10019-
5ySbKT/blib/lib/Catalyst/Plugin/Authentication.pm&#39; line 3
$ = Catalyst::Plugin::Authentication::BEGIN&#40;&#41; called from file 
`/Users/sprout/.cpan/build/Catalyst-Plugin-Authentication-0.10019-
5ySbKT/blib/lib/Catalyst/Plugin/Authentication.pm&#39; line 3
...snipped...

5.15.9:

  DB&lt;1&gt; w @Catalyst::Plugin::Authentication::ISA
  DB&lt;2&gt; c
Watchpoint 0:   @Catalyst::Plugin::Authentication::ISA changed:
    old value:  &#39;&#39;
    new value:  &#39;Class::Accessor::Fast&#39;
base::import&#40;/usr/local/lib/perl5/5.15.9/base.pm:114&#41;:
114:        if&#40; defined $fields_base &#41; {
  DB&lt;2&gt; T
. = base::import&#40;&#39;base&#39;, &#39;Class::Accessor::Fast&#39;&#41; called from file 
&#39;/Users/sprout/.cpan/build/Catalyst-Plugin-Authentication-0.10018-
2pbKQy/blib/lib/Catalyst/Plugin/Authentication.pm&#39; line 3
. = Catalyst::Plugin::Authentication::BEGIN&#40;&#41; called from file 
&#39;/Users/sprout/.cpan/build/Catalyst-Plugin-Authentication-0.10018-
2pbKQy/blib/lib/Catalyst/Plugin/Authentication.pm&#39; line 3
...snipped...

Line 3 of Authentication.pm is ‘use Moose;’.

This is getting interesting....
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1069073" href="/Public/Bug/Display.html?id=76437#txn-1069073">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;18&nbsp;13:03:51&nbsp;2012</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1069073/562195/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/562195">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 243b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Apr 18 12:56:29 2012, SPROUT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Line 3 of Authentication.pm is ‘use Moose;’.
&gt; 
&gt; This is getting interesting....
</div>
Um, I was using two different version of Catalyst::Plugin::Authentication.  Now I have to start 
from scratch.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1069084" href="/Public/Bug/Display.html?id=76437#txn-1069084">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;18&nbsp;13:21:16&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1069084/562201/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/562201">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Apr 18 11:30:46 2012, SPROUT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I tried adding this to t/live_app.t and running it with 5.14.2 and
&gt; 5.15.9:
&gt; 
&gt; BEGIN { *CORE::GLOBAL::bless = sub &#40;$;$&#41; { Carp&#39;cluck join &#34; &#34;, caller
&gt; if $_[1] eq &#39;AuthTestApp&#39;;
&gt; goto &#38;CORE::bless } }
&gt; 
&gt; The resulting backtraces differ at this point:
&gt; 
&gt; 5.14.2:
&gt; 
&gt;       AuthTestApp::new&#40;&#39;AuthTestApp&#39;, &#39;HASH&#40;0xeea8c0&#41;&#39;&#41; called at
&gt; /Users/sprout/.cpan/build/Catalyst-Runtime-5.90011-
&gt; wEvMJu/blib/lib/Catalyst.pm line
&gt; 2024
&gt;       Catalyst::prepare&#40;&#39;AuthTestApp&#39;, &#39;env&#39;, &#39;HASH&#40;0xf0e3e0&#41;&#39;,
&gt; &#39;response_cb&#39;,
&gt; &#39;CODE&#40;0xf0eab0&#41;&#39;&#41; called at /Users/sprout/.cpan/build/Catalyst-
&gt; Runtime-5.90011-
&gt; wEvMJu/blib/lib/Catalyst.pm line 1986
&gt; 
&gt; 5.15.9:
&gt; 
&gt;       Class::Accessor::new&#40;&#39;AuthTestApp&#39;, &#39;HASH&#40;0xf51870&#41;&#39;&#41; called at
&gt; /Users/sprout/.cpan/build/Catalyst-Runtime-5.90011-
&gt; oJnh2Y/blib/lib/Catalyst.pm line
&gt; 2029
&gt;       Catalyst::prepare&#40;&#39;AuthTestApp&#39;, &#39;env&#39;, &#39;HASH&#40;0xf50fa0&#41;&#39;,
&gt; &#39;response_cb&#39;,
&gt; &#39;CODE&#40;0xf51420&#41;&#39;&#41; called at /Users/sprout/.cpan/build/Catalyst-
&gt; Runtime-5.90011-
&gt; oJnh2Y/blib/lib/Catalyst.pm line 1991
</div>
AHA!!!

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/rafl/catalyst-runtime/blob/master/lib/Catalyst.pm#L1187">https://github.com/rafl/catalyst-runtime/blob/master/lib/Catalyst.pm#L1187</a></span>

This is the culprit, I would guess.

What happens is that we explicitly make the application class
&#40;&#34;AuthTestApp&#34;&#41; immutable at the end of compliation - which inlines a
Moose constructor directly into AuthTestApp.

If we don&#39;t do this, then the -&gt;new method comes from
Class::Accessor::Fast, which results in none of the Moose attributes
getting their default values...

I would guess that some change in blead is causing the scope hook to not
fire in the same manor it used to / not fire at all, which is the cause
of this fail.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1069177" href="/Public/Bug/Display.html?id=76437#txn-1069177">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;18&nbsp;16:22:03&nbsp;2012</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1069177/562257/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/562257">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Apr 18 13:21:16 2012, BOBTFISH wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed Apr 18 11:30:46 2012, SPROUT wrote:
<div class="message-stanza open">&gt; &gt; I tried adding this to t/live_app.t and running it with 5.14.2 and
&gt; &gt; 5.15.9:
&gt; &gt; 
&gt; &gt; BEGIN { *CORE::GLOBAL::bless = sub &#40;$;$&#41; { Carp&#39;cluck join &#34; &#34;, caller
&gt; &gt; if $_[1] eq &#39;AuthTestApp&#39;;
&gt; &gt; goto &#38;CORE::bless } }
&gt; &gt; 
&gt; &gt; The resulting backtraces differ at this point:
&gt; &gt; 
&gt; &gt; 5.14.2:
&gt; &gt; 
&gt; &gt;     AuthTestApp::new&#40;&#39;AuthTestApp&#39;, &#39;HASH&#40;0xeea8c0&#41;&#39;&#41; called at
&gt; &gt; /Users/sprout/.cpan/build/Catalyst-Runtime-5.90011-
&gt; &gt; wEvMJu/blib/lib/Catalyst.pm line
&gt; &gt; 2024
&gt; &gt;     Catalyst::prepare&#40;&#39;AuthTestApp&#39;, &#39;env&#39;, &#39;HASH&#40;0xf0e3e0&#41;&#39;,
&gt; &gt; &#39;response_cb&#39;,
&gt; &gt; &#39;CODE&#40;0xf0eab0&#41;&#39;&#41; called at /Users/sprout/.cpan/build/Catalyst-
&gt; &gt; Runtime-5.90011-
&gt; &gt; wEvMJu/blib/lib/Catalyst.pm line 1986
&gt; &gt; 
&gt; &gt; 5.15.9:
&gt; &gt; 
&gt; &gt;     Class::Accessor::new&#40;&#39;AuthTestApp&#39;, &#39;HASH&#40;0xf51870&#41;&#39;&#41; called at
&gt; &gt; /Users/sprout/.cpan/build/Catalyst-Runtime-5.90011-
&gt; &gt; oJnh2Y/blib/lib/Catalyst.pm line
&gt; &gt; 2029
&gt; &gt;     Catalyst::prepare&#40;&#39;AuthTestApp&#39;, &#39;env&#39;, &#39;HASH&#40;0xf50fa0&#41;&#39;,
&gt; &gt; &#39;response_cb&#39;,
&gt; &gt; &#39;CODE&#40;0xf51420&#41;&#39;&#41; called at /Users/sprout/.cpan/build/Catalyst-
&gt; &gt; Runtime-5.90011-
&gt; &gt; oJnh2Y/blib/lib/Catalyst.pm line 1991
</div>&gt; 
&gt; AHA!!!
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/rafl/catalyst-runtime/blob/master/lib/Catalyst.pm#L1187">https://github.com/rafl/catalyst-runtime/blob/master/lib/Catalyst.pm#L1187</a></span>
&gt; 
&gt; This is the culprit, I would guess.
&gt; 
&gt; What happens is that we explicitly make the application class
&gt; &#40;&#34;AuthTestApp&#34;&#41; immutable at the end of compliation - which inlines a
&gt; Moose constructor directly into AuthTestApp.
&gt; 
&gt; If we don&#39;t do this, then the -&gt;new method comes from
&gt; Class::Accessor::Fast, which results in none of the Moose attributes
&gt; getting their default values...
&gt; 
&gt; I would guess that some change in blead is causing the scope hook to not
&gt; fire in the same manor it used to / not fire at all, which is the cause
&gt; of this fail.
</div>
That on_scope_end fires when %^H is freed.  The change that Andreas König cited &#40;v5.15.4-
401-gf45b078&#41; only makes the outer scope’s hint variables visible to a string eval’s run time 
&#40;making eval &#39;strict-&gt;import&#39; equivalent to eval { strict-&gt;import }, as it should be&#41;.  So there 
must be a string eval somewhere within the same compilation scope that is causing %^H to 
get an extra refcount.

I suppose I’d better keep digging.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1069180" href="/Public/Bug/Display.html?id=76437#txn-1069180">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;18&nbsp;16:30:06&nbsp;2012</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1069180/562260/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/562260">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Apr 18 16:22:03 2012, SPROUT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed Apr 18 13:21:16 2012, BOBTFISH wrote:
<div class="message-stanza open">&gt; &gt; On Wed Apr 18 11:30:46 2012, SPROUT wrote:
<div class="message-stanza open">&gt; &gt; &gt; I tried adding this to t/live_app.t and running it with 5.14.2 and
&gt; &gt; &gt; 5.15.9:
&gt; &gt; &gt;
&gt; &gt; &gt; BEGIN { *CORE::GLOBAL::bless = sub &#40;$;$&#41; { Carp&#39;cluck join &#34; &#34;,
</div></div>&gt; caller
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; if $_[1] eq &#39;AuthTestApp&#39;;
&gt; &gt; &gt; goto &#38;CORE::bless } }
&gt; &gt; &gt;
&gt; &gt; &gt; The resulting backtraces differ at this point:
&gt; &gt; &gt;
&gt; &gt; &gt; 5.14.2:
&gt; &gt; &gt;
&gt; &gt; &gt;   AuthTestApp::new&#40;&#39;AuthTestApp&#39;, &#39;HASH&#40;0xeea8c0&#41;&#39;&#41; called at
&gt; &gt; &gt; /Users/sprout/.cpan/build/Catalyst-Runtime-5.90011-
&gt; &gt; &gt; wEvMJu/blib/lib/Catalyst.pm line
&gt; &gt; &gt; 2024
&gt; &gt; &gt;   Catalyst::prepare&#40;&#39;AuthTestApp&#39;, &#39;env&#39;, &#39;HASH&#40;0xf0e3e0&#41;&#39;,
&gt; &gt; &gt; &#39;response_cb&#39;,
&gt; &gt; &gt; &#39;CODE&#40;0xf0eab0&#41;&#39;&#41; called at /Users/sprout/.cpan/build/Catalyst-
&gt; &gt; &gt; Runtime-5.90011-
&gt; &gt; &gt; wEvMJu/blib/lib/Catalyst.pm line 1986
&gt; &gt; &gt;
&gt; &gt; &gt; 5.15.9:
&gt; &gt; &gt;
&gt; &gt; &gt;   Class::Accessor::new&#40;&#39;AuthTestApp&#39;, &#39;HASH&#40;0xf51870&#41;&#39;&#41; called at
&gt; &gt; &gt; /Users/sprout/.cpan/build/Catalyst-Runtime-5.90011-
&gt; &gt; &gt; oJnh2Y/blib/lib/Catalyst.pm line
&gt; &gt; &gt; 2029
&gt; &gt; &gt;   Catalyst::prepare&#40;&#39;AuthTestApp&#39;, &#39;env&#39;, &#39;HASH&#40;0xf50fa0&#41;&#39;,
&gt; &gt; &gt; &#39;response_cb&#39;,
&gt; &gt; &gt; &#39;CODE&#40;0xf51420&#41;&#39;&#41; called at /Users/sprout/.cpan/build/Catalyst-
&gt; &gt; &gt; Runtime-5.90011-
&gt; &gt; &gt; oJnh2Y/blib/lib/Catalyst.pm line 1991
</div>&gt; &gt;
&gt; &gt; AHA!!!
&gt; &gt;
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/rafl/catalyst-">https://github.com/rafl/catalyst-</a></span>
</div>&gt; runtime/blob/master/lib/Catalyst.pm#L1187
<div class="message-stanza open">&gt; &gt;
&gt; &gt; This is the culprit, I would guess.
&gt; &gt;
&gt; &gt; What happens is that we explicitly make the application class
&gt; &gt; &#40;&#34;AuthTestApp&#34;&#41; immutable at the end of compliation - which inlines
</div>&gt; a
<div class="message-stanza open">&gt; &gt; Moose constructor directly into AuthTestApp.
&gt; &gt;
&gt; &gt; If we don&#39;t do this, then the -&gt;new method comes from
&gt; &gt; Class::Accessor::Fast, which results in none of the Moose attributes
&gt; &gt; getting their default values...
&gt; &gt;
&gt; &gt; I would guess that some change in blead is causing the scope hook to
</div>&gt; not
<div class="message-stanza open">&gt; &gt; fire in the same manor it used to / not fire at all, which is the
</div>&gt; cause
<div class="message-stanza open">&gt; &gt; of this fail.
</div>&gt; 
&gt; That on_scope_end fires when %^H is freed.  The change that Andreas
&gt; König cited &#40;v5.15.4-
&gt; 401-gf45b078&#41; only makes the outer scope’s hint variables visible to a
&gt; string eval’s run time
&gt; &#40;making eval &#39;strict-&gt;import&#39; equivalent to eval { strict-&gt;import },
&gt; as it should be&#41;.  So there
&gt; must be a string eval somewhere within the same compilation scope that
&gt; is causing %^H to
&gt; get an extra refcount.
&gt; 
&gt; I suppose I’d better keep digging.
</div>
With Catalyst::Plugin::Authentication version 0.10019 &#40;but not 0.10018&#41;, I get a pass.  But I 
would still like to get to the bottom of this.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1069190" href="/Public/Bug/Display.html?id=76437#txn-1069190">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;18&nbsp;17:16:55&nbsp;2012</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1069190/562268/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/562268">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Apr 18 16:30:06 2012, SPROUT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed Apr 18 16:22:03 2012, SPROUT wrote:
<div class="message-stanza open">&gt; &gt; On Wed Apr 18 13:21:16 2012, BOBTFISH wrote:
<div class="message-stanza open">&gt; &gt; &gt; AHA!!!
&gt; &gt; &gt;
&gt; &gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/rafl/catalyst-">https://github.com/rafl/catalyst-</a></span>
</div>&gt; &gt; runtime/blob/master/lib/Catalyst.pm#L1187
<div class="message-stanza open">&gt; &gt; &gt;
&gt; &gt; &gt; This is the culprit, I would guess.
&gt; &gt; &gt;
&gt; &gt; &gt; What happens is that we explicitly make the application class
&gt; &gt; &gt; &#40;&#34;AuthTestApp&#34;&#41; immutable at the end of compliation - which
</div></div>&gt; inlines
<div class="message-stanza open">&gt; &gt; a
<div class="message-stanza open">&gt; &gt; &gt; Moose constructor directly into AuthTestApp.
&gt; &gt; &gt;
&gt; &gt; &gt; If we don&#39;t do this, then the -&gt;new method comes from
&gt; &gt; &gt; Class::Accessor::Fast, which results in none of the Moose
</div></div>&gt; attributes
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; getting their default values...
&gt; &gt; &gt;
&gt; &gt; &gt; I would guess that some change in blead is causing the scope hook
</div></div>&gt; to
<div class="message-stanza open">&gt; &gt; not
<div class="message-stanza open">&gt; &gt; &gt; fire in the same manor it used to / not fire at all, which is the
</div>&gt; &gt; cause
<div class="message-stanza open">&gt; &gt; &gt; of this fail.
</div>&gt; &gt;
&gt; &gt; That on_scope_end fires when %^H is freed.  The change that Andreas
&gt; &gt; König cited &#40;v5.15.4-
&gt; &gt; 401-gf45b078&#41; only makes the outer scope’s hint variables visible to
</div>&gt; a
<div class="message-stanza open">&gt; &gt; string eval’s run time
&gt; &gt; &#40;making eval &#39;strict-&gt;import&#39; equivalent to eval { strict-&gt;import },
&gt; &gt; as it should be&#41;.  So there
&gt; &gt; must be a string eval somewhere within the same compilation scope
</div>&gt; that
<div class="message-stanza open">&gt; &gt; is causing %^H to
&gt; &gt; get an extra refcount.
&gt; &gt;
&gt; &gt; I suppose I’d better keep digging.
</div>&gt; 
&gt; With Catalyst::Plugin::Authentication version 0.10019 &#40;but not
&gt; 0.10018&#41;, I get a pass.  But I
&gt; would still like to get to the bottom of this.
</div>
AuthTestApp.pm is defined like this:

__BEGIN__
package AuthTestApp;
use Catalyst qw/
    Authentication
/;
our %users;
__PACKAGE__-&gt;config&#40;
    &#39;Plugin::Authentication&#39; =&gt; {
        default_realm =&gt; &#39;test&#39;,
        test =&gt; {
            store =&gt; {
                class =&gt; &#39;Minimal&#39;,
                users =&gt; \%users,
            },
            credential =&gt; {
                class =&gt; &#39;HTTP&#39;,
                type  =&gt; &#39;basic&#39;,
                password_type =&gt; &#39;clear&#39;,
                password_field =&gt; &#39;password&#39;
            },
        },
    },
&#41;;
%users = &#40;
    foo =&gt; { password         =&gt; &#34;s3cr3t&#34;, },
&#41;;
__PACKAGE__-&gt;setup;

1;
__END__

Catalyst sets up the code in question to run on_scope_end.  That means the end of the code 
that is currently compiling.

When this test app calls __PACKAGE__-&gt;setup, it has already finished compiling, so it is no 
longer the currently-compiling code.

live_app.t calls this &#40;indirectly&#41; from the main program, outside of any BEGIN block, like this:

my $mech = Test::WWW::Mechanize::Catalyst-&gt;new&#40;catalyst_app =&gt; &#39;AuthTestApp&#39;&#41;;

So, since no code is compiling, %^H is never freed.  The %^H that setup used to attach to, the 
one that existed for the sake of compiling AuthTestApp.pm, is now freed when 
AuthTestApp.pm finishing compiling, rather than when it finishes running.

Either it is a mistake for Catalyst to assume that code is still being compiled somewhere, 
somehow, when setup is called.  Or AuthTestApp should set things up inside a BEGIN block, 
so that setup is called while AuthTestApp.pm is still being compiled.

I’m not a Catalyst user, so I can’t tell you whether what it is doing is sensible, but it doesn’t 
*feel* right to me, because setup *must* be called when there is a BEGIN block somewhere on 
the call stack.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1069207" href="/Public/Bug/Display.html?id=76437#txn-1069207">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;18&nbsp;17:23:59&nbsp;2012</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1069207/562277/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/562277">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 319b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Apr 18 17:16:55 2012, SPROUT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I’m not a Catalyst user, so I can’t tell you whether what it is doing
&gt; is sensible, but it doesn’t
&gt; *feel* right to me, because setup *must* be called when there is a
&gt; BEGIN block somewhere on
&gt; the call stack.
</div>
I’ve reported this against Catalyst as bug #76675.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1069268" href="/Public/Bug/Display.html?id=76437#txn-1069268">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;18&nbsp;18:45:02&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1069268/562321/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/562321">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve just perlbrew&#39;d blead, and I can&#39;t reproduce this issue.

spaceinvaders Catalyst-Plugin-Authentication [master]$
~/perl5/perlbrew/perls/perl-blead/bin/prove -Ilib t/*.t
t/04_authentication.t ............ ok   
t/05_password.t .................. ok     
t/06_user.t ...................... ok   
t/live_app.t ..................... ok    
t/live_app_realms.t .............. ok    
t/live_app_realms_compat.t ....... ok   
t/live_app_realms_progressive.t .. ok   
t/live_app_remote1.t ............. ok    
t/live_app_remote2.t ............. ok   
t/live_app_session.t ............. 1/? [error] Store claimed to have a
restorable user, but restoration failed.  Did you change the user&#39;s
id_field?
t/live_app_session.t ............. ok    
All tests successful.
Files=10, Tests=115,  8 wallclock secs &#40; 0.08 usr  0.02 sys +  7.75 cusr
 0.46 csys =  8.31 CPU&#41;
Result: PASS
spaceinvaders Catalyst-Plugin-Authentication [master]$ 
~/perl5/perlbrew/perls/perl-blead/bin/prove -V
TAP::Harness v3.23 and Perl v5.15.9
spaceinvaders Catalyst-Plugin-Authentication [master]$ uname -a
Darwin spaceinvaders.config 11.3.0 Darwin Kernel Version 11.3.0: Thu Jan
12 18:47:41 PST 2012; root:xnu-1699.24.23~1/RELEASE_X86_64 x86_64 i386
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1069271" href="/Public/Bug/Display.html?id=76437#txn-1069271">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;18&nbsp;18:52:38&nbsp;2012</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1069271/562324/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/562324">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Apr 18 18:45:02 2012, BOBTFISH wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ve just perlbrew&#39;d blead, and I can&#39;t reproduce this issue.
&gt; 
&gt; spaceinvaders Catalyst-Plugin-Authentication [master]$
&gt; ~/perl5/perlbrew/perls/perl-blead/bin/prove -Ilib t/*.t
&gt; t/04_authentication.t ............ ok   
&gt; t/05_password.t .................. ok     
&gt; t/06_user.t ...................... ok   
&gt; t/live_app.t ..................... ok    
&gt; t/live_app_realms.t .............. ok    
&gt; t/live_app_realms_compat.t ....... ok   
&gt; t/live_app_realms_progressive.t .. ok   
&gt; t/live_app_remote1.t ............. ok    
&gt; t/live_app_remote2.t ............. ok   
&gt; t/live_app_session.t ............. 1/? [error] Store claimed to have a
&gt; restorable user, but restoration failed.  Did you change the user&#39;s
&gt; id_field?
&gt; t/live_app_session.t ............. ok    
&gt; All tests successful.
&gt; Files=10, Tests=115,  8 wallclock secs &#40; 0.08 usr  0.02 sys +  7.75 cusr
&gt;  0.46 csys =  8.31 CPU&#41;
&gt; Result: PASS
&gt; spaceinvaders Catalyst-Plugin-Authentication [master]$ 
&gt; ~/perl5/perlbrew/perls/perl-blead/bin/prove -V
&gt; TAP::Harness v3.23 and Perl v5.15.9
&gt; spaceinvaders Catalyst-Plugin-Authentication [master]$ uname -a
&gt; Darwin spaceinvaders.config 11.3.0 Darwin Kernel Version 11.3.0: Thu Jan
&gt; 12 18:47:41 PST 2012; root:xnu-1699.24.23~1/RELEASE_X86_64 x86_64 i386
&gt; 
</div>
As I mentioned earlier:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; With Catalyst::Plugin::Authentication version 0.10019 &#40;but not 0.10018&#41;, I get a pass.
</div>
So changes in 0.10019 render that on_scope_end unnecessary.  &#40;It’s still not firing in blead.&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1069274" href="/Public/Bug/Display.html?id=76437#txn-1069274">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;18&nbsp;18:53:30&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1069274/562327/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/562327">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1020b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Apr 18 17:16:55 2012, SPROUT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Catalyst sets up the code in question to run on_scope_end.  That means
&gt; the end of the code
&gt; that is currently compiling.
</div>
Not true.

You can &#40;ab&#41;use this at runtime to mean on block end.

&lt;snip entirely reasonable explanation&gt;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Either it is a mistake for Catalyst to assume that code is still being
&gt; compiled somewhere,
&gt; somehow, when setup is called.  Or AuthTestApp should set things up
&gt; inside a BEGIN block,
&gt; so that setup is called while AuthTestApp.pm is still being compiled.
</div>
No, I&#39;m afraid it&#39;s entirely deliberate misuse of a &#39;feature&#39;. This
misuse is now &#40;entirely fairly!&#41; broken with blead.

The plan would be to conditionally replace this insanity with
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/rafl/hook-endofruntime">https://github.com/rafl/hook-endofruntime</a></span>

given an appropriately modern perl version to support that.

However, I currently can&#39;t go anywhere - until I can reproduce - I&#39;ll
retry in linux tomorrow &#40;but if someone could confirm this still fails
for them in blead as of now, that&#39;d be nice&#41;.

Thanks!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1069304" href="/Public/Bug/Display.html?id=76437#txn-1069304">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;18&nbsp;21:19:37&nbsp;2012</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1069304/562349/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/562349">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Apr 18 18:53:30 2012, BOBTFISH wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed Apr 18 17:16:55 2012, SPROUT wrote:
<div class="message-stanza open">&gt; &gt; Catalyst sets up the code in question to run on_scope_end.  That means
&gt; &gt; the end of the code
&gt; &gt; that is currently compiling.
</div>&gt; 
&gt; Not true.
&gt; 
&gt; You can &#40;ab&#41;use this at runtime to mean on block end.
</div>
Um, I’ve read the source for B::Hooks::EndOfScope and the corresponding perl source.  I know 
what I’m talking about. :-&#41;

In 5.16 on_scope_end ends up meaning end of the compile time of the block containing the 
currently-running BEGIN block.

In earlier versions it means the same or the end of the current string eval’s run time, 
depending on whether BEGIN or eval &#34;&#34; is closer to the top of the call stack.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; &lt;snip entirely reasonable explanation&gt;
&gt; 
<div class="message-stanza open">&gt; &gt; Either it is a mistake for Catalyst to assume that code is still being
&gt; &gt; compiled somewhere,
&gt; &gt; somehow, when setup is called.  Or AuthTestApp should set things up
&gt; &gt; inside a BEGIN block,
&gt; &gt; so that setup is called while AuthTestApp.pm is still being compiled.
</div>&gt; 
&gt; No, I&#39;m afraid it&#39;s entirely deliberate misuse of a &#39;feature&#39;. This
&gt; misuse is now &#40;entirely fairly!&#41; broken with blead.
&gt; 
&gt; The plan would be to conditionally replace this insanity with
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/rafl/hook-endofruntime">https://github.com/rafl/hook-endofruntime</a></span>
</div>
Scope::Upper can already do that, if I understand both modules correctly &#40;I just glanced at 
hook-endofruntime quickly&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; given an appropriately modern perl version to support that.
&gt; 
&gt; However, I currently can&#39;t go anywhere - until I can reproduce - I&#39;ll
&gt; retry in linux tomorrow &#40;but if someone could confirm this still fails
&gt; for them in blead as of now, that&#39;d be nice&#41;.
</div>
Use Catalyst::Plugin::Authentication version 0.10018.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1069399" href="/Public/Bug/Display.html?id=76437#txn-1069399">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;19&nbsp;03:14:02&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #76437] Test failures with bleadperl &#40;Can&#39;t use an undefined value as an ARRAY reference&#41; </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 19 Apr 2012 08:13:39 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Catalyst-Authentication-Credential-HTTP [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Tomas Doran &lt;bobtfish [...] bobtfish.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1069399/562411/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/562411">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 5.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On 18 Apr 2012, at 23:52, Father Chrysostomos via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;       Queue: Catalyst-Authentication-Credential-HTTP
&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=76437">https://rt.cpan.org/Ticket/Display.html?id=76437</a></span> &gt;
&gt; 
&gt; On Wed Apr 18 18:45:02 2012, BOBTFISH wrote:
<div class="message-stanza open">&gt;&gt; I&#39;ve just perlbrew&#39;d blead, and I can&#39;t reproduce this issue.
&gt;&gt; 
</div></div>
&lt;snip&gt;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; As I mentioned earlier:
&gt; 
<div class="message-stanza open">&gt;&gt; With Catalyst::Plugin::Authentication version 0.10019 &#40;but not 0.10018&#41;, I get a pass.
</div>&gt; 
</div>
Ah, sorry - I&#39;m being unclear.

I already tested both versions &#40;as I suspected the newest version would probably fix the issue&#41;, and I can&#39;t reproduce even with the older version either.. :&#40;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So changes in 0.10019 render that on_scope_end unnecessary.  &#40;It’s still not firing in bleed.&#41;
</div>
Maybe in this plugin - but a whole chunk of other plugins are like this - it&#39;s a general problem.

The on_scope_end thing only exists as fixing everything &#40;including darkpan&#41; was impossible..

Either way - I think I have a fix in Catalyst that removes this horrible hack - thanks for the detailed bug report which led me straight to it!

For the record, my failing to reproduce with v0.10018:

spaceinvaders Catalyst-Plugin-Authentication [&#40;no branch&#41;*]$ git checkout v0.10018
Previous HEAD position was ecb1afb... Version 0.10017
HEAD is now at afa31b0... Checking in changes prior to tagging of version 0.10018.
spaceinvaders Catalyst-Plugin-Authentication [&#40;no branch&#41;*]$  /Users/t0m/perl5/perlbrew/perls/perl-blead/bin/perl Makefile.PL 
*** Module::AutoInstall version 1.05
*** Checking for Perl dependencies...
[Core Features]
- Test::More                ...loaded. &#40;0.98 &gt;= 0.88&#41;
- Test::Exception           ...loaded. &#40;0.31&#41;
- Class::MOP                ...loaded. &#40;2.0403&#41;
- Moose                     ...loaded. &#40;2.0403&#41;
- Catalyst::Runtime         ...loaded. &#40;5.90011&#41;
- Class::Inspector          ...loaded. &#40;1.27&#41;
- MRO::Compat               ...loaded. &#40;0.11&#41;
- Catalyst::Plugin::Session ...loaded. &#40;0.34 &gt;= 0.10&#41;
*** Module::AutoInstall configuration finished.
Writing Makefile for Catalyst::Plugin::Authentication
Writing MYMETA.yml and MYMETA.json
spaceinvaders Catalyst-Plugin-Authentication [&#40;no branch&#41;*]$ makecp lib/Catalyst/Authentication/Realm/Progressive.pm blib/lib/Catalyst/Authentication/Realm/Progressive.pm
cp lib/Catalyst/Authentication/User.pm blib/lib/Catalyst/Authentication/User.pm
cp lib/Catalyst/Authentication/Store/Minimal.pm blib/lib/Catalyst/Authentication/Store/Minimal.pm
cp lib/Catalyst/Plugin/Authentication/Store/Minimal.pm blib/lib/Catalyst/Plugin/Authentication/Store/Minimal.pm
cp lib/Catalyst/Authentication/Store/Null.pm blib/lib/Catalyst/Authentication/Store/Null.pm
cp lib/Catalyst/Authentication/Credential/Password.pm blib/lib/Catalyst/Authentication/Credential/Password.pm
cp lib/Catalyst/Authentication/Realm/Compatibility.pm blib/lib/Catalyst/Authentication/Realm/Compatibility.pm
cp lib/Catalyst/Plugin/Authentication.pm blib/lib/Catalyst/Plugin/Authentication.pm
cp lib/Catalyst/Authentication/User/Hash.pm blib/lib/Catalyst/Authentication/User/Hash.pm
cp lib/Catalyst/Authentication/Realm.pm blib/lib/Catalyst/Authentication/Realm.pm
cp lib/Catalyst/Authentication/Credential/Remote.pm blib/lib/Catalyst/Authentication/Credential/Remote.pm
cp lib/Catalyst/Plugin/Authentication/Internals.pod blib/lib/Catalyst/Plugin/Authentication/Internals.pod
cp lib/Catalyst/Plugin/Authentication/Credential/Password.pm blib/lib/Catalyst/Plugin/Authentication/Credential/Password.pm
cp lib/Catalyst/Plugin/Authentication/User/Hash.pm blib/lib/Catalyst/Plugin/Authentication/User/Hash.pm
cp lib/Catalyst/Plugin/Authentication/User.pm blib/lib/Catalyst/Plugin/Authentication/User.pm
cp lib/Catalyst/Authentication/Store.pod blib/lib/Catalyst/Authentication/Store.pod
Manifying blib/man3/Catalyst::Authentication::Realm::Progressive.3
Manifying blib/man3/Catalyst::Authentication::Store::Minimal.3
Manifying blib/man3/Catalyst::Authentication::User.3
Manifying blib/man3/Catalyst::Plugin::Authentication::Store::Minimal.3
Manifying blib/man3/Catalyst::Authentication::Store::Null.3
Manifying blib/man3/Catalyst::Authentication::Credential::Password.3
Manifying blib/man3/Catalyst::Plugin::Authentication.3
Manifying blib/man3/Catalyst::Authentication::Realm::Compatibility.3
Manifying blib/man3/Catalyst::Authentication::User::Hash.3
Manifying blib/man3/Catalyst::Authentication::Realm.3
Manifying blib/man3/Catalyst::Authentication::Credential::Remote.3
Manifying blib/man3/Catalyst::Plugin::Authentication::Credential::Password.3
Manifying blib/man3/Catalyst::Plugin::Authentication::Internals.3
Manifying blib/man3/Catalyst::Plugin::Authentication::User::Hash.3
Manifying blib/man3/Catalyst::Plugin::Authentication::User.3
Manifying blib/man3/Catalyst::Authentication::Store.3
spaceinvaders Catalyst-Plugin-Authentication [&#40;no branch&#41;*]$ make test
PERL_DL_NONLAZY=1 /Users/t0m/perl5/perlbrew/perls/perl-blead/bin/perl5.15.9 &#34;-MExtUtils::Command::MM&#34; &#34;-e&#34; &#34;test_harness&#40;0, &#39;inc&#39;, &#39;blib/lib&#39;, &#39;blib/arch&#39;&#41;&#34; t/04_authentication.t t/05_password.t t/06_user.t t/live_app.t t/live_app_realms.t t/live_app_realms_compat.t t/live_app_realms_progressive.t t/live_app_remote1.t t/live_app_remote2.t t/live_app_session.t
t/04_authentication.t ............ ok   
t/05_password.t .................. ok     
t/06_user.t ...................... ok   
t/live_app.t ..................... ok    
t/live_app_realms.t .............. ok    
t/live_app_realms_compat.t ....... ok   
t/live_app_realms_progressive.t .. ok   
t/live_app_remote1.t ............. ok    
t/live_app_remote2.t ............. ok   
t/live_app_session.t ............. 1/? [error] Store claimed to have a restorable user, but restoration failed.  Did you change the user&#39;s id_field?
t/live_app_session.t ............. ok    
All tests successful.
Files=10, Tests=115,  9 wallclock secs &#40; 0.08 usr  0.03 sys +  7.70 cusr  0.52 csys =  8.33 CPU&#41;
Result: PASS
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1069408" href="/Public/Bug/Display.html?id=76437#txn-1069408">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;19&nbsp;03:36:31&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #76437] Test failures with bleadperl &#40;Can&#39;t use an undefined value as an ARRAY reference&#41; </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 19 Apr 2012 08:36:10 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Catalyst-Authentication-Credential-HTTP [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Tomas Doran &lt;bobtfish [...] bobtfish.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1069408/562414/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/562414">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On 19 Apr 2012, at 02:19, Father Chrysostomos via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed Apr 18 18:53:30 2012, BOBTFISH wrote:
<div class="message-stanza open">&gt;&gt; On Wed Apr 18 17:16:55 2012, SPROUT wrote:
<div class="message-stanza open">&gt;&gt;&gt; Catalyst sets up the code in question to run on_scope_end.  That means
&gt;&gt;&gt; the end of the code
&gt;&gt;&gt; that is currently compiling.
</div>&gt;&gt; 
&gt;&gt; Not true.
&gt;&gt; 
&gt;&gt; You can &#40;ab&#41;use this at runtime to mean on block end.
</div>&gt; 
&gt; Um, I’ve read the source for B::Hooks::EndOfScope and the corresponding perl source.  I know 
&gt; what I’m talking about. :-&#41;
</div>
Apologies for coming across as trying to correct you! That was not the intention - you&#39;ve assuredly got a much better understanding of how this actually works, or doesn&#39;t work then me - I&#39;m only noting the observed effects.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; In 5.16 on_scope_end ends up meaning end of the compile time of the block containing the 
&gt; currently-running BEGIN block.
&gt; 
&gt; In earlier versions it means the same or the end of the current string eval’s run time, 
&gt; depending on whether BEGIN or eval &#34;&#34; is closer to the top of the call stack.
</div>
Can I trouble you to explain how/why then the hook fires in earlier perls ? As the explanation above implies to me that this would never have worked.…

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Scope::Upper can already do that, if I understand both modules correctly &#40;I just glanced at 
&gt; hook-endofruntime quickly&#41;.
</div>
Catalyst previously used Scope::Upper for this &#40;at least briefly - I&#39;m not sure it ever made it to a production release&#41;.

However &#40;if I remember correctly - which I may not do&#41;, it was too sensitive to block level changes &#40;i.e. if you wrote { __PACKAGE__-&gt;setup } in your app, it&#39;d fire at the end of the block, not end of file&#41;.

I would guess that you&#39;re right, and that Hook::EndOfRuntime is likely to cause the same issues.

I&#39;d like to be confident we know about exactly why the B::Hooks::EOS stops working in blead &#40;I believe rafl may have raised a perlbug for this, but I&#39;m unsure the # - I&#39;ve followed up with him, and I&#39;ll link it in when I know the # / if I&#39;m right&#41;.

I also have a branch in Catalyst which fixes this in a much less insane manor - by copying the Moose::Object::new method into each plugin as it&#39;s loaded - avoiding any possibility of the Class::Accessor&#40;::Fast&#41;? new method from being lowest in the inheritance hierarchy. This means that we no longer require any ::Hooks?:: module, so whilst a pretty gross hack - it&#39;s less completely insane and should be much more predictable in future.

This, however, implies a significant slowdown for Catalyst apps which don&#39;t manually make themselves immutable - so I&#39;m going to look into restoring the immutable behaviour at a later point &#40;when the app is told to run, rather than at end of compile time&#41; to correct this. In the worst case, even if this doesn&#39;t work out - I&#39;m pretty confident we&#39;ll be able to ship a fixed version which doesn&#39;t rely on the fragile behaviour in the next few days.

A million thank yous for the work you&#39;ve put into investigating this and helping explain it here. I don&#39;t have the appropriate words to describe how extremely helpful and highly appreciated this assistance is!

Cheers
Tomas
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Force odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1069415" href="/Public/Bug/Display.html?id=76437#txn-1069415">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;19&nbsp;04:08:24&nbsp;2012</span>
    <span class="description">The RT System itself -  Owner forcibly changed from NIGELM to Nobody</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1069416" href="/Public/Bug/Display.html?id=76437#txn-1069416">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;19&nbsp;04:08:25&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Queue changed from Catalyst-Authentication-Credential-HTTP to Catalyst-Runtime</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1069417" href="/Public/Bug/Display.html?id=76437#txn-1069417">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;19&nbsp;04:08:38&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Severity Critical added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1069418" href="/Public/Bug/Display.html?id=76437#txn-1069418">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;19&nbsp;04:08:38&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Broken in 5.90011 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1069419" href="/Public/Bug/Display.html?id=76437#txn-1069419">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;19&nbsp;04:09:33&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> sprout [...] cpan.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1069419/562420/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/562420">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 112b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve moved this to the Catalyst-Runtime queue, as this is a core
Catalyst issue, and I&#39;ve marked it as Critical.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1069423" href="/Public/Bug/Display.html?id=76437#txn-1069423">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;19&nbsp;04:10:19&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Cc NIGELM added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1069424" href="/Public/Bug/Display.html?id=76437#txn-1069424">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;19&nbsp;04:10:36&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Cc FLORA added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1069425" href="/Public/Bug/Display.html?id=76437#txn-1069425">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;19&nbsp;04:10:59&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Cc BOBTFISH added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1069426" href="/Public/Bug/Display.html?id=76437#txn-1069426">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;19&nbsp;04:16:00&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1069426/562424/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/562424">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 407b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">There is a test t/plugin_new_method_backcompat.t which should test for
this issue in the current Catalyst::Runtime dist.

However I can&#39;t find any fail reports for this currently.

I guess this is because the &#40;simplified&#41; test case doesn&#39;t reproduce the
issue, but I can&#39;t attempt to verify as I&#39;ve not managed to reproduce
the failure in the authentication plugin yet &#40;I&#39;m clearly doing it wrong
somehow&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1069677" href="/Public/Bug/Display.html?id=76437#txn-1069677">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;19&nbsp;12:40:00&nbsp;2012</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1069677/562612/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/562612">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Apr 19 03:36:31 2012, BOBTFISH wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; On 19 Apr 2012, at 02:19, Father Chrysostomos via RT wrote:
<div class="message-stanza open">&gt; &gt; On Wed Apr 18 18:53:30 2012, BOBTFISH wrote:
<div class="message-stanza open">&gt; &gt;&gt; On Wed Apr 18 17:16:55 2012, SPROUT wrote:
<div class="message-stanza open">&gt; &gt;&gt;&gt; Catalyst sets up the code in question to run on_scope_end.  That
</div></div></div>&gt;    means
<div class="message-stanza open"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt;&gt; the end of the code
&gt; &gt;&gt;&gt; that is currently compiling.
</div>&gt; &gt;&gt;
&gt; &gt;&gt; Not true.
&gt; &gt;&gt;
&gt; &gt;&gt; You can &#40;ab&#41;use this at runtime to mean on block end.
</div>&gt; &gt;
&gt; &gt; Um, I’ve read the source for B::Hooks::EndOfScope and the
</div>&gt;    corresponding perl source.  I know
<div class="message-stanza open">&gt; &gt; what I’m talking about. :-&#41;
</div>&gt; 
&gt; Apologies for coming across as trying to correct you! That was not the
&gt;    intention - you&#39;ve assuredly got a much better understanding of how
&gt;    this actually works, or doesn&#39;t work then me - I&#39;m only noting the
&gt;    observed effects.
&gt; 
<div class="message-stanza open">&gt; &gt; In 5.16 on_scope_end ends up meaning end of the compile time of the
</div>&gt;    block containing the
<div class="message-stanza open">&gt; &gt; currently-running BEGIN block.
&gt; &gt;
&gt; &gt; In earlier versions it means the same or the end of the current
</div>&gt;    string eval’s run time,
<div class="message-stanza open">&gt; &gt; depending on whether BEGIN or eval &#34;&#34; is closer to the top of the
</div>&gt;    call stack.
&gt; 
&gt; Can I trouble you to explain how/why then the hook fires in earlier
&gt;    perls ? As the explanation above implies to me that this would
&gt;    never have worked.…
</div>
Don’t forget that a required file is a type of string eval.  So string eval scope ends up 
meaning file scope in that case.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Scope::Upper can already do that, if I understand both modules
</div>&gt;    correctly &#40;I just glanced at
<div class="message-stanza open">&gt; &gt; hook-endofruntime quickly&#41;.
</div>&gt; 
&gt; Catalyst previously used Scope::Upper for this &#40;at least briefly - I&#39;m
&gt;    not sure it ever made it to a production release&#41;.
&gt; 
&gt; However &#40;if I remember correctly - which I may not do&#41;, it was too
&gt;    sensitive to block level changes &#40;i.e. if you wrote { __PACKAGE__-
<div class="message-stanza open">&gt;    &gt;setup } in your app, it&#39;d fire at the end of the block, not end of
</div>&gt;    file&#41;.
&gt; 
&gt; I would guess that you&#39;re right, and that Hook::EndOfRuntime is likely
&gt;    to cause the same issues.
</div>
In either case, you can specify how many levels up to go.  &#40;caller $num&#41;[7] can be used to 
determine which frame is a require&#40;&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;d like to be confident we know about exactly why the B::Hooks::EOS
&gt;    stops working in blead &#40;I believe rafl may have raised a perlbug
&gt;    for this, but I&#39;m unsure the # - I&#39;ve followed up with him, and
&gt;    I&#39;ll link it in when I know the # / if I&#39;m right&#41;.
</div>
It still works, but, as I said, it works for compile-time scopes, rather than compile-time + 
string-eval-run-time scopes.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I also have a branch in Catalyst which fixes this in a much less
&gt;    insane manor - by copying the Moose::Object::new method into each
&gt;    plugin as it&#39;s loaded - avoiding any possibility of the
&gt;    Class::Accessor&#40;::Fast&#41;? new method from being lowest in the
&gt;    inheritance hierarchy. This means that we no longer require any
&gt;    ::Hooks?:: module, so whilst a pretty gross hack - it&#39;s less
&gt;    completely insane and should be much more predictable in future.
&gt; 
&gt; This, however, implies a significant slowdown for Catalyst apps which
&gt;    don&#39;t manually make themselves immutable - so I&#39;m going to look
&gt;    into restoring the immutable behaviour at a later point &#40;when the
&gt;    app is told to run, rather than at end of compile time&#41; to correct
&gt;    this. In the worst case, even if this doesn&#39;t work out - I&#39;m pretty
&gt;    confident we&#39;ll be able to ship a fixed version which doesn&#39;t rely
&gt;    on the fragile behaviour in the next few days.
</div>
I don’t know enough about Moose or Catalyst to understand exactly what the fix-up is for 
here.  So I cannot comment on that.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1069688" href="/Public/Bug/Display.html?id=76437#txn-1069688">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;19&nbsp;13:04:01&nbsp;2012</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1069688/562621/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/562621">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Apr 19 04:16:00 2012, BOBTFISH wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; There is a test t/plugin_new_method_backcompat.t which should test for
&gt; this issue in the current Catalyst::Runtime dist.
&gt; 
&gt; However I can&#39;t find any fail reports for this currently.
</div>
With the attached patch applied &#40;which eliminates the implicit BEGIN block that was making 
things work&#41;, I get this:

$ perl5.15.9 -Mblib t/plugin_new_method_backcompat.t 
1..8
ok 1 - Can apply method modifier
ok 2 - I am not immutable yet
not ok 3 - Am immutable after use
#   Failed test &#39;Am immutable after use&#39;
#   at t/plugin_new_method_backcompat.t line 19.
[error] Caught exception in engine &#34;Can&#39;t use an undefined value as an ARRAY reference at 
/Users/sprout/.cpan/build/Catalyst-Runtime-5.90011-oJnh2Y/blib/lib/Catalyst.pm line 
1686.&#34;
Can&#39;t call method &#34;request&#34; on an undefined value at /Users/sprout/.cpan/build/Plack-
0.9986-78hPcj/blib/lib/Plack/Test/MockHTTP.pm line 29.
# Looks like you planned 8 tests but ran 3.
# Looks like you failed 1 test of 3 run.
# Looks like your test exited with 255 just after 3.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I guess this is because the &#40;simplified&#41; test case doesn&#39;t reproduce the
&gt; issue, but I can&#39;t attempt to verify as I&#39;ve not managed to reproduce
&gt; the failure in the authentication plugin yet &#40;I&#39;m clearly doing it wrong
&gt; somehow&#41;.
</div>
There are so many dependencies that I’ve given up trying to figure it out.  At least we know 
the root cause now!
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> open_b9jAUjzS.txt</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1069688/562622/open_b9jAUjzS.txt">Download open_b9jAUjzS.txt</a><br />
<span class="downloadcontenttype">text/plain 687b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -rup Catalyst-Runtime-5.90011-oJnh2Y-orig/t/plugin_new_method_backcompat.t Catalyst-Runtime-5.90011-oJnh2Y/t/plugin_new_method_backcompat.t
--- Catalyst-Runtime-5.90011-oJnh2Y-orig/t/plugin_new_method_backcompat.t	2012-04-19 10:00:37.000000000 -0700
+++ Catalyst-Runtime-5.90011-oJnh2Y/t/plugin_new_method_backcompat.t	2012-04-19 10:00:44.000000000 -0700
@@ -14,7 +14,8 @@ use Moose::Util qw/find_meta/;
 use FindBin;
 use lib &#34;$FindBin::Bin/lib&#34;;
 
-use Catalyst::Test qw/TestAppPluginWithConstructor/;
+require Catalyst::Test;
+Catalyst::Test-&gt;import&#40;qw/TestAppPluginWithConstructor/&#41;;
 ok find_meta&#40;&#39;TestAppPluginWithConstructor&#39;&#41;-&gt;is_immutable,
     &#39;Am immutable after use&#39;;
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1069719" href="/Public/Bug/Display.html?id=76437#txn-1069719">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;19&nbsp;13:27:15&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #76437] Test failures with bleadperl &#40;Can&#39;t use an undefined value as an ARRAY reference&#41; </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 19 Apr 2012 18:26:53 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Catalyst-Runtime [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Tomas Doran &lt;bobtfish [...] bobtfish.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1069719/562645/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/562645">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On 19 Apr 2012, at 17:40, Father Chrysostomos via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; Can I trouble you to explain how/why then the hook fires in earlier
&gt;&gt;   perls ? As the explanation above implies to me that this would
&gt;&gt;   never have worked.…
</div>&gt; 
&gt; Don’t forget that a required file is a type of string eval.  So string eval scope ends up 
&gt; meaning file scope in that case.
</div>
Aha, illuminating! Thank you, I now understand :&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; I&#39;d like to be confident we know about exactly why the B::Hooks::EOS
&gt;&gt;   stops working in blead &#40;I believe rafl may have raised a perlbug
&gt;&gt;   for this, but I&#39;m unsure the # - I&#39;ve followed up with him, and
&gt;&gt;   I&#39;ll link it in when I know the # / if I&#39;m right&#41;.
</div>&gt; 
&gt; It still works, but, as I said, it works for compile-time scopes, rather than compile-time + 
&gt; string-eval-run-time scopes.
</div>
Yep, got it now, thanks.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I don’t know enough about Moose or Catalyst to understand exactly what the fix-up is for 
&gt; here.  So I cannot comment on that.
</div>
No worries - I&#39;ve got plenty of people who know Moose/Catalyst to review, and I&#39;m confident that this is a better &#40;or at least less fragile&#41; fix.

Thanks for the help!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1074659" href="/Public/Bug/Display.html?id=76437#txn-1074659">#</a>      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;05&nbsp;09:06:28&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1074659/565399/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/565399">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 166b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have applied a fix for this to git master &#40;38e43e6&#41;, which should
become part of the next maintenance release once it&#39;s been reviewed
&#40;hopefully later this weekend&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1074754" href="/Public/Bug/Display.html?id=76437#txn-1074754">#</a>      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;05&nbsp;14:30:36&nbsp;2012</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1074754/565454/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/565454">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 317b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat May 05 09:06:28 2012, BOBTFISH wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I have applied a fix for this to git master &#40;38e43e6&#41;, which should
&gt; become part of the next maintenance release once it&#39;s been reviewed
&gt; &#40;hopefully later this weekend&#41;
</div>
I don’t see that anywhere in github.com/rafl/catalyst-runtime.  Am I looking in the wrong place?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1074757" href="/Public/Bug/Display.html?id=76437#txn-1074757">#</a>      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;05&nbsp;14:33:55&nbsp;2012</span>
    <span class="description">KnowZeroX [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> KnowZeroX [...] yahoo.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1074757/565457/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/565457">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 464b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat May 05 14:30:36 2012, SPROUT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sat May 05 09:06:28 2012, BOBTFISH wrote:
<div class="message-stanza open">&gt; &gt; I have applied a fix for this to git master &#40;38e43e6&#41;, which should
&gt; &gt; become part of the next maintenance release once it&#39;s been reviewed
&gt; &gt; &#40;hopefully later this weekend&#41;
</div>&gt; 
&gt; I don’t see that anywhere in github.com/rafl/catalyst-runtime.  Am I
&gt; looking in the wrong place?
</div>

<span class="clickylink"><a target="new" rel="nofollow" href="http://git.shadowcat.co.uk/gitweb/gitweb.cgi?p=catagits/Catalyst-">http://git.shadowcat.co.uk/gitweb/gitweb.cgi?p=catagits/Catalyst-</a></span>
Runtime.git;a=summary
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1074767" href="/Public/Bug/Display.html?id=76437#txn-1074767">#</a>      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;05&nbsp;14:42:51&nbsp;2012</span>
    <span class="description">bobtfish [...] bobtfish.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1074767/565463/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/565463">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 729b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat May 05 14:30:36 2012, SPROUT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sat May 05 09:06:28 2012, BOBTFISH wrote:
<div class="message-stanza open">&gt; &gt; I have applied a fix for this to git master &#40;38e43e6&#41;, which should
&gt; &gt; become part of the next maintenance release once it&#39;s been reviewed
&gt; &gt; &#40;hopefully later this weekend&#41;
</div>&gt; 
&gt; I don’t see that anywhere in github.com/rafl/catalyst-runtime.  Am I
&gt; looking in the wrong place?
</div>
&lt;sigh&gt;

The github mirroring for our org account broke with &#39;verify your ssh
keys&#39; thing after the security breach, and github support has been
useless at helping us verify that they are correct.

Sorry about this - it&#39;s an ongoing issue which we&#39;re aware of &#40;and
trying to deal with&#41; - the canonical repos is in another comment &#40;and
the dist META.yml&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1478573" href="/Public/Bug/Display.html?id=76437#txn-1478573">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;25&nbsp;15:12:39&nbsp;2015</span>
    <span class="description">jjnapiork [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1478573/787599/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/787599">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 867b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">This looks fixed to me for a long time, closing -jnap

On Sat May 05 14:42:51 2012, BOBTFISH wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sat May 05 14:30:36 2012, SPROUT wrote:
<div class="message-stanza open">&gt; &gt; On Sat May 05 09:06:28 2012, BOBTFISH wrote:
<div class="message-stanza open">&gt; &gt; &gt; I have applied a fix for this to git master &#40;38e43e6&#41;, which should
&gt; &gt; &gt; become part of the next maintenance release once it&#39;s been reviewed
&gt; &gt; &gt; &#40;hopefully later this weekend&#41;
</div>&gt; &gt; 
&gt; &gt; I don’t see that anywhere in github.com/rafl/catalyst-runtime.  Am I
&gt; &gt; looking in the wrong place?
</div>&gt; 
&gt; &lt;sigh&gt;
&gt; 
&gt; The github mirroring for our org account broke with &#39;verify your ssh
&gt; keys&#39; thing after the security breach, and github support has been
&gt; useless at helping us verify that they are correct.
&gt; 
&gt; Sorry about this - it&#39;s an ongoing issue which we&#39;re aware of &#40;and
&gt; trying to deal with&#41; - the canonical repos is in another comment &#40;and
&gt; the dist META.yml&#41;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1478576" href="/Public/Bug/Display.html?id=76437#txn-1478576">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;25&nbsp;15:12:51&nbsp;2015</span>
    <span class="description">jjnapiork [...] cpan.org -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1478719" href="/Public/Bug/Display.html?id=76437#txn-1478719">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;26&nbsp;02:57:57&nbsp;2015</span>
    <span class="description">SREZIC [...] cpan.org -  Status changed from &#39;patched&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 1.407025</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
