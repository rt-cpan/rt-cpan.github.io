<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #127713 for TaskPipe: System perl used in tests</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #127713 for TaskPipe: System perl used in tests</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=TaskPipe">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=TaskPipe">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=TaskPipe">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=TaskPipe">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/TaskPipe">TaskPipe CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">127713</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=TaskPipe">TaskPipe</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
SREZIC [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-270770-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.06    </td>
  </tr>
  <tr id="CF-270771-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




Taskpipe-0.08.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1821152/979855/Taskpipe-0.08.patch">
Wed Nov 21 16:34:47 2018 (1k) by SREZIC [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=127713">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1820322" href="/Public/Bug/Display.html?id=127713#txn-1820322">#</a>      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;18&nbsp;05:11:43&nbsp;2018</span>
    <span class="description">SREZIC [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> System perl used in tests</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1820322/979421/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/979421">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">It seems that the system perl &#40;the first perl in $PATH&#41; and not the perl currently used for building and testing the distribution is used in the test suite, causing some test scripts to fail:

...
Running resume mechanism tests. Please be patient - this will take some time
Can&#39;t locate Moose.pm in @INC &#40;you may need to install the Moose module&#41; &#40;@INC contains: ... /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.26.1 /usr/local/share/perl/5.26.1 /usr/lib/x86_64-linux-gnu/perl5/5.26 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.26 /usr/share/perl/5.26 /usr/local/lib/site_perl /usr/lib/x86_64-linux-gnu/perl-base .&#41; at /home/cpansand/.local/share/.cpan/build/2018111802/MooseX-ConfigCascade-0.02-0/blib/lib/MooseX/ConfigCascade/Util.pm line 3.
BEGIN failed--compilation aborted at /home/cpansand/.local/share/.cpan/build/2018111802/MooseX-ConfigCascade-0.02-0/blib/lib/MooseX/ConfigCascade/Util.pm line 3.
Compilation failed in require at scripts/taskpipe-xtask line 4.
BEGIN failed--compilation aborted at scripts/taskpipe-xtask line 4.

#   Failed test &#39;mode: id count: 1 preops: 0 specs: {&#34;city&#34;:2,&#34;company&#34;:2,&#34;employee&#34;:0,&#34;threads&#34;:1} Number of records on city table&#39;
#   at t/lib/TaskPipe/TestUtils/Resume.pm line 95.
#          got: &#39;0&#39;
#     expected: &#39;2&#39;
...
# Looks like you failed 108 tests of 126.
t/03_single_thread_resume.t .. 
Dubious, test returned 108 &#40;wstat 27648, 0x6c00&#41;
Failed 108/126 subtests 
...
# Looks like your test exited with 2 just after 2.
t/04_plan.t .................. 
Dubious, test returned 2 &#40;wstat 512, 0x200&#41;
Failed 73/73 subtests 


Probably somewhere $^X has to be used, or alternatively scripts already installed in blib/script called.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1820979" href="/Public/Bug/Display.html?id=127713#txn-1820979">#</a>      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;20&nbsp;16:59:43&nbsp;2018</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1820979/979770/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/979770">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2018-11-18 05:11:43, SREZIC wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It seems that the system perl &#40;the first perl in $PATH&#41; and not the
&gt; perl currently used for building and testing the distribution is used
&gt; in the test suite, causing some test scripts to fail:
&gt; 
&gt; ...
&gt; Running resume mechanism tests. Please be patient - this will take
&gt; some time
&gt; Can&#39;t locate Moose.pm in @INC &#40;you may need to install the Moose
&gt; module&#41; &#40;@INC contains: ... /etc/perl /usr/local/lib/x86_64-linux-
&gt; gnu/perl/5.26.1 /usr/local/share/perl/5.26.1 /usr/lib/x86_64-linux-
&gt; gnu/perl5/5.26 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.26
&gt; /usr/share/perl/5.26 /usr/local/lib/site_perl /usr/lib/x86_64-linux-
&gt; gnu/perl-base .&#41; at
&gt; /home/cpansand/.local/share/.cpan/build/2018111802/MooseX-
&gt; ConfigCascade-0.02-0/blib/lib/MooseX/ConfigCascade/Util.pm line 3.
&gt; BEGIN failed--compilation aborted at
&gt; /home/cpansand/.local/share/.cpan/build/2018111802/MooseX-
&gt; ConfigCascade-0.02-0/blib/lib/MooseX/ConfigCascade/Util.pm line 3.
&gt; Compilation failed in require at scripts/taskpipe-xtask line 4.
&gt; BEGIN failed--compilation aborted at scripts/taskpipe-xtask line 4.
&gt; 
&gt; #   Failed test &#39;mode: id count: 1 preops: 0 specs:
&gt; {&#34;city&#34;:2,&#34;company&#34;:2,&#34;employee&#34;:0,&#34;threads&#34;:1} Number of records on
&gt; city table&#39;
&gt; #   at t/lib/TaskPipe/TestUtils/Resume.pm line 95.
&gt; #          got: &#39;0&#39;
&gt; #     expected: &#39;2&#39;
&gt; ...
&gt; # Looks like you failed 108 tests of 126.
&gt;  t/03_single_thread_resume.t ..
&gt; Dubious, test returned 108 &#40;wstat 27648, 0x6c00&#41;
&gt;  Failed 108/126 subtests
&gt; ...
&gt; # Looks like your test exited with 2 just after 2.
&gt;  t/04_plan.t ..................
&gt; Dubious, test returned 2 &#40;wstat 512, 0x200&#41;
&gt;  Failed 73/73 subtests
&gt; 
&gt; 
&gt; Probably somewhere $^X has to be used, or alternatively scripts
&gt; already installed in blib/script called.
</div>
Same problem with 0.07, it seems.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1821116" href="/Public/Bug/Display.html?id=127713#txn-1821116">#</a>      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;21&nbsp;10:45:35&nbsp;2018</span>
    <span class="description">TOMGRACEY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1821116/979838/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/979838">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Nov 20 16:59:43 2018, SREZIC wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2018-11-18 05:11:43, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; It seems that the system perl &#40;the first perl in $PATH&#41; and not the
&gt; &gt; perl currently used for building and testing the distribution is used
&gt; &gt; in the test suite, causing some test scripts to fail:
&gt; &gt; 
&gt; &gt; ...
&gt; &gt; Running resume mechanism tests. Please be patient - this will take
&gt; &gt; some time
&gt; &gt; Can&#39;t locate Moose.pm in @INC &#40;you may need to install the Moose
&gt; &gt; module&#41; &#40;@INC contains: ... /etc/perl /usr/local/lib/x86_64-linux-
&gt; &gt; gnu/perl/5.26.1 /usr/local/share/perl/5.26.1 /usr/lib/x86_64-linux-
&gt; &gt; gnu/perl5/5.26 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.26
&gt; &gt; /usr/share/perl/5.26 /usr/local/lib/site_perl /usr/lib/x86_64-linux-
&gt; &gt; gnu/perl-base .&#41; at
&gt; &gt; /home/cpansand/.local/share/.cpan/build/2018111802/MooseX-
&gt; &gt; ConfigCascade-0.02-0/blib/lib/MooseX/ConfigCascade/Util.pm line 3.
&gt; &gt; BEGIN failed--compilation aborted at
&gt; &gt; /home/cpansand/.local/share/.cpan/build/2018111802/MooseX-
&gt; &gt; ConfigCascade-0.02-0/blib/lib/MooseX/ConfigCascade/Util.pm line 3.
&gt; &gt; Compilation failed in require at scripts/taskpipe-xtask line 4.
&gt; &gt; BEGIN failed--compilation aborted at scripts/taskpipe-xtask line 4.
&gt; &gt; 
&gt; &gt; #   Failed test &#39;mode: id count: 1 preops: 0 specs:
&gt; &gt; {&#34;city&#34;:2,&#34;company&#34;:2,&#34;employee&#34;:0,&#34;threads&#34;:1} Number of records on
&gt; &gt; city table&#39;
&gt; &gt; #   at t/lib/TaskPipe/TestUtils/Resume.pm line 95.
&gt; &gt; #          got: &#39;0&#39;
&gt; &gt; #     expected: &#39;2&#39;
&gt; &gt; ...
&gt; &gt; # Looks like you failed 108 tests of 126.
&gt; &gt;  t/03_single_thread_resume.t ..
&gt; &gt; Dubious, test returned 108 &#40;wstat 27648, 0x6c00&#41;
&gt; &gt;  Failed 108/126 subtests
&gt; &gt; ...
&gt; &gt; # Looks like your test exited with 2 just after 2.
&gt; &gt;  t/04_plan.t ..................
&gt; &gt; Dubious, test returned 2 &#40;wstat 512, 0x200&#41;
&gt; &gt;  Failed 73/73 subtests
&gt; &gt; 
&gt; &gt; 
&gt; &gt; Probably somewhere $^X has to be used, or alternatively scripts
&gt; &gt; already installed in blib/script called.
</div>&gt; 
&gt; Same problem with 0.07, it seems.
&gt; 
</div>
Hi Slaven

Many thanks for testing this - and sorry for the trouble with repeated errors. In fact I think the problems with 0.06 and 0.07 were not quite the same. I have been working on the core threading mechanism and I wanted to include some optional multithreaded tests, but I mistakenly include config files which meant those were being kicked off automatically rather than being skipped if they were not selected when Makefile.PL was run. Hoping this is now resolved in 0.08&#40;?&#41; I am also hoping the most difficult/ugly to write tests &#40;ie related to threading&#41; are now out of the way, and with future releases it should be easier to extend the test framework.
Really appreciate your help
cheers
Tom
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1821117" href="/Public/Bug/Display.html?id=127713#txn-1821117">#</a>      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;21&nbsp;10:45:36&nbsp;2018</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1821152" href="/Public/Bug/Display.html?id=127713#txn-1821152">#</a>      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;21&nbsp;16:34:47&nbsp;2018</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1821152/979854/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/979854">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2018-11-21 10:45:35, TOMGRACEY wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Tue Nov 20 16:59:43 2018, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; On 2018-11-18 05:11:43, SREZIC wrote:
<div class="message-stanza open">&gt; &gt; &gt; It seems that the system perl &#40;the first perl in $PATH&#41; and not the
&gt; &gt; &gt; perl currently used for building and testing the distribution is
&gt; &gt; &gt; used
&gt; &gt; &gt; in the test suite, causing some test scripts to fail:
&gt; &gt; &gt;
&gt; &gt; &gt; ...
&gt; &gt; &gt; Running resume mechanism tests. Please be patient - this will take
&gt; &gt; &gt; some time
&gt; &gt; &gt; Can&#39;t locate Moose.pm in @INC &#40;you may need to install the Moose
&gt; &gt; &gt; module&#41; &#40;@INC contains: ... /etc/perl /usr/local/lib/x86_64-linux-
&gt; &gt; &gt; gnu/perl/5.26.1 /usr/local/share/perl/5.26.1 /usr/lib/x86_64-linux-
&gt; &gt; &gt; gnu/perl5/5.26 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.26
&gt; &gt; &gt; /usr/share/perl/5.26 /usr/local/lib/site_perl /usr/lib/x86_64-
&gt; &gt; &gt; linux-
&gt; &gt; &gt; gnu/perl-base .&#41; at
&gt; &gt; &gt; /home/cpansand/.local/share/.cpan/build/2018111802/MooseX-
&gt; &gt; &gt; ConfigCascade-0.02-0/blib/lib/MooseX/ConfigCascade/Util.pm line 3.
&gt; &gt; &gt; BEGIN failed--compilation aborted at
&gt; &gt; &gt; /home/cpansand/.local/share/.cpan/build/2018111802/MooseX-
&gt; &gt; &gt; ConfigCascade-0.02-0/blib/lib/MooseX/ConfigCascade/Util.pm line 3.
&gt; &gt; &gt; Compilation failed in require at scripts/taskpipe-xtask line 4.
&gt; &gt; &gt; BEGIN failed--compilation aborted at scripts/taskpipe-xtask line 4.
&gt; &gt; &gt;
&gt; &gt; &gt; #   Failed test &#39;mode: id count: 1 preops: 0 specs:
&gt; &gt; &gt; {&#34;city&#34;:2,&#34;company&#34;:2,&#34;employee&#34;:0,&#34;threads&#34;:1} Number of records
&gt; &gt; &gt; on
&gt; &gt; &gt; city table&#39;
&gt; &gt; &gt; #   at t/lib/TaskPipe/TestUtils/Resume.pm line 95.
&gt; &gt; &gt; #          got: &#39;0&#39;
&gt; &gt; &gt; #     expected: &#39;2&#39;
&gt; &gt; &gt; ...
&gt; &gt; &gt; # Looks like you failed 108 tests of 126.
&gt; &gt; &gt;  t/03_single_thread_resume.t ..
&gt; &gt; &gt; Dubious, test returned 108 &#40;wstat 27648, 0x6c00&#41;
&gt; &gt; &gt;  Failed 108/126 subtests
&gt; &gt; &gt; ...
&gt; &gt; &gt; # Looks like your test exited with 2 just after 2.
&gt; &gt; &gt;  t/04_plan.t ..................
&gt; &gt; &gt; Dubious, test returned 2 &#40;wstat 512, 0x200&#41;
&gt; &gt; &gt;  Failed 73/73 subtests
&gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt; &gt; Probably somewhere $^X has to be used, or alternatively scripts
&gt; &gt; &gt; already installed in blib/script called.
</div>&gt; &gt;
&gt; &gt; Same problem with 0.07, it seems.
&gt; &gt;
</div>&gt; 
&gt; Hi Slaven
&gt; 
&gt; Many thanks for testing this - and sorry for the trouble with repeated
&gt; errors. In fact I think the problems with 0.06 and 0.07 were not quite
&gt; the same. I have been working on the core threading mechanism and I
&gt; wanted to include some optional multithreaded tests, but I mistakenly
&gt; include config files which meant those were being kicked off
&gt; automatically rather than being skipped if they were not selected when
&gt; Makefile.PL was run. Hoping this is now resolved in 0.08&#40;?&#41; I am also
&gt; hoping the most difficult/ugly to write tests &#40;ie related to
&gt; threading&#41; are now out of the way, and with future releases it should
&gt; be easier to extend the test framework.
&gt; Really appreciate your help
&gt; cheers
&gt; Tom
</div>
Still I see the same problem with 0.08. I think the problem is that the two scripts in the &#34;scripts&#34; subdirectory have &#34;/usr/bin/env perl&#34; as the shebang. In my installations the system perl is before any other perl in my $PATH &#40;and most perls are not in $PATH at all&#41;, so during tests the wrong perl will be used which does not have the required dependencies installed, hence the failures.

Attached is a patch which fixes the problem on my system &#40;tested with perl 5.28.0 on a debian/stretch system&#41;. However the patch needs more polishing &#40;e.g. maybe for Windows?&#41;. What it does is:

* Change the shebang of the two scripts to something which contains &#34;perl&#34; in the first component &#40;and not &#34;env&#34;&#41;. This way the currently used perl will be replaced into the shebang for the final installation. There&#39;s a long-standing issue to make this replacement even for /usr/bin/env &#40;see <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/Perl-Toolchain-Gang/ExtUtils-MakeMaker/issues/58">https://github.com/Perl-Toolchain-Gang/ExtUtils-MakeMaker/issues/58</a></span> &#41; but unfortunately it is not done yet.

* The test library calls the scripts now from &#34;blib/script&#34;, not from &#34;scripts&#34;. In &#34;blib/script&#34; the final version of the scripts with the corrected shebang is already available.

Regards,
    Slaven
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Taskpipe-0.08.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1821152/979855/Taskpipe-0.08.patch">Download Taskpipe-0.08.patch</a><br />
<span class="downloadcontenttype">text/x-diff 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git a/scripts/taskpipe b/scripts/taskpipe
index 00834ea..b6fda90 100755
--- a/scripts/taskpipe
+++ b/scripts/taskpipe
@@ -1,4 +1,4 @@
-#!/usr/bin/env perl
+#!/usr/bin/perl
 
 use strict;
 use warnings;
diff --git a/scripts/taskpipe-xtask b/scripts/taskpipe-xtask
index 4118012..0b6e065 100755
--- a/scripts/taskpipe-xtask
+++ b/scripts/taskpipe-xtask
@@ -1,4 +1,4 @@
-#!/usr/bin/env perl
+#!/usr/bin/perl
 use strict;
 use warnings;
 use MooseX::ConfigCascade::Util;
diff --git a/t/lib/TaskPipe/TestUtils/Basic.pm b/t/lib/TaskPipe/TestUtils/Basic.pm
index 259c947..f5d2dea 100644
--- a/t/lib/TaskPipe/TestUtils/Basic.pm
+++ b/t/lib/TaskPipe/TestUtils/Basic.pm
@@ -116,7 +116,7 @@ sub run_plan{
         MooseX::ConfigCascade::Util-&gt;conf-&gt;{&#39;TaskPipe::Task::Settings&#39;}{&#39;xbranch_key_mode&#39;} = $p{key_mode};
     }
     
-    MooseX::ConfigCascade::Util-&gt;conf-&gt;{&#39;TaskPipe::TaskUtils::Settings&#39;}{&#39;xtask_script&#39;} = &#39;scripts/taskpipe-xtask&#39;;
+    MooseX::ConfigCascade::Util-&gt;conf-&gt;{&#39;TaskPipe::TaskUtils::Settings&#39;}{&#39;xtask_script&#39;} = &#39;blib/script/taskpipe-xtask&#39;;
 
     $self-&gt;cmdh-&gt;handler-&gt;job_manager-&gt;init_job;
 
</div></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.400795</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
