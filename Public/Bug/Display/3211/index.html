<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #3211 for DB_File: core dump in db-hash.t  under OSF1</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #3211 for DB_File: core dump in db-hash.t  under OSF1</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=DB_File">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=DB_File">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=DB_File">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=DB_File">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DB_File">DB_File CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">3211</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=DB_File">DB_File</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">pmqs [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
softadm [...] wias-berlin.de

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-10842-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10843-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=3211">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-85548" href="/Public/Bug/Display.html?id=3211#txn-85548">#</a>      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;11&nbsp;10:04:57&nbsp;2003</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> core dump in db-hash.t  under OSF1</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/85548/10922/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/10922">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 670b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">hallo,

there ist a problem with all releases of DB_File i tried 
&#40;perl5.003 ... perl-5.6, and also DB_File-1.806&#41;
in connection with /usr/lib/libdb.so which is shipped with OSF1 V5.1
&#40;True64 Unix&#41;.

ok&#40;22, $X = tie&#40;%h,&#39;DB_File&#39;,$Dfile, O_RDWR, 0640&#41; &#41;; 

fails with core dump.

in version 1.75 the c-source looks like

line 1672 &#34;DB_File.xs&#34;
          CurrentDB = db ;
#line 1756 &#34;DB_File.c&#34;

        RETVAL = db_DELETE&#40;db, key, flags&#41;;
        XSprePUSH; PUSHi&#40;&#40;IV&#41;RETVAL&#41;;
    }
    XSRETURN&#40;1&#41;;
}

db_DELETE which expands to some_pointer-&gt;del crashes.

i think, this is a problem of the &#34;build in&#34; libdb. with the aktuell version 4.1 of  BerkeleyDB the problem disapears.

ingo bremer
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-85549" href="/Public/Bug/Display.html?id=3211#txn-85549">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;20&nbsp;07:53:21&nbsp;2003</span>
    <span class="description">pmqs [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-85550" href="/Public/Bug/Display.html?id=3211#txn-85550">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;20&nbsp;09:10:55&nbsp;2003</span>
    <span class="description">pmqs [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/85550/12922/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/12922">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[guest - Mon Aug 11 10:04:57 2003]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; hallo,
&gt; 
&gt; there ist a problem with all releases of DB_File i tried
&gt; &#40;perl5.003 ... perl-5.6, and also DB_File-1.806&#41;
&gt; in connection with /usr/lib/libdb.so which is shipped with OSF1 V5.1
&gt; &#40;True64 Unix&#41;.
&gt; 
&gt; ok&#40;22, $X = tie&#40;%h,&#39;DB_File&#39;,$Dfile, O_RDWR, 0640&#41; &#41;;
&gt; 
&gt; fails with core dump.
&gt; 
&gt; in version 1.75 the c-source looks like
&gt; 
&gt; line 1672 &#34;DB_File.xs&#34;
&gt;         CurrentDB = db ;
&gt; #line 1756 &#34;DB_File.c&#34;
&gt; 
&gt;       RETVAL = db_DELETE&#40;db, key, flags&#41;;
&gt;       XSprePUSH; PUSHi&#40;&#40;IV&#41;RETVAL&#41;;
&gt;     }
&gt;     XSRETURN&#40;1&#41;;
&gt; }
&gt; 
&gt; db_DELETE which expands to some_pointer-&gt;del crashes.
&gt; 
&gt; i think, this is a problem of the &#34;build in&#34; libdb. with the aktuell
&gt; version 4.1 of  BerkeleyDB the problem disapears.
&gt; 
&gt; ingo bremer
&gt; 
&gt; 
</div>
Hi Ingo,

only just spotted this error report, because the DB_File queue was 
accidentally not assigned to me. 

Good to hear you sorted the problem yourself, but I&#39;d like to add 
something in the DB_File README about this if I can.

If you have the time, and still have the old version of Berkeley DB 
available, can you send me a complete log of the complete build process 
and the make test step please?

Also, what is the aktuell version 4.1 of  BerkeleyDB?

cheers
Paul
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-85551" href="/Public/Bug/Display.html?id=3211#txn-85551">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;20&nbsp;09:39:25&nbsp;2003</span>
    <span class="description">pmqs [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-85554" href="/Public/Bug/Display.html?id=3211#txn-85554">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;20&nbsp;09:40:33&nbsp;2003</span>
    <span class="description">pmqs [...] cpan.org -   Data error added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-85555" href="/Public/Bug/Display.html?id=3211#txn-85555">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;06&nbsp;04:27:33&nbsp;2004</span>
    <span class="description">pmqs [...] cpan.org -  Severity Normal added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-85556" href="/Public/Bug/Display.html?id=3211#txn-85556">#</a>      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;17&nbsp;09:00:17&nbsp;2004</span>
    <span class="description">dbd.ingres [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> htoug [...] cpan.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/85556/24813/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/24813">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 5.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[PMQS - Mon Oct 20 09:10:55 2003]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; [guest - Mon Aug 11 10:04:57 2003]:
&gt; 
<div class="message-stanza open">&gt; &gt; hallo,
&gt; &gt;
&gt; &gt; there ist a problem with all releases of DB_File i tried
&gt; &gt; &#40;perl5.003 ... perl-5.6, and also DB_File-1.806&#41;
&gt; &gt; in connection with /usr/lib/libdb.so which is shipped with OSF1 V5.1
&gt; &gt; &#40;True64 Unix&#41;.
&gt; &gt;
&gt; &gt; ok&#40;22, $X = tie&#40;%h,&#39;DB_File&#39;,$Dfile, O_RDWR, 0640&#41; &#41;;
&gt; &gt;
&gt; &gt; fails with core dump.
&gt; &gt;
&gt; &gt; in version 1.75 the c-source looks like
&gt; &gt;
&gt; &gt; line 1672 &#34;DB_File.xs&#34;
&gt; &gt;       CurrentDB = db ;
&gt; &gt; #line 1756 &#34;DB_File.c&#34;
&gt; &gt;
&gt; &gt;     RETVAL = db_DELETE&#40;db, key, flags&#41;;
&gt; &gt;     XSprePUSH; PUSHi&#40;&#40;IV&#41;RETVAL&#41;;
&gt; &gt;     }
&gt; &gt;     XSRETURN&#40;1&#41;;
&gt; &gt; }
</div></div>
I have just &#39;banged head on&#39; into this problem. Digging a bit deeper
into the code, I discover that the db_DELETE call is translated into:
  &#40;&#40;db-&gt;dbp&#41;-&gt;del&#41;&#40;db-&gt;dbp, TXN &#38;key, 0&#41;

Looking in the documentation for dbopen on Tru64 &#40;OSF/1&#41; v5.1B I see:
...
            typedef struct {
            DBTYPE type;
            int &#40;*close&#41;&#40;const DB *db&#41;;
            int &#40;*del&#41;&#40;const DB *db, const DBT *key, u_int option&#41;;
            int &#40;*fd&#41;&#40;const DB *db&#41;;
            int &#40;*get&#41;&#40;const DB *db, DBT *key, DBT *data, u_int option&#41;;
            int &#40;*put&#41;&#40;const DB *db, DBT *key, const DBT *data, u_int
option&#41;;
            int &#40;*sync&#41;&#40;const DB *db, u_int option&#41;;
            int &#40;*seq&#41;&#40;const DB *db, DBT *key, DBT *data, u_int option&#41;;
            } DB;
...
       del A  pointer to a routine to remove key/data pairs from the
database.

           The parameter option can be set to the following value:

       R_CURSOR
               Delete the record referenced by the cursor.   The  cursor
 must
               have previously been initialized.

               The  del routines return -1 on error &#40;setting errno&#41;, 0
on suc-
               cess, and 1 if the specified key was not in the file.

Checking for the value of R_CURSOR in /usr/include/db.h I find:
  #define R_CURSOR        1               /* del, put, seq */

My guess is that the builtin library SEGV&#39;s given a value of 0 for the
option parameter - which could be construed as a bug on the part of the
db-lib &#40;I&#39;ll report that to Digi^WComp^WHP asap&#41;.

Somehow the build process will need to avoid the builtin DB-library on
Tru64 and request another one.

I&#39;ll be happy to try to help avoiding this nasty bug if I can.


A log of a build &#40;using Perl 5.6.1&#41; is here:

&lt;ht000@tortuga:/home/ht000/.cpan/build/DB_File-1.810:!&gt;$ or$ perl
Makefile.PL
Parsing config.in...
Looks Good.
Checking if your kit is complete...
Looks good
Writing Makefile for DB_File
&lt;ht000@tortuga:/home/ht000/.cpan/build/DB_File-1.810:!&gt;$ or$ make
cp DB_File.pm blib/lib/DB_File.pm
AutoSplitting blib/lib/DB_File.pm &#40;blib/lib/auto/DB_File&#41;
cc -c  -I/usr/local/BerkeleyDB/include -std -fprm d -ieee -D_INTRINSICS
-I/usr/l
ocal/include -DLANGUAGE_C -O4   -DVERSION=\&#34;1.810\&#34;
-DXS_VERSION=\&#34;1.810\&#34;  &#34;-I/
usr/local/lib/perl5/5.6.1/alpha-dec_osf/CORE&#34;  -D_NOT_CORE 
-DmDB_Prefix_t=size_
t -DmDB_Hash_t=u_int32_t   version.c
/usr/local/bin/perl /usr/local/lib/perl5/5.6.1/ExtUtils/xsubpp
-noprototypes -ty
pemap /usr/local/lib/perl5/5.6.1/ExtUtils/typemap -typemap typemap 
DB_File.xs &gt;
 DB_File.xsc &#38;&#38; mv DB_File.xsc DB_File.c
cc -c  -I/usr/local/BerkeleyDB/include -std -fprm d -ieee -D_INTRINSICS
-I/usr/l
ocal/include -DLANGUAGE_C -O4   -DVERSION=\&#34;1.810\&#34;
-DXS_VERSION=\&#34;1.810\&#34;  &#34;-I/
usr/local/lib/perl5/5.6.1/alpha-dec_osf/CORE&#34;  -D_NOT_CORE 
-DmDB_Prefix_t=size_
t -DmDB_Hash_t=u_int32_t   DB_File.c
Running Mkbootstrap for DB_File &#40;&#41;
chmod 644 DB_File.bs
ar cr tmp.a version.o DB_File.o
: tmp.a
rm -f blib/arch/auto/DB_File/DB_File.so
LD_RUN_PATH=&#34;/usr/shlib&#34; ld  -shared -expect_unresolved &#34;*&#34; -O4 -msym
-std -s -L
/usr/local/lib -all tmp.a -none  -o blib/arch/auto/DB_File/DB_File.so  
-ldb   
chmod 755 blib/arch/auto/DB_File/DB_File.so
cp DB_File.bs blib/arch/auto/DB_File/DB_File.bs
chmod 644 blib/arch/auto/DB_File/DB_File.bs
Manifying blib/man3/DB_File.3
&lt;ht000@tortuga:/home/ht000/.cpan/build/DB_File-1.810:!&gt;$ or$ make test
Running Mkbootstrap for DB_File &#40;&#41;
chmod 644 DB_File.bs
ar cr tmp.a version.o DB_File.o
: tmp.a
rm -f blib/arch/auto/DB_File/DB_File.so
LD_RUN_PATH=&#34;/usr/shlib&#34; ld  -shared -expect_unresolved &#34;*&#34; -O4 -msym
-std -s -L
/usr/local/lib -all tmp.a -none  -o blib/arch/auto/DB_File/DB_File.so  
-ldb   
chmod 755 blib/arch/auto/DB_File/DB_File.so
cp DB_File.bs blib/arch/auto/DB_File/DB_File.bs
chmod 644 blib/arch/auto/DB_File/DB_File.bs
PERL_DL_NONLAZY=1 /usr/local/bin/perl &#34;-MExtUtils::Command::MM&#34; &#34;-e&#34;
&#34;test_harne
ss&#40;0, &#39;blib/lib&#39;, &#39;blib/arch&#39;&#41;&#34; t/*.t
t/db-btree....ok                                                       
     
t/db-hash.....dubious                                                  
     
        Test returned status -1 &#40;wstat 139, 0x8b&#41;
Executing /usr/bin/dbx &#34;/usr/local/bin/perl&#34; &#34;core&#34; &#40;where&#41;...
dbx version 5.1
Type &#39;help&#39; for help.
Core file created by program &#34;perl&#34;

signal Segmentation fault at &gt;*[__free_ovflpage, 0x3ff810cb040]        
ldl    t
2, 24&#40;a1&#41;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  0 __free_ovflpage&#40;0x3ff810c63dc, 0x2, 0x3ff810c6b34, 0x140205408,
</div>0x1401fec40
&#41; [0x3ff810cb040]
   1 __big_delete&#40;0x3ff810c429c, 0x14021a80a, 0x1, 0x4, 0x1401fec40&#41;
[0x3ff810c6
b50]
   2 &#40;unknown&#41;&#40;&#41; [0x3ff810c4298]

/usr/bin/dbx: fatal error: hit EOF on standard input file

t/db-recno....
make: *** [test_dynamic] Interrupt
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-85557" href="/Public/Bug/Display.html?id=3211#txn-85557">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;18&nbsp;04:44:01&nbsp;2004</span>
    <span class="description">Paul.Marquess [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Paul Marquess&#34; &lt;paul.marquess [...] ntlworld.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-DB_File [...] rt.cpan.org&gt;, &lt;&#34;undisclosed-recipients:&#34; [...] pallas.eruditorum.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [cpan #3211] core dump in db-hash.t  under OSF1 </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 18 Nov 2004 09:38:46 -0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">RT-Send-Cc:</td>
    <td class="message-header-value"> </td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/85557/24873/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/24873">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 6.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

I assume OSF ships with Berkeley DB 1.85 &#40;or 1.86&#41;.

Without more detailed evidence, I&#39;m not so sure about your guess that
passing a 0 to the delete method is causing this problem - the btree test
harness worked fine and it does all the same things the hash test suite
does. If you run the test suite in verbose mode we can see which test it is
tripping over.

    make test TEST_VERBOSE=1

cheers
Paul

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; -----Original Message-----
&gt; From: Henrik_Tougaard via RT [mailto:bug-DB_File@rt.cpan.org]
&gt; Sent: 17 November 2004 14:00
&gt; To: undisclosed-recipients:
&gt; Subject: [cpan #3211] core dump in db-hash.t under OSF1
&gt; 
&gt; 
&gt; This message about DB_File was sent to you by HTOUG &lt;HTOUG@cpan.org&gt; via
&gt; rt.cpan.org
&gt; 
&gt; Full context and any attached attachments can be found at:
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=3211">https://rt.cpan.org/Ticket/Display.html?id=3211</a></span> &gt;
&gt; 
&gt; [PMQS - Mon Oct 20 09:10:55 2003]:
&gt; 
<div class="message-stanza open">&gt; &gt; [guest - Mon Aug 11 10:04:57 2003]:
&gt; &gt;
<div class="message-stanza open">&gt; &gt; &gt; hallo,
&gt; &gt; &gt;
&gt; &gt; &gt; there ist a problem with all releases of DB_File i tried
&gt; &gt; &gt; &#40;perl5.003 ... perl-5.6, and also DB_File-1.806&#41;
&gt; &gt; &gt; in connection with /usr/lib/libdb.so which is shipped with OSF1 V5.1
&gt; &gt; &gt; &#40;True64 Unix&#41;.
&gt; &gt; &gt;
&gt; &gt; &gt; ok&#40;22, $X = tie&#40;%h,&#39;DB_File&#39;,$Dfile, O_RDWR, 0640&#41; &#41;;
&gt; &gt; &gt;
&gt; &gt; &gt; fails with core dump.
&gt; &gt; &gt;
&gt; &gt; &gt; in version 1.75 the c-source looks like
&gt; &gt; &gt;
&gt; &gt; &gt; line 1672 &#34;DB_File.xs&#34;
&gt; &gt; &gt;     CurrentDB = db ;
&gt; &gt; &gt; #line 1756 &#34;DB_File.c&#34;
&gt; &gt; &gt;
&gt; &gt; &gt;   RETVAL = db_DELETE&#40;db, key, flags&#41;;
&gt; &gt; &gt;   XSprePUSH; PUSHi&#40;&#40;IV&#41;RETVAL&#41;;
&gt; &gt; &gt;     }
&gt; &gt; &gt;     XSRETURN&#40;1&#41;;
&gt; &gt; &gt; }
</div></div>&gt; 
&gt; I have just &#39;banged head on&#39; into this problem. Digging a bit deeper
&gt; into the code, I discover that the db_DELETE call is translated into:
&gt;   &#40;&#40;db-&gt;dbp&#41;-&gt;del&#41;&#40;db-&gt;dbp, TXN &#38;key, 0&#41;
&gt; 
&gt; Looking in the documentation for dbopen on Tru64 &#40;OSF/1&#41; v5.1B I see:
&gt; ...
&gt;             typedef struct {
&gt;             DBTYPE type;
&gt;             int &#40;*close&#41;&#40;const DB *db&#41;;
&gt;             int &#40;*del&#41;&#40;const DB *db, const DBT *key, u_int option&#41;;
&gt;             int &#40;*fd&#41;&#40;const DB *db&#41;;
&gt;             int &#40;*get&#41;&#40;const DB *db, DBT *key, DBT *data, u_int option&#41;;
&gt;             int &#40;*put&#41;&#40;const DB *db, DBT *key, const DBT *data, u_int
&gt; option&#41;;
&gt;             int &#40;*sync&#41;&#40;const DB *db, u_int option&#41;;
&gt;             int &#40;*seq&#41;&#40;const DB *db, DBT *key, DBT *data, u_int option&#41;;
&gt;             } DB;
&gt; ...
&gt;        del A  pointer to a routine to remove key/data pairs from the
&gt; database.
&gt; 
&gt;            The parameter option can be set to the following value:
&gt; 
&gt;        R_CURSOR
&gt;                Delete the record referenced by the cursor.   The  cursor
&gt;  must
&gt;                have previously been initialized.
&gt; 
&gt;                The  del routines return -1 on error &#40;setting errno&#41;, 0
&gt; on suc-
&gt;                cess, and 1 if the specified key was not in the file.
&gt; 
&gt; Checking for the value of R_CURSOR in /usr/include/db.h I find:
&gt;   #define R_CURSOR        1               /* del, put, seq */
&gt; 
&gt; My guess is that the builtin library SEGV&#39;s given a value of 0 for the
&gt; option parameter - which could be construed as a bug on the part of the
&gt; db-lib &#40;I&#39;ll report that to Digi^WComp^WHP asap&#41;.
&gt; 
&gt; Somehow the build process will need to avoid the builtin DB-library on
&gt; Tru64 and request another one.
&gt; 
&gt; I&#39;ll be happy to try to help avoiding this nasty bug if I can.
&gt; 
&gt; 
&gt; A log of a build &#40;using Perl 5.6.1&#41; is here:
&gt; 
&gt; &lt;ht000@tortuga:/home/ht000/.cpan/build/DB_File-1.810:!&gt;$ or$ perl
&gt; Makefile.PL
&gt; Parsing config.in...
&gt; Looks Good.
&gt; Checking if your kit is complete...
&gt; Looks good
&gt; Writing Makefile for DB_File
&gt; &lt;ht000@tortuga:/home/ht000/.cpan/build/DB_File-1.810:!&gt;$ or$ make
&gt; cp DB_File.pm blib/lib/DB_File.pm
&gt; AutoSplitting blib/lib/DB_File.pm &#40;blib/lib/auto/DB_File&#41;
&gt; cc -c  -I/usr/local/BerkeleyDB/include -std -fprm d -ieee -D_INTRINSICS
&gt; -I/usr/l
&gt; ocal/include -DLANGUAGE_C -O4   -DVERSION=\&#34;1.810\&#34;
&gt; -DXS_VERSION=\&#34;1.810\&#34;  &#34;-I/
&gt; usr/local/lib/perl5/5.6.1/alpha-dec_osf/CORE&#34;  -D_NOT_CORE
&gt; -DmDB_Prefix_t=size_
&gt; t -DmDB_Hash_t=u_int32_t   version.c
&gt; /usr/local/bin/perl /usr/local/lib/perl5/5.6.1/ExtUtils/xsubpp
&gt; -noprototypes -ty
&gt; pemap /usr/local/lib/perl5/5.6.1/ExtUtils/typemap -typemap typemap
&gt; DB_File.xs &gt;
&gt;  DB_File.xsc &#38;&#38; mv DB_File.xsc DB_File.c
&gt; cc -c  -I/usr/local/BerkeleyDB/include -std -fprm d -ieee -D_INTRINSICS
&gt; -I/usr/l
&gt; ocal/include -DLANGUAGE_C -O4   -DVERSION=\&#34;1.810\&#34;
&gt; -DXS_VERSION=\&#34;1.810\&#34;  &#34;-I/
&gt; usr/local/lib/perl5/5.6.1/alpha-dec_osf/CORE&#34;  -D_NOT_CORE
&gt; -DmDB_Prefix_t=size_
&gt; t -DmDB_Hash_t=u_int32_t   DB_File.c
&gt; Running Mkbootstrap for DB_File &#40;&#41;
&gt; chmod 644 DB_File.bs
&gt; ar cr tmp.a version.o DB_File.o
&gt; : tmp.a
&gt; rm -f blib/arch/auto/DB_File/DB_File.so
&gt; LD_RUN_PATH=&#34;/usr/shlib&#34; ld  -shared -expect_unresolved &#34;*&#34; -O4 -msym
&gt; -std -s -L
&gt; /usr/local/lib -all tmp.a -none  -o blib/arch/auto/DB_File/DB_File.so
&gt; -ldb
&gt; chmod 755 blib/arch/auto/DB_File/DB_File.so
&gt; cp DB_File.bs blib/arch/auto/DB_File/DB_File.bs
&gt; chmod 644 blib/arch/auto/DB_File/DB_File.bs
&gt; Manifying blib/man3/DB_File.3
&gt; &lt;ht000@tortuga:/home/ht000/.cpan/build/DB_File-1.810:!&gt;$ or$ make test
&gt; Running Mkbootstrap for DB_File &#40;&#41;
&gt; chmod 644 DB_File.bs
&gt; ar cr tmp.a version.o DB_File.o
&gt; : tmp.a
&gt; rm -f blib/arch/auto/DB_File/DB_File.so
&gt; LD_RUN_PATH=&#34;/usr/shlib&#34; ld  -shared -expect_unresolved &#34;*&#34; -O4 -msym
&gt; -std -s -L
&gt; /usr/local/lib -all tmp.a -none  -o blib/arch/auto/DB_File/DB_File.so
&gt; -ldb
&gt; chmod 755 blib/arch/auto/DB_File/DB_File.so
&gt; cp DB_File.bs blib/arch/auto/DB_File/DB_File.bs
&gt; chmod 644 blib/arch/auto/DB_File/DB_File.bs
&gt; PERL_DL_NONLAZY=1 /usr/local/bin/perl &#34;-MExtUtils::Command::MM&#34; &#34;-e&#34;
&gt; &#34;test_harne
&gt; ss&#40;0, &#39;blib/lib&#39;, &#39;blib/arch&#39;&#41;&#34; t/*.t
&gt; t/db-btree....ok
&gt; 
&gt; t/db-hash.....dubious
&gt; 
&gt;         Test returned status -1 &#40;wstat 139, 0x8b&#41;
&gt; Executing /usr/bin/dbx &#34;/usr/local/bin/perl&#34; &#34;core&#34; &#40;where&#41;...
&gt; dbx version 5.1
&gt; Type &#39;help&#39; for help.
&gt; Core file created by program &#34;perl&#34;
&gt; 
&gt; signal Segmentation fault at &gt;*[__free_ovflpage, 0x3ff810cb040]
&gt; ldl    t
&gt; 2, 24&#40;a1&#41;
<div class="message-stanza open">&gt; &gt;  0 __free_ovflpage&#40;0x3ff810c63dc, 0x2, 0x3ff810c6b34, 0x140205408,
</div>&gt; 0x1401fec40
&gt; &#41; [0x3ff810cb040]
&gt;    1 __big_delete&#40;0x3ff810c429c, 0x14021a80a, 0x1, 0x4, 0x1401fec40&#41;
&gt; [0x3ff810c6
&gt; b50]
&gt;    2 &#40;unknown&#41;&#40;&#41; [0x3ff810c4298]
&gt; 
&gt; /usr/bin/dbx: fatal error: hit EOF on standard input file
&gt; 
&gt; t/db-recno....
&gt; make: *** [test_dynamic] Interrupt
</div></div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.350825</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
