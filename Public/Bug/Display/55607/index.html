<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #55607 for Inline: Bind at runtime can cause &#34;Modification of a read-only value attempted&#34; error</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #55607 for Inline: Bind at runtime can cause &#34;Modification of a read-only value attempted&#34; error</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Inline/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Inline/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Inline/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Inline/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/ingydotnet/inline-pm/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/Inline">Inline CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">55607</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Inline/Active/">Inline</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
MOB [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-16878-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
0.45</li>
<li>
0.46</li>
</ul>
    </td>
  </tr>
  <tr id="CF-16879-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;15&nbsp;17:07:01&nbsp;2010</span>
    <span class="description">MOB [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Bind at runtime can cause &#34;Modification of a read-only value
 attempted&#34; error</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This code produces a &#34;Modification of a read-only value attempted&#34; error 
in the Inline::bind method:

  1:  use strict qw&#40;vars subs&#41;;
  2:  for &#40;&#39;function&#39;&#41; {
  3:      $_-&gt;&#40;&#41;;
  4:  }
  5:
  6:  sub function {
  7:      require Inline;
  8:      Inline-&gt;bind&#40;C =&gt; &lt;&lt;&#39;__CODE__&#39;&#41;;
  9:  void foo&#40;&#41;
 10:  {
 11:  }
 12:  __CODE__
 13:  }

With &#39;-MCarp::Always&#39;, the output is:

    Modification of a read-only value attempted at 
/usr/lib/perl5/site_perl/5.10/Inline/denter.pm line 191
        Inline::denter::_setup_line&#40;&#39;Inline::denter=HASH&#40;0x101a4940&#41;&#39;&#41; 
called at /usr/lib/perl5/site_perl/5.10/Inline/denter.pm line 30
        Inline::denter::undent&#40;&#39;Inline::denter=HASH&#40;0x101a4940&#41;&#39;, 
&#39;version : 0.45\x{d}\x{a}languages : %\x{d}\x{a}    C : C\x{d}\x{a}    
Foo : Foo\x{d}\x{a}    ...&#39;&#41; called at blib/lib/Inline.pm &#40;autosplit 
into blib/lib/auto/Inline/check_config_file.al&#41; line 704
        Inline::check_config_file&#40;&#39;Inline=HASH&#40;0x1013a890&#41;&#39;&#41; called at 
/usr/lib/perl5/site_perl/5.10/Inline.pm line 244
        Inline::glue&#40;&#39;Inline=HASH&#40;0x1013a890&#41;&#39;&#41; called at 
/usr/lib/perl5/site_perl/5.10/Inline.pm line 182
        Inline::bind&#40;&#39;Inline&#39;, &#39;C&#39;, &#39;void foo&#40;&#41;\x{a}{\x{a}}\x{a}&#39;&#41; 
called at inline_issue.pl line 8
        main::function1&#40;&#41; called at inline_issue.pl line 3

I see there are functions in the Inline module, including 
Inline::denter::_next_line, Inline::denter::_setup_line, 
Inline::denter::indent, and Inline::C::get_types, that overwrite the 
value of $_ without localizing or lexically scoping it. When $_ is used 
in a way that makes it a read-only value, as it is on line 3 of the test 
script, the error occurs.

Now that I know what causes this problem, it is easy to workaround it in 
the code that calls Inline, but it would also be possible to prevent 
this problem inside the Inline module.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;30&nbsp;05:59:43&nbsp;2010</span>
    <span class="description">sisyphus [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Mar 15 17:07:01 2010, MOB wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I see there are functions in the Inline module, including 
&gt; Inline::denter::_next_line, Inline::denter::_setup_line, 
&gt; Inline::denter::indent, and Inline::C::get_types, that overwrite the 
&gt; value of $_ without localizing or lexically scoping it.
</div>
In Inline-0.46 I think you&#39;ll find that Inline::denter already local&#40;&#41;
ises $_ where necessary. It just remains to do a &#39;local $_;&#39; 
declaration at the beginning of Inline::C::get_types&#40;&#41; and the script 
you posted runs fine for me. Could you confirm for me that fixes your 
problems, too ?

Thanks for the report. Sorry I&#39;ve been a bit slow getting back to you - 
I actually didn&#39;t notice your report until a couple of days ago.

Cheers,
Rob
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;30&nbsp;05:59:44&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;31&nbsp;00:37:52&nbsp;2010</span>
    <span class="description">MOB [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Mar 30 05:59:43 2010, SISYPHUS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon Mar 15 17:07:01 2010, MOB wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; I see there are functions in the Inline module, including 
&gt; &gt; Inline::denter::_next_line, Inline::denter::_setup_line, 
&gt; &gt; Inline::denter::indent, and Inline::C::get_types, that overwrite the 
&gt; &gt; value of $_ without localizing or lexically scoping it.
</div>&gt; 
&gt; In Inline-0.46 I think you&#39;ll find that Inline::denter already local&#40;&#41;
&gt; ises $_ where necessary. It just remains to do a &#39;local $_;&#39; 
&gt; declaration at the beginning of Inline::C::get_types&#40;&#41; and the script 
&gt; you posted runs fine for me. Could you confirm for me that fixes your 
&gt; problems, too ?
&gt; 
&gt; Thanks for the report. Sorry I&#39;ve been a bit slow getting back to you 
</div>- 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I actually didn&#39;t notice your report until a couple of days ago.
&gt; 
&gt; Cheers,
&gt; Rob
</div>
Hi Rob,

Adding a &#34;local $_&#34; inside Inline::C::get_types&#40;&#41; fixes the issue in 
Inline-0.46. Here&#39;s a test script that passes after the change is made:

################################################################

use Test::More tests =&gt; 1;
use strict qw&#40;vars subs&#41;;
use warnings;
for &#40;&#39;function&#39;&#41; {
  $_-&gt;&#40;&#41;;
}
sub function {
  require Inline;
  Inline-&gt;bind&#40;C =&gt; &lt;&lt;&#39;__CODE__&#39;&#41;;
int foo&#40;&#41;
{
  return 42;
}
__CODE__
}
ok&#40;42==foo&#40;&#41;, &#34;run-time bind successful while \$_ is read-only&#34;&#41;;

#############################################################

Keep up the great work,
Marty O&#39;Brien
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;01&nbsp;03:24:37&nbsp;2010</span>
    <span class="description">sisyphus [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Mar 31 00:37:52 2010, MOB wrote:
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Adding a &#34;local $_&#34; inside Inline::C::get_types&#40;&#41; fixes the issue in 
&gt; Inline-0.46.
</div>
Thanks Marty. Inline-0.46_01 &#40;uploaded to CPAN yesterday&#41; contains the 
fix, and a test script &#40;C/t/11default_readonly.t&#41; that&#39;s based on the 
scripts you provided.

I&#39;ll leave this bug report open until 0.47 is released ... not sure 
when that will be.

Cheers,
Rob
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;20&nbsp;21:16:59&nbsp;2011</span>
    <span class="description">sisyphus [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> MOB [...] cpan.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Marty,
Inline-0.47 uploaded to CPAN today - therefore closing this ticket.

Cheers,
Rob
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;20&nbsp;21:17:01&nbsp;2011</span>
    <span class="description">sisyphus [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
