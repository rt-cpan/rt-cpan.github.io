<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #131058 for Net-WebSocket-Server: on_tick stops being called after 7-8 hours of constant operation</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #131058 for Net-WebSocket-Server: on_tick stops being called after 7-8 hours of constant operation</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Net-WebSocket-Server">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Net-WebSocket-Server">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Net-WebSocket-Server">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Net-WebSocket-Server">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-WebSocket-Server">Net-WebSocket-Server CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">131058</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Net-WebSocket-Server">Net-WebSocket-Server</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
pliablepixels [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-250206-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-250207-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=131058">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1872500" href="/Public/Bug/Display.html?id=131058#txn-1872500">#</a>      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;23&nbsp;06:28:30&nbsp;2019</span>
    <span class="description">pliablepixels [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> on_tick stops being called after 7-8 hours of constant operation</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 23 Nov 2019 06:28:02 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-WebSocket-Server [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Pliable Pixels &lt;pliablepixels [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1872500/1005281/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1005281">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi, thanks for the great library. I am using your library to implement an
event server of sorts that receives alarm notifications from an open source
home security server &#40;ZoneMinder&#41; and does machine learning to detect
objects in the alarm feed.

The core &#34;loop&#34; of my server relies on your on_tick callback here
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/pliablepixels/zmeventnotification/blob/master/zmeventnotification.pl#L2320-L2351">https://github.com/pliablepixels/zmeventnotification/blob/master/zmeventnotification.pl#L2320-L2351</a></span>

What I&#39;ve been observing is that after around 7-8 hours of smooth
operation, the &#39;on_tick&#39; handler is just not called. I inserted debugging
statements inside /usr/local/share/perl/5.26.1/Net/WebSocket/Server.pm to
log messages when it invokes the on_tick and have confirmed it does not.
Nor does it exit the start&#40;&#41; sub.

I&#39;ve now set it up to log more debug statements after each step
&#40;select/etc&#41; inside server.pm but wanted to reach out to you to ask if
you&#39;ve experienced this in the past and know what this may be?

At the time it &#34;locks up&#34; my server is still running &#40;hasn&#39;t crashed&#41; but
obviously I can&#39;t connect to it, because its locked somewhere.

I&#39;m still debugging, but thought I&#39;d ask :-&#41;

thx
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1872500/1005282/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1005282">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.4k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1872569" href="/Public/Bug/Display.html?id=131058#txn-1872569">#</a>      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;23&nbsp;20:20:18&nbsp;2019</span>
    <span class="description">TOPAZ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1872569/1005315/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1005315">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Nov 23 06:28:30 2019, pliablepixels@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi, thanks for the great library. I am using your library to implement
&gt; an
&gt; event server of sorts that receives alarm notifications from an open
&gt; source
&gt; home security server &#40;ZoneMinder&#41; and does machine learning to detect
&gt; objects in the alarm feed.
&gt; 
&gt; The core &#34;loop&#34; of my server relies on your on_tick callback here
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/pliablepixels/zmeventnotification/blob/master/zmeventnotification.pl#L2320-">https://github.com/pliablepixels/zmeventnotification/blob/master/zmeventnotification.pl#L2320-</a></span>
&gt; L2351
&gt; 
&gt; What I&#39;ve been observing is that after around 7-8 hours of smooth
&gt; operation, the &#39;on_tick&#39; handler is just not called. I inserted
&gt; debugging
&gt; statements inside /usr/local/share/perl/5.26.1/Net/WebSocket/Server.pm
&gt; to
&gt; log messages when it invokes the on_tick and have confirmed it does
&gt; not.
&gt; Nor does it exit the start&#40;&#41; sub.
&gt; 
&gt; I&#39;ve now set it up to log more debug statements after each step
&gt; &#40;select/etc&#41; inside server.pm but wanted to reach out to you to ask if
&gt; you&#39;ve experienced this in the past and know what this may be?
&gt; 
&gt; At the time it &#34;locks up&#34; my server is still running &#40;hasn&#39;t crashed&#41;
&gt; but
&gt; obviously I can&#39;t connect to it, because its locked somewhere.
&gt; 
&gt; I&#39;m still debugging, but thought I&#39;d ask :-&#41;
&gt; 
&gt; thx
</div>

I don&#39;t know of a bug like this, but that doesn&#39;t mean there isn&#39;t one.

Using fork&#40;&#41; inside any handler for a server is tricky business; that might be the cause.  fork&#40;&#41; can do weird things with cloning filehandles or sharing sockets.  I&#39;m not exactly sure how Net::WebSocket::Server behaves when forked, but it might help to directly close your open file descriptors before continuing in the child process.  &#40;Which descriptors you close depends on your application.&#41;  There are some modules that make forking a child process safer, like Proc::Daemon, if that suits your needs.  If you want to just try closing the file descriptors directly without everything else Proc::Daemon does, it closes all of your open file descriptors by:
1. Getting the highest descriptor id: <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/AKREAL/Proc-Daemon-0.23/lib/Proc/Daemon.pm#L461">https://metacpan.org/source/AKREAL/Proc-Daemon-0.23/lib/Proc/Daemon.pm#L461</a></span>
2. Looping over them and calling POSIX::close&#40;&#41; conditionally <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/AKREAL/Proc-Daemon-0.23/lib/Proc/Daemon.pm#L224">https://metacpan.org/source/AKREAL/Proc-Daemon-0.23/lib/Proc/Daemon.pm#L224</a></span>

If that&#39;s not the issue, it might help in your debugging to log the value of $timeout just before the call to select&#40;&#41; - <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/TOPAZ/Net-WebSocket-Server-0.003004/lib/Net/WebSocket/Server.pm#L157">https://metacpan.org/source/TOPAZ/Net-WebSocket-Server-0.003004/lib/Net/WebSocket/Server.pm#L157</a></span> - that would tell you 1. whether the event loop is re-entering the select&#40;&#41; consistently and 2. whether the amount of time it intends to wait looks sane.

Because it&#39;s single-threaded, also look out for bugs where one of your handlers &#40;or the server code itself, somehow&#41; is blocking on some kind of operation.

I&#39;d also check for memory leaks; see if your server process is using increasingly larger amounts of memory as it runs over several hours.

If all else fails, you should at least be able to narrow down which section of the main loop in start&#40;&#41; gets stuck with some carefully-placed log lines.

Please let me know what you find; I&#39;d love to fix a bug if I have one &#40;or maybe add better documentation about how to avoid issues in callbacks if there&#39;s a subtle bug in your code somewhere&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1872570" href="/Public/Bug/Display.html?id=131058#txn-1872570">#</a>      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;23&nbsp;20:20:18&nbsp;2019</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1872743" href="/Public/Bug/Display.html?id=131058#txn-1872743">#</a>      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;24&nbsp;21:55:43&nbsp;2019</span>
    <span class="description">pliablepixels [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #131058] on_tick stops being called after 7-8 hours of constant operation</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 24 Nov 2019 21:55:17 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-WebSocket-Server [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Pliable Pixels &lt;pliablepixels [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1872743/1005403/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1005403">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Eric, thank you for the detailed explanation.
Unfortunately, now that I&#39;ve added debug prints everywhere the crash
stopped occurring.

I&#39;ve decided to write a small program that mimics my operation with your
code without the complexities of my in fork code. I added in the code to
close the fds in the child per your suggestion.

The gist is here
<span class="clickylink"><a target="new" rel="nofollow" href="https://gist.github.com/pliablepixels/440e14532beac01af0453f9f7e322519">https://gist.github.com/pliablepixels/440e14532beac01af0453f9f7e322519</a></span>

When the child exits, I see
Warning: unable to close filehandle properly: Bad file descriptor during
global destruction.

Would you know if I&#39;m doing something wrong? It seems the code is closing
an fd is should not. I&#39;m skipping 0-2 &#40;in/out/err&#41; and the code reports the
first fd it closes is 4.

Thanks


On Sat, Nov 23, 2019 at 8:20 PM Eric Wastl via RT &lt;
bug-Net-WebSocket-Server@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=131058">https://rt.cpan.org/Ticket/Display.html?id=131058</a></span> &gt;
&gt;
&gt; On Sat Nov 23 06:28:30 2019, pliablepixels@gmail.com wrote:
<div class="message-stanza open">&gt; &gt; Hi, thanks for the great library. I am using your library to implement
&gt; &gt; an
&gt; &gt; event server of sorts that receives alarm notifications from an open
&gt; &gt; source
&gt; &gt; home security server &#40;ZoneMinder&#41; and does machine learning to detect
&gt; &gt; objects in the alarm feed.
&gt; &gt;
&gt; &gt; The core &#34;loop&#34; of my server relies on your on_tick callback here
&gt; &gt;
</div>&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/pliablepixels/zmeventnotification/blob/master/zmeventnotification.pl#L2320-">https://github.com/pliablepixels/zmeventnotification/blob/master/zmeventnotification.pl#L2320-</a></span>
<div class="message-stanza open">&gt; &gt; L2351
&gt; &gt;
&gt; &gt; What I&#39;ve been observing is that after around 7-8 hours of smooth
&gt; &gt; operation, the &#39;on_tick&#39; handler is just not called. I inserted
&gt; &gt; debugging
&gt; &gt; statements inside /usr/local/share/perl/5.26.1/Net/WebSocket/Server.pm
&gt; &gt; to
&gt; &gt; log messages when it invokes the on_tick and have confirmed it does
&gt; &gt; not.
&gt; &gt; Nor does it exit the start&#40;&#41; sub.
&gt; &gt;
&gt; &gt; I&#39;ve now set it up to log more debug statements after each step
&gt; &gt; &#40;select/etc&#41; inside server.pm but wanted to reach out to you to ask if
&gt; &gt; you&#39;ve experienced this in the past and know what this may be?
&gt; &gt;
&gt; &gt; At the time it &#34;locks up&#34; my server is still running &#40;hasn&#39;t crashed&#41;
&gt; &gt; but
&gt; &gt; obviously I can&#39;t connect to it, because its locked somewhere.
&gt; &gt;
&gt; &gt; I&#39;m still debugging, but thought I&#39;d ask :-&#41;
&gt; &gt;
&gt; &gt; thx
</div>&gt;
&gt;
&gt; I don&#39;t know of a bug like this, but that doesn&#39;t mean there isn&#39;t one.
&gt;
&gt; Using fork&#40;&#41; inside any handler for a server is tricky business; that
&gt; might be the cause.  fork&#40;&#41; can do weird things with cloning filehandles or
&gt; sharing sockets.  I&#39;m not exactly sure how Net::WebSocket::Server behaves
&gt; when forked, but it might help to directly close your open file descriptors
&gt; before continuing in the child process.  &#40;Which descriptors you close
&gt; depends on your application.&#41;  There are some modules that make forking a
&gt; child process safer, like Proc::Daemon, if that suits your needs.  If you
&gt; want to just try closing the file descriptors directly without everything
&gt; else Proc::Daemon does, it closes all of your open file descriptors by:
&gt; 1. Getting the highest descriptor id:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/AKREAL/Proc-Daemon-0.23/lib/Proc/Daemon.pm#L461">https://metacpan.org/source/AKREAL/Proc-Daemon-0.23/lib/Proc/Daemon.pm#L461</a></span>
&gt; 2. Looping over them and calling POSIX::close&#40;&#41; conditionally
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/AKREAL/Proc-Daemon-0.23/lib/Proc/Daemon.pm#L224">https://metacpan.org/source/AKREAL/Proc-Daemon-0.23/lib/Proc/Daemon.pm#L224</a></span>
&gt;
&gt; If that&#39;s not the issue, it might help in your debugging to log the value
&gt; of $timeout just before the call to select&#40;&#41; -
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/TOPAZ/Net-WebSocket-Server-0.003004/lib/Net/WebSocket/Server.pm#L157">https://metacpan.org/source/TOPAZ/Net-WebSocket-Server-0.003004/lib/Net/WebSocket/Server.pm#L157</a></span>
&gt; - that would tell you 1. whether the event loop is re-entering the select&#40;&#41;
&gt; consistently and 2. whether the amount of time it intends to wait looks
&gt; sane.
&gt;
&gt; Because it&#39;s single-threaded, also look out for bugs where one of your
&gt; handlers &#40;or the server code itself, somehow&#41; is blocking on some kind of
&gt; operation.
&gt;
&gt; I&#39;d also check for memory leaks; see if your server process is using
&gt; increasingly larger amounts of memory as it runs over several hours.
&gt;
&gt; If all else fails, you should at least be able to narrow down which
&gt; section of the main loop in start&#40;&#41; gets stuck with some carefully-placed
&gt; log lines.
&gt;
&gt; Please let me know what you find; I&#39;d love to fix a bug if I have one &#40;or
&gt; maybe add better documentation about how to avoid issues in callbacks if
&gt; there&#39;s a subtle bug in your code somewhere&#41;.
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1872743/1005404/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1005404">with headers</a>
<br />
<span class="downloadcontenttype">text/html 5.8k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1873582" href="/Public/Bug/Display.html?id=131058#txn-1873582">#</a>      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;30&nbsp;09:13:32&nbsp;2019</span>
    <span class="description">pliablepixels [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #131058] on_tick stops being called after 7-8 hours of constant operation</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 30 Nov 2019 09:13:10 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-WebSocket-Server [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Pliable Pixels &lt;pliablepixels [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1873582/1005752/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1005752">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 7.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Okay, I really do think this has something to do with the code inside
server.pm and not forking. What exactly, I haven&#39;t found yet.

First, here are some logs from Server.pm &#40;I added prints&#41;:

Fri Nov 29 10:28:48 2019************ core: before select with
timeout:4.99757385253906
Fri Nov 29 10:28:53 2019************ core: after select
Fri Nov 29 10:28:53 2019************ core: before foreach ready_write
Fri Nov 29 10:28:53 2019************ core: after foreach ready_write
Fri Nov 29 10:28:53 2019************ core: tick period:5
tick_next:1575041333.49427 time: 1575041333.49959
Fri Nov 29 10:28:53 2019************* calling on_tick
Fri Nov 29 10:28:53 2019************ core: inside while
Fri Nov 29 10:28:53 2019************ core: before select with
timeout:4.09693813323975
Fri Nov 29 10:28:57 2019************ core: after select
Fri Nov 29 10:28:57 2019************ core: before foreach ready_write
Fri Nov 29 10:28:57 2019************ core: after foreach ready_write
Fri Nov 29 10:28:57 2019************ core: tick period:5
tick_next:1575041338.49427 time: 1575041337.60232
Fri Nov 29 10:28:57 2019************ core: inside while
Fri Nov 29 10:28:57 2019************ core: before select with
timeout:0.891774892807007
Fri Nov 29 10:28:58 2019************ core: after select
Fri Nov 29 10:28:58 2019************ core: before foreach ready_write
Fri Nov 29 10:28:58 2019************ core: after foreach ready_write
Fri Nov 29 10:28:58 2019************ core: tick period:5
tick_next:1575041338.49427 time: 1575041338.49548
Fri Nov 29 10:28:58 2019************* calling on_tick
Fri Nov 29 10:28:58 2019************ core: inside while
Fri Nov 29 10:28:58 2019************ core: before select with
timeout:4.99761295318604
Fri Nov 29 10:29:03 2019************ core: after select
Fri Nov 29 10:29:03 2019************ core: before foreach ready_write
Fri Nov 29 10:29:03 2019************ core: after foreach ready_write
Fri Nov 29 10:29:03 2019************ core: tick period:5
tick_next:1575041343.49427 time: 1575041343.49968
Fri Nov 29 10:29:03 2019************* calling on_tick
Fri Nov 29 10:29:03 2019************ core: inside while
Fri Nov 29 10:29:03 2019************ core: before select with
timeout:4.10133290290833
Fri Nov 29 10:29:07 2019************ core: after select

- - - - - stuck at this point  - - - - -

Now here is the modified server.pm file
<span class="clickylink"><a target="new" rel="nofollow" href="https://gist.github.com/pliablepixels/348281b4445ac044552917970bf4b47b">https://gist.github.com/pliablepixels/348281b4445ac044552917970bf4b47b</a></span>


So basically,  it gets stuck in this loop
<span class="clickylink"><a target="new" rel="nofollow" href="https://gist.github.com/pliablepixels/348281b4445ac044552917970bf4b47b#file-server-pm-L169-L187">https://gist.github.com/pliablepixels/348281b4445ac044552917970bf4b47b#file-server-pm-L169-L187</a></span>


I can then send the process a HUP &#40;I have a HUP handler&#41; that then gets it
out of the stuck loop but it gets stuck again. I can repeat this every time
I send a HUP

So I just sent a HUP to that process, and it gets out of that loop, but
gets stuck again in the next iteration.

Sat Nov 30 09:07:14 2019************ core: before foreach ready_write
Sat Nov 30 09:07:14 2019************ core: after foreach ready_write
Sat Nov 30 09:07:14 2019************ core: tick period:5
tick_next:1575041353.49427 time: 1575122834.35031
Sat Nov 30 09:07:14 2019************* calling on_tick
Sat Nov 30 09:07:14 2019************ core: inside while
Sat Nov 30 09:07:14 2019************ core: before select with
timeout:-81475.8615190983
Sat Nov 30 09:07:14 2019************ core: after select




On Sun, Nov 24, 2019 at 9:55 PM Pliable Pixels &lt;pliablepixels@gmail.com&gt;
wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi Eric, thank you for the detailed explanation.
&gt; Unfortunately, now that I&#39;ve added debug prints everywhere the crash
&gt; stopped occurring.
&gt;
&gt; I&#39;ve decided to write a small program that mimics my operation with your
&gt; code without the complexities of my in fork code. I added in the code to
&gt; close the fds in the child per your suggestion.
&gt;
&gt; The gist is here
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://gist.github.com/pliablepixels/440e14532beac01af0453f9f7e322519">https://gist.github.com/pliablepixels/440e14532beac01af0453f9f7e322519</a></span>
&gt;
&gt; When the child exits, I see
&gt; Warning: unable to close filehandle properly: Bad file descriptor during
&gt; global destruction.
&gt;
&gt; Would you know if I&#39;m doing something wrong? It seems the code is closing
&gt; an fd is should not. I&#39;m skipping 0-2 &#40;in/out/err&#41; and the code reports the
&gt; first fd it closes is 4.
&gt;
&gt; Thanks
&gt;
&gt;
&gt; On Sat, Nov 23, 2019 at 8:20 PM Eric Wastl via RT &lt;
&gt; bug-Net-WebSocket-Server@rt.cpan.org&gt; wrote:
&gt;
<div class="message-stanza open">&gt;&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=131058">https://rt.cpan.org/Ticket/Display.html?id=131058</a></span> &gt;
&gt;&gt;
&gt;&gt; On Sat Nov 23 06:28:30 2019, pliablepixels@gmail.com wrote:
<div class="message-stanza open">&gt;&gt; &gt; Hi, thanks for the great library. I am using your library to implement
&gt;&gt; &gt; an
&gt;&gt; &gt; event server of sorts that receives alarm notifications from an open
&gt;&gt; &gt; source
&gt;&gt; &gt; home security server &#40;ZoneMinder&#41; and does machine learning to detect
&gt;&gt; &gt; objects in the alarm feed.
&gt;&gt; &gt;
&gt;&gt; &gt; The core &#34;loop&#34; of my server relies on your on_tick callback here
&gt;&gt; &gt;
</div>&gt;&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/pliablepixels/zmeventnotification/blob/master/zmeventnotification.pl#L2320-">https://github.com/pliablepixels/zmeventnotification/blob/master/zmeventnotification.pl#L2320-</a></span>
<div class="message-stanza open">&gt;&gt; &gt; L2351
&gt;&gt; &gt;
&gt;&gt; &gt; What I&#39;ve been observing is that after around 7-8 hours of smooth
&gt;&gt; &gt; operation, the &#39;on_tick&#39; handler is just not called. I inserted
&gt;&gt; &gt; debugging
&gt;&gt; &gt; statements inside /usr/local/share/perl/5.26.1/Net/WebSocket/Server.pm
&gt;&gt; &gt; to
&gt;&gt; &gt; log messages when it invokes the on_tick and have confirmed it does
&gt;&gt; &gt; not.
&gt;&gt; &gt; Nor does it exit the start&#40;&#41; sub.
&gt;&gt; &gt;
&gt;&gt; &gt; I&#39;ve now set it up to log more debug statements after each step
&gt;&gt; &gt; &#40;select/etc&#41; inside server.pm but wanted to reach out to you to ask if
&gt;&gt; &gt; you&#39;ve experienced this in the past and know what this may be?
&gt;&gt; &gt;
&gt;&gt; &gt; At the time it &#34;locks up&#34; my server is still running &#40;hasn&#39;t crashed&#41;
&gt;&gt; &gt; but
&gt;&gt; &gt; obviously I can&#39;t connect to it, because its locked somewhere.
&gt;&gt; &gt;
&gt;&gt; &gt; I&#39;m still debugging, but thought I&#39;d ask :-&#41;
&gt;&gt; &gt;
&gt;&gt; &gt; thx
</div>&gt;&gt;
&gt;&gt;
&gt;&gt; I don&#39;t know of a bug like this, but that doesn&#39;t mean there isn&#39;t one.
&gt;&gt;
&gt;&gt; Using fork&#40;&#41; inside any handler for a server is tricky business; that
&gt;&gt; might be the cause.  fork&#40;&#41; can do weird things with cloning filehandles or
&gt;&gt; sharing sockets.  I&#39;m not exactly sure how Net::WebSocket::Server behaves
&gt;&gt; when forked, but it might help to directly close your open file descriptors
&gt;&gt; before continuing in the child process.  &#40;Which descriptors you close
&gt;&gt; depends on your application.&#41;  There are some modules that make forking a
&gt;&gt; child process safer, like Proc::Daemon, if that suits your needs.  If you
&gt;&gt; want to just try closing the file descriptors directly without everything
&gt;&gt; else Proc::Daemon does, it closes all of your open file descriptors by:
&gt;&gt; 1. Getting the highest descriptor id:
&gt;&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/AKREAL/Proc-Daemon-0.23/lib/Proc/Daemon.pm#L461">https://metacpan.org/source/AKREAL/Proc-Daemon-0.23/lib/Proc/Daemon.pm#L461</a></span>
&gt;&gt; 2. Looping over them and calling POSIX::close&#40;&#41; conditionally
&gt;&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/AKREAL/Proc-Daemon-0.23/lib/Proc/Daemon.pm#L224">https://metacpan.org/source/AKREAL/Proc-Daemon-0.23/lib/Proc/Daemon.pm#L224</a></span>
&gt;&gt;
&gt;&gt; If that&#39;s not the issue, it might help in your debugging to log the value
&gt;&gt; of $timeout just before the call to select&#40;&#41; -
&gt;&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/TOPAZ/Net-WebSocket-Server-0.003004/lib/Net/WebSocket/Server.pm#L157">https://metacpan.org/source/TOPAZ/Net-WebSocket-Server-0.003004/lib/Net/WebSocket/Server.pm#L157</a></span>
&gt;&gt; - that would tell you 1. whether the event loop is re-entering the select&#40;&#41;
&gt;&gt; consistently and 2. whether the amount of time it intends to wait looks
&gt;&gt; sane.
&gt;&gt;
&gt;&gt; Because it&#39;s single-threaded, also look out for bugs where one of your
&gt;&gt; handlers &#40;or the server code itself, somehow&#41; is blocking on some kind of
&gt;&gt; operation.
&gt;&gt;
&gt;&gt; I&#39;d also check for memory leaks; see if your server process is using
&gt;&gt; increasingly larger amounts of memory as it runs over several hours.
&gt;&gt;
&gt;&gt; If all else fails, you should at least be able to narrow down which
&gt;&gt; section of the main loop in start&#40;&#41; gets stuck with some carefully-placed
&gt;&gt; log lines.
&gt;&gt;
&gt;&gt; Please let me know what you find; I&#39;d love to fix a bug if I have one &#40;or
&gt;&gt; maybe add better documentation about how to avoid issues in callbacks if
&gt;&gt; there&#39;s a subtle bug in your code somewhere&#41;.
&gt;&gt;
</div>&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1873582/1005753/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1005753">with headers</a>
<br />
<span class="downloadcontenttype">text/html 10.4k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1873590" href="/Public/Bug/Display.html?id=131058#txn-1873590">#</a>      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;30&nbsp;10:49:27&nbsp;2019</span>
    <span class="description">pliablepixels [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #131058] on_tick stops being called after 7-8 hours of constant operation</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 30 Nov 2019 10:49:08 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-WebSocket-Server [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Pliable Pixels &lt;pliablepixels [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1873590/1005756/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1005756">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 214b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Forgot to mention:

First thing I do is terminate the $wss object in my child as well, after
your first response.
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/pliablepixels/zmeventnotification/blob/master/zmeventnotification.pl#L2331-L2336">https://github.com/pliablepixels/zmeventnotification/blob/master/zmeventnotification.pl#L2331-L2336</a></span>
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1873590/1005757/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1005757">with headers</a>
<br />
<span class="downloadcontenttype">text/html 438b</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1873664" href="/Public/Bug/Display.html?id=131058#txn-1873664">#</a>      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;01&nbsp;07:47:11&nbsp;2019</span>
    <span class="description">pliablepixels [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #131058] on_tick stops being called after 7-8 hours of constant operation</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 1 Dec 2019 07:46:48 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-WebSocket-Server [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Pliable Pixels &lt;pliablepixels [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1873664/1005791/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1005791">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">My last update:

Updated Server.pm with more debug logs:
<span class="clickylink"><a target="new" rel="nofollow" href="https://gist.github.com/pliablepixels/348281b4445ac044552917970bf4b47b">https://gist.github.com/pliablepixels/348281b4445ac044552917970bf4b47b</a></span>

Notes:
a&#41; There was no fork launched or active at the time it got stuck. Last fork
was over 30 mins ago from the time it got stuck, which is why I feel there
is something else going on.
b&#41; As I mentioned earlier, in my updated server code, I shut down the
websocket server in the client as the first thing
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/pliablepixels/zmeventnotification/blob/master/zmeventnotification.pl#L2336">https://github.com/pliablepixels/zmeventnotification/blob/master/zmeventnotification.pl#L2336</a></span>

Final logs &#40;more debug logs&#41; before it got stuck - shows it gets stuck
right after select. Doesn&#39;t get into the for loop.

Sun Dec  1 03:31:26 2019************ core: after foreach ready_write
Sun Dec  1 03:31:26 2019************ core: tick period:5
tick_next:1575189086.8804 time: 1575189086.88234
Sun Dec  1 03:31:26 2019************* calling on_tick
Sun Dec  1 03:31:26 2019************ core: inside while
Sun Dec  1 03:31:26 2019************ core: before select with
timeout:-0.00114798545837402
Sun Dec  1 03:31:26 2019************ core: after select
Sun Dec  1 03:31:26 2019************ core: before foreach ready_write
Sun Dec  1 03:31:26 2019************ core: after foreach ready_write
Sun Dec  1 03:31:26 2019************ core: tick period:5
tick_next:1575189091.8804 time: 1575189086.8837
Sun Dec  1 03:31:26 2019************ core: inside while
Sun Dec  1 03:31:26 2019************ core: before select with
timeout:4.99665689468384
Sun Dec  1 03:31:31 2019************ core: after select
Sun Dec  1 03:31:31 2019************ core: before foreach ready_write
Sun Dec  1 03:31:31 2019************ core: after foreach ready_write
Sun Dec  1 03:31:31 2019************ core: tick period:5
tick_next:1575189091.8804 time: 1575189091.88569
Sun Dec  1 03:31:31 2019************* calling on_tick
Sun Dec  1 03:31:31 2019************ core: inside while
Sun Dec  1 03:31:31 2019************ core: before select with
timeout:4.99346995353699
Sun Dec  1 03:31:36 2019************ core: after select
Sun Dec  1 03:31:36 2019************ core: before foreach ready_write
Sun Dec  1 03:31:36 2019************ core: after foreach ready_write
Sun Dec  1 03:31:36 2019************ core: tick period:5
tick_next:1575189096.8804 time: 1575189096.88233
Sun Dec  1 03:31:36 2019************* calling on_tick
Sun Dec  1 03:31:36 2019************ core: inside while
Sun Dec  1 03:31:36 2019************ core: before select with
timeout:0.000120162963867188
Sun Dec  1 03:31:36 2019************ core: after select
Sun Dec  1 03:31:36 2019************ core: before foreach ready_write
Sun Dec  1 03:31:36 2019************ core: after foreach ready_write
Sun Dec  1 03:31:36 2019************ core: tick period:5
tick_next:1575189101.8804 time: 1575189096.88386
Sun Dec  1 03:31:36 2019************ core: inside while
Sun Dec  1 03:31:36 2019************ core: before select with
timeout:4.99649381637573
Sun Dec  1 03:31:37 2019************ core: after select

- - - stuck - - -
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1873664/1005792/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1005792">with headers</a>
<br />
<span class="downloadcontenttype">text/html 3.7k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1875739" href="/Public/Bug/Display.html?id=131058#txn-1875739">#</a>      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;23&nbsp;07:25:57&nbsp;2019</span>
    <span class="description">pliablepixels [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #131058] on_tick stops being called after 7-8 hours of constant operation</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 23 Dec 2019 07:25:36 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-WebSocket-Server [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Pliable Pixels &lt;pliablepixels [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1875739/1006696/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1006696">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 378b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi we can close this. I completely reworked how I was handling forks and
the problem has gone way. My guess is the problem was one of two things: a&#41;
I was handling signals incorrectly in the child process b&#41; There were
certain cases where a DB handle was not properly cleaned up.

Either way, it does not look like there was any problem with the core WSS
code. Thank you.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1875739/1006697/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1006697">with headers</a>
<br />
<span class="downloadcontenttype">text/html 752b</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1876327" href="/Public/Bug/Display.html?id=131058#txn-1876327">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;26&nbsp;15:39:32&nbsp;2019</span>
    <span class="description">TOPAZ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1876327/1006968/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1006968">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 276b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve closed this ticket.

Sorry for suddenly going dark; my Decembers are extremely busy.  I&#39;m glad you were able to figure it out, though.  Please let me know if there could have been any useful warnings in the documentation that might help other users in similar situations.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1876329" href="/Public/Bug/Display.html?id=131058#txn-1876329">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;26&nbsp;15:39:32&nbsp;2019</span>
    <span class="description">TOPAZ [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.598784</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
