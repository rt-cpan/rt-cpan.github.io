<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #122653 for Net-IMAP-Simple: IPv6 with SSL works fine with IO::Socket::SSL</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #122653 for Net-IMAP-Simple: IPv6 with SSL works fine with IO::Socket::SSL</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-IMAP-Simple/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-IMAP-Simple/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-IMAP-Simple/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-IMAP-Simple/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-IMAP-Simple">Net-IMAP-Simple CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">122653</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-IMAP-Simple/Active/">Net-IMAP-Simple</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
moritz [...] bunkus.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-22730-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-22731-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;30&nbsp;15:40:33&nbsp;2017</span>
    <span class="description">moritz [...] bunkus.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> IPv6 with SSL works fine with IO::Socket::SSL</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 30 Jul 2017 21:36:55 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-IMAP-Simple [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Moritz Bunkus &lt;moritz [...] bunkus.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hey,

if both &#34;use_ssl&#34; and &#34;use_ipv6&#34; is set, Net::IMAP::Simple carps with an
error message that the combination is not supported. However, it does
work very well with small modifications to the source. Please remove
that error and apply the changes I&#39;ll describe below.

Reading current IO::Socket::SSL documentation[1] states the following:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; * If IO::Socket::IP with at least version 0.20 is installed it will
&gt;   use this module as super class, transparently providing IPv6 and
&gt;   IPv4 support.
&gt; * If IO::Socket::INET6 is installed it will use this module as super
&gt;   class, transparently providing IPv6 and IPv4 support.
</div>
Therefore I&#39;ve redefined Net::IMAP::Simple::_sock_from to test for
&#34;use_ssl&#34; first like this &#40;one line, wrapped only for email&#41;:

sub _sock_from   {
  return $_[0]-&gt;{use_ssl} ? &#39;IO::Socket::SSL&#39;
       : $_[0]-&gt;{use_v6}  ? &#39;IO::Socket::INET6&#39;
       :                    &#39;IO::Socket::INET&#39;
}

Using the following code works just fine afterwards:

------------------------------------------------------------
my $imap = Net::IMAP::Simple-&gt;new&#40;
  &#39;the-hostname&#39;,
  port               =&gt; 993,
  use_v6             =&gt; 1,
  use_ssl            =&gt; 1,
  shutup_about_v6ssl =&gt; 1,
&#41;;

$imap-&gt;login&#40;&#39;the-user&#39;, &#39;secret&#39;&#41;;
print join&#40;&#34;\n&#34;, sort&#40;{ $a cmp $b } $imap-&gt;mailboxes_subscribed&#41;&#41;, &#34;\n&#34;;
$imap-&gt;quit;
------------------------------------------------------------

So please:

a&#41; remove the test for &#34;use_v6 &#38;&#38; use_ssl&#34; with the following &#34;carp&#34;
   in &#34;new&#34; and
b&#41; change &#34;_sock_from&#34; as I&#39;ve shown above.

Thanks!

Kind regards,
mosu

[1]  <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~sullr/IO-Socket-SSL-2.049/lib/IO/Socket/SSL.pod">http://search.cpan.org/~sullr/IO-Socket-SSL-2.049/lib/IO/Socket/SSL.pod</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;01&nbsp;21:25:32&nbsp;2017</span>
    <span class="description">tlhackque [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> tlhackque [...] yahoo.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">+1 for IPv6 support.  However, I suggest IO::Socket::IP, as it will handle IPv4 &#38; IPv6 - automatically selecting the address from those in DNS.

use_ipv6 can be used to force IPv6; I suggest 0 = IPv4 only, 1 = IPv6 only and undef = auto.

This should be compatible with current usage.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;01&nbsp;21:25:32&nbsp;2017</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;10&nbsp;14:33:54&nbsp;2017</span>
    <span class="description">jettero [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">These seem like relatively simple changes. 

I&#39;ll +1 that too.

Shoot me a PR here if you&#39;re completely tired of waiting for me.

  <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/jettero/net--imap--simple">https://github.com/jettero/net--imap--simple</a></span>

On Sun Jul 30 15:40:33 2017, moritz@bunkus.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hey,
&gt; 
&gt; if both &#34;use_ssl&#34; and &#34;use_ipv6&#34; is set, Net::IMAP::Simple carps with an
&gt; error message that the combination is not supported. However, it does
&gt; work very well with small modifications to the source. Please remove
&gt; that error and apply the changes I&#39;ll describe below.
&gt; 
&gt; Reading current IO::Socket::SSL documentation[1] states the following:
&gt; 
<div class="message-stanza open">&gt; &gt; * If IO::Socket::IP with at least version 0.20 is installed it will
&gt; &gt;   use this module as super class, transparently providing IPv6 and
&gt; &gt;   IPv4 support.
&gt; &gt; * If IO::Socket::INET6 is installed it will use this module as super
&gt; &gt;   class, transparently providing IPv6 and IPv4 support.
</div>&gt; 
&gt; Therefore I&#39;ve redefined Net::IMAP::Simple::_sock_from to test for
&gt; &#34;use_ssl&#34; first like this &#40;one line, wrapped only for email&#41;:
&gt; 
&gt; sub _sock_from   {
&gt;   return $_[0]-&gt;{use_ssl} ? &#39;IO::Socket::SSL&#39;
&gt;        : $_[0]-&gt;{use_v6}  ? &#39;IO::Socket::INET6&#39;
&gt;        :                    &#39;IO::Socket::INET&#39;
&gt; }
&gt; 
&gt; Using the following code works just fine afterwards:
&gt; 
&gt; ------------------------------------------------------------
&gt; my $imap = Net::IMAP::Simple-&gt;new&#40;
&gt;   &#39;the-hostname&#39;,
&gt;   port               =&gt; 993,
&gt;   use_v6             =&gt; 1,
&gt;   use_ssl            =&gt; 1,
&gt;   shutup_about_v6ssl =&gt; 1,
&gt; &#41;;
&gt; 
&gt; $imap-&gt;login&#40;&#39;the-user&#39;, &#39;secret&#39;&#41;;
&gt; print join&#40;&#34;\n&#34;, sort&#40;{ $a cmp $b } $imap-&gt;mailboxes_subscribed&#41;&#41;, &#34;\n&#34;;
&gt; $imap-&gt;quit;
&gt; ------------------------------------------------------------
&gt; 
&gt; So please:
&gt; 
&gt; a&#41; remove the test for &#34;use_v6 &#38;&#38; use_ssl&#34; with the following &#34;carp&#34;
&gt;    in &#34;new&#34; and
&gt; b&#41; change &#34;_sock_from&#34; as I&#39;ve shown above.
&gt; 
&gt; Thanks!
&gt; 
&gt; Kind regards,
&gt; mosu
&gt; 
&gt; [1]  <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~sullr/IO-Socket-SSL-2.049/lib/IO/Socket/SSL.pod">http://search.cpan.org/~sullr/IO-Socket-SSL-2.049/lib/IO/Socket/SSL.pod</a></span>
</div>

-- 
If riding in an airplane is flying, then riding in a boat is swimming.
116 jumps, 48.6 minutes of freefall, 92.9 freefall miles.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
