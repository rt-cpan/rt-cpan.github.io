<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #42819 for CAM-PDF: parseStream&#40;&#41; fix for unrecogized stream tag</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #42819 for CAM-PDF: parseStream&#40;&#41; fix for unrecogized stream tag</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/CAM-PDF/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/CAM-PDF/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/CAM-PDF/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/CAM-PDF/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/CAM-PDF">CAM-PDF CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">42819</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/CAM-PDF/Active/">CAM-PDF</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
vbmetta [...] hotmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-4996-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-4997-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;27&nbsp;01:51:50&nbsp;2009</span>
    <span class="description">vbmetta [...] hotmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> parseStream&#40;&#41; fix for unrecogized stream tag</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 27 Jan 2009 06:48:11 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-cam-pdf [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Vonne Bannavong &lt;vbmetta [...] hotmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
CAM::PDF-&gt;parseStream&#40;&#41; matches the beginning of a stream with
my $begin = shift || qr/ stream\r?\n /xms;

Customer account statements provided by a major stock brokerage as PDF-1.2 files,
produced using a commercial package
/Author &#40;Xenos, inc.&#41;

/CreationDate &#40;&#41; 

/Creator &#40;M2PD API Version 4.0.01, build\&#40;Oct 17 2002, 10:52:03\&#41;&#41; 

/Producer &#40;PDFOUT v3.8t by Xenos, inc.&#41; 


begins streams with
qr/ stream\s\n /xms

These files are readily viewed by a variety of PDF viewers, so they are probably compliant
with the PDF spec.  However CAM::PDF fails to read these files, stopping at the stream tag.
This issue is corrected by changing the above line of code in parseStream&#40;&#41; to
my $begin = shift || qr/ stream&#40;\r?|\s&#41;\n /xms;
The whitespace before the newline probably generalizes to \s*

I hope you can apply this patch to CPAN.
I like your package - thanks.

Robert Lacroix

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">_________________________________________________________________
Windows Live Messenger. Multitasking at its finest.
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.microsoft.com/windows/windowslive/messenger.aspx">http://www.microsoft.com/windows/windowslive/messenger.aspx</a></span>
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;27&nbsp;22:22:05&nbsp;2009</span>
    <span class="description">chris+rt [...] chrisdolan.net -  Status changed from &#39;new&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;27&nbsp;22:22:11&nbsp;2009</span>
    <span class="description">chris [...] chrisdolan.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #42819] parseStream&#40;&#41; fix for unrecogized stream tag </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 27 Jan 2009 21:20:38 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CAM-PDF [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Chris Dolan &lt;chris [...] chrisdolan.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Robert,

I thank you for the thoughtful comment, but your patch is not  
correct.  If I applied that patch, then streams that started with a  
&#34;\n&#34; would be missing their initial character&#40;s&#41;.  The PDF  
specification is very clear on this issue:

   &#34;The keyword &#39;stream&#39; that follows
    the stream dictionary should be followed by an end-of-line marker  
consisting of
    either a carriage return and a line feed or just a line feed, and  
not by a carriage
    return alone. The sequence of bytes that make up a stream lie  
between the &#39;stream&#39;
    and &#39;endstream&#39; keywords; the stream dictionary specifies the  
exact number of
    bytes. It is recommended that there be an end-of-line marker  
after the data and
    before &#39;endstream&#39;; this marker is not included in the stream  
length.&#34;

&#40;PDF 1.7 reference, pp 60-61&#41;

You are obviously welcome to use the patch in your own code, but I  
recommend that you check the results carefully because, given random  
binary streams, your patch will work in 255 or every 256 cases.

Chris

On Jan 27, 2009, at 12:51 AM, Vonne Bannavong via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Tue Jan 27 01:51:50 2009: Request 42819 was acted upon.
&gt; Transaction: Ticket created by vbmetta@hotmail.com
&gt;        Queue: CAM-PDF
&gt;      Subject: parseStream&#40;&#41; fix for unrecogized stream tag
&gt;    Broken in: &#40;no value&#41;
&gt;     Severity: &#40;no value&#41;
&gt;        Owner: Nobody
&gt;   Requestors: vbmetta@hotmail.com
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=42819">http://rt.cpan.org/Ticket/Display.html?id=42819</a></span> &gt;
&gt;
&gt;
&gt;
&gt; CAM::PDF-&gt;parseStream&#40;&#41; matches the beginning of a stream with
&gt; my $begin = shift || qr/ stream\r?\n /xms;
&gt;
&gt; Customer account statements provided by a major stock brokerage as  
&gt; PDF-1.2 files,
&gt; produced using a commercial package
&gt; /Author &#40;Xenos, inc.&#41;
&gt;
&gt; /CreationDate &#40;&#41;
&gt;
&gt; /Creator &#40;M2PD API Version 4.0.01, build\&#40;Oct 17 2002, 10:52:03\&#41;&#41;
&gt;
&gt; /Producer &#40;PDFOUT v3.8t by Xenos, inc.&#41;
&gt;
&gt;
&gt; begins streams with
&gt; qr/ stream\s\n /xms
&gt;
&gt; These files are readily viewed by a variety of PDF viewers, so they  
&gt; are probably compliant
&gt; with the PDF spec.  However CAM::PDF fails to read these files,  
&gt; stopping at the stream tag.
&gt; This issue is corrected by changing the above line of code in  
&gt; parseStream&#40;&#41; to
&gt; my $begin = shift || qr/ stream&#40;\r?|\s&#41;\n /xms;
&gt; The whitespace before the newline probably generalizes to \s*
&gt;
&gt; I hope you can apply this patch to CPAN.
&gt; I like your package - thanks.
&gt;
&gt; Robert Lacroix
&gt;
&gt; _________________________________________________________________
&gt; Windows Live Messenger. Multitasking at its finest.
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.microsoft.com/windows/windowslive/messenger.aspx">http://www.microsoft.com/windows/windowslive/messenger.aspx</a></span>
&gt; CAM::PDF-&gt;parseStream&#40;&#41; matches the beginning of a stream with
&gt; my $begin = shift || qr/ stream\r?\n /xms;
&gt;
&gt; Customer account statements provided by a major stock brokerage as  
&gt; PDF-1.2 files,
&gt; produced using a commercial package
&gt; /Author &#40;Xenos, inc.&#41;
&gt; /CreationDate &#40;&#41;
&gt; /Creator &#40;M2PD API Version 4.0.01, build\&#40;Oct 17 2002, 10:52:03\&#41;&#41;
&gt; /Producer &#40;PDFOUT v3.8t by Xenos, inc.&#41;
&gt;
&gt; begins streams with
&gt; qr/ stream\s\n /xms
&gt;
&gt; These files are readily viewed by a variety of PDF viewers, so they  
&gt; are probably compliant
&gt; with the PDF spec.  However CAM::PDF fails to read these files,  
&gt; stopping at the stream tag.
&gt; This issue is corrected by changing the above line of code in  
&gt; parseStream&#40;&#41; to
&gt; my $begin = shift || qr/ stream&#40;\r?|\s&#41;\n /xms;
&gt; The whitespace before the newline probably generalizes to \s*
&gt;
&gt; I hope you can apply this patch to CPAN.
&gt; I like your package - thanks.
&gt;
&gt; Robert Lacroix
&gt;
&gt; Windows Live Messenger. Multitasking at its finest.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;27&nbsp;22:22:12&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;30&nbsp;04:32:10&nbsp;2009</span>
    <span class="description">vbmetta [...] hotmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #42819] parseStream&#40;&#41; fix for unrecogized stream tag</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 30 Jan 2009 09:27:25 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-cam-pdf [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Vonne Bannavong &lt;vbmetta [...] hotmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
Chris,
You&#39;re absolutely right - I overlooked that \n is matched by \s.
Thanks, I&#39;d rather it works 100% of the time.
What we really need to match is &#34;whitespace except \n&#34;.

I looked up the PDF 1.7 spec online in Adobe&#39;s ISO-approved copy of ISO 32000-1:2008
found at <span class="clickylink"><a target="new" rel="nofollow" href="http://www.adobe.com/devnet/pdf/pdf_reference.html">http://www.adobe.com/devnet/pdf/pdf_reference.html</a></span>

Your referenced passage occurs in section &#34;7.3.8 Stream Objects&#34; ... &#34;7.3.8.1 General&#34;.

However the wording is slightly different from the version you quoted.  In fact it makes the end-of-line
before the stream data bytes a requirement. I quote &#40;and add emphasis on notable differences&#41;:

The keyword stream that follows the stream dictionary shall be followed by an end-of-line marker
consisting of either a CARRIAGE RETURN and a LINE FEED or just a LINE FEED, and not by a CARRIAGE
RETURN alone. The sequence of bytes that make up a stream lie between the end-of-line marker following the
stream keyword and the endstream keyword; the stream dictionary specifies the exact number of bytes. There
should be an end-of-line marker after the data and before endstream; this marker shall not be included in the
stream length. There shall not be any extra bytes, other than white space, between endstream and endobj.

<span class="clickylink"><a target="new" rel="nofollow" href="http://www.adobe.com/devnet/acrobat/pdfs/PDF32000_2008.pdf">http://www.adobe.com/devnet/acrobat/pdfs/PDF32000_2008.pdf</a></span> &#40;C&#41; Adobe Systems Incorporated 2008 &#40;retrieved 2009-01-29&#41;


Section 4.46 says that whitespace separates PDF syntactic constructs, and newlines are included in whitespace.
What we have with the &#34;stream&#34; keyword is a special case where the first newline that appears after it, in addition to
being whitespace in relation to keywords, also acts as the delimiter for the data bytes of the stream.  My assertion is that
before hitting the newline, PDF syntax is skipping whitespace in keyword context, and also looking for that first newline
to start the data stream.  I&#39;ve had no reason to ever consider this, except that now I&#39;ve seen one commerical PDF writer
running with this interpretation &#40;or maybe it was just a stupid mainframe character conversion... \r into space; who knows?&#41;.

Implementations aside, I would bet that the PDF spec designers would agree that PDF parsing returns to keyword scanning
mode after the stream&#39;s byte count is exhausted, even though the only valid keyword is &#34;endstream&#34;.  The section quoted above
hints at this, saying a newline is ignored if it appears before &#34;endstream&#34;, and allowing any whitespace before &#34;endobj&#34;.
The section&#39;s encouragement to add an end-of-line after the stream data and before &#34;endstream&#34; is motivated by the desire to
aid in recovery of corrupted PDF files &#40;I saw it somewhere else in the spec but now evince !~ /.*/&#41;.

Getting back to the regex we need, section 4.46 lists valid whitespace characters:
TAB &#40;09h&#41;
LINE FEED &#40;0Ah&#41;
FORM FEED &#40;0Ch&#41;
CARRIAGE RETURN &#40;0Dh&#41;
and the venerable SPACE &#40;20h&#41;

but we want to ignore LINE FEED, so how about

my $begin = shift || qr/ stream[\f\r[:space:]]*\n /xms;

&#40;since [:space:] is equivalent to [ /t]&#41;.  I tried it and it works on a few largish PDFs
plus these formerly unreadable statements.  Do you have any specially constructed unit test cases?

Robert

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Subject: Re: [rt.cpan.org #42819] parseStream&#40;&#41; fix for unrecogized stream tag 
&gt; From: bug-CAM-PDF@rt.cpan.org
&gt; To: vbmetta@hotmail.com
&gt; Date: Tue, 27 Jan 2009 22:22:12 -0500
&gt; 
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=42819">https://rt.cpan.org/Ticket/Display.html?id=42819</a></span> &gt;
&gt; 
&gt; Robert,
&gt; 
&gt; I thank you for the thoughtful comment, but your patch is not  
&gt; correct.  If I applied that patch, then streams that started with a  
&gt; &#34;\n&#34; would be missing their initial character&#40;s&#41;.  The PDF  
&gt; specification is very clear on this issue:
&gt; 
&gt;    &#34;The keyword &#39;stream&#39; that follows
&gt;     the stream dictionary should be followed by an end-of-line marker  
&gt; consisting of
&gt;     either a carriage return and a line feed or just a line feed, and  
&gt; not by a carriage
&gt;     return alone. The sequence of bytes that make up a stream lie  
&gt; between the &#39;stream&#39;
&gt;     and &#39;endstream&#39; keywords; the stream dictionary specifies the  
&gt; exact number of
&gt;     bytes. It is recommended that there be an end-of-line marker  
&gt; after the data and
&gt;     before &#39;endstream&#39;; this marker is not included in the stream  
&gt; length.&#34;
&gt; 
&gt; &#40;PDF 1.7 reference, pp 60-61&#41;
&gt; 
&gt; You are obviously welcome to use the patch in your own code, but I  
&gt; recommend that you check the results carefully because, given random  
&gt; binary streams, your patch will work in 255 or every 256 cases.
&gt; 
&gt; Chris
</div>

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">_________________________________________________________________
Twice the fun—Share photos while you chat with Windows Live Messenger.
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.microsoft.com/windows/windowslive/messenger.aspx">http://www.microsoft.com/windows/windowslive/messenger.aspx</a></span>
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;30&nbsp;09:16:08&nbsp;2009</span>
    <span class="description">vbmetta [...] hotmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #42819] parseStream&#40;&#41; fix for unrecogized stream tag</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 30 Jan 2009 14:11:51 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-cam-pdf [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Vonne Bannavong &lt;vbmetta [...] hotmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
The emphasis I added to the quote in the previous message was lost when it was posted.

Here it is again with text...


      The keyword stream that follows the stream dictionary ==&gt;shall&lt;== be followed by an end-of-line marker
      consisting of either a CARRIAGE RETURN and a LINE FEED or just a LINE FEED, and not by a CARRIAGE
      RETURN alone. The sequence of bytes that make up a stream lie between ==&gt;the end-of-line marker following the
      stream keyword&lt;== and the endstream keyword; the stream dictionary specifies the exact number of bytes. ==&gt;There
      should
be&lt;== an end-of-line marker after the data and before endstream;
this marker ==&gt;shall not be&lt;== included in the
      stream length. There shall not be any extra bytes, other than white space, between endstream and endobj.



<span class="clickylink"><a target="new" rel="nofollow" href="http://www.adobe.com/devnet/acrobat/pdfs/PDF32000_2008.pdf">http://www.adobe.com/devnet/acrobat/pdfs/PDF32000_2008.pdf</a></span> &#40;C&#41; Adobe Systems Incorporated 2008 &#40;retrieved 2009-01-29&#41;



<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">_________________________________________________________________
So many new options, so little time. Windows Live Messenger.
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.microsoft.com/windows/windowslive/messenger.aspx">http://www.microsoft.com/windows/windowslive/messenger.aspx</a></span>
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;31&nbsp;03:59:12&nbsp;2009</span>
    <span class="description">chris [...] chrisdolan.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #42819] parseStream&#40;&#41; fix for unrecogized stream tag</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 31 Jan 2009 02:58:20 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-CAM-PDF [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Chris Dolan &lt;chris [...] chrisdolan.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hmm, yeah, that makes sense.  I had not interpreted it that way, but  
I think it&#39;s worth applying your patch after all.
Chris


On Jan 30, 2009, at 8:16 AM, Vonne Bannavong via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: CAM-PDF
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=42819">http://rt.cpan.org/Ticket/Display.html?id=42819</a></span> &gt;
&gt;
&gt;
&gt; The emphasis I added to the quote in the previous message was lost  
&gt; when it was posted.
&gt;
&gt; Here it is again with text...
&gt;
&gt;
&gt;       The keyword stream that follows the stream dictionary  
&gt; ==&gt;shall&lt;== be followed by an end-of-line marker
&gt;       consisting of either a CARRIAGE RETURN and a LINE FEED or  
&gt; just a LINE FEED, and not by a CARRIAGE
&gt;       RETURN alone. The sequence of bytes that make up a stream lie  
&gt; between ==&gt;the end-of-line marker following the
&gt;       stream keyword&lt;== and the endstream keyword; the stream  
&gt; dictionary specifies the exact number of bytes. ==&gt;There
&gt;       should
&gt; be&lt;== an end-of-line marker after the data and before endstream;
&gt; this marker ==&gt;shall not be&lt;== included in the
&gt;       stream length. There shall not be any extra bytes, other than  
&gt; white space, between endstream and endobj.
&gt;
&gt;
&gt;
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.adobe.com/devnet/acrobat/pdfs/PDF32000_2008.pdf">http://www.adobe.com/devnet/acrobat/pdfs/PDF32000_2008.pdf</a></span> &#40;C&#41;  
&gt; Adobe Systems Incorporated 2008 &#40;retrieved 2009-01-29&#41;
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;31&nbsp;10:58:10&nbsp;2009</span>
    <span class="description">chris+rt [...] chrisdolan.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This will be in the next CAM::PDF release.  Thanks!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;31&nbsp;10:58:11&nbsp;2009</span>
    <span class="description">chris+rt [...] chrisdolan.net -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
