<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #107099 for Net-OpenSSH: Connect with -N key</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #107099 for Net-OpenSSH: Connect with -N key</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Net-OpenSSH">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Net-OpenSSH">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Net-OpenSSH">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Net-OpenSSH">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-OpenSSH">Net-OpenSSH CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">107099</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Net-OpenSSH">Net-OpenSSH</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
madlord [...] list.ru

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-224796-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-224797-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




ssh.c.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1537191/820459/ssh.c.patch">
Mon Sep 21 06:08:44 2015 (596b) by salva [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=107099">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1535341" href="/Public/Bug/Display.html?id=107099#txn-1535341">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;15&nbsp;04:11:02&nbsp;2015</span>
    <span class="description">madlord [...] list.ru -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Connect with -N key</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 15 Sep 2015 11:10:44 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-OpenSSH [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Алексей Павлов &lt;madlord [...] list.ru&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1535341/819389/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/819389">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
Greetings!

Using Net::OpenSSH package to connect to BBRAS Juniper ERX-1400 ran into a problem when the SSH server is not able to work with the option -N.
This option &#40;-x2MN&#41; is passed in the function _connect&#40;&#41; of package and you can not change it.
I would like to have the option package, which could be asked what options to pass when connecting.
Ie at the time of connection to transmit instead string
ssh -o StrictHostKeyChecking=no -o ServerAliveInterval=30 -x2MN -S socket host
this string
ssh -o StrictHostKeyChecking=no -o ServerAliveInterval=30 -x2M -S socket host

Example:
#exec_rc - send execute a remote command on connect &#40;default 0&#41;. Send or not -N option on connect.
my $ssh = Net::OpenSSH-&gt;new&#40;$host, exec_rc =&gt; 1&#41;;

&#40;OpenSSH.pm, ver. 0.57&#41;:

234-235
+ my $exec_rc = delete $opts{exec_rc};
my $batch_mode = delete $opts{batch_mode};

379-380
$self-&gt;{_master_opts} = [$self-&gt;_expand_vars&#40;@master_opts&#41;];
+$self-&gt;{_master_opts} = {@{$self-&gt;{_master_opts}}, &#39;-N&#39;} if &#40;! $exec_rc&#41;;

631-638

sub _connect {
    my &#40;$self, $async&#41; = @_;
    $self-&gt;_set_error;
    my $timeout = int&#40;&#40;&#40;$self-&gt;{_timeout} || 90&#41; + 2&#41;/3&#41;;
-   my @master_opts = &#40;@{$self-&gt;{_master_opts}},
        -o =&gt; &#34;ServerAliveInterval=$timeout&#34;,
        &#39;-x2MN&#39;&#41;; +   my @master_opts = &#40;@{$self-&gt;{_master_opts}},
        -o =&gt; &#34;ServerAliveInterval=$timeout&#34;,
        &#39;-x2M&#39;&#41;;


С уважением, Павлов Алексей :-&#41;
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1535341/819390/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/819390">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.6k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1535380" href="/Public/Bug/Display.html?id=107099#txn-1535380">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;15&nbsp;06:46:07&nbsp;2015</span>
    <span class="description">sfandino [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #107099] Connect with -N key</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 15 Sep 2015 10:45:46 +0000 &#40;UTC&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Net-OpenSSH [...] rt.cpan.org&#34; &lt;bug-Net-OpenSSH [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Salvador Fandino &lt;sfandino [...] yahoo.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1535380/819415/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/819415">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 841b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">



<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;________________________________
&gt; From: Алексей Павлов via RT &lt;bug-Net-OpenSSH@rt.cpan.org&gt;
&gt;To: 
&gt;Sent: Tuesday, September 15, 2015 10:11 AM
&gt;Subject: [rt.cpan.org #107099] Connect with -N key
&gt; 
&gt;
&gt;Tue Sep 15 04:11:02 2015: Request 107099 was acted upon.
&gt;Transaction: Ticket created by madlord@list.ru
&gt;       Queue: Net-OpenSSH
&gt;     Subject: Connect with -N key
&gt;   Broken in: &#40;no value&#41;
&gt;    Severity: &#40;no value&#41;
&gt;       Owner: Nobody
&gt;  Requestors: madlord@list.ru
&gt;      Status: new
&gt;Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=107099">https://rt.cpan.org/Ticket/Display.html?id=107099</a></span> &gt;
</div>

Before placing a workaround in the module I would like to know why the connection fails when -N is used.


Could you run both versions with ssh in verbose mode and send me the output?

  $ssh = Net::OpenSSH-&gt;new&#40;$host, master_opts =&gt; [qw&#40;-vvv&#41;]&#41;;
  $ssh-&gt;system;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1535381" href="/Public/Bug/Display.html?id=107099#txn-1535381">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;15&nbsp;06:46:07&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1535387" href="/Public/Bug/Display.html?id=107099#txn-1535387">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;15&nbsp;07:03:21&nbsp;2015</span>
    <span class="description">madlord [...] list.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re[2]: [rt.cpan.org #107099] Connect with -N key</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 15 Sep 2015 14:02:52 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-OpenSSH [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Алексей Павлов &lt;madlord [...] list.ru&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1535387/819420/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/819420">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 11.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"> /etc/ssh/ssh_config

Host *
GSSAPIAuthentication yes
SendEnv LANG LC_CTYPE LC_NUMERIC LC_TIME LC_COLLATE LC_MONETARY LC_MESSAGES
SendEnv LC_PAPER LC_NAME LC_ADDRESS LC_TELEPHONE LC_MEASUREMENT
SendEnv LC_IDENTIFICATION LC_ALL LANGUAGE
SendEnv XMODIFIERS
With -N key

OpenSSH_5.3p1, OpenSSL 1.0.0-fips 29 Mar 2010
debug1: Reading configuration data /etc/ssh/ssh_config
debug1: Applying options for *
debug2: ssh_connect: needpriv 0
debug1: Connecting to 213.228.116.181 [213.228.116.181] port 22.
debug1: Connection established.
debug1: identity file /home/dslam/.ssh/id_rsa type -1
debug1: identity file /home/dslam/.ssh/id_dsa type -1
debug1: Remote protocol version 2.0, remote software version 2.0.12
debug1: match: 2.0.12 pat 2.0.11*,2.0.12*
debug1: Enabling compatibility mode for protocol 2.0
debug1: Local version string SSH-2.0-OpenSSH_5.3
debug2: fd 3 setting O_NONBLOCK
debug1: SSH2_MSG_KEXINIT sent
debug3: Wrote 792 bytes for a total of 813
debug1: SSH2_MSG_KEXINIT received
debug2: kex_parse_kexinit: diffie-hellman-group-exchange-sha256,diffie-hellman-group-exchange-sha1,diffie-hellman-group14-sha1,diffie-hellman-group1-sha1
debug2: kex_parse_kexinit: ssh-rsa,ssh-dss
debug2: kex_parse_kexinit: aes128-ctr,aes192-ctr,aes256-ctr,arcfour256,arcfour128,aes128-cbc,3des-cbc,blowfish-cbc,cast128-cbc,aes192-cbc,aes256-cbc,arcfour,rijndael-cbc@lysator.liu.se
debug2: kex_parse_kexinit: aes128-ctr,aes192-ctr,aes256-ctr,arcfour256,arcfour128,aes128-cbc,3des-cbc,blowfish-cbc,cast128-cbc,aes192-cbc,aes256-cbc,arcfour,rijndael-cbc@lysator.liu.se
debug2: kex_parse_kexinit: hmac-md5,hmac-sha1,umac-64@openssh.com,hmac-ripemd160,hmac-ripemd160@openssh.com,hmac-sha1-96,hmac-md5-96
debug2: kex_parse_kexinit: hmac-md5,hmac-sha1,umac-64@openssh.com,hmac-ripemd160,hmac-ripemd160@openssh.com,hmac-sha1-96,hmac-md5-96
debug2: kex_parse_kexinit: none,zlib@openssh.com,zlib
debug2: kex_parse_kexinit: none,zlib@openssh.com,zlib
debug2: kex_parse_kexinit:
debug2: kex_parse_kexinit:
debug2: kex_parse_kexinit: first_kex_follows 0
debug2: kex_parse_kexinit: reserved 0
debug2: kex_parse_kexinit: diffie-hellman-group1-sha1
debug2: kex_parse_kexinit: ssh-dss
debug2: kex_parse_kexinit: 3des-cbc,blowfish-cbc
debug2: kex_parse_kexinit: 3des-cbc,blowfish-cbc
debug2: kex_parse_kexinit: hmac-sha1,hmac-md5
debug2: kex_parse_kexinit: hmac-sha1,hmac-md5
debug2: kex_parse_kexinit: none
debug2: kex_parse_kexinit: none
debug2: kex_parse_kexinit:
debug2: kex_parse_kexinit:
debug2: kex_parse_kexinit: first_kex_follows 0
debug2: kex_parse_kexinit: reserved 0
debug2: mac_setup: found hmac-md5
debug1: kex: server-&gt;client 3des-cbc hmac-md5 none
debug2: mac_setup: found hmac-md5
debug1: kex: client-&gt;server 3des-cbc hmac-md5 none
debug2: dh_gen_key: priv key bits set: 190/384
debug2: bits set: 496/1024
debug1: sending SSH2_MSG_KEXDH_INIT
debug1: expecting SSH2_MSG_KEXDH_REPLY
debug3: Wrote 144 bytes for a total of 957
debug3: check_host_in_hostfile: filename /home/dslam/.ssh/known_hosts2
debug3: check_host_in_hostfile: match line 1
debug1: Host &#39;213.228.116.181&#39; is known and matches the DSA host key.
debug1: Found key in /home/dslam/.ssh/known_hosts2:1
debug2: bits set: 506/1024
debug1: ssh_dss_verify: signature correct
debug2: kex_derive_keys
debug2: set_newkeys: mode 1
debug1: SSH2_MSG_NEWKEYS sent
debug1: expecting SSH2_MSG_NEWKEYS
debug3: Wrote 16 bytes for a total of 973
debug2: set_newkeys: mode 0
debug1: SSH2_MSG_NEWKEYS received
debug1: SSH2_MSG_SERVICE_REQUEST sent
debug3: Wrote 48 bytes for a total of 1021
debug2: buggy server: service_accept w/o service
debug1: SSH2_MSG_SERVICE_ACCEPT received
debug2: key: /home/dslam/.ssh/id_rsa &#40;&#40;nil&#41;&#41;
debug2: key: /home/dslam/.ssh/id_dsa &#40;&#40;nil&#41;&#41;
debug3: Wrote 64 bytes for a total of 1085
debug1: Authentication succeeded &#40;none&#41;.
debug1: channel 0: new [client-session]
debug3: ssh_session2_open: channel_new: 0
debug2: channel 0: send open
debug1: setting up multiplex master socket
debug2: fd 7 setting O_NONBLOCK
debug1: Entering interactive session.
debug3: Wrote 56 bytes for a total of 1141
debug3: fd 8 is not O_NONBLOCK
debug3: ssh_msg_recv entering
debug3: ssh_msg_send: type 2
debug3: fd 8 is not O_NONBLOCK
debug3: ssh_msg_recv entering
debug3: ssh_msg_send: type 2
debug3: ssh_msg_recv entering
debug3: muxserver_accept_control: receiving 1 env vars
debug2: muxserver_accept_control: accepted tty 1, subsys 0, cmd
debug2: muxserver_accept_control: got fds stdin 9, stdout 10, stderr 11
debug3: ssh_msg_send: type 2
debug2: fd 8 setting O_NONBLOCK
debug1: channel 1: new [client-session]
debug3: muxserver_accept_control: channel_new: 1
debug2: channel 1: send open
debug3: Wrote 56 bytes for a total of 1197
debug2: channel 0: open confirm rwindow 12288 rmax 512
Received disconnect from 213.228.116.181: 2:
Shared connection to 213.228.116.181 closed.
Without -N key

OpenSSH_5.3p1, OpenSSL 1.0.0-fips 29 Mar 2010
debug1: Reading configuration data /etc/ssh/ssh_config
debug1: Applying options for *
debug2: ssh_connect: needpriv 0
debug1: Connecting to 213.228.116.181 [213.228.116.181] port 22.
debug1: Connection established.
debug1: identity file /home/dslam/.ssh/id_rsa type -1
debug1: identity file /home/dslam/.ssh/id_dsa type -1
debug1: Remote protocol version 2.0, remote software version 2.0.12
debug1: match: 2.0.12 pat 2.0.11*,2.0.12*
debug1: Enabling compatibility mode for protocol 2.0
debug1: Local version string SSH-2.0-OpenSSH_5.3
debug2: fd 3 setting O_NONBLOCK
debug1: SSH2_MSG_KEXINIT sent
debug3: Wrote 792 bytes for a total of 813
debug1: SSH2_MSG_KEXINIT received
debug2: kex_parse_kexinit: diffie-hellman-group-exchange-sha256,diffie-hellman-group-exchange-sha1,diffie-hellman-group14-sha1,diffie-hellman-group1-sha1
debug2: kex_parse_kexinit: ssh-rsa,ssh-dss
debug2: kex_parse_kexinit: aes128-ctr,aes192-ctr,aes256-ctr,arcfour256,arcfour128,aes128-cbc,3des-cbc,blowfish-cbc,cast128-cbc,aes192-cbc,aes256-cbc,arcfour,rijndael-cbc@lysator.liu.se
debug2: kex_parse_kexinit: aes128-ctr,aes192-ctr,aes256-ctr,arcfour256,arcfour128,aes128-cbc,3des-cbc,blowfish-cbc,cast128-cbc,aes192-cbc,aes256-cbc,arcfour,rijndael-cbc@lysator.liu.se
debug2: kex_parse_kexinit: hmac-md5,hmac-sha1,umac-64@openssh.com,hmac-ripemd160,hmac-ripemd160@openssh.com,hmac-sha1-96,hmac-md5-96
debug2: kex_parse_kexinit: hmac-md5,hmac-sha1,umac-64@openssh.com,hmac-ripemd160,hmac-ripemd160@openssh.com,hmac-sha1-96,hmac-md5-96
debug2: kex_parse_kexinit: none,zlib@openssh.com,zlib
debug2: kex_parse_kexinit: none,zlib@openssh.com,zlib
debug2: kex_parse_kexinit:
debug2: kex_parse_kexinit:
debug2: kex_parse_kexinit: first_kex_follows 0
debug2: kex_parse_kexinit: reserved 0
debug2: kex_parse_kexinit: diffie-hellman-group1-sha1
debug2: kex_parse_kexinit: ssh-dss
debug2: kex_parse_kexinit: 3des-cbc,blowfish-cbc
debug2: kex_parse_kexinit: 3des-cbc,blowfish-cbc
debug2: kex_parse_kexinit: hmac-sha1,hmac-md5
debug2: kex_parse_kexinit: hmac-sha1,hmac-md5
debug2: kex_parse_kexinit: none
debug2: kex_parse_kexinit: none
debug2: kex_parse_kexinit:
debug2: kex_parse_kexinit:
debug2: kex_parse_kexinit: first_kex_follows 0
debug2: kex_parse_kexinit: reserved 0
debug2: mac_setup: found hmac-md5
debug1: kex: server-&gt;client 3des-cbc hmac-md5 none
debug2: mac_setup: found hmac-md5
debug1: kex: client-&gt;server 3des-cbc hmac-md5 none
debug2: dh_gen_key: priv key bits set: 196/384
debug2: bits set: 494/1024
debug1: sending SSH2_MSG_KEXDH_INIT
debug1: expecting SSH2_MSG_KEXDH_REPLY
debug3: Wrote 144 bytes for a total of 957
debug3: check_host_in_hostfile: filename /home/dslam/.ssh/known_hosts2
debug3: check_host_in_hostfile: match line 1
debug1: Host &#39;213.228.116.181&#39; is known and matches the DSA host key.
debug1: Found key in /home/dslam/.ssh/known_hosts2:1
debug2: bits set: 525/1024
debug1: ssh_dss_verify: signature correct
debug2: kex_derive_keys
debug2: set_newkeys: mode 1
debug1: SSH2_MSG_NEWKEYS sent
debug1: expecting SSH2_MSG_NEWKEYS
debug3: Wrote 16 bytes for a total of 973
debug2: set_newkeys: mode 0
debug1: SSH2_MSG_NEWKEYS received
debug1: SSH2_MSG_SERVICE_REQUEST sent
debug3: Wrote 48 bytes for a total of 1021
debug2: buggy server: service_accept w/o service
debug1: SSH2_MSG_SERVICE_ACCEPT received
debug2: key: /home/dslam/.ssh/id_rsa &#40;&#40;nil&#41;&#41;
debug2: key: /home/dslam/.ssh/id_dsa &#40;&#40;nil&#41;&#41;
debug3: Wrote 64 bytes for a total of 1085
debug1: Authentication succeeded &#40;none&#41;.
debug1: channel 0: new [client-session]
debug3: ssh_session2_open: channel_new: 0
debug2: channel 0: send open
debug1: setting up multiplex master socket
debug2: fd 7 setting O_NONBLOCK
debug1: Entering interactive session.
debug3: Wrote 56 bytes for a total of 1141
debug3: fd 8 is not O_NONBLOCK
debug3: ssh_msg_recv entering
debug3: ssh_msg_send: type 2
debug3: fd 8 is not O_NONBLOCK
debug3: ssh_msg_recv entering
debug3: ssh_msg_send: type 2
debug3: ssh_msg_recv entering
debug3: muxserver_accept_control: receiving 1 env vars
debug2: muxserver_accept_control: accepted tty 1, subsys 0, cmd
debug2: muxserver_accept_control: got fds stdin 9, stdout 10, stderr 11
debug3: ssh_msg_send: type 2
debug2: fd 8 setting O_NONBLOCK
debug1: channel 1: new [client-session]
debug3: muxserver_accept_control: channel_new: 1
debug2: channel 1: send open
debug3: Wrote 56 bytes for a total of 1197
debug2: callback start
debug2: client_session2_setup: id 0
debug2: channel 0: request pty-req confirm 1
debug1: Sending environment.
debug3: Ignored env HOSTNAME
debug3: Ignored env TERM
debug3: Ignored env SHELL
debug3: Ignored env HISTSIZE
debug3: Ignored env SSH_CLIENT
debug3: Ignored env QTDIR
debug3: Ignored env QTINC
debug3: Ignored env SSH_TTY
debug3: Ignored env USER
debug3: Ignored env LS_COLORS
debug3: Ignored env MAIL
debug3: Ignored env PATH
debug3: Ignored env PWD
debug1: Sending env LANG = ru_RU.KOI8-R
debug2: channel 0: request env confirm 0
debug3: Ignored env HISTCONTROL
debug3: Ignored env SHLVL
debug3: Ignored env HOME
debug3: Ignored env LOGNAME
debug3: Ignored env QTLIB
debug3: Ignored env CVS_RSH
debug3: Ignored env SSH_CONNECTION
debug3: Ignored env LESSOPEN
debug3: Ignored env G_BROKEN_FILENAMES
debug3: Ignored env _
debug3: Ignored env OLDPWD
debug2: channel 0: request shell confirm 1
debug2: fd 3 setting TCP_NODELAY
debug2: callback done
debug2: channel 0: open confirm rwindow 12288 rmax 512
debug3: Wrote 432 bytes for a total of 1629
Received disconnect from 213.228.116.181: 2:
Shared connection to 213.228.116.181 closed.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;Вторник, 15 сентября 2015, 6:46 -04:00 от &#34;Salvador \&#34;Fandiño\&#34; via RT&#34; &lt;bug-Net-OpenSSH@rt.cpan.org&gt;:
&gt;
&gt;&lt;URL:  <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=107099">https://rt.cpan.org/Ticket/Display.html?id=107099</a></span> &gt;
&gt;
&gt;
&gt;
&gt;
&gt;
<div class="message-stanza open">&gt;&gt;________________________________
&gt;&gt; From: Алексей Павлов via RT &lt; bug-Net-OpenSSH@rt.cpan.org &gt;
&gt;&gt;To: 
&gt;&gt;Sent: Tuesday, September 15, 2015 10:11 AM
&gt;&gt;Subject: [rt.cpan.org #107099] Connect with -N key
&gt;&gt; 
&gt;&gt;
&gt;&gt;Tue Sep 15 04:11:02 2015: Request 107099 was acted upon.
&gt;&gt;Transaction: Ticket created by  madlord@list.ru
&gt;&gt;       Queue: Net-OpenSSH
&gt;&gt;     Subject: Connect with -N key
&gt;&gt;   Broken in: &#40;no value&#41;
&gt;&gt;    Severity: &#40;no value&#41;
&gt;&gt;       Owner: Nobody
&gt;&gt;  Requestors:  madlord@list.ru
&gt;&gt;      Status: new
&gt;&gt;Ticket &lt;URL:  <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=107099">https://rt.cpan.org/Ticket/Display.html?id=107099</a></span> &gt;
</div>&gt;
&gt;
&gt;Before placing a workaround in the module I would like to know why the connection fails when -N is used.
&gt;
&gt;
&gt;Could you run both versions with ssh in verbose mode and send me the output?
&gt;
&gt;  $ssh = Net::OpenSSH-&gt;new&#40;$host, master_opts =&gt; [qw&#40;-vvv&#41;]&#41;;
&gt;  $ssh-&gt;system;
&gt;
</div>

С уважением, Павлов Алексей :-&#41;
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1535387/819421/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/819421">with headers</a>
<br />
<span class="downloadcontenttype">text/html 12.9k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1535419" href="/Public/Bug/Display.html?id=107099#txn-1535419">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;15&nbsp;07:34:07&nbsp;2015</span>
    <span class="description">sfandino [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: Re[2]: [rt.cpan.org #107099] Connect with -N key</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 15 Sep 2015 11:33:50 +0000 &#40;UTC&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Net-OpenSSH [...] rt.cpan.org&#34; &lt;bug-Net-OpenSSH [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Salvador Fandino &lt;sfandino [...] yahoo.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1535419/819444/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/819444">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">



<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">----- Original Message -----
<div class="message-stanza open">&gt; From: Алексей Павлов via RT &lt;bug-Net-OpenSSH@rt.cpan.org&gt;
&gt; To: 
&gt; Cc: 
&gt; Sent: Tuesday, September 15, 2015 1:03 PM
&gt; Subject: Re[2]: [rt.cpan.org #107099] Connect with -N key
&gt; 
&gt;        Queue: Net-OpenSSH
&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=107099">https://rt.cpan.org/Ticket/Display.html?id=107099</a></span> &gt;
&gt; 
&gt; /etc/ssh/ssh_config
&gt; 
&gt; Host *
&gt; GSSAPIAuthentication yes
&gt; SendEnv LANG LC_CTYPE LC_NUMERIC LC_TIME LC_COLLATE LC_MONETARY LC_MESSAGES
&gt; SendEnv LC_PAPER LC_NAME LC_ADDRESS LC_TELEPHONE LC_MEASUREMENT
&gt; SendEnv LC_IDENTIFICATION LC_ALL LANGUAGE
&gt; SendEnv XMODIFIERS
&gt; With -N key
&gt; 
&gt; OpenSSH_5.3p1, OpenSSL 1.0.0-fips 29 Mar 2010
&gt; ...
&gt; debug2: channel 0: open confirm rwindow 12288 rmax 512
&gt; Received disconnect from 213.228.116.181: 2:
&gt; Shared connection to 213.228.116.181 closed.
&gt; Without -N key
&gt; 
&gt; OpenSSH_5.3p1, OpenSSL 1.0.0-fips 29 Mar 2010
&gt; ...
&gt; debug2: channel 0: open confirm rwindow 12288 rmax 512
&gt; debug3: Wrote 432 bytes for a total of 1629
&gt; Received disconnect from 213.228.116.181: 2:
&gt; Shared connection to 213.228.116.181 closed.
</div>

So, it doesn&#39;t seem to be working without the -N flag either...


Maybe the remote machine can only handle channels requiring a tty:

   $ssh = Net::OpenSSH-&gt;new&#40;$host, master_opts =&gt; [qw&#40;-vvv&#41;]&#41;;
   $ssh-&gt;system&#40;{tty =&gt; 1}&#41;;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1535725" href="/Public/Bug/Display.html?id=107099#txn-1535725">#</a>      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;16&nbsp;03:18:49&nbsp;2015</span>
    <span class="description">madlord [...] list.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re[4]: [rt.cpan.org #107099] Connect with -N key</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 16 Sep 2015 10:18:25 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-OpenSSH [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Алексей Павлов &lt;madlord [...] list.ru&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1535725/819620/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/819620">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"> No, this not work.

With -N key

debug3: ssh_msg_send: type 2
debug2: fd 8 setting O_NONBLOCK
debug1: channel 1: new [client-session]
debug3: muxserver_accept_control: channel_new: 1
debug2: channel 1: send open
debug3: Wrote 56 bytes for a total of 1197
debug2: channel 0: open confirm rwindow 12288 rmax 512
Received disconnect from 213.228.116.181: 2:
Shared connection to 213.228.116.181 closed.

Without -N key
debug3: ssh_msg_send: type 2
debug2: fd 8 setting O_NONBLOCK
debug1: channel 1: new [client-session]
debug3: muxserver_accept_control: channel_new: 1
debug2: channel 1: send open
debug3: Wrote 56 bytes for a total of 1197
debug2: callback start
debug2: client_session2_setup: id 0
debug2: channel 0: request pty-req confirm 1
debug1: Sending environment.
debug3: Ignored env HOSTNAME
debug3: Ignored env TERM
debug3: Ignored env SHELL
debug3: Ignored env HISTSIZE
debug3: Ignored env SSH_CLIENT
debug3: Ignored env QTDIR
debug3: Ignored env OLDPWD
debug3: Ignored env QTINC
debug3: Ignored env SSH_TTY
debug3: Ignored env USER
debug3: Ignored env LS_COLORS
debug3: Ignored env MAIL
debug3: Ignored env PATH
debug3: Ignored env PWD
debug1: Sending env LANG = ru_RU.KOI8-R
debug2: channel 0: request env confirm 0
debug3: Ignored env HISTCONTROL
debug3: Ignored env SHLVL
debug3: Ignored env HOME
debug3: Ignored env LOGNAME
debug3: Ignored env QTLIB
debug3: Ignored env CVS_RSH
debug3: Ignored env SSH_CONNECTION
debug3: Ignored env LESSOPEN
debug3: Ignored env G_BROKEN_FILENAMES
debug3: Ignored env _
debug2: channel 0: request shell confirm 1
debug2: fd 3 setting TCP_NODELAY
debug2: callback done
debug2: channel 0: open confirm rwindow 12288 rmax 512
debug3: Wrote 432 bytes for a total of 1629
Received disconnect from 213.228.116.181: 2:
Shared connection to 213.228.116.181 closed.
Simply, if connect with this:
ssh -o StrictHostKeyChecking=no -o ServerAliveInterval=20  -vvv -p 22 host
work ok
if connect with this:
ssh -o StrictHostKeyChecking=no -o ServerAliveInterval=20 -vvv -N -p 22 host
no data from host and connection not closed by timeout

debug1: Authentication succeeded &#40;none&#41;.
debug1: channel 0: new [client-session]
debug3: ssh_session2_open: channel_new: 0
debug2: channel 0: send open
debug1: Entering interactive session.
debug3: Wrote 56 bytes for a total of 1141
debug2: channel 0: open confirm rwindow 12288 rmax 512
debug3: Wrote 56 bytes for a total of 1197
debug3: Wrote 56 bytes for a total of 1253
debug3: Wrote 56 bytes for a total of 1309
debug3: Wrote 56 bytes for a total of 1365
......

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;Вторник, 15 сентября 2015, 7:34 -04:00 от &#34;Salvador \&#34;Fandiño\&#34; via RT&#34; &lt; bug-Net-OpenSSH@rt.cpan.org &gt;:
&gt;
&gt;&lt;URL:  <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=107099">https://rt.cpan.org/Ticket/Display.html?id=107099</a></span> &gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;----- Original Message -----
<div class="message-stanza open">&gt;&gt; From: Алексей Павлов via RT &lt; bug-Net-OpenSSH@rt.cpan.org &gt;
&gt;&gt; To: 
&gt;&gt; Cc: 
&gt;&gt; Sent: Tuesday, September 15, 2015 1:03 PM
&gt;&gt; Subject: Re[2]: [rt.cpan.org #107099] Connect with -N key
&gt;&gt; 
&gt;&gt;        Queue: Net-OpenSSH
&gt;&gt; Ticket &lt;URL:  <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=107099">https://rt.cpan.org/Ticket/Display.html?id=107099</a></span> &gt;
&gt;&gt; 
&gt;&gt; /etc/ssh/ssh_config
&gt;&gt; 
&gt;&gt; Host *
&gt;&gt; GSSAPIAuthentication yes
&gt;&gt; SendEnv LANG LC_CTYPE LC_NUMERIC LC_TIME LC_COLLATE LC_MONETARY LC_MESSAGES
&gt;&gt; SendEnv LC_PAPER LC_NAME LC_ADDRESS LC_TELEPHONE LC_MEASUREMENT
&gt;&gt; SendEnv LC_IDENTIFICATION LC_ALL LANGUAGE
&gt;&gt; SendEnv XMODIFIERS
&gt;&gt; With -N key
&gt;&gt; 
&gt;&gt; OpenSSH_5.3p1, OpenSSL 1.0.0-fips 29 Mar 2010
&gt;&gt; ...
&gt;&gt; debug2: channel 0: open confirm rwindow 12288 rmax 512
&gt;&gt; Received disconnect from 213.228.116.181: 2:
&gt;&gt; Shared connection to 213.228.116.181 closed.
&gt;&gt; Without -N key
&gt;&gt; 
&gt;&gt; OpenSSH_5.3p1, OpenSSL 1.0.0-fips 29 Mar 2010
&gt;&gt; ...
&gt;&gt; debug2: channel 0: open confirm rwindow 12288 rmax 512
&gt;&gt; debug3: Wrote 432 bytes for a total of 1629
&gt;&gt; Received disconnect from 213.228.116.181: 2:
&gt;&gt; Shared connection to 213.228.116.181 closed.
</div>&gt;
&gt;
&gt;So, it doesn&#39;t seem to be working without the -N flag either...
&gt;
&gt;
&gt;Maybe the remote machine can only handle channels requiring a tty:
&gt;
&gt;   $ssh = Net::OpenSSH-&gt;new&#40;$host, master_opts =&gt; [qw&#40;-vvv&#41;]&#41;;
&gt;   $ssh-&gt;system&#40;{tty =&gt; 1}&#41;;
&gt;
</div>

С уважением, Павлов Алексей :-&#41;
ssh -o StrictHostKeyChecking=no -o ServerAliveInterval=20  -p 22 213.228.116.181
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1535725/819621/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/819621">with headers</a>
<br />
<span class="downloadcontenttype">text/html 5.3k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1535746" href="/Public/Bug/Display.html?id=107099#txn-1535746">#</a>      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;16&nbsp;04:59:48&nbsp;2015</span>
    <span class="description">sfandino [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: Re[4]: [rt.cpan.org #107099] Connect with -N key</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 16 Sep 2015 08:59:36 +0000 &#40;UTC&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Net-OpenSSH [...] rt.cpan.org&#34; &lt;bug-Net-OpenSSH [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Salvador Fandino &lt;sfandino [...] yahoo.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1535746/819633/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/819633">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 739b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">



<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">----- Original Message -----
<div class="message-stanza open">&gt; From: Алексей Павлов via RT &lt;bug-Net-OpenSSH@rt.cpan.org&gt;
&gt; To: 
&gt; Cc: 
&gt; Sent: Wednesday, September 16, 2015 9:18 AM
&gt; Subject: Re[4]: [rt.cpan.org #107099] Connect with -N key
</div>
<div class="message-stanza open">&gt; Simply, if connect with this:
&gt; ssh -o StrictHostKeyChecking=no -o ServerAliveInterval=20  -vvv -p 22 host
&gt; work ok
&gt; if connect with this:
&gt; ssh -o StrictHostKeyChecking=no -o ServerAliveInterval=20 -vvv -N -p 22 host
&gt; no data from host and connection not closed by timeout
</div>

Yes, but that is the expected behavior. Your problem is not the -N flag.

Can you post the output from the following command run from the command line:


  ssh -o StrictHostKeyChecking=no -o ServerAliveInterval=20  -vvv -p 22 host
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1535749" href="/Public/Bug/Display.html?id=107099#txn-1535749">#</a>      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;16&nbsp;05:12:10&nbsp;2015</span>
    <span class="description">madlord [...] list.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re[6]: [rt.cpan.org #107099] Connect with -N key</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 16 Sep 2015 12:11:46 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-OpenSSH [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Алексей Павлов &lt;madlord [...] list.ru&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1535749/819637/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/819637">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
When the &#34;Username:&#34; string is shown, i send Ctrl+C:


OpenSSH_5.3p1, OpenSSL 1.0.0-fips 29 Mar 2010
debug1: Reading configuration data /etc/ssh/ssh_config
debug1: Applying options for *
debug2: ssh_connect: needpriv 0
debug1: Connecting to 213.228.116.181 [213.228.116.181] port 22.
debug1: Connection established.
debug1: identity file /home/dslam/.ssh/identity type -1
debug1: identity file /home/dslam/.ssh/id_rsa type -1
debug1: identity file /home/dslam/.ssh/id_dsa type -1
debug1: Remote protocol version 2.0, remote software version 2.0.12
debug1: match: 2.0.12 pat 2.0.11*,2.0.12*
debug1: Enabling compatibility mode for protocol 2.0
debug1: Local version string SSH-2.0-OpenSSH_5.3
debug2: fd 3 setting O_NONBLOCK
debug1: SSH2_MSG_KEXINIT sent
debug3: Wrote 792 bytes for a total of 813
debug1: SSH2_MSG_KEXINIT received
debug2: kex_parse_kexinit: diffie-hellman-group-exchange-sha256,diffie-hellman-group-exchange-sha1,diffie-hellman-group14-sha1,diffie-hellman-group1-sha1
debug2: kex_parse_kexinit: ssh-rsa,ssh-dss
debug2: kex_parse_kexinit: aes128-ctr,aes192-ctr,aes256-ctr,arcfour256,arcfour128,aes128-cbc,3des-cbc,blowfish-cbc,cast128-cbc,aes192-cbc,aes256-cbc,arcfour,rijndael-cbc@lysator.liu.se
debug2: kex_parse_kexinit: aes128-ctr,aes192-ctr,aes256-ctr,arcfour256,arcfour128,aes128-cbc,3des-cbc,blowfish-cbc,cast128-cbc,aes192-cbc,aes256-cbc,arcfour,rijndael-cbc@lysator.liu.se
debug2: kex_parse_kexinit: hmac-md5,hmac-sha1,umac-64@openssh.com,hmac-ripemd160,hmac-ripemd160@openssh.com,hmac-sha1-96,hmac-md5-96
debug2: kex_parse_kexinit: hmac-md5,hmac-sha1,umac-64@openssh.com,hmac-ripemd160,hmac-ripemd160@openssh.com,hmac-sha1-96,hmac-md5-96
debug2: kex_parse_kexinit: none,zlib@openssh.com,zlib
debug2: kex_parse_kexinit: none,zlib@openssh.com,zlib
debug2: kex_parse_kexinit:
debug2: kex_parse_kexinit:
debug2: kex_parse_kexinit: first_kex_follows 0
debug2: kex_parse_kexinit: reserved 0
debug2: kex_parse_kexinit: diffie-hellman-group1-sha1
debug2: kex_parse_kexinit: ssh-dss
debug2: kex_parse_kexinit: 3des-cbc,blowfish-cbc
debug2: kex_parse_kexinit: 3des-cbc,blowfish-cbc
debug2: kex_parse_kexinit: hmac-sha1,hmac-md5
debug2: kex_parse_kexinit: hmac-sha1,hmac-md5
debug2: kex_parse_kexinit: none
debug2: kex_parse_kexinit: none
debug2: kex_parse_kexinit:
debug2: kex_parse_kexinit:
debug2: kex_parse_kexinit: first_kex_follows 0
debug2: kex_parse_kexinit: reserved 0
debug2: mac_setup: found hmac-md5
debug1: kex: server-&gt;client 3des-cbc hmac-md5 none
debug2: mac_setup: found hmac-md5
debug1: kex: client-&gt;server 3des-cbc hmac-md5 none
debug2: dh_gen_key: priv key bits set: 187/384
debug2: bits set: 510/1024
debug1: sending SSH2_MSG_KEXDH_INIT
debug1: expecting SSH2_MSG_KEXDH_REPLY
debug3: Wrote 144 bytes for a total of 957
debug3: check_host_in_hostfile: filename /home/dslam/.ssh/known_hosts2
debug3: check_host_in_hostfile: match line 1
debug1: Host &#39;213.228.116.181&#39; is known and matches the DSA host key.
debug1: Found key in /home/dslam/.ssh/known_hosts2:1
debug2: bits set: 538/1024
debug1: ssh_dss_verify: signature correct
debug2: kex_derive_keys
debug2: set_newkeys: mode 1
debug1: SSH2_MSG_NEWKEYS sent
debug1: expecting SSH2_MSG_NEWKEYS
debug3: Wrote 16 bytes for a total of 973
debug2: set_newkeys: mode 0
debug1: SSH2_MSG_NEWKEYS received
debug1: SSH2_MSG_SERVICE_REQUEST sent
debug3: Wrote 48 bytes for a total of 1021
debug2: buggy server: service_accept w/o service
debug1: SSH2_MSG_SERVICE_ACCEPT received
debug2: key: /home/dslam/.ssh/identity &#40;&#40;nil&#41;&#41;
debug2: key: /home/dslam/.ssh/id_rsa &#40;&#40;nil&#41;&#41;
debug2: key: /home/dslam/.ssh/id_dsa &#40;&#40;nil&#41;&#41;
debug3: Wrote 64 bytes for a total of 1085
debug1: Authentication succeeded &#40;none&#41;.
debug1: channel 0: new [client-session]
debug3: ssh_session2_open: channel_new: 0
debug2: channel 0: send open
debug1: Entering interactive session.
debug3: Wrote 56 bytes for a total of 1141
debug2: callback start
debug2: client_session2_setup: id 0
debug2: channel 0: request pty-req confirm 1
debug1: Sending environment.
debug3: Ignored env HOSTNAME
debug3: Ignored env TERM
debug3: Ignored env SHELL
debug3: Ignored env HISTSIZE
debug3: Ignored env SSH_CLIENT
debug3: Ignored env QTDIR
debug3: Ignored env OLDPWD
debug3: Ignored env QTINC
debug3: Ignored env SSH_TTY
debug3: Ignored env USER
debug3: Ignored env LS_COLORS
debug3: Ignored env MAIL
debug3: Ignored env PATH
debug3: Ignored env PWD
debug1: Sending env LANG = ru_RU.KOI8-R
debug2: channel 0: request env confirm 0
debug3: Ignored env HISTCONTROL
debug3: Ignored env SHLVL
debug3: Ignored env HOME
debug3: Ignored env LOGNAME
debug3: Ignored env QTLIB
debug3: Ignored env CVS_RSH
debug3: Ignored env SSH_CONNECTION
debug3: Ignored env LESSOPEN
debug3: Ignored env G_BROKEN_FILENAMES
debug3: Ignored env _
debug2: channel 0: request shell confirm 1
debug2: fd 3 setting TCP_NODELAY
debug2: callback done
debug2: channel 0: open confirm rwindow 12288 rmax 512
debug3: Wrote 432 bytes for a total of 1573
debug2: channel_input_status_confirm: type 99 id 0
debug2: PTY allocation request accepted on channel 0
************************************************************************
WARNING!
This is a private system, and is the property of Sibirtelecom JSC.
Access is restricted to authorized users and to authorized purposes.
Users &#40;authorized and unauthorized&#41; have no explicit or implicit
expectation of privacy.
Any or all uses of this system and all files on this system may be
intercepted, monitored, recorded, copied, audited, inspected, and
disclosed to authorized site, Sibirtelecom JSC, and law enforcement
personnel. By using this system, the user consents to such interception,
monitoring, recording, copying, auditing, inspection, and disclosure at
the discretion of authorized site or Sibirtelecom JSC personnel.
UNAUTHORIZED OR IMPROPER USE OF THIS SYSTEM MAY RESULT IN ADMINISTRATIVE
DISCIPLINARY ACTION AND CIVIL AND CRIMINAL PENALTIES.
By continuing to use this system you indicate your awareness of and
consent to these terms and conditions of use. LOG OFF IMMEDIATELY if you
do not agree to the condidebug2: channel_input_status_confirm: type 99 id 0
debug2: shell request accepted on channel 0
tions stated in this warning.
************************************************************************
Username: debug3: Wrote 40 bytes for a total of 1613
^C
debug2: channel 0: rcvd close
debug2: channel 0: output open -&gt; drain
debug2: channel 0: close_read
debug2: channel 0: input open -&gt; closed
debug3: channel 0: will not send data after close
debug2: channel 0: obuf empty
debug2: channel 0: close_write
debug2: channel 0: output drain -&gt; closed
debug2: channel 0: almost dead
debug2: channel 0: gc: notify user
debug2: channel 0: gc: user detached
debug2: channel 0: send close
debug2: channel 0: is dead
debug2: channel 0: garbage collecting
debug1: channel 0: free: client-session, nchannels 1
debug3: channel 0: status: The following connections are open:
#0 client-session &#40;t4 r5340 i3/0 o3/0 fd -1/-1 cfd -1&#41;
debug3: channel 0: close_fds r -1 w -1 e 6 c -1
debug3: Wrote 32 bytes for a total of 1645
debug3: Wrote 56 bytes for a total of 1701
Connection to 213.228.116.181 closed.
Transferred: sent 1536, received 2440 bytes, in 4.2 seconds
Bytes per second: sent 367.2, received 583.4
debug1: Exit status -1


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;Среда, 16 сентября 2015, 4:59 -04:00 от &#34;Salvador \&#34;Fandiño\&#34; via RT&#34; &lt;bug-Net-OpenSSH@rt.cpan.org&gt;:
&gt;
&gt;&lt;URL:  <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=107099">https://rt.cpan.org/Ticket/Display.html?id=107099</a></span> &gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;----- Original Message -----
<div class="message-stanza open">&gt;&gt; From: Алексей Павлов via RT &lt; bug-Net-OpenSSH@rt.cpan.org &gt;
&gt;&gt; To: 
&gt;&gt; Cc: 
&gt;&gt; Sent: Wednesday, September 16, 2015 9:18 AM
&gt;&gt; Subject: Re[4]: [rt.cpan.org #107099] Connect with -N key
</div>&gt;
<div class="message-stanza open">&gt;&gt; Simply, if connect with this:
&gt;&gt; ssh -o StrictHostKeyChecking=no -o ServerAliveInterval=20  -vvv -p 22 host
&gt;&gt; work ok
&gt;&gt; if connect with this:
&gt;&gt; ssh -o StrictHostKeyChecking=no -o ServerAliveInterval=20 -vvv -N -p 22 host
&gt;&gt; no data from host and connection not closed by timeout
</div>&gt;
&gt;
&gt;Yes, but that is the expected behavior. Your problem is not the -N flag.
&gt;
&gt;Can you post the output from the following command run from the command line:
&gt;
&gt;
&gt;  ssh -o StrictHostKeyChecking=no -o ServerAliveInterval=20  -vvv -p 22 host
&gt;
</div>

С уважением, Павлов Алексей :-&#41;
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1535749/819638/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/819638">with headers</a>
<br />
<span class="downloadcontenttype">text/html 9.3k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1535768" href="/Public/Bug/Display.html?id=107099#txn-1535768">#</a>      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;16&nbsp;06:45:43&nbsp;2015</span>
    <span class="description">sfandino [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: Re[6]: [rt.cpan.org #107099] Connect with -N key</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 16 Sep 2015 10:45:20 +0000 &#40;UTC&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Net-OpenSSH [...] rt.cpan.org&#34; &lt;bug-Net-OpenSSH [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Salvador Fandino &lt;sfandino [...] yahoo.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1535768/819650/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/819650">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 316b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">And finally, can you also post the full debugging output for


  $ssh = Net::OpenSSH-&gt;new&#40;$host, master_opts =&gt; [qw&#40;-vvv&#41;]&#41;;
  $ssh-&gt;system&#40;{tty =&gt; 1}&#41;;

Because, this should be equivalent to the previous command and it should work.

In case it doesn&#39;t, looking at the differences may hopefully allow us to see why.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1535771" href="/Public/Bug/Display.html?id=107099#txn-1535771">#</a>      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;16&nbsp;06:54:49&nbsp;2015</span>
    <span class="description">madlord [...] list.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re[8]: [rt.cpan.org #107099] Connect with -N key</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 16 Sep 2015 13:54:19 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-OpenSSH [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Алексей Павлов &lt;madlord [...] list.ru&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1535771/819654/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/819654">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 12.4k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1535771/819655/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/819655">with headers</a>
<br />
<span class="downloadcontenttype">text/html 13.8k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1535794" href="/Public/Bug/Display.html?id=107099#txn-1535794">#</a>      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;16&nbsp;08:45:38&nbsp;2015</span>
    <span class="description">sfandino [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: Re[8]: [rt.cpan.org #107099] Connect with -N key</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 16 Sep 2015 12:45:29 +0000 &#40;UTC&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Net-OpenSSH [...] rt.cpan.org&#34; &lt;bug-Net-OpenSSH [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Salvador Fandino &lt;sfandino [...] yahoo.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1535794/819669/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/819669">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 294b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">

1&#41; Can you ensure you are using a clean version of Net::OpenSSH as downloaded from CPAN, without any modifications.

2&#41; It looks as if the traces &#40;from the ssh command run at the terminal and from Net::OpenSSH&#41; were from different machines. Could you run both proves in the same environment?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1535993" href="/Public/Bug/Display.html?id=107099#txn-1535993">#</a>      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;16&nbsp;23:58:40&nbsp;2015</span>
    <span class="description">madlord [...] list.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re[10]: [rt.cpan.org #107099] Connect with -N key</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 17 Sep 2015 06:58:21 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-OpenSSH [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Алексей Павлов &lt;madlord [...] list.ru&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1535993/819759/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/819759">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 12.6k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1535993/819760/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/819760">with headers</a>
<br />
<span class="downloadcontenttype">text/html 14.1k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1536077" href="/Public/Bug/Display.html?id=107099#txn-1536077">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;17&nbsp;04:43:42&nbsp;2015</span>
    <span class="description">sfandino [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: Re[10]: [rt.cpan.org #107099] Connect with -N key</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 17 Sep 2015 08:43:19 +0000 &#40;UTC&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Net-OpenSSH [...] rt.cpan.org&#34; &lt;bug-Net-OpenSSH [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Salvador Fandino &lt;sfandino [...] yahoo.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1536077/819805/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/819805">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 833b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">



<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">----- Original Message -----
<div class="message-stanza open">&gt; From: Алексей Павлов via RT &lt;bug-Net-OpenSSH@rt.cpan.org&gt;
&gt; To: 
&gt; Cc: 
&gt; Sent: Thursday, September 17, 2015 5:58 AM
&gt; Subject: Re[10]: [rt.cpan.org #107099] Connect with -N key
&gt; 
&gt;        Queue: Net-OpenSSH
&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=107099">https://rt.cpan.org/Ticket/Display.html?id=107099</a></span> &gt;
&gt; 
&gt; 1&#41; I now install last version &#40;0.64&#41; from CPAN. No any modifications
&gt; 2&#41; No, ssh client and Net::OpenSSH script run on same machine &#40;Linux hostname 
&gt; 2.6.32-358.el6.x86_64 #1 SMP Tue Jan 29 11:47:41 EST 2013 x86_64 x86_64 x86_64 
&gt; GNU/Linux&#41; and environment witn this packages:
</div>

There are subtle differences between both traces... oh, wait, could your server be accepting SSH v1 only?

Does the following command work?

  ssh -2 -o StrictHostKeyChecking=no -o ServerAliveInterval=20  -vvv -p 22 host
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1536080" href="/Public/Bug/Display.html?id=107099#txn-1536080">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;17&nbsp;05:24:35&nbsp;2015</span>
    <span class="description">madlord [...] list.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re[12]: [rt.cpan.org #107099] Connect with -N key</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 17 Sep 2015 12:24:21 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-OpenSSH [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Алексей Павлов &lt;madlord [...] list.ru&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1536080/819809/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/819809">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"> Yes, this command work. From previous my answer:
debug1: Remote protocol version 2.0, remote software version 2.0.12
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;Четверг, 17 сентября 2015, 4:43 -04:00 от &#34;Salvador \&#34;Fandiño\&#34; via RT&#34; &lt;bug-Net-OpenSSH@rt.cpan.org&gt;:
&gt;
&gt;&lt;URL:  <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=107099">https://rt.cpan.org/Ticket/Display.html?id=107099</a></span> &gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;----- Original Message -----
<div class="message-stanza open">&gt;&gt; From: Алексей Павлов via RT &lt; bug-Net-OpenSSH@rt.cpan.org &gt;
&gt;&gt; To: 
&gt;&gt; Cc: 
&gt;&gt; Sent: Thursday, September 17, 2015 5:58 AM
&gt;&gt; Subject: Re[10]: [rt.cpan.org #107099] Connect with -N key
&gt;&gt; 
&gt;&gt;        Queue: Net-OpenSSH
&gt;&gt; Ticket &lt;URL:  <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=107099">https://rt.cpan.org/Ticket/Display.html?id=107099</a></span> &gt;
&gt;&gt; 
&gt;&gt; 1&#41; I now install last version &#40;0.64&#41; from CPAN. No any modifications
&gt;&gt; 2&#41; No, ssh client and Net::OpenSSH script run on same machine &#40;Linux hostname 
&gt;&gt; 2.6.32-358.el6.x86_64 #1 SMP Tue Jan 29 11:47:41 EST 2013 x86_64 x86_64 x86_64 
&gt;&gt; GNU/Linux&#41; and environment witn this packages:
</div>&gt;
&gt;
&gt;There are subtle differences between both traces... oh, wait, could your server be accepting SSH v1 only?
&gt;
&gt;Does the following command work?
&gt;
&gt;  ssh -2 -o StrictHostKeyChecking=no -o ServerAliveInterval=20  -vvv -p 22 host
&gt;
</div>

С уважением, Павлов Алексей :-&#41;
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1536080/819810/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/819810">with headers</a>
<br />
<span class="downloadcontenttype">text/html 2.1k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1536091" href="/Public/Bug/Display.html?id=107099#txn-1536091">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;17&nbsp;06:27:19&nbsp;2015</span>
    <span class="description">sfandino [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: Re[12]: [rt.cpan.org #107099] Connect with -N key</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 17 Sep 2015 10:24:21 +0000 &#40;UTC&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Net-OpenSSH [...] rt.cpan.org&#34; &lt;bug-Net-OpenSSH [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Salvador Fandino &lt;sfandino [...] yahoo.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1536091/819821/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/819821">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">



<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">----- Original Message -----
<div class="message-stanza open">&gt; From: Алексей Павлов via RT &lt;bug-Net-OpenSSH@rt.cpan.org&gt;
&gt; To: 
&gt; Cc: 
&gt; Sent: Thursday, September 17, 2015 11:24 AM
&gt; Subject: Re[12]: [rt.cpan.org #107099] Connect with -N key
&gt; 
&gt;        Queue: Net-OpenSSH
&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=107099">https://rt.cpan.org/Ticket/Display.html?id=107099</a></span> &gt;
&gt; 
&gt; Yes, this command work. From previous my answer:
</div>
<div class="message-stanza open">&gt; debug1: Remote protocol version 2.0, remote software version 2.0.12
</div>
Yes, but OpenSSH has several workarounds inside for servers that do not implement the protocol correctly and forcing v2 could be disabling some.

Anyway, after looking at all the traces you have posted I am pretty sure the real problem is that the remote server doesn&#39;t accept running more than one channel concurrently per SSH connection.

Just to ensure that this is the case, could you run the following script:

  use Net::OpenSSH;
  $Net::OpenSSH::debug=-1;
  $ssh = Net::OpenSSH-&gt;new&#40;localhost, master_opts =&gt; [qw&#40;-vvv&#41;]&#41;;
  warn &#34;hello!&#34;;
  sleep 4;
  warn &#34;bye!&#34;;
  $ssh-&gt;system&#40;&#34;exit&#34;&#41;

If that hypothesis turns to be true, then Net::OpenSSH can&#39;t not be made to work because it requires multiple channels.

Maybe you could use my other module Net::SSH::Any &#40;go for the development version in GitHub 
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/salva/p5-Net-SSH-Any&#41;">https://github.com/salva/p5-Net-SSH-Any&#41;</a></span> whose usage is pretty similar to that of Net::OpenSSH, or Net::SSH2 &#40;ensure you get the latest development version 0.54_02&#41;.

Also, there are several modules on CPAN specific for talking to network equipment.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1536094" href="/Public/Bug/Display.html?id=107099#txn-1536094">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;17&nbsp;06:42:23&nbsp;2015</span>
    <span class="description">madlord [...] list.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re[14]: [rt.cpan.org #107099] Connect with -N key</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 17 Sep 2015 13:42:00 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-OpenSSH [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Алексей Павлов &lt;madlord [...] list.ru&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1536094/819825/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/819825">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 9.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"> &#34;remote server doesn&#39;t accept running more than one channel concurrently per SSH connection&#34;
Yes, i think about it. But don`t know how to check this. May be this check can be realize in Net::OpenSSH?

Result:

# open_ex: [&#39;ssh&#39;,&#39;-V&#39;]
# io3 mloop, cin: 0, cout: 1, cerr: 0
# io3 fast, cin: 0, cout: 1, cerr: 0
# stdout, bytes read: 46 at offset 0
#&gt; 4f 70 65 6e 53 53 48 5f 35 2e 33 70 31 2c 20 4f 70 65 6e 53 53 4c 20 31 2e 30 2e 30 2d 66 69 70 | OpenSSH_5.3p1, OpenSSL 1.0.0-fip
#&gt; 73 20 32 39 20 4d 61 72 20 32 30 31 30 0a | s 29 Mar 2010.
# io3 fast, cin: 0, cout: 1, cerr: 0
# stdout, bytes read: 0 at offset 46
# leaving _io3&#40;&#41;
# _waitpid&#40;3317&#41; =&gt; pid: 3317, rc: 0, err:
# OpenSSH verion is 5.3p1,
# ctl_path: /home/dslam/.libnet-openssh-perl/213.228.116.181-3316-998411, ctl_dir: /home/dslam/.libnet-openssh-perl/
# _is_secure_path&#40;dir: /home/dslam/.libnet-openssh-perl, file mode: 16877, file uid: 1056, euid: 1056
# _is_secure_path&#40;dir: /home/dslam, file mode: 16877, file uid: 1056, euid: 1056
# set_error&#40;0 - 0&#41;
# call args: [&#39;ssh&#39;,&#39;-vvvv&#39;,&#39;-o&#39;,&#39;ServerAliveInterval=20&#39;,&#39;-2MNx&#39;,&#39;-S&#39;,&#39;/home/dslam/.libnet-openssh-perl/213.228.116.181-3316-998411&#39;,&#39;213.228.116.181&#39;,&#39;--&#39;]
# master state jumping from _STATE_START to _STATE_AWAITING_MUX
# file object not yet found at /home/dslam/.libnet-openssh-perl/213.228.116.181-3316-998411, state:_STATE_AWAITING_MUX
# file object not yet found at /home/dslam/.libnet-openssh-perl/213.228.116.181-3316-998411, state:_STATE_AWAITING_MUX
# file object not yet found at /home/dslam/.libnet-openssh-perl/213.228.116.181-3316-998411, state:_STATE_AWAITING_MUX
# file object not yet found at /home/dslam/.libnet-openssh-perl/213.228.116.181-3316-998411, state:_STATE_AWAITING_MUX
# file object not yet found at /home/dslam/.libnet-openssh-perl/213.228.116.181-3316-998411, state:_STATE_AWAITING_MUX
# file object not yet found at /home/dslam/.libnet-openssh-perl/213.228.116.181-3316-998411, state:_STATE_AWAITING_MUX
# tracer attached, ssh pid: 3318, tracer pid: 3319
OpenSSH_5.3p1, OpenSSL 1.0.0-fips 29 Mar 2010
debug1: Reading configuration data /etc/ssh/ssh_config
debug1: Applying options for *
debug2: ssh_connect: needpriv 0
debug1: Connecting to 213.228.116.181 [213.228.116.181] port 22.
debug1: Connection established.
debug1: identity file /home/dslam/.ssh/id_rsa type -1
debug1: identity file /home/dslam/.ssh/id_dsa type -1
debug1: Remote protocol version 2.0, remote software version 2.0.12
debug1: match: 2.0.12 pat 2.0.11*,2.0.12*
debug1: Enabling compatibility mode for protocol 2.0
debug1: Local version string SSH-2.0-OpenSSH_5.3
debug2: fd 3 setting O_NONBLOCK
debug1: SSH2_MSG_KEXINIT sent
debug3: Wrote 792 bytes for a total of 813
debug1: SSH2_MSG_KEXINIT received
debug2: kex_parse_kexinit: diffie-hellman-group-exchange-sha256,diffie-hellman-group-exchange-sha1,diffie-hellman-group14-sha1,diffie-hellman-group1-sha1
debug2: kex_parse_kexinit: ssh-rsa,ssh-dss
debug2: kex_parse_kexinit: aes128-ctr,aes192-ctr,aes256-ctr,arcfour256,arcfour128,aes128-cbc,3des-cbc,blowfish-cbc,cast128-cbc,aes192-cbc,aes256-cbc,arcfour,rijndael-cbc@lysator.liu.se
debug2: kex_parse_kexinit: aes128-ctr,aes192-ctr,aes256-ctr,arcfour256,arcfour128,aes128-cbc,3des-cbc,blowfish-cbc,cast128-cbc,aes192-cbc,aes256-cbc,arcfour,rijndael-cbc@lysator.liu.se
debug2: kex_parse_kexinit: hmac-md5,hmac-sha1,umac-64@openssh.com,hmac-ripemd160,hmac-ripemd160@openssh.com,hmac-sha1-96,hmac-md5-96
debug2: kex_parse_kexinit: hmac-md5,hmac-sha1,umac-64@openssh.com,hmac-ripemd160,hmac-ripemd160@openssh.com,hmac-sha1-96,hmac-md5-96
debug2: kex_parse_kexinit: none,zlib@openssh.com,zlib
debug2: kex_parse_kexinit: none,zlib@openssh.com,zlib
debug2: kex_parse_kexinit:
debug2: kex_parse_kexinit:
debug2: kex_parse_kexinit: first_kex_follows 0
debug2: kex_parse_kexinit: reserved 0
debug2: kex_parse_kexinit: diffie-hellman-group1-sha1
debug2: kex_parse_kexinit: ssh-dss
debug2: kex_parse_kexinit: 3des-cbc,blowfish-cbc
debug2: kex_parse_kexinit: 3des-cbc,blowfish-cbc
debug2: kex_parse_kexinit: hmac-sha1,hmac-md5
debug2: kex_parse_kexinit: hmac-sha1,hmac-md5
debug2: kex_parse_kexinit: none
debug2: kex_parse_kexinit: none
debug2: kex_parse_kexinit:
debug2: kex_parse_kexinit:
debug2: kex_parse_kexinit: first_kex_follows 0
debug2: kex_parse_kexinit: reserved 0
debug2: mac_setup: found hmac-md5
debug1: kex: server-&gt;client 3des-cbc hmac-md5 none
debug2: mac_setup: found hmac-md5
debug1: kex: client-&gt;server 3des-cbc hmac-md5 none
debug2: dh_gen_key: priv key bits set: 193/384
debug2: bits set: 530/1024
debug1: sending SSH2_MSG_KEXDH_INIT
debug1: expecting SSH2_MSG_KEXDH_REPLY
debug3: Wrote 144 bytes for a total of 957
debug3: check_host_in_hostfile: filename /home/dslam/.ssh/known_hosts2
debug3: check_host_in_hostfile: match line 1
debug1: Host &#39;213.228.116.181&#39; is known and matches the DSA host key.
debug1: Found key in /home/dslam/.ssh/known_hosts2:1
debug2: bits set: 530/1024
debug1: ssh_dss_verify: signature correct
debug2: kex_derive_keys
debug2: set_newkeys: mode 1
debug1: SSH2_MSG_NEWKEYS sent
debug1: expecting SSH2_MSG_NEWKEYS
debug3: Wrote 16 bytes for a total of 973
debug2: set_newkeys: mode 0
debug1: SSH2_MSG_NEWKEYS received
debug1: SSH2_MSG_SERVICE_REQUEST sent
debug3: Wrote 48 bytes for a total of 1021
debug2: buggy server: service_accept w/o service
debug1: SSH2_MSG_SERVICE_ACCEPT received
debug2: key: /home/dslam/.ssh/id_rsa &#40;&#40;nil&#41;&#41;
debug2: key: /home/dslam/.ssh/id_dsa &#40;&#40;nil&#41;&#41;
debug3: Wrote 64 bytes for a total of 1085
debug1: Authentication succeeded &#40;none&#41;.
debug1: channel 0: new [client-session]
debug3: ssh_session2_open: channel_new: 0
debug2: channel 0: send open
debug1: setting up multiplex master socket
debug2: fd 7 setting O_NONBLOCK
debug1: Entering interactive session.
debug3: Wrote 56 bytes for a total of 1141
# file object found at /home/dslam/.libnet-openssh-perl/213.228.116.181-3316-998411
# master state jumping from _STATE_AWAITING_MUX to _STATE_RUNNING
# call args: [&#39;ssh&#39;,&#39;-O&#39;,&#39;check&#39;,&#39;-T&#39;,&#39;-S&#39;,&#39;/home/dslam/.libnet-openssh-perl/213.228.116.181-3316-998411&#39;,&#39;213.228.116.181&#39;,&#39;--&#39;]
# open_ex: [&#39;ssh&#39;,&#39;-O&#39;,&#39;check&#39;,&#39;-T&#39;,&#39;-S&#39;,&#39;/home/dslam/.libnet-openssh-perl/213.228.116.181-3316-998411&#39;,&#39;213.228.116.181&#39;,&#39;--&#39;]
# io3 mloop, cin: 0, cout: 1, cerr: 0
# io3 fast, cin: 0, cout: 1, cerr: 0
debug3: fd 8 is not O_NONBLOCK
debug3: ssh_msg_recv entering
debug3: ssh_msg_send: type 2
# stdout, bytes read: 27 at offset 0
#&gt; 4d 61 73 74 65 72 20 72 75 6e 6e 69 6e 67 20 28 70 69 64 3d 33 33 31 38 29 0d 0a | Master running &#40;pid=3318&#41;..
# io3 fast, cin: 0, cout: 1, cerr: 0
# stdout, bytes read: 0 at offset 27
# leaving _io3&#40;&#41;
# _waitpid&#40;3322&#41; =&gt; pid: 3322, rc: 0, err:
hello! at testssh.pl line 43.
debug2: channel 0: open confirm rwindow 12288 rmax 512
bye! at testssh.pl line 45.
# call args: [&#39;ssh&#39;,&#39;-S&#39;,&#39;/home/dslam/.libnet-openssh-perl/213.228.116.181-3316-998411&#39;,&#39;213.228.116.181&#39;,&#39;--&#39;,&#39;exit&#39;]
# open_ex: [&#39;ssh&#39;,&#39;-S&#39;,&#39;/home/dslam/.libnet-openssh-perl/213.228.116.181-3316-998411&#39;,&#39;213.228.116.181&#39;,&#39;--&#39;,&#39;exit&#39;]
debug3: fd 8 is not O_NONBLOCK
debug3: ssh_msg_recv entering
debug3: ssh_msg_send: type 2
debug3: ssh_msg_recv entering
debug3: muxserver_accept_control: receiving 1 env vars
debug2: muxserver_accept_control: accepted tty 0, subsys 0, cmd exit
debug2: muxserver_accept_control: got fds stdin 9, stdout 10, stderr 11
debug3: ssh_msg_send: type 2
debug2: fd 8 setting O_NONBLOCK
debug1: channel 1: new [client-session]
debug3: muxserver_accept_control: channel_new: 1
debug2: channel 1: send open
debug3: Wrote 56 bytes for a total of 1197
Received disconnect from 213.228.116.181: 2:
# _waitpid&#40;3325&#41; =&gt; pid: 3325, rc: 65280, err: Прерван системный вызов
# set_error&#40;5 - child exited with code 255&#41;
# DESTROY&#40;Net::OpenSSH=HASH&#40;0x2b583d8&#41;, pid: 3318&#41;
# sending exit control to master
# master 3318 exited, rc:65280, err:
# set_error&#40;1 - control command failed: master process exited unexpectedly&#41;
# master state jumping from _STATE_RUNNING to _STATE_GONE
# master state jumping from _STATE_GONE to _STATE_GONE

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;Четверг, 17 сентября 2015, 6:27 -04:00 от &#34;Salvador \&#34;Fandiño\&#34; via RT&#34; &lt;bug-Net-OpenSSH@rt.cpan.org&gt;:
&gt;
&gt;&lt;URL:  <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=107099">https://rt.cpan.org/Ticket/Display.html?id=107099</a></span> &gt;
&gt;
&gt;
&gt;
&gt;
&gt;
&gt;----- Original Message -----
<div class="message-stanza open">&gt;&gt; From: Алексей Павлов via RT &lt; bug-Net-OpenSSH@rt.cpan.org &gt;
&gt;&gt; To: 
&gt;&gt; Cc: 
&gt;&gt; Sent: Thursday, September 17, 2015 11:24 AM
&gt;&gt; Subject: Re[12]: [rt.cpan.org #107099] Connect with -N key
&gt;&gt; 
&gt;&gt;        Queue: Net-OpenSSH
&gt;&gt; Ticket &lt;URL:  <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=107099">https://rt.cpan.org/Ticket/Display.html?id=107099</a></span> &gt;
&gt;&gt; 
&gt;&gt; Yes, this command work. From previous my answer:
</div>&gt;
<div class="message-stanza open">&gt;&gt; debug1: Remote protocol version 2.0, remote software version 2.0.12
</div>&gt;
&gt;Yes, but OpenSSH has several workarounds inside for servers that do not implement the protocol correctly and forcing v2 could be disabling some.
&gt;
&gt;Anyway, after looking at all the traces you have posted I am pretty sure the real problem is that the remote server doesn&#39;t accept running more than one channel concurrently per SSH connection.
&gt;
&gt;Just to ensure that this is the case, could you run the following script:
&gt;
&gt;  use Net::OpenSSH;
&gt;  $Net::OpenSSH::debug=-1;
&gt;  $ssh = Net::OpenSSH-&gt;new&#40;localhost, master_opts =&gt; [qw&#40;-vvv&#41;]&#41;;
&gt;  warn &#34;hello!&#34;;
&gt;  sleep 4;
&gt;  warn &#34;bye!&#34;;
&gt;  $ssh-&gt;system&#40;&#34;exit&#34;&#41;
&gt;
&gt;If that hypothesis turns to be true, then Net::OpenSSH can&#39;t not be made to work because it requires multiple channels.
&gt;
&gt;Maybe you could use my other module Net::SSH::Any &#40;go for the development version in GitHub 
&gt;<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/salva/p5-Net-SSH-Any">https://github.com/salva/p5-Net-SSH-Any</a></span> &#41; whose usage is pretty similar to that of Net::OpenSSH, or Net::SSH2 &#40;ensure you get the latest development version 0.54_02&#41;.
&gt;
&gt;Also, there are several modules on CPAN specific for talking to network equipment.
&gt;
</div>

С уважением, Павлов Алексей :-&#41;
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1536094/819826/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/819826">with headers</a>
<br />
<span class="downloadcontenttype">text/html 11.1k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1536098" href="/Public/Bug/Display.html?id=107099#txn-1536098">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;17&nbsp;06:56:44&nbsp;2015</span>
    <span class="description">sfandino [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: Re[14]: [rt.cpan.org #107099] Connect with -N key</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 17 Sep 2015 10:53:40 +0000 &#40;UTC&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Net-OpenSSH [...] rt.cpan.org&#34; &lt;bug-Net-OpenSSH [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Salvador Fandino &lt;sfandino [...] yahoo.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1536098/819830/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/819830">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 831b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">



<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">----- Original Message -----
<div class="message-stanza open">&gt; From: Алексей Павлов via RT &lt;bug-Net-OpenSSH@rt.cpan.org&gt;
&gt; To: 
&gt; Cc: 
&gt; Sent: Thursday, September 17, 2015 12:42 PM
&gt; Subject: Re[14]: [rt.cpan.org #107099] Connect with -N key
&gt; 
&gt;        Queue: Net-OpenSSH
&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=107099">https://rt.cpan.org/Ticket/Display.html?id=107099</a></span> &gt;
&gt; 
&gt; &#34;remote server doesn&#39;t accept running more than one channel 
&gt; concurrently per SSH connection&#34;
&gt; Yes, i think about it. But don`t know how to check this. May be this check can 
&gt; be realize in Net::OpenSSH?
&gt; 
&gt; Result:
&gt; 
&gt; # open_ex: [&#39;ssh&#39;,&#39;-V&#39;]
</div>
<div class="message-stanza open">&gt;...
&gt; debug2: channel 1: send open&gt; debug3: Wrote 56 bytes for a total of 1197
</div>
<div class="message-stanza open">&gt; Received disconnect from 213.228.116.181: 2:
</div>
It is pretty obvious the problem is that. As soon as a second channel is requested the remote side drops the connection.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1537182" href="/Public/Bug/Display.html?id=107099#txn-1537182">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;21&nbsp;05:21:06&nbsp;2015</span>
    <span class="description">salva [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1537182/820447/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/820447">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 555b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
<div class="message-stanza open">&gt; &gt; Received disconnect from 213.228.116.181: 2:
</div>&gt; 
&gt; It is pretty obvious the problem is that. As soon as a second channel
&gt; is requested the remote side drops the connection.
</div>
I have found that OpenSSH has a work around for that particular version of SSH used on the server. It opens a dummy channel upon connection. We could try disabling that work around, but that would mean patching OpenSSH.

So, would you be able to compile a patched ssh client and use it to run some tests against your network equipment if I send you the patch for OpenSSH?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1537184" href="/Public/Bug/Display.html?id=107099#txn-1537184">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;21&nbsp;05:36:46&nbsp;2015</span>
    <span class="description">madlord [...] list.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #107099] Connect with -N key</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 21 Sep 2015 12:36:29 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-OpenSSH [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Алексей Павлов &lt;madlord [...] list.ru&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1537184/820450/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/820450">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 836b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"> Yes, i can.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;Понедельник, 21 сентября 2015, 5:21 -04:00 от &#34;Salvador Fandino Garcia via RT&#34; &lt;bug-Net-OpenSSH@rt.cpan.org&gt;:
&gt;
&gt;&lt;URL:  <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=107099">https://rt.cpan.org/Ticket/Display.html?id=107099</a></span> &gt;
&gt;
&gt;
<div class="message-stanza open">&gt;&gt; 
<div class="message-stanza open">&gt;&gt; &gt; Received disconnect from 213.228.116.181: 2:
</div>&gt;&gt; 
&gt;&gt; It is pretty obvious the problem is that. As soon as a second channel
&gt;&gt; is requested the remote side drops the connection.
</div>&gt;
&gt;I have found that OpenSSH has a work around for that particular version of SSH used on the server. It opens a dummy channel upon connection. We could try disabling that work around, but that would mean patching OpenSSH.
&gt;
&gt;So, would you be able to compile a patched ssh client and use it to run some tests against your network equipment if I send you the patch for OpenSSH?
&gt;
&gt;
</div>

С уважением, Павлов Алексей :-&#41;
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1537184/820451/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/820451">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.4k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1537189" href="/Public/Bug/Display.html?id=107099#txn-1537189">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;21&nbsp;06:06:05&nbsp;2015</span>
    <span class="description">salva [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1537189/820455/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/820455">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 685b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Sep 21 05:36:46 2015, madlord@list.ru wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Yes, i can.
</div>
Ok, here it goes.

You will have to download the openssh package from some mirror &#40;i.e. <span class="clickylink"><a target="new" rel="nofollow" href="http://mirror.internode.on.net/pub/OpenBSD/OpenSSH/portable/openssh-7.1p1.tar.gz&#41;">http://mirror.internode.on.net/pub/OpenBSD/OpenSSH/portable/openssh-7.1p1.tar.gz&#41;</a></span> and apply the attached patch to ssh.c, run configure and make, prepend the full path for the openssh-7.1p1 directory to $PATH so that the patched version of ssh is found first, and then run again the following perl script:

  use Net::OpenSSH;
  $Net::OpenSSH::debug = -1;
  $ssh = Net::OpenSSH-&gt;new&#40;$host, master_opts =&gt; [qw&#40;-vvv&#41;]&#41;;
  $ssh-&gt;system&#40;{tty =&gt; 1}&#41;;

Does it work?

If it does I will write a more elaborated patch and send it upstream.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1537191" href="/Public/Bug/Display.html?id=107099#txn-1537191">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;21&nbsp;06:08:44&nbsp;2015</span>
    <span class="description">salva [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1537191/820458/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/820458">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 169b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Sep 21 06:06:05 2015, SALVA wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon Sep 21 05:36:46 2015, madlord@list.ru wrote:
<div class="message-stanza open">&gt; &gt; Yes, i can.
</div>&gt; 
&gt; Ok, here it goes.
</div>
And now, with the actual patch!
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> ssh.c.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1537191/820459/ssh.c.patch">Download ssh.c.patch</a><br />
<span class="downloadcontenttype">text/x-diff 596b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- ssh.c~	2015-08-21 06:49:03.000000000 +0200
+++ ssh.c	2015-09-21 11:57:51.462905891 +0200
@@ -1896,9 +1896,11 @@
 	if &#40;options.control_persist &#38;&#38; muxserver_sock == -1&#41;
 		ssh_init_stdio_forwarding&#40;&#41;;
 
-	if &#40;!no_shell_flag || &#40;datafellows &#38; SSH_BUG_DUMMYCHAN&#41;&#41;
+	if &#40;!no_shell_flag&#41; /* || &#40;datafellows &#38; SSH_BUG_DUMMYCHAN&#41;&#41; */
 		id = ssh_session2_open&#40;&#41;;
 	else {
+		if &#40;datafellows &#38; SSH_BUG_DUMMYCHAN&#41;
+			debug&#40;&#34;Skipping work around for bug dummychan&#34;&#41;;
 		packet_set_interactive&#40;
 		    options.control_master == SSHCTL_MASTER_NO,
 		    options.ip_qos_interactive, options.ip_qos_bulk&#41;;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1537193" href="/Public/Bug/Display.html?id=107099#txn-1537193">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;21&nbsp;06:19:45&nbsp;2015</span>
    <span class="description">madlord [...] list.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #107099] Connect with -N key</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 21 Sep 2015 13:19:30 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-OpenSSH [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Алексей Павлов &lt;madlord [...] list.ru&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1537193/820462/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/820462">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"> Can i use ssh_cmd option of Net::OpenSSH instead full path in $PATH?


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;Понедельник, 21 сентября 2015, 6:06 -04:00 от &#34;Salvador Fandino Garcia via RT&#34; &lt;bug-Net-OpenSSH@rt.cpan.org&gt;:
&gt;
&gt;&lt;URL:  <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=107099">https://rt.cpan.org/Ticket/Display.html?id=107099</a></span> &gt;
&gt;
&gt;On Mon Sep 21 05:36:46 2015,  madlord@list.ru wrote:
<div class="message-stanza open">&gt;&gt; Yes, i can.
</div>&gt;
&gt;Ok, here it goes.
&gt;
&gt;You will have to download the openssh package from some mirror &#40;i.e.  <span class="clickylink"><a target="new" rel="nofollow" href="http://mirror.internode.on.net/pub/OpenBSD/OpenSSH/portable/openssh-7.1p1.tar.gz">http://mirror.internode.on.net/pub/OpenBSD/OpenSSH/portable/openssh-7.1p1.tar.gz</a></span> &#41; and apply the attached patch to ssh.c, run configure and make, prepend the full path for the openssh-7.1p1 directory to $PATH so that the patched version of ssh is found first, and then run again the following perl script:
&gt;
&gt;  use Net::OpenSSH;
&gt;  $Net::OpenSSH::debug = -1;
&gt;  $ssh = Net::OpenSSH-&gt;new&#40;$host, master_opts =&gt; [qw&#40;-vvv&#41;]&#41;;
&gt;  $ssh-&gt;system&#40;{tty =&gt; 1}&#41;;
&gt;
&gt;Does it work?
&gt;
&gt;If it does I will write a more elaborated patch and send it upstream.
</div>

С уважением, Павлов Алексей :-&#41;
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1537193/820463/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/820463">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.8k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1537202" href="/Public/Bug/Display.html?id=107099#txn-1537202">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;21&nbsp;06:36:41&nbsp;2015</span>
    <span class="description">salva [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1537202/820469/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/820469">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 138b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Sep 21 06:19:45 2015, madlord@list.ru wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Can i use ssh_cmd option of Net::OpenSSH instead full path in $PATH?
</div>
yes, you can.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1537211" href="/Public/Bug/Display.html?id=107099#txn-1537211">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;21&nbsp;06:44:13&nbsp;2015</span>
    <span class="description">madlord [...] list.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #107099] Connect with -N key</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 21 Sep 2015 13:43:50 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-OpenSSH [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Алексей Павлов &lt;madlord [...] list.ru&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1537211/820477/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/820477">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 17.3k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1537211/820478/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/820478">with headers</a>
<br />
<span class="downloadcontenttype">text/html 19.5k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1537232" href="/Public/Bug/Display.html?id=107099#txn-1537232">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;21&nbsp;09:13:09&nbsp;2015</span>
    <span class="description">salva [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1537232/820488/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/820488">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 845b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Sep 21 06:44:13 2015, madlord@list.ru wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Ок, i patched and make this -   
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://mirror.internode.on.net/pub/OpenBSD/OpenSSH/portable/openssh-">http://mirror.internode.on.net/pub/OpenBSD/OpenSSH/portable/openssh-</a></span>
&gt; 7.1p1.tar.gz
&gt; But for openssh 7.1 i add options:
&gt; my $ssh = Net::OpenSSH-&gt;new&#40;$ip, master_opts =&gt; [qw&#40;-vvv&#41;, -o =&gt;
&gt; &#39;KexAlgorithms=+diffie-hellman-group1-sha1&#39;, -o =&gt;
&gt; &#39;HostKeyAlgorithms=+ssh-dss&#39;]&#41;;
&gt; because i had error:  no matching key exchange method found
&gt; 
&gt; Result &#40;it works&#41;:
</div>
Ok, just a last test, can you check whether that server allows you to open several channels in sequence over the same SSH connection:

  my $ssh = Net::OpenSSH-&gt;new&#40;$ip, master_opts =&gt; [qw&#40;-vvv&#41;, ...]&#41;;
  $ssh-&gt;system&#40;{tty =&gt; 1}&#41;;
  $ssh-&gt;system&#40;{tty =&gt; 1}&#41;;

Do you see the two sessions opening or on the other hand, does the remote server drop the connection after the first one finish?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1537593" href="/Public/Bug/Display.html?id=107099#txn-1537593">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;22&nbsp;00:59:10&nbsp;2015</span>
    <span class="description">madlord [...] list.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #107099] Connect with -N key</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 22 Sep 2015 07:58:46 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-OpenSSH [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Алексей Павлов &lt;madlord [...] list.ru&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1537593/820696/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/820696">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 22.8k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1537593/820697/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/820697">with headers</a>
<br />
<span class="downloadcontenttype">text/html 24.8k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1538040" href="/Public/Bug/Display.html?id=107099#txn-1538040">#</a>      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;23&nbsp;02:33:45&nbsp;2015</span>
    <span class="description">sfandino [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #107099] Connect with -N key</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 23 Sep 2015 06:30:28 +0000 &#40;UTC&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Net-OpenSSH [...] rt.cpan.org&#34; &lt;bug-Net-OpenSSH [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Salvador Fandino &lt;sfandino [...] yahoo.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1538040/820965/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/820965">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">



<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;________________________________
&gt; From: Алексей Павлов via RT &lt;bug-Net-OpenSSH@rt.cpan.org&gt;
&gt;To: 
&gt;Sent: Tuesday, September 22, 2015 6:59 AM
&gt;Subject: Re: [rt.cpan.org #107099] Connect with -N key
&gt; 
&gt;
&gt;       Queue: Net-OpenSSH
&gt;Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=107099">https://rt.cpan.org/Ticket/Display.html?id=107099</a></span> &gt;
&gt;
&gt;How can i see this? In debug of Net::OpenSSH? I have limited access to server logs.
</div>

The ssh verbose output shows it:


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;...
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;debug1: channel 2: new [client-session]&gt;debug2: process_mux_new_session: channel_new: 2 linked to control channel 1
&gt;debug2: channel 2: send open
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;Received disconnect from 213.228.116.181: 2:
</div>
You see, once the request for opening a second channel is sent, the remote side closes the connection inmediately.

That means that even with the workaround you will not be able to call more than one Net::OpenSSH method. Also, your server is asking you to authenticate from inside the shell instead of at the SSH protocol level.

In summary, the implementation of SSH on your device does almost everything wrong. Probably it is the same server they have for telnet access running on top of an unauthenticated SSH connection, and it is missing all the features of SSH that make it a much better protocol for system administration automation.

Net::OpenSSH is mostly useless for your case. Net::Telnet or just raw Expect are going to be better options for you.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1538047" href="/Public/Bug/Display.html?id=107099#txn-1538047">#</a>      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;23&nbsp;02:44:16&nbsp;2015</span>
    <span class="description">madlord [...] list.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re[2]: [rt.cpan.org #107099] Connect with -N key</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 23 Sep 2015 09:43:58 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-OpenSSH [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Алексей Павлов &lt;madlord [...] list.ru&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1538047/820972/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/820972">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"> Ок, thanks. I already use Net::Telnet and IO::Pty for this. But why connection timeouted whith -N key?


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;Среда, 23 сентября 2015, 2:33 -04:00 от &#34;Salvador \&#34;Fandiño\&#34; via RT&#34; &lt;bug-Net-OpenSSH@rt.cpan.org&gt;:
&gt;
&gt;&lt;URL:  <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=107099">https://rt.cpan.org/Ticket/Display.html?id=107099</a></span> &gt;
&gt;
&gt;
&gt;
&gt;
&gt;
<div class="message-stanza open">&gt;&gt;________________________________
&gt;&gt; From: Алексей Павлов via RT &lt; bug-Net-OpenSSH@rt.cpan.org &gt;
&gt;&gt;To: 
&gt;&gt;Sent: Tuesday, September 22, 2015 6:59 AM
&gt;&gt;Subject: Re: [rt.cpan.org #107099] Connect with -N key
&gt;&gt; 
&gt;&gt;
&gt;&gt;       Queue: Net-OpenSSH
&gt;&gt;Ticket &lt;URL:  <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=107099">https://rt.cpan.org/Ticket/Display.html?id=107099</a></span> &gt;
&gt;&gt;
&gt;&gt;How can i see this? In debug of Net::OpenSSH? I have limited access to server logs.
</div>&gt;
&gt;
&gt;The ssh verbose output shows it:
&gt;
&gt;
<div class="message-stanza open">&gt;&gt;...
</div>&gt;
<div class="message-stanza open">&gt;&gt;debug1: channel 2: new [client-session]&gt;debug2: process_mux_new_session: channel_new: 2 linked to control channel 1
&gt;&gt;debug2: channel 2: send open
</div>&gt;
<div class="message-stanza open">&gt;&gt;Received disconnect from 213.228.116.181: 2:
</div>&gt;
&gt;You see, once the request for opening a second channel is sent, the remote side closes the connection inmediately.
&gt;
&gt;That means that even with the workaround you will not be able to call more than one Net::OpenSSH method. Also, your server is asking you to authenticate from inside the shell instead of at the SSH protocol level.
&gt;
&gt;In summary, the implementation of SSH on your device does almost everything wrong. Probably it is the same server they have for telnet access running on top of an unauthenticated SSH connection, and it is missing all the features of SSH that make it a much better protocol for system administration automation.
&gt;
&gt;Net::OpenSSH is mostly useless for your case. Net::Telnet or just raw Expect are going to be better options for you.
&gt;
</div>

С уважением, Павлов Алексей :-&#41;
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1538047/820973/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/820973">with headers</a>
<br />
<span class="downloadcontenttype">text/html 2.6k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1538049" href="/Public/Bug/Display.html?id=107099#txn-1538049">#</a>      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;23&nbsp;02:55:50&nbsp;2015</span>
    <span class="description">sfandino [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: Re[2]: [rt.cpan.org #107099] Connect with -N key</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 23 Sep 2015 06:50:07 +0000 &#40;UTC&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Net-OpenSSH [...] rt.cpan.org&#34; &lt;bug-Net-OpenSSH [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Salvador Fandino &lt;sfandino [...] yahoo.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1538049/820975/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/820975">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 674b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">



<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">----- Original Message -----
<div class="message-stanza open">&gt; From: Алексей Павлов via RT &lt;bug-Net-OpenSSH@rt.cpan.org&gt;
&gt; To: 
&gt; Cc: 
&gt; Sent: Wednesday, September 23, 2015 8:44 AM
&gt; Subject: Re[2]: [rt.cpan.org #107099] Connect with -N key
&gt; 
&gt;        Queue: Net-OpenSSH
&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=107099">https://rt.cpan.org/Ticket/Display.html?id=107099</a></span> &gt;
&gt; 
&gt; Ок, thanks. I already use Net::Telnet and IO::Pty for this. But why connection 
&gt; timeouted whith -N key?
</div>

Well, the connection didn&#39;t timeout, the session did. It was waiting for you to authenticate but you didn&#39;t do that in the expected time frame.

Anyway, timestamps are not included on the output, so maybe I am missing something there.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1540460" href="/Public/Bug/Display.html?id=107099#txn-1540460">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;01&nbsp;03:29:15&nbsp;2015</span>
    <span class="description">salva [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 1.11231</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
