<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #70972 for Cache-FastMmap: Getting segmentation faults from Cache::FastMmap</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #70972 for Cache-FastMmap: Getting segmentation faults from Cache::FastMmap</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Cache-FastMmap/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Cache-FastMmap/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Cache-FastMmap/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Cache-FastMmap/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Cache-FastMmap">Cache-FastMmap CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">70972</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Cache-FastMmap/Active/">Cache-FastMmap</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
colink [...] perlDreamer.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-4856-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.39    </td>
  </tr>
  <tr id="CF-4857-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;14&nbsp;17:59:57&nbsp;2011</span>
    <span class="description">colink [...] perlDreamer.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Getting segmentation faults from Cache::FastMmap</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Using perl 5.10.0

We use Cache::FastMmap inside of CHI for WebGUI, and on one site we keep
getting seg faults when trying to update the cache.

I&#39;ll paste in stack traces from gdb and the perl debugger.

#0  0x005398ec in memcpy &#40;&#41; from /lib/libc.so.6
#1  0x0030ffd8 in mmc_do_expunge &#40;&#41; from
/data/wre/prereqs/lib/perl5/site_perl/5.10.0/i686-linux/auto/Cache/FastMmap/FastMmap.so
#2  0x0030e2d5 in XS_Cache__FastMmap_fc_expunge &#40;&#41;
   from
/data/wre/prereqs/lib/perl5/site_perl/5.10.0/i686-linux/auto/Cache/FastMmap/FastMmap.so
#3  0x080a0be3 in Perl_pp_entersub &#40;&#41;
#4  0x0809f4ce in Perl_runops_standard &#40;&#41;
#5  0x0809ba9c in perl_run &#40;&#41;
#6  0x0805e265 in main &#40;&#41;

Signal SEGV at
/data/wre/prereqs/lib/perl5/site_perl/5.10.0/i686-linux/Cache/FastMmap.pm line
762
        Cache::FastMmap::set&#40;&#39;Cache::FastMmap=HASH&#40;0xb605528&#41;&#39;,
&#39;wE401EXjGiFZwb-riCuiEg/2qFG85kSNxxPYg4tj-M+jQ/bCC0zkuiKPT2jrv...&#39;,
&#39;\x{f}\x{1a}qN\x{f}&#40;rN\x{8f}krN\x{1}\x{1}\x{4}\x{7}\x{4}1234\x{4}\x{4}\x{4}\x{8}\x{3}.\x{0}\x{0}\x{0}\x{5}\x{e}\x{0}\x{0}\x{0}lastExportedAs\x{a}\x{1}3\x{9}\x{0}\x{0}\x{0}creat...&#39;&#41;
called at
/data/wre/prereqs/lib/perl5/site_perl/5.10.0/CHI/Driver/FastMmap.pm line 71
       
CHI::Driver::FastMmap::store&#40;&#39;Class::MOP::Class::__ANON__::SERIAL::1=HASH&#40;0xb3b65b8&#41;&#39;,
&#39;wE401EXjGiFZwb-riCuiEg/2qFG85kSNxxPYg4tj-M+jQ/bCC0zkuiKPT2jrv...&#39;,
&#39;\x{f}\x{1a}qN\x{f}&#40;rN\x{8f}krN\x{1}\x{1}\x{4}\x{7}\x{4}1234\x{4}\x{4}\x{4}\x{8}\x{3}.\x{0}\x{0}\x{0}\x{5}\x{e}\x{0}\x{0}\x{0}lastExportedAs\x{a}\x{1}3\x{9}\x{0}\x{0}\x{0}creat...&#39;&#41;
called at /data/wre/prereqs/lib/perl5/site_perl/5.10.0/CHI/Driver.pm
line 355
        eval {...} called at
/data/wre/prereqs/lib/perl5/site_perl/5.10.0/CHI/Driver.pm line 355
       
CHI::Driver::set_object&#40;&#39;Class::MOP::Class::__ANON__::SERIAL::1=HASH&#40;0xb3b65b8&#41;&#39;,
&#39;wE401EXjGiFZwb-riCuiEg/2qFG85kSNxxPYg4tj-M+jQ/bCC0zkuiKPT2jrv...&#39;,
&#39;CHI::CacheObject=ARRAY&#40;0xbcd7838&#41;&#39;&#41; called at
/data/wre/prereqs/lib/perl5/site_perl/5.10.0/CHI/Driver/Role/IsSizeAware.pm
line 67
        Class::MOP::Class:::around&#40;&#39;CODE&#40;0xb423598&#41;&#39;,
&#39;Class::MOP::Class::__ANON__::SERIAL::1=HASH&#40;0xb3b65b8&#41;&#39;,
&#39;wE401EXjGiFZwb-riCuiEg/2qFG85kSNxxPYg4tj-M+jQ/bCC0zkuiKPT2jrv...&#39;,
&#39;CHI::CacheObject=ARRAY&#40;0xbcd7838&#41;&#39;&#41; called at
/data/wre/prereqs/lib/perl5/site_perl/5.10.0/i686-linux/Class/MOP/Method/Wrapped.pm
line 159
       
Class::MOP::Method::Wrapped::__ANON__[/data/wre/prereqs/lib/perl5/site_perl/5.10.0/i686-linux/Class/MOP/Method/Wrapped.pm:159]&#40;&#39;Class::MOP::Class::__ANON__::SERIAL::1=HASH&#40;0xb3b65b8&#41;&#39;,
&#39;wE401EXjGiFZwb-riCuiEg/2qFG85kSNxxPYg4tj-M+jQ/bCC0zkuiKPT2jrv...&#39;,
&#39;CHI::CacheObject=ARRAY&#40;0xbcd7838&#41;&#39;&#41; called at
/data/wre/prereqs/lib/perl5/site_perl/5.10.0/i686-linux/Class/MOP/Method/Wrapped.pm
line 89
       
Class::MOP::Class::__ANON__::SERIAL::1::set_object&#40;&#39;Class::MOP::Class::__ANON__::SERIAL::1=HASH&#40;0xb3b65b8&#41;&#39;,
&#39;wE401EXjGiFZwb-riCuiEg/2qFG85kSNxxPYg4tj-M+jQ/bCC0zkuiKPT2jrv...&#39;,
&#39;CHI::CacheObject=ARRAY&#40;0xbcd7838&#41;&#39;&#41; called at
/data/wre/prereqs/lib/perl5/site_perl/5.10.0/CHI/Driver.pm line 334
       
CHI::Driver::set_with_options&#40;&#39;Class::MOP::Class::__ANON__::SERIAL::1=HASH&#40;0xb3b65b8&#41;&#39;,
&#39;wE401EXjGiFZwb-riCuiEg/2qFG85kSNxxPYg4tj-M+jQ/bCC0zkuiKPT2jrv...&#39;,
&#39;HASH&#40;0xbc89ee8&#41;&#39;, &#39;HASH&#40;0xbc70600&#41;&#39;&#41; called at
/data/wre/prereqs/lib/perl5/site_perl/5.10.0/CHI/Driver.pm line 305
       
CHI::Driver::set&#40;&#39;Class::MOP::Class::__ANON__::SERIAL::1=HASH&#40;0xb3b65b8&#41;&#39;,
&#39;wE401EXjGiFZwb-riCuiEg/2qFG85kSNxxPYg4tj-M+jQ/bCC0zkuiKPT2jrv...&#39;,
&#39;HASH&#40;0xbc89ee8&#41;&#39;, 86400&#41; called at
/data/WebGUI/sbin/../lib/WebGUI/Cache/CHI.pm line 134
        WebGUI::Cache::CHI::set&#40;&#39;WebGUI::Cache::CHI=HASH&#40;0xbbe0320&#41;&#39;,
&#39;HASH&#40;0xbc89ee8&#41;&#39;, 86400&#41; called at
/data/WebGUI/sbin/../lib/WebGUI/Asset.pm line 1936
        WebGUI::Asset::new&#40;&#39;WebGUI::Asset&#39;,
&#39;WebGUI::Session=HASH&#40;0xac04448&#41;&#39;, &#39;PBtmpl0000000000000031&#39;,
&#39;WebGUI::Asset::Template&#39;, 1287010049&#41; called at
/data/WebGUI/sbin/../lib/WebGUI/Asset.pm line 2103
        WebGUI::Asset::newPending&#40;&#39;WebGUI::Asset&#39;,
&#39;WebGUI::Session=HASH&#40;0xac04448&#41;&#39;, &#39;PBtmpl0000000000000031&#39;&#41; called at
findBrokenAssets.pl line 81
        eval {...} called at findBrokenAssets.pl line 81
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;15&nbsp;14:09:15&nbsp;2011</span>
    <span class="description">SWALTERS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: Getting segmentation faults from Cache::FastMmap</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Few comments here...

I was able to minimize the test case to one store that wrote a key of 68
bytes and a value of 4642 bytes.  Not just any data of that size, but
one exact piece of information we were trying to cache was triggering
this.  This would reliably SEGV.  But...

It looks like we erroneous thought the .dat file was being cleared out
between runs &#40;we have a command line tool for doing various things,
including this&#41;.  The minimal test case depended on that particular .dat
file.  I couldn&#39;t reproduce this otherwise.  Manually removing that .dat
file made the crash go away.  The .dat file, if this is the case, would
have been created by a previous version of Cache::FastMmap.

Given that, I&#39;m not sure how much value this bug report holds.

Thanks,
-scott
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;15&nbsp;14:09:16&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;11&nbsp;20:56:42&nbsp;2017</span>
    <span class="description">cpan [...] robm.fastmail.fm -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ll just close this ancient ticket for now, since it seems related to a specific corruption in one file.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;11&nbsp;20:56:43&nbsp;2017</span>
    <span class="description">cpan [...] robm.fastmail.fm -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
