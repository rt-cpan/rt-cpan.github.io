<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #75376 for Devel-Cover-Report-Clover: Most tests fail on Ubuntu</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #75376 for Devel-Cover-Report-Clover: Most tests fail on Ubuntu</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Devel-Cover-Report-Clover/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Devel-Cover-Report-Clover/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Devel-Cover-Report-Clover/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Devel-Cover-Report-Clover/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Devel-Cover-Report-Clover">Devel-Cover-Report-Clover CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">75376</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Devel-Cover-Report-Clover/Active/">Devel-Cover-Report-Clover</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
dolmen [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-240766-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.34    </td>
  </tr>
  <tr id="CF-240767-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;28&nbsp;11:50:12&nbsp;2012</span>
    <span class="description">dolmen [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Most tests fail on Ubuntu</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Release 0.31 was working fine on Ubuntu.
The testsuite in release 0.34 is completely broken: almost all test fail
with error &#34;Can&#39;t open perl script &#34;cover&#34;: no such file or directory&#34;

-- 
Olivier Mengué - <span class="clickylink"><a target="new" rel="nofollow" href="http://perlresume.org/DOLMEN">http://perlresume.org/DOLMEN</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;28&nbsp;12:05:12&nbsp;2012</span>
    <span class="description">dolmen [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Le 2012-02-28 17:50:12, DOLMEN a écrit :
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Release 0.31 was working fine on Ubuntu.
&gt; The testsuite in release 0.34 is completely broken: almost all test fail
&gt; with error &#34;Can&#39;t open perl script &#34;cover&#34;: no such file or directory&#34;
</div>
The problem may be in t/testcover.pm, in sub p_which: it does bad
assumption about the installation directory of Devel::Cover. I&#39;m using a
local::lib-based install so my cover script is not in one of the
@Config{qw/installscript installsitebin installvendorbin installbin/}
directories.
$ENV{PATH} is what matters.

-- 
Olivier Mengué - <span class="clickylink"><a target="new" rel="nofollow" href="http://perlresume.org/DOLMEN">http://perlresume.org/DOLMEN</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;28&nbsp;12:05:13&nbsp;2012</span>
    <span class="description">dolmen [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;28&nbsp;12:10:21&nbsp;2012</span>
    <span class="description">captindave [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thank you.  I will try and reproduce it and create a patch unless you are working on one 
already.

On Tue Feb 28 12:05:12 2012, DOLMEN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Le 2012-02-28 17:50:12, DOLMEN a écrit :
<div class="message-stanza open">&gt; &gt; Release 0.31 was working fine on Ubuntu.
&gt; &gt; The testsuite in release 0.34 is completely broken: almost all test fail
&gt; &gt; with error &#34;Can&#39;t open perl script &#34;cover&#34;: no such file or directory&#34;
</div>&gt; 
&gt; The problem may be in t/testcover.pm, in sub p_which: it does bad
&gt; assumption about the installation directory of Devel::Cover. I&#39;m using a
&gt; local::lib-based install so my cover script is not in one of the
&gt; @Config{qw/installscript installsitebin installvendorbin installbin/}
&gt; directories.
&gt; $ENV{PATH} is what matters.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;28&nbsp;12:18:55&nbsp;2012</span>
    <span class="description">captindave [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I attempted to reproduce it as follows but it did not work

mkdir ~/mybin
sudo mv `which cover` ~/mybin
export PATH=$PATH:$HOME/mybin
perl Build.PL
./Build test

all tests passed meaning the PATH seems to be honored.

You&#39;ll notice that the over_cmd&#40;&#41; function in that file defaults to &#39;cover&#39; &#40;no path specified&#41; so it 
*should* be using the PATH.

Can you dump your \%ENV hash, say from within the testcover::run method.  Here is what mine 
looks like.

$VAR1 = {
  &#39;Apple_PubSub_Socket_Render&#39; =&gt; &#39;/tmp/launch-O04rlE/Render&#39;,
  &#39;Apple_Ubiquity_Message&#39; =&gt; &#39;/tmp/launch-f9egZR/Apple_Ubiquity_Message&#39;,
  &#39;CLICOLOR&#39; =&gt; &#39;1&#39;,
  &#39;COMMAND_MODE&#39; =&gt; &#39;unix2003&#39;,
  &#39;DISPLAY&#39; =&gt; &#39;/tmp/launch-THEwGn/org.x:0&#39;,
  &#39;EDITOR&#39; =&gt; &#39;vim&#39;,
  &#39;GIT_EDITOR&#39; =&gt; &#39;vim&#39;,
  &#39;HARNESS_ACTIVE&#39; =&gt; 1,
  &#39;HARNESS_IS_VERBOSE&#39; =&gt; &#39;1&#39;,
  &#39;HARNESS_VERBOSE&#39; =&gt; &#39;1&#39;,
  &#39;HARNESS_VERSION&#39; =&gt; &#39;3.23&#39;,
  &#39;HOME&#39; =&gt; &#39;/Users/dbartle&#39;,
  &#39;LANG&#39; =&gt; &#39;en_US.UTF-8&#39;,
  &#39;LESSCHARSET&#39; =&gt; &#39;utf-8&#39;,
  &#39;LOCALE&#39; =&gt; &#39;UTF-8&#39;,
  &#39;LOGNAME&#39; =&gt; &#39;dbartle&#39;,
  &#39;OLDPWD&#39; =&gt; &#39;/Users/dbartle/Documents/devel-cover-report-clover/t&#39;,
  &#39;PATH&#39; =&gt; &#39;/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr/X11/bin:/Users/dbartle/mybin&#39;,
  &#39;PERL5LIB&#39; =&gt; &#39;/Users/dbartle/Documents/devel-cover-report-
clover/blib/lib:/Users/dbartle/Documents/devel-cover-report-clover/blib/arch&#39;,
  &#39;PERL_DL_NONLAZY&#39; =&gt; &#39;1&#39;,
  &#39;PWD&#39; =&gt; &#39;/Users/dbartle/Documents/devel-cover-report-clover&#39;,
  &#39;SHELL&#39; =&gt; &#39;/bin/bash&#39;,
  &#39;SHLVL&#39; =&gt; &#39;1&#39;,
  &#39;SSH_AUTH_SOCK&#39; =&gt; &#39;/tmp/launch-2KeR88/Listeners&#39;,
  &#39;TAP_VERSION&#39; =&gt; &#39;13&#39;,
  &#39;TERM&#39; =&gt; &#39;xterm-256color&#39;,
  &#39;TERM_PROGRAM&#39; =&gt; &#39;Apple_Terminal&#39;,
  &#39;TERM_PROGRAM_VERSION&#39; =&gt; &#39;303&#39;,
  &#39;TERM_SESSION_ID&#39; =&gt; &#39;4E9BBF1D-431A-4B9C-A2AF-CB8E4077F8E9&#39;,
  &#39;TEST_VERBOSE&#39; =&gt; &#39;1&#39;,
  &#39;TMPDIR&#39; =&gt; &#39;/var/folders/2l/s_xv_4qd4hn8rpfdcy79bv9w0000gq/T/&#39;,
  &#39;USER&#39; =&gt; &#39;dbartle&#39;,
  &#39;VERSIONER_PERL_PREFER_32_BIT&#39; =&gt; &#39;no&#39;,
  &#39;VERSIONER_PERL_VERSION&#39; =&gt; &#39;5.12&#39;,
  &#39;_&#39; =&gt; &#39;./Build&#39;,
  &#39;__CF_USER_TEXT_ENCODING&#39; =&gt; &#39;0x1F7:0:0&#39;
};

On Tue Feb 28 12:10:21 2012, DBARTLE wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thank you.  I will try and reproduce it and create a patch unless you
&gt; are working on one
&gt; already.
&gt; 
&gt; On Tue Feb 28 12:05:12 2012, DOLMEN wrote:
<div class="message-stanza open">&gt; &gt; Le 2012-02-28 17:50:12, DOLMEN a écrit :
<div class="message-stanza open">&gt; &gt; &gt; Release 0.31 was working fine on Ubuntu.
&gt; &gt; &gt; The testsuite in release 0.34 is completely broken: almost all
</div></div>&gt; test fail
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; with error &#34;Can&#39;t open perl script &#34;cover&#34;: no such file or
</div></div>&gt; directory&#34;
<div class="message-stanza open">&gt; &gt;
&gt; &gt; The problem may be in t/testcover.pm, in sub p_which: it does bad
&gt; &gt; assumption about the installation directory of Devel::Cover. I&#39;m
</div>&gt; using a
<div class="message-stanza open">&gt; &gt; local::lib-based install so my cover script is not in one of the
&gt; &gt; @Config{qw/installscript installsitebin installvendorbin
</div>&gt; installbin/}
<div class="message-stanza open">&gt; &gt; directories.
&gt; &gt; $ENV{PATH} is what matters.
</div>&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;28&nbsp;12:57:57&nbsp;2012</span>
    <span class="description">captindave [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I killed off my install of Devel::Cover and installed Devel::Cover under local lib.

Then I ran this:

eval $&#40;perl -Mlocal::lib&#41;

The tests seemed to work at that point for me. I took a look at the File::Which stuff at one point 
in an early early release IIRC but tests failed about 75% of the time in CPANTS due to some 
really strange things like $ENV{PATH} being set to &#39;&#39; in many environments.

I&#39;ll have to explore this further.

On Tue Feb 28 12:05:12 2012, DOLMEN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Le 2012-02-28 17:50:12, DOLMEN a écrit :
<div class="message-stanza open">&gt; &gt; Release 0.31 was working fine on Ubuntu.
&gt; &gt; The testsuite in release 0.34 is completely broken: almost all test fail
&gt; &gt; with error &#34;Can&#39;t open perl script &#34;cover&#34;: no such file or directory&#34;
</div>&gt; 
&gt; The problem may be in t/testcover.pm, in sub p_which: it does bad
&gt; assumption about the installation directory of Devel::Cover. I&#39;m using a
&gt; local::lib-based install so my cover script is not in one of the
&gt; @Config{qw/installscript installsitebin installvendorbin installbin/}
&gt; directories.
&gt; $ENV{PATH} is what matters.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;28&nbsp;13:14:31&nbsp;2012</span>
    <span class="description">dolmen [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Le 2012-02-28 18:18:55, DBARTLE a écrit :
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I attempted to reproduce it as follows but it did not work
&gt; 
&gt; mkdir ~/mybin
&gt; sudo mv `which cover` ~/mybin
&gt; export PATH=$PATH:$HOME/mybin
&gt; perl Build.PL
&gt; ./Build test
&gt; 
&gt; all tests passed meaning the PATH seems to be honored.
</div>
With this test, the &#39;cover&#39; script used is still one of your perl
$Config paths, not $HOME/mybin/cover.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; You&#39;ll notice that the over_cmd&#40;&#41; function in that file defaults to
&gt; &#39;cover&#39; &#40;no path specified&#41; so it
&gt; *should* be using the PATH.
</div>
No, &#34;/usr/bin/perl cover&#34; is not using the $PATH.
Also I noticed that $Devel::Cover::Inc::Base is wrong: it indicates the
temporary build directory at the time I installed Devel::Cover, and that
doesn&#39;t exists anymore.

Anyway, patch submitted:
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/captin411/devel-cover-report-clover/pull/2">https://github.com/captin411/devel-cover-report-clover/pull/2</a></span>

-- 
Olivier Mengué - <span class="clickylink"><a target="new" rel="nofollow" href="http://perlresume.org/DOLMEN">http://perlresume.org/DOLMEN</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;28&nbsp;13:21:39&nbsp;2012</span>
    <span class="description">dolmen [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Le 2012-02-28 19:14:31, DOLMEN a écrit :
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Le 2012-02-28 18:18:55, DBARTLE a écrit :
<div class="message-stanza open">&gt; &gt; I attempted to reproduce it as follows but it did not work
&gt; &gt; 
&gt; &gt; mkdir ~/mybin
&gt; &gt; sudo mv `which cover` ~/mybin
&gt; &gt; export PATH=$PATH:$HOME/mybin
&gt; &gt; perl Build.PL
&gt; &gt; ./Build test
&gt; &gt; 
&gt; &gt; all tests passed meaning the PATH seems to be honored.
</div>&gt; 
&gt; With this test, the &#39;cover&#39; script used is still one of your perl
&gt; $Config paths, not $HOME/mybin/cover.
</div>
I&#39;m probably wrong on this.
Did you check that the &#39;cover&#39; used is not the one from
$Devel::Cover::Inc::Base ?

-- 
Olivier Mengué - <span class="clickylink"><a target="new" rel="nofollow" href="http://perlresume.org/DOLMEN">http://perlresume.org/DOLMEN</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;28&nbsp;14:07:58&nbsp;2012</span>
    <span class="description">captindave [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Can you post a dump of ENV at the beginning of testcover::run&#40;&#41;? and also what your ENV looks 
like before you run ./Build. I want to try and replicate what is happening and also still let the 
automated testing sandboxes to be able to work as well so that it works in all cases.

The problems on the sandboxed testing systems arise in two situations

1&#41; Devel::Cover is installed both in a system path AND in a .cpanplus folder in the sandbox

In this case, the wrong &#39;cover&#39; command can be found based on a disconnect between the order 
of precedence in the PATH vs the order of precedence in the PERL5LIB env.

2&#41; Devel::Cover is installed ONLY in the ~/.cpanplus folder &#40;somewhere&#41; and the PATH does not 
include a path which would let the OS find the &#39;cover&#39; command


Here is an example abbreviated environment line which caused problems.  Note that 
Devel::Cover was installed in the .cpanplus folder in this case and it was not installed system 
wide. The &#39;cover&#39; command did not exist anywhere in the EVN{PATH}... rather it was basically in 
$some_build_folder/cover &#40;which is why $Devel::Cover::Inc::Base/cover is also checked&#41;.

PATH = /bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin
PERL5LIB = :[...]/Volumes/Media/smoke/bare/conf/perl-5.14.1/.cpanplus/5.14.1/build/Devel-
Cover-0.79/blib:[...]/Volumes/Media/smoke/bare/conf/perl-
5.14.1/.cpanplus/5.14.1/build/Devel-Cover-Report-Clover-0.26/blib/lib:[...]
    

On Tue Feb 28 13:21:39 2012, DOLMEN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Le 2012-02-28 19:14:31, DOLMEN a écrit :
<div class="message-stanza open">&gt; &gt; Le 2012-02-28 18:18:55, DBARTLE a écrit :
<div class="message-stanza open">&gt; &gt; &gt; I attempted to reproduce it as follows but it did not work
&gt; &gt; &gt; 
&gt; &gt; &gt; mkdir ~/mybin
&gt; &gt; &gt; sudo mv `which cover` ~/mybin
&gt; &gt; &gt; export PATH=$PATH:$HOME/mybin
&gt; &gt; &gt; perl Build.PL
&gt; &gt; &gt; ./Build test
&gt; &gt; &gt; 
&gt; &gt; &gt; all tests passed meaning the PATH seems to be honored.
</div>&gt; &gt; 
&gt; &gt; With this test, the &#39;cover&#39; script used is still one of your perl
&gt; &gt; $Config paths, not $HOME/mybin/cover.
</div>&gt; 
&gt; I&#39;m probably wrong on this.
&gt; Did you check that the &#39;cover&#39; used is not the one from
&gt; $Devel::Cover::Inc::Base ?
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;29&nbsp;05:31:47&nbsp;2012</span>
    <span class="description">dolmen [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Le 2012-02-28 20:07:58, DBARTLE a écrit :
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Can you post a dump of ENV at the beginning of testcover::run&#40;&#41;? and
&gt; also what your ENV looks
&gt; like before you run ./Build. I want to try and replicate what is
&gt; happening and also still let the
&gt; automated testing sandboxes to be able to work as well so that it
&gt; works in all cases.
</div>
I have added the following lines at the beginning of testcover::run:

    foreach my $e &#40;&#39;PATH&#39;, sort grep&#40;/^PERL/, keys %ENV&#41; &#41; {
        Test::More::diag&#40;&#34;$e=$ENV{$e}&#34;&#41;;
    }
    Test::More::diag&#40;&#34;Devel::Cover::Inc::Base=$Devel::Cover::Inc::Base&#34;&#41;;
    Test::More::diag&#40;&#39;Devel::Cover::Inc::Inc=&#39;.join&#40;&#39;:&#39;,
@Devel::Cover::Inc::Inc&#41;&#41;;

Here is the output of &#34;LANG=C perl -Ilib t/basic.t&#34;:

----------8&lt;----------8&lt;----------8&lt;----------8&lt;----------8&lt;----------
#
PATH=/home/omengue/bin:/home/omengue/.perl/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games
#
PERL5LIB=/home/omengue/.perl/lib/perl5/x86_64-linux-gnu-thread-multi:/home/omengue/.perl/lib/perl5
# PERLBREW_ROOT=/home/omengue/.perl/perlbrew
# PERL_CPANM_OPT=-l /home/omengue/.perl --mirror
<span class="clickylink"><a target="new" rel="nofollow" href="http://distrib-coffee.ipsl.jussieu.fr/pub/mirrors/cpan/">http://distrib-coffee.ipsl.jussieu.fr/pub/mirrors/cpan/</a></span>
# PERL_LOCAL_LIB_ROOT=/home/omengue/.perl
# PERL_MB_OPT=--install_base /home/omengue/.perl
# PERL_MM_OPT=INSTALL_BASE=/home/omengue/.perl
#
Devel::Cover::Inc::Base=/home/omengue/.local/share/.cpan/build/Devel-Cover-0.79-KikcpK
#
Devel::Cover::Inc::Inc=.:/etc/perl:/home/omengue/.perl/lib/perl5:/home/omengue/.perl/lib/perl5/x86_64-linux-gnu-thread-multi:/tmp/CPAN-Reporter-lib-qS3j:/usr/lib/perl/5.10.1:/usr/lib/perl5:/usr/share/perl/5.10.1:/usr/share/perl5
Can&#39;t open perl script &#34;cover&#34;: No such file or directory
system&#40;&#39;/usr/bin/perl&#39;,&#39;cover&#39;,&#39;/home/omengue/tmp/p5-Devel-Cover-Report-Clover/t/../cover_db_test/multi_file/cover_db&#39;&#41;
failed: 512 
----------8&lt;----------8&lt;----------8&lt;----------8&lt;----------8&lt;----------


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The problems on the sandboxed testing systems arise in two situations
&gt; 
&gt; 1&#41; Devel::Cover is installed both in a system path AND in a .cpanplus
&gt; folder in the sandbox
</div>
I would not call a module in the &#34;.cpanplus&#34; folder to be &#34;installed&#34;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; In this case, the wrong &#39;cover&#39; command can be found based on a
&gt; disconnect between the order
&gt; of precedence in the PATH vs the order of precedence in the PERL5LIB
&gt; env.
</div>
Trying to reliably call a script from a Perl distribution is impossible
if you can not trust the environment. If the &#39;cover&#39; script found
$ENV{PATH} does not match the Devel::Cover in @INC, that is a problem
either with the original user environment or a bug in the CPAN client
that does not modifies PATH to match what it does with PERL5LIB.

The only right workaround would be to avoid using the &#39;cover&#39; script at
all. But I understand that replicating its functionality is a tough job.
Maybe the solution would be to ask the Devel::Cover maintainer to
provide the functionality you need as a module instead of relying on the
script.
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 2&#41; Devel::Cover is installed ONLY in the ~/.cpanplus folder
&gt; &#40;somewhere&#41; and the PATH does not
&gt; include a path which would let the OS find the &#39;cover&#39; command
&gt; 
&gt; 
&gt; Here is an example abbreviated environment line which caused problems.
&gt; Note that
&gt; Devel::Cover was installed in the .cpanplus folder in this case and it
&gt; was not installed system
&gt; wide. The &#39;cover&#39; command did not exist anywhere in the EVN{PATH}...
&gt; rather it was basically in
&gt; $some_build_folder/cover &#40;which is why $Devel::Cover::Inc::Base/cover
&gt; is also checked&#41;.
</div>
Your assumption is that the module is installed. But that is not the
case. This is only smoke testing and only PERL5LIB is modified in that
environment to add the temporary Devel-Cover/lib. Personally, I think
that is a bug in the smoke tool and that PATH should also be modified by
the smoke tool.
Trying to find the cover script in that broken environment can not be
done reliably, unless with the $Devel::Cover::Inc::Base. But in that
case, it would be better to try to use it before trying $PATH.

Please, use my patch to fix the case of real non-broken environments.

I can also improve it to implement my suggestion above &#40;using
$Devel::Cover::Inc::Base before $ENV{PATH}&#41;. Tell me.

-- 
Olivier Mengué - <span class="clickylink"><a target="new" rel="nofollow" href="http://perlresume.org/DOLMEN">http://perlresume.org/DOLMEN</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;12&nbsp;05:34:32&nbsp;2012</span>
    <span class="description">captindave [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks a lot for the pull request on github.com.  I&#39;ve integrated the changes and uploaded the 
new version of the module to CPAN &#40;v0.35&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;12&nbsp;05:34:33&nbsp;2012</span>
    <span class="description">captindave [...] gmail.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
