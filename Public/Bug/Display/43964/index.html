<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #43964 for Catalyst-Controller-DBIC-API: I&#39;d like _format_search&#40;&#41; to be more granular</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #43964 for Catalyst-Controller-DBIC-API: I&#39;d like _format_search&#40;&#41; to be more granular</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Catalyst-Controller-DBIC-API/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Catalyst-Controller-DBIC-API/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Catalyst-Controller-DBIC-API/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Catalyst-Controller-DBIC-API/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Catalyst-Controller-DBIC-API">Catalyst-Controller-DBIC-API CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">43964</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Catalyst-Controller-DBIC-API/Active/">Catalyst-Controller-DBIC-API</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
TIMB [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-222710-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.001000    </td>
  </tr>
  <tr id="CF-222711-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;09&nbsp;09:49:59&nbsp;2009</span>
    <span class="description">TIMB [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> I&#39;d like _format_search&#40;&#41; to be more granular</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;d like _format_search&#40;&#41; to be more granular. Specifically I&#39;d like this line:

my %search_params = map { &#40;$base&#41; ? join&#40;&#39;.&#39;, $base, $_&#41; : $_ =&gt; $params-&gt;{$_} } grep { exists 
$params-&gt;{$_} } $source-&gt;columns;

to become something like:

my %search_params = $self-&gt;_map_search_params_to_condition&#40;$p&#41;;

&#40;I&#39;ve given this wishlist severity, but I&#39;d be grateful if it could get into a release soon.&#41;

I&#39;d also like to see $c passed into _format_search and _map_search_params_to_condition, 
though that&#39;s less important.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;18&nbsp;08:27:06&nbsp;2009</span>
    <span class="description">LSAUNDERS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Mar 09 09:49:59 2009, TIMB wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;d like _format_search&#40;&#41; to be more granular. Specifically I&#39;d like
&gt; this line:
&gt; 
&gt; my %search_params = map { &#40;$base&#41; ? join&#40;&#39;.&#39;, $base, $_&#41; : $_ =&gt;
&gt; $params-&gt;{$_} } grep { exists
&gt; $params-&gt;{$_} } $source-&gt;columns;
&gt; 
&gt; to become something like:
&gt; 
&gt; my %search_params = $self-&gt;_map_search_params_to_condition&#40;$p&#41;;
&gt; 
&gt; &#40;I&#39;ve given this wishlist severity, but I&#39;d be grateful if it could
&gt; get into a release soon.&#41;
&gt; 
&gt; I&#39;d also like to see $c passed into _format_search and
&gt; _map_search_params_to_condition,
&gt; though that&#39;s less important.
&gt; 
</div>
i have a solution for this, but it is not exactly the one described here
since the _format_search method has changed since the last release and
is not quite so simple.

i believe that the problem you wanted to solve is to allow custom
parameters to be passed through so that you could latch on to them in
your resultset methods. currently this is not possible as anything that
is not a real column is ignored.

i have decided that i would like to achieve this by allowing the columns
that are valid to be configurable. this has the added advantage that
searchable columns can then also be restricted. for example:

package RestTest::Controller::API::RPC::TrackExposed;

...

__PACKAGE__-&gt;config
    &#40; ...,
      list_search_exposes =&gt; [qw/position title custom_column/],
      &#41;;

and then in your custom resultset:

package RestTest::Schema::ResultSet::Track;

use base &#39;RestTest::Schema::ResultSet&#39;;

sub search {
  my $self = shift;
  my &#40;$clause, $params&#41; = @_;

  # test custom attrs
  if &#40;my $pretend = delete $clause-&gt;{custom_column}&#41; {
    $clause-&gt;{&#39;cd.year&#39;} = $pretend;
  }
  my $rs = $self-&gt;SUPER::search&#40;@_&#41;;    
}

This functionality is currently in svn*, so feel free to test. it will
be released as soon as ticket 44010 is resolved.

*
<span class="clickylink"><a target="new" rel="nofollow" href="http://dev.catalystframework.org/repos/Catalyst/Catalyst-Controller-DBIC-API/">http://dev.catalystframework.org/repos/Catalyst/Catalyst-Controller-DBIC-API/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;18&nbsp;08:27:06&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;18&nbsp;10:43:02&nbsp;2009</span>
    <span class="description">TIMB [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ideally I&#39;d like to be able to allow patterns, like /^_.*_$/ so each class doesn&#39;t have to explicitly 
know what&#39;s possible, but I think what you have now would work for me.

Thanks.

p.s. The indentation is wacky in several places when viewed with standard tab stops &#40;such as via 
a web browser, cat, less, printer etc etc :-&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;19&nbsp;05:15:57&nbsp;2009</span>
    <span class="description">LSAUNDERS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Mar 18 10:43:02 2009, TIMB wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Ideally I&#39;d like to be able to allow patterns, like /^_.*_$/ so each
&gt; class doesn&#39;t have to explicitly
&gt; know what&#39;s possible, but I think what you have now would work for me.
&gt; 
&gt; Thanks.
&gt; 
&gt; p.s. The indentation is wacky in several places when viewed with
&gt; standard tab stops &#40;such as via
&gt; a web browser, cat, less, printer etc etc :-&#41;
</div>
I have released the new list_search_exposes feature in 1.002000 which
was shipped to CPAN yesterday:
<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~lsaunders/Catalyst-Controller-DBIC-API-1.002000/lib/Catalyst/Controller/DBIC/API.pm#list_search_exposes">http://search.cpan.org/~lsaunders/Catalyst-Controller-DBIC-API-1.002000/lib/Catalyst/Controller/DBIC/API.pm#list_search_exposes</a></span>

Also you might consider providing the new setup_dbic_args_method which
will allow you to mess with the generated $params, and $attrs before
they are passed to $rs-&gt;search:
<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~lsaunders/Catalyst-Controller-DBIC-API-1.002000/lib/Catalyst/Controller/DBIC/API.pm#setup_dbic_args_method">http://search.cpan.org/~lsaunders/Catalyst-Controller-DBIC-API-1.002000/lib/Catalyst/Controller/DBIC/API.pm#setup_dbic_args_method</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;19&nbsp;05:15:58&nbsp;2009</span>
    <span class="description">LSAUNDERS [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
