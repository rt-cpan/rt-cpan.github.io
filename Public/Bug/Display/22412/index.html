<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #22412 for RPM-VersionSort: Incorrect comparisons of numeric &#38; non-numeric segments</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #22412 for RPM-VersionSort: Incorrect comparisons of numeric &#38; non-numeric segments</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/RPM-VersionSort/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/RPM-VersionSort/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/RPM-VersionSort/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/RPM-VersionSort/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/RPM-VersionSort">RPM-VersionSort CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">22412</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/RPM-VersionSort/Active/">RPM-VersionSort</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
rpm [...] beer.org.uk

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-28052-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-28053-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;22&nbsp;07:40:59&nbsp;2006</span>
    <span class="description">rpm [...] beer.org.uk -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Incorrect comparisons of numeric &#38; non-numeric segments</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 22 Oct 2006 12:40:29 +0100 &#40;BST&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-RPM-VersionSort [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Vic&#34; &lt;rpm [...] beer.org.uk&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The RPM::VersionSort module has a bug in the way segments are compared
when they are of different types - at present, rpmvercmp &#40;&#39;34.EL&#39;,
&#39;34.0.2.EL&#39;&#41; returns -1, and rpmvercmp &#40;&#39;34.0.2.EL&#39;, &#39;34.EL&#39;&#41; also returns
-1.

This is down to the way segments are handled in VersionSort.xs. A quick
browse through the upstream code in rpm gives this snippet :-

        oldch1 = *str1;
        *str1 = &#39;\0&#39;;
        oldch2 = *str2;
        *str2 = &#39;\0&#39;;

        /* take care of the case where the two version segments are */ /*
different types: one numeric, the other alpha &#40;i.e. empty&#41; */ if
&#40;one == str1&#41; return -1;     /* arbitrary */
        /* XXX See patch #60884 &#40;and details&#41; from bugzilla #50977. */ if
&#40;two == str2&#41; return &#40;isnum ? 1 : -1&#41;;

        if &#40;isnum&#41; {
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;22&nbsp;12:22:43&nbsp;2006</span>
    <span class="description">hag [...] linnaean.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [rt.cpan.org #22412] Incorrect comparisons of numeric &#38; non-numeric segments</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 22 Oct 2006 12:22:03 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-RPM-VersionSort [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Daniel Hagerty &lt;hag [...] linnaean.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">    Sigh.  Go, redhat.

    The perl phrase &#34;rpmvercmp&#40;&#39;x&#39;, &#39;y&#39;&#41;&#34; has a fixed meaning in time
of being the version comparison function of RPM &lt; 4.2.0.55.  Changing
it breaks the expectations of historical code, which isn&#39;t somewhere
I&#39;m willing to go &#40;having had to fix way too much historical code when
an API is changed without thought to its consequences to existing code
-- even if the old behavior was incorrect, it still has exciting
consequences&#41;.


    You should probably being using the redhat maintained RPM.pm
unless you have compelling reasons not to; I&#39;d rather see this module
called deprecated/superseded than try to fix yet another redhat mess.

    An actual attempt at a fix should present several functions: the
unchanged semantic of rpmvercmp being the algorithm of rpm &lt; 4.2.0.55,
a 3 argument function with some kind of version selector, and perhaps
a third two argument function that&#39;s fixed to using the most modern
algorithm available.  Maybe also some routines related to supported
version selectors or something...
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;22&nbsp;12:22:47&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;22&nbsp;15:23:08&nbsp;2006</span>
    <span class="description">rpm [...] beer.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #22412] Incorrect comparisons of numeric &#38;  non-numeric segments</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 22 Oct 2006 20:22:30 +0100 &#40;BST&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-RPM-VersionSort [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Vic&#34; &lt;rpm [...] beer.org.uk&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;     The perl phrase &#34;rpmvercmp&#40;&#39;x&#39;, &#39;y&#39;&#41;&#34; has a fixed meaning in time
&gt; of being the version comparison function of RPM &lt; 4.2.0.55.  Changing
&gt; it breaks the expectations of historical code, which isn&#39;t somewhere
&gt; I&#39;m willing to go &#40;having had to fix way too much historical code when
&gt; an API is changed without thought to its consequences to existing code
&gt; -- even if the old behavior was incorrect, it still has exciting
&gt; consequences&#41;.
</div>
I&#39;m a touch concerned that rpmvercmp&#40;&#39;x&#39;, &#39;y&#39;&#41; and rpmvercmp&#40;&#39;y&#39;, &#39;x&#39;&#41; can
yield the same results with x != y...

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;     You should probably being using the redhat maintained RPM.pm
&gt; unless you have compelling reasons not to;
</div>
AFAIK, there isn&#39;t one :-&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;     An actual attempt at a fix should present several functions: the
&gt; unchanged semantic of rpmvercmp being the algorithm of rpm &lt; 4.2.0.55,
&gt; a 3 argument function with some kind of version selector, and perhaps
&gt; a third two argument function that&#39;s fixed to using the most modern
&gt; algorithm available.
</div>
If I write a patch, will you incorporate it?

Vic.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;22&nbsp;18:03:58&nbsp;2006</span>
    <span class="description">hag [...] linnaean.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #22412] Incorrect comparisons of numeric &#38;  non-numeric segments</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 22 Oct 2006 18:03:20 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-RPM-VersionSort [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Daniel Hagerty &lt;hag [...] linnaean.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"> &gt; I&#39;m a touch concerned that rpmvercmp&#40;&#39;x&#39;, &#39;y&#39;&#41; and rpmvercmp&#40;&#39;y&#39;, &#39;x&#39;&#41; can
 &gt; yield the same results with x != y...
</div>
    Nonetheless, this is precisely what RPM of that vintage did, and
the point of this code is to faithfully reproduce that.  Bugs and all.

    Changing the behavior of an API &#40;especially in cases where some
aspect of the API is buggy&#41; ripples unpleasantly.  The best case is
typically to do as I suggest; invent more API with parametization for
selecting your mode of suffering, and document the problem.  Old code
that counts on the broken behavior doesn&#39;t break.  Old code that is
unaware of the breakage is no more or less broken than it already was,
and will be discovered if it causes a problem.  New code uses the
newer APIs as appropriate to it.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"> &gt; AFAIK, there isn&#39;t one :-&#41;
</div>
    There&#39;s definitely some sort of module in the RPM source I
downloaded; I *assume* that redhat actually installs it.  Even without
it, you can use the rpm shell command to produce sorts in some limited
ways &#40;don&#39;t ask me how, it was several years ago and I&#39;m blessedly not
running anything redhat derived now&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"> &gt; If I write a patch, will you incorporate it?
</div>
    Perhaps with style modifications as needed, but certainly in
essence.  Research into changes of the version sort algorithm may be
in order; I&#39;m aware of this one, but there may have been more.


    The original point of this module was to provide the version sort
algorithm to systems without any dependance on the RPM tool chain &#40;I
had code doing maint work for RPM based systems that were not
themselves RPM based&#41;.  That&#39;s sufficient reason to keep the code
alive should someone be in a similar case, but fragility vs redhat
arbitrarily changing the version sort spec will come of it.

    If you *don&#39;t* fall into the case of no RPM toolchain where you&#39;re
doing the version sort, you should be using the standard toolchain,
provided that you aren&#39;t depending on reproducing what it does on
other systems.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
