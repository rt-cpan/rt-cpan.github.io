<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #97035 for Imager: libimager-perl: FTBFS on s390x</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #97035 for Imager: libimager-perl: FTBFS on s390x</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Imager/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Imager/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Imager/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Imager/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Imager">Imager CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">97035</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Imager/Active/">Imager</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
gregoa [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-16790-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-16791-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;07&nbsp;16:44:47&nbsp;2014</span>
    <span class="description">gregoa [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> gregoa [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> libimager-perl: FTBFS on s390x</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">We have the following bug reported to the Debian package  of Imager
&#40;<span class="clickylink"><a target="new" rel="nofollow" href="https://bugs.debian.org/754125&#41;">https://bugs.debian.org/754125&#41;</a></span>:

It doesn&#39;t seem to be a bug in the packaging, so you may want to take
a look. Thanks!

------8&lt;-----------8&lt;-----------8&lt;-----------8&lt;-----------8&lt;-----

Package: libimager-perl
Version: 0.98+dfsg-2
Severity: serious

Your package has failed to build on s390x:

<span class="clickylink"><a target="new" rel="nofollow" href="https://buildd.debian.org/status/logs.php?pkg=libimager-perl&#38;arch=s390x">https://buildd.debian.org/status/logs.php?pkg=libimager-perl&#38;arch=s390x</a></span>

Excerpt from the log:

Failed 215/251 subtests 

Test Summary Report
-------------------
t/10png.t &#40;Wstat: 11 Tests: 36 Failed: 0&#41;
  Non-zero wait status: 11
  Parse errors: Bad plan.  You planned 251 tests but ran 36.
Files=2, Tests=37,  1 wallclock secs &#40; 0.02 usr  0.00 sys +  0.16
cusr  0.02 csys =  0.20 CPU&#41;
Result: FAIL
make[2]: *** [test_dynamic] Error 255

Emilio


------8&lt;-----------8&lt;-----------8&lt;-----------8&lt;-----------8&lt;-----

Additionally, I ran t/10png.t in a chroot on an s390x machine with --verbose:

------8&lt;-----------8&lt;-----------8&lt;-----------8&lt;-----------8&lt;-----
$ prove -I../blib/lib -I../blib/arch --verbose t/10png.t  
t/10png.t .. 
1..251
ok 1 - must have png format
ok 2 - write
ok 3 - read png
ok 4 - compare saved and original images
ok 5 - i_xres: 300
ok 6 - i_yres: 200
ok 7 - i_format: png
ok 8 - write tranparent
ok 9 - read transparent
ok 10 - compare saved and original transparent
ok 11 - read transparent paletted image
ok 12 - read palette_out image
ok 13 - images the same
ok 14 - set width limit 149
ok 15 - should fail read due to size limits
ok 16 - check message
ok 17 - set height limit 149
ok 18 - should fail read due to size limits
ok 19 - check message
ok 20 - set width limit 150
ok 21 - should succeed - just inside width limit
ok 22 - set height limit 150
ok 23 - should succeed - just inside height limit
ok 24 - set bytes limit 67499
ok 25 - should fail - too many bytes
ok 26 - check error message
ok 27 - set bytes limit 67500
ok 28 - should succeed - just inside bytes limit
ok 29 - check the image was loaded
ok 30 - check image matches
ok 31 - test write_multi&#40;&#41; callback
ok 32 - test write_multi&#40;&#41; callback failure
ok 33 - check failing close fails
ok 34 - check error message
ok 35 - check png in read types
ok 36 - check png in write types
Failed 215/251 subtests 

Test Summary Report
-------------------
t/10png.t &#40;Wstat: 11 Tests: 36 Failed: 0&#41;
  Non-zero wait status: 11
  Parse errors: Bad plan.  You planned 251 tests but ran 36.
Files=1, Tests=36,  1 wallclock secs &#40; 0.03 usr  0.01 sys +  0.11 cusr  0.01 csys =  0.16 CPU&#41;
Result: FAIL
------8&lt;-----------8&lt;-----------8&lt;-----------8&lt;-----------8&lt;-----


Thanks for considering,
  gregor herrmann,
  Debian Perl Group
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;07&nbsp;18:30:19&nbsp;2014</span>
    <span class="description">tony [...] develop-help.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #97035] libimager-perl: FTBFS on s390x</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 8 Jul 2014 08:30:06 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> gregor herrmann via RT &lt;bug-Imager [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Tony Cook &lt;tony [...] develop-help.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, Jul 07, 2014 at 04:44:47PM -0400, gregor herrmann via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; We have the following bug reported to the Debian package  of Imager
&gt; &#40;<span class="clickylink"><a target="new" rel="nofollow" href="https://bugs.debian.org/754125&#41;">https://bugs.debian.org/754125&#41;</a></span>:
&gt; 
&gt; It doesn&#39;t seem to be a bug in the packaging, so you may want to take
&gt; a look. Thanks!
&gt; 
</div>...
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; ok 33 - check failing close fails
&gt; ok 34 - check error message
&gt; ok 35 - check png in read types
&gt; ok 36 - check png in write types
&gt; Failed 215/251 subtests 
&gt; 
&gt; Test Summary Report
&gt; -------------------
&gt; t/10png.t &#40;Wstat: 11 Tests: 36 Failed: 0&#41;
&gt;   Non-zero wait status: 11
&gt;   Parse errors: Bad plan.  You planned 251 tests but ran 36.
&gt; Files=1, Tests=36,  1 wallclock secs &#40; 0.03 usr  0.01 sys +  0.11 cusr  0.01 csys =  0.16 CPU&#41;
&gt; Result: FAIL
</div>
This is a segmentation fault, could I please get a backtrace from it?

  $ perl Makefile.PL OPTIMIZE=-g
  $ make
  $ cd PNG
  $ gdb --args perl -Mblib t/10png.t
  ...
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">  gdb&gt; bt
</div>
Thanks,
Tony
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;07&nbsp;18:30:20&nbsp;2014</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;13&nbsp;08:27:05&nbsp;2014</span>
    <span class="description">gregoa [...] cpan.org -  Requestor GREGOA added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;13&nbsp;09:11:57&nbsp;2014</span>
    <span class="description">gregoa [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> 754125-maintonly [...] bugs.debian.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jul 07 18:30:19 2014, tony@develop-help.com wrote:

&#40;Sorry for the late reply, our bug forwarding script didn&#39;t set requestor or
cc, so I didn&#39;t see your reply.&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This is a segmentation fault, could I please get a backtrace from it?
&gt; 
&gt; $ perl Makefile.PL OPTIMIZE=-g
&gt; $ make
&gt; $ cd PNG
&gt; $ gdb --args perl -Mblib t/10png.t
&gt; ...
<div class="message-stanza open">&gt; gdb&gt; bt
</div></div>
Unfortunately this doesn&#39;t work in the s390x chroot &#40;while it works fine on
my local machine&#41;:

$ gdb --args perl -Mblib t/10png.t
GNU gdb &#40;Debian 7.7.1-2&#41; 7.7.1
[..]
Reading symbols from perl...&#40;no debugging symbols found&#41;...done.
&#40;gdb&#41; run
Starting program: /usr/bin/perl -Mblib t/10png.t
Couldn&#39;t write registers: Invalid argument.
&#40;gdb&#41; 

Same for every program I try to run under gdb. -- Ah, seems to be
<span class="clickylink"><a target="new" rel="nofollow" href="https://bugs.debian.org/728705">https://bugs.debian.org/728705</a></span>

So let&#39;s try the workaround:

$ ulimit -c unlimited
$ perl -Mblib t/10png.t
1..251
ok 1 - must have png format
# Library version 10250
ok 2 - write
ok 3 - read png
# png average mean square pixel difference: 0
ok 4 - compare saved and original images
ok 5 - i_xres: 300
ok 6 - i_yres: 200
ok 7 - i_format: png
ok 8 - write tranparent
ok 9 - read transparent
# png average mean square pixel difference: 0
ok 10 - compare saved and original transparent
ok 11 - read transparent paletted image
ok 12 - read palette_out image
ok 13 - images the same
ok 14 - set width limit 149
ok 15 - should fail read due to size limits
# file size limit - image width of 150 exceeds limit of 149
ok 16 - check message
ok 17 - set height limit 149
ok 18 - should fail read due to size limits
# file size limit - image height of 150 exceeds limit of 149
ok 19 - check message
ok 20 - set width limit 150
ok 21 - should succeed - just inside width limit
ok 22 - set height limit 150
ok 23 - should succeed - just inside height limit
ok 24 - set bytes limit 67499
ok 25 - should fail - too many bytes
# file size limit - storage size of 67500 exceeds limit of 67499
ok 26 - check error message
ok 27 - set bytes limit 67500
ok 28 - should succeed - just inside bytes limit
ok 29 - check the image was loaded
ok 30 - check image matches
ok 31 - test write_multi&#40;&#41; callback
ok 32 - test write_multi&#40;&#41; callback failure
# closecb called
ok 33 - check failing close fails
ok 34 - check error message
ok 35 - check png in read types
ok 36 - check png in write types
Segmentation fault &#40;core dumped&#41;

$ gdb perl core
[..]
Core was generated by `perl -Mblib t/10png.t&#39;.
Program terminated with signal SIGSEGV, Segmentation fault.
#0  0x00000000fcef2068 in ?? &#40;&#41;
&#40;gdb&#41; bt
#0  0x00000000fcef2068 in ?? &#40;&#41;
#1  0x000003fffcee132e in png_error &#40;&#41; from /lib/s390x-linux-gnu/libpng12.so.0
#2  0x000003fffcee169a in png_chunk_error &#40;&#41; from /lib/s390x-linux-gnu/libpng12.so.0
#3  0x000003fffcecb480 in ?? &#40;&#41; from /lib/s390x-linux-gnu/libpng12.so.0
#4  0x000003fffcecb84a in ?? &#40;&#41; from /lib/s390x-linux-gnu/libpng12.so.0
#5  0x000003fffced56cc in png_read_info &#40;&#41; from /lib/s390x-linux-gnu/libpng12.so.0
#6  0x000003fffcef2d66 in i_readpng_wiol &#40;ig=0x82af2840, flags=0&#41; at impng.c:362
#7  0x000003fffcef0da4 in XS_Imager__File__PNG_i_readpng_wiol &#40;my_perl=0x822a5010, cv=0x82aba5a0&#41; at PNG.c:195
#8  0x000003fffd37a4fa in Perl_pp_entersub &#40;&#41; from /usr/lib/libperl.so.5.18
#9  0x000003fffd3713a8 in Perl_runops_standard &#40;&#41; from /usr/lib/libperl.so.5.18
#10 0x000003fffd2f7d3a in perl_run &#40;&#41; from /usr/lib/libperl.so.5.18
#11 0x0000000080000fa2 in main &#40;&#41;

With perl-debug installed:

&#40;gdb&#41; bt
#0  0x00000000fcef2068 in ?? &#40;&#41;
#1  0x000003fffcee132e in png_error &#40;&#41; from /lib/s390x-linux-gnu/libpng12.so.0
#2  0x000003fffcee169a in png_chunk_error &#40;&#41; from /lib/s390x-linux-gnu/libpng12.so.0
#3  0x000003fffcecb480 in ?? &#40;&#41; from /lib/s390x-linux-gnu/libpng12.so.0
#4  0x000003fffcecb84a in ?? &#40;&#41; from /lib/s390x-linux-gnu/libpng12.so.0
#5  0x000003fffced56cc in png_read_info &#40;&#41; from /lib/s390x-linux-gnu/libpng12.so.0
#6  0x000003fffcef2d66 in i_readpng_wiol &#40;ig=0x82af2840, flags=0&#41; at impng.c:362
#7  0x000003fffcef0da4 in XS_Imager__File__PNG_i_readpng_wiol &#40;my_perl=0x822a5010, cv=0x82aba5a0&#41; at PNG.c:195
#8  0x000003fffd37a4fa in Perl_pp_entersub &#40;my_perl=0x822a5010&#41; at pp_hot.c:2888
#9  0x000003fffd3713a8 in Perl_runops_standard &#40;my_perl=0x822a5010&#41; at run.c:42
#10 0x000003fffd2f7d3a in S_run_body &#40;oldscope=1, my_perl=0x822a5010&#41; at perl.c:2467
#11 perl_run &#40;my_perl=0x822a5010&#41; at perl.c:2383
#12 0x0000000080000fa2 in main &#40;argc=3, argv=0x3ffffb4dcc8, env=0x3ffffb4dce8&#41; at perlmain.c:114



Cheers,
gregor
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;13&nbsp;09:24:21&nbsp;2014</span>
    <span class="description">754125-maintonly [...] bugs.debian.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Bug#754125: Info received for maintainer only &#40;[rt.cpan.org #97035] libimager-perl: FTBFS on s390x&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 13 Jul 2014 13:24:12 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Imager [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> owner [...] bugs.debian.org &#40;Debian Bug Tracking System&#41;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thank you for the additional information you have supplied regarding
this Bug report.

This is an automatically generated reply to let you know your message
has been received.

Your message has been forwarded to the package maintainers &#40;but not
other interested parties, as you requested&#41; for their attention; they
will reply in due course.

Your message has been sent to the package maintainer&#40;s&#41;:
 Debian Perl Group &lt;pkg-perl-maintainers@lists.alioth.debian.org&gt;

If you wish to submit further information on this problem, please
send it to 754125-maintonly@bugs.debian.org.

Please do not send mail to owner@bugs.debian.org unless you wish
to report a problem with the Bug-tracking system.

-- 
754125: <span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=754125">http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=754125</a></span>
Debian Bug Tracking System
Contact owner@bugs.debian.org with problems
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;13&nbsp;14:12:52&nbsp;2014</span>
    <span class="description">aurelien [...] aurel32.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> 754125-maintonly [...] bugs.debian.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #97035] libimager-perl: FTBFS on s390x</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 13 Jul 2014 20:12:38 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> gregor herrmann via RT &lt;bug-Imager [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Aurelien Jarno &lt;aurelien [...] aurel32.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun, Jul 13, 2014 at 09:11:57AM -0400, gregor herrmann via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=97035">https://rt.cpan.org/Ticket/Display.html?id=97035</a></span> &gt;
&gt; 
&gt; On Mon Jul 07 18:30:19 2014, tony@develop-help.com wrote:
&gt; 
&gt; &#40;Sorry for the late reply, our bug forwarding script didn&#39;t set requestor or
&gt; cc, so I didn&#39;t see your reply.&#41;
&gt; 
<div class="message-stanza open">&gt; &gt; This is a segmentation fault, could I please get a backtrace from it?
&gt; &gt; 
&gt; &gt; $ perl Makefile.PL OPTIMIZE=-g
&gt; &gt; $ make
&gt; &gt; $ cd PNG
&gt; &gt; $ gdb --args perl -Mblib t/10png.t
&gt; &gt; ...
<div class="message-stanza open">&gt; &gt; gdb&gt; bt
</div></div>&gt; 
&gt; Unfortunately this doesn&#39;t work in the s390x chroot &#40;while it works fine on
&gt; my local machine&#41;:
&gt; 
&gt; $ gdb --args perl -Mblib t/10png.t
&gt; GNU gdb &#40;Debian 7.7.1-2&#41; 7.7.1
&gt; [..]
&gt; Reading symbols from perl...&#40;no debugging symbols found&#41;...done.
&gt; &#40;gdb&#41; run
&gt; Starting program: /usr/bin/perl -Mblib t/10png.t
&gt; Couldn&#39;t write registers: Invalid argument.
&gt; &#40;gdb&#41; 
&gt; 
&gt; Same for every program I try to run under gdb. -- Ah, seems to be
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://bugs.debian.org/728705">https://bugs.debian.org/728705</a></span>
&gt; 
&gt; So let&#39;s try the workaround:
&gt; 
&gt; $ ulimit -c unlimited
&gt; $ perl -Mblib t/10png.t
&gt; 1..251
&gt; ok 1 - must have png format
&gt; # Library version 10250
&gt; ok 2 - write
&gt; ok 3 - read png
&gt; # png average mean square pixel difference: 0
&gt; ok 4 - compare saved and original images
&gt; ok 5 - i_xres: 300
&gt; ok 6 - i_yres: 200
&gt; ok 7 - i_format: png
&gt; ok 8 - write tranparent
&gt; ok 9 - read transparent
&gt; # png average mean square pixel difference: 0
&gt; ok 10 - compare saved and original transparent
&gt; ok 11 - read transparent paletted image
&gt; ok 12 - read palette_out image
&gt; ok 13 - images the same
&gt; ok 14 - set width limit 149
&gt; ok 15 - should fail read due to size limits
&gt; # file size limit - image width of 150 exceeds limit of 149
&gt; ok 16 - check message
&gt; ok 17 - set height limit 149
&gt; ok 18 - should fail read due to size limits
&gt; # file size limit - image height of 150 exceeds limit of 149
&gt; ok 19 - check message
&gt; ok 20 - set width limit 150
&gt; ok 21 - should succeed - just inside width limit
&gt; ok 22 - set height limit 150
&gt; ok 23 - should succeed - just inside height limit
&gt; ok 24 - set bytes limit 67499
&gt; ok 25 - should fail - too many bytes
&gt; # file size limit - storage size of 67500 exceeds limit of 67499
&gt; ok 26 - check error message
&gt; ok 27 - set bytes limit 67500
&gt; ok 28 - should succeed - just inside bytes limit
&gt; ok 29 - check the image was loaded
&gt; ok 30 - check image matches
&gt; ok 31 - test write_multi&#40;&#41; callback
&gt; ok 32 - test write_multi&#40;&#41; callback failure
&gt; # closecb called
&gt; ok 33 - check failing close fails
&gt; ok 34 - check error message
&gt; ok 35 - check png in read types
&gt; ok 36 - check png in write types
&gt; Segmentation fault &#40;core dumped&#41;
&gt; 
&gt; $ gdb perl core
&gt; [..]
&gt; Core was generated by `perl -Mblib t/10png.t&#39;.
&gt; Program terminated with signal SIGSEGV, Segmentation fault.
&gt; #0  0x00000000fcef2068 in ?? &#40;&#41;
&gt; &#40;gdb&#41; bt
&gt; #0  0x00000000fcef2068 in ?? &#40;&#41;
&gt; #1  0x000003fffcee132e in png_error &#40;&#41; from /lib/s390x-linux-gnu/libpng12.so.0
&gt; #2  0x000003fffcee169a in png_chunk_error &#40;&#41; from /lib/s390x-linux-gnu/libpng12.so.0
&gt; #3  0x000003fffcecb480 in ?? &#40;&#41; from /lib/s390x-linux-gnu/libpng12.so.0
&gt; #4  0x000003fffcecb84a in ?? &#40;&#41; from /lib/s390x-linux-gnu/libpng12.so.0
&gt; #5  0x000003fffced56cc in png_read_info &#40;&#41; from /lib/s390x-linux-gnu/libpng12.so.0
&gt; #6  0x000003fffcef2d66 in i_readpng_wiol &#40;ig=0x82af2840, flags=0&#41; at impng.c:362
&gt; #7  0x000003fffcef0da4 in XS_Imager__File__PNG_i_readpng_wiol &#40;my_perl=0x822a5010, cv=0x82aba5a0&#41; at PNG.c:195
&gt; #8  0x000003fffd37a4fa in Perl_pp_entersub &#40;&#41; from /usr/lib/libperl.so.5.18
&gt; #9  0x000003fffd3713a8 in Perl_runops_standard &#40;&#41; from /usr/lib/libperl.so.5.18
&gt; #10 0x000003fffd2f7d3a in perl_run &#40;&#41; from /usr/lib/libperl.so.5.18
&gt; #11 0x0000000080000fa2 in main &#40;&#41;
&gt; 
&gt; With perl-debug installed:
&gt; 
&gt; &#40;gdb&#41; bt
&gt; #0  0x00000000fcef2068 in ?? &#40;&#41;
&gt; #1  0x000003fffcee132e in png_error &#40;&#41; from /lib/s390x-linux-gnu/libpng12.so.0
&gt; #2  0x000003fffcee169a in png_chunk_error &#40;&#41; from /lib/s390x-linux-gnu/libpng12.so.0
&gt; #3  0x000003fffcecb480 in ?? &#40;&#41; from /lib/s390x-linux-gnu/libpng12.so.0
&gt; #4  0x000003fffcecb84a in ?? &#40;&#41; from /lib/s390x-linux-gnu/libpng12.so.0
&gt; #5  0x000003fffced56cc in png_read_info &#40;&#41; from /lib/s390x-linux-gnu/libpng12.so.0
&gt; #6  0x000003fffcef2d66 in i_readpng_wiol &#40;ig=0x82af2840, flags=0&#41; at impng.c:362
&gt; #7  0x000003fffcef0da4 in XS_Imager__File__PNG_i_readpng_wiol &#40;my_perl=0x822a5010, cv=0x82aba5a0&#41; at PNG.c:195
&gt; #8  0x000003fffd37a4fa in Perl_pp_entersub &#40;my_perl=0x822a5010&#41; at pp_hot.c:2888
&gt; #9  0x000003fffd3713a8 in Perl_runops_standard &#40;my_perl=0x822a5010&#41; at run.c:42
&gt; #10 0x000003fffd2f7d3a in S_run_body &#40;oldscope=1, my_perl=0x822a5010&#41; at perl.c:2467
&gt; #11 perl_run &#40;my_perl=0x822a5010&#41; at perl.c:2383
&gt; #12 0x0000000080000fa2 in main &#40;argc=3, argv=0x3ffffb4dcc8, env=0x3ffffb4dce8&#41; at perlmain.c:114
</div>
A quick debugging seems to show the problem is on the libpng side.
Rebuilding it makes the problem disappear. It looks like it is due to
the same issue we are doing this transition, ie the libpng structure
expose a jmp_buf structure. I don&#39;t really now what to do...

-- 
Aurelien Jarno                          GPG: 4096R/1DDD8C9B
aurelien@aurel32.net                 <span class="clickylink"><a target="new" rel="nofollow" href="http://www.aurel32.net">http://www.aurel32.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;13&nbsp;18:36:26&nbsp;2014</span>
    <span class="description">gregoa [...] debian.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> bug-Imager [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: Bug#754125: [rt.cpan.org #97035] libimager-perl: FTBFS on s390x</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 14 Jul 2014 00:36:03 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Aurelien Jarno &lt;aurelien [...] aurel32.net&gt;, 754125-maintonly [...] bugs.debian.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> gregor herrmann &lt;gregoa [...] debian.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun, 13 Jul 2014 20:12:38 +0200, Aurelien Jarno wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; &#40;gdb&#41; bt
&gt; &gt; #0  0x00000000fcef2068 in ?? &#40;&#41;
&gt; &gt; #1  0x000003fffcee132e in png_error &#40;&#41; from /lib/s390x-linux-gnu/libpng12.so.0
&gt; &gt; #2  0x000003fffcee169a in png_chunk_error &#40;&#41; from /lib/s390x-linux-gnu/libpng12.so.0
&gt; &gt; #3  0x000003fffcecb480 in ?? &#40;&#41; from /lib/s390x-linux-gnu/libpng12.so.0
&gt; &gt; #4  0x000003fffcecb84a in ?? &#40;&#41; from /lib/s390x-linux-gnu/libpng12.so.0
&gt; &gt; #5  0x000003fffced56cc in png_read_info &#40;&#41; from /lib/s390x-linux-gnu/libpng12.so.0
&gt; &gt; #6  0x000003fffcef2d66 in i_readpng_wiol &#40;ig=0x82af2840, flags=0&#41; at impng.c:362
&gt; &gt; #7  0x000003fffcef0da4 in XS_Imager__File__PNG_i_readpng_wiol &#40;my_perl=0x822a5010, cv=0x82aba5a0&#41; at PNG.c:195
&gt; &gt; #8  0x000003fffd37a4fa in Perl_pp_entersub &#40;my_perl=0x822a5010&#41; at pp_hot.c:2888
&gt; &gt; #9  0x000003fffd3713a8 in Perl_runops_standard &#40;my_perl=0x822a5010&#41; at run.c:42
&gt; &gt; #10 0x000003fffd2f7d3a in S_run_body &#40;oldscope=1, my_perl=0x822a5010&#41; at perl.c:2467
&gt; &gt; #11 perl_run &#40;my_perl=0x822a5010&#41; at perl.c:2383
&gt; &gt; #12 0x0000000080000fa2 in main &#40;argc=3, argv=0x3ffffb4dcc8, env=0x3ffffb4dce8&#41; at perlmain.c:114
</div>&gt; 
&gt; A quick debugging seems to show the problem is on the libpng side.
&gt; Rebuilding it makes the problem disappear. 
</div>
Thanks for looking into this further!

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It looks like it is due to
&gt; the same issue we are doing this transition, ie the libpng structure
&gt; expose a jmp_buf structure. I don&#39;t really now what to do...
</div>
So I guess the CPAN RT ticket can be closed, this is not a problem in
Imager but some nice mess we have in Debian :/

Sorry for the noise, Tony.


Cheers,
gregor 

-- 
 .&#39;&#39;`.  Homepage: <span class="clickylink"><a target="new" rel="nofollow" href="http://info.comodo.priv.at/">http://info.comodo.priv.at/</a></span> - OpenPGP key 0xBB3A68018649AA06
 : :&#39; : Debian GNU/Linux user, admin, and developer  -  <span class="clickylink"><a target="new" rel="nofollow" href="http://www.debian.org/">http://www.debian.org/</a></span>
 `. `&#39;  Member of VIBE!AT &#38; SPI, fellow of the Free Software Foundation Europe
   `-   NP: Neil Young: Heart Of Gold
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;15&nbsp;08:23:25&nbsp;2014</span>
    <span class="description">TONYC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Jul 13 18:36:26 2014, gregoa@debian.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sun, 13 Jul 2014 20:12:38 +0200, Aurelien Jarno wrote:
<div class="message-stanza open">&gt; &gt; A quick debugging seems to show the problem is on the libpng side.
&gt; &gt;  Rebuilding it makes the problem disappear.
</div>&gt; 
&gt; Thanks for looking into this further!
&gt; 
<div class="message-stanza open">&gt; &gt; It looks like it is due to
&gt; &gt; the same issue we are doing this transition, ie the libpng structure
&gt; &gt; expose a jmp_buf structure. I don&#39;t really now what to do...
</div>&gt; 
&gt; So I guess the CPAN RT ticket can be closed, this is not a problem in
&gt; Imager but some nice mess we have in Debian :/
&gt; 
&gt; Sorry for the noise, Tony.
</div>
Thanks, I&#39;ll admit I couldn&#39;t see any way to resolve this from my end - only tests changed in Imager&#39;s PNG code between 0.98 and 0.99.

Closing.

Tony
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;15&nbsp;08:23:26&nbsp;2014</span>
    <span class="description">TONYC [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
