<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #35189 for Sys-Syslog: Sys::Syslog fails for unknown reasons.</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #35189 for Sys-Syslog: Sys::Syslog fails for unknown reasons.</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Sys-Syslog">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Sys-Syslog">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Sys-Syslog">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Sys-Syslog">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Sys-Syslog">Sys-Syslog CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">35189</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Sys-Syslog">Sys-Syslog</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
david.verdin [...] cru.fr

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-30616-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-30617-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.25    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




Log.pm<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/451048/221625/Log.pm">
Fri Apr 18 11:50:01 2008 (13.3k) by david.verdin [...] cru.fr
</a>
</font></li>
</ul>


sympa.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/451048/221626/sympa.pl">
Fri Apr 18 11:50:01 2008 (83.3k) by david.verdin [...] cru.fr
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=35189">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-451048" href="/Public/Bug/Display.html?id=35189#txn-451048">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;18&nbsp;11:50:01&nbsp;2008</span>
    <span class="description">david.verdin [...] cru.fr -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Sys::Syslog fails for unknown reasons.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 18 Apr 2008 16:56:09 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Sys-Syslog [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> David Verdin &lt;david.verdin [...] cru.fr&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/451048/221624/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/221624">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

I am one of the developers of the mailing list manager Sympa 
&#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.sympa.org">http://www.sympa.org</a></span>&#41;. It is entirely written in perl.
We recently added a control over our logs so that, if a log fail, the 
server administrator is warned.

Some users updated their version of Sys:Syslog to the latest &#40;0.24&#41; and 
reported that they received a considerable amount of warning regarding 
failures to log with the error:

syslog: invalid level/facility: info at /home/sympa/bin/Log.pm line 101

This also happens with the &#34;notice&#34; facility. No other facility is 
concerned.

That&#39;s when we found that, sometimes, the xlate function of Sys::Syslog 
seems to be failing to return the correct value. It is hard to determine 
the exact causes, but I can describe the main symptoms:

I added some traces in xlate:

# xlate&#40;&#41;
# -----
# private function to translate names to numeric values
#
sub xlate {
    my&#40;$name&#41; = @_;
    return $name+0 if $name =~ /^\s*\d+\s*$/;
    $name = uc $name;
    $name = &#34;LOG_$name&#34; unless $name =~ /^LOG_/;
    $name = &#34;Sys::Syslog::$name&#34;;
    # Can&#39;t have just eval { &#38;$name } || -1 because some LOG_XXX may be 
zero.
    my $value = eval { no strict &#39;refs&#39;; &#38;$name };
    open DUMP, &#34;&gt;&gt;/tmp/out&#34;;
    print DUMP 
&#34;###########################################################\n&#34;;
    print DUMP &#34;name: $name\n&#34;;
    print DUMP &#34;value: $value\n&#34;;
    print DUMP &#34;error:$@\n&#34;;
    close DUMP;
    $@ = &#34;&#34;;
    return defined $value ? $value : -1;
}

And this is some of the output I obtained when launchin the sympa.pl 
script &#40;see attached file&#41;:

###########################################################
name: Sys::Syslog::LOG_ERR
value: 3
error:
###########################################################
name: Sys::Syslog::LOG_INFO
value:
error:Bizarre copy of CODE in leavesub at 
/usr/lib/perl5/5.8.8/i386-linux-thread-multi/Sys/Syslog.pm line 474.

###########################################################
name: Sys::Syslog::LOG_INFO
value:
error:Bizarre copy of CODE in leavesub at 
/usr/lib/perl5/5.8.8/i386-linux-thread-multi/Sys/Syslog.pm line 474.

###########################################################
name: Sys::Syslog::LOG_ERR
value: 3
error:
###########################################################
name: Sys::Syslog::LOG_LOCAL5
value: 168
error:
###########################################################
name: Sys::Syslog::LOG_INFO
value:
error:Bizarre copy of CODE in leavesub at 
/usr/lib/perl5/5.8.8/i386-linux-thread-multi/Sys/Syslog.pm line 474.

###########################################################
name: Sys::Syslog::LOG_NOTICE
value: 5
error:
###########################################################
name: Sys::Syslog::LOG_LOCAL5
value: 168
error:
###########################################################
name: Sys::Syslog::LOG_NOTICE
value: 5
error:
###########################################################
name: Sys::Syslog::LOG_LOCAL5
value: 168
error:
###########################################################
name: Sys::Syslog::LOG_INFO
value:
error:Bizarre copy of CODE in leavesub at 
/usr/lib/perl5/5.8.8/i386-linux-thread-multi/Sys/Syslog.pm line 474.

###########################################################
name: Sys::Syslog::LOG_NOTICE
value: 5
error:
###########################################################
name: Sys::Syslog::LOG_LOCAL5
value: 168
error:

So this is the elements I have:
 1- the error happens with &#34;info&#34; and &#34;notice&#34; log levels only;
 2- The error is not systematic. in the previous output, some logs with 
the level &#34;notice&#34; work and other don&#39;t.
 3- in Sympa, the logs are handled through a specialized module, Log.pm 
&#40;attached&#41; which is called in the Sympa dameons by the line &#34;use Log;&#34;. 
This module imports Sys::syslog with the line &#34;use Sys::Syslog;&#34;.
 4- A simple script just calling ths syslog function doesn&#39;t give any 
bad result. The logs are performed without any problem.
 5- It looks like the &#34;eval { no strict &#39;refs&#39;; &#38;$name }&#34; doesn&#39;t always 
work and it is probably related to the way we import the Syslog module. 
But I have no clue what exactly this line is supposed to do. I suppose 
that it returns the indice of the entry containing the value of the log 
level in the array corresponding to the &#34;macros&#34; export tag. Bu I must 
admit that what you wrote is far beyond my comprehension of perl. I 
really don&#39;t know what happens when you evaluates &#34;&#38;$name&#34;.

So do you have any clue about what&#39;s happening and how it is possible 
that, in the same script, we can successively fail and succeed in 
recognizing the log level?

Regards,

-- 
David Verdin
ComitÃ© rÃ©seau des universitÃ©s
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/451048/221625/Log.pm">Download Log.pm</a><br />
<span class="downloadcontenttype">text/x-perl 13.3k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/451048/221626/sympa.pl">Download sympa.pl</a><br />
<span class="downloadcontenttype">text/x-perl 83.3k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-451259" href="/Public/Bug/Display.html?id=35189#txn-451259">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;18&nbsp;19:37:44&nbsp;2008</span>
    <span class="description">SAPER [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #35189] Sys::Syslog fails for unknown reasons. </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 19 Apr 2008 01:37:19 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Sys-Syslog [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> SÃ©bastien Aperghis-Tramoni &lt;saper [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/451259/221762/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/221762">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

David Verdin wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I am one of the developers of the mailing list manager Sympa
&gt; &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.sympa.org">http://www.sympa.org</a></span>&#41;. It is entirely written in perl.
&gt; We recently added a control over our logs so that, if a log fail, the
&gt; server administrator is warned.
&gt;
&gt; Some users updated their version of Sys:Syslog to the latest &#40;0.24&#41;  
&gt; and
&gt; reported that they received a considerable amount of warning regarding
&gt; failures to log with the error:
&gt;
&gt; syslog: invalid level/facility: info at /home/sympa/bin/Log.pm line  
&gt; 101
</div>
Hmm.. a problem is that there is nothing at line 101 that calls syslog 
&#40;&#41;. I see 4 calls to syslog&#40;&#41; in Log.pm, at lines 50, 51, 111 and  
113. The faulty call is probably the one at line 111, but to be sure,  
could you re-run your program with Devel::SimpleTrace loaded?

Or could you give me the steps to reproduce this problem?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This also happens with the &#34;notice&#34; facility. No other facility is
&gt; concerned.
</div>
I don&#39;t understand why the LOG_INFO and LOG_NOTICE facilities fails,  
and why only these. They&#39;re both used in the tests so a problem with  
these should have been detected at this stage.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; That&#39;s when we found that, sometimes, the xlate function of  
&gt; Sys::Syslog
&gt; seems to be failing to return the correct value. It is hard to  
&gt; determine
&gt; the exact causes, but I can describe the main symptoms:
&gt;
&gt; I added some traces in xlate:[...]
&gt; And this is some of the output I obtained when launchin the sympa.pl
&gt; script &#40;see attached file&#41;:
&gt;
&gt; ###########################################################
&gt; name: Sys::Syslog::LOG_INFO
&gt; value:
&gt; error:Bizarre copy of CODE in leavesub at
&gt; /usr/lib/perl5/5.8.8/i386-linux-thread-multi/Sys/Syslog.pm line 474.
</div>
Ah.. A &#34;biazrre copy&#34;.. AIUI, it&#39;s typically the kind of error that  
indicate a small bug in Perl leaking to user code. Unfortunately, it  
quite hard to understand at my level. I&#39;m trying to write a reduced  
snippet that could expose the same problem, alas with no luck for now.

Here again, the same trace with Devel::SimpleTrace could provide more  
information.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So this is the elements I have:
&gt;  1- the error happens with &#34;info&#34; and &#34;notice&#34; log levels only;
&gt;  2- The error is not systematic. in the previous output, some logs  
&gt; with
&gt; the level &#34;notice&#34; work and other don&#39;t.
&gt;  3- in Sympa, the logs are handled through a specialized module,  
&gt; Log.pm
&gt; &#40;attached&#41; which is called in the Sympa dameons by the line &#34;use  
&gt; Log;&#34;.
&gt; This module imports Sys::syslog with the line &#34;use Sys::Syslog;&#34;.
</div>
This is fine per se but reading the module, and particularly the  
functions related to logging, I find them awfully complex just to  
wrap Sys::Syslog. I guess like they were written for old versions of  
this module. I also see you&#39;re using setlogsock&#40;&#41;, which is now  
discouraged because Sys::Syslog now usually know better than the user  
how to send messages on the running system. &#40;I see the actual value  
comes from user configuration, but haven&#39;t checked what is the  
default value. I would strongly suggest &#34;native&#34;.&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  4- A simple script just calling ths syslog function doesn&#39;t give any
&gt; bad result. The logs are performed without any problem.
&gt;  5- It looks like the &#34;eval { no strict &#39;refs&#39;; &#38;$name }&#34; doesn&#39;t  
&gt; always
&gt; work and it is probably related to the way we import the Syslog  
&gt; module.
&gt; But I have no clue what exactly this line is supposed to do. I suppose
&gt; that it returns the indice of the entry containing the value of the  
&gt; log
&gt; level in the array corresponding to the &#34;macros&#34; export tag. Bu I must
&gt; admit that what you wrote is far beyond my comprehension of perl. I
&gt; really don&#39;t know what happens when you evaluates &#34;&#38;$name&#34;.
</div>
I am not the original author of Sys::Syslog, just the current  
maintainer. This module was originally written by Larry Wall, Tom  
Christiansen, and many other people.

What this line does is using a symbolic reference, which are strongly  
discouraged and no allowed under &#34;use strict&#34;. Hence the &#34;no strict  
&#39;refs&#39;&#34; inside the eval. It&#39;s a ugly hack, but I don&#39;t know how to  
replace it with a less exotic code.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So do you have any clue about what&#39;s happening and how it is possible
&gt; that, in the same script, we can successively fail and succeed in
&gt; recognizing the log level?
</div>
As I said, currently, I have no idea why you see failures with &#40;and  
only with&#41; the LOG_INFO and the LOG_NOTICE facilities.

Another thing you may try is to use this version of xlate&#40;&#41;:

sub xlate {
     my&#40;$name&#41; = @_;
     return $name+0 if $name =~ /^\s*\d+\s*$/;
     $name = uc $name;
     $name = &#34;LOG_$name&#34; unless $name =~ /^LOG_/;
     $name = &#34;Sys::Syslog::$name&#34;;
     # Can&#39;t have just eval { &#38;$name } || -1 because some LOG_XXX may  
be zero.
     local $@;
     my $value = eval { no strict &#39;refs&#39;; &#38;$name };
     return defined $value ? $value : -1;
}

FYI, the line that resets $@ was added in version 0.22 while trying  
to address CPAN-RT#29875


-- 
SÃ©bastien Aperghis-Tramoni

Close the world, txEn eht nepO.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-451260" href="/Public/Bug/Display.html?id=35189#txn-451260">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;18&nbsp;19:37:46&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-451728" href="/Public/Bug/Display.html?id=35189#txn-451728">#</a>      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;19&nbsp;21:59:56&nbsp;2008</span>
    <span class="description">SAPER [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #35189] Sys::Syslog fails for unknown reasons. </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 20 Apr 2008 03:59:43 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Sys-Syslog [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> SÃ©bastien Aperghis-Tramoni &lt;saper [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/451728/222015/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/222015">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 366b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

I made several eval&#40;&#41;-related changes in the code, and even  
chainsawed the one in xlate&#40;&#41;, so there is a good possibility that  
the problem seen with Sympa will disappear. Could you test with the  
development version of Sys::Syslog, available at svn:// 
svn.mongueurs.net/Sys-Syslog ?


-- 
SÃ©bastien Aperghis-Tramoni

Close the world, txEn eht nepO.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-453322" href="/Public/Bug/Display.html?id=35189#txn-453322">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;23&nbsp;07:52:21&nbsp;2008</span>
    <span class="description">david.verdin [...] cru.fr -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #35189] Sys::Syslog fails for unknown reasons.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 23 Apr 2008 13:51:59 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Sys-Syslog [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> David Verdin &lt;david.verdin [...] cru.fr&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/453322/222829/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/222829">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 712b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">This seem to be working like a charm to me! No more errors since this 
morning.
When do you think it could be released as a new version? We need to 
inform our users about the fix.

Anyway, thanks for this great work!

Cheers,

David

SÃ©bastien Aperghis-Tramoni via RT a Ã©crit :
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=35189">http://rt.cpan.org/Ticket/Display.html?id=35189</a></span> &gt;
&gt;
&gt; Hello,
&gt;
&gt; I made several eval&#40;&#41;-related changes in the code, and even  
&gt; chainsawed the one in xlate&#40;&#41;, so there is a good possibility that  
&gt; the problem seen with Sympa will disappear. Could you test with the  
&gt; development version of Sys::Syslog, available at svn:// 
&gt; svn.mongueurs.net/Sys-Syslog ?
&gt;
&gt;
&gt;   
</div>
-- 
David Verdin
ComitÃ© rÃ©seau des universitÃ©s
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-453412" href="/Public/Bug/Display.html?id=35189#txn-453412">#</a>      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;23&nbsp;09:17:24&nbsp;2008</span>
    <span class="description">maddingue [...] free.fr -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #35189] Sys::Syslog fails for unknown reasons.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 23 Apr 2008 15:17:04 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Sys-Syslog [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> SÃ©bastien Aperghis-Tramoni &lt;maddingue [...] free.fr&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/453412/222879/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/222879">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 574b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">David Verdin wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This seem to be working like a charm to me! No more errors since this
&gt; morning.
&gt; When do you think it could be released as a new version? We need to
&gt; inform our users about the fix.
</div>
Given there are already three bugfixes in the current devel version,
I consider it a good time to make a release. If tests pass on all the
combination of Perl/OS I have access to, I&#39;ll make a release before
the end of the week.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Anyway, thanks for this great work!
</div>
You&#39;re welcome.


Best Regards

-- 
SÃ©bastien Aperghis-Tramoni

Close the world, txEn eht nepO.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-471423" href="/Public/Bug/Display.html?id=35189#txn-471423">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;07&nbsp;21:09:47&nbsp;2008</span>
    <span class="description">maddingue [...] free.fr -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #35189] Sys::Syslog fails for unknown reasons.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 8 Jun 2008 03:09:54 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Sys-Syslog [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> SÃ©bastien Aperghis-Tramoni &lt;maddingue [...] free.fr&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/471423/232477/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/232477">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 130b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">This issue is fixed in version 0.25.  Thanks for your report.


-- 
SÃ©bastien Aperghis-Tramoni

Close the world, txEn eht nepO.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-471434" href="/Public/Bug/Display.html?id=35189#txn-471434">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;07&nbsp;21:19:34&nbsp;2008</span>
    <span class="description">SAPER [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-471436" href="/Public/Bug/Display.html?id=35189#txn-471436">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;07&nbsp;21:19:35&nbsp;2008</span>
    <span class="description">SAPER [...] cpan.org -  Fixed in 0.25 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.567519</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
