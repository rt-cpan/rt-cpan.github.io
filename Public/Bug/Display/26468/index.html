<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #26468 for Authen-Simple-HTTP: Configure agent from httpd.conf, choose method</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #26468 for Authen-Simple-HTTP: Configure agent from httpd.conf, choose method</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Authen-Simple-HTTP/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Authen-Simple-HTTP/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Authen-Simple-HTTP/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Authen-Simple-HTTP/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Authen-Simple-HTTP">Authen-Simple-HTTP CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">26468</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">new</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Authen-Simple-HTTP/Active/">Authen-Simple-HTTP</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
GIFF [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-3264-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-3265-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;18&nbsp;01:07:53&nbsp;2007</span>
    <span class="description">GIFF [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Configure agent from httpd.conf, choose method</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Here&#39;s another patch.  This adds two features to Authen::Simple::HTTP.

First, it takes a string argument agentclass, which can be set in
httpd.conf.  It describes how the agent should be created.  Here&#39;s an
excerpt from the docs:

  If the class name is alone, the object will be created by calling its
  constructor new.  If it is followed by a space but no opening
  parentheses, the remainder of the string will be treated as a
  space-seperated list of arguments to be passed to the constructor
  C&lt;new&gt;.  If it is followed by a space, an optional constructor name,
  then a parenthesized string, the object will be created by calling the
  named constructor, or new if no constructor is named, and
  processing the remainder of the string as arguments to the constructor
  with eval.

  Mostly all of this allows you to create an agent from your httpd.conf
  file.  All of these will create an agent with keep_alive turned off:
  
      PerlSetVar AuthenSimpleMyHTTP_agentclass &#34;LWP::UserAgent
new&#40;keep_alive =&gt; 1&#41;&#34;
      PerlSetVar AuthenSimpleMyHTTP_agentclass &#34;LWP::UserAgent
&#40;keep_alive =&gt; 1&#41;&#34;
      PerlSetVar AuthenSimpleMyHTTP_agentclass &#34;LWP::UserAgent keep_alive 1&#34;

Second, it creates a string argument &#34;method&#34; which controls the method
to use in testing the authentication.  It defaults to &#34;head&#34;, but can be
set to &#34;get&#34;.

Both of these changes were necessary to authenticate to a quirky backend
Web server, which did not work with cookies enabled, and also did not
respond properly to HEAD requests.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> authen-simple-httpd-sg.patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- HTTP.pm	2007-04-17 23:29:56.000000000 -0400
+++ MyHTTP.pm	2007-04-18 01:01:47.000000000 -0400
@@ -23,9 +23,58 @@
             timeout    =&gt; 30
         &#41;,
         optional =&gt; 1
-    }
+    },
+    agentclass =&gt; {
+	    type     =&gt; Params::Validate::SCALAR,
+	    optional =&gt; 1
+    },
+    method =&gt; {
+  	    type     =&gt; Params::Validate::SCALAR,
+	    default  =&gt; &#39;head&#39;
+    },
 }&#41;;
 
+our %agentclass_loaded;
+our %agent_cache;
+
+sub init
+{
+  my $class = shift;
+  my $self = $class-&gt;SUPER::init&#40;@_&#41;;
+  if &#40;$self-&gt;agentclass&#41; {
+    if &#40;$agent_cache{$self-&gt;agentclass}&#41; {
+      $self-&gt;agent&#40;$agent_cache{$self-&gt;agentclass}&#41;;
+    } else {
+      my&#40;$agentclass,$args&#41;=split&#40;&#39; &#39;,$self-&gt;agentclass,2&#41;;
+      if &#40;!$agentclass_loaded{$agentclass}&#41; {
+	eval &#34;use $agentclass;&#34;;
+	if &#40;$@&#41; {
+	  die &#34;Error including &#39;@{[$self-&gt;agentclass]}&#39;: $@&#34;;
+	}
+      }
+      if &#40;$args =~ /^\s*&#40;\w*&#41;\s*\&#40;&#40;.*&#41;\&#41;\s*$/&#41;
+      {
+	if &#40;$1 eq &#39;&#39;&#41; { $args = &#34;new$args&#34;; }
+	my $dothis = &#34;\$self-&gt;agent&#40;$agentclass-&gt;$args&#41;;&#34;;
+	eval $dothis;
+	if &#40;$@&#41; {
+	  die &#34;Error executing &#39;$dothis&#39;: $@&#34;;
+	}
+      }
+      else
+      {
+	$self-&gt;agent&#40;$agentclass-&gt;new&#40;split&#40;&#39; &#39;,$args&#41;&#41;&#41;;
+      }
+      $agent_cache{$self-&gt;agentclass}=$self-&gt;agent;
+    }
+  }
+
+  if &#40;!$self-&gt;agent-&gt;can&#40;$self-&gt;method&#41;&#41; {
+    die &#34;Invalid method &#39;@{[$self-&gt;method]}&#39; for &#39;${[$self-&gt;agent]}&#39;\n&#34;;
+  }
+  $self;
+}
+
 sub check {
     my &#40; $self, $username, $password &#41; = @_;
 
@@ -36,6 +85,7 @@
     my $override = sprintf &#39;%s::get_basic_credentials&#39;, ref $self-&gt;agent;
     my $response = undef;
     my $url      = $self-&gt;url;
+    my $method = $self-&gt;method;
 
     # First make sure we receive a challenge
 
@@ -47,7 +97,7 @@
             return &#40; undef, undef &#41;;
         };
 
-        $response = $self-&gt;agent-&gt;head&#40;$url&#41;;
+        $response = $self-&gt;agent-&gt;$method&#40;$url&#41;;
     }
 
     if &#40; my $warning = $response-&gt;header&#40;&#39;Client-Warning&#39;&#41; &#41; {
@@ -76,7 +126,7 @@
             return &#40; $username, $password &#41;;
         };
 
-        $response = $self-&gt;agent-&gt;head&#40;$url&#41;;
+        $response = $self-&gt;agent-&gt;$method&#40;$url&#41;;
     }
 
     if &#40; $response-&gt;code == 401 &#41; {
@@ -171,8 +221,35 @@
 
     log =&gt; Log::Log4perl-&gt;get_logger&#40;&#39;Authen::Simple::HTTP&#39;&#41;
 
+=item * agentclass
+
+String describing the class of an agent to be created and used.
+
+If the class name is alone, the object will be created by calling its
+constructor C&lt;new&gt;.  If it is followed by a space but no opening
+parentheses, the remainder of the string will be treated as a
+space-seperated list of arguments to be passed to the constructor
+C&lt;new&gt;.  If it is followed by a space, an optional constructor name,
+then a parenthesized string, the object will be created by calling the
+named constructor, or C&lt;new&gt; if no constructor is named, and
+processing the remainder of the string as arguments to the constructor
+with C&lt;eval&gt;.
+
+Mostly all of this allows you to create an agent from your httpd.conf
+file.  All of these will create an agent with keep_alive turned off:
+
+    PerlSetVar AuthenSimpleMyHTTP_agentclass &#34;LWP::UserAgent new&#40;keep_alive =&gt; 1&#41;&#34;
+    PerlSetVar AuthenSimpleMyHTTP_agentclass &#34;LWP::UserAgent &#40;keep_alive =&gt; 1&#41;&#34;
+    PerlSetVar AuthenSimpleMyHTTP_agentclass &#34;LWP::UserAgent keep_alive 1&#34;
+
+
 =back
 
+=item * method
+
+The method to use for the request, generally C&lt;head&gt; or C&lt;get&gt;.
+Default is C&lt;head&gt;.
+
 =item * authenticate&#40; $username, $password &#41;
 
 Returns true on success and false on failure.
</div></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
