<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #80205 for Authen-Krb5-Admin: Adding a db_args method to Authen::Krb5::Admin::Principal</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #80205 for Authen-Krb5-Admin: Adding a db_args method to Authen::Krb5::Admin::Principal</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Authen-Krb5-Admin">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Authen-Krb5-Admin">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Authen-Krb5-Admin">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Authen-Krb5-Admin">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Authen-Krb5-Admin">Authen-Krb5-Admin CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">80205</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Authen-Krb5-Admin">Authen-Krb5-Admin</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
dorian [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-3198-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.13    </td>
  </tr>
  <tr id="CF-3199-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.13    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




2012-10-15-djt-db-args.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1129422/594145/2012-10-15-djt-db-args.diff">
Tue Oct 16 02:16:48 2012 (5.5k) by dorian [...] cpan.org
</a>
</font></li>
</ul>


2012-10-18-djt-db-args.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1130421/594737/2012-10-18-djt-db-args.diff">
Thu Oct 18 11:18:04 2012 (5.7k) by dorian [...] cpan.org
</a>
</font></li>
</ul>


2013-01-27-db-args.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1175168/619822/2013-01-27-db-args.diff">
Mon Jan 28 12:42:54 2013 (6.1k) by dorian [...] cpan.org
</a>
</font></li>
</ul>


read-creds.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1175168/619823/read-creds.pl">
Mon Jan 28 12:42:54 2013 (9.8k) by dorian [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=80205">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1129422" href="/Public/Bug/Display.html?id=80205#txn-1129422">#</a>      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;16&nbsp;02:16:48&nbsp;2012</span>
    <span class="description">dorian [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Adding a db_args method to Authen::Krb5::Admin::Principal</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1129422/594144/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/594144">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 531b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I needed to be able to pass in db_args to add principals to existing
LDAP entries &#40;e.g. addprinc -x dn=cn=foo,dc=bar,dc=com in kadmin&#41;. Here
is a patch that adds a db_args method.

Called with no arguments, db_args will return the list of existing args.
Otherwise all subsequent arguments will replace the existing set while
returning it. I&#39;m not married to this behaviour but it seemed sane
enough to do at the time.

Alternatively, if you have this module in GitHub or BitBucket I&#39;m happy
to clone it and do a pull request there.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 2012-10-15-djt-db-args.diff</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1129422/594145/2012-10-15-djt-db-args.diff">Download 2012-10-15-djt-db-args.diff</a><br />
<span class="downloadcontenttype">text/x-diff 5.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -r d74e15a27d7a Admin.pm
--- a/Admin.pm	Mon Oct 15 21:08:05 2012 -0700
+++ b/Admin.pm	Mon Oct 15 23:10:16 2012 -0700
@@ -193,7 +193,7 @@
 	KRB5_KDB_ACCESS_ERROR
 &#41;;
 %EXPORT_TAGS = &#40;constants =&gt; \@EXPORT_OK&#41;;
-$VERSION = &#39;0.13&#39;;
+$VERSION = &#39;0.14&#39;;
 
 # Preloaded methods go here.
 
@@ -513,6 +513,17 @@
 
 Expire time &#40;in seconds since the Epoch&#41; of the principal&#39;s password
 
+=item * db_args [@ARGS]
+
+When called without any C&lt;@ARGS&gt;, returns the list of arguments that
+will be passed into the underlying database, as with C&lt;addprinc -x&gt; in
+C&lt;kadmin&gt;. If C&lt;@ARGS&gt; is non-empty, it will replace any database
+arguments, which will then be returned, like this:
+
+    my @old = $principal-&gt;db_args;
+    # or
+    my @old = $principal-&gt;db_args&#40;@new&#41;;
+
 =back
 
 =head2 Operations
diff -r d74e15a27d7a Admin.xs
--- a/Admin.xs	Mon Oct 15 21:08:05 2012 -0700
+++ b/Admin.xs	Mon Oct 15 23:10:16 2012 -0700
@@ -30,6 +30,7 @@
 #include &#34;perl.h&#34;
 #include &#34;XSUB.h&#34;
 #include &lt;krb5.h&gt;
+#include &lt;kdb.h&gt;
 #include &lt;com_err.h&gt;
 #ifdef USE_LOCAL_ADMINH
 #include &#34;admin.h&#34;
@@ -2018,6 +2019,92 @@
     RETVAL
 
 void
+db_args&#40;princ, ...&#41;
+    Authen::Krb5::Admin::Principal princ
+  PREINIT:
+    krb5_tl_data *tl, *last_tl;
+    krb5_octet **db_args;
+    int i;
+
+  PPCODE:
+    /* arglist will be items - 1, but the last item should be a NULL. */
+    Newxz&#40;db_args, items, krb5_octet *&#41;;
+
+    /* pull db args off the stack */
+    /* grab the arg stack */
+    for &#40;i = 1; i &lt; items; i++&#41; {
+        db_args[i - 1] = &#40;krb5_octet *&#41;SvPV_nolen&#40;ST&#40;i&#41;&#41;;
+    }
+
+    last_tl = NULL;
+    tl      = princ-&gt;kadm5_princ.tl_data;
+    while &#40;tl != NULL&#41; {
+        krb5_tl_data *next_tl = tl-&gt;tl_data_next;
+
+        /* bail out early for anything but db_args */
+        if &#40;tl-&gt;tl_data_type != KRB5_TL_DB_ARGS&#41; {
+            last_tl = tl;
+            tl      = next_tl;
+            continue;
+        }
+
+        /* otherwise: */
+
+        /* pinched from kdb5.c */
+        if &#40;&#40;&#40;char *&#41; tl-&gt;tl_data_contents&#41;[tl-&gt;tl_data_length - 1] != &#39;\0&#39;&#41; {
+            /* croak */
+            Perl_croak&#40;aTHX_ &#34;Unsafe string in principal tail data&#34;&#41;;
+        }
+        else {
+            /* extend and push the stack with a new mortal SvPV */
+            mXPUSHp&#40;&#40;char *&#41; tl-&gt;tl_data_contents, tl-&gt;tl_data_length - 1&#41;;
+            /* only two hard things in computer science: cache
+               expiration, naming things, and off-by-one errors. */
+
+            /* PS that copies the string, right? because i&#39;m about to
+               nuke it. */
+    
+            /* we&#39;re only doing surgery if there is something to
+               replace these with */
+            if &#40;items &gt; 1&#41; {
+                /* stitch next record to last record if it exists */
+                if &#40;last_tl != NULL&#41; last_tl-&gt;tl_data_next = next_tl;
+                /* stitch the next one onto if this is the first */
+                else if &#40;tl == princ-&gt;kadm5_princ.tl_data&#41;
+                    princ-&gt;kadm5_princ.tl_data = next_tl;
+
+                /* poof */
+                free&#40;tl-&gt;tl_data_contents&#41;;
+                free&#40;tl&#41;;
+
+            }
+
+            /* set this either way */
+            tl = next_tl;
+        }
+    }
+
+    /* add new db args to tl_data */
+    if &#40;items &gt; 1&#41; {
+        for &#40;i = 0; i &lt; items - 1; i++&#41; {
+            krb5_tl_data *new_tl;
+
+            new_tl = calloc&#40;1, sizeof&#40;*new_tl&#41;&#41;;
+            new_tl-&gt;tl_data_type     = KRB5_TL_DB_ARGS;
+            new_tl-&gt;tl_data_length   = strlen&#40;db_args[i]&#41; + 1;
+            new_tl-&gt;tl_data_contents = db_args[i];
+            new_tl-&gt;tl_data_next     = NULL;
+
+            /* append to list */
+            if &#40;last_tl != NULL&#41; last_tl-&gt;tl_data_next = new_tl;
+            else princ-&gt;kadm5_princ.tl_data = new_tl;
+
+            /* either way, it becomes the new tail */
+            last_tl = new_tl;
+        }
+    }
+
+void
 DESTROY&#40;princ&#41;
     Authen::Krb5::Admin::Principal princ
   PREINIT:
diff -r d74e15a27d7a MANIFEST.SKIP
--- a/MANIFEST.SKIP	Mon Oct 15 21:08:05 2012 -0700
+++ b/MANIFEST.SKIP	Mon Oct 15 23:10:16 2012 -0700
@@ -1,3 +1,4 @@
+^\.hg
 ^Admin\.bs$
 ^Admin\.[co]$
 ^CVS/
diff -r d74e15a27d7a Makefile.PL
--- a/Makefile.PL	Mon Oct 15 21:08:05 2012 -0700
+++ b/Makefile.PL	Mon Oct 15 23:10:16 2012 -0700
@@ -145,7 +145,7 @@
     $commands =~ s/PERL_DL_NONLAZY=1 /$new_vars /;
     return exists $ENV{PERL_KADM5_TEST_CACHE}
          ? $commands
-         : &#34;\t$KRB5_BINDIR/kinit -S kadmin/admin -c $test_cache -l 5m &#34;
+         : &#34;\t$KRB5_BINDIR/kinit -S kadmin/admin -c $test_cache -l 50m &#34;
            . &#34;$KADM5_PRINCIPAL\n$commands&#34;
          ;
 }
diff -r d74e15a27d7a t/30-addprinc.t
--- a/t/30-addprinc.t	Mon Oct 15 21:08:05 2012 -0700
+++ b/t/30-addprinc.t	Mon Oct 15 23:10:16 2012 -0700
@@ -31,7 +31,7 @@
 use strict;
 use Test;
 
-BEGIN { plan test =&gt; 20 }
+BEGIN { plan test =&gt; 22 }
 
 use Authen::Krb5;
 use Authen::Krb5::Admin qw&#40;:constants&#41;;
@@ -50,6 +50,14 @@
 my $ap = Authen::Krb5::Admin::Principal-&gt;new;
 ok $ap;
 
+my @args = $ap-&gt;db_args&#40;&#39;derp&#39;&#41;;
+ok !@args;
+
+@args = $ap-&gt;db_args;
+#warn $_ for unpack &#39;C*&#39;, $args[0];
+#warn $args[0];
+ok $args[0] eq &#34;derp&#34;;
+
 $ap-&gt;attributes&#40;KRB5_KDB_DISALLOW_ALL_TIX | KRB5_KDB_DISALLOW_TGT_BASED&#41;;
 ok $ap-&gt;attributes, KRB5_KDB_DISALLOW_ALL_TIX | KRB5_KDB_DISALLOW_TGT_BASED;
 ok $ap-&gt;mask &#38; KADM5_ATTRIBUTES;
@@ -82,5 +90,6 @@
 ok $ap-&gt;pw_expiration, 1021908826;
 ok $ap-&gt;mask &#38; KADM5_PW_EXPIRATION;
 
-ok $handle-&gt;create_principal&#40;$ap, join &#39;&#39;, map { chr rand&#40;255&#41; + 1 } 1..256&#41;
+# utf8 gets ya
+ok $handle-&gt;create_principal&#40;$ap, join &#39;&#39;, map { chr&#40;rand&#40;127&#41; + 1&#41; } 1..256&#41;
     or warn Authen::Krb5::Admin::error;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1130319" href="/Public/Bug/Display.html?id=80205#txn-1130319">#</a>      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;18&nbsp;05:32:18&nbsp;2012</span>
    <span class="description">sjq-perl [...] jadevine.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1130319/594677/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/594677">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 801b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for the patch, it is much appreciated. The code looks good, I
will hopefully get a chance to push out a new release next week, I have
a few other changes backed up ready to go as well.


Stephen

On Tue Oct 16 02:16:48 2012, DORIAN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I needed to be able to pass in db_args to add principals to existing
&gt; LDAP entries &#40;e.g. addprinc -x dn=cn=foo,dc=bar,dc=com in kadmin&#41;. Here
&gt; is a patch that adds a db_args method.
&gt; 
&gt; Called with no arguments, db_args will return the list of existing args.
&gt; Otherwise all subsequent arguments will replace the existing set while
&gt; returning it. I&#39;m not married to this behaviour but it seemed sane
&gt; enough to do at the time.
&gt; 
&gt; Alternatively, if you have this module in GitHub or BitBucket I&#39;m happy
&gt; to clone it and do a pull request there.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1130322" href="/Public/Bug/Display.html?id=80205#txn-1130322">#</a>      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;18&nbsp;05:32:19&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1130421" href="/Public/Bug/Display.html?id=80205#txn-1130421">#</a>      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;18&nbsp;11:18:04&nbsp;2012</span>
    <span class="description">dorian [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1130421/594736/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/594736">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 480b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Oct 18 05:32:18 2012, SJQUINNEY wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks for the patch, it is much appreciated. The code looks good, I
&gt; will hopefully get a chance to push out a new release next week, I have
&gt; a few other changes backed up ready to go as well.
</div>
Great! Thanks. Hold on a moment though, as I&#39;ve added an important doc
patch about setting flags that will frustrate people if it isn&#39;t there.
It&#39;s concerned with setting the KADM5_TL_DATA flag, otherwise the RPC
will ignore that data.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 2012-10-18-djt-db-args.diff</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1130421/594737/2012-10-18-djt-db-args.diff">Download 2012-10-18-djt-db-args.diff</a><br />
<span class="downloadcontenttype">text/x-diff 5.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -r d74e15a27d7a Admin.pm
--- a/Admin.pm	Mon Oct 15 21:08:05 2012 -0700
+++ b/Admin.pm	Thu Oct 18 08:12:40 2012 -0700
@@ -193,7 +193,7 @@
 	KRB5_KDB_ACCESS_ERROR
 &#41;;
 %EXPORT_TAGS = &#40;constants =&gt; \@EXPORT_OK&#41;;
-$VERSION = &#39;0.13&#39;;
+$VERSION = &#39;0.14&#39;;
 
 # Preloaded methods go here.
 
@@ -513,6 +513,21 @@
 
 Expire time &#40;in seconds since the Epoch&#41; of the principal&#39;s password
 
+=item * db_args [@ARGS]
+
+When called without any C&lt;@ARGS&gt;, returns the list of arguments that
+will be passed into the underlying database, as with C&lt;addprinc -x&gt; in
+C&lt;kadmin&gt;. If C&lt;@ARGS&gt; is non-empty, it will replace any database
+arguments, which will then be returned, like this:
+
+    my @old = $principal-&gt;db_args;
+    # -or-
+    my @old = $principal-&gt;db_args&#40;@new&#41;;
+
+    # The RPC call will ignore the tail data unless
+    # you set this flag:
+    $principal-&gt;mask&#40;$principal-&gt;mask | KADM5_TL_DATA&#41;;
+
 =back
 
 =head2 Operations
diff -r d74e15a27d7a Admin.xs
--- a/Admin.xs	Mon Oct 15 21:08:05 2012 -0700
+++ b/Admin.xs	Thu Oct 18 08:12:40 2012 -0700
@@ -30,6 +30,7 @@
 #include &#34;perl.h&#34;
 #include &#34;XSUB.h&#34;
 #include &lt;krb5.h&gt;
+#include &lt;kdb.h&gt;
 #include &lt;com_err.h&gt;
 #ifdef USE_LOCAL_ADMINH
 #include &#34;admin.h&#34;
@@ -2018,6 +2019,93 @@
     RETVAL
 
 void
+db_args&#40;princ, ...&#41;
+    Authen::Krb5::Admin::Principal princ
+  PROTOTYPE: $;@
+  PREINIT:
+    krb5_tl_data *tl, *last_tl;
+    krb5_octet **db_args;
+    int i;
+
+  PPCODE:
+    /* arglist will be items - 1, but the last item should be a NULL. */
+    Newxz&#40;db_args, items, krb5_octet *&#41;;
+
+    /* pull db args off the stack */
+    /* grab the arg stack */
+    for &#40;i = 1; i &lt; items; i++&#41; {
+        db_args[i - 1] = &#40;krb5_octet *&#41;SvPV_nolen&#40;ST&#40;i&#41;&#41;;
+    }
+
+    last_tl = NULL;
+    tl      = princ-&gt;kadm5_princ.tl_data;
+    while &#40;tl != NULL&#41; {
+        krb5_tl_data *next_tl = tl-&gt;tl_data_next;
+
+        /* bail out early for anything but db_args */
+        if &#40;tl-&gt;tl_data_type != KRB5_TL_DB_ARGS&#41; {
+            last_tl = tl;
+            tl      = next_tl;
+            continue;
+        }
+
+        /* otherwise: */
+
+        /* pinched from kdb5.c */
+        if &#40;&#40;&#40;char *&#41; tl-&gt;tl_data_contents&#41;[tl-&gt;tl_data_length - 1] != &#39;\0&#39;&#41; {
+            /* croak */
+            Perl_croak&#40;aTHX_ &#34;Unsafe string in principal tail data&#34;&#41;;
+        }
+        else {
+            /* extend and push the stack with a new mortal SvPV */
+            mXPUSHp&#40;&#40;char *&#41; tl-&gt;tl_data_contents, tl-&gt;tl_data_length - 1&#41;;
+            /* only two hard things in computer science: cache
+               expiration, naming things, and off-by-one errors. */
+
+            /* PS that copies the string, right? because i&#39;m about to
+               nuke it. */
+    
+            /* we&#39;re only doing surgery if there is something to
+               replace these with */
+            if &#40;items &gt; 1&#41; {
+                /* stitch next record to last record if it exists */
+                if &#40;last_tl != NULL&#41; last_tl-&gt;tl_data_next = next_tl;
+                /* stitch the next one onto if this is the first */
+                else if &#40;tl == princ-&gt;kadm5_princ.tl_data&#41;
+                    princ-&gt;kadm5_princ.tl_data = next_tl;
+
+                /* poof */
+                free&#40;tl-&gt;tl_data_contents&#41;;
+                free&#40;tl&#41;;
+
+            }
+
+            /* set this either way */
+            tl = next_tl;
+        }
+    }
+
+    /* add new db args to tl_data */
+    if &#40;items &gt; 1&#41; {
+        for &#40;i = 0; i &lt; items - 1; i++&#41; {
+            krb5_tl_data *new_tl;
+
+            new_tl = calloc&#40;1, sizeof&#40;*new_tl&#41;&#41;;
+            new_tl-&gt;tl_data_type     = KRB5_TL_DB_ARGS;
+            new_tl-&gt;tl_data_length   = strlen&#40;db_args[i]&#41; + 1;
+            new_tl-&gt;tl_data_contents = db_args[i];
+            new_tl-&gt;tl_data_next     = NULL;
+
+            /* append to list */
+            if &#40;last_tl != NULL&#41; last_tl-&gt;tl_data_next = new_tl;
+            else princ-&gt;kadm5_princ.tl_data = new_tl;
+
+            /* either way, it becomes the new tail */
+            last_tl = new_tl;
+        }
+    }
+
+void
 DESTROY&#40;princ&#41;
     Authen::Krb5::Admin::Principal princ
   PREINIT:
diff -r d74e15a27d7a MANIFEST.SKIP
--- a/MANIFEST.SKIP	Mon Oct 15 21:08:05 2012 -0700
+++ b/MANIFEST.SKIP	Thu Oct 18 08:12:40 2012 -0700
@@ -1,3 +1,4 @@
+^\.hg
 ^Admin\.bs$
 ^Admin\.[co]$
 ^CVS/
diff -r d74e15a27d7a Makefile.PL
--- a/Makefile.PL	Mon Oct 15 21:08:05 2012 -0700
+++ b/Makefile.PL	Thu Oct 18 08:12:40 2012 -0700
@@ -145,7 +145,7 @@
     $commands =~ s/PERL_DL_NONLAZY=1 /$new_vars /;
     return exists $ENV{PERL_KADM5_TEST_CACHE}
          ? $commands
-         : &#34;\t$KRB5_BINDIR/kinit -S kadmin/admin -c $test_cache -l 5m &#34;
+         : &#34;\t$KRB5_BINDIR/kinit -S kadmin/admin -c $test_cache -l 50m &#34;
            . &#34;$KADM5_PRINCIPAL\n$commands&#34;
          ;
 }
diff -r d74e15a27d7a t/30-addprinc.t
--- a/t/30-addprinc.t	Mon Oct 15 21:08:05 2012 -0700
+++ b/t/30-addprinc.t	Thu Oct 18 08:12:40 2012 -0700
@@ -31,7 +31,7 @@
 use strict;
 use Test;
 
-BEGIN { plan test =&gt; 20 }
+BEGIN { plan test =&gt; 22 }
 
 use Authen::Krb5;
 use Authen::Krb5::Admin qw&#40;:constants&#41;;
@@ -50,6 +50,14 @@
 my $ap = Authen::Krb5::Admin::Principal-&gt;new;
 ok $ap;
 
+my @args = $ap-&gt;db_args&#40;&#39;derp&#39;&#41;;
+ok !@args;
+
+@args = $ap-&gt;db_args;
+#warn $_ for unpack &#39;C*&#39;, $args[0];
+#warn $args[0];
+ok $args[0] eq &#34;derp&#34;;
+
 $ap-&gt;attributes&#40;KRB5_KDB_DISALLOW_ALL_TIX | KRB5_KDB_DISALLOW_TGT_BASED&#41;;
 ok $ap-&gt;attributes, KRB5_KDB_DISALLOW_ALL_TIX | KRB5_KDB_DISALLOW_TGT_BASED;
 ok $ap-&gt;mask &#38; KADM5_ATTRIBUTES;
@@ -82,5 +90,6 @@
 ok $ap-&gt;pw_expiration, 1021908826;
 ok $ap-&gt;mask &#38; KADM5_PW_EXPIRATION;
 
-ok $handle-&gt;create_principal&#40;$ap, join &#39;&#39;, map { chr rand&#40;255&#41; + 1 } 1..256&#41;
+# utf8 gets ya
+ok $handle-&gt;create_principal&#40;$ap, join &#39;&#39;, map { chr&#40;rand&#40;127&#41; + 1&#41; } 1..256&#41;
     or warn Authen::Krb5::Admin::error;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1135354" href="/Public/Bug/Display.html?id=80205#txn-1135354">#</a>      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;01&nbsp;05:38:48&nbsp;2012</span>
    <span class="description">sjq-perl [...] jadevine.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1135354/597467/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/597467">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve just looked at applying your patch but I find that it doesn&#39;t
compile on my system &#40;RHEL6&#41; which has MIT Kerberos version 1.9. To get
it building I had to #define the SECURID cpp macro before the inclusion
of the kdb.h header in Admin.xs &#40;it seems this is actually a bug in that
header&#41;.

I also noticed that I don&#39;t have kdb.h available on my RHEL5 machine
which has version 1.6, the header is in the source but doesn&#39;t get
installed by the looks of things. I think the header is installed with
1.7 onwards, probably the easiest solution here is to only have the new
function compiled into the code when the header is available.


Stephen

On Thu Oct 18 11:18:04 2012, DORIAN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu Oct 18 05:32:18 2012, SJQUINNEY wrote:
<div class="message-stanza open">&gt; &gt; Thanks for the patch, it is much appreciated. The code looks good, I
&gt; &gt; will hopefully get a chance to push out a new release next week, I have
&gt; &gt; a few other changes backed up ready to go as well.
</div>&gt; 
&gt; Great! Thanks. Hold on a moment though, as I&#39;ve added an important doc
&gt; patch about setting flags that will frustrate people if it isn&#39;t there.
&gt; It&#39;s concerned with setting the KADM5_TL_DATA flag, otherwise the RPC
&gt; will ignore that data.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1135457" href="/Public/Bug/Display.html?id=80205#txn-1135457">#</a>      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;01&nbsp;12:02:59&nbsp;2012</span>
    <span class="description">dorian [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1135457/597530/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/597530">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Nov 01 05:38:48 2012, SJQUINNEY wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ve just looked at applying your patch but I find that it doesn&#39;t
&gt; compile on my system &#40;RHEL6&#41; which has MIT Kerberos version 1.9. To get
&gt; it building I had to #define the SECURID cpp macro before the inclusion
&gt; of the kdb.h header in Admin.xs &#40;it seems this is actually a bug in that
&gt; header&#41;.
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I also noticed that I don&#39;t have kdb.h available on my RHEL5 machine
&gt; which has version 1.6, the header is in the source but doesn&#39;t get
&gt; installed by the looks of things. I think the header is installed with
&gt; 1.7 onwards, probably the easiest solution here is to only have the new
&gt; function compiled into the code when the header is available.
</div>
kdb.h is also missing on OSX. There is only the KADM5_TL_DATA define
from there. It might just make sense to define it statically, even
though that imports its own potential set of problems.

I was using my changes last week and found a double free &#40;actually two,
one in Authen::Krb5 also&#41;. So I should probably fix that as well.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1154603" href="/Public/Bug/Display.html?id=80205#txn-1154603">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;13&nbsp;05:33:01&nbsp;2012</span>
    <span class="description">sjq-perl [...] jadevine.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1154603/607234/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/607234">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi there,

A while back you mentioned that you had found a double-free in your
code, do you now have an improved patch which fixes that issue?

Cheers,

Stephen Quinney

On Thu Nov 01 12:02:59 2012, DORIAN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu Nov 01 05:38:48 2012, SJQUINNEY wrote:
<div class="message-stanza open">&gt; &gt; I&#39;ve just looked at applying your patch but I find that it doesn&#39;t
&gt; &gt; compile on my system &#40;RHEL6&#41; which has MIT Kerberos version 1.9. To get
&gt; &gt; it building I had to #define the SECURID cpp macro before the inclusion
&gt; &gt; of the kdb.h header in Admin.xs &#40;it seems this is actually a bug in that
&gt; &gt; header&#41;.
</div>&gt; 
<div class="message-stanza open">&gt; &gt; I also noticed that I don&#39;t have kdb.h available on my RHEL5 machine
&gt; &gt; which has version 1.6, the header is in the source but doesn&#39;t get
&gt; &gt; installed by the looks of things. I think the header is installed with
&gt; &gt; 1.7 onwards, probably the easiest solution here is to only have the new
&gt; &gt; function compiled into the code when the header is available.
</div>&gt; 
&gt; kdb.h is also missing on OSX. There is only the KADM5_TL_DATA define
&gt; from there. It might just make sense to define it statically, even
&gt; though that imports its own potential set of problems.
&gt; 
&gt; I was using my changes last week and found a double free &#40;actually two,
&gt; one in Authen::Krb5 also&#41;. So I should probably fix that as well.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1160977" href="/Public/Bug/Display.html?id=80205#txn-1160977">#</a>      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;31&nbsp;21:59:11&nbsp;2012</span>
    <span class="description">dorian [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1160977/610422/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/610422">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 572b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Dec 13 05:33:01 2012, SJQUINNEY wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi there,
&gt; 
&gt; A while back you mentioned that you had found a double-free in your
&gt; code, do you now have an improved patch which fixes that issue?
&gt; 
&gt; Cheers,
&gt; 
&gt; Stephen Quinney
</div>
Two, in fact. One in my code and another in Authen::Krb5 &#40;according to
valgrind&#41;. I&#39;ve been working on other stuff in the interim, but I&#39;m
going to need that to work at some point in the next few weeks. So I&#39;ll
be setting a day aside &#40;as I&#39;m not an especially good C programmer&#41; to
fix them both soon.

Stay tuned and have a happy new year!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1175168" href="/Public/Bug/Display.html?id=80205#txn-1175168">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;28&nbsp;12:42:54&nbsp;2013</span>
    <span class="description">dorian [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1175168/619821/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/619821">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 455b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I found something; looks like it was an an off-by-one. I got
Test::Valgrind to stop complaining about it. The script I originally
wrote &#40;also attached&#41; to add principals doesn&#39;t crash anymore on my
system but I still need to try it elsewhere.

I should also note that there were other complaints from valgrind around
the GC of the context object that must have always been there. Fixing
that is a little more involved &#40;and should probably be its own bug&#41;.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 2013-01-27-db-args.diff</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1175168/619822/2013-01-27-db-args.diff">Download 2013-01-27-db-args.diff</a><br />
<span class="downloadcontenttype">text/x-diff 6.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -r d74e15a27d7a Admin.pm
--- a/Admin.pm	Mon Oct 15 21:08:05 2012 -0700
+++ b/Admin.pm	Mon Jan 28 09:30:55 2013 -0800
@@ -193,7 +193,7 @@
 	KRB5_KDB_ACCESS_ERROR
 &#41;;
 %EXPORT_TAGS = &#40;constants =&gt; \@EXPORT_OK&#41;;
-$VERSION = &#39;0.13&#39;;
+$VERSION = &#39;0.14&#39;;
 
 # Preloaded methods go here.
 
@@ -513,6 +513,21 @@
 
 Expire time &#40;in seconds since the Epoch&#41; of the principal&#39;s password
 
+=item * db_args [@ARGS]
+
+When called without any C&lt;@ARGS&gt;, returns the list of arguments that
+will be passed into the underlying database, as with C&lt;addprinc -x&gt; in
+C&lt;kadmin&gt;. If C&lt;@ARGS&gt; is non-empty, it will replace any database
+arguments, which will then be returned, like this:
+
+    my @old = $principal-&gt;db_args;
+    # -or-
+    my @old = $principal-&gt;db_args&#40;@new&#41;;
+
+    # The RPC call will ignore the tail data unless
+    # you set this flag:
+    $principal-&gt;mask&#40;$principal-&gt;mask | KADM5_TL_DATA&#41;;
+
 =back
 
 =head2 Operations
diff -r d74e15a27d7a Admin.xs
--- a/Admin.xs	Mon Oct 15 21:08:05 2012 -0700
+++ b/Admin.xs	Mon Jan 28 09:30:55 2013 -0800
@@ -30,6 +30,7 @@
 #include &#34;perl.h&#34;
 #include &#34;XSUB.h&#34;
 #include &lt;krb5.h&gt;
+#include &lt;kdb.h&gt;
 #include &lt;com_err.h&gt;
 #ifdef USE_LOCAL_ADMINH
 #include &#34;admin.h&#34;
@@ -2018,6 +2019,107 @@
     RETVAL
 
 void
+db_args&#40;princ, ...&#41;
+    Authen::Krb5::Admin::Principal princ
+  PROTOTYPE: $;@
+  PREINIT:
+    krb5_tl_data *tl, *last_tl;
+    krb5_octet **db_args;
+    int i;
+
+  PPCODE:
+    /* arglist will be items - 1, but the last item should be a NULL. */
+    Newxz&#40;db_args, items, krb5_octet *&#41;;
+
+    /* pull db args off the stack */
+    /* grab the arg stack */
+    for &#40;i = 1; i &lt; items; i++&#41; {
+        krb5_octet *this_arg;
+        STRLEN length = sv_len&#40;ST&#40;i&#41;&#41; + 1;
+        /* Perl_croak&#40;aTHX_ &#34;%d&#34;, length&#41;;*/
+        Newxz&#40;this_arg, length, krb5_octet&#41;;
+        Copy&#40;&#40;krb5_octet *&#41;SvPV&#40;ST&#40;i&#41;, length&#41;, this_arg, length, krb5_octet&#41;;
+        /* db_args[i - 1] = &#40;krb5_octet *&#41;SvPV_nolen&#40;ST&#40;i&#41;&#41;; */
+        db_args[i - 1] = this_arg;
+    }
+
+    last_tl = NULL;
+    tl      = princ-&gt;kadm5_princ.tl_data;
+    while &#40;tl != NULL&#41; {
+        krb5_tl_data *next_tl = tl-&gt;tl_data_next;
+
+        /* bail out early for anything but db_args */
+        if &#40;tl-&gt;tl_data_type != KRB5_TL_DB_ARGS&#41; {
+            last_tl = tl;
+            tl      = next_tl;
+            continue;
+        }
+
+        /* otherwise: */
+
+        /* pinched from kdb5.c */
+        if &#40;&#40;&#40;char *&#41; tl-&gt;tl_data_contents&#41;[tl-&gt;tl_data_length - 1] != &#39;\0&#39;&#41; {
+            /* croak */
+            Perl_croak&#40;aTHX_ &#34;Unsafe string in principal tail data&#34;&#41;;
+        }
+        else {
+            SV * tl_out;
+            
+            tl_out = newSVpv&#40;&#40;const char *&#41; tl-&gt;tl_data_contents, 0&#41;;
+            XPUSHs&#40;tl_out&#41;;
+
+            /* extend and push the stack with a new mortal SvPV */
+            /* mXPUSHp&#40;&#40;char *&#41; tl-&gt;tl_data_contents, tl-&gt;tl_data_length - 1&#41;; */
+            /* only two hard things in computer science: cache
+               expiration, naming things, and off-by-one errors. */
+
+            /* PS that copies the string, right? because i&#39;m about to
+               nuke it. */
+    
+            /* we&#39;re only doing surgery if there is something to
+               replace these with */
+            if &#40;items &gt; 1&#41; {
+                /* stitch next record to last record if it exists */
+                if &#40;last_tl != NULL&#41; last_tl-&gt;tl_data_next = next_tl;
+                /* stitch the next one onto if this is the first */
+                else if &#40;tl == princ-&gt;kadm5_princ.tl_data&#41;
+                    princ-&gt;kadm5_princ.tl_data = next_tl;
+
+                /* poof */
+                free&#40;tl-&gt;tl_data_contents&#41;;
+                free&#40;tl&#41;;
+
+            }
+
+            /* set this either way */
+            tl = next_tl;
+        }
+    }
+
+    /* add new db args to tl_data */
+    if &#40;items &gt; 1&#41; {
+        for &#40;i = 0; i &lt; items - 1; i++&#41; {
+            krb5_tl_data *new_tl;
+
+            new_tl = calloc&#40;1, sizeof&#40;*new_tl&#41;&#41;;
+            new_tl-&gt;tl_data_type     = KRB5_TL_DB_ARGS;
+            new_tl-&gt;tl_data_length   = strlen&#40;db_args[i]&#41; + 1;
+            new_tl-&gt;tl_data_contents = db_args[i];
+            new_tl-&gt;tl_data_next     = NULL;
+
+            /* append to list */
+            if &#40;last_tl != NULL&#41; last_tl-&gt;tl_data_next = new_tl;
+            else princ-&gt;kadm5_princ.tl_data = new_tl;
+
+            /* either way, it becomes the new tail */
+            last_tl = new_tl;
+        }
+    }
+
+    /* explictly get rid of db_args */
+    Safefree&#40;db_args&#41;;
+
+void
 DESTROY&#40;princ&#41;
     Authen::Krb5::Admin::Principal princ
   PREINIT:
diff -r d74e15a27d7a MANIFEST.SKIP
--- a/MANIFEST.SKIP	Mon Oct 15 21:08:05 2012 -0700
+++ b/MANIFEST.SKIP	Mon Jan 28 09:30:55 2013 -0800
@@ -1,3 +1,4 @@
+^\.hg
 ^Admin\.bs$
 ^Admin\.[co]$
 ^CVS/
diff -r d74e15a27d7a Makefile.PL
--- a/Makefile.PL	Mon Oct 15 21:08:05 2012 -0700
+++ b/Makefile.PL	Mon Jan 28 09:30:55 2013 -0800
@@ -145,7 +145,7 @@
     $commands =~ s/PERL_DL_NONLAZY=1 /$new_vars /;
     return exists $ENV{PERL_KADM5_TEST_CACHE}
          ? $commands
-         : &#34;\t$KRB5_BINDIR/kinit -S kadmin/admin -c $test_cache -l 5m &#34;
+         : &#34;\t$KRB5_BINDIR/kinit -S kadmin/admin -c $test_cache -l 50m &#34;
            . &#34;$KADM5_PRINCIPAL\n$commands&#34;
          ;
 }
diff -r d74e15a27d7a t/30-addprinc.t
--- a/t/30-addprinc.t	Mon Oct 15 21:08:05 2012 -0700
+++ b/t/30-addprinc.t	Mon Jan 28 09:30:55 2013 -0800
@@ -31,7 +31,7 @@
 use strict;
 use Test;
 
-BEGIN { plan test =&gt; 20 }
+BEGIN { plan test =&gt; 22 }
 
 use Authen::Krb5;
 use Authen::Krb5::Admin qw&#40;:constants&#41;;
@@ -50,6 +50,14 @@
 my $ap = Authen::Krb5::Admin::Principal-&gt;new;
 ok $ap;
 
+my @args = $ap-&gt;db_args&#40;&#39;derp&#39;&#41;;
+ok !@args;
+
+@args = $ap-&gt;db_args;
+#warn $_ for unpack &#39;C*&#39;, $args[0];
+#warn $args[0];
+ok $args[0] eq &#34;derp&#34;;
+
 $ap-&gt;attributes&#40;KRB5_KDB_DISALLOW_ALL_TIX | KRB5_KDB_DISALLOW_TGT_BASED&#41;;
 ok $ap-&gt;attributes, KRB5_KDB_DISALLOW_ALL_TIX | KRB5_KDB_DISALLOW_TGT_BASED;
 ok $ap-&gt;mask &#38; KADM5_ATTRIBUTES;
@@ -82,5 +90,6 @@
 ok $ap-&gt;pw_expiration, 1021908826;
 ok $ap-&gt;mask &#38; KADM5_PW_EXPIRATION;
 
-ok $handle-&gt;create_principal&#40;$ap, join &#39;&#39;, map { chr rand&#40;255&#41; + 1 } 1..256&#41;
+# utf8 gets ya
+ok $handle-&gt;create_principal&#40;$ap, join &#39;&#39;, map { chr&#40;rand&#40;127&#41; + 1&#41; } 1..256&#41;
     or warn Authen::Krb5::Admin::error;
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> read-creds.pl</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1175168/619823/read-creds.pl">Download read-creds.pl</a><br />
<span class="downloadcontenttype">text/x-perl 9.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl

use strict;
use warnings FATAL =&gt; &#39;all&#39;;

package K5LDAP::Admin;

use Moose;
#use MooseX::Attribute::Dependent;
use Moose::Util::TypeConstraints;
use namespace::autoclean;


use DateTime;
use Authen::Krb5;
use Authen::Krb5::Admin qw&#40;KADM5_TL_DATA&#41;;
use Authen::SASL;
use Net::LDAP;
use Unicode::Transliterate;

has _context =&gt; &#40;
    is      =&gt; &#39;ro&#39;,
    isa     =&gt; &#39;Authen::Krb5::Context&#39;,
    default =&gt; sub {
        # lol i just checked the code and this just initializes a
        # global. hope you don&#39;t have to run this in threads!
        my $x = eval { Authen::Krb5::init_context };

        # XXX cargo cult: this is almost certainly a no-op and i&#39;m
        # merely assuming that it has to be run after init_context.
        Authen::Krb5::init_ets;

        # now return it, but not sure why. now that i look at the xs
        # code, it doesn&#39;t give you an object or anything.
        $x;
    },
&#41;;

# XXX maybe it makes more sense for the constructor to provide an
# explicit principal and then build off that, rather than start with
# the credential cache from the environment?

has cc =&gt; &#40;
    is      =&gt; &#39;ro&#39;,
    isa     =&gt; &#39;Authen::Krb5::Ccache&#39;,
#    lazy    =&gt; 0,
    default =&gt; sub { Authen::Krb5::cc_default },
&#41;;

has admin =&gt; &#40;
    is         =&gt; &#39;ro&#39;,
    isa        =&gt; &#39;Authen::Krb5::Admin&#39;,
#    dependency =&gt; All[&#39;cc&#39;],
    lazy       =&gt; 1,
    default    =&gt; sub {
        my $self = shift;

 #       $self-&gt;_get_kadmin_ticket;

        my $p    = $self-&gt;cc-&gt;get_principal;
        my $ps = sprintf &#39;%s@%s&#39;, join&#40;&#39;/&#39;, $p-&gt;data&#41;, $p-&gt;realm;

        my $a    = Authen::Krb5::Admin-&gt;init_with_creds&#40;$ps, $self-&gt;cc&#41;
            or die Authen::Krb5::Admin::error;

        $a;
    },
&#41;;

# this is a little confusing because the GSSAPI LDAP connection has
# nothing to do with the kerberos munging i&#39;m doing in here.

has sasl =&gt; &#40;
    is      =&gt; &#39;ro&#39;,
    isa     =&gt; &#39;Authen::SASL&#39;,
    default =&gt; sub { Authen::SASL-&gt;new&#40;mechanism =&gt; &#39;GSSAPI&#39;&#41; },
&#41;;

class_type &#39;LDAPConnection&#39;, { class =&gt; &#39;Net::LDAP&#39; };
coerce &#39;LDAPConnection&#39;, from &#39;Str&#39;, via { Net::LDAP-&gt;new&#40;shift&#41; };

has ldap =&gt; &#40;
    is       =&gt; &#39;ro&#39;,
    isa      =&gt; &#39;LDAPConnection&#39;,
    required =&gt; 1,
    coerce   =&gt; 1,
&#41;;

sub _get_kadmin_ticket {
    my $self = shift;

    my $cc  = $self-&gt;cc;
    my $me  = $cc-&gt;get_principal;
    my $now = DateTime-&gt;now;

    my $cursor  = $cc-&gt;start_seq_get;
    my $refresh = 1;
    while &#40;my $cred = $cc-&gt;next_cred&#40;$cursor&#41;&#41; {
        # only helps if the ticket isn&#39;t expired
        my $end = DateTime-&gt;from_epoch&#40;epoch =&gt; $cred-&gt;endtime&#41;;
        next unless $end &gt; $now;

        my $s = Authen::Krb5::parse_name&#40;$cred-&gt;server&#41;;
        next unless defined $s-&gt;realm and $s-&gt;realm eq $me-&gt;realm;

        # yoda condition!
        $refresh = 0 if &#39;kadmin/admin&#39; eq join &#39;/&#39;, $s-&gt;data;
    }
    $cc-&gt;end_seq_get&#40;$cursor&#41;;

    # note that this only works if you clear the DISALLOW_TGT_BASED
    # flag on the kadmin/admin principal.

    if &#40;$refresh&#41; {
        warn &#39;refreshing&#39;;
        my $ac = Authen::Krb5::AuthContext-&gt;new;
        Authen::Krb5::mk_req&#40;$ac, Authen::Krb5::AP_OPTS_MUTUAL_REQUIRED,
                             &#39;kadmin&#39;, &#39;admin&#39;, &#39;&#39;, $cc&#41;
              or die Authen::Krb5::error;
    }
}

sub _prune_busted_kadmin {
    my $self = shift;

    my $cc = $self-&gt;cc;
    if &#40;my $cursor  = $cc-&gt;start_seq_get&#41; {
        while &#40;my $cred = $cc-&gt;next_cred&#40;$cursor&#41;&#41; {
            my $s = Authen::Krb5::parse_name&#40;$cred-&gt;server&#41;;
#            next unless defined $s-&gt;realm and $s-&gt;realm eq $me-&gt;realm;

        }
        $cc-&gt;end_seq_get&#40;$cursor&#41;;
    }
}

sub _new_ctx {
    my $self = shift;
    my $cc   = Authen::Krb5::cc_default;
    my $p    = $cc-&gt;get_principal;
    my $ps = sprintf &#39;%s@%s&#39;, join&#40;&#39;/&#39;, $p-&gt;data&#41;, $p-&gt;realm;

    my $a    = Authen::Krb5::Admin-&gt;init_with_creds&#40;$ps, $self-&gt;cc&#41;
        or die Authen::Krb5::Admin::error;
    $a;
}

sub add_principal {
    my &#40;$self, $name, $pass, $dn&#41; = @_;


    my $p  = Authen::Krb5::parse_name&#40;$name&#41;;
    my $ap = Authen::Krb5::Admin::Principal-&gt;new;
    $ap-&gt;principal&#40;$p&#41;;

    if &#40;$dn&#41; {
        $ap-&gt;db_args&#40;qq{dn=$dn}&#41;;
        warn $dn;
        # tail data will be ignored otherwise
        $ap-&gt;mask&#40;$ap-&gt;mask | KADM5_TL_DATA&#41;;
    }

    my $admin = $self-&gt;_new_ctx;
    unless &#40;$admin-&gt;get_principal&#40;$p&#41;&#41; {
        $admin-&gt;create_principal&#40;$ap, $pass&#41;
            or die Authen::Krb5::Admin::error;
        #$self-&gt;admin-&gt;create_principal&#40;$ap, $pass&#41;
        #    or die Authen::Krb5::Admin::error;
    }
}

sub BUILD {
    my $self = shift;

    $self-&gt;_get_kadmin_ticket;

    # now connect to the ldap database
    $self-&gt;ldap-&gt;bind&#40;sasl =&gt; $self-&gt;sasl&#41;;
}

sub DEMOLISH {
    # same deal
    eval { Authen::Krb5::free_context };
}

__PACKAGE__-&gt;meta-&gt;make_immutable;
no Moose;

1;

# theoretically we can cut this up

package K5LDAP::Admin::Loader;

use Moose;
use namespace::autoclean;

use Moose::Util::TypeConstraints;

extends &#39;K5LDAP::Admin&#39;;

use Net::LDAP::Entry;
use Text::CSV;

has base =&gt; &#40;
    is       =&gt; &#39;ro&#39;,
    isa      =&gt; &#39;Str&#39;,
    required =&gt; 1,
&#41;;

has rdn =&gt; &#40;
    is       =&gt; &#39;ro&#39;,
    isa      =&gt; &#39;Str&#39;,
    required =&gt; 1,
&#41;;

has map =&gt; &#40;
    is       =&gt; &#39;ro&#39;,
    isa      =&gt; &#39;HashRef&#39;,
    required =&gt; 1,
&#41;;

has delimiter =&gt; &#40;
    is       =&gt; &#39;ro&#39;,
    isa      =&gt; &#39;RegexpRef&#39;,
    required =&gt; 1,
&#41;;

has member_types =&gt; &#40;
    is      =&gt; &#39;ro&#39;,
    isa     =&gt; &#39;HashRef&#39;,
    lazy    =&gt; 1,
    default =&gt; sub { {} },
&#41;;

has employers =&gt; &#40;
    is      =&gt; &#39;ro&#39;,
    isa     =&gt; &#39;HashRef&#39;,
    lazy    =&gt; 1,
    default =&gt; sub { {} },
&#41;;

has affiliations =&gt; &#40;
    is      =&gt; &#39;ro&#39;,
    isa     =&gt; &#39;HashRef&#39;,
    lazy    =&gt; 1,
    default =&gt; sub { {} },
&#41;;

class_type &#39;CSVReader&#39;, { class =&gt; &#39;Text::CSV&#39; };
coerce &#39;CSVReader&#39;, from &#39;HashRef&#39;, via { Text::CSV-&gt;new&#40;shift&#41; };

has csv =&gt; &#40;
    is      =&gt; &#39;ro&#39;,
    isa     =&gt; &#39;CSVReader&#39;,
    coerce  =&gt; 1,
    default =&gt; sub { Text::CSV-&gt;new&#40;{ binary =&gt; 1 }&#41;; },
&#41;;

subtype &#39;PrimaryKey&#39;, as &#39;ArrayRef[Str]&#39;;
coerce &#39;PrimaryKey&#39;, from &#39;Str&#39;, via { [shift] };

has pk =&gt; &#40;
    is       =&gt; &#39;ro&#39;,
    isa      =&gt; &#39;PrimaryKey&#39;,
    coerce   =&gt; 1,
    required =&gt; 1,
&#41;;

has translit =&gt; &#40;
    is      =&gt; &#39;ro&#39;,
    isa     =&gt; &#39;Unicode::Transliterate&#39;,
    lazy    =&gt; 1,
    default =&gt; sub {
        Unicode::Transliterate-&gt;new&#40;from =&gt; &#39;Latin&#39;, to =&gt; &#39;ASCII&#39;&#41; },
&#41;;

sub _nonempty &#40;$&#41; {
    my $x = shift;
    defined $x and $x !~ /^\s*$/;
}

sub run {
    my &#40;$self, @files&#41; = @_;

    for my $fn &#40;@files&#41; {
        open my $fh, &#39;&lt;:utf8&#39;, $fn or die $!;

        my $cols = $self-&gt;csv-&gt;getline&#40;$fh&#41;;
        $self-&gt;csv-&gt;column_names&#40;@$cols&#41;;

        my %record;
        while &#40;my $row = $self-&gt;csv-&gt;getline_hr&#40;$fh&#41;&#41; {
            next unless keys %$row;

            if &#40;@{$self-&gt;pk} == grep { _nonempty $_ } @{$row}{@{$self-&gt;pk}}&#41; {
                # this will contain stuff if we&#39;re more than one
                # record in.
                $self-&gt;add_user&#40;\%record&#41; if keys %record;

                # only add nonempty values
                %record = map { $_ =&gt; $row-&gt;{$_} }
                    grep { _nonempty $row-&gt;{$_} } keys %$row;
            }
            else {
                #warn Data::Dumper::Dumper&#40;$row&#41;;
                # turn into arrayref
                for my $k &#40;grep { _nonempty $row-&gt;{$_} } keys %$row&#41; {
                    if &#40;defined $record{$k}&#41; {
                        $record{$k} = [$record{$k}]
                            unless ref $record{$k} eq &#39;ARRAY&#39;;
                    }
                    else {
                        $record{$k} = [];
                    }
                    push @{$record{$k}}, $row-&gt;{$k};
                }
            }
        }

        # add final one
        $self-&gt;add_user&#40;\%record&#41;;
    }
}

sub add_user {
    my &#40;$self, $rec&#41; = @_;
    my $rdnf = $self-&gt;map-&gt;{$self-&gt;rdn};

    $rec-&gt;{$rdnf} = $self-&gt;translit-&gt;process&#40;$rec-&gt;{$rdnf}&#41;;
    $rec-&gt;{$rdnf} =~ s/[^0-9A-Za-z.-]//g;

    eval { printf &#34;%s %s\n&#34;, $rec-&gt;{UID}, $rec-&gt;{$rdnf} };

    if &#40;$@&#41; {
        require Data::Dumper;
        warn Data::Dumper::Dumper&#40;$rec&#41;;
    }

    # create a DN

    my $dn = sprintf &#39;%s=%s,%s&#39;, $self-&gt;rdn, $rec-&gt;{$rdnf}, $self-&gt;base;

    #warn $dn;

    my %map   = reverse %{$self-&gt;map};
    my %attrs = map { $map{$_} =&gt; $rec-&gt;{$_} }
        grep { defined $rec-&gt;{$_} } keys %map;


    # optionally create predicate groups

    # optionally create 

    # create an LDAP object

    my $entry = Net::LDAP::Entry-&gt;new
        &#40;$dn, objectClass =&gt; [qw&#40;top OpenLDAPperson posixAccount&#41;],
         homeDirectory =&gt; &#39;/dev/null&#39;, 
         gidNumber =&gt; 100, %attrs&#41;;
    #$entry-&gt;dump&#40;\*STDERR&#41;;

    # shove the ldap object in the servarr
    my $result = $entry-&gt;update&#40;$self-&gt;ldap&#41;;

    $result-&gt;code &#38;&#38; warn &#34;failed to add entry: &#34;, $result-&gt;error ;

    $self-&gt;add_principal&#40;$rec-&gt;{$rdnf}, $rec-&gt;{Password}, $dn&#41;;
}

__PACKAGE__-&gt;meta-&gt;make_immutable;
no Moose;

1;

# --------8&lt;------

package main;

# remember the service ticket maps the host to the realm, so you can&#39;t
# connect to localhost.

my $loader = K5LDAP::Admin::Loader-&gt;new&#40;
    ldap      =&gt; &#39;deuce&#39;,
    base      =&gt; &#39;ou=IAI,dc=privatealpha,dc=com&#39;,
    rdn       =&gt; &#39;uid&#39;,
    delimiter =&gt; qr/\s*;\s*/,
    pk        =&gt; &#39;UID&#39;,
    map  =&gt; {
#        uid       =&gt; sub { sprintf&#40;&#39;member-%05d&#39;, shift-&gt;{UID}&#41; },
        uid       =&gt; &#39;Generated Username&#39;,
        uidNumber =&gt; &#39;UID&#39;,
        cn        =&gt; &#39;Contact Name&#39;,
        sn        =&gt; &#39;Last Name&#39;,
        gn        =&gt; &#39;First Name&#39;,
        o         =&gt; &#39;Organization 1&#39;,
        title     =&gt; &#39;Title&#39;,
        mail      =&gt; &#39;Email&#39;,
        street    =&gt; &#39;Street Address&#39;,
        l         =&gt; &#39;City&#39;,
        st        =&gt; &#39;State &#40;US, Canada &#38; Australia&#41;&#39;,
        postalCode =&gt; &#39;Zip&#39;,
    },
&#41;;

$loader-&gt;run&#40;@ARGV&#41;;

# predicate groups:

# list me in directory

# active volunteer

# list me in geolocate

# subscribe to member list

# subscribe to newsletter

# groups:

# &#34;Member Group&#34;

# &#34;IAI Initiative Activity&#34;

# &#34;IAI Volunteer Roles&#34;
</div></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.727227</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
