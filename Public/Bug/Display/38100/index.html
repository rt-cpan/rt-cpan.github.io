<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #38100 for CGI: Proposal: support for conditional comments containing style &#40;HTML generation&#41;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #38100 for CGI: Proposal: support for conditional comments containing style &#40;HTML generation&#41;</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/CGI/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/CGI/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/CGI/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/CGI/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/leejo/CGI.pm/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/CGI">CGI CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">38100</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/CGI/Active/">CGI</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ww.galen [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-230860-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-230861-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;01&nbsp;10:39:02&nbsp;2008</span>
    <span class="description">ww.galen [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [PATCH] Added support for conditional comments containing style</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Patch is to add preliminary support &#40;&#38; documentation&#41; for conditional
comments around style sheets.  With the patch, the -style option accepts
a -cond argument.  For example,
  print start_html&#40;-style =&gt; {
    -media =&gt; &#39;all&#39;,
    -cond =&gt; [&#39;.foo {color: navy;}&#39;, &#39;/style/1_IE.css&#39;, 
              [5, &#39;/style/IE5.css&#39;],
              {-src =&gt; [&#39;/style/2_IE.css&#39;, &#39;/style/3_IE.css&#39;], 
               -code =&gt; &#39;.bar {padding: 1em;}&#39;}, 
              [&#39;/style/4.css&#39;],
              [&#39;!&#39;, &#39;/style/notIE.css&#39;],
              {-expr =&gt; &#39;&#40;&#40;&gt;=7&#41;|&#40;! 5&#41;&#38;IE&#39;,
               -src =&gt; &#39;/style/complex_IE.css&#39;,
               -code =&gt; &#39;.foo, .bar { border: #800;}&#39;}
        ]
    }
  &#41;;
produces
  &lt;!--[if IE]&gt;
  &lt;style type=&#34;text/css&#34;&gt;
  .foo {color: navy;}
  &lt;/style&gt;
  &lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;/style/1_IE.css&#34; media=&#34;all&#34;&gt;
  &lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;/style/2_IE.css&#34; media=&#34;all&#34;&gt;
  &lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;/style/3_IE.css&#34; media=&#34;all&#34;&gt;
  &lt;style type=&#34;text/css&#34;&gt;
  &lt;!-- 
  .bar {padding: 1em;}
   --&gt;
  &lt;/style&gt;
  &lt;![endif]--&gt;
  &lt;!--[if  IE 5]&gt;
  &lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;/style/IE5.css&#34; media=&#34;all&#34;&gt;
  &lt;![endif]--&gt;
  &lt;!--[if IE]&gt;
  &lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;/style/4.css&#34; media=&#34;all&#34;&gt;
  &lt;![endif]--&gt;
  &lt;![if ! IE]&gt;
  &lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;/style/notIE.css&#34; &gt;
  &lt;![endif]&gt;
  &lt;!--[if &#40;&#40;gte IE 7&#41;|&#40;! IE 5&#41;&#38;IE]&gt;
  &lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;/style/complex_IE.css&#34;
media=&#34;all&#34;&gt;
  &lt;style type=&#34;text/css&#34;&gt;
  &lt;!-- 
  .foo, .bar { border: #800;}
   --&gt;
  &lt;/style&gt;
  &lt;![endif]--&gt;

Coming eventually: conditional comments for scripts and arbitrary header
elements.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> CGI.pm.patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- CGI.pm.orig	2008-07-29 11:00:05.000000000 -0400
+++ CGI.pm	2008-08-01 03:49:51.000000000 -0400
@@ -1701,23 +1701,22 @@
 ####
 &#39;_style&#39; =&gt; &lt;&lt;&#39;END_OF_FUNC&#39;,
 sub _style {
-    my &#40;$self,$style&#41; = @_;
+    my &#40;$self,$style,$cdata_start,$cdata_end&#41; = @_;
     my &#40;@result&#41;;
 
     my $type = &#39;text/css&#39;;
     my $rel  = &#39;stylesheet&#39;;
 
-
-    my $cdata_start = $XHTML ? &#34;\n&lt;!--/* &lt;![CDATA[ */&#34; : &#34;\n&lt;!-- &#34;;
-    my $cdata_end   = $XHTML ? &#34;\n/* ]]&gt; */--&gt;\n&#34; : &#34; --&gt;\n&#34;;
+    $cdata_start ||= $XHTML ? &#34;\n&lt;!--/* &lt;![CDATA[ */&#34; : &#34;\n&lt;!-- &#34;;
+    $cdata_end   ||= $XHTML ? &#34;\n/* ]]&gt; */--&gt;\n&#34; : &#34; --&gt;\n&#34;;
 
     my @s = ref&#40;$style&#41; eq &#39;ARRAY&#39; ? @$style : $style;
     my $other = &#39;&#39;;
 
     for my $s &#40;@s&#41; {
       if &#40;ref&#40;$s&#41;&#41; {
-       my&#40;$src,$code,$verbatim,$stype,$alternate,$foo,@other&#41; =
-           rearrange&#40;[qw&#40;SRC CODE VERBATIM TYPE ALTERNATE FOO&#41;],
+       my&#40;$src,$code,$verbatim,$stype,$alternate,$cond,$foo,@other&#41; =
+           rearrange&#40;[qw&#40;SRC CODE VERBATIM TYPE ALTERNATE COND FOO&#41;],
                       &#40;&#39;-foo&#39;=&gt;&#39;bar&#39;,
                        ref&#40;$s&#41; eq &#39;ARRAY&#39; ? @$s : %$s&#41;&#41;;
        my $type = defined $stype ? $stype : &#39;text/css&#39;;
@@ -1729,15 +1728,16 @@
            foreach $src &#40;@$src&#41;
          {
            push&#40;@result,$XHTML ? qq&#40;&lt;link rel=&#34;$rel&#34; type=&#34;$type&#34; href=&#34;$src&#34; $other/&gt;&#41;
-                             : qq&#40;&lt;link rel=&#34;$rel&#34; type=&#34;$type&#34; href=&#34;$src&#34;$other&gt;&#41;&#41; if $src;
+                             : qq&#40;&lt;link rel=&#34;$rel&#34; type=&#34;$type&#34; href=&#34;$src&#34; $other&gt;&#41;&#41; if $src;
          }
        }
        else
        { # Otherwise, push the single -src, if it exists.
          push&#40;@result,$XHTML ? qq&#40;&lt;link rel=&#34;$rel&#34; type=&#34;$type&#34; href=&#34;$src&#34; $other/&gt;&#41;
-                             : qq&#40;&lt;link rel=&#34;$rel&#34; type=&#34;$type&#34; href=&#34;$src&#34;$other&gt;&#41;
+                             : qq&#40;&lt;link rel=&#34;$rel&#34; type=&#34;$type&#34; href=&#34;$src&#34; $other&gt;&#41;
               &#41; if $src;
         }
+        push&#40;@result,$self-&gt;_condStyle&#40;$cond, $type, $rel, $other, @other&#41;&#41; if $cond;
      if &#40;$verbatim&#41; {
            my @v = ref&#40;$verbatim&#41; eq &#39;ARRAY&#39; ? @$verbatim : $verbatim;
            push&#40;@result, &#34;&lt;style type=\&#34;text/css\&#34;&gt;\n$_\n&lt;/style&gt;&#34;&#41; foreach @v;
@@ -1748,13 +1748,140 @@
       } else {
            my $src = $s;
            push&#40;@result,$XHTML ? qq&#40;&lt;link rel=&#34;$rel&#34; type=&#34;$type&#34; href=&#34;$src&#34; $other/&gt;&#41;
-                               : qq&#40;&lt;link rel=&#34;$rel&#34; type=&#34;$type&#34; href=&#34;$src&#34;$other&gt;&#41;&#41;;
+                               : qq&#40;&lt;link rel=&#34;$rel&#34; type=&#34;$type&#34; href=&#34;$src&#34; $other&gt;&#41;&#41;;
       }
     }
     @result;
 }
 END_OF_FUNC
 
+### Method: _condStyle
+# internal method for generating conditional sections containing CSS style elements
+# Responsible for unpacking arrays containing mixed 
+####
+&#39;_condStyle&#39; =&gt; &lt;&lt;&#39;END_OF_FUNC&#39;,
+sub _condStyle {
+    my &#40;$self,$cond, $type, $rel, $other, @other&#41; = @_;
+
+    if &#40;ref&#40;$cond&#41; eq &#39;ARRAY&#39;&#41; {
+        my &#40;@result, @sheets&#41;;
+        if &#40;$cond-&gt;[0] =~ /^!?[glteq&lt;&gt;=]*\s*&#40;?:ie\s*&#41;?\d+&#40;?:\.\d+&#41;?$/i&#41; {
+           push @sheets, shift @$cond;
+        }
+        foreach $c &#40;@$cond&#41; {
+            if &#40;ref $c&#41; {
+                if &#40;ref $c eq &#39;HASH&#39; &#38;&#38; !defined&#40;$c-&gt;{&#39;-expr&#39;}&#41;&#41; {
+                  push&#40;@sheets, $c&#41;;
+                } else {
+                  push&#40;@result,$self-&gt;_condSheets&#40;$c, $type, $rel, $other, @other&#41;&#41; if $c;
+                }
+            } else {
+                push&#40;@sheets, $c&#41;;
+            }
+        }
+        # unshift to put the general IE style before the more specific style
+        unshift&#40;@result,$self-&gt;_condSheets&#40;\@sheets, $type, $rel, $other, @other&#41;&#41; if @sheets;
+        return @result;
+    } else {
+        return $self-&gt;_condSheets&#40;$cond, $type, $rel, $other, @other&#41;;
+    }
+}
+END_OF_FUNC
+
+### Method: _sheet
+# internal method for generating an external or header style, based on content
+# content can be: a scalar
+###
+&#39;_sheet&#39; =&gt; &lt;&lt;&#39;END_OF_FUNC&#39;,
+sub _sheet &#40;$$;$$$&#41; {
+    my &#40;$self,$content, $type, $rel, $other&#41; = @_;
+    if &#40;$content =~ m%/\*.*\*/|{&#40;?:\s*[-_a-z]*:.*;?&#41;*\s*}%&#41; {
+        # can&#39;t use CDATA
+        # $cdata_&#40;start|end&#41; are locally defined elsewhere
+        return style&#40;{&#39;type&#39;=&gt;$type},&#34;$cdata_start\n$content\n$cdata_end&#34;&#41;;
+    } else {
+        return $XHTML ? qq&#40;&lt;link rel=&#34;$rel&#34; type=&#34;$type&#34; href=&#34;$content&#34; $other/&gt;&#41;
+                      : qq&#40;&lt;link rel=&#34;$rel&#34; type=&#34;$type&#34; href=&#34;$content&#34; $other&gt;&#41;
+    }
+}
+END_OF_FUNC
+
+### Method: _condSheets
+# internal method for generating a conditional section containing CSS style sections
+# _condSheets&#40;$CGI, $cond, $type, $rel, $other, @other&#41;
+# If $cond is an array ref, all elements must be scalars or hashes with no 
+# &#39;-expr&#39; key; the 1st element may be an expression. if $cond is a hash, it is 
+# passed through _style; it should not contain any &#39;-cond&#39; sections
+####
+&#39;_condSheets&#39; =&gt; &lt;&lt;&#39;END_OF_FUNC&#39;,
+sub _condSheets {
+    my &#40;$self,$cond, $type, $rel, $other, @other&#41; = @_;
+    my $expr = &#39;IE&#39;;
+
+    # can&#39;t use HTML comments within a conditional comment, so need different $cdata_.*
+    local $cdata_start = $XHTML ? &#34;\n/* &lt;![CDATA[ */&#34; : &#39;&#39;;
+    local $cdata_end   = $XHTML ? &#34;\n/* ]]&gt; */\n&#34; : &#39;&#39;;
+
+    if &#40;ref $cond&#41; {
+      if &#40;ref $cond eq &#39;HASH&#39; &#38;&#38; $cond-&gt;{&#39;-expr&#39;}&#41; {
+        $expr = delete $cond-&gt;{&#39;-expr&#39;};
+      } elsif &#40;ref $cond eq &#39;ARRAY&#39;
+               &#38;&#38; $cond-&gt;[0] =~ /^&#40;?:[ l&lt;g&gt;n]?t?[&gt;e=]?\s*&#40;?:ie\s*&#41;?&#40;?:\d&#40;?:\.\d+&#41;?&#41;|[ !&#40;&#41;|&#38;]+|false|true&#41;+$/i&#41; 
+     {
+        # above RE is more permissive than the expression grammer, but still  
+        # won&#39;t match URIs or style sheets &#40;no false positives&#41;.  Here&#39;s a more  
+        # restrictive RE that has false negatives:
+        # /^&#40;?:\s*!?\s*\&#40;?[ glt&lt;&gt;=!]*[=e]?\s*&#40;?:ie\s*&#41;?&#40;?:\d+&#40;?:\.\d+&#41;?|true|false|[&#38;|]&#41;\&#41;?\s*[&#38;|]?&#41;+$/i
+        # eg &#39;&#40;7|&#40;9|5.5&#41;&#41;&#39;.  Of course, the likelihood of these more complex 
+        # expressions is low.
+        $expr = shift @$cond;
+      }
+      $expr =~ s/eq|==//gi;          # strip &#39;eq&#39; and &#39;==&#39;
+      $expr =~ s/&#40;?:!=|ne|&lt;&gt;&#41;\s*/!/gi;  # replace &#39;!=&#39;, &#39;ne&#39; and &#39;&lt;&gt;&#39; with &#39;!&#39;
+      $expr =~ s/&#40;[gl]&#41;e/$1te/g;     # replace &#39;le&#39; and &#39;ge&#39; with &#39;lte&#39; and &#39;gte&#39;
+      $expr =~ s/&lt;/lt/g;             #
+      $expr =~ s/&gt;/gt/g;             #
+      $expr =~ s/=\s*/e /g;          #
+      # insert &#34;IE&#34; where it&#39;s missing
+      $expr =~ s/&#40;^|[gl!]t?e?&#41;\s*&#40;\d&#41;|&#40;!&#41;\s*&#40;?:\&#41;|$&#41;/$1$3 IE $2/gi;
+      $expr =~ s/^\s+|\s+$//g;
+    }
+    my $uplevel = &#39;--&#39;;
+    # if expression is &#39;! IE&#39;, then the conditional comment is targeting non-IE
+    # browsers, so we want a &#34;downlevel revealed&#34; conditional comment &#40;ie not a comment&#41;
+    if &#40;$expr =~ /^!\s*IE$/&#41; {
+      $uplevel = &#39;&#39;;
+    }
+
+    my @result = &#40;&#34;&lt;!${uplevel}[if $expr]&gt;&#34;&#41;;
+    if &#40;ref $cond eq &#39;ARRAY&#39;&#41; {
+        foreach my $sheet &#40;@$cond&#41; {
+            if &#40;ref&#40;$sheet&#41; eq &#39;HASH&#39;&#41; {
+              $sheet-&gt;{&#39;-type&#39;} ||= $type;
+              $sheet-&gt;{&#39;-alternate&#39;} = 1 if $rel ne &#39;stylesheet&#39;;
+              my %other = @other;
+              @{$sheet}{keys %other} = values %other;
+              # sanity check for $sheet-&gt;{&#39;-cond&#39;}?
+              push @result, $self-&gt;_style&#40;$sheet, $cdata_start, $cdata_end&#41;;
+            } else {
+              push @result, $self-&gt;_sheet&#40;$sheet, $type, $rel, $other&#41;;
+            }
+        }
+    } elsif &#40;ref $cond eq &#39;HASH&#39;&#41;  {
+        $cond-&gt;{&#39;-type&#39;} ||= $type;
+        $cond-&gt;{&#39;-alternate&#39;} = 1 if $rel ne &#39;stylesheet&#39;;
+        my %other = @other;
+        @{$cond}{keys %other} = values %other;
+        push @result, $self-&gt;_style&#40;$cond, $cdata_start, $cdata_end&#41;;
+    } else {
+        push @result, $self-&gt;_sheet&#40;$cond, $type, $rel, $other&#41;;
+    }
+    push @result, &#34;&lt;![endif]$uplevel&gt;&#34;;
+    return @result;
+}
+END_OF_FUNC
+
+
 &#39;_script&#39; =&gt; &lt;&lt;&#39;END_OF_FUNC&#39;,
 sub _script {
     my &#40;$self,$script&#41; = @_;
@@ -7133,14 +7260,83 @@
 start_html&#40;&#41; method a B&lt;-style&gt; parameter.  The value of this
 parameter may be a scalar, in which case it is treated as the source
 URL for the stylesheet, or it may be a hash reference.  In the latter
-case you should provide the hash with one or more of B&lt;-src&gt; or
-B&lt;-code&gt;.  B&lt;-src&gt; points to a URL where an externally-defined
+case you should provide the hash with one or more of B&lt;-src&gt;, B&lt;-code&gt;
+or B&lt;-cond&gt;.  B&lt;-src&gt; points to a URL where an externally-defined
 stylesheet can be found.  B&lt;-code&gt; points to a scalar value to be
 incorporated into a &lt;style&gt; section.  Style definitions in B&lt;-code&gt;
 override similarly-named ones in B&lt;-src&gt;, hence the name &#34;cascading.&#34;
 
-You may also specify the type of the stylesheet by adding the optional
-B&lt;-type&gt; parameter to the hash pointed to by B&lt;-style&gt;.  If not
+B&lt;-cond&gt; will wrap the style sheet&#40;s&#41; in a conditional comment.  The 
+basic values of a B&lt;-cond&gt; can be a string, an array or a hash.  
+A string is a URI path or CSS rules &#40;CGI.pm will automatically 
+pick which&#41;.  A hash is similar to what you might pass to a B&lt;-style&gt;
+argument, but it cannot contain any B&lt;-cond&gt; and can optionally contain 
+a B&lt;-expr&gt; argument, which becomes the conditional expression 
+&#40;&#34;&lt;!--[if $expr]&gt;&#34;&#41;.  An array starts with an optional expression; if 
+absent, it defaults to the expression &#39;IE&#39;.
+
+You can also pass B&lt;-cond&gt; an array of basic values; this array can also 
+start with an optional conditional expression, which becomes the expression
+for all scalars and hashes missing and &#39;-expr&#39; key, but not for arrays &#40;see
+complex example below&#41;.
+
+Conditional expressions are slightly expanded from what IE accepts: you 
+can use symbolic comparisons &#40;eg &#39;&lt;&#39; for &#39;lt&#39;; &#39;&lt;&gt;7&#39;, &#39;!=7&#39; or &#39;ne 7&#39; 
+for &#39;! IE 7&#39;&#41; and don&#39;t need to include the &#39;IE&#39; feature &#40;eg &#39;gte 6&#39; for
+&#39;gte IE 6&#39;&#41;.  The expanded form will be translated to one IE handles.
+
+A B&lt;-cond&gt; can be as simple as:
+    -cond =&gt; &#39;/style/site_IE.css&#39;
+which produces:
+  &lt;!--[if IE]&gt;
+  &lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;/style/site_IE.css&#34; /&gt;
+  &lt;![endif]--&gt;
+and can be as complex as:
+    -cond =&gt; [5.5, &#39;.foo {color: navy;}&#39;, &#39;/style/1_IE.css&#39;, 
+	      [5, &#39;/style/IE5.css&#39;],
+	      {-src =&gt; [&#39;/style/2_IE.css&#39;, &#39;/style/3_IE.css&#39;], 
+	       -code =&gt; &#39;.bar {padding: 1em;}&#39;}, 
+	      [&#39;/style/4.css&#39;],
+	      [&#39;!&#39;, &#39;/style/notIE.css&#39;],
+	      {-expr =&gt; &#39;&#40;&#40;&gt;=7&#41;|&#40;! 5&#41;&#38;IE&#39;,
+	       -src =&gt; &#39;/style/complex_IE.css&#39;,
+	       -code =&gt; &#39;.foo, .bar { border: #800;}&#39;}
+	]
+which produces:
+ &lt;!--[if IE 5.5]&gt;
+ &lt;style type=&#34;text/css&#34;&gt;
+ .foo {color: navy;}
+ &lt;/style&gt;
+ &lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;/style/1_IE.css&#34; &gt;
+ &lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;/style/2_IE.css&#34; &gt;
+ &lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;/style/3_IE.css&#34; &gt;
+ &lt;style type=&#34;text/css&#34;&gt;
+ &lt;!-- 
+ .bar {padding: 1em;}
+  --&gt;
+ &lt;/style&gt;
+ &lt;![endif]--&gt;
+ &lt;!--[if IE 5]&gt;
+ &lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;/style/IE5.css&#34; &gt;
+ &lt;![endif]--&gt;
+ &lt;!--[if IE]&gt;
+ &lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;/style/4.css&#34; &gt;
+ &lt;![endif]--&gt;
+ &lt;![if ! IE]&gt;
+ &lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;/style/notIE.css&#34; &gt;
+ &lt;![endif]&gt;
+ &lt;!--[if &#40;&#40;gte IE 7&#41;|&#40;! IE 5&#41;&#38;IE]&gt;
+ &lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;/style/complex_IE.css&#34; &gt;
+ &lt;style type=&#34;text/css&#34;&gt;
+ &lt;!-- 
+ .foo, .bar { border: #800;}
+  --&gt;
+ &lt;/style&gt;
+ &lt;![endif]--&gt;
+
+
+You may also specify the type of the stylesheet&#40;s&#41; by adding the optional
+B&lt;-type&gt; parameter to the hash pointed to by B&lt;-style&gt;.  If not 
 specified, the style defaults to &#39;text/css&#39;.
 
 To refer to a style within the body of your document, add the
@@ -7219,13 +7415,16 @@
 incorporated into the &lt;link&gt; tag.  For example:
 
  start_html&#40;-style=&gt;{-src=&gt;[&#39;/styles/print.css&#39;,&#39;/styles/layout.css&#39;],
+		     -cond=&gt;&#39;/styles/IE.css&#39;,
 			  -media =&gt; &#39;all&#39;}&#41;;
 
 This will give:
 
  &lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;/styles/print.css&#34; media=&#34;all&#34;/&gt;
  &lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;/styles/layout.css&#34; media=&#34;all&#34;/&gt;
-
+ &lt;!--[if IE]&gt;
+ &lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;/styles/IE.css&#34; media=&#34;all&#34;/&gt;
+ &lt;![endif]--&gt;
 &lt;p&gt;
 
 To make more complicated &lt;link&gt; tags, use the Link&#40;&#41; function
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;25&nbsp;16:20:51&nbsp;2009</span>
    <span class="description">MARKSTOS [...] cpan.org -  Subject changed from &#39;[PATCH] Added support for conditional comments containing style&#39; to &#39;Needs Lincoln: Propose adding support for conditional comments containing style&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;25&nbsp;16:22:27&nbsp;2009</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
Lincoln,

I&#39;d like your opinion on adding new features and enhancements to the
HTML generation code in CGI.pm. 

It&#39;s not an area of the code base I&#39;m personally interested in expanding. 

   Mark


On Fri Aug 01 10:39:02 2008, outis wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Patch is to add preliminary support &#40;&#38; documentation&#41; for conditional
&gt; comments around style sheets.  With the patch, the -style option accepts
&gt; a -cond argument.  For example,
&gt;   print start_html&#40;-style =&gt; {
&gt;     -media =&gt; &#39;all&#39;,
&gt;     -cond =&gt; [&#39;.foo {color: navy;}&#39;, &#39;/style/1_IE.css&#39;, 
&gt;             [5, &#39;/style/IE5.css&#39;],
&gt;             {-src =&gt; [&#39;/style/2_IE.css&#39;, &#39;/style/3_IE.css&#39;], 
&gt;              -code =&gt; &#39;.bar {padding: 1em;}&#39;}, 
&gt;             [&#39;/style/4.css&#39;],
&gt;             [&#39;!&#39;, &#39;/style/notIE.css&#39;],
&gt;             {-expr =&gt; &#39;&#40;&#40;&gt;=7&#41;|&#40;! 5&#41;&#38;IE&#39;,
&gt;              -src =&gt; &#39;/style/complex_IE.css&#39;,
&gt;              -code =&gt; &#39;.foo, .bar { border: #800;}&#39;}
&gt;       ]
&gt;     }
&gt;   &#41;;
&gt; produces
&gt;   &lt;!--[if IE]&gt;
&gt;   &lt;style type=&#34;text/css&#34;&gt;
&gt;   .foo {color: navy;}
&gt;   &lt;/style&gt;
&gt;   &lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;/style/1_IE.css&#34;
</div>media=&#34;all&#34;&gt;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;   &lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;/style/2_IE.css&#34;
</div>media=&#34;all&#34;&gt;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;   &lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;/style/3_IE.css&#34;
</div>media=&#34;all&#34;&gt;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;   &lt;style type=&#34;text/css&#34;&gt;
&gt;   &lt;!-- 
&gt;   .bar {padding: 1em;}
&gt;    --&gt;
&gt;   &lt;/style&gt;
&gt;   &lt;![endif]--&gt;
&gt;   &lt;!--[if  IE 5]&gt;
&gt;   &lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;/style/IE5.css&#34;
</div>media=&#34;all&#34;&gt;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;   &lt;![endif]--&gt;
&gt;   &lt;!--[if IE]&gt;
&gt;   &lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;/style/4.css&#34; media=&#34;all&#34;&gt;
&gt;   &lt;![endif]--&gt;
&gt;   &lt;![if ! IE]&gt;
&gt;   &lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;/style/notIE.css&#34; &gt;
&gt;   &lt;![endif]&gt;
&gt;   &lt;!--[if &#40;&#40;gte IE 7&#41;|&#40;! IE 5&#41;&#38;IE]&gt;
&gt;   &lt;link rel=&#34;stylesheet&#34; type=&#34;text/css&#34; href=&#34;/style/complex_IE.css&#34;
&gt; media=&#34;all&#34;&gt;
&gt;   &lt;style type=&#34;text/css&#34;&gt;
&gt;   &lt;!-- 
&gt;   .foo, .bar { border: #800;}
&gt;    --&gt;
&gt;   &lt;/style&gt;
&gt;   &lt;![endif]--&gt;
&gt; 
&gt; Coming eventually: conditional comments for scripts and arbitrary header
&gt; elements.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;25&nbsp;16:22:28&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;21&nbsp;21:19:41&nbsp;2013</span>
    <span class="description">MARKSTOS [...] cpan.org -  Subject changed from &#39;Needs Lincoln: Propose adding support for conditional comments containing style&#39; to &#39;Proposal: support for conditional comments containing style &#40;HTML generation&#41;&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;22&nbsp;08:04:09&nbsp;2014</span>
    <span class="description">LEEJO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This issue has been copied to: <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/leejo/CGI.pm/issues/56">https://github.com/leejo/CGI.pm/issues/56</a></span> please take all future correspondence there.
This ticket will remain open but please do not reply here.
This ticket will be closed when the github issue is dealt with.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;23&nbsp;14:28:02&nbsp;2014</span>
    <span class="description">The RT System itself -  Queue changed from CGI.pm to CGI</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;28&nbsp;16:01:54&nbsp;2014</span>
    <span class="description">LEEJO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Rejecting. I&#39;m not accepting any feature requests, patches, or updates to the HTML generating functions of CGI.pm unless they are of a critical nature &#40;i.e. fixing fundamentally broken HTML output&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;28&nbsp;16:01:55&nbsp;2014</span>
    <span class="description">LEEJO [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
