<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #38977 for DBD-ODBC: DBD::ODBC fails to insert a large files &#40;above 400kb&#41; in VARBINARY column.</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #38977 for DBD-ODBC: DBD::ODBC fails to insert a large files &#40;above 400kb&#41; in VARBINARY column.</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=DBD-ODBC">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=DBD-ODBC">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=DBD-ODBC">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=DBD-ODBC">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBD-ODBC">DBD-ODBC CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">38977</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=DBD-ODBC">DBD-ODBC</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
julian.lishev [...] imperia.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-10188-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10189-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
1.16_3    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




dbdimp.c.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/504458/250709/dbdimp.c.patch">
Thu Sep 04 07:04:02 2008 (439b) by julian.lishev [...] imperia.net
</a>
</font></li>
</ul>


dbdimp.c.patch2<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/504458/250710/dbdimp.c.patch2">
Thu Sep 04 07:04:02 2008 (708b) by julian.lishev [...] imperia.net
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=38977">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-504458" href="/Public/Bug/Display.html?id=38977#txn-504458">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;04&nbsp;07:04:01&nbsp;2008</span>
    <span class="description">julian.lishev [...] imperia.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> DBD::ODBC fails to insert a large files &#40;above 400kb&#41; in VARBINARY column.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 04 Sep 2008 14:02:38 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-ODBC [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Julian Lishev &lt;julian.lishev [...] imperia.net&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/504458/250708/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/250708">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">BUG:
---
DBD::ODBC fails to insert a large files &#40;above 400kb&#41; in VARBINARY&#40;MAX&#41; 
column.

Description:
-----------
After installation of SQL Server 2005 &#40;old SQL Server 2000 were removed 
from the same machine&#41; currently installed version of DBD::ODBC &#40;1.14&#41; 
crashed Perl everytime I run my script.
After update to 1.15 &#40;latest verion in ActiveState repository&#41; script 
stoped to crush with exception, but start waiting in never ending cycle 
without doing nothing.
Using VS 2005 I&#39;ve compiled ver 1.16 but not luck bug to disappear. The 
same story with HEAD snapshot of SVN.
After short debuging I&#39;ve found that SQLPutData throws the error &#40;see 
below what [ODBC SQL Server Driver] and [SQL Server] say about this 
problem&#41;.

First bug fix without understanding why exactly this worked &#40;according 
MSDN documentation that shouldn&#39;t work&#41; follows:

&#40;see dbdimp.c.patch&#41;

In other words, when you call SQLBindParameter&#40;&#41; with parameter 
&#34;&#38;phs-&gt;cbValue&#34; that exceed 400k &#40;a well-known limit, above which ODBC 
based application should use SQLPutData&#41; then an error is trhown. 
However this change does not prevent SQL Server to insert the whole file 
and it does NOT trunkate the data as expected&#40;?!&#41;

However PHP odbc module works &#40;I wrote a small php script&#41; properly and 
insert large files in VARBINARY columns without any problems, so I&#39;ve 
downloaded PHP source code &#40;ver 4.4.9&#41; to skim for any differences in 
implementation.

Second patch is inspirated from PHP code of ODBC module, where they 
don&#39;t supply real length and use just 0:

&#40;see dbdimp.c.patch2&#41;

I think with this fix, ODBC works even faster &#40;?!&#41;


OS and soft details:
-------------------
Windows XP Professional &#40;with latest MS updates&#41;;
Perl v5.10.0 built for MSWin32-x86-multi-thread;
DBD::ODBC: versions: 1.14, 1.15, 1.16 and current SVN snapshot.
Driver: SQL Server Version: 2000.85.1132.00 File: SQLSRV32.DLL Date: 
4/14/2008
Driver Manager: Version 3.525.1132.0 C:\Windows\system32\odbc32.dll
SQL Server: tested with &#34;2005 Standart&#34; and &#34;2005 Express&#34; Edition.

Here is are table structure:
---------------------------
CREATE TABLE binary_meta &#40;
    doc_id INTEGER NOT NULL,
    meta_name  VARCHAR &#40;255&#41;,
    meta_value VARBINARY&#40;MAX&#41;,
    meta_idx   INTEGER,
    from_ver  BIGINT,
    to_ver    BIGINT
&#41;

Insert statement that fails:
---------------------------
INSERT into binary_meta VALUES &#40;?, ?, ?, ?, ?, ?&#41;

Selected parts from the log &#40;error log level 5&#41;:
-----------------------------------------------
bind 3 &lt;== &#39;PK...&#39; &#40;size cur=1726168/len=1726172/max=0, svtype 6, otype 
1, sqltype -4&#41;
bind 3 &lt;== &#39;PK...&#39; &#40;len 1726168/1726170, null 0&#41;
bind 3: type=-2, LONG VARBINARY, cs=1726168, dd=0, bl=1726168.
bind 3: type=-2, LONG VARBINARY, cs=1726168, dd=0, bl=1726168.
SQLBindParameter: idx = 3: param_type=1, name=3, value_type=-2, SQL_Type 
= -4, column_size=1726168, d_digits=0, value_ptr=3a904c4, 
buffer_length=1726168, cbValue = -1726268
dbd_st_execute &#40;NEED DATA&#41;...

!!dbd_error2&#40;err_rc=-1, what=st_execute/SQLExecute, 
handles=&#40;28512a0,2851348,2857a40&#41;
    !SQLError&#40;28512a0,2851348,2857a40&#41; = &#40;HY000, 0, [Microsoft][ODBC SQL 
Server Driver]Warning: Partial insert/update. The insert/update of a 
text or image column&#40;s&#41; did not succeed.&#41;
    !SQLError&#40;28512a0,2851348,2857a40&#41; = &#40;42000, 7125, [Microsoft][ODBC 
SQL Server Driver][SQL Server]The text, ntext, or image pointer value 
conflicts with the column name specified.&#41;
    !! ERROR: 1 &#39;[Microsoft][ODBC SQL Server Driver]Warning: Partial 
insert/update. The insert/update of a text or image column&#40;s&#41; did not 
succeed. &#40;SQL-HY000&#41; [state was HY000 now 42000]
[Microsoft][ODBC SQL Server Driver][SQL Server]The text, ntext, or image 
pointer value conflicts with the column name specified. &#40;SQL-42000&#41;&#39; &#40;err#2&#41;

P.S. Please confirm that you have received this mail

Regards,
Julian Lishev
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/504458/250709/dbdimp.c.patch">Download dbdimp.c.patch</a><br />
<span class="downloadcontenttype">text/x-diff 439b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Index: dbdimp.c
===================================================================
--- dbdimp.c	&#40;revision 11739&#41;
+++ dbdimp.c	&#40;working copy&#41;
@@ -3222,6 +3222,8 @@
         * SQLPutData.
         */
       SQLLEN vl = value_len;
+      if &#40;value_type == SQL_C_BINARY &#38;&#38; vl &gt; 400*1024&#41;
+         vl = 400*1024;
       d_digits = 0; /* not relevant to lobs */
       phs-&gt;cbValue = SQL_LEN_DATA_AT_EXEC&#40;vl&#41;;
       value_ptr = &#40;UCHAR*&#41; phs;
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/504458/250710/dbdimp.c.patch2">Download dbdimp.c.patch2</a><br />
<span class="downloadcontenttype">text/plain 708b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Index: dbdimp.c
===================================================================
--- dbdimp.c	&#40;revision 11739&#41;
+++ dbdimp.c	&#40;working copy&#41;
@@ -3223,7 +3223,7 @@
         */
       SQLLEN vl = value_len;
       d_digits = 0; /* not relevant to lobs */
-      phs-&gt;cbValue = SQL_LEN_DATA_AT_EXEC&#40;vl&#41;;
+      phs-&gt;cbValue = SQL_LEN_DATA_AT_EXEC&#40;0&#41;;
       value_ptr = &#40;UCHAR*&#41; phs;
    }
 
@@ -3257,7 +3257,7 @@
    rc = SQLBindParameter&#40;imp_sth-&gt;hstmt,
 			 phs-&gt;idx, param_type, value_type, phs-&gt;sql_type,
 			 column_size, d_digits,
-			 value_ptr, buffer_length, &#38;phs-&gt;cbValue&#41;;
+			 value_ptr, 0, &#38;phs-&gt;cbValue&#41;;
 
    if &#40;!SQL_SUCCEEDED&#40;rc&#41;&#41; {
       dbd_error&#40;sth, rc, &#34;_rebind_ph/SQLBindParameter&#34;&#41;;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-504477" href="/Public/Bug/Display.html?id=38977#txn-504477">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;04&nbsp;08:05:04&nbsp;2008</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/504477/250719/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/250719">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 371b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thank you for the bug report and suggested patches.

I confirm I&#39;ve received/seen this and will investigate further later
today. Can I just confirm that you are recommending patch2 and not patch1?

Once I have looked at it and decided on an action are you in a position
to build a new DBD::ODBC that I send you to confirm the fix?

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-504478" href="/Public/Bug/Display.html?id=38977#txn-504478">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;04&nbsp;08:05:06&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-504488" href="/Public/Bug/Display.html?id=38977#txn-504488">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;04&nbsp;08:49:31&nbsp;2008</span>
    <span class="description">julian.lishev [...] imperia.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #38977] DBD::ODBC fails to insert a large files &#40;above 400kb&#41; in VARBINARY column.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 04 Sep 2008 15:48:51 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-ODBC [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Julian Lishev &lt;julian.lishev [...] imperia.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/504488/250726/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/250726">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

I think patch2 is better, just because I&#39;ve seen something like that in 
PHP &#40;php-4.4.9\ext\odbc\php_odbc.c: line 1052 and line 1040&#41;, but I 
don&#39;t fully understand what is the right fix, because MSDN &#40; 
<span class="clickylink"><a target="new" rel="nofollow" href="http://msdn.microsoft.com/en-us/library/ms710963&#40;VS.85&#41;.aspx">http://msdn.microsoft.com/en-us/library/ms710963&#40;VS.85&#41;.aspx</a></span> &#41; does not 
suggest something like that, regarding these parameters. Also they &#40;php&#41; 
use SQLDescribeParam&#40;&#41; to detect &#34;precision&#34; parameter &#40;&#34;column_size&#34; 
parameter used in SQLBindParameter&#41;. Btw take a look at line 1077 
&#40;php_odbc.c&#41;, the way they use SQLPutData &#40;send data by chunks not at 
once. I know that we don&#39;t need such thing in DBD::ODBC because we have 
the whole buffer at once&#41;.

I can help to compile and test patched DBD::ODBC, but I hope you will be 
able to reproduce this on your own machine and probably find better 
solution. My patches seems to work, but I don&#39;t understand MS/ODBC logic 
behind this and why this really works.

Julian

Martin J Evans via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=38977">http://rt.cpan.org/Ticket/Display.html?id=38977</a></span> &gt;
&gt;
&gt; Thank you for the bug report and suggested patches.
&gt;
&gt; I confirm I&#39;ve received/seen this and will investigate further later
&gt; today. Can I just confirm that you are recommending patch2 and not patch1?
&gt;
&gt; Once I have looked at it and decided on an action are you in a position
&gt; to build a new DBD::ODBC that I send you to confirm the fix?
&gt;
&gt; Martin
&gt;   
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-504629" href="/Public/Bug/Display.html?id=38977#txn-504629">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;04&nbsp;11:58:11&nbsp;2008</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/504629/250809/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/250809">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have reproduced this problem with SQL Server 2005 Express and a sql
server driver 2000.85.1117.00 and the following:

use DBI;
use strict;
use warnings;
my $h = DBI-&gt;connect;
eval {$h-&gt;do&#40;&#39;drop table binary_meta&#39;&#41;;};
$h-&gt;do&#40;&#39;create table binary_meta &#40;doc_id INTEGER NOT NULL, meta_name 
VARCHAR &#40;255&#41;, meta_value VARBINARY&#40;MAX&#41;, meta_idx   INTEGER, from_ver 
BIGINT, to_ver BIGINT&#41;&#39;&#41;;
my $s = $h-&gt;prepare&#40;&#39;INSERT into binary_meta VALUES &#40;?, ?, ?, ?, ?, ?&#41;&#39;&#41;;
my $x = &#39;x&#39; x 5000000;
$s-&gt;execute&#40;1, &#39;fred&#39;, $x, 1, 1, 1&#41;;

The errors are exactly as you described and the two possible patches you
provide also make it work &#40;for this sql server driver&#41;. However,
Microsoft&#39;s latest native client is not happy with your solutions and
neither was it happy with the original DBD::ODBC as it gives an invalid
precision error.

In addition your 2 possibilities break other ODBC drivers.

What I think is happening here is that your OLD SQL Server driver does
not know about VARBINARY&#40;MAX&#41; &#40;evidenced by the fact it returns
2147483643 for the length which is clearly wrong&#41; and DBD::ODBC was not
handling VARBINARY&#40;MAX&#41; properly. I believe the proper solution &#40;which
works without breaking other ODBC drivers&#41; is to take the parameter size
returned by SQLDescribeParam and use it in the call to SQLBindParameter
as the column_size but only for BINARY types as if you do this for
timestamps &#40;for instance&#41; you hit another bug in sql server driver.

I have made this change and I am in the process of completing testing.
However, this may not make you too happy since it won&#39;t work with your
ancient SQL Server ODBC driver and you&#39;ll need to upgrade it or use the
newer native client driver. I believe it is fair to ask people to
upgrade if they are using varbinary&#40;max&#41; as this column type is new.

Let me know your thoughts.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-504910" href="/Public/Bug/Display.html?id=38977#txn-504910">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;05&nbsp;06:48:31&nbsp;2008</span>
    <span class="description">julian.lishev [...] imperia.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #38977] DBD::ODBC fails to insert a large files &#40;above 400kb&#41; in VARBINARY column.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 05 Sep 2008 13:46:38 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-ODBC [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Julian Lishev &lt;julian.lishev [...] imperia.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/504910/250938/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/250938">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Yes, I&#39;m using sqlsrv32.dll driver &#40;as the only option before upgrade to 
SQL 2005&#41;, but I&#39;ve tried sqlncli.dll too and I experience the same problem.
First of all I&#39;ve found that SQLDescribeParam returns: 0 for &#34;precision&#34; 
in case of VARBINARY&#40;MAX&#41; when sqlncli is used, and 2147483647 under 
sqlsrv32 driver.
As you&#39;ve already mentioned: if you use current model, implemented in 
DBD::ODBC + using of SQLDescribeParam to collect &#34;precision&#34; and &#34;scale&#34; 
parameters.. that&#39;s OK, BUT this will
break old &#40;sqlsrv32.dll which is up to date: from 4/14/2008&#41; and I can 
see that already.

The only solution that I can confirm to works fine under MS SQL + 
sqlsrv32 AND sqlncli is to use PHP model &#40;second patch, that using 0-s&#41; 
+ using SQLDescribeParam to collect correct values depending of SQL driver.
I&#39;m not sure what will happen with other ODBC drivers, but at least I 
think DBD::ODBC can apply PHP patch for MS SQL drivers..., right? Or to 
completely forget support of sqlsrv32.dll..

Regards,
Julian

Martin J Evans via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=38977">http://rt.cpan.org/Ticket/Display.html?id=38977</a></span> &gt;
&gt;
&gt; I have reproduced this problem with SQL Server 2005 Express and a sql
&gt; server driver 2000.85.1117.00 and the following:
&gt;
&gt; use DBI;
&gt; use strict;
&gt; use warnings;
&gt; my $h = DBI-&gt;connect;
&gt; eval {$h-&gt;do&#40;&#39;drop table binary_meta&#39;&#41;;};
&gt; $h-&gt;do&#40;&#39;create table binary_meta &#40;doc_id INTEGER NOT NULL, meta_name 
&gt; VARCHAR &#40;255&#41;, meta_value VARBINARY&#40;MAX&#41;, meta_idx   INTEGER, from_ver 
&gt; BIGINT, to_ver BIGINT&#41;&#39;&#41;;
&gt; my $s = $h-&gt;prepare&#40;&#39;INSERT into binary_meta VALUES &#40;?, ?, ?, ?, ?, ?&#41;&#39;&#41;;
&gt; my $x = &#39;x&#39; x 5000000;
&gt; $s-&gt;execute&#40;1, &#39;fred&#39;, $x, 1, 1, 1&#41;;
&gt;
&gt; The errors are exactly as you described and the two possible patches you
&gt; provide also make it work &#40;for this sql server driver&#41;. However,
&gt; Microsoft&#39;s latest native client is not happy with your solutions and
&gt; neither was it happy with the original DBD::ODBC as it gives an invalid
&gt; precision error.
&gt;
&gt; In addition your 2 possibilities break other ODBC drivers.
&gt;
&gt; What I think is happening here is that your OLD SQL Server driver does
&gt; not know about VARBINARY&#40;MAX&#41; &#40;evidenced by the fact it returns
&gt; 2147483643 for the length which is clearly wrong&#41; and DBD::ODBC was not
&gt; handling VARBINARY&#40;MAX&#41; properly. I believe the proper solution &#40;which
&gt; works without breaking other ODBC drivers&#41; is to take the parameter size
&gt; returned by SQLDescribeParam and use it in the call to SQLBindParameter
&gt; as the column_size but only for BINARY types as if you do this for
&gt; timestamps &#40;for instance&#41; you hit another bug in sql server driver.
&gt;
&gt; I have made this change and I am in the process of completing testing.
&gt; However, this may not make you too happy since it won&#39;t work with your
&gt; ancient SQL Server ODBC driver and you&#39;ll need to upgrade it or use the
&gt; newer native client driver. I believe it is fair to ask people to
&gt; upgrade if they are using varbinary&#40;max&#41; as this column type is new.
&gt;
&gt; Let me know your thoughts.
&gt;
&gt; Martin
&gt;   
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-504913" href="/Public/Bug/Display.html?id=38977#txn-504913">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;05&nbsp;07:02:07&nbsp;2008</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/504913/250941/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/250941">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Sep 05 06:48:31 2008, julian.lishev@imperia.net wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Yes, I&#39;m using sqlsrv32.dll driver &#40;as the only option before upgrade
&gt; to SQL 2005&#41;, but I&#39;ve tried sqlncli.dll too and I experience the
&gt; same problem.
</div>
I have reporduced your problem but I get a different error depending on
whether I am using the SQL Server ODBC driver or the native client. In
the former I get the same error as you on the execute and in the latter
I get an invalid precision value error on the SQLBindParameter.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; First of all I&#39;ve found that SQLDescribeParam returns: 0 for
&gt; &#34;precision&#34; in case of VARBINARY&#40;MAX&#41; when sqlncli is used,
&gt; and 2147483647 under sqlsrv32 driver.
</div>
Agreed.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As you&#39;ve already mentioned: if you use current model, implemented in
&gt; DBD::ODBC + using of SQLDescribeParam to collect &#34;precision&#34; and
&gt; &#34;scale&#34; parameters.. that&#39;s OK, BUT this will break old
&gt; &#40;sqlsrv32.dll which is up to date: from 4/14/2008&#41; and I can 
&gt; see that already.
</div>
Copying the parameter_size from SQLDescribeParam to SQLBindParameter
column size is what DBD::ODBC should have done in the first place and it
fixes your problem when using the up to date native client that knows
about MAX types. Yes, this does not work for older sql server odbc
drivers because they don&#39;t know about MAX types. The date you quote for
your odbc driver is irrelevant - it is the version that matters and your
driver version is 2000.xx.yy.zz &#40;old!&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; The only solution that I can confirm to works fine under MS SQL +
&gt; sqlsrv32 AND sqlncli is to use PHP model &#40;second patch, that using
&gt; 0-s&#41; + using SQLDescribeParam to collect correct values depending of
&gt; SQL driver.
</div>
Yes, but that breaks other odbc drivers.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m not sure what will happen with other ODBC drivers, but at least I 
&gt; think DBD::ODBC can apply PHP patch for MS SQL drivers..., right? Or
&gt; to completely forget support of sqlsrv32.dll..
</div>
I&#39;m not completely dropping support for sqlsrv32.dll. All I&#39;m saying is
that if you use the new MAX types you need a newer sqlsrv32.dll. The
sqlsrv32.dll version 2005.xx.yy.zz know about MAX types and work fine
with the change as I&#39;ve made it. Do you think upgrading to a newer
driver from a one over 8 years old is such a big issue? - I don&#39;t.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-504947" href="/Public/Bug/Display.html?id=38977#txn-504947">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;05&nbsp;08:22:15&nbsp;2008</span>
    <span class="description">julian.lishev [...] imperia.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #38977] DBD::ODBC fails to insert a large files &#40;above 400kb&#41; in VARBINARY column.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 05 Sep 2008 15:21:40 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-ODBC [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Julian Lishev &lt;julian.lishev [...] imperia.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/504947/250955/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/250955">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 978b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I have reporduced your problem but I get a different error depending on
&gt; whether I am using the SQL Server ODBC driver or the native client. In
&gt; the former I get the same error as you on the execute and in the latter
&gt; I get an invalid precision value error on the SQLBindParameter.
&gt;   
</div>Exactly.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m not completely dropping support for sqlsrv32.dll. All I&#39;m saying is
&gt; that if you use the new MAX types you need a newer sqlsrv32.dll. The
&gt; sqlsrv32.dll version 2005.xx.yy.zz know about MAX types and work fine
&gt; with the change as I&#39;ve made it. Do you think upgrading to a newer
&gt; driver from a one over 8 years old is such a big issue? - I don&#39;t.
</div>The strange thing here is that I have installed latest version of SQL 
Server with all service packs and patches, but I don&#39;t see any upgrade 
of sqlsrv32.dll i.e. I don&#39;t know how, neither I don&#39;t see from where to 
get newer version of that file... are you sure there is a 2005.xx.yy.zz 
version of this file?

Julian
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-505058" href="/Public/Bug/Display.html?id=38977#txn-505058">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;05&nbsp;12:27:27&nbsp;2008</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/505058/251018/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/251018">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 727b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Sep 05 08:22:15 2008, julian.lishev@imperia.net wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The strange thing here is that I have installed latest version of SQL 
&gt; Server with all service packs and patches, but I don&#39;t see any upgrade 
&gt; of sqlsrv32.dll i.e. I don&#39;t know how, neither I don&#39;t see from where
&gt; to  get newer version of that file... are you sure there is a
&gt; 2005.xx.yy.zz  version of this file?
&gt; 
&gt; Julian
</div>
I thought I&#39;d seen it but in fact it was 2000.86.xx.xx &#40;the version you
get with vista&#41; and I have yet to check that with the change. If it
still does not work I&#39;ll have to consider looking at the driver version
and then taking one of your options but that would be a&#41; tricky b&#41; annoying.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-505999" href="/Public/Bug/Display.html?id=38977#txn-505999">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;08&nbsp;06:20:14&nbsp;2008</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/505999/251547/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/251547">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 854b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ive now tried the most up to data Microsoft SQL Server driver I can find
&#40;which is on vista and is version 03.86.xxxx&#41;. It still fails. I don&#39;t
want to force people to the sql server native client so I&#39;ve put a
specific workaround in based on your second patch but only when

o the column is VARBINARY and VARCHAR
o the driver reports itself as SQLSRV32.DLL
o the driver reports the column size is 2147483647
o the data to be sent is greater than 400K

I have also taking the chance to rewrite around 30% of the parameter
binding code to make it more efficient and fix a few bugs. You can find
a test release here:

ftp://ftp.easysoft.com/pub/DBD-ODBC-1.16_3.tar.gz

Please try this and let me know the outcome so I can close this bug report.

Thanks for your help finding this and identifying possible solutions.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-506034" href="/Public/Bug/Display.html?id=38977#txn-506034">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;08&nbsp;08:11:38&nbsp;2008</span>
    <span class="description">julian.lishev [...] imperia.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #38977] DBD::ODBC fails to insert a large files &#40;above 400kb&#41; in VARBINARY column.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 08 Sep 2008 15:11:10 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-ODBC [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Julian Lishev &lt;julian.lishev [...] imperia.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/506034/251568/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/251568">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 422b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I have also taking the chance to rewrite around 30% of the parameter
&gt; binding code to make it more efficient and fix a few bugs. You can find
&gt; a test release here:
&gt;
&gt; ftp://ftp.easysoft.com/pub/DBD-ODBC-1.16_3.tar.gz
&gt;
&gt; Please try this and let me know the outcome so I can close this bug report.
</div>Archive is broken. I&#39;ve got the following error:

tar: Unrecognized archive format: Inappropriate file type or format
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-506047" href="/Public/Bug/Display.html?id=38977#txn-506047">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;08&nbsp;08:19:18&nbsp;2008</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/506047/251573/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/251573">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 84b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Just spotted that myself - try now.

Sorry.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-506126" href="/Public/Bug/Display.html?id=38977#txn-506126">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;08&nbsp;11:14:21&nbsp;2008</span>
    <span class="description">julian.lishev [...] imperia.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #38977] DBD::ODBC fails to insert a large files &#40;above 400kb&#41; in VARBINARY column.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 08 Sep 2008 18:06:55 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBD-ODBC [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Julian Lishev &lt;julian.lishev [...] imperia.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/506126/251619/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/251619">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 336b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have tested the patched code and by my own opinion seems to work fine 
both under &#34;SQL Server&#34; and &#34;SQL Native Client&#34; drivers.
I think you can even add test case to check for this problem :&#41;
Btw when are you planning to release 1.17 in CPAN? Hopefully ActiveState 
put this package in their repositories soon too :&#41;

Regards,
Julian
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-506135" href="/Public/Bug/Display.html?id=38977#txn-506135">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;08&nbsp;11:37:39&nbsp;2008</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/506135/251624/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/251624">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1006b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Sep 08 11:14:21 2008, julian.lishev@imperia.net wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I have tested the patched code and by my own opinion seems to work fine 
&gt; both under &#34;SQL Server&#34; and &#34;SQL Native Client&#34; drivers.
</div>
Excellent. There is nothing specific there for native client expect a
related bug fix to pass parameter size from SQLDescribeParam as column
size in SQLBindParameter. There is a workaround for sql server driver as
defined in previous comment.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I think you can even add test case to check for this problem :&#41;
</div>
I thought I had added a test case in t/rt_38977.t. If you ran nmake test
it should have run it.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Btw when are you planning to release 1.17 in CPAN? Hopefully ActiveState 
&gt; put this package in their repositories soon too :&#41;
</div>
If no one finds anything major wrong with it then next week. If
something major is found it depends how long it takes to fix and what
the extent of the change is.

Thanks for your help.
I am going to mark this fixed in 1.16_3 now.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-506384" href="/Public/Bug/Display.html?id=38977#txn-506384">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;09&nbsp;03:52:44&nbsp;2008</span>
    <span class="description">bohica [...] ntlworld.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-506386" href="/Public/Bug/Display.html?id=38977#txn-506386">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;09&nbsp;03:52:45&nbsp;2008</span>
    <span class="description">bohica [...] ntlworld.com -  Severity Normal added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-506387" href="/Public/Bug/Display.html?id=38977#txn-506387">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;09&nbsp;03:52:45&nbsp;2008</span>
    <span class="description">bohica [...] ntlworld.com -  Fixed in 1.16_3 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.858149</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
