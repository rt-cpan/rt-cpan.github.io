<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #52538 for Moose: Memory leak &#40;cycle&#41; Moose::Meta::Method::Accessor and Moose::Meta::Method::Constructor through $meta from environment</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #52538 for Moose: Memory leak &#40;cycle&#41; Moose::Meta::Method::Accessor and Moose::Meta::Method::Constructor through $meta from environment</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Moose/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Moose/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Moose/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Moose/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Moose">Moose CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">52538</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Moose/Active/">Moose</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
harv [...] ruin.nu

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-38786-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.93    </td>
  </tr>
  <tr id="CF-38787-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;07&nbsp;15:01:25&nbsp;2009</span>
    <span class="description">harv [...] ruin.nu -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Memory leak &#40;cycle&#41; Moose::Meta::Method::Accessor and
 Moose::Meta::Method::Constructor through $meta from environment</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Both have &#39;$meta&#39; set to \$self in their environments for 
_compile_code, which then seems to add this variable to the closure of 
generated code, resulting in a cycle. This is done in:

Moose::Meta::Method::Constructor::__initialize_body&#40;&#41;
Moose::Meta::Method::Accessor::_eval_code&#40;&#41;

Not sure how to weaken those references though.

Cycle &#40;1&#41;:
        $Class::MOP::Class::Immutable::Moose::Meta::Class::A-&gt;
{&#39;__immutable&#39;} =&gt; \%B                           
               $B-&gt;{&#39;inlined_methods&#39;} =&gt; \@C                           
                               $C-&gt;[0] =&gt; \
%Moose::Meta::Method::Constructor::D
        $Moose::Meta::Method::Constructor::D-&gt;{&#39;body&#39;} =&gt; 
\&#38;E                           
                     $E variable $meta =&gt; \$F                           
                                   $$F =&gt; \
%Moose::Meta::Method::Constructor::D

-----------------------------------------------------------

Cycle &#40;1&#41;:
        $Class::MOP::Class::Immutable::Moose::Meta::Class::A-&gt;
{&#39;__immutable&#39;} =&gt; \%B                           
               $B-&gt;{&#39;inlined_methods&#39;} =&gt; \@C                           
                               $C-&gt;[0] =&gt; \
%Moose::Meta::Method::Constructor::D
        $Moose::Meta::Method::Constructor::D-&gt;{&#39;attributes&#39;} =&gt; 
\@E                           
                               $E-&gt;[0] =&gt; \%Moose::Meta::Attribute::F   
        $Moose::Meta::Attribute::F-&gt;{&#39;associated_methods&#39;} =&gt; 
\@G                           
                               $G-&gt;[0] =&gt; \
%Moose::Meta::Method::Accessor::H
        $Moose::Meta::Method::Accessor::H-&gt;{&#39;body&#39;} =&gt; 
\&#38;I                           
                     $I variable $meta =&gt; \$J                           
                                   $$J =&gt; \
%Moose::Meta::Method::Accessor::H
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;07&nbsp;15:07:22&nbsp;2009</span>
    <span class="description">stevan.little [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #52538] Memory leak &#40;cycle&#41; Moose::Meta::Method::Accessor and Moose::Meta::Method::Constructor through $meta from environment </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 7 Dec 2009 15:05:15 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Moose [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Stevan Little &lt;stevan.little [...] iinteractive.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Michael,

As mentioned in the other bug reports, a cycle does not mean a leak.  
Can you perhaps explain what it is your doing and why this is  
presenting an issue for you?

Are you on IRC? It would be ideal to take the conversation into real- 
time. Please join us in #moose-dev on irc.perl.org.

- Stevan


On Dec 7, 2009, at 3:01 PM, Michael Andreen via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Mon Dec 07 15:01:25 2009: Request 52538 was acted upon.
&gt; Transaction: Ticket created by harv
&gt;       Queue: Moose
&gt;     Subject: Memory leak &#40;cycle&#41; Moose::Meta::Method::Accessor and
&gt; Moose::Meta::Method::Constructor through $meta from environment
&gt;   Broken in: 0.93
&gt;    Severity: Normal
&gt;       Owner: Nobody
&gt;  Requestors: harv@ruin.nu
&gt;      Status: new
&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=52538">https://rt.cpan.org/Ticket/Display.html?id=52538</a></span> &gt;
&gt;
&gt;
&gt; Both have &#39;$meta&#39; set to \$self in their environments for
&gt; _compile_code, which then seems to add this variable to the closure of
&gt; generated code, resulting in a cycle. This is done in:
&gt;
&gt; Moose::Meta::Method::Constructor::__initialize_body&#40;&#41;
&gt; Moose::Meta::Method::Accessor::_eval_code&#40;&#41;
&gt;
&gt; Not sure how to weaken those references though.
&gt;
&gt; Cycle &#40;1&#41;:
&gt;        $Class::MOP::Class::Immutable::Moose::Meta::Class::A-&gt;
&gt; {&#39;__immutable&#39;} =&gt; \%B
&gt;               $B-&gt;{&#39;inlined_methods&#39;} =&gt; \@C
&gt;                               $C-&gt;[0] =&gt; \
&gt; %Moose::Meta::Method::Constructor::D
&gt;        $Moose::Meta::Method::Constructor::D-&gt;{&#39;body&#39;} =&gt;
&gt; \&#38;E
&gt;                     $E variable $meta =&gt; \$F
&gt;                                   $$F =&gt; \
&gt; %Moose::Meta::Method::Constructor::D
&gt;
&gt; -----------------------------------------------------------
&gt;
&gt; Cycle &#40;1&#41;:
&gt;        $Class::MOP::Class::Immutable::Moose::Meta::Class::A-&gt;
&gt; {&#39;__immutable&#39;} =&gt; \%B
&gt;               $B-&gt;{&#39;inlined_methods&#39;} =&gt; \@C
&gt;                               $C-&gt;[0] =&gt; \
&gt; %Moose::Meta::Method::Constructor::D
&gt;        $Moose::Meta::Method::Constructor::D-&gt;{&#39;attributes&#39;} =&gt;
&gt; \@E
&gt;                               $E-&gt;[0] =&gt; \%Moose::Meta::Attribute::F
&gt;        $Moose::Meta::Attribute::F-&gt;{&#39;associated_methods&#39;} =&gt;
&gt; \@G
&gt;                               $G-&gt;[0] =&gt; \
&gt; %Moose::Meta::Method::Accessor::H
&gt;        $Moose::Meta::Method::Accessor::H-&gt;{&#39;body&#39;} =&gt;
&gt; \&#38;I
&gt;                     $I variable $meta =&gt; \$J
&gt;                                   $$J =&gt; \
&gt; %Moose::Meta::Method::Accessor::H
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;07&nbsp;15:07:22&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;04&nbsp;19:19:35&nbsp;2010</span>
    <span class="description">hdp [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">RT isn&#39;t the right place for this discussion.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;04&nbsp;19:19:38&nbsp;2010</span>
    <span class="description">hdp [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
