<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #114438 for HTTP-ProxyAutoConfig: Should not do isResolvable check when non-auto proxy variables are explicitly defined</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #114438 for HTTP-ProxyAutoConfig: Should not do isResolvable check when non-auto proxy variables are explicitly defined</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/HTTP-ProxyAutoConfig/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/HTTP-ProxyAutoConfig/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/HTTP-ProxyAutoConfig/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/HTTP-ProxyAutoConfig/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/HTTP-ProxyAutoConfig">HTTP-ProxyAutoConfig CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">114438</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/HTTP-ProxyAutoConfig/Active/">HTTP-ProxyAutoConfig</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
chewi [...] aura-online.co.uk

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-16374-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.3    </td>
  </tr>
  <tr id="CF-16375-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;17&nbsp;07:10:22&nbsp;2016</span>
    <span class="description">chewi [...] aura-online.co.uk -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Should not do isResolvable check when non-auto proxy variables
 are explicitly defined</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello. I&#39;m not a Perl guy, I just want to use sendxmpp from behind a HTTP proxy. The XML::Stream library uses HTTP::ProxyAutoConfig if it is installed, whether you like it or not. It generally is installed because Fedora 23 and CentOS 7 pull it in as a dependency.

My environment does have working DNS but HTTP&#40;S&#41; still has to go via a proxy. The problem is that HTTP::ProxyAutoConfig naively assumes that just because the host is resolvable, a proxy isn&#39;t required. I gather from Wikipedia that this is how the mechanism has traditionally worked and I don&#39;t wish to argue about that but I think this check should only kick in when http_auto_proxy is defined. If http&#40;s&#41;_proxy or ftp_proxy are defined instead then it should always use the proxy unconditionally. This is consistent with other clients such as curl.

Please see that patch.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> ProxyAutoConfig.pm.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- ProxyAutoConfig.pm.orig	2016-05-17 10:37:59.736887744 +0100
+++ ProxyAutoConfig.pm	2016-05-17 11:39:59.698789897 +0100
@@ -222,7 +222,6 @@
     my $http_host;
     my $http_port;
     my $function = &#34;sub FindProxyForURL { my &#40;\$self,\$url,\$host&#41; = \@_; &#34;;
-    $function .= &#34;if &#40;isResolvable&#40;\$host&#41;&#41; { return \&#34;DIRECT\&#34;; }  &#34;;
     if &#40;exists&#40;$ENV{http_proxy}&#41;&#41; {
       &#40;$http_host,$http_port&#41; = &#40;$ENV{&#34;http_proxy&#34;} =~ /^&#40;\S+&#41;\:&#40;\d+&#41;$/&#41;;
       $http_host =~ s/^http\:\/\///;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;17&nbsp;14:27:51&nbsp;2016</span>
    <span class="description">craigm014 [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> reatmon [...] mail.com</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #114438] Should not do isResolvable check when non-auto proxy variables  are explicitly defined</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 17 May 2016 14:27:34 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-HTTP-ProxyAutoConfig [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Craig MacKenna &lt;craigm014 [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello chewi,

It has been 6 years since I have had anything to do with perl, proxies, and such.  I made certain modifications and enhancement to HTTP::ProxyAutoConfig because 1&#41; like you, I found that it did some things that I didnâ€™t like, and 2&#41; I wanted it to do some additional things.  I made no changes to the code you are talking about.  I hope that you also sent the following message to Ryan Eatmon &#40;the original author of this module&#41; and that he responds more helpfully than I.

But I feel that the change you describe should not be made by simply deleting the one line in your patch.  Instead it needs to be something like 

if &#40;&lt; logic based on $ENV{http_proxy}, $ENV{https_proxy}, 
      $ENV{ftp_proxy}, and/or $ENV{http_auto_proxy} &gt;&#41; {
  $function.=&#34;if&#40;isResolvable&#40;\$host&#41;&#41; {return \&#34;DIRECT\&#34;}&#34;;
}

If no one else is able to help you, one way to deal with a situation like this is for you to take over the maintenance of the module.  Then you can change the functionality as you feel is proper, and deal with any objections to such change&#40;s&#41;.  If you want to pursue this course, I will try to help accomplish it.

Best Regards,
Craig MacKenna

P.S. It is unfortunate that the Netscape documentation at 
<span class="clickylink"><a target="new" rel="nofollow" href="http://home.netscape.com/eng/mozilla/2.0/relnotes/demo/proxy-live.html">http://home.netscape.com/eng/mozilla/2.0/relnotes/demo/proxy-live.html</a></span> &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://home.netscape.com/eng/mozilla/2.0/relnotes/demo/proxy-live.html">http://home.netscape.com/eng/mozilla/2.0/relnotes/demo/proxy-live.html</a></span>&gt;
is no longer available at that URL.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On May 17, 2016, at 7:10 AM, chewi@aura-online.co.uk via RT &lt;bug-HTTP-ProxyAutoConfig@rt.cpan.org&gt; wrote:
&gt; 
&gt; Tue May 17 07:10:22 2016: Request 114438 was acted upon.
&gt; Transaction: Ticket created by chewi@aura-online.co.uk
&gt;       Queue: HTTP-ProxyAutoConfig
&gt;     Subject: Should not do isResolvable check when non-auto proxy variables
&gt; are explicitly defined
&gt;   Broken in: 0.3
&gt;    Severity: Normal
&gt;       Owner: Nobody
&gt;  Requestors: chewi@aura-online.co.uk
&gt;      Status: new
&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=114438">https://rt.cpan.org/Ticket/Display.html?id=114438</a></span> &gt;
&gt; 
&gt; 
&gt; Hello. I&#39;m not a Perl guy, I just want to use sendxmpp from behind a HTTP proxy. The XML::Stream library uses HTTP::ProxyAutoConfig if it is installed, whether you like it or not. It generally is installed because Fedora 23 and CentOS 7 pull it in as a dependency.
&gt; 
&gt; My environment does have working DNS but HTTP&#40;S&#41; still has to go via a proxy. The problem is that HTTP::ProxyAutoConfig naively assumes that just because the host is resolvable, a proxy isn&#39;t required. I gather from Wikipedia that this is how the mechanism has traditionally worked and I don&#39;t wish to argue about that but I think this check should only kick in when http_auto_proxy is defined. If http&#40;s&#41;_proxy or ftp_proxy are defined instead then it should always use the proxy unconditionally. This is consistent with other clients such as curl.
&gt; 
&gt; Please see that patch.
&gt; --- ProxyAutoConfig.pm.orig   2016-05-17 10:37:59.736887744 +0100
&gt; +++ ProxyAutoConfig.pm        2016-05-17 11:39:59.698789897 +0100
&gt; @@ -222,7 +222,6 @@
&gt;     my $http_host;
&gt;     my $http_port;
&gt;     my $function = &#34;sub FindProxyForURL { my &#40;\$self,\$url,\$host&#41; = \@_; &#34;;
&gt; -    $function .= &#34;if &#40;isResolvable&#40;\$host&#41;&#41; { return \&#34;DIRECT\&#34;; }  &#34;;
&gt;     if &#40;exists&#40;$ENV{http_proxy}&#41;&#41; {
&gt;       &#40;$http_host,$http_port&#41; = &#40;$ENV{&#34;http_proxy&#34;} =~ /^&#40;\S+&#41;\:&#40;\d+&#41;$/&#41;;
&gt;       $http_host =~ s/^http\:\/\///;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;17&nbsp;14:27:52&nbsp;2016</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;17&nbsp;15:55:39&nbsp;2016</span>
    <span class="description">chewi [...] aura-online.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> chewi [...] aura-online.co.uk</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Craig,

On Tue May 17 14:27:51 2016, craigm014@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I hope
&gt; that you also sent the following message to Ryan Eatmon &#40;the original
&gt; author of this module&#41; and that he responds more helpfully than I.
</div>
He is shown as a maintainer under RT so I believe he would have got the message too.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; But I feel that the change you describe should not be made by simply
&gt; deleting the one line in your patch.  Instead it needs to be something
&gt; like
&gt; 
&gt; if &#40;&lt; logic based on $ENV{http_proxy}, $ENV{https_proxy},
&gt;      $ENV{ftp_proxy}, and/or $ENV{http_auto_proxy} &gt;&#41; {
&gt;  $function.=&#34;if&#40;isResolvable&#40;\$host&#41;&#41; {return \&#34;DIRECT\&#34;}&#34;;
&gt; }
</div>
I&#39;m not sure what you think the logic should be but the line I removed is only encountered when http_auto_proxy is unset. If none of the variables are set then it&#39;ll just return DIRECT anyway.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If no one else is able to help you, one way to deal with a situation
&gt; like this is for you to take over the maintenance of the module.
</div>
Heh, I have my fingers in many open source pies but given that I have sometimes said my unofficial job title is &#34;destroyer of the Perl&#34;, I think pigs will fly before I take on a Perl module. ;&#41; I&#39;ve managed to work around it in a somewhat ugly way by setting RES_OPTIONS=attempts:0, which effectively disables glibc&#39;s DNS resolution. I filed the bug anyway because I don&#39;t like to rely on such hacks forever and I&#39;d hate to see someone else get stumped over this like I did.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If you want to pursue this course,
&gt; I will try to help accomplish it.
</div>
Many thanks all the same. Your message is appreciated as I honestly wasn&#39;t expecting one at all.

Regards,
James
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
