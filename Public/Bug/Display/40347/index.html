<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #40347 for Mail-Box: threadStart&#40;&#41; chokes on dummy messages in thread</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #40347 for Mail-Box: threadStart&#40;&#41; chokes on dummy messages in thread</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Mail-Box/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Mail-Box/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Mail-Box/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Mail-Box/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Mail-Box">Mail-Box CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">40347</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Mail-Box/Active/">Mail-Box</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
fschlich [...] cis.fu-berlin.de

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-19874-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.090    </td>
  </tr>
  <tr id="CF-19875-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




archiver.mbox<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/523885/261950/archiver.mbox">
Fri Oct 24 10:15:17 2008 (569b) by fschlich [...] cis.fu-berlin.de
</a>
</font></li>
</ul>


archiver.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/523885/261953/archiver.pl">
Fri Oct 24 10:15:17 2008 (1.5k) by fschlich [...] cis.fu-berlin.de
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;24&nbsp;10:15:16&nbsp;2008</span>
    <span class="description">fschlich [...] cis.fu-berlin.de -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> threadStart&#40;&#41; chokes on dummy messages in thread</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I can&#39;t rule out this is just because I&#39;m using threadStart&#40;&#41; in a wrong
way, but then my code works flawlessly on all but 2-3 out of 50.000
messages. From my glances at the module code, I&#39;d say it should never
call $thread-&gt;message-&gt;timestamp on a Mail::Message::Dummy, but that&#39;s
exactly what seems to happen:


[15:47] newsadm@Trinidad:~/tmp/fschlich/mail__box/archivertest$
../archiver.pl archiver.mbox 
DEBUG: 9e5625740808020105t7c05a7fm3ecff68b303fd392@mail.gmail.com
ERROR: You cannot take the head of a dummy message
Can&#39;t call method &#34;recvstamp&#34; on an undefined value at
        /usr/share/perl5/Mail/Message.pm line 259, &lt;GEN3&gt; line 18 &#40;#1&#41;
    &#40;F&#41; You used the syntax of a method call, but the slot filled by the
    object reference or package name contains an undefined value.  Something
    like this will reproduce the error:
    
        $BADREF = undef;
        process $BADREF 1,2,3;
        $BADREF-&gt;process&#40;1,2,3&#41;;
    
Uncaught exception from user code:
        Can&#39;t call method &#34;recvstamp&#34; on an undefined value at
/usr/share/perl5/Mail/Message.pm line 259, &lt;GEN3&gt; line 18.
        Mail::Message::timestamp&#40;&#39;Mail::Message::Dummy=HASH&#40;0x8837878&#41;&#39;&#41;
called at /usr/share/perl5/Mail/Box/Thread/Manager.pm line 147
       
Mail::Box::Thread::Manager::threadStart&#40;&#39;Mail::Box::Thread::Manager=HASH&#40;0x87f5a88&#41;&#39;,
&#39;Mail::Box::Mbox::Message=HASH&#40;0x87f31f4&#41;&#39;&#41; called at ../archiver.pl line 30


Please find my code &#40;archiver.pl&#41; and an mbox with a stripped-down
version of an offending message
&#40;archiver.mbox&#41; attached.

Florian
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> archiver.mbox</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/523885/261950/archiver.mbox">Download archiver.mbox</a><br />
<span class="downloadcontenttype">application/octet-stream 569b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> archiver.pl</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl -w

use Mail::Box::Manager;

use strict;
use diagnostics;

# archiver.pl
# walks over new messages, and if a tag can be identified, archive the whole thread

$|=1;

my $seen_file = &#39;seen.mbox&#39;;
my $new_file = $ARGV[0];
&#40;-s $new_file&#41; || die &#34;can&#39;t find $new_file -- is it an mbox?\n&#34;;


my $mgr = Mail::Box::Manager-&gt;new;
my $seen_folder = $mgr-&gt;open&#40;folder =&gt; $seen_file, access =&gt; &#39;rw&#39;, create =&gt; 1&#41; or die &#34;cannot open folder $seen_file: $!\n&#34;;
my $new_folder = $mgr-&gt;open&#40;folder =&gt; $new_file, access =&gt; &#39;rw&#39;&#41; or die &#34;cannot open folder $new_file: $!\n&#34;;
my $threads = $mgr-&gt;threads&#40;folders =&gt; [$seen_folder,$new_folder]&#41;;


# examine new mail in turn
foreach my $newmsg &#40;$new_folder-&gt;messages&#41; {
    next if $newmsg-&gt;isDeleted or $newmsg-&gt;isDummy;
    
    print &#34;DEBUG: &#34;, $newmsg-&gt;messageId, &#34;\n&#34;;

    # find the start of the thread this new message is in
    my $threadstart = $threads-&gt;threadStart&#40;$newmsg&#41;;
    
    print &#34;DEBUG: ...not reached...\n&#34;;

    # take alle messages in thread
    my @thread = $threadstart-&gt;threadMessages;
    my %tags = &#40;&#41;;
    
    # examine thread starting from last message
    while &#40;my $msg = pop @thread&#41; {
        my $subject = $msg-&gt;head-&gt;study&#40;&#39;subject&#39;&#41;;
        if &#40;$subject&#41; { # spam might not have a subject...
            $subject = $subject-&gt;decodedBody&#40;&#41;; # ?iso-88..? in subject...
            while &#40;$subject =~ /\[&#40;\d+&#41;\]/g&#41; {
                $tags{$1} = 1;
            }
            #...
        }
        
        # test BODY
        # ...
        
        # stop if we&#39;ve found a tag
        last if &#40;scalar keys %tags&#41;;
    }
    
    # save result
    
}

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;07&nbsp;07:53:28&nbsp;2008</span>
    <span class="description">solutions [...] overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #40347] threadStart&#40;&#41; chokes on dummy messages in thread</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 7 Nov 2008 13:53:13 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Florian via RT &lt;bug-Mail-Box [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;solutions [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
Sorry for the delay in the responses, but my program was far too
full with obligatory activities in the previous two weeks :&#40;

* Florian via RT &#40;bug-Mail-Box@rt.cpan.org&#41; [081024 15:15]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Fri Oct 24 10:15:16 2008: Request 40347 was acted upon.
&gt; Transaction: Ticket created by fsfs
&gt;        Queue: Mail-Box
&gt;      Subject: threadStart&#40;&#41; chokes on dummy messages in thread
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;         Can&#39;t call method &#34;recvstamp&#34; on an undefined value at
&gt; /usr/share/perl5/Mail/Message.pm line 259, &lt;GEN3&gt; line 18.
&gt;         Mail::Message::timestamp&#40;&#39;Mail::Message::Dummy=HASH&#40;0x8837878&#41;&#39;&#41;
&gt; called at /usr/share/perl5/Mail/Box/Thread/Manager.pm line 147
</div>
Quite a serious bug.  Don&#39;t know why my regression tests did not
catch it.  Anyway: Mail/Box/Thread/Manager.pm

        foreach &#40;$self-&gt;folders&#41;
 -      {   last unless $_-&gt;scanForMessages
 +      {   my $message  = $thread-&gt;message;
 +          my $timespan = $message-&gt;isDummy ? &#39;ALL&#39;
 +            : $message-&gt;timestamp - $self-&gt;{MBTM_timespan};
 +
 +          last unless $_-&gt;scanForMessages
              &#40; $thread-&gt;messageId
              , $parent-&gt;messageId
 -            , $thread-&gt;message-&gt;timestamp - $self-&gt;{MBTM_timespan}
 +            , $timespan
              , $self-&gt;{MBTM_window}
              &#41;;
        }

-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;07&nbsp;07:53:29&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;14&nbsp;11:58:43&nbsp;2008</span>
    <span class="description">fschlich [...] cis.fu-berlin.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #40347] threadStart&#40;&#41; chokes on dummy messages in thread</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 14 Nov 2008 17:58:27 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Mark Overmeer via RT &lt;bug-Mail-Box [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Florian Schlichting &lt;fschlich [...] CIS.FU-Berlin.DE&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Sorry for the delay in the responses, but my program was far too
&gt; full with obligatory activities in the previous two weeks :&#40;
</div>
no need to apologize, I know what you mean

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt;         Can&#39;t call method &#34;recvstamp&#34; on an undefined value at
&gt; &gt; /usr/share/perl5/Mail/Message.pm line 259, &lt;GEN3&gt; line 18.
&gt; &gt;         Mail::Message::timestamp&#40;&#39;Mail::Message::Dummy=HASH&#40;0x8837878&#41;&#39;&#41;
&gt; &gt; called at /usr/share/perl5/Mail/Box/Thread/Manager.pm line 147
</div>&gt; 
&gt; Quite a serious bug.  Don&#39;t know why my regression tests did not
&gt; catch it.  Anyway: Mail/Box/Thread/Manager.pm
&gt; 
&gt;         foreach &#40;$self-&gt;folders&#41;
&gt;  -      {   last unless $_-&gt;scanForMessages
&gt;  +      {   my $message  = $thread-&gt;message;
&gt;  +          my $timespan = $message-&gt;isDummy ? &#39;ALL&#39;
&gt;  +            : $message-&gt;timestamp - $self-&gt;{MBTM_timespan};
&gt;  +
&gt;  +          last unless $_-&gt;scanForMessages
&gt;               &#40; $thread-&gt;messageId
&gt;               , $parent-&gt;messageId
&gt;  -            , $thread-&gt;message-&gt;timestamp - $self-&gt;{MBTM_timespan}
&gt;  +            , $timespan
&gt;               , $self-&gt;{MBTM_window}
&gt;               &#41;;
&gt;         }
</div>
hmm, this seems to work at first sight, but throwing more stuff at it
I&#39;m getting more error messages and I&#39;m unable for the moment to isolate
a single message that would trigger the error:


an&#39;t call method &#34;get&#34; on an undefined value at
        /server/newsadm/tmp/fschlich/mail__box/perl/share/perl/5.8.4//Mail/Box/Thread/Manager.pm line 308, &lt;GEN4&gt; line 45708 &#40;#1&#41;
    &#40;F&#41; You used the syntax of a method call, but the slot filled by the
    object reference or package name contains an undefined value.  Something
    like this will reproduce the error:
    
        $BADREF = undef;
        process $BADREF 1,2,3;
        $BADREF-&gt;process&#40;1,2,3&#41;;
    
Uncaught exception from user code:
        Can&#39;t call method &#34;get&#34; on an undefined value at /server/newsadm/tmp/fschlich/mail__box/perl/share/perl/5.8.4//Mail/Box/Thread/Manager.pm line 308, &lt;GEN4&gt; line 45708.
 at /server/newsadm/tmp/fschlich/mail__box/perl/share/perl/5.8.4//Mail/Box/Thread/Manager.pm line 308
        Mail::Box::Thread::Manager::_process_delayed_message&#40;&#39;Mail::Box::Thread::Manager=HASH&#40;0x8c1c964&#41;&#39;, &#39;Mail::Box::Thread::Node=HASH&#40;0x95324d4&#41;&#39;, &#39;Mail::Box::Mbox::Message=HASH&#40;0x96f5924&#41;&#39;&#41; called at /server/newsadm/tmp/fschlich/mail__box/perl/share/perl/5.8.4//Mail/Box/Thread/Manager.pm line 294
        Mail::Box::Thread::Manager::_process_delayed_nodes&#40;&#39;Mail::Box::Thread::Manager=HASH&#40;0x8c1c964&#41;&#39;&#41; called at /server/newsadm/tmp/fschlich/mail__box/perl/share/perl/5.8.4//Mail/Box/Thread/Manager.pm line 98
        Mail::Box::Thread::Manager::thread&#40;&#39;Mail::Box::Thread::Manager=HASH&#40;0x8c1c964&#41;&#39;, &#39;Mail::Box::Mbox::Message=HASH&#40;0x8c87334&#41;&#39;&#41; called at /server/newsadm/tmp/fschlich/mail__box/perl/share/perl/5.8.4//Mail/Box/Thread/Manager.pm line 137
        Mail::Box::Thread::Manager::threadStart&#40;&#39;Mail::Box::Thread::Manager=HASH&#40;0x8c1c964&#41;&#39;, &#39;Mail::Box::Mbox::Message=HASH&#40;0x8c87334&#41;&#39;&#41; called at ./archiver-patch.pl line 34


perhaps you&#39;ll have an idea, otherwise I can do more testing when I&#39;m back

Florian
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;11&nbsp;06:50:16&nbsp;2008</span>
    <span class="description">MARKOV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Probably resolved
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;11&nbsp;06:50:18&nbsp;2008</span>
    <span class="description">MARKOV [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;18&nbsp;08:10:22&nbsp;2008</span>
    <span class="description">fschlich [...] cis.fu-berlin.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #40347] threadStart&#40;&#41; chokes on dummy messages in thread</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 18 Dec 2008 14:10:01 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Mark Overmeer via RT &lt;bug-Mail-Box [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Florian Schlichting &lt;fschlich [...] CIS.FU-Berlin.DE&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, Dec 11, 2008 at 06:50:18AM -0500, Mark Overmeer via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=40347">http://rt.cpan.org/Ticket/Display.html?id=40347</a></span> &gt;
&gt; 
&gt; Probably resolved
</div>
I was trying to verify that this is indeed the case, but I&#39;m completely
baffled at what might be an entirely different problem. Using
Mail-Box-2.086 and Files attached to this bug a month ago:


[14:07] newsadm@Trinidad:~/tmp/fschlich/mail__box/archivertest/Dezember$ ./archiver.pl archiver.mbox 
DEBUG: 9e5625740808020105t7c05a7fm3ecff68b303fd392@mail.gmail.com
DEBUG: ...not reached...
[14:07] newsadm@Trinidad:~/tmp/fschlich/mail__box/archivertest/Dezember$ cd ..
[14:07] newsadm@Trinidad:~/tmp/fschlich/mail__box/archivertest$ Dezember/archiver.pl Dezember/archiver.mbox 
DEBUG: 9e5625740808020105t7c05a7fm3ecff68b303fd392@mail.gmail.com
Can&#39;t call method &#34;timestamp&#34; on an undefined value at
        /server/newsadm/tmp/fschlich/mail__box/perl/share/perl/5.8.8/Mail/Box.pm line 612, &lt;GEN3&gt; line 18 &#40;#1&#41;
    &#40;F&#41; You used the syntax of a method call, but the slot filled by the
    object reference or package name contains an undefined value.  Something
    like this will reproduce the error:
    
        $BADREF = undef;
        process $BADREF 1,2,3;
        $BADREF-&gt;process&#40;1,2,3&#41;;
    
Uncaught exception from user code:
        Can&#39;t call method &#34;timestamp&#34; on an undefined value at /server/newsadm/tmp/fschlich/mail__box/perl/share/perl/5.8.8/Mail/Box.pm line 612, &lt;GEN3&gt; line 18.
 at /server/newsadm/tmp/fschlich/mail__box/perl/share/perl/5.8.8/Mail/Box.pm line 612
        Mail::Box::scanForMessages&#40;&#39;Mail::Box::Mbox=HASH&#40;0x883a308&#41;&#39;, &#39;Pine.SGI.4.61.0808012054590.87611576@Waran.CIS.FU-Berlin.DE&#39;, &#39;9e5625740807311424o6916c69t6a6be62224182fe0@mail.gmail.com&#39;, &#39;ALL&#39;, 10&#41; called at /server/newsadm/tmp/fschlich/mail__box/perl/share/perl/5.8.8/Mail/Box/Thread/Manager.pm line 151
        Mail::Box::Thread::Manager::threadStart&#40;&#39;Mail::Box::Thread::Manager=HASH&#40;0x84b9794&#41;&#39;, &#39;Mail::Box::Mbox::Message=HASH&#40;0x88b0e84&#41;&#39;&#41; called at Dezember/archiver.pl line 33


HOW CAN THAT POSSIBLY HAPPEN?!

I didn&#39;t &#34;make&#34; with a relative prefix, and where else could relative
paths matter? It seems the error persists when going higher up in the
directory tree, but when trying the same further down, it works
nicely...

what am I missing?
Florian
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;18&nbsp;08:10:22&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;30&nbsp;14:16:52&nbsp;2008</span>
    <span class="description">Mark [...] Overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #40347] threadStart&#40;&#41; chokes on dummy messages in thread</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 30 Dec 2008 20:16:39 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Florian via RT &lt;bug-Mail-Box [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;mark [...] overmeer.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Florian via RT &#40;bug-Mail-Box@rt.cpan.org&#41; [081218 13:10]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Mail-Box
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=40347">http://rt.cpan.org/Ticket/Display.html?id=40347</a></span> &gt;
&gt; 
&gt; On Thu, Dec 11, 2008 at 06:50:18AM -0500, Mark Overmeer via RT wrote:
<div class="message-stanza open">&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=40347">http://rt.cpan.org/Ticket/Display.html?id=40347</a></span> &gt;
&gt; &gt; 
&gt; &gt; Probably resolved
</div>&gt; 
&gt; I was trying to verify that this is indeed the case, but I&#39;m completely
&gt; baffled at what might be an entirely different problem. Using
&gt; Mail-Box-2.086 and Files attached to this bug a month ago:
&gt; 
&gt; Can&#39;t call method &#34;timestamp&#34; on an undefined value at
&gt;         /server/newsadm/tmp/fschlich/mail__box/perl/share/perl/5.8.8/Mail/Box.pm line 612, &lt;GEN3&gt; line 18 &#40;#1&#41;
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; what am I missing?
</div>
That part of Mail::Box was probably never used for serious things.
Add
              : !$startmsg          ? 0
before line 612....
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;03&nbsp;06:46:27&nbsp;2009</span>
    <span class="description">MARKOV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">fixed in 2.085
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;03&nbsp;06:46:29&nbsp;2009</span>
    <span class="description">MARKOV [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;08&nbsp;03:59:26&nbsp;2009</span>
    <span class="description">fschlich [...] cis.fu-berlin.de -  Broken in 2.090 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;08&nbsp;03:59:26&nbsp;2009</span>
    <span class="description">fschlich [...] cis.fu-berlin.de -  Broken in 2.084 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;08&nbsp;03:59:26&nbsp;2009</span>
    <span class="description">fschlich [...] cis.fu-berlin.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">another addendum:

your suggested amendment to Mail/Box.pm:

: !$startmsg          ? 0

does indeed fix my problem. It never made it into Mail::Box, though &#40;as
per 2.090&#41;. Could you please add it? I think it&#39;s around line 592 now.

Thanks!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;08&nbsp;03:59:27&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;08&nbsp;05:14:48&nbsp;2009</span>
    <span class="description">MARKOV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I tend to wait for response whether the suggested fixes work.

included for 2.91
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;08&nbsp;05:14:51&nbsp;2009</span>
    <span class="description">MARKOV [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
