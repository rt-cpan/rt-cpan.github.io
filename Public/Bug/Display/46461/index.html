<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #46461 for DateTime: DateTime issues at DST crossovers</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #46461 for DateTime: DateTime issues at DST crossovers</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/DateTime/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/DateTime/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/DateTime/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/DateTime/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/houseabsolute/DateTime.pm/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/DateTime">DateTime CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">46461</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/DateTime/Active/">DateTime</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
nygel [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-9734-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-9735-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;29&nbsp;07:12:06&nbsp;2009</span>
    <span class="description">nygel [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> DateTime issues at DST crossovers</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Have added a script outlining an example.

2009-03-29 01:00 - 02:00 is the transition period to DST for Europe/London.

Case 1 outlines subtracting hours where the result would lie in the
above &#39;non-existent&#39; time range, this is handled fine, DateTime rolls
the time from 01:30 to 00:30.

Case 2 subtracts a month, where the result would lie in the above range,
DateTime throws an error. D=

Case 3 specifies a date in the invalid range, again DateTime throws an
error.

I understand why this happens, it&#39;s outlined in the DateTime docs :
<span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~drolsky/DateTime-0.50/lib/DateTime.pm#Local_vs._UTC_and_24_hours_vs._1_day">http://search.cpan.org/~drolsky/DateTime-0.50/lib/DateTime.pm#Local_vs._UTC_and_24_hours_vs._1_day</a></span>

But we only discovered this on subsequent investigation after our server
started throwing 500 errors.  I guess you could argue I should have read
the docs thoroughly and spotted this but the DateTime docs are rather large!

I think the view currently taken by the maintainer on this, that the
date range doesn&#39;t actually exist so DateTime should throw an error, is
perfectly valid and arguably correct.  But the problem with this
solution is that the user then has to be aware of this issue, and then
write code specifically to catch this.

As a suggestion, it might be useful to add a user settable flag to
DateTime which would cause DateTime to handle these dates safely and
return a value rather than erroring.  Therefore allowing DateTime two
types of behaviour &#40;safe/unsafe&#41;.  Possibly expand these behaviour types
out so the date returned over the transition period is calculated is
various ways which again can be user-specified &#40;round off etc..&#41;
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> timebug.pl</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl
use strict;
use DateTime;

print &#34;VERSION : &#34;.$DateTime::VERSION.&#34;\n&#34;;

my $dt;

print &#34;=case 1=========================\n&#34;;
$dt = DateTime-&gt;new&#40;
    year    =&gt; 2009,
    month   =&gt; 3,
    day     =&gt; 29,
    hour    =&gt; 2,
    minute  =&gt; 30,
    time_zone =&gt; &#39;Europe/London&#39;
&#41;;

print &#34;DT : $dt\n&#34;;
eval { $dt-&gt;subtract&#40; hours =&gt; 1 &#41;; };
if&#40;$@&#41; { print &#34;ERROR\n&#34;; } else { print &#34;DT-1h : $dt\n&#34;; }

print &#34;=case 2=========================\n&#34;;
$dt = DateTime-&gt;new&#40;
    year    =&gt; 2009,
    month   =&gt; 5,
    day     =&gt; 29,
    hour    =&gt; 1,
    minute  =&gt; 30,
    time_zone =&gt; &#39;Europe/London&#39;
&#41;;

print &#34;DT : $dt\n&#34;;
$dt-&gt;subtract&#40; months =&gt; 1 &#41;;
print &#34;DT-1month : $dt\n&#34;;
eval { $dt-&gt;subtract&#40; hours =&gt; 744&#41;; };
if&#40;$@&#41; { print &#34;ERROR\n&#34;; } else { print &#34;DT-2months : $dt\n&#34;; }

print &#34;=case 3=========================\n&#34;;

eval {
    $dt = DateTime-&gt;new&#40;
        year    =&gt; 2009,
        month   =&gt; 3,
        day     =&gt; 29,
        hour    =&gt; 1,
        minute  =&gt; 30,
        time_zone =&gt; &#39;Europe/London&#39;
    &#41;;
};

if&#40;$@&#41; { print &#34;ERROR\n&#34;; } else { print &#34;DT : $dt\n&#34;; }  </div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;05&nbsp;15:05:59&nbsp;2009</span>
    <span class="description">DROLSKY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri May 29 07:12:06 2009, NYGEL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Have added a script outlining an example.
&gt; 
&gt; 2009-03-29 01:00 - 02:00 is the transition period to DST for
&gt; Europe/London.
&gt; 
&gt; Case 1 outlines subtracting hours where the result would lie in the
&gt; above &#39;non-existent&#39; time range, this is handled fine, DateTime rolls
&gt; the time from 01:30 to 00:30.
&gt; 
&gt; Case 2 subtracts a month, where the result would lie in the above
&gt; range,
&gt; DateTime throws an error. D=
&gt; 
&gt; Case 3 specifies a date in the invalid range, again DateTime throws an
&gt; error.
&gt; 
&gt; I understand why this happens, it&#39;s outlined in the DateTime docs :
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~drolsky/DateTime-">http://search.cpan.org/~drolsky/DateTime-</a></span>
&gt; 0.50/lib/DateTime.pm#Local_vs._UTC_and_24_hours_vs._1_day
&gt; 
&gt; But we only discovered this on subsequent investigation after our
&gt; server
&gt; started throwing 500 errors.  I guess you could argue I should have
&gt; read
&gt; the docs thoroughly and spotted this but the DateTime docs are rather
&gt; large!
&gt; 
&gt; I think the view currently taken by the maintainer on this, that the
&gt; date range doesn&#39;t actually exist so DateTime should throw an error,
&gt; is
&gt; perfectly valid and arguably correct.  But the problem with this
&gt; solution is that the user then has to be aware of this issue, and then
&gt; write code specifically to catch this.
&gt; 
&gt; As a suggestion, it might be useful to add a user settable flag to
&gt; DateTime which would cause DateTime to handle these dates safely and
&gt; return a value rather than erroring.  Therefore allowing DateTime two
&gt; types of behaviour &#40;safe/unsafe&#41;.  Possibly expand these behaviour
&gt; types
&gt; out so the date returned over the transition period is calculated is
&gt; various ways which again can be user-specified &#40;round off etc..&#41;
</div>
The datetime math code is already full of special cases and complexity,
so I&#39;m not too keen on adding more.

There are a couple ways to avoid landing on a nonexistent date.

First, you can switch to the UTC time zone, add days, then switch back
to the local time zone. This should just work.

Alternately, instead of adding days, you can add multiples of 24 hours.
This will also work, but the answer may be subtly different this way
&#40;not wrong, just different&#41;, because of days with either 23 or 25 hours.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;05&nbsp;15:06:00&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;03&nbsp;22:43:37&nbsp;2010</span>
    <span class="description">DROLSKY [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
