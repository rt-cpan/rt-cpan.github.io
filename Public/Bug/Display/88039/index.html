<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #88039 for Imager: Problem compiling with JPEG support on OSX</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #88039 for Imager: Problem compiling with JPEG support on OSX</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Imager/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Imager/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Imager/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Imager/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Imager">Imager CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">88039</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Imager/Active/">Imager</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
jfield [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-16790-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-16791-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;22&nbsp;18:17:19&nbsp;2013</span>
    <span class="description">jfield [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Problem compiling with JPEG support on OSX</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 22 Aug 2013 15:17:02 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Imager [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jonathan Field &lt;jfield [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

First, thanks for building my favorite image manipulation package :&#41; I have
used it many times successfully on Linux systems. However...

I am trying to build Imager 0.97 with jpeg support on OS X 10.8.4 &#40;Mountain
Lion&#41;. I have tried with libjpeg 6b, 7, 8d, and 9. In each case I am
getting the same error in the perl Makefile.PL output:

  JPEG: main: includes found - libraries found
  JPEG: Test code failed: Can&#39;t link/include &#39;jpeg&#39;
  JPEG: Checking if the compiler can find them on its own
  JPEG: Test code failed: Can&#39;t link/include &#39;jpeg&#39;

&#40;Full output of perl Makefile.PL is at the bottom of the email&#41;

I configured the libjpeg libraries with --enable-shared and
--enable-static, and &#34;make test&#34; reported no problems. They are in
/usr/local/lib:

  -rwxr-xr-x  1 root  admin   145076 Aug 22 13:47 libjpeg.62.dylib*
  -rwxr-xr-x  1 root  admin   267252 Aug 22 14:12 libjpeg.7.dylib*
  -rwxr-xr-x  1 root  admin   277952 Aug 22 14:16 libjpeg.8.dylib*
  -rwxr-xr-x  1 root  admin   281440 Aug 22 14:18 libjpeg.9.dylib*
  -rw-r--r--  1 root  admin  1281080 Aug 22 14:18 libjpeg.a
  lrwxr-xr-x  1 root  admin       15 Aug 22 14:18 libjpeg.dylib@ -&gt;
libjpeg.9.dylib
  -rwxr-xr-x  1 root  admin      910 Aug 22 14:18 libjpeg.la*

I verified after each libjpeg install that the symlink was pointing to the
version just installed. And /usr/local/include has the following file,
which was correctly updated after each libjpeg installation:

  -rw-r--r--  1 root  admin  48910 Aug 22 14:18 jpeglib.h

Here&#39;s the output of perl -V:

Summary of my perl5 &#40;revision 5 version 12 subversion 4&#41; configuration:

  Platform:
    osname=darwin, osvers=12.0, archname=darwin-thread-multi-2level
    uname=&#39;darwin b1026.apple.com 12.0 darwin kernel version 12.0.0: tue
may 15 23:31:29 pdt 2012; root:xnu-2050.6.70~1release_x86_64 x86_64 &#39;
    config_args=&#39;-ds -e -Dprefix=/usr -Dccflags=-g  -pipe  -Dldflags=
-Dman3ext=3pm -Duseithreads -Duseshrplib -Dinc_version_list=none -Dcc=clang&#39;
    hint=recommended, useposix=true, d_sigaction=define
    useithreads=define, usemultiplicity=define
    useperlio=define, d_sfio=undef, uselargefiles=define, usesocks=undef
    use64bitint=define, use64bitall=define, uselongdouble=undef
    usemymalloc=n, bincompat5005=undef
  Compiler:
    cc=&#39;clang&#39;, ccflags =&#39;-arch i386 -arch x86_64 -g -pipe -fno-common
-DPERL_DARWIN -fno-strict-aliasing -fstack-protector -I/usr/local/include&#39;,
    optimize=&#39;-Os&#39;,
    cppflags=&#39;-g -pipe -fno-common -DPERL_DARWIN -fno-strict-aliasing
-fstack-protector -I/usr/local/include&#39;
    ccversion=&#39;&#39;, gccversion=&#39;4.2.1 Compatible Apple Clang 4.0
&#40;tags/Apple/clang-418.0.60&#41;&#39;, gccosandvers=&#39;&#39;
    intsize=4, longsize=8, ptrsize=8, doublesize=8, byteorder=12345678
    d_longlong=define, longlongsize=8, d_longdbl=define, longdblsize=16
    ivtype=&#39;long&#39;, ivsize=8, nvtype=&#39;double&#39;, nvsize=8, Off_t=&#39;off_t&#39;,
lseeksize=8
    alignbytes=8, prototype=define
  Linker and Libraries:
    ld=&#39;clang -mmacosx-version-min=10.8&#39;, ldflags =&#39;-arch i386 -arch x86_64
-fstack-protector -L/usr/local/lib&#39;
    libpth=/usr/local/lib /usr/lib
    libs=-ldbm -ldl -lm -lutil -lc
    perllibs=-ldl -lm -lutil -lc
    libc=, so=dylib, useshrplib=true, libperl=libperl.dylib
    gnulibc_version=&#39;&#39;
  Dynamic Linking:
    dlsrc=dl_dlopen.xs, dlext=bundle, d_dlsymun=undef, ccdlflags=&#39; &#39;
    cccdlflags=&#39; &#39;, lddlflags=&#39;-arch i386 -arch x86_64 -bundle -undefined
dynamic_lookup -L/usr/local/lib -fstack-protector&#39;


Characteristics of this binary &#40;from libperl&#41;:
  Compile-time options: MULTIPLICITY PERL_DONT_CREATE_GVSV
                        PERL_IMPLICIT_CONTEXT PERL_MALLOC_WRAP
USE_64_BIT_ALL
                        USE_64_BIT_INT USE_ITHREADS USE_LARGE_FILES
                        USE_PERLIO USE_PERL_ATOF USE_REENTRANT_API
  Locally applied patches:
/Library/Perl/Updates/&lt;version&gt; comes before system perl directories
installprivlib and installarchlib points to the Updates directory
  Built under darwin
  Compiled at Jun 20 2012 13:55:28
  @INC:
    /Library/Perl/5.12/darwin-thread-multi-2level
    /Library/Perl/5.12
    /Network/Library/Perl/5.12/darwin-thread-multi-2level
    /Network/Library/Perl/5.12
    /Library/Perl/Updates/5.12.4/darwin-thread-multi-2level
    /Library/Perl/Updates/5.12.4
    /System/Library/Perl/5.12/darwin-thread-multi-2level
    /System/Library/Perl/5.12
    /System/Library/Perl/Extras/5.12/darwin-thread-multi-2level
    /System/Library/Perl/Extras/5.12
    .

--- and here is the output of running Makefile.PL

jfield@laptop:~/Downloads/Imager-0.97 &gt; perl Makefile.PL

done.
  TT-fonts: includes not found - libraries not found
POSIX threads
Writing Makefile for Imager::CountColor
Writing Makefile for Imager::Filter::DynTest
FreeType 2: main: includes not found - libraries found
FreeType 2: alt 1: includes found - libraries found
FreeType 2: Test code failed: Can&#39;t link/include &#39;ft2build.h&#39;, &#39;freetype&#39;
FreeType 2: alt 2: includes not found - libraries found
FreeType 2: Checking if the compiler can find them on its own
Note &#40;probably harmless&#41;: No library found for -lfreetype
FreeType 2: Test code failed: Can&#39;t link/include &#39;ft2build.h&#39;, &#39;freetype&#39;
Writing Makefile for Imager::Filter::Flines
GIF: main: includes not found - libraries not found
GIF: Checking if the compiler can find them on its own
Note &#40;probably harmless&#41;: No library found for -lgif
GIF: Test code failed: Can&#39;t link/include &#39;gif_lib.h&#39;, &#39;stdio.h&#39;,
&#39;errno.h&#39;, &#39;string.h&#39;, &#39;gif&#39;
Writing Makefile for Imager::File::ICO
JPEG: main: includes found - libraries found
JPEG: Test code failed: Can&#39;t link/include &#39;jpeg&#39;
JPEG: Checking if the compiler can find them on its own
JPEG: Test code failed: Can&#39;t link/include &#39;jpeg&#39;
Writing Makefile for Imager::Filter::Mandelbrot
PNG: Generic: includes found - libraries found
PNG: Test code failed: Can&#39;t link/include &#39;png&#39;
PNG: v1.6: includes not found - libraries not found
PNG: v1.5: includes found - libraries found
PNG: Test code failed: Can&#39;t link/include &#39;png15&#39;
PNG: v1.4: includes not found - libraries not found
PNG: v1.2: includes not found - libraries not found
PNG: v1.0: includes not found - libraries not found
PNG: base &#40;+libz&#41;: includes found - libraries found
PNG: Test code failed: Can&#39;t link/include &#39;png&#39;, &#39;z&#39;
PNG: v1.6 &#40;+libz&#41;: includes not found - libraries not found
PNG: v1.5 &#40;+libz&#41;: includes found - libraries found
PNG: Test code failed: Can&#39;t link/include &#39;png15&#39;, &#39;z&#39;
PNG: v1.4 &#40;+libz&#41;: includes not found - libraries not found
PNG: v1.2 &#40;+libz&#41;: includes not found - libraries not found
PNG: v1.0 &#40;+libz&#41;: includes not found - libraries not found
PNG: Checking if the compiler can find them on its own
Note &#40;probably harmless&#41;: No library found for -lpng
PNG: Test code failed: Can&#39;t link/include &#39;png.h&#39;, &#39;stdio.h&#39;, &#39;png&#39;
Writing Makefile for Imager::File::SGI
T1Lib: main: includes not found - libraries not found
T1Lib: Checking if the compiler can find them on its own
Note &#40;probably harmless&#41;: No library found for -lt1
T1Lib: Test code failed: Can&#39;t link/include &#39;t1lib.h&#39;, &#39;t1&#39;
TIFF: main: includes found - libraries found
TIFF: Test code failed: Can&#39;t link/include &#39;tiff&#39;
TIFF: Checking if the compiler can find them on its own
Note &#40;probably harmless&#41;: No library found for -ltiff
TIFF: Test code failed: Can&#39;t link/include &#39;tiffio.h&#39;, &#39;stdio.h&#39;,
&#39;string.h&#39;, &#39;tiff&#39;
Win32: main: includes not found - libraries not found
Win32: Checking if the compiler can find them on its own
Note &#40;probably harmless&#41;: No library found for -lgdi32
Win32: Test code failed: Can&#39;t link/include &#39;windows.h&#39;, &#39;gdi32&#39;
Writing Makefile for Imager::plugins
Writing Makefile for Imager

Libraries *not* found:
  FT2
  GIF
  JPEG
  PNG
  T1
  TIFF
  Win32

Any suggestions?

Jonathan Field
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;22&nbsp;18:29:58&nbsp;2013</span>
    <span class="description">tony [...] develop-help.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #88039] Problem compiling with JPEG support on OSX</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 23 Aug 2013 08:29:42 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Jonathan Field via RT &lt;bug-Imager [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Tony Cook &lt;tony [...] develop-help.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, Aug 22, 2013 at 06:17:19PM -0400, Jonathan Field via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; First, thanks for building my favorite image manipulation package :&#41; I have
&gt; used it many times successfully on Linux systems. However...
&gt; 
&gt; I am trying to build Imager 0.97 with jpeg support on OS X 10.8.4 &#40;Mountain
&gt; Lion&#41;. I have tried with libjpeg 6b, 7, 8d, and 9. In each case I am
&gt; getting the same error in the perl Makefile.PL output:
&gt; 
&gt;   JPEG: main: includes found - libraries found
&gt;   JPEG: Test code failed: Can&#39;t link/include &#39;jpeg&#39;
&gt;   JPEG: Checking if the compiler can find them on its own
&gt;   JPEG: Test code failed: Can&#39;t link/include &#39;jpeg&#39;
&gt; 
&gt; &#40;Full output of perl Makefile.PL is at the bottom of the email&#41;
&gt; 
&gt; I configured the libjpeg libraries with --enable-shared and
&gt; --enable-static, and &#34;make test&#34; reported no problems. They are in
&gt; /usr/local/lib:
&gt; 
&gt;   -rwxr-xr-x  1 root  admin   145076 Aug 22 13:47 libjpeg.62.dylib*
&gt;   -rwxr-xr-x  1 root  admin   267252 Aug 22 14:12 libjpeg.7.dylib*
&gt;   -rwxr-xr-x  1 root  admin   277952 Aug 22 14:16 libjpeg.8.dylib*
&gt;   -rwxr-xr-x  1 root  admin   281440 Aug 22 14:18 libjpeg.9.dylib*
&gt;   -rw-r--r--  1 root  admin  1281080 Aug 22 14:18 libjpeg.a
&gt;   lrwxr-xr-x  1 root  admin       15 Aug 22 14:18 libjpeg.dylib@ -&gt;
&gt; libjpeg.9.dylib
&gt;   -rwxr-xr-x  1 root  admin      910 Aug 22 14:18 libjpeg.la*
&gt; 
&gt; I verified after each libjpeg install that the symlink was pointing to the
&gt; version just installed. And /usr/local/include has the following file,
&gt; which was correctly updated after each libjpeg installation:
</div>
Hi Jonathan,

You most likely need to build libjpeg with multi-arch support.

See:

<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/module/TONYC/Imager-0.97/lib/Imager/Install.pod#Building-libraries">https://metacpan.org/module/TONYC/Imager-0.97/lib/Imager/Install.pod#Building-libraries</a></span>

for details on how to do that.

If that doesn&#39;t solve the problem, please send me the output of:

  perl Makefile.PL --verbose

Tony
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;22&nbsp;18:29:58&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;22&nbsp;19:09:27&nbsp;2013</span>
    <span class="description">jfield [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #88039] Problem compiling with JPEG support on OSX</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 22 Aug 2013 16:09:03 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Imager [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jonathan Field &lt;jfield [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;22&nbsp;19:57:46&nbsp;2013</span>
    <span class="description">tony [...] develop-help.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #88039] Problem compiling with JPEG support on OSX</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 23 Aug 2013 09:57:32 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Jonathan Field via RT &lt;bug-Imager [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Tony Cook &lt;tony [...] develop-help.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, Aug 22, 2013 at 07:09:27PM -0400, Jonathan Field via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Imager
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=88039">https://rt.cpan.org/Ticket/Display.html?id=88039</a></span> &gt;
&gt; 
&gt; Hi Tony,
&gt; 
&gt; Thanks for the quick response. I recompiled libjpeg 6b with:
&gt; 
&gt;   ./configure --enable-shared --enable-static --disable-dependency-tracking
&gt; CFLAGS=&#39;-arch x86_64 -arch i386&#39;
&gt; 
&gt; perl Makefile.PL had the same problem. I have included the perl Makefile.PL
&gt; --verbose output below, but here&#39;s an interesting result: for the heck of
&gt; it I tried installing an old copy of Imager I had laying around &#40;Imager
&gt; 0.79&#41; and that linked and worked fine with libjpeg 6b, even without the
&gt; additional CFLAGS arguments. Perhaps there&#39;s in hint in that result?
</div>
...
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; &gt;   -rwxr-xr-x  1 root  admin   145076 Aug 22 13:47 libjpeg.62.dylib*
&gt; &gt; &gt;   -rwxr-xr-x  1 root  admin   267252 Aug 22 14:12 libjpeg.7.dylib*
&gt; &gt; &gt;   -rwxr-xr-x  1 root  admin   277952 Aug 22 14:16 libjpeg.8.dylib*
&gt; &gt; &gt;   -rwxr-xr-x  1 root  admin   281440 Aug 22 14:18 libjpeg.9.dylib*
&gt; &gt; &gt;   -rw-r--r--  1 root  admin  1281080 Aug 22 14:18 libjpeg.a
&gt; &gt; &gt;   lrwxr-xr-x  1 root  admin       15 Aug 22 14:18 libjpeg.dylib@ -&gt;
&gt; &gt; &gt; libjpeg.9.dylib
&gt; &gt; &gt;   -rwxr-xr-x  1 root  admin      910 Aug 22 14:18 libjpeg.la*
&gt; &gt; &gt;
&gt; &gt; &gt; I verified after each libjpeg install that the symlink was pointing to
</div>&gt; &gt; the
<div class="message-stanza open">&gt; &gt; &gt; version just installed. And /usr/local/include has the following file,
&gt; &gt; &gt; which was correctly updated after each libjpeg installation:
</div></div>
Hi Jonathan,

Is libjpeg.dylib still pointing at libjpeg.9.dylib, or did the
reinstall point it at libjpeg.62.dylib?

From the trace I see:

ld: warning: ignoring file /usr/local/lib/libjpeg.dylib, file was built for
unsupported file format &#40; 0xcf 0xfa 0xed 0xfe 0x 7 0x 0 0x 0 0x 1 0x 3 0x 0
0x 0 0x 0 0x 6 0x 0 0x 0 0x 0 &#41; which is not the architecture being linked
&#40;i386&#41;: /usr/local/lib/libjpeg.dylib
Undefined symbols for architecture i386:
  &#34;_jpeg_CreateDecompress&#34;, referenced from:
      _main in assertlibm8vo7vvt-BeA27R.o
  &#34;_jpeg_std_error&#34;, referenced from:
      _main in assertlibm8vo7vvt-BeA27R.o
ld: symbol&#40;s&#41; not found for architecture i386
clang: error: linker command failed with exit code 1 &#40;use -v to see
invocation&#41;
JPEG: Test code failed: Can&#39;t link/include &#39;jpeg&#39;
JPEG: Checking if the compiler can find them on its own

If you run:

  file /usr/local/lib/libjpeg.dylib

you should get results something like &#40;mine is in a different
location&#41;:

neptune:~ tony$ file ~/local/lib/libjpeg.dylib 
/Users/tony/local/lib/libjpeg.dylib: Mach-O universal binary with 3 architectures
/Users/tony/local/lib/libjpeg.dylib &#40;for architecture x86_64&#41;:  Mach-O 64-bit dynamically linked shared library x86_64
/Users/tony/local/lib/libjpeg.dylib &#40;for architecture i386&#41;:    Mach-O dynamically linked shared library i386
/Users/tony/local/lib/libjpeg.dylib &#40;for architecture ppc7400&#41;: Mach-O dynamically linked shared library ppc

Tony
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;22&nbsp;22:59:03&nbsp;2013</span>
    <span class="description">jfield [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #88039] Problem compiling with JPEG support on OSX</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 22 Aug 2013 19:58:43 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Imager [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jonathan Field &lt;jfield [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Yes, libjpeg.dylib currently points to libjpeg.62.dylib - that listing was
from a previous test with v9.

The output of file libjpeg.dylib:

  jfield@laptop:/usr/local/lib &gt; file libjpeg.dylib
  libjpeg.dylib: Mach-O 64-bit dynamically linked shared library x86_64
  jfield@laptop:/usr/local/lib &gt;

So it looks like i386 isn&#39;t getting compiled into libjpeg.62.dylib despite
the flags.

I did eventually get Imager 0.97 working after trying a few more things:
first, it seems like libjpeg 6b doesn&#39;t want to compile for i386 at all on
Mountain Lion. If I try compiling it just for i386 I get several errors
along the lines of:

  ld: warning: ignoring file .libs/rdtarga.o, file was built for i386 which
is not the architecture being linked &#40;x86_64&#41;: .libs/rdtarga.o

And it ultimately fails. I tried compiling the latest version of libjpeg
&#40;v9&#41; for both architectures, but that didn&#39;t work either:

  make  all-am
    CC       jaricom.lo
  llvm-gcc-4.2: -E, -S, -save-temps and -M options are not allowed with
multiple -arch flags
  make[1]: *** [jaricom.lo] Error 1
  make: *** [all] Error 2

However, I was able to get v9 to build with i386 and x86_64 separately. I
then found a page that explained how to combine them using lipo:

  <span class="clickylink"><a target="new" rel="nofollow" href="http://cpanforum.com/threads/13588">http://cpanforum.com/threads/13588</a></span>

That&#39;s his suggested &#34;solution 2&#34;. And that worked - Imager 0.97 built fine
with that. Afterwards I tried &#34;solution 1&#34; &#40;building Imager for only
x86_64&#41; and that also worked. It also picked up PNG support with that, so I
think I&#39;ll go that way. Interesting that at the bottom of that page they
mention your solution again, but that didn&#39;t seem to work for me. Not sure
if this is a Mountain Lion thing or something strange with my setup.

So it seems the the issues trace back to libjpeg being finicky about
building for both architectures. Not sure if that&#39;s useful info to you or
not, for future support, but there you go.

Thanks for your time, Tony, and for setting me on the right path.

Cheers,
Jonathan






On Thu, Aug 22, 2013 at 4:57 PM, tony@develop-help.com via RT &lt;
bug-Imager@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=88039">https://rt.cpan.org/Ticket/Display.html?id=88039</a></span> &gt;
&gt;
&gt; On Thu, Aug 22, 2013 at 07:09:27PM -0400, Jonathan Field via RT wrote:
<div class="message-stanza open">&gt; &gt;        Queue: Imager
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=88039">https://rt.cpan.org/Ticket/Display.html?id=88039</a></span> &gt;
&gt; &gt;
&gt; &gt; Hi Tony,
&gt; &gt;
&gt; &gt; Thanks for the quick response. I recompiled libjpeg 6b with:
&gt; &gt;
&gt; &gt;   ./configure --enable-shared --enable-static
</div>&gt; --disable-dependency-tracking
<div class="message-stanza open">&gt; &gt; CFLAGS=&#39;-arch x86_64 -arch i386&#39;
&gt; &gt;
&gt; &gt; perl Makefile.PL had the same problem. I have included the perl
</div>&gt; Makefile.PL
<div class="message-stanza open">&gt; &gt; --verbose output below, but here&#39;s an interesting result: for the heck of
&gt; &gt; it I tried installing an old copy of Imager I had laying around &#40;Imager
&gt; &gt; 0.79&#41; and that linked and worked fine with libjpeg 6b, even without the
&gt; &gt; additional CFLAGS arguments. Perhaps there&#39;s in hint in that result?
</div>&gt;
&gt; ...
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; &gt;   -rwxr-xr-x  1 root  admin   145076 Aug 22 13:47 libjpeg.62.dylib*
&gt; &gt; &gt; &gt;   -rwxr-xr-x  1 root  admin   267252 Aug 22 14:12 libjpeg.7.dylib*
&gt; &gt; &gt; &gt;   -rwxr-xr-x  1 root  admin   277952 Aug 22 14:16 libjpeg.8.dylib*
&gt; &gt; &gt; &gt;   -rwxr-xr-x  1 root  admin   281440 Aug 22 14:18 libjpeg.9.dylib*
&gt; &gt; &gt; &gt;   -rw-r--r--  1 root  admin  1281080 Aug 22 14:18 libjpeg.a
&gt; &gt; &gt; &gt;   lrwxr-xr-x  1 root  admin       15 Aug 22 14:18 libjpeg.dylib@ -&gt;
&gt; &gt; &gt; &gt; libjpeg.9.dylib
&gt; &gt; &gt; &gt;   -rwxr-xr-x  1 root  admin      910 Aug 22 14:18 libjpeg.la*
&gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; I verified after each libjpeg install that the symlink was pointing
</div></div>&gt; to
<div class="message-stanza open">&gt; &gt; &gt; the
<div class="message-stanza open">&gt; &gt; &gt; &gt; version just installed. And /usr/local/include has the following
</div></div>&gt; file,
<div class="message-stanza open">&gt; &gt; &gt; &gt; which was correctly updated after each libjpeg installation:
</div>&gt;
&gt; Hi Jonathan,
&gt;
&gt; Is libjpeg.dylib still pointing at libjpeg.9.dylib, or did the
&gt; reinstall point it at libjpeg.62.dylib?
&gt;
&gt; From the trace I see:
&gt;
&gt; ld: warning: ignoring file /usr/local/lib/libjpeg.dylib, file was built for
&gt; unsupported file format &#40; 0xcf 0xfa 0xed 0xfe 0x 7 0x 0 0x 0 0x 1 0x 3 0x 0
&gt; 0x 0 0x 0 0x 6 0x 0 0x 0 0x 0 &#41; which is not the architecture being linked
&gt; &#40;i386&#41;: /usr/local/lib/libjpeg.dylib
&gt; Undefined symbols for architecture i386:
&gt;   &#34;_jpeg_CreateDecompress&#34;, referenced from:
&gt;       _main in assertlibm8vo7vvt-BeA27R.o
&gt;   &#34;_jpeg_std_error&#34;, referenced from:
&gt;       _main in assertlibm8vo7vvt-BeA27R.o
&gt; ld: symbol&#40;s&#41; not found for architecture i386
&gt; clang: error: linker command failed with exit code 1 &#40;use -v to see
&gt; invocation&#41;
&gt; JPEG: Test code failed: Can&#39;t link/include &#39;jpeg&#39;
&gt; JPEG: Checking if the compiler can find them on its own
&gt;
&gt; If you run:
&gt;
&gt;   file /usr/local/lib/libjpeg.dylib
&gt;
&gt; you should get results something like &#40;mine is in a different
&gt; location&#41;:
&gt;
&gt; neptune:~ tony$ file ~/local/lib/libjpeg.dylib
&gt; /Users/tony/local/lib/libjpeg.dylib: Mach-O universal binary with 3
&gt; architectures
&gt; /Users/tony/local/lib/libjpeg.dylib &#40;for architecture x86_64&#41;:  Mach-O
&gt; 64-bit dynamically linked shared library x86_64
&gt; /Users/tony/local/lib/libjpeg.dylib &#40;for architecture i386&#41;:    Mach-O
&gt; dynamically linked shared library i386
&gt; /Users/tony/local/lib/libjpeg.dylib &#40;for architecture ppc7400&#41;: Mach-O
&gt; dynamically linked shared library ppc
&gt;
&gt; Tony
&gt;
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;29&nbsp;22:57:01&nbsp;2013</span>
    <span class="description">TONYC [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;09&nbsp;16:31:08&nbsp;2013</span>
    <span class="description">jfield [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #88039] Problem compiling with JPEG support on OSX</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 9 Nov 2013 13:30:54 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Imager [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jonathan Field &lt;jfield [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Tony,

Just wanted to send you an installation note in case you want to add
anything about this the documentation. I&#39;ve recently installed Imager on
Mac OS X 10.9 &#40;Mavericks&#41;. I was able to use the default configuration when
compiling libjpeg, libpng, and libgif, however I had to configure Imager to
only build x86_64. I did it like so:

  env &#34;ARCHFLAGS=-arch x86_64&#34; perl Makefile.PL

This got it to recognize and include the three image libraries I had
installed. Without the environment variable it wouldn&#39;t pick them up as
they were 64-bit only by default. I briefly tried compiling the libraries
for multi-arch support, but there were lots of troubles there. So I&#39;d say
the above approach is the simplest way to get a successful Imager build on
Mavericks.

Hope that is helpful to someone else :&#41;

Cheers,
Jonathan




On Thu, Aug 22, 2013 at 3:29 PM, tony@develop-help.com via RT &lt;
bug-Imager@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=88039">https://rt.cpan.org/Ticket/Display.html?id=88039</a></span> &gt;
&gt;
&gt; On Thu, Aug 22, 2013 at 06:17:19PM -0400, Jonathan Field via RT wrote:
<div class="message-stanza open">&gt; &gt; First, thanks for building my favorite image manipulation package :&#41; I
</div>&gt; have
<div class="message-stanza open">&gt; &gt; used it many times successfully on Linux systems. However...
&gt; &gt;
&gt; &gt; I am trying to build Imager 0.97 with jpeg support on OS X 10.8.4
</div>&gt; &#40;Mountain
<div class="message-stanza open">&gt; &gt; Lion&#41;. I have tried with libjpeg 6b, 7, 8d, and 9. In each case I am
&gt; &gt; getting the same error in the perl Makefile.PL output:
&gt; &gt;
&gt; &gt;   JPEG: main: includes found - libraries found
&gt; &gt;   JPEG: Test code failed: Can&#39;t link/include &#39;jpeg&#39;
&gt; &gt;   JPEG: Checking if the compiler can find them on its own
&gt; &gt;   JPEG: Test code failed: Can&#39;t link/include &#39;jpeg&#39;
&gt; &gt;
&gt; &gt; &#40;Full output of perl Makefile.PL is at the bottom of the email&#41;
&gt; &gt;
&gt; &gt; I configured the libjpeg libraries with --enable-shared and
&gt; &gt; --enable-static, and &#34;make test&#34; reported no problems. They are in
&gt; &gt; /usr/local/lib:
&gt; &gt;
&gt; &gt;   -rwxr-xr-x  1 root  admin   145076 Aug 22 13:47 libjpeg.62.dylib*
&gt; &gt;   -rwxr-xr-x  1 root  admin   267252 Aug 22 14:12 libjpeg.7.dylib*
&gt; &gt;   -rwxr-xr-x  1 root  admin   277952 Aug 22 14:16 libjpeg.8.dylib*
&gt; &gt;   -rwxr-xr-x  1 root  admin   281440 Aug 22 14:18 libjpeg.9.dylib*
&gt; &gt;   -rw-r--r--  1 root  admin  1281080 Aug 22 14:18 libjpeg.a
&gt; &gt;   lrwxr-xr-x  1 root  admin       15 Aug 22 14:18 libjpeg.dylib@ -&gt;
&gt; &gt; libjpeg.9.dylib
&gt; &gt;   -rwxr-xr-x  1 root  admin      910 Aug 22 14:18 libjpeg.la*
&gt; &gt;
&gt; &gt; I verified after each libjpeg install that the symlink was pointing to
</div>&gt; the
<div class="message-stanza open">&gt; &gt; version just installed. And /usr/local/include has the following file,
&gt; &gt; which was correctly updated after each libjpeg installation:
</div>&gt;
&gt; Hi Jonathan,
&gt;
&gt; You most likely need to build libjpeg with multi-arch support.
&gt;
&gt; See:
&gt;
&gt;
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/module/TONYC/Imager-0.97/lib/Imager/Install.pod#Building-libraries">https://metacpan.org/module/TONYC/Imager-0.97/lib/Imager/Install.pod#Building-libraries</a></span>
&gt;
&gt; for details on how to do that.
&gt;
&gt; If that doesn&#39;t solve the problem, please send me the output of:
&gt;
&gt;   perl Makefile.PL --verbose
&gt;
&gt; Tony
&gt;
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
