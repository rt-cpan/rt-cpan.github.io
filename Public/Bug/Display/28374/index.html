<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #28374 for ExtUtils-MakeMaker: [PATCH] add support for &#39;perl&#39; in PREREQ_PM</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #28374 for ExtUtils-MakeMaker: [PATCH] add support for &#39;perl&#39; in PREREQ_PM</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/ExtUtils-MakeMaker/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/ExtUtils-MakeMaker/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/ExtUtils-MakeMaker/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/ExtUtils-MakeMaker/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/ExtUtils-MakeMaker">ExtUtils-MakeMaker CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">28374</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/ExtUtils-MakeMaker/Active/">ExtUtils-MakeMaker</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
dagolden [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-12494-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-12495-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;19&nbsp;01:25:16&nbsp;2007</span>
    <span class="description">dagolden [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [PATCH] add support for &#39;perl&#39; in PREREQ_PM</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Currently, &#39;perl&#39; in PREREQ_PM warns that the perl module can&#39;t be
found.  &#40;However, EU::MM does write it to the Makefile PREREQ_PM and
META.yml, which is good for other tools like CPAN and CPAN::Reporter to
use.&#41;

This patch adds special handling for &#39;perl&#39; in PREREQ_PM as well as a
special error message for PREREQ_FATAL if the perl prerequisite is not
satisfied.  Includes tests in t/prereq.t.  &#40;Tested on Win32 only, but
should be generic.&#41;

Patch file is against r4021.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> EUMM-perl-prereq.patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">=== lib/ExtUtils/MakeMaker.pm
==================================================================
--- lib/ExtUtils/MakeMaker.pm	&#40;revision 3215&#41;
+++ lib/ExtUtils/MakeMaker.pm	&#40;local&#41;
@@ -400,13 +400,22 @@
 
     my&#40;%unsatisfied&#41; = &#40;&#41;;
     foreach my $prereq &#40;sort keys %{$self-&gt;{PREREQ_PM}}&#41; {
-        # 5.8.0 has a bug with require Foo::Bar alone in an eval, so an
-        # extra statement is a workaround.
-        my $file = &#34;$prereq.pm&#34;;
-        $file =~ s{::}{/}g;
-        eval { require $file };
+        my $pr_version;
+        if &#40; $prereq =~ /\Aperl\z/i &#41; {
+            $pr_version = $];
+            # normalize &#39;perl&#39; for other tools
+            $self-&gt;{PREREQ_PM}{&#39;perl&#39;} = delete $self-&gt;{PREREQ_PM}{$prereq};
+            $prereq = lc $prereq; 
+        }
+        else {
+            # 5.8.0 has a bug with require Foo::Bar alone in an eval, so an
+            # extra statement is a workaround.
+            my $file = &#34;$prereq.pm&#34;;
+            $file =~ s{::}{/}g;
+            eval { require $file };
 
-        my $pr_version = $prereq-&gt;VERSION || 0;
+            $pr_version = $prereq-&gt;VERSION || 0;
+        }
 
         # convert X.Y_Z alpha version #s to X.YZ for easier comparisons
         $pr_version =~ s/&#40;\d+&#41;\.&#40;\d+&#41;_&#40;\d+&#41;/$1.$2$3/;
@@ -497,12 +506,17 @@
     if &#40;%unsatisfied &#38;&#38; $self-&gt;{PREREQ_FATAL}&#41;{
         my $failedprereqs = join &#34;\n&#34;, map {&#34;    $_ $unsatisfied{$_}&#34;} 
                             sort { $a cmp $b } keys %unsatisfied;
-        die &lt;&lt;&#34;END&#34;;
+        my $fatal_prereq_message = &lt;&lt;&#34;END&#34;;
 MakeMaker FATAL: prerequisites not found.
 $failedprereqs
 
-Please install these modules first and rerun &#39;perl Makefile.PL&#39;.
 END
+        $fatal_prereq_message .= exists $unsatisfied{perl} 
+            ? &#34;This distribution won&#39;t work without a higher version of Perl.\n&#34;
+            : &#34;Please install these modules first and rerun &#39;perl Makefile.PL&#39;.\n&#34;
+            ;
+            
+        die $fatal_prereq_message;
     }
 
 
=== t/prereq.t
==================================================================
--- t/prereq.t	&#40;revision 3215&#41;
+++ t/prereq.t	&#40;local&#41;
@@ -50,6 +50,22 @@
     &#41;;
     is $warnings, &#39;&#39;;
 
+    WriteMakefile&#40;
+        NAME            =&gt; &#39;Big::Dummy&#39;,
+        PREREQ_PM       =&gt; {
+            perl  =&gt; 5
+        }
+    &#41;;
+    is $warnings, &#39;&#39;;
+
+    WriteMakefile&#40;
+        NAME            =&gt; &#39;Big::Dummy&#39;,
+        PREREQ_PM       =&gt; {
+            Perl  =&gt; 5
+        }
+    &#41;;
+    is $warnings, &#39;&#39;;
+
     $warnings = &#39;&#39;;
     WriteMakefile&#40;
         NAME            =&gt; &#39;Big::Dummy&#39;,
@@ -65,6 +81,17 @@
     WriteMakefile&#40;
         NAME            =&gt; &#39;Big::Dummy&#39;,
         PREREQ_PM       =&gt; {
+            perl  =&gt; 99999
+        }
+    &#41;;
+    is $warnings, 
+    sprintf&#40;&#34;Warning: prerequisite perl 99999 not found. We have %s.\n&#34;,
+            $]&#41;;
+    
+    $warnings = &#39;&#39;;
+    WriteMakefile&#40;
+        NAME            =&gt; &#39;Big::Dummy&#39;,
+        PREREQ_PM       =&gt; {
             &#34;I::Do::Not::Exist&#34; =&gt; 0,
         }
     &#41;;
@@ -107,4 +134,22 @@
 Please install these modules first and rerun &#39;perl Makefile.PL&#39;.
 END
 
+    $warnings = &#39;&#39;;
+    eval {
+        WriteMakefile&#40;
+            NAME            =&gt; &#39;Big::Dummy&#39;,
+            PREREQ_PM       =&gt; {
+                &#34;perl&#34;            =&gt; 99999,
+            },
+            PREREQ_FATAL    =&gt; 1,
+        &#41;;
+    };
+    
+    is $warnings, &#39;&#39;;
+    is $@, &lt;&lt;&#39;END&#39;, &#34;PREREQ_FATAL&#34;;
+MakeMaker FATAL: prerequisites not found.
+    perl 99999
+
+This distribution won&#39;t work without a higher version of Perl.
+END
 }
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;19&nbsp;07:24:25&nbsp;2007</span>
    <span class="description">dagolden [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Patch file is against r4021.
</div>
Note -- doesn&#39;t yet handle dotted-decimal form.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;19&nbsp;07:24:33&nbsp;2007</span>
    <span class="description">dagolden [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;19&nbsp;11:07:50&nbsp;2007</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #28374] [PATCH] add support for &#39;perl&#39; in PREREQ_PM</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 19 Jul 2007 08:07:13 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-ExtUtils-MakeMaker [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"> via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thu Jul 19 01:25:16 2007: Request 28374 was acted upon.
&gt; Transaction: Ticket created by DAGOLDEN
&gt;        Queue: ExtUtils-MakeMaker
&gt;      Subject: [PATCH] add support for &#39;perl&#39; in PREREQ_PM
&gt;    Broken in: &#40;no value&#41;
&gt;     Severity: Normal
&gt;        Owner: Nobody
&gt;   Requestors: DAGOLDEN@cpan.org
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=28374">http://rt.cpan.org/Ticket/Display.html?id=28374</a></span> &gt;
&gt; 
&gt; 
&gt; Currently, &#39;perl&#39; in PREREQ_PM warns that the perl module can&#39;t be
&gt; found.  &#40;However, EU::MM does write it to the Makefile PREREQ_PM and
&gt; META.yml, which is good for other tools like CPAN and CPAN::Reporter to
&gt; use.&#41;
&gt; 
&gt; This patch adds special handling for &#39;perl&#39; in PREREQ_PM as well as a
&gt; special error message for PREREQ_FATAL if the perl prerequisite is not
&gt; satisfied.  Includes tests in t/prereq.t.  &#40;Tested on Win32 only, but
&gt; should be generic.&#41;
&gt; 
&gt; Patch file is against r4021.
</div>
I like the idea of handling an explicit perl version dependency, but I&#39;m not a
fan of overloaded special meanings.  PREREQ_PM is for modules.  This will have
to go into a new keyword.  Probably something like MIN_PERL_VERSION.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;19&nbsp;12:41:54&nbsp;2007</span>
    <span class="description">dagolden [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> DAGOLDEN [...] cpan.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jul 19 11:07:50 2007, schwern@pobox.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I like the idea of handling an explicit perl version dependency, but
&gt; I&#39;m not a
&gt; fan of overloaded special meanings.  PREREQ_PM is for modules.  This
&gt; will have
&gt; to go into a new keyword.  Probably something like MIN_PERL_VERSION.
</div>
I agree on overloaded special meanings -- but at this point, the de
facto standard is that it gets specified just like other prerequisites.
 Module::Build started it, and now CPAN.pm checks for it there as well.
 I&#39;m not sure what CPANPLUS does as I just can&#39;t follow the twisty maze
of classes and methods.

A new keyword works as long as CPAN.pm and Module::Build::Compat make
the matching change.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;19&nbsp;13:28:33&nbsp;2007</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #28374] [PATCH] add support for &#39;perl&#39; in PREREQ_PM</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 19 Jul 2007 10:27:48 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-ExtUtils-MakeMaker [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"> via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: ExtUtils-MakeMaker
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=28374">http://rt.cpan.org/Ticket/Display.html?id=28374</a></span> &gt;
&gt; 
&gt; On Thu Jul 19 11:07:50 2007, schwern@pobox.com wrote:
<div class="message-stanza open">&gt;&gt; I like the idea of handling an explicit perl version dependency, but
&gt;&gt; I&#39;m not a
&gt;&gt; fan of overloaded special meanings.  PREREQ_PM is for modules.  This
&gt;&gt; will have
&gt;&gt; to go into a new keyword.  Probably something like MIN_PERL_VERSION.
</div>&gt; 
&gt; I agree on overloaded special meanings -- but at this point, the de
&gt; facto standard is that it gets specified just like other prerequisites.
&gt;  Module::Build started it, and now CPAN.pm checks for it there as well.
&gt;  I&#39;m not sure what CPANPLUS does as I just can&#39;t follow the twisty maze
&gt; of classes and methods.
&gt; 
&gt; A new keyword works as long as CPAN.pm and Module::Build::Compat make
&gt; the matching change.
</div>
The key in the Makefile.PL doesn&#39;t matter wrt any other part of the tool chain
 It all comes out the same in the META.yml and that&#39;s what the CPAN shell
looks at.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;19&nbsp;14:17:51&nbsp;2007</span>
    <span class="description">dagolden [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> DAGOLDEN [...] cpan.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jul 19 13:28:33 2007, schwern@pobox.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The key in the Makefile.PL doesn&#39;t matter wrt any other part of the
&gt; tool chain
&gt;  It all comes out the same in the META.yml and that&#39;s what the CPAN
&gt; shell
&gt; looks at.
</div>
Only if YAML is available.  YAML seems to fail on 5.6.2.
See <span class="clickylink"><a target="new" rel="nofollow" href="http://cpantesters.perl.org/show/YAML.html">http://cpantesters.perl.org/show/YAML.html</a></span>

If YAML isn&#39;t available, CPAN falls back to parsing the Makefile for the
embedded PREREQ_PM line.  So any new keyword needs to be added to the
generated Makefile and CPAN.pm has to be patched to look for that as well.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;19&nbsp;15:04:14&nbsp;2007</span>
    <span class="description">schwern [...] pobox.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #28374] [PATCH] add support for &#39;perl&#39; in PREREQ_PM</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 19 Jul 2007 12:03:14 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-ExtUtils-MakeMaker [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Michael G Schwern &lt;schwern [...] pobox.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"> via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: ExtUtils-MakeMaker
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=28374">http://rt.cpan.org/Ticket/Display.html?id=28374</a></span> &gt;
&gt; 
&gt; On Thu Jul 19 13:28:33 2007, schwern@pobox.com wrote:
<div class="message-stanza open">&gt;&gt; The key in the Makefile.PL doesn&#39;t matter wrt any other part of the
&gt;&gt; tool chain
&gt;&gt;  It all comes out the same in the META.yml and that&#39;s what the CPAN
&gt;&gt; shell
&gt;&gt; looks at.
</div>&gt; 
&gt; Only if YAML is available.  YAML seems to fail on 5.6.2.
&gt; See <span class="clickylink"><a target="new" rel="nofollow" href="http://cpantesters.perl.org/show/YAML.html">http://cpantesters.perl.org/show/YAML.html</a></span>
</div>
Ok, it&#39;ll have to be fixed.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If YAML isn&#39;t available, CPAN falls back to parsing the Makefile for the
&gt; embedded PREREQ_PM line.  So any new keyword needs to be added to the
&gt; generated Makefile and CPAN.pm has to be patched to look for that as well.
</div>
All the arguments to WriteMakefile show up in the Makefile automatically.
That&#39;s what things like CPAN.pm are groveling through.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;17&nbsp;16:40:15&nbsp;2008</span>
    <span class="description">CHORNY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is patch to add support for MIN_PERL_VERSION for Makefile.PL.
Used parts of David&#39;s patch. Tested with latest version of EUMM on
Windows. It yet not adds info to META.yml - that would be second patch. 

-- 
Alexandr Ciornii, <span class="clickylink"><a target="new" rel="nofollow" href="http://chorny.net">http://chorny.net</a></span>
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- MakeMaker.pm.dist	Fri Feb 29 02:06:55 2008
+++ MakeMaker.pm	Wed Apr 16 14:11:58 2008
@@ -236,7 +236,7 @@
     LINKTYPE MAKE MAKEAPERL MAKEFILE MAKEFILE_OLD MAN1PODS MAN3PODS MAP_TARGET 
     MYEXTLIB NAME NEEDS_LINKING NOECHO NO_META NORECURS NO_VC OBJECT OPTIMIZE 
     PERL_MALLOC_OK PERL PERLMAINCC PERLRUN PERLRUNINST PERL_CORE
-    PERL_SRC PERM_RW PERM_RWX
+    PERL_SRC PERM_RW PERM_RWX MIN_PERL_VERSION
     PL_FILES PM PM_FILTER PMLIBDIRS PMLIBPARENTDIRS POLLUTE PPM_INSTALL_EXEC
     PPM_INSTALL_SCRIPT PREREQ_FATAL PREREQ_PM PREREQ_PRINT PRINT_PREREQ
     SIGN SKIP TYPEMAPS VERSION VERSION_FROM XS XSOPT XSPROTOARG
@@ -389,6 +389,10 @@
 
     check_hints&#40;$self&#41;;
 
+    if &#40;$self-&gt;{MIN_PERL_VERSION} and $self-&gt;{MIN_PERL_VERSION} &gt; $]&#41; {
+        die &#34;This distribution won&#39;t work without a higher version of Perl.\n&#34;;
+    }
+    
     my %configure_att;         # record &#38;{$self-&gt;{CONFIGURE}} attributes
     my&#40;%initial_att&#41; = %$self; # record initial attributes
 
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl -w

# This is a test of the verification of the arguments to
# WriteMakefile.

BEGIN {
    if&#40; $ENV{PERL_CORE} &#41; {
        chdir &#39;t&#39; if -d &#39;t&#39;;
        @INC = &#40;&#39;../lib&#39;, &#39;lib&#39;&#41;;
    }
    else {
        unshift @INC, &#39;t/lib&#39;;
    }
}

use strict;
use Test::More tests =&gt; 8;

use TieOut;
use MakeMaker::Test::Utils;
use MakeMaker::Test::Setup::BFD;

use ExtUtils::MakeMaker;

chdir &#39;t&#39;;

perl_lib&#40;&#41;;

ok&#40; setup_recurs&#40;&#41;, &#39;setup&#39; &#41;;
END {
    ok&#40; chdir File::Spec-&gt;updir &#41;;
    ok&#40; teardown_recurs&#40;&#41;, &#39;teardown&#39; &#41;;
}

ok&#40; chdir &#39;Big-Dummy&#39;, &#34;chdir&#39;d to Big-Dummy&#34; &#41; ||
  diag&#40;&#34;chdir failed: $!&#34;&#41;;

{
    ok&#40; my $stdout = tie *STDOUT, &#39;TieOut&#39; &#41;;
    my $warnings = &#39;&#39;;
    local $SIG{__WARN__} = sub {
        $warnings .= join &#39;&#39;, @_;
    };

    eval {
      WriteMakefile&#40;
        NAME            =&gt; &#39;Big::Dummy&#39;,
        MIN_PERL_VERSION       =&gt; 5,
      &#41;;
    };
    is $warnings, &#39;&#39;;
    is $@, &#39;&#39;,&#39;MIN_PERL_VERSION=5&#39;;

    $warnings = &#39;&#39;;
    eval {
      WriteMakefile&#40;
        NAME            =&gt; &#39;Big::Dummy&#39;,
        MIN_PERL_VERSION       =&gt; 999999,
      &#41;;
    };
    is $@, &#34;This distribution won&#39;t work without a higher version of Perl.\n&#34;,
    &#39;MIN_PERL_VERSION=999999&#39;;

}
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;26&nbsp;20:21:01&nbsp;2008</span>
    <span class="description">hasch-cpan [...] cozap.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [PATCH] more complete patch adding MIN_PERL_VERSION</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat May 17 16:40:15 2008, CHORNY wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This is patch to add support for MIN_PERL_VERSION for Makefile.PL.
&gt; Used parts of David&#39;s patch. Tested with latest version of EUMM on
&gt; Windows. It yet not adds info to META.yml - that would be second patch. 
</div>
I don&#39;t agree that MakeMaker should die when the current perl version
does not match MIN_PERL_VERSION.  As with other unmet requirements of
the distro under examination, it should warn the user but carry on
building a Makefile &#40;unless PREREQ_FATAL is set&#41;.

I have changed that accordingly and added the META.yml part and the ppd
part and a test suite and some documentation.  Of course, MakeMaker&#39;s
own Makefile.PL can use the new parameter right away, so it is also
included there.  For PREREQ_PRINT I suggest a format extension that
keeps perl version and module prerequisites conceptually apart.  For
PRINT_PREREQ &#40;the RedHat thingy&#41; I put &#34;perl&#34; among the modules, as in
META.yml, but might have guessed wrong.

The patch is against ExtUtils-MakeMaker-6.44 &#40;latest from CPAN&#41; as the
subversion site did not work for me.  I have tested it on various Unix
flavours with perl-5.8.8 and perl-5.10.

Michael, I would really appreciate this small but useful feature making
it into an official release, which is why I spent some time on
straightening it out.  Enjoy.

-Martin
-- 
Martin Becker &lt;becker-cpan@cozap.com&gt;, &lt;mhasch@cpan.org&gt;
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;27&nbsp;05:17:28&nbsp;2008</span>
    <span class="description">hasch-cpan [...] cozap.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [PATCH] Re: more complete patch adding MIN_PERL_VERSION</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">As an afterthought, I have made the check of the current perl version
more robust with respect to rubbish in Makefile.PL.  It now gives a
recommendation as to the syntax of the perl version string if the
comparison fails for some reason.  The test suite covers this case now, too.

The modified patch is against ExtUtils-MakeMaker-6.44, as before.

-Martin
-- 
Martin Becker &lt;becker-cpan@cozap.com&gt;, &lt;mhasch@cpan.org&gt;
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;27&nbsp;21:09:22&nbsp;2008</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">That&#39;s a very complete patch, thank you.  I&#39;ve added it with a few
tweaks.  MIN_PERL_VERSION will translate 5.6.1 format to 5.006001.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;27&nbsp;21:09:24&nbsp;2008</span>
    <span class="description">mschwern [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
