<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #107294 for Variable-Magic: Crash during install of Variable-Magic-0.58 running &#34;t\18-opinfo.t&#34;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #107294 for Variable-Magic: Crash during install of Variable-Magic-0.58 running &#34;t\18-opinfo.t&#34;</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Variable-Magic">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Variable-Magic">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Variable-Magic">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Variable-Magic">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Variable-Magic">Variable-Magic CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">107294</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Variable-Magic">Variable-Magic</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
peter [...] dadeos.co.uk

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-44686-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-44687-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.59    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=107294">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1538520" href="/Public/Bug/Display.html?id=107294#txn-1538520">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;24&nbsp;07:24:47&nbsp;2015</span>
    <span class="description">peter [...] dadeos.co.uk -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Crash during install of Variable-Magic-0.58 running &#34;t\18-opinfo.t&#34;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 24 Sep 2015 12:24:34 +0100 &#40;BST&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Variable-Magic [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Peter Stokes &lt;peter [...] dadeos.co.uk&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1538520/821252/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/821252">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

I am experiencing an access violation crash in Perl 5.22.0 whilst attempting 
running the &#34;t\18-opinfo.t&#34; test during installation of Variable-Magic-0.58 on 
Windows.

The issue that I am encountering would appear to be similar to that reported in 
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpantesters.org/cpan/report/cbda218a-6c4a-1014-b9c5-a00a324d4f1e">http://www.cpantesters.org/cpan/report/cbda218a-6c4a-1014-b9c5-a00a324d4f1e</a></span>, 
which might suggest that 
<span class="clickylink"><a target="new" rel="nofollow" href="http://git.profvince.com/?p=perl/modules/Variable-Magic.git;a=commit;h=47305776af757964b20c9739d4d44ad35a3dfb90">http://git.profvince.com/?p=perl/modules/Variable-Magic.git;a=commit;h=47305776af757964b20c9739d4d44ad35a3dfb90</a></span> 
may not have resolved the issue?

I’m afraid that the code contained within Magic.xs is somewhat beyond my 
current understanding.

My testing thus far appears to indicate that the crash is 100% reproducible 
with Perl 5.22.0, yet does not occur with Perl 5.20.3. I have also noticed that 
the warning:

     &#39;Can&#39;t coerce GLOB to integer in transliteration &#40;tr///&#41; at &#40;eval 117&#41; line 1.

also only appears to have been introduced when using Perl 5.22.0.

As far as I can tell the crash occurs within Perl during the shutdown phase 
performed at the end of running the &#34;t\18-opinfo.t&#34; script. The crash may be 
avoided by not performing the transliteration test described on line 44 of 
&#34;t\18-opinfo.t&#34;; more specifically the variant associated with the 
‘VMG_OP_INFO_NAME’ verification, with the ‘VMG_OP_INFO_OBJECT’ variant being 
the one that generates the &#39;Can&#39;t coerce GLOB to integer...&#39; warning.

I have discovered that removing all tests except those defined by lines 37, 39, 
and 44 appears to represent the minimal processing that still results in the 
crash. Removing any of these remaining tests does not trigger the crash.

My suspicion is that this may be the result of changes to code associated with 
the “B” module between Perl 5.20.3 and 5.22.0, having merely inspected the 
contents of &#34;Magic.xs&#34; and observed some differences between the sources for 
&#34;ext\B\B.xs&#34; within the Perl sources and the corresponding extracts of that 
code contained within &#34;Magic.xs&#34;. But I’m afraid my knowledge of any of the 
code involved in insufficient for me to diagnose the issue further.

Would you be able to provide any thoughts on potential changes that I might 
experiment with in order to avoid this crash?

Thanks

Peter
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1539370" href="/Public/Bug/Display.html?id=107294#txn-1539370">#</a>      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;27&nbsp;10:49:44&nbsp;2015</span>
    <span class="description">vpit [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1539370/821713/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/821713">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello, and thank you for your very detailed report.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I am experiencing an access violation crash in Perl 5.22.0 whilst
&gt; attempting
&gt; running the &#34;t\18-opinfo.t&#34; test during installation of Variable-
&gt; Magic-0.58 on
&gt; Windows.
&gt; 
&gt; The issue that I am encountering would appear to be similar to that
&gt; reported in
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpantesters.org/cpan/report/cbda218a-6c4a-1014-b9c5-">http://www.cpantesters.org/cpan/report/cbda218a-6c4a-1014-b9c5-</a></span>
&gt; a00a324d4f1e,
&gt; which might suggest that
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://git.profvince.com/?p=perl/modules/Variable-">http://git.profvince.com/?p=perl/modules/Variable-</a></span>
&gt; Magic.git;a=commit;h=47305776af757964b20c9739d4d44ad35a3dfb90
&gt; may not have resolved the issue?
&gt; 
&gt; I’m afraid that the code contained within Magic.xs is somewhat beyond
&gt; my
&gt; current understanding.
&gt; 
&gt; My testing thus far appears to indicate that the crash is 100%
&gt; reproducible
&gt; with Perl 5.22.0, yet does not occur with Perl 5.20.3. I have also
&gt; noticed that
&gt; the warning:
&gt; 
&gt; &#39;Can&#39;t coerce GLOB to integer in transliteration &#40;tr///&#41; at &#40;eval 117&#41;
&gt; line 1.
&gt; 
&gt; also only appears to have been introduced when using Perl 5.22.0.
</div>
Unfortunately, I am unable to reproduce this crash on the sole Win32 machine I have access to. Which version of Windows are you running ? What is the output of your perl -V ?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; As far as I can tell the crash occurs within Perl during the shutdown
&gt; phase
&gt; performed at the end of running the &#34;t\18-opinfo.t&#34; script. The crash
&gt; may be
&gt; avoided by not performing the transliteration test described on line
&gt; 44 of
&gt; &#34;t\18-opinfo.t&#34;; more specifically the variant associated with the
&gt; ‘VMG_OP_INFO_NAME’ verification, with the ‘VMG_OP_INFO_OBJECT’ variant
&gt; being
&gt; the one that generates the &#39;Can&#39;t coerce GLOB to integer...&#39; warning.
&gt; 
&gt; I have discovered that removing all tests except those defined by
&gt; lines 37, 39,
&gt; and 44 appears to represent the minimal processing that still results
&gt; in the
&gt; crash. Removing any of these remaining tests does not trigger the
&gt; crash.
&gt; 
&gt; My suspicion is that this may be the result of changes to code
&gt; associated with
&gt; the “B” module between Perl 5.20.3 and 5.22.0, having merely inspected
&gt; the
&gt; contents of &#34;Magic.xs&#34; and observed some differences between the
&gt; sources for
&gt; &#34;ext\B\B.xs&#34; within the Perl sources and the corresponding extracts of
&gt; that
&gt; code contained within &#34;Magic.xs&#34;. But I’m afraid my knowledge of any
&gt; of the
&gt; code involved in insufficient for me to diagnose the issue further.
</div>
Thank you for bringing this to my attention. I have pushed an handful of changes that brought the internal copy of B.xs in line with the core version. If you are in position to try out this snapshot :

<span class="clickylink"><a target="new" rel="nofollow" href="http://git.profvince.com/?p=perl/modules/Variable-Magic.git;a=snapshot;h=670e590caf3db942b5e7feddc1e86669f9f46294;sf=tgz">http://git.profvince.com/?p=perl/modules/Variable-Magic.git;a=snapshot;h=670e590caf3db942b5e7feddc1e86669f9f46294;sf=tgz</a></span>

then you can check whether this was actually the cause of the issue. However, from the look of the changes, I&#39;d be quite &#40;happily&#41; surprised if this were the case.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Would you be able to provide any thoughts on potential changes that I
&gt; might
&gt; experiment with in order to avoid this crash?
&gt; 
&gt; Thanks
&gt; 
&gt; Peter
</div>
Vincent
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1539371" href="/Public/Bug/Display.html?id=107294#txn-1539371">#</a>      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;27&nbsp;10:49:44&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1539398" href="/Public/Bug/Display.html?id=107294#txn-1539398">#</a>      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;27&nbsp;12:36:17&nbsp;2015</span>
    <span class="description">peter [...] dadeos.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #107294] Crash during install of Variable-Magic-0.58 running &#34;t\18-opinfo.t&#34;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 27 Sep 2015 17:35:53 +0100 &#40;BST&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Vincent Pit via RT &lt;bug-Variable-Magic [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Peter Stokes &lt;peter [...] dadeos.co.uk&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1539398/821734/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/821734">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 964b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Vincent,

Thank you for taking the time to look into this for me; it is greatly 
appreciated!

I’m afraid that the changes contained within Variable-Magic-670e590 do not 
appear to have significantly altered the results I am experiencing.

I build Perl from source using the Microsoft Visual Studio 2013 toolchain, 
from the free community edition. I have a batch script to achieve this, a 
slightly modified version of which I have made available at:

      <span class="clickylink"><a target="new" rel="nofollow" href="http://www.dadeos.co.uk/vmtest/build.bat">http://www.dadeos.co.uk/vmtest/build.bat</a></span>

If you place a copy of the perl-5.22.0.tar.gz source archive adjacent to 
the build.bat script and then invoke:

     build.bat &#34;&lt;path_to_perl_install_directory&gt;&#34;

where &#34;&lt;path_to_perl_install_directory&gt;&#34; is replaced by the directory into 
which you wish to install the resultant build of perl

NB: The script assumes that there is a copy of 7-zip &#40;see: 
<span class="clickylink"><a target="new" rel="nofollow" href="http://7-zip.org">http://7-zip.org</a></span>&#41; available in the system path in order to extract the 
source archives.

Thanks

Peter
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1540553" href="/Public/Bug/Display.html?id=107294#txn-1540553">#</a>      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;01&nbsp;10:35:10&nbsp;2015</span>
    <span class="description">vpit [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1540553/822445/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/822445">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I managed to build a perl 5.22 with MSVC 10, and I could reproduce the failure.

It most likely appeared with the core commit 6442877a, which turned a PUSHi&#40;do_trans&#40;sv&#41;&#41; into a mPUSHi&#40;do_trans&#40;sv&#41;&#41;, and this expands to :

    sv_setiv&#40;PUSHmortal, do_trans&#40;sv&#41;&#41;

where the magic is processed inside do_trans&#40;&#41;. This causes an undefined behaviour because both PUSHmortal and Variable::Magic modify the argument stack. Most compilers resolve this by calling do_trans&#40;sv&#41; first, but cl.exe prefers to process the PUSHmortal first &#40;probably because he defaults to use the Windows calling convention&#41;, hence the arguments passed to the magic callback linger on the stack and sv_setiv&#40;&#41; gets confused.

This should be fixed by switching the stacks for the magic calls. You can try out the fix in this snapshot :

    <span class="clickylink"><a target="new" rel="nofollow" href="http://git.profvince.com/?p=perl/modules/Variable-Magic.git;a=snapshot;h=3dac6abb6d4dfdbfe07b780d8b856b1d74eac970;sf=tgz">http://git.profvince.com/?p=perl/modules/Variable-Magic.git;a=snapshot;h=3dac6abb6d4dfdbfe07b780d8b856b1d74eac970;sf=tgz</a></span>

It&#39;s a wonder this issue has never caused any harm to anyone &#40;or at least not enough harm to warrant writing a bug report&#41; in eight years.


Vincent
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1540584" href="/Public/Bug/Display.html?id=107294#txn-1540584">#</a>      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;01&nbsp;12:28:16&nbsp;2015</span>
    <span class="description">peter [...] dadeos.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #107294] Crash during install of Variable-Magic-0.58 running &#34;t\18-opinfo.t&#34;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 1 Oct 2015 17:27:59 +0100 &#40;BST&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Vincent Pit via RT &lt;bug-Variable-Magic [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Peter Stokes &lt;peter [...] dadeos.co.uk&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1540584/822462/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/822462">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 227b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Vincent,

I can confirm that the changes contained with Variable-Magic-3dac6ab 
resolve both the crash and the &#39;Can&#39;t coerce GLOB to integer...&#39; warning.

Thank you for making the time and effort to fix this issue!

Peter
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1542146" href="/Public/Bug/Display.html?id=107294#txn-1542146">#</a>      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;06&nbsp;08:04:26&nbsp;2015</span>
    <span class="description">vpit [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1542146/823356/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/823356">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 55b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks. This has been fixed in version 0.59.


Vincent
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1542148" href="/Public/Bug/Display.html?id=107294#txn-1542148">#</a>      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;06&nbsp;08:04:48&nbsp;2015</span>
    <span class="description">vpit [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1542150" href="/Public/Bug/Display.html?id=107294#txn-1542150">#</a>      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;06&nbsp;08:04:49&nbsp;2015</span>
    <span class="description">vpit [...] cpan.org -  Severity Important added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1542151" href="/Public/Bug/Display.html?id=107294#txn-1542151">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;06&nbsp;08:04:49&nbsp;2015</span>
    <span class="description">vpit [...] cpan.org -  Fixed in 0.59 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.665565</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
