<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #96413 for CSS-Inliner: some non-inline-able pseudo selectors not getting skipped</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #96413 for CSS-Inliner: some non-inline-able pseudo selectors not getting skipped</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/CSS-Inliner/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/CSS-Inliner/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/CSS-Inliner/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/CSS-Inliner/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/CSS-Inliner">CSS-Inliner CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">96413</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/CSS-Inliner/Active/">CSS-Inliner</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
lxp [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-229630-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
3945    </td>
  </tr>
  <tr id="CF-229631-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;12&nbsp;21:55:24&nbsp;2014</span>
    <span class="description">lxp [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Given CSS with declarations like :hover, :focus and :active, calling the
&#34;inlinify&#34; method results in a number of warnings being raised:

Pseudoclass :hover not supported at .../HTML/Query.pm line 284.
Pseudoclass :focus not supported at .../HTML/Query.pm line 284.
Pseudoclass :last-of-type not supported at .../HTML/Query.pm line 284.
Pseudoclass :nth-child not supported at .../HTML/Query.pm line 284.
Pseudoclass :first-of-type not supported at .../HTML/Query.pm line 284.
Pseudoclass :active not supported at .../HTML/Query.pm line 284.

In my case, these are propagating into cron output and triggering emails
every time I&#39;m using this distribution.

I realise that these errors are coming from HTML::Query rather than from
CSS::Inliner directly, but since these features just aren&#39;t supported in
inlined CSS, I wonder whether CSS::Inliner should somehow be responsible
for preventing these warnings from occurring rather than HTML::Query.

I&#39;m happy to be told that this needs to be filed as an HTML::Query bug
instead.

My current workaround is to use Capture::Tiny to capture STDERR while
the &#34;inlinify&#34; method runs, then use a regex to filter out pseudoclass-
related warnings &#40;and propagate any remaining warnings&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;12&nbsp;21:56:03&nbsp;2014</span>
    <span class="description">lxp [...] cpan.org -  Subject changed from &#40;no value&#41; to &#39;&#34;inlinify&#34; method triggers warnings when dealing with pseudoclasses&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;12&nbsp;21:57:21&nbsp;2014</span>
    <span class="description">lxp [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">For what it&#39;s worth, I&#39;m using the latest version of HTML::Query at this
time &#40;v0.08&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;13&nbsp;21:24:52&nbsp;2014</span>
    <span class="description">lxp [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Looking closely at the code within the &#34;inlinify&#34; method, it looks like
CSS::Inliner already attempts to filter out the CSS that can&#39;t actually
be inlined, but for some reason HTML::Query is still getting hit later:

<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/KAMELKEV/CSS-Inliner-3945/lib/CSS/Inliner.pm#L296">https://metacpan.org/source/KAMELKEV/CSS-Inliner-3945/lib/CSS/Inliner.pm#L296</a></span>

#skip over the following psuedo selectors, these particular ones are not inlineable
if &#40;$selector =~ /&#40;?:^|[\w\*]&#41;:&#40;?:&#40;active|focus|hover|link|visited|after|...&#41;&#41;\b/io&#41; {
  $self-&gt;_report_warning&#40;{ info =&gt; &#34;The pseudo-class &#39;:$1&#39; cannot be supported inline&#34; }&#41;;
  next;
}

This indicates to me that this is indeed a CSS::Inliner bug, and not an
HTML::Query one.  I&#39;ll update the ticket subject and see if I can work
out later why this isn&#39;t working as expected.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;13&nbsp;21:24:53&nbsp;2014</span>
    <span class="description">lxp [...] cpan.org -  Subject changed from &#39;&#34;inlinify&#34; method triggers warnings when dealing with pseudoclasses&#39; to &#39;some non-inline-able pseudo selectors not getting skipped&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;13&nbsp;23:17:24&nbsp;2014</span>
    <span class="description">lxp [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The selectors in my case which are causing HTML::Query to generate
warnings &#40;and therefore aren&#39;t being caught by the regular expression in
CSS::Inliner&#41; are as follows:

input[class=button]:active
input[class=button]:focus
input[class=button]:hover
input[type=reset]:active
input[type=reset]:focus
input[type=reset]:hover
input[type=submit]:active
input[type=submit]:focus
input[type=submit]:hover
#page-menu.pinned &gt; li:first-of-type
#page-menu.pinned &gt; li:first-of-type &gt; a
.error .titlebox-content &gt; p:last-of-type
.rights-editor ul.rights-list li:nth-child&#40;even&#41;

I suppose in the first nine cases, the square brackets are causing the
regular expression not to apply.  I don&#39;t know whether or not the
&#34;:first-of-type,&#34; &#34;:last-of-type&#34; and &#34;:nth-child&#34; pseudo classes are
inline-able &#40;and therefore whether they should be caught by the regex&#41;.

This is probably the extent of contribution I can make to this issue
without further comment from the distribution&#39;s author.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;16&nbsp;20:33:25&nbsp;2014</span>
    <span class="description">KAMELKEV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">That&#39;s interesting. I have never seen someone target psuedo-selectors like this, but it certainly makes sense that you could do this.

Unlike other inlining applications out there &#40;there are quite a few nowdays&#41; this one is based on what we see in the real world rather than what is defined via spec. Due to this we still seemingly have an advantage over &#34;the other guys&#34;.

We are planning on doing a sprint soon to add support for shorthand selectors, when I add that support I will try modify this regex to behave as expected.

The other psuedo-selectors you noted are possibly for us to support, we just haven&#39;t gotten there yet. I&#39;m always looking for contributions... :&#41;

thanks,
  Kevin



On Fri Jun 13 23:17:24 2014, LXP wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The selectors in my case which are causing HTML::Query to generate
&gt; warnings &#40;and therefore aren&#39;t being caught by the regular expression in
&gt; CSS::Inliner&#41; are as follows:
&gt; 
&gt; input[class=button]:active
&gt; input[class=button]:focus
&gt; input[class=button]:hover
&gt; input[type=reset]:active
&gt; input[type=reset]:focus
&gt; input[type=reset]:hover
&gt; input[type=submit]:active
&gt; input[type=submit]:focus
&gt; input[type=submit]:hover
&gt; #page-menu.pinned &gt; li:first-of-type
&gt; #page-menu.pinned &gt; li:first-of-type &gt; a
&gt; .error .titlebox-content &gt; p:last-of-type
&gt; .rights-editor ul.rights-list li:nth-child&#40;even&#41;
&gt; 
&gt; I suppose in the first nine cases, the square brackets are causing the
&gt; regular expression not to apply.  I don&#39;t know whether or not the
&gt; &#34;:first-of-type,&#34; &#34;:last-of-type&#34; and &#34;:nth-child&#34; pseudo classes are
&gt; inline-able &#40;and therefore whether they should be caught by the regex&#41;.
&gt; 
&gt; This is probably the extent of contribution I can make to this issue
&gt; without further comment from the distribution&#39;s author.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;16&nbsp;20:33:25&nbsp;2014</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;17&nbsp;21:39:23&nbsp;2014</span>
    <span class="description">lxp [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Jun 17 10:33:25 2014, KAMELKEV wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; We are planning on doing a sprint soon to add support for shorthand
&gt; selectors, when I add that support I will try modify this regex to
&gt; behave as expected.
</div>
Another possible fix could be as follows:

It&#39;s evident through the warnings generated by HTML::Query that that
distribution has logic to identify pseudo classes that it can&#39;t support.

If HTML::Query were to expose that logic via a supports_pseudoclass&#40;$&#41;
method or similar, maybe CSS::Inliner could simply call that instead of
defining its own logic.  It sounds like the logic is currently &#40;almost&#41;
duplicated across the two distributions, with the &#34;almost&#34; in this case
causing the problem.

&#40;I realise that it could be more complex than this--I&#39;ve only studied
the code to the extent required to contribute to this discussion.&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The other psuedo-selectors you noted are possibly for us to support,
&gt; we just haven&#39;t gotten there yet. I&#39;m always looking for
&gt; contributions... :&#41;
</div>
I notice that neither CSS::Inliner nor HTML::Query provide source code
repository details in either the distribution metadata or the README.
Is there such a publicly available repository, and what is your
preferred method for receiving contributions?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;07&nbsp;01:06:01&nbsp;2014</span>
    <span class="description">KAMELKEV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Both CPAN distros have source repos on github. I own one repo, and I have contributor access for the other.

For this particular case I think it is going to make a lot more sense to simply fix the regex that is in place in Inliner. I don&#39;t see the error looking over it right now, but hopefully it&#39;s a minor oversight.

You are right that Query and Inliner use different logic to catch these cases, but if you read over the two pieces you&#39;ll see they technically should be accomplishing the same thing. Inliner enumerates every single case that it doesn&#39;t support, whereas Query enumerates every case that it *does* support. In any case, there doesn&#39;t seem to be a hole with the enumerations, but rather the parsing/chopping that is occurring with the regex within Inliner.

My first stop for solving this would be to start testing out that regex, but I still have to add shorthand support for the library sponsor first. Once that occurs, I will look at this. If you somehow have time you can submit a patch either here, or through github.

Thanks for reporting this, I can see it would be annoying.

-K



On Tue Jun 17 21:39:23 2014, LXP wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Tue Jun 17 10:33:25 2014, KAMELKEV wrote:
<div class="message-stanza open">&gt; &gt; We are planning on doing a sprint soon to add support for shorthand
&gt; &gt; selectors, when I add that support I will try modify this regex to
&gt; &gt; behave as expected.
</div>&gt; 
&gt; Another possible fix could be as follows:
&gt; 
&gt; It&#39;s evident through the warnings generated by HTML::Query that that
&gt; distribution has logic to identify pseudo classes that it can&#39;t support.
&gt; 
&gt; If HTML::Query were to expose that logic via a supports_pseudoclass&#40;$&#41;
&gt; method or similar, maybe CSS::Inliner could simply call that instead of
&gt; defining its own logic.  It sounds like the logic is currently &#40;almost&#41;
&gt; duplicated across the two distributions, with the &#34;almost&#34; in this case
&gt; causing the problem.
&gt; 
&gt; &#40;I realise that it could be more complex than this--I&#39;ve only studied
&gt; the code to the extent required to contribute to this discussion.&#41;
&gt; 
<div class="message-stanza open">&gt; &gt; The other psuedo-selectors you noted are possibly for us to support,
&gt; &gt; we just haven&#39;t gotten there yet. I&#39;m always looking for
&gt; &gt; contributions... :&#41;
</div>&gt; 
&gt; I notice that neither CSS::Inliner nor HTML::Query provide source code
&gt; repository details in either the distribution metadata or the README.
&gt; Is there such a publicly available repository, and what is your
&gt; preferred method for receiving contributions?
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;07&nbsp;01:35:30&nbsp;2014</span>
    <span class="description">KAMELKEV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I am 99% sure the following patch would fix the issue you are having - but I need sample html files from you in order to create proper tests in order to exercise the code and make sure everything works the way it&#39;s supposed to.

Please send over a file or two that causes multiple problems that you have discussed within this ticket, and we will test this and see if it works. If you want to try for yourself, I plan to test the following:

diff --git a/lib/CSS/Inliner.pm b/lib/CSS/Inliner.pm
index 6f4125f..6c15331 100755
--- a/lib/CSS/Inliner.pm
+++ b/lib/CSS/Inliner.pm
@@ -294,7 +294,7 @@ sub inlinify {
       my $declarations = $$entry{declarations};

       #skip over the following psuedo selectors, these particular ones are not inlineable
-      if &#40;$selector =~ /&#40;?:^|[\w\*]&#41;:&#40;?:&#40;active|focus|hover|link|visited|after|before|selection|target|first-line|first-letter&#41;&#41;\b/io&#41; {
+      if &#40;$selector =~ /&#40;?:^|[\w\*\]]&#41;:&#40;?:&#40;active|focus|hover|link|visited|after|before|selection|target|first-line|first-letter&#41;&#41;\b/io&#41; {
         $self-&gt;_report_warning&#40;{ info =&gt; &#34;The pseudo-class &#39;:$1&#39; cannot be supported inline&#34; }&#41;;
         next;
       }













On Thu Aug 07 01:06:01 2014, KAMELKEV wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Both CPAN distros have source repos on github. I own one repo, and I
&gt; have contributor access for the other.
&gt; 
&gt; For this particular case I think it is going to make a lot more sense
&gt; to simply fix the regex that is in place in Inliner. I don&#39;t see the
&gt; error looking over it right now, but hopefully it&#39;s a minor oversight.
&gt; 
&gt; You are right that Query and Inliner use different logic to catch
&gt; these cases, but if you read over the two pieces you&#39;ll see they
&gt; technically should be accomplishing the same thing. Inliner enumerates
&gt; every single case that it doesn&#39;t support, whereas Query enumerates
&gt; every case that it *does* support. In any case, there doesn&#39;t seem to
&gt; be a hole with the enumerations, but rather the parsing/chopping that
&gt; is occurring with the regex within Inliner.
&gt; 
&gt; My first stop for solving this would be to start testing out that
&gt; regex, but I still have to add shorthand support for the library
&gt; sponsor first. Once that occurs, I will look at this. If you somehow
&gt; have time you can submit a patch either here, or through github.
&gt; 
&gt; Thanks for reporting this, I can see it would be annoying.
&gt; 
&gt; -K
&gt; 
&gt; 
&gt; 
&gt; On Tue Jun 17 21:39:23 2014, LXP wrote:
<div class="message-stanza open">&gt; &gt; On Tue Jun 17 10:33:25 2014, KAMELKEV wrote:
<div class="message-stanza open">&gt; &gt; &gt; We are planning on doing a sprint soon to add support for shorthand
&gt; &gt; &gt; selectors, when I add that support I will try modify this regex to
&gt; &gt; &gt; behave as expected.
</div>&gt; &gt;
&gt; &gt; Another possible fix could be as follows:
&gt; &gt;
&gt; &gt; It&#39;s evident through the warnings generated by HTML::Query that that
&gt; &gt; distribution has logic to identify pseudo classes that it can&#39;t
&gt; &gt; support.
&gt; &gt;
&gt; &gt; If HTML::Query were to expose that logic via a
&gt; &gt; supports_pseudoclass&#40;$&#41;
&gt; &gt; method or similar, maybe CSS::Inliner could simply call that instead
&gt; &gt; of
&gt; &gt; defining its own logic.  It sounds like the logic is currently
&gt; &gt; &#40;almost&#41;
&gt; &gt; duplicated across the two distributions, with the &#34;almost&#34; in this
&gt; &gt; case
&gt; &gt; causing the problem.
&gt; &gt;
&gt; &gt; &#40;I realise that it could be more complex than this--I&#39;ve only studied
&gt; &gt; the code to the extent required to contribute to this discussion.&#41;
&gt; &gt;
<div class="message-stanza open">&gt; &gt; &gt; The other psuedo-selectors you noted are possibly for us to
&gt; &gt; &gt; support,
&gt; &gt; &gt; we just haven&#39;t gotten there yet. I&#39;m always looking for
&gt; &gt; &gt; contributions... :&#41;
</div>&gt; &gt;
&gt; &gt; I notice that neither CSS::Inliner nor HTML::Query provide source
&gt; &gt; code
&gt; &gt; repository details in either the distribution metadata or the README.
&gt; &gt; Is there such a publicly available repository, and what is your
&gt; &gt; preferred method for receiving contributions?
</div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;07&nbsp;03:50:37&nbsp;2014</span>
    <span class="description">lxp [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Aug 07 15:35:30 2014, KAMELKEV wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Please send over a file or two that causes multiple problems that you
&gt; have discussed within this ticket, and we will test this and see if it
&gt; works.
</div>
The attached HTML file triggers the following warnings for me:

Pseudoclass :hover not supported at .../HTML/Query.pm line 284.
Pseudoclass :hover not supported at .../HTML/Query.pm line 284.
Pseudoclass :hover not supported at .../HTML/Query.pm line 284.
Pseudoclass :focus not supported at .../HTML/Query.pm line 284.
Pseudoclass :focus not supported at .../HTML/Query.pm line 284.
Pseudoclass :focus not supported at .../HTML/Query.pm line 284.
Pseudoclass :last-of-type not supported at .../HTML/Query.pm line 284.
Pseudoclass :nth-child not supported at .../HTML/Query.pm line 284.
Pseudoclass :first-of-type not supported at .../HTML/Query.pm line 284.
Pseudoclass :first-of-type not supported at .../HTML/Query.pm line 284.
Pseudoclass :focus not supported at .../HTML/Query.pm line 284.
Pseudoclass :focus not supported at .../HTML/Query.pm line 284.
Pseudoclass :focus not supported at .../HTML/Query.pm line 284.
Pseudoclass :hover not supported at .../HTML/Query.pm line 284.
Pseudoclass :hover not supported at .../HTML/Query.pm line 284.
Pseudoclass :hover not supported at .../HTML/Query.pm line 284.
Pseudoclass :active not supported at .../HTML/Query.pm line 284.
Pseudoclass :active not supported at .../HTML/Query.pm line 284.
Pseudoclass :active not supported at .../HTML/Query.pm line 284.


On Thu Aug 07 15:06:01 2014, KAMELKEV wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Both CPAN distros have source repos on github. I own one repo, and I
&gt; have contributor access for the other.
&gt; ...
&gt; If you somehow have time you can submit a patch either here, or
&gt; through github.
</div>
I believe that you&#39;re referring to these repositories:

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/kamelkev/CSS-Inliner">https://github.com/kamelkev/CSS-Inliner</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/abw/HTML-Query">https://github.com/abw/HTML-Query</a></span>

If that&#39;s the case, I&#39;ll see if I can get a chance to abstract the
detection logic into a single place &#40;thus preventing the need to keep
two pieces of code synchronised in future&#41;.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> pseudoclass-not-supported.html</td>
  </tr>
</table>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;07&nbsp;18:49:34&nbsp;2014</span>
    <span class="description">KAMELKEV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ok I received your html, I will generate a test file from this that exercises the cases outlined here.

I got distracted in my last reply, the repos are:
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/kamelkev/HTML-Query">https://github.com/kamelkev/HTML-Query</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/kamelkev/CSS-Inliner">https://github.com/kamelkev/CSS-Inliner</a></span>

I take contributions to my forked repo of HTML-Query and then push those back over to Andy&#39;s when it&#39;s release time.

I&#39;m skeptical about the plan of creating a test method within HTML::Query that will jive with the design philosophy, but if you can get it to line up I&#39;m more than willing to look.

Of issue is the different philosophies present in each of the libraries, but I&#39;m not entirely sure what you have in mind so maybe you can make it work.



On Thu Aug 07 03:50:37 2014, LXP wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu Aug 07 15:35:30 2014, KAMELKEV wrote:
<div class="message-stanza open">&gt; &gt; Please send over a file or two that causes multiple problems that you
&gt; &gt; have discussed within this ticket, and we will test this and see if it
&gt; &gt; works.
</div>&gt; 
&gt; The attached HTML file triggers the following warnings for me:
&gt; 
&gt; Pseudoclass :hover not supported at .../HTML/Query.pm line 284.
&gt; Pseudoclass :hover not supported at .../HTML/Query.pm line 284.
&gt; Pseudoclass :hover not supported at .../HTML/Query.pm line 284.
&gt; Pseudoclass :focus not supported at .../HTML/Query.pm line 284.
&gt; Pseudoclass :focus not supported at .../HTML/Query.pm line 284.
&gt; Pseudoclass :focus not supported at .../HTML/Query.pm line 284.
&gt; Pseudoclass :last-of-type not supported at .../HTML/Query.pm line 284.
&gt; Pseudoclass :nth-child not supported at .../HTML/Query.pm line 284.
&gt; Pseudoclass :first-of-type not supported at .../HTML/Query.pm line 284.
&gt; Pseudoclass :first-of-type not supported at .../HTML/Query.pm line 284.
&gt; Pseudoclass :focus not supported at .../HTML/Query.pm line 284.
&gt; Pseudoclass :focus not supported at .../HTML/Query.pm line 284.
&gt; Pseudoclass :focus not supported at .../HTML/Query.pm line 284.
&gt; Pseudoclass :hover not supported at .../HTML/Query.pm line 284.
&gt; Pseudoclass :hover not supported at .../HTML/Query.pm line 284.
&gt; Pseudoclass :hover not supported at .../HTML/Query.pm line 284.
&gt; Pseudoclass :active not supported at .../HTML/Query.pm line 284.
&gt; Pseudoclass :active not supported at .../HTML/Query.pm line 284.
&gt; Pseudoclass :active not supported at .../HTML/Query.pm line 284.
&gt; 
&gt; 
&gt; On Thu Aug 07 15:06:01 2014, KAMELKEV wrote:
<div class="message-stanza open">&gt; &gt; Both CPAN distros have source repos on github. I own one repo, and I
&gt; &gt; have contributor access for the other.
&gt; &gt; ...
&gt; &gt; If you somehow have time you can submit a patch either here, or
&gt; &gt; through github.
</div>&gt; 
&gt; I believe that you&#39;re referring to these repositories:
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/kamelkev/CSS-Inliner">https://github.com/kamelkev/CSS-Inliner</a></span>
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/abw/HTML-Query">https://github.com/abw/HTML-Query</a></span>
&gt; 
&gt; If that&#39;s the case, I&#39;ll see if I can get a chance to abstract the
&gt; detection logic into a single place &#40;thus preventing the need to keep
&gt; two pieces of code synchronised in future&#41;.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;02&nbsp;23:26:32&nbsp;2014</span>
    <span class="description">KAMELKEV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">New version uploaded to CPAN. It will take a day or two to clear. In the meantime you can pull down the latest directly off of my github account:

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/kamelkev/CSS-Inliner">https://github.com/kamelkev/CSS-Inliner</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/kamelkev/HTML-Query">https://github.com/kamelkev/HTML-Query</a></span>

Thanks for reporting this, that was annoying.

-K


On Thu Aug 07 03:50:37 2014, LXP wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu Aug 07 15:35:30 2014, KAMELKEV wrote:
<div class="message-stanza open">&gt; &gt; Please send over a file or two that causes multiple problems that you
&gt; &gt; have discussed within this ticket, and we will test this and see if it
&gt; &gt; works.
</div>&gt; 
&gt; The attached HTML file triggers the following warnings for me:
&gt; 
&gt; Pseudoclass :hover not supported at .../HTML/Query.pm line 284.
&gt; Pseudoclass :hover not supported at .../HTML/Query.pm line 284.
&gt; Pseudoclass :hover not supported at .../HTML/Query.pm line 284.
&gt; Pseudoclass :focus not supported at .../HTML/Query.pm line 284.
&gt; Pseudoclass :focus not supported at .../HTML/Query.pm line 284.
&gt; Pseudoclass :focus not supported at .../HTML/Query.pm line 284.
&gt; Pseudoclass :last-of-type not supported at .../HTML/Query.pm line 284.
&gt; Pseudoclass :nth-child not supported at .../HTML/Query.pm line 284.
&gt; Pseudoclass :first-of-type not supported at .../HTML/Query.pm line 284.
&gt; Pseudoclass :first-of-type not supported at .../HTML/Query.pm line 284.
&gt; Pseudoclass :focus not supported at .../HTML/Query.pm line 284.
&gt; Pseudoclass :focus not supported at .../HTML/Query.pm line 284.
&gt; Pseudoclass :focus not supported at .../HTML/Query.pm line 284.
&gt; Pseudoclass :hover not supported at .../HTML/Query.pm line 284.
&gt; Pseudoclass :hover not supported at .../HTML/Query.pm line 284.
&gt; Pseudoclass :hover not supported at .../HTML/Query.pm line 284.
&gt; Pseudoclass :active not supported at .../HTML/Query.pm line 284.
&gt; Pseudoclass :active not supported at .../HTML/Query.pm line 284.
&gt; Pseudoclass :active not supported at .../HTML/Query.pm line 284.
&gt; 
&gt; 
&gt; On Thu Aug 07 15:06:01 2014, KAMELKEV wrote:
<div class="message-stanza open">&gt; &gt; Both CPAN distros have source repos on github. I own one repo, and I
&gt; &gt; have contributor access for the other.
&gt; &gt; ...
&gt; &gt; If you somehow have time you can submit a patch either here, or
&gt; &gt; through github.
</div>&gt; 
&gt; I believe that you&#39;re referring to these repositories:
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/kamelkev/CSS-Inliner">https://github.com/kamelkev/CSS-Inliner</a></span>
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/abw/HTML-Query">https://github.com/abw/HTML-Query</a></span>
&gt; 
&gt; If that&#39;s the case, I&#39;ll see if I can get a chance to abstract the
&gt; detection logic into a single place &#40;thus preventing the need to keep
&gt; two pieces of code synchronised in future&#41;.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;02&nbsp;23:28:32&nbsp;2014</span>
    <span class="description">KAMELKEV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Fixed in CSS::Inliner 3948 and HTML::Query 0.09
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;02&nbsp;23:28:33&nbsp;2014</span>
    <span class="description">KAMELKEV [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
