<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #16538 for TermReadKey: ReadKey Win32 contribution</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #16538 for TermReadKey: ReadKey Win32 contribution</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=TermReadKey">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=TermReadKey">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=TermReadKey">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=TermReadKey">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/TermReadKey">TermReadKey CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">16538</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=TermReadKey">TermReadKey</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">jns [...] gellyfish.co.uk
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
klemobari [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-31276-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-31277-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




ReadKey.xs<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/155489/47592/ReadKey.xs">
Fri Jan 13 12:11:11 2006 (48.4k) by jns [...] gellyfish.com
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/155329/47527/ReadKey.xs">
Fri Jan 13 07:09:05 2006 (48.1k) by klemobari [...] gmail.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=16538">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-151695" href="/Public/Bug/Display.html?id=16538#txn-151695">#</a>      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;16&nbsp;05:22:25&nbsp;2005</span>
    <span class="description">klemobari [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> C Barry &lt;klemobari [...] gmail.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> jns [...] gellyfish.com</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> ReadKey Win32 contribution</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 16 Dec 2005 10:20:58 +0000</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/151695/45987/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/45987">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Jonathan,

I&#39;d like to solve a portability problem in ReadKey.xs, while using latest
ActiveState Perl 5.8.

The Win32PeekChar routine makes some basic keys look like the null byte.
This is especially true with the arrow keys, and the Home/End/PgUp/PgDn
navigation keys. For example the left-arrow key &#34;\e[D&#34; will look
like &#34;\0&#34;, and the two other characters will never be retrieved by
subsequent calls to ReadKey.

As a direct consequence, ReadLine packages on Windows deliver a look and
feel that is inferior to plain &lt;STDIN&gt;, which ruins the whole idea of using
a ReadLine package... Windows users hardly use control keys to move on a
command-line, they use arrow keys and will think that &#34;cursor doesn&#39;t work&#34;.

This is also described in this interesting 2001 discussion:
<span class="clickylink"><a target="new" rel="nofollow" href="http://qs321.pair.com/~monkads/?node_id=125648">http://qs321.pair.com/~monkads/?node_id=125648</a></span>


I believe that a solution would be to handle the case when [
record.Event.KeyEvent.wVirtualKeyCode] is one of the values in &#40;VK_RIGHT,
VK_LEFT, VK_UP, VK_DOWN, VK_HOME, VK_END, VK_PAGE_UP, VK_PAGE_DOWN&#41;,
- return the escape character,
- store the subsequent characters in a static array,
- multiply &#34;keyCount&#34; by 3 or 4 according to the key pressed,
- and return the subsequent characters next time function is called.


Something like that:

int Win32PeekChar&#40;PerlIO *file,double delay,char *key&#41;
{

[...]
+      static int keySequence = 0;
+      static char[5] lastKeySequence;
[...]

again:
     if &#40;keyCount &gt; 0&#41; {
+        if &#40;keySequence&gt;0&#41; {
+             lastKey = lastKeySequence[keySequence];
+             keySequence--;
+             if &#40;keySequence == 0&#41; { keySequence = &#40;int&#41;
lastKeySequence[0]; }
+       }
             keyCount--;
             *key = lastKey;
      return TRUE;
}

[...]

    case KEY_EVENT:
[...]
+         if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_LEFT&#41; {
+                keySequence = 3;
+                lastKeySequence = {  3,     &#39;D&#39;, &#39;[&#39;, &#39;\e&#39;};       /*
&#39;\e[D&#39; /*
+                keyCount = 3*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
+               goto again;
+          }



 I&#39;d love to send you a real patch, if only I had a compiler that makes
ActiveState Perl happy... You wouldn&#39;t believe how much I need this fix.
See, my users won&#39;t use my perl killer-app CLI until it has
command-completion, and if I use ReadLine instead of &lt;STDIN&gt;, I get
completion but lose support for the arrow keys... Kafka perl, so to say :-&#41;


Regards,
Clement
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/151695/45988/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/45988">with headers</a>
<br />
<span class="downloadcontenttype">text/html 4.1k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-151696" href="/Public/Bug/Display.html?id=16538#txn-151696">#</a>      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;16&nbsp;07:28:33&nbsp;2005</span>
    <span class="description">jns [...] gellyfish.co.uk -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-151697" href="/Public/Bug/Display.html?id=16538#txn-151697">#</a>      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;16&nbsp;07:28:53&nbsp;2005</span>
    <span class="description">jns [...] gellyfish.co.uk -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-151698" href="/Public/Bug/Display.html?id=16538#txn-151698">#</a>      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;16&nbsp;09:03:42&nbsp;2005</span>
    <span class="description">jns [...] gellyfish.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re:  [cpan #16538] ReadKey Win32 contribution</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jonathan Stowe &lt;jns [...] gellyfish.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> C Barry &lt;klemobari [...] gmail.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> bug-TermReadKey [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 16 Dec 2005 14:02:18 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">RT-Send-Cc:</td>
    <td class="message-header-value"> </td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/151698/46013/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/46013">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, 2005-12-16 at 10:06, C Barry wrote: 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi Jonathan,
&gt;  
&gt; I&#39;d like to solve a portability problem in ReadKey.xs, while using
&gt; latest ActiveState Perl 5.8.
&gt;  
&gt; The Win32PeekChar routine makes some basic keys look like the null
&gt; byte. This is especially true with the arrow keys, and the
&gt; Home/End/PgUp/PgDn navigation keys. For example the left-arrow key
&gt; &#34;\e[D&#34; will look like &#34;\0&#34;, and the two other characters will never be
&gt; retrieved by subsequent calls to ReadKey.
&gt;  
&gt; As a direct consequence, ReadLine packages on Windows deliver a look
&gt; and feel that is inferior to plain &lt;STDIN&gt;, which ruins the whole idea
&gt; of using a ReadLine package... Windows users hardly use control keys
&gt; to move on a command-line, they use arrow keys and will think that
&gt; &#34;cursor doesn&#39;t work&#34;.
&gt;  
&gt; This is also described in this interesting 2001 discussion:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://qs321.pair.com/~monkads/?node_id=125648">http://qs321.pair.com/~monkads/?node_id=125648</a></span>
&gt;  
&gt;  
&gt; I believe that a solution would be to handle the case when
&gt; [record.Event.KeyEvent.wVirtualKeyCode] is one of the values in
&gt; &#40;VK_RIGHT, VK_LEFT, VK_UP, VK_DOWN, VK_HOME, VK_END, VK_PAGE_UP,
&gt; VK_PAGE_DOWN&#41;, 
&gt; - return the escape character,
&gt; - store the subsequent characters in a static array,
&gt; - multiply &#34;keyCount&#34; by 3 or 4 according to the key pressed,
&gt; - and return the subsequent characters next time function is called.
&gt;  
&gt;  
&gt; Something like that:
&gt;  
&gt; int Win32PeekChar&#40;PerlIO *file,double delay,char *key&#41;
&gt; {
&gt;  
&gt; [...]
&gt; +      static int keySequence = 0;
&gt; +      static char[5] lastKeySequence;
&gt; [...]
&gt;  
&gt; again:
&gt;      if &#40;keyCount &gt; 0&#41; {
&gt; +        if &#40;keySequence&gt;0&#41; {
&gt; +             lastKey = lastKeySequence[keySequence];
&gt; +             keySequence--;
&gt; +             if &#40;keySequence == 0&#41; { keySequence = &#40;int&#41;
&gt; lastKeySequence[0]; }
&gt; +       }
&gt;              keyCount--;
&gt;              *key = lastKey;
&gt;       return TRUE;
&gt; }
&gt; 
&gt; [...]
&gt;  
&gt;     case KEY_EVENT:
&gt; [...]
&gt; +         if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_LEFT&#41; {
&gt; +                keySequence = 3;
&gt; +                lastKeySequence = {  3,     &#39;D&#39;, &#39;[&#39;, &#39;\e&#39;};       /*
&gt; &#39;\e[D&#39; /*
&gt; +                keyCount = 3*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
&gt; +               goto again; 
&gt; +          }
&gt;  
&gt;  
&gt;  
&gt; I&#39;d love to send you a real patch, if only I had a compiler that makes
&gt; ActiveState Perl happy... You wouldn&#39;t believe how much I need this
&gt; fix. See, my users won&#39;t use my perl killer-app CLI until it has
&gt; command-completion, and if I use ReadLine instead of &lt;STDIN&gt;, I get
&gt; completion but lose support for the arrow keys... Kafka perl, so
&gt; to say :-&#41;
</div>
Hi,
thanks for this.  To be honest that part of the ReadKey.xs looks like it
might be unfinished in respect of the special key handling, but I had
been labouring under the misapprehension that this just worked under
windows as it does with other OS

The approach seems fine, just a simple matter of programming, however I
would be a little concerned that there may be programs out there that
are relying on the current behaviour, so I may have to think of a way to
get it to be switchable.

I don&#39;t have the same compiler as was used to build activeperl either -
I built my own perl using the VS2003 compiler and that works fine.  You
can download the standalone compiler from the MS site somewhere - there
are full instructions on compiling perl with a MS compiler in the perl
source distribution and on using the MS compiler to build modules there
are several articles on the perlmonks web site.

I don&#39;t know when I am going to get round to putting this in, would
would speed it up considerably would to get a list of all of the
control-keys that currently return null on windows with the virtual
key-code and the characters that the should return.

I am copying in the RT queue for TermReadKey so I can keep track of the
requests, if you could keep it in the CC if you reply it would be
useful.

Thanks again.


/J\

-- 
This e-mail is sponsored by <span class="clickylink"><a target="new" rel="nofollow" href="http://www.integration-house.com/">http://www.integration-house.com/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-151699" href="/Public/Bug/Display.html?id=16538#txn-151699">#</a>      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;16&nbsp;11:46:40&nbsp;2005</span>
    <span class="description">klemobari [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 16 Dec 2005 18:45:54 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> C Barry &lt;klemobari [...] gmail.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Jonathan Stowe &lt;jns [...] gellyfish.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #16538] ReadKey Win32 contribution</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> bug-TermReadKey [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">RT-Send-Cc:</td>
    <td class="message-header-value"> </td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/151699/46033/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/46033">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; I don&#39;t know when I am going to get round to putting this in, would
&gt; would speed it up considerably would to get a list of all of the
&gt; control-keys that currently return null on windows with the virtual
&gt; key-code and the characters that the should return.
</div>


OK, let&#39;s speed it up considerably :-&#41;

**
*Keys that currently return 0 as AsciiChar:*
*----------------------------------------------------------------*
&#40;VirtualKeyCodes from google search for &#34;VK_LEFT VK_RIGHT&#34;&#41;

 - Arrow keys:   VK_LEFT, VK_RIGHT, VK_UP, VK_DOWN
- Function keys:   VK_HOME, VK_END
VK_PAGE_UP, VK_PAGE_DOWN,
 VK_DELETE, VK_INSERT,

VK_F1, ... , VK_F12

*Characters that they should return *
*------------------------------------------------------*
&#40;based on Term::ReadLine::Zoid::Base.pm +  a capture of my keyboard strokes
to a dumb telnet server&#41;

 &#34;\e[D&#34; =&gt; &#39;left&#39;,
 &#34;\e[C&#34; =&gt; &#39;right&#39;,
 &#34;\e[A&#34; =&gt; &#39;up&#39;,
 &#34;\e[B&#34; =&gt; &#39;down&#39;,
 &#34;\e[1~&#34;  =&gt; &#39;home&#39;,
 &#34;\e[4~&#34;  =&gt; &#39;end&#39;,
 &#34;\e[5~&#34;  =&gt; &#39;page_up&#39;,
 &#34;\e[6~&#34;  =&gt; &#39;page_down&#39;,
 &#34;\e[2~&#34;  =&gt; &#39;insert&#39;,
 &#34;\e[3~&#34;  =&gt; &#39;delete&#39;,
&#40;Note: VK_DELETE in cmd.exe/telnet behaves like BS for me &#40;chr&#40;127&#41;&#41;&#41;
 &#34;\eOP&#34; =&gt; &#39;f1&#39;,
 &#34;\eOQ&#34; =&gt; &#39;f2&#39;,
 &#34;\eOR&#34; =&gt; &#39;f3&#39;,
 &#34;\eOS&#34; =&gt; &#39;f4&#39;,
 &#34;\e[15~&#34; =&gt; &#39;f5&#39;,
 &#34;\e[17~&#34; =&gt; &#39;f6&#39;,
 &#34;\e[18~&#34; =&gt; &#39;f7&#39;,
 &#34;\e[19~&#34; =&gt; &#39;f8&#39;,
 &#34;\e[20~&#34; =&gt; &#39;f9&#39;,
 &#34;\e[21~&#34; =&gt; &#39;f10&#39;,
 &#34;\e[23~&#34; =&gt; &#39;f11&#39;,
 &#34;\e[24~&#34; =&gt; &#39;f12&#39;
&#40;Note: I just realized that F5-F12 are 5 characters, this means static
char[]  lastkeySequence length in my previous e-mail should be 6 and not 5.&#41;

No idea about VK_SCROLL_LOCK, VK_PRINTSCREEN, VK_PAUSE: they were caught by
Windows before the telnet client could sense them, and this ReadLine
module doesn&#39;t mention them either. I guess ReadKey can afford ignoring them
too.


*Snippet to test this:*
------------------------------

use Win32::Console::ANSI;
use Term::ReadLine::Zoid;
my $OUT = new Win32::Console&#40;STD_OUTPUT_HANDLE&#41;;


        my $term = Term::ReadLine::Zoid-&gt;new&#40;&#34;my app&#34;&#41;;
        my $prompt = &#34;Your command# &#34;;
        my $OUT = $term-&gt;OUT || \*STDOUT;
        while &#40; defined &#40;$_ = $term-&gt;readline&#40;$prompt&#41;&#41; &#41; {
                # Think while &#40;&lt;STDIN&gt;&#41; {}
                my $res = eval&#40;$_&#41;;
                warn $@ if $@;
                print $OUT $res, &#34;\n&#34; unless $@;
        }

As for the standalone compiler, I never used the Perl/C XS interface nor a
compiler in Windows... To be honest, I think I would &#34;slow it down
considerably&#34; ;-&#41;

Please let me know if you really can&#39;t get round to putting this,

Regards,
Clement.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/151699/46034/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/46034">with headers</a>
<br />
<span class="downloadcontenttype">text/html 4.3k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-155329" href="/Public/Bug/Display.html?id=16538#txn-155329">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;13&nbsp;07:09:04&nbsp;2006</span>
    <span class="description">klemobari [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> bug-TermReadKey [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #16538] ReadKey Win32 contribution</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 13 Jan 2006 14:08:11 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Jonathan Stowe &lt;jns [...] gellyfish.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> C Barry &lt;klemobari [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/155329/47527/ReadKey.xs">Download ReadKey.xs</a><br />
<span class="downloadcontenttype">text/x-csrc 48.1k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/155329/47525/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/47525">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 9.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

I got the arrow keys to respond under Windows!
It works like a charm, the readline-zoid snippet handles them as expected.

Source code for Win32PeekChar&#40;&#41; is reproduced below, as well as in attached
ReadKey.xs.

Function keys were also covered: they just cause the snippet to print
&#34;f1&#34;,&#34;f5&#34;, etc.

Regards
Clement Barry


int Win32PeekChar&#40;PerlIO *file,double delay,char *key&#41;
{
 int handle;
 HANDLE whnd;
 INPUT_RECORD record;
 DWORD readRecords;

 static int keyCount = 0;
 static char lastKey = 0;
static int keySequence = 0;
static char lastKeySequence[6];


 file = STDIN;

 handle = PerlIO_fileno&#40;file&#41;;
 whnd = /*GetStdHandle&#40;STD_INPUT_HANDLE&#41;*/&#40;HANDLE&#41;_get_osfhandle&#40;handle&#41;;


again:
 if &#40;keyCount &gt; 0&#41; {

  if &#40;keySequence&gt;0&#41; {
   lastKey = lastKeySequence[keySequence];
   keySequence--;
   if &#40;keySequence == 0&#41; {
    keySequence = &#40;int&#41; lastKeySequence[0];
   }
  }


  keyCount--;
  *key = lastKey;
     return TRUE;
 }

 if &#40;delay &gt; 0&#41; {
  if &#40;WaitForSingleObject&#40;whnd, delay * 1000.0&#41; != WAIT_OBJECT_0&#41;
  {
   return FALSE;
  }
 }

 if &#40;delay != 0&#41; {
  PeekConsoleInput&#40;whnd, &#38;record, 1, &#38;readRecords&#41;;
  if &#40;readRecords == 0&#41;
   return&#40;FALSE&#41;;
 }

 ReadConsoleInput&#40;whnd, &#38;record, 1, &#38;readRecords&#41;;
 switch&#40;record.EventType&#41;
   {
    case KEY_EVENT:
  /*printf&#40;&#34;\nkeyDown = %d, repeat = %d, vKey = %d, vScan = %d, ASCII = %d,
Control = %d\n&#34;,
   record.Event.KeyEvent.bKeyDown,
   record.Event.KeyEvent.wRepeatCount,
   record.Event.KeyEvent.wVirtualKeyCode,
   record.Event.KeyEvent.wVirtualScanCode,
   record.Event.KeyEvent.uChar.AsciiChar,
   record.Event.KeyEvent.dwControlKeyState&#41;;*/

         if &#40;record.Event.KeyEvent.bKeyDown == FALSE&#41;
            goto again;                        /* throw away KeyUp events */

 if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_LEFT&#41; {
  keySequence = 3;
  lastKeySequence[0] = 3;   /* ESCAPE LEFT-SQUARE-BRACKET D */
  lastKeySequence[1] = &#39;D&#39;;
  lastKeySequence[2] = &#39;[&#39;;
  lastKeySequence[3] = 27;
  keyCount = 3*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
  goto again;
 }

 if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_RIGHT&#41; {
  keySequence = 3;
  lastKeySequence[0] = 3;   /* ESCAPE LEFT-SQUARE-BRACKET C */
  lastKeySequence[1] = &#39;C&#39;;
  lastKeySequence[2] = &#39;[&#39;;
  lastKeySequence[3] = 27;
  keyCount = 3*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
  goto again;
 }

 if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_UP&#41; {
  keySequence = 3;
  lastKeySequence[0] = 3;   /* ESCAPE LEFT-SQUARE-BRACKET A */
  lastKeySequence[1] = &#39;A&#39;;
  lastKeySequence[2] = &#39;[&#39;;
  lastKeySequence[3] = 27;
  keyCount = 3*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
  goto again;
 }

 if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_DOWN&#41; {
  keySequence = 3;
  lastKeySequence[0] = 3;   /* ESCAPE LEFT-SQUARE-BRACKET B */
  lastKeySequence[1] = &#39;B&#39;;
  lastKeySequence[2] = &#39;[&#39;;
  lastKeySequence[3] = 27;
  keyCount = 3*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
  goto again;
 }



 if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_HOME&#41; {
  keySequence = 4;
  lastKeySequence[0] = 4;   /* ESCAPE LEFT-SQUARE-BRACKET 1 TILDA */
  lastKeySequence[1] = &#39;~&#39;;
  lastKeySequence[2] = &#39;1&#39;;
  lastKeySequence[3] = &#39;[&#39;;
  lastKeySequence[4] = 27;
  keyCount = 4*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
  goto again;
 }

 if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_END&#41; {
  keySequence = 4;
  lastKeySequence[0] = 4;   /* ESCAPE LEFT-SQUARE-BRACKET 4 TILDA */
  lastKeySequence[1] = &#39;~&#39;;
  lastKeySequence[2] = &#39;4&#39;;
  lastKeySequence[3] = &#39;[&#39;;
  lastKeySequence[4] = 27;
  keyCount = 4*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
  goto again;
 }

 if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_PRIOR&#41; { /* PAGE UP */
  keySequence = 4;
  lastKeySequence[0] = 4;   /* ESCAPE LEFT-SQUARE-BRACKET 5 TILDA */
  lastKeySequence[1] = &#39;~&#39;;
  lastKeySequence[2] = &#39;5&#39;;
  lastKeySequence[3] = &#39;[&#39;;
  lastKeySequence[4] = 27;
  keyCount = 4*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
  goto again;
 }

 if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_NEXT&#41; { /* PAGE DOWN */
  keySequence = 4;
  lastKeySequence[0] = 4;   /* ESCAPE LEFT-SQUARE-BRACKET 6 TILDA */
  lastKeySequence[1] = &#39;~&#39;;
  lastKeySequence[2] = &#39;6&#39;;
  lastKeySequence[3] = &#39;[&#39;;
  lastKeySequence[4] = 27;
  keyCount = 4*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
  goto again;
 }

 if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_INSERT&#41; {
  keySequence = 4;
  lastKeySequence[0] = 4;   /* ESCAPE LEFT-SQUARE-BRACKET 2 TILDA */
  lastKeySequence[1] = &#39;~&#39;;
  lastKeySequence[2] = &#39;2&#39;;
  lastKeySequence[3] = &#39;[&#39;;
  lastKeySequence[4] = 27;
  keyCount = 4*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
  goto again;
 }

 if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_DELETE&#41; {
  keySequence = 4;
  lastKeySequence[0] = 4;   /* ESCAPE LEFT-SQUARE-BRACKET 3 TILDA */
  lastKeySequence[1] = &#39;~&#39;;
  lastKeySequence[2] = &#39;3&#39;;
  lastKeySequence[3] = &#39;[&#39;;
  lastKeySequence[4] = 27;
  keyCount = 4*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
  goto again;
 }

 if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_F1&#41; {
  keySequence = 3;
  lastKeySequence[0] = 3;   /* ESCAPE O P */
  lastKeySequence[1] = &#39;P&#39;;
  lastKeySequence[2] = &#39;O&#39;;
  lastKeySequence[3] = 27;
  keyCount = 3*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
  goto again;
 }
 if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_F2&#41; {
  keySequence = 3;
  lastKeySequence[0] = 3;   /* ESCAPE O Q */
  lastKeySequence[1] = &#39;Q&#39;;
  lastKeySequence[2] = &#39;O&#39;;
  lastKeySequence[3] = 27;
  keyCount = 3*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
  goto again;
 }
 if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_F3&#41; {
  keySequence = 3;
  lastKeySequence[0] = 3;   /* ESCAPE O R */
  lastKeySequence[1] = &#39;R&#39;;
  lastKeySequence[2] = &#39;O&#39;;
  lastKeySequence[3] = 27;
  keyCount = 3*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
  goto again;
 }
 if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_F4&#41; {
  keySequence = 3;
  lastKeySequence[0] = 3;   /* ESCAPE O S */
  lastKeySequence[1] = &#39;S&#39;;
  lastKeySequence[2] = &#39;O&#39;;
  lastKeySequence[3] = 27;
  keyCount = 3*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
  goto again;
 }

 if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_F5&#41; {
  keySequence = 5;
  lastKeySequence[0] = 5;   /* ESCAPE LEFT-SQUARE-BRACKET 1 5 TILDA */
  lastKeySequence[1] = &#39;~&#39;;
  lastKeySequence[2] = &#39;5&#39;;
  lastKeySequence[3] = &#39;1&#39;;
  lastKeySequence[4] = &#39;[&#39;;
  lastKeySequence[5] = 27;
  keyCount = 5*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
  goto again;
 }
 if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_F6&#41; {
  keySequence = 5;
  lastKeySequence[0] = 5;   /* ESCAPE LEFT-SQUARE-BRACKET 1 7 TILDA */
  lastKeySequence[1] = &#39;~&#39;;
  lastKeySequence[2] = &#39;7&#39;;
  lastKeySequence[3] = &#39;1&#39;;
  lastKeySequence[4] = &#39;[&#39;;
  lastKeySequence[5] = 27;
  keyCount = 5*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
  goto again;
 }
 if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_F7&#41; {
  keySequence = 5;
  lastKeySequence[0] = 5;   /* ESCAPE LEFT-SQUARE-BRACKET 1 8 TILDA */
  lastKeySequence[1] = &#39;~&#39;;
  lastKeySequence[2] = &#39;8&#39;;
  lastKeySequence[3] = &#39;1&#39;;
  lastKeySequence[4] = &#39;[&#39;;
  lastKeySequence[5] = 27;
  keyCount = 5*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
  goto again;
 }
 if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_F8&#41; {
  keySequence = 5;
  lastKeySequence[0] = 5;   /* ESCAPE LEFT-SQUARE-BRACKET 1 9 TILDA */
  lastKeySequence[1] = &#39;~&#39;;
  lastKeySequence[2] = &#39;9&#39;;
  lastKeySequence[3] = &#39;1&#39;;
  lastKeySequence[4] = &#39;[&#39;;
  lastKeySequence[5] = 27;
  keyCount = 5*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
  goto again;
 }
 if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_F9&#41; {
  keySequence = 5;
  lastKeySequence[0] = 5;   /* ESCAPE LEFT-SQUARE-BRACKET 2 0 TILDA */
  lastKeySequence[1] = &#39;~&#39;;
  lastKeySequence[2] = &#39;0&#39;;
  lastKeySequence[3] = &#39;2&#39;;
  lastKeySequence[4] = &#39;[&#39;;
  lastKeySequence[5] = 27;
  keyCount = 5*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
  goto again;
 }
 if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_F10&#41; {
  keySequence = 5;
  lastKeySequence[0] = 5;   /* ESCAPE LEFT-SQUARE-BRACKET 2 1 TILDA */
  lastKeySequence[1] = &#39;~&#39;;
  lastKeySequence[2] = &#39;1&#39;;
  lastKeySequence[3] = &#39;2&#39;;
  lastKeySequence[4] = &#39;[&#39;;
  lastKeySequence[5] = 27;
  keyCount = 5*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
  goto again;
 }
 if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_F11&#41; {
  keySequence = 5;
  lastKeySequence[0] = 5;   /* ESCAPE LEFT-SQUARE-BRACKET 2 3 TILDA */
  lastKeySequence[1] = &#39;~&#39;;
  lastKeySequence[2] = &#39;3&#39;;
  lastKeySequence[3] = &#39;2&#39;;
  lastKeySequence[4] = &#39;[&#39;;
  lastKeySequence[5] = 27;
  keyCount = 5*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
  goto again;
 }
 if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_F12&#41; {
  keySequence = 5;
  lastKeySequence[0] = 5;   /* ESCAPE LEFT-SQUARE-BRACKET 2 4 TILDA */
  lastKeySequence[1] = &#39;~&#39;;
  lastKeySequence[2] = &#39;4&#39;;
  lastKeySequence[3] = &#39;2&#39;;
  lastKeySequence[4] = &#39;[&#39;;
  lastKeySequence[5] = 27;
  keyCount = 5*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
  goto again;
 }

         if &#40;record.Event.KeyEvent.wVirtualKeyCode == 16
         ||  record.Event.KeyEvent.wVirtualKeyCode == 17
         ||  record.Event.KeyEvent.wVirtualKeyCode == 18
         ||  record.Event.KeyEvent.wVirtualKeyCode == 20
         ||  record.Event.KeyEvent.wVirtualKeyCode == 144
         ||  record.Event.KeyEvent.wVirtualKeyCode == 145&#41;
            goto again;  /* throw away shift/alt/ctrl key only key events */
         keyCount = record.Event.KeyEvent.wRepeatCount;
   break;
    default:
         keyCount = 0;
         goto again;
         break;
   }

 *key = lastKey = record.Event.KeyEvent.uChar.AsciiChar;
 keyCount--;

 return&#40;TRUE&#41;;

 /* again:
 return &#40;FALSE&#41;;
 */


}
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/155329/47526/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/47526">with headers</a>
<br />
<span class="downloadcontenttype">text/html 13.9k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-155489" href="/Public/Bug/Display.html?id=16538#txn-155489">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;13&nbsp;12:11:10&nbsp;2006</span>
    <span class="description">jns [...] gellyfish.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> bug-TermReadKey [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #16538] ReadKey Win32 contribution</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 13 Jan 2006 17:09:15 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> C Barry &lt;klemobari [...] gmail.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jonathan Stowe &lt;jns [...] gellyfish.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/155489/47591/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/47591">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 10.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, 2006-01-13 at 12:08, C Barry wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi,
&gt;  
&gt; I got the arrow keys to respond under Windows!
&gt; It works like a charm, the readline-zoid snippet handles them as
&gt; expected.
&gt;  
&gt; Source code for Win32PeekChar&#40;&#41; is reproduced below, as well as in
&gt; attached ReadKey.xs.
&gt;  
&gt; Function keys were also covered: they just cause the snippet to print
&gt; &#34;f1&#34;,&#34;f5&#34;, etc.
&gt;  
</div>
Thanks for this.  I have taken the liberty of changing your if
statements into a big switch and moving a few things round, but it seems
to work, if you get a minute would you mind testing with the attached?
If it works for you then I&#39;ll do the rest of the changes and make a
release some time over the weekend.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Regards
&gt; Clement Barry
&gt;  
&gt;  
&gt; int Win32PeekChar&#40;PerlIO *file,double delay,char *key&#41;
&gt; {
&gt;  int handle;
&gt;  HANDLE whnd;
&gt;  INPUT_RECORD record;
&gt;  DWORD readRecords;
&gt; 
&gt;  static int keyCount = 0;
&gt;  static char lastKey = 0;
&gt; static int keySequence = 0;
&gt; static char lastKeySequence[6];
&gt; 
&gt; 
&gt;  file = STDIN;
&gt; 
&gt;  handle = PerlIO_fileno&#40;file&#41;;
&gt;  whnd =
&gt; /*GetStdHandle&#40;STD_INPUT_HANDLE&#41;*/&#40;HANDLE&#41;_get_osfhandle&#40;handle&#41;;
&gt; 
&gt; 
&gt; again:
&gt;  if &#40;keyCount &gt; 0&#41; {
&gt; 
&gt;   if &#40;keySequence&gt;0&#41; {
&gt;    lastKey = lastKeySequence[keySequence];
&gt;    keySequence--;
&gt;    if &#40;keySequence == 0&#41; { 
&gt;     keySequence = &#40;int&#41; lastKeySequence[0]; 
&gt;    }
&gt;   } 
&gt; 
&gt; 
&gt;   keyCount--;
&gt;   *key = lastKey;
&gt;      return TRUE;
&gt;  }
&gt; 
&gt;  if &#40;delay &gt; 0&#41; {
&gt;   if &#40;WaitForSingleObject&#40;whnd, delay * 1000.0&#41; != WAIT_OBJECT_0&#41;
&gt;   {
&gt;    return FALSE;
&gt;   }
&gt;  }
&gt; 
&gt;  if &#40;delay != 0&#41; {
&gt;   PeekConsoleInput&#40;whnd, &#38;record, 1, &#38;readRecords&#41;;
&gt;   if &#40;readRecords == 0&#41;
&gt;    return&#40;FALSE&#41;;
&gt;  }
&gt; 
&gt;  ReadConsoleInput&#40;whnd, &#38;record, 1, &#38;readRecords&#41;;
&gt;  switch&#40;record.EventType&#41;
&gt;    {
&gt;     case KEY_EVENT:
&gt;   /*printf&#40;&#34;\nkeyDown = %d, repeat = %d, vKey = %d, vScan = %d, ASCII
&gt; = %d, Control = %d\n&#34;, 
&gt;    record.Event.KeyEvent.bKeyDown,
&gt;    record.Event.KeyEvent.wRepeatCount,
&gt;    record.Event.KeyEvent.wVirtualKeyCode,
&gt;    record.Event.KeyEvent.wVirtualScanCode,
&gt;    record.Event.KeyEvent.uChar.AsciiChar,
&gt;     record.Event.KeyEvent.dwControlKeyState&#41;;*/
&gt; 
&gt;          if &#40;record.Event.KeyEvent.bKeyDown == FALSE&#41;
&gt;             goto again;                        /* throw away KeyUp
&gt; events */
&gt; 
&gt;  if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_LEFT&#41; {
&gt;   keySequence = 3;
&gt;   lastKeySequence[0] = 3;   /* ESCAPE LEFT-SQUARE-BRACKET D */
&gt;   lastKeySequence[1] = &#39;D&#39;; 
&gt;   lastKeySequence[2] = &#39;[&#39;; 
&gt;   lastKeySequence[3] = 27; 
&gt;   keyCount = 3*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
&gt;   goto again;
&gt;  }
&gt; 
&gt;  if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_RIGHT&#41; {
&gt;   keySequence = 3;
&gt;   lastKeySequence[0] = 3;   /* ESCAPE LEFT-SQUARE-BRACKET C */
&gt;   lastKeySequence[1] = &#39;C&#39;;
&gt;   lastKeySequence[2] = &#39;[&#39;;
&gt;   lastKeySequence[3] = 27; 
&gt;   keyCount = 3*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
&gt;   goto again;
&gt;  }
&gt; 
&gt;  if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_UP&#41; {
&gt;   keySequence = 3;
&gt;   lastKeySequence[0] = 3;   /* ESCAPE LEFT-SQUARE-BRACKET A */
&gt;   lastKeySequence[1] = &#39;A&#39;;
&gt;   lastKeySequence[2] = &#39;[&#39;;
&gt;   lastKeySequence[3] = 27; 
&gt;   keyCount = 3*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
&gt;   goto again;
&gt;  }
&gt; 
&gt;  if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_DOWN&#41; {
&gt;   keySequence = 3;
&gt;   lastKeySequence[0] = 3;   /* ESCAPE LEFT-SQUARE-BRACKET B */
&gt;   lastKeySequence[1] = &#39;B&#39;;
&gt;   lastKeySequence[2] = &#39;[&#39;; 
&gt;   lastKeySequence[3] = 27; 
&gt;   keyCount = 3*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
&gt;   goto again;
&gt;  }
&gt; 
&gt;  
&gt; 
&gt;  if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_HOME&#41; {
&gt;   keySequence = 4;
&gt;   lastKeySequence[0] = 4;   /* ESCAPE LEFT-SQUARE-BRACKET 1 TILDA */
&gt;   lastKeySequence[1] = &#39;~&#39;;
&gt;   lastKeySequence[2] = &#39;1&#39;;
&gt;   lastKeySequence[3] = &#39;[&#39;; 
&gt;   lastKeySequence[4] = 27;
&gt;   keyCount = 4*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
&gt;   goto again;
&gt;  }
&gt; 
&gt;  if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_END&#41; {
&gt;   keySequence = 4;
&gt;   lastKeySequence[0] = 4;   /* ESCAPE LEFT-SQUARE-BRACKET 4 TILDA */
&gt;   lastKeySequence[1] = &#39;~&#39;;
&gt;   lastKeySequence[2] = &#39;4&#39;;
&gt;   lastKeySequence[3] = &#39;[&#39;; 
&gt;   lastKeySequence[4] = 27;
&gt;   keyCount = 4*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
&gt;   goto again;
&gt;  }
&gt; 
&gt;  if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_PRIOR&#41; { /* PAGE UP
&gt; */
&gt;   keySequence = 4;
&gt;   lastKeySequence[0] = 4;   /* ESCAPE LEFT-SQUARE-BRACKET 5 TILDA */
&gt;   lastKeySequence[1] = &#39;~&#39;;
&gt;   lastKeySequence[2] = &#39;5&#39;; 
&gt;   lastKeySequence[3] = &#39;[&#39;; 
&gt;   lastKeySequence[4] = 27;
&gt;   keyCount = 4*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
&gt;   goto again;
&gt;  }
&gt; 
&gt;  if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_NEXT&#41; { /* PAGE DOWN
&gt; */
&gt;   keySequence = 4;
&gt;   lastKeySequence[0] = 4;   /* ESCAPE LEFT-SQUARE-BRACKET 6 TILDA */
&gt;   lastKeySequence[1] = &#39;~&#39;;
&gt;   lastKeySequence[2] = &#39;6&#39;; 
&gt;   lastKeySequence[3] = &#39;[&#39;; 
&gt;   lastKeySequence[4] = 27;
&gt;   keyCount = 4*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
&gt;   goto again;
&gt;  }
&gt; 
&gt;  if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_INSERT&#41; {
&gt;   keySequence = 4;
&gt;   lastKeySequence[0] = 4;   /* ESCAPE LEFT-SQUARE-BRACKET 2 TILDA */
&gt;   lastKeySequence[1] = &#39;~&#39;;
&gt;   lastKeySequence[2] = &#39;2&#39;;
&gt;   lastKeySequence[3] = &#39;[&#39;; 
&gt;   lastKeySequence[4] = 27;
&gt;   keyCount = 4*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
&gt;   goto again;
&gt;  }
&gt; 
&gt;  if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_DELETE&#41; {
&gt;   keySequence = 4;
&gt;   lastKeySequence[0] = 4;   /* ESCAPE LEFT-SQUARE-BRACKET 3 TILDA */
&gt;   lastKeySequence[1] = &#39;~&#39;;
&gt;   lastKeySequence[2] = &#39;3&#39;;
&gt;   lastKeySequence[3] = &#39;[&#39;; 
&gt;   lastKeySequence[4] = 27;
&gt;   keyCount = 4*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
&gt;   goto again;
&gt;  }
&gt; 
&gt;  if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_F1&#41; {
&gt;   keySequence = 3;
&gt;   lastKeySequence[0] = 3;   /* ESCAPE O P */
&gt;   lastKeySequence[1] = &#39;P&#39;; 
&gt;   lastKeySequence[2] = &#39;O&#39;; 
&gt;   lastKeySequence[3] = 27; 
&gt;   keyCount = 3*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
&gt;   goto again;
&gt;  }
&gt;  if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_F2&#41; {
&gt;   keySequence = 3;
&gt;   lastKeySequence[0] = 3;   /* ESCAPE O Q */
&gt;   lastKeySequence[1] = &#39;Q&#39;; 
&gt;   lastKeySequence[2] = &#39;O&#39;; 
&gt;   lastKeySequence[3] = 27;
&gt;   keyCount = 3*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
&gt;   goto again;
&gt;  }
&gt;  if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_F3&#41; {
&gt;   keySequence = 3; 
&gt;   lastKeySequence[0] = 3;   /* ESCAPE O R */
&gt;   lastKeySequence[1] = &#39;R&#39;; 
&gt;   lastKeySequence[2] = &#39;O&#39;; 
&gt;   lastKeySequence[3] = 27;
&gt;   keyCount = 3*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
&gt;   goto again;
&gt;  } 
&gt;  if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_F4&#41; {
&gt;   keySequence = 3;
&gt;   lastKeySequence[0] = 3;   /* ESCAPE O S */
&gt;   lastKeySequence[1] = &#39;S&#39;; 
&gt;   lastKeySequence[2] = &#39;O&#39;; 
&gt;   lastKeySequence[3] = 27; 
&gt;   keyCount = 3*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
&gt;   goto again;
&gt;  }
&gt; 
&gt;  if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_F5&#41; {
&gt;   keySequence = 5;
&gt;   lastKeySequence[0] = 5;   /* ESCAPE LEFT-SQUARE-BRACKET 1 5 TILDA */
&gt;   lastKeySequence[1] = &#39;~&#39;; 
&gt;   lastKeySequence[2] = &#39;5&#39;; 
&gt;   lastKeySequence[3] = &#39;1&#39;; 
&gt;   lastKeySequence[4] = &#39;[&#39;; 
&gt;   lastKeySequence[5] = 27;
&gt;   keyCount = 5*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
&gt;   goto again;
&gt;  }
&gt;  if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_F6&#41; { 
&gt;   keySequence = 5;
&gt;   lastKeySequence[0] = 5;   /* ESCAPE LEFT-SQUARE-BRACKET 1 7 TILDA */
&gt;   lastKeySequence[1] = &#39;~&#39;; 
&gt;   lastKeySequence[2] = &#39;7&#39;; 
&gt;   lastKeySequence[3] = &#39;1&#39;; 
&gt;   lastKeySequence[4] = &#39;[&#39;; 
&gt;   lastKeySequence[5] = 27;
&gt;   keyCount = 5*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
&gt;   goto again;
&gt;  }
&gt;  if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_F7&#41; {
&gt;   keySequence = 5;
&gt;   lastKeySequence[0] = 5;   /* ESCAPE LEFT-SQUARE-BRACKET 1 8 TILDA */
&gt;   lastKeySequence[1] = &#39;~&#39;; 
&gt;   lastKeySequence[2] = &#39;8&#39;; 
&gt;   lastKeySequence[3] = &#39;1&#39;; 
&gt;   lastKeySequence[4] = &#39;[&#39;; 
&gt;   lastKeySequence[5] = 27;
&gt;   keyCount = 5*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
&gt;   goto again; 
&gt;  }
&gt;  if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_F8&#41; {
&gt;   keySequence = 5;
&gt;   lastKeySequence[0] = 5;   /* ESCAPE LEFT-SQUARE-BRACKET 1 9 TILDA */
&gt;   lastKeySequence[1] = &#39;~&#39;; 
&gt;   lastKeySequence[2] = &#39;9&#39;; 
&gt;   lastKeySequence[3] = &#39;1&#39;; 
&gt;   lastKeySequence[4] = &#39;[&#39;; 
&gt;   lastKeySequence[5] = 27;
&gt;   keyCount = 5*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
&gt;   goto again;
&gt;  }
&gt;  if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_F9&#41; { 
&gt;   keySequence = 5;
&gt;   lastKeySequence[0] = 5;   /* ESCAPE LEFT-SQUARE-BRACKET 2 0 TILDA */
&gt;   lastKeySequence[1] = &#39;~&#39;; 
&gt;   lastKeySequence[2] = &#39;0&#39;; 
&gt;   lastKeySequence[3] = &#39;2&#39;; 
&gt;   lastKeySequence[4] = &#39;[&#39;; 
&gt;   lastKeySequence[5] = 27;
&gt;   keyCount = 5*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
&gt;   goto again;
&gt;  }
&gt;  if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_F10&#41; {
&gt;   keySequence = 5;
&gt;   lastKeySequence[0] = 5;   /* ESCAPE LEFT-SQUARE-BRACKET 2 1 TILDA */
&gt;   lastKeySequence[1] = &#39;~&#39;; 
&gt;   lastKeySequence[2] = &#39;1&#39;; 
&gt;   lastKeySequence[3] = &#39;2&#39;; 
&gt;   lastKeySequence[4] = &#39;[&#39;; 
&gt;   lastKeySequence[5] = 27;
&gt;   keyCount = 5*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
&gt;   goto again; 
&gt;  }
&gt;  if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_F11&#41; {
&gt;   keySequence = 5;
&gt;   lastKeySequence[0] = 5;   /* ESCAPE LEFT-SQUARE-BRACKET 2 3 TILDA */
&gt;   lastKeySequence[1] = &#39;~&#39;; 
&gt;   lastKeySequence[2] = &#39;3&#39;; 
&gt;   lastKeySequence[3] = &#39;2&#39;; 
&gt;   lastKeySequence[4] = &#39;[&#39;; 
&gt;   lastKeySequence[5] = 27;
&gt;   keyCount = 5*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
&gt;   goto again;
&gt;  }
&gt;  if &#40;record.Event.KeyEvent.wVirtualKeyCode == VK_F12&#41; { 
&gt;   keySequence = 5;
&gt;   lastKeySequence[0] = 5;   /* ESCAPE LEFT-SQUARE-BRACKET 2 4 TILDA */
&gt;   lastKeySequence[1] = &#39;~&#39;; 
&gt;   lastKeySequence[2] = &#39;4&#39;; 
&gt;   lastKeySequence[3] = &#39;2&#39;; 
&gt;   lastKeySequence[4] = &#39;[&#39;; 
&gt;   lastKeySequence[5] = 27;
&gt;   keyCount = 5*&#40;record.Event.KeyEvent.wRepeatCount&#41;;
&gt;   goto again;
&gt;  }
&gt; 
&gt;          if &#40;record.Event.KeyEvent.wVirtualKeyCode == 16
&gt;          ||  record.Event.KeyEvent.wVirtualKeyCode == 17
&gt;          ||  record.Event.KeyEvent.wVirtualKeyCode == 18
&gt;          ||  record.Event.KeyEvent.wVirtualKeyCode == 20
&gt;          ||  record.Event.KeyEvent.wVirtualKeyCode == 144
&gt;          ||  record.Event.KeyEvent.wVirtualKeyCode == 145&#41;
&gt;             goto again;  /* throw away shift/alt/ctrl key only key
&gt; events */
&gt;          keyCount = record.Event.KeyEvent.wRepeatCount;
&gt;    break;
&gt;     default:
&gt;          keyCount = 0;
&gt;          goto again;
&gt;          break;
&gt;    }
&gt; 
&gt;  *key = lastKey = record.Event.KeyEvent.uChar.AsciiChar; 
&gt;  keyCount--;
&gt;  
&gt;  return&#40;TRUE&#41;;
&gt; 
&gt;  /* again:
&gt;  return &#40;FALSE&#41;;
&gt;  */
&gt; 
&gt; 
&gt; }
</div>-- 

This e-mail is sponsored by <span class="clickylink"><a target="new" rel="nofollow" href="http://www.integration-house.com/">http://www.integration-house.com/</a></span>
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/155489/47592/ReadKey.xs">Download ReadKey.xs</a><br />
<span class="downloadcontenttype">text/x-csrc 48.4k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-155521" href="/Public/Bug/Display.html?id=16538#txn-155521">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;13&nbsp;12:42:19&nbsp;2006</span>
    <span class="description">klemobari [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> bug-TermReadKey [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #16538] ReadKey Win32 contribution</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 13 Jan 2006 19:41:36 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Jonathan Stowe &lt;jns [...] gellyfish.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> C Barry &lt;klemobari [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/155521/47611/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/47611">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">2006/1/13, Jonathan Stowe &lt;jns@gellyfish.com&gt;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Thanks for this.  I have taken the liberty of changing your if
&gt; statements into a big switch and moving a few things round, but it seems
&gt; to work, if you get a minute would you mind testing with the attached?
&gt; If it works for you then I&#39;ll do the rest of the changes and make a
&gt; release some time over the weekend.
</div>

You have a point here, Perl almost made me forget switch statements...
However I&#39;m a bit concerned about unifying control/shift/alt-keys and
arrow-keys under a same switch, especially in the absence of a default
label. The following line:

           keyCount = keySequence * &#40;record.Event.KeyEvent.wRepeatCount&#41;;

will be non-zero even for a simple pressure on Control. Maybe would it be
wiser to set keySequence back to 0 for cases 16, 17, 18, 20, 144, 145 and
default. The &#39;&#39;again&#39;&#39; label doesn&#39;t reset keySequence to zero, it resets to
3/4/5 because keyCount may be &gt;1.


Also, you may want to replace lines like these:

&lt;   keySequence = 3;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;   lastKeySequence[0] = 3;   /* ESCAPE LEFT-SQUARE-BRACKET D */
</div>

by those equivalent, less hardcoded lines:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;   keySequence = 3;
<div class="message-stanza open">&gt; &gt;   lastKeySequence[0] = keySequence;   /* ESCAPE LEFT-SQUARE-BRACKET D */
</div></div>

Basically I stored the int keySequence as a first character of
lastKeySequence everywhere, and retrieved it in the &#39;&#39;again&#39;&#39; label by a
casting to int type. A kind of very raw data structure.


I wait for your comment on that before I go back testing.


Regards,
Clement
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/155521/47612/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/47612">with headers</a>
<br />
<span class="downloadcontenttype">text/html 2.1k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-166807" href="/Public/Bug/Display.html?id=16538#txn-166807">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;20&nbsp;19:43:08&nbsp;2006</span>
    <span class="description">adamk [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/166807/53565/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/53565">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 319b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Just so you guys know, there&#39;s a new Win32 distribution on the way
called Vanilla Perl.

It&#39;s Perl compiled from scratch with &#40;and building in&#41; MinGW.

You might find it easier to test against this than you do ActivePerl.

To download a copy, see...

<span class="clickylink"><a target="new" rel="nofollow" href="http://sourceforge.net/project/showfiles.php?group_id=158775">http://sourceforge.net/project/showfiles.php?group_id=158775</a></span>

Thanks
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-168937" href="/Public/Bug/Display.html?id=16538#txn-168937">#</a>      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;27&nbsp;13:59:45&nbsp;2006</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> christopher [...] pobox.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/168937/54772/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/54772">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 191b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve got nothing to do with this module, but, if you want to send me 
your best guess at a patch, I can compile and test it and then submit 
it to Jonathan in a format he can use immediately.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-517352" href="/Public/Bug/Display.html?id=16538#txn-517352">#</a>      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;08&nbsp;07:19:31&nbsp;2008</span>
    <span class="description">jns [...] integration-house.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [perl #59690][cpan #16538] Term::ReadKey&#39;s Win32PeekChar doesn&#39;t support special keys</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 8 Oct 2008 12:18:39 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> perl5-porters [...] perl.org, bug-TermReadKey [...] rt.cpan.org, jerbraun [...] microsoft.com</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Jonathan Stowe&#34; &lt;jns [...] integration-house.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/517352/258122/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/258122">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 5.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Jeremy,
Term::ReadKey is not maintained as part of the Perl core. The ticket
#59690 can be closed.

I already have an ancient RT ticket  &#40;#16538&#41; against this same
feature request with a patch, I&#39;ve held off releasing this because I
haven&#39;t had the facilities to compile and test on Windows.

If someone could volunteer to help test a new release then I&#39;d be
happy to make the fix.



2008/10/7 via RT Jeremy Braun &lt;perlbug-followup@perl.org&gt;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; # New Ticket Created by  Jeremy Braun
&gt; # Please include the string:  [perl #59690]
&gt; # in the subject line of all future correspondence about this issue.
&gt; # &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.perl.org/rt3/Ticket/Display.html?id=59690">http://rt.perl.org/rt3/Ticket/Display.html?id=59690</a></span> &gt;
&gt;
&gt;
&gt; This is a bug report for perl from jerbraun@microsoft.com,
&gt; generated with the help of perlbug 1.36 running under perl 5.10.0.
&gt;
&gt;
&gt; -----------------------------------------------------------------
&gt; [Please enter your report here]
&gt;
&gt; In ReadKey.xs, Win32PeekChar only uses
&gt; record.Event.KeyEvent.uChar.AsciiChar to figure out the *key return
&gt; value.  For text this is okay, but special keys &#40;F1-Fx, HOME, PAGEUP,
&gt; PAGEDOWN, ARROWS, etc&#41; all set AsciiChar to zero.  In these cases, the
&gt; wVirtualKeyCode must be used to figure out what key was pressed.
&gt;
&gt; &#40;Perl&#39;s getc seems to have a similiar bug?&#41;
&gt;
&gt;
&gt; [Please do not change anything below this line]
&gt; -----------------------------------------------------------------
&gt; ---
&gt; Flags:
&gt;    category=library
&gt;    severity=medium
&gt; ---
&gt; Site configuration information for perl 5.10.0:
&gt;
&gt; Configured by SYSTEM at Tue May 13 16:52:25 2008.
&gt;
&gt; Summary of my perl5 &#40;revision 5 version 10 subversion 0&#41; configuration:
&gt;  Platform:
&gt;    osname=MSWin32, osvers=5.00, archname=MSWin32-x86-multi-thread
&gt;    uname=&#39;&#39;
&gt;    config_args=&#39;undef&#39;
&gt;    hint=recommended, useposix=true, d_sigaction=undef
&gt;    useithreads=define, usemultiplicity=define
&gt;    useperlio=define, d_sfio=undef, uselargefiles=define, usesocks=undef
&gt;    use64bitint=undef, use64bitall=undef, uselongdouble=undef
&gt;    usemymalloc=n, bincompat5005=undef
&gt;  Compiler:
&gt;    cc=&#39;cl&#39;, ccflags =&#39;-nologo -GF -W3 -MD -Zi -DNDEBUG -O1 -DWIN32 -D_CONSOLE -DNO_STRICT -DHAVE_DES_FCRYPT -DUSE_SITECUSTOMIZE -DPRIVLIB_LAST_IN_INC -DPERL_IMPLICIT_CONTEXT -DPERL_IMPLICIT_SYS -DUSE_PERLIO -DPERL_MSVCRT_READFIX&#39;,
&gt;    optimize=&#39;-MD -Zi -DNDEBUG -O1&#39;,
&gt;    cppflags=&#39;-DWIN32&#39;
&gt;    ccversion=&#39;14.1.60511&#39;, gccversion=&#39;&#39;, gccosandvers=&#39;&#39;
&gt;    intsize=4, longsize=4, ptrsize=4, doublesize=8, byteorder=1234
&gt;    d_longlong=undef, longlongsize=8, d_longdbl=define, longdblsize=10
&gt;    ivtype=&#39;long&#39;, ivsize=4, nvtype=&#39;double&#39;, nvsize=8, Off_t=&#39;__int64&#39;, lseeksize=8
&gt;    alignbytes=8, prototype=define
&gt;  Linker and Libraries:
&gt;    ld=&#39;link&#39;, ldflags =&#39;-nologo -nodefaultlib -debug -opt:ref,icf  -libpath:&#34;D:\sd\pyxis\source\40\zune\tools\perl\lib\CORE&#34;  -machine:x86&#39;
&gt;    libpth=\lib
&gt;    libs=  oldnames.lib kernel32.lib user32.lib gdi32.lib winspool.lib  comdlg32.lib advapi32.lib shell32.lib ole32.lib oleaut32.lib  netapi32.lib uuid.lib ws2_32.lib mpr.lib winmm.lib  version.lib odbc32.lib odbccp32.lib msvcrt.lib
&gt;    perllibs=  oldnames.lib kernel32.lib user32.lib gdi32.lib winspool.lib  comdlg32.lib advapi32.lib shell32.lib ole32.lib oleaut32.lib  netapi32.lib uuid.lib ws2_32.lib mpr.lib winmm.lib  version.lib odbc32.lib odbccp32.lib msvcrt.lib
&gt;    libc=msvcrt.lib, so=dll, useshrplib=true, libperl=perl510.lib
&gt;    gnulibc_version=&#39;&#39;
&gt;  Dynamic Linking:
&gt;    dlsrc=dl_win32.xs, dlext=dll, d_dlsymun=undef, ccdlflags=&#39; &#39;
&gt;    cccdlflags=&#39; &#39;, lddlflags=&#39;-dll -nologo -nodefaultlib -debug -opt:ref,icf  -libpath:&#34;D:\sd\pyxis\source\40\zune\tools\perl\lib\CORE&#34;  -machine:x86&#39;
&gt;
&gt; Locally applied patches:
&gt;    ACTIVEPERL_LOCAL_PATCHES_ENTRY
&gt;    33741 avoids segfaults invoking S_raise_signal&#40;&#41; &#40;on Linux&#41;
&gt;    33763 Win32 process ids can have more than 16 bits
&gt;    32809 Load &#39;loadable object&#39; with non-default file extension
&gt;    32728 64-bit fix for Time::Local
&gt;
&gt; ---
&gt; @INC for perl 5.10.0:
&gt;    D:/sd/pyxis/source/40/zune/tools/perl/site/lib
&gt;    D:/sd/pyxis/source/40/zune/tools/perl/lib
&gt;    .
&gt;
&gt; ---
&gt; Environment for perl 5.10.0:
&gt;    HOME=C:\Users\jerbraun
&gt;    LANG &#40;unset&#41;
&gt;    LANGUAGE &#40;unset&#41;
&gt;    LD_LIBRARY_PATH &#40;unset&#41;
&gt;    LOGDIR &#40;unset&#41;
&gt;    PATH=D:\sd\pyxis\source\40\sdk\bin\i386\ARM;D:\sd\pyxis\source\40\sdk\bin\i386;D:\sd\pyxis\source\40\public\common\oak\Bin\i386;D:\sd\pyxis\source\40\private\bin\i386;D:\sd\pyxis\source\40\private\bat;D:\sd\pyxis\source\40\public\common\oak\misc;D:\sd\pyxis\source\40\developr\jerbraun;C:\Python25\;C:\Windows\system32;C:\Windows;C:\Windows\System32\Wbem;D:\sd\pyxis\source\40\zune\developer\jerbraun\bin;C:\PROGRA~1\NcFTP;C:\Program Files\Microsoft Application Virtualization Client;C:\Program Files\Microsoft Network Monitor 3\;C:\Windows\system32\WindowsPowerShell\v1.0\;D:\sd\pyxis\source\40\platform\WOOKIE;D:\sd\pyxis\source\40\platform\WOOKIE\tools\bin\i386;D:\sd\pyxis\source\40\platform\WOOKIE\tools\nvflash\bin\i386;D:\sd\pyxis\source\40\platform\WOOKIE\tools\buildbct\bin\i386;D:\sd\pyxis\source\40\zune\tools\bin\i386;D:\sd\pyxis\source\40\zune\tools\bat;D:\sd\pyxis\source\40\zune\tools\perl\bin;D:\sd\pyxis\source\40\zune\tools\perl\site\bin;C:\Program Files\GnuWin32\bin!
&gt;  ;c:\Python25;F:\sd\xbox\cadence\tools\bin;D:\sd\pyxis\source\40\zune\tools\env;C:\Cadence\SPB_16.01\tools\specctra\bin;C:\Cadence\SPB_16.01\tools\pcb\bin;C:\Cadence\SPB_16.01\tools\bin;C:\Cadence\SPB_16.01\tools\libutil\bin;C:\Cadence\SPB_16.01\tools\fet\bin
&gt;    PERLDOC_NROFF=groff -E -mtty-char -Tascii -P-c
&gt;    PERL_BADLANG &#40;unset&#41;
&gt;    SHELL &#40;unset&#41;
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-517479" href="/Public/Bug/Display.html?id=16538#txn-517479">#</a>      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;08&nbsp;12:45:37&nbsp;2008</span>
    <span class="description">jerbraun [...] microsoft.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [perl #59690][cpan #16538] Term::ReadKey&#39;s Win32PeekChar doesn&#39;t support special keys</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 8 Oct 2008 09:45:06 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Jonathan Stowe &lt;jns [...] integration-house.com&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jeremy Braun &lt;jerbraun [...] microsoft.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/517479/258193/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/258193">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 8.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks Jonathan, incredible turn-around time!

I compiled/tested this with visualstudio 9, and it worked* well.

If you want &#40;for clarity&#41;, the key codes are available as VK_* in foo.h.  Please find below a modified portion of Win32PeekChar.

Also, your email address is out of date in the pod for ReadKey.pm.

Thanks again!

*- Microsoft added run-time parameter checking to all of the exports from the MS Visual C Runtime.  If &#34;invalid&#34; parameters are passed to a c-runtime function &#40;like _get_osfhandle&#41;, rather than return an error code, the c-runtime by default causes an AV and you get a &#34;this program has stopped working&#34; dialog box.  I modified every API entry to call _set_invalid_parameter_handler, and things worked great.


        switch&#40;record.EventType&#41;
        {
        case KEY_EVENT:
                /* printf&#40;&#34;\nkeyDown = %d, repeat = %d, vKey = %d, vScan = %d, ASCII = %d, Control = %d\n&#34;,
                        record.Event.KeyEvent.bKeyDown,
                        record.Event.KeyEvent.wRepeatCount,
                        record.Event.KeyEvent.wVirtualKeyCode,
                        record.Event.KeyEvent.wVirtualScanCode,
                        record.Event.KeyEvent.uChar.AsciiChar,
                        record.Event.KeyEvent.dwControlKeyState&#41;; */

         if &#40;record.Event.KeyEvent.bKeyDown == FALSE&#41;
            goto again;                        /* throw away KeyUp events */

         switch&#40;record.Event.KeyEvent.wVirtualKeyCode&#41; {
                case VK_SHIFT: case VK_LSHIFT: case VK_RSHIFT:
                case VK_CONTROL: case VK_LCONTROL: case VK_RCONTROL:
                case VK_MENU: case VK_LMENU: case VK_RMENU:
                case VK_CAPITAL: case VK_NUMLOCK: case VK_SCROLL:
                    /* throw away shift/alt/ctrl key only key events */
                    goto again;
                case VK_UP:     KEY_PUSH3&#40;27, 91, 65&#41;;
                case VK_DOWN:   KEY_PUSH3&#40;27, 91, 66&#41;;
                case VK_RIGHT:  KEY_PUSH3&#40;27, 91, 67&#41;;
                case VK_LEFT:   KEY_PUSH3&#40;27, 91, 68&#41;;
                case VK_PRIOR:  KEY_PUSH3&#40;27, 79, 121&#41;;
        case VK_NEXT:   KEY_PUSH3&#40;27, 79, 115&#41;;
                case VK_HOME:   KEY_PUSH4&#40;27, 91, 49, 126&#41;;
                case VK_INSERT: KEY_PUSH4&#40;27, 91, 50, 126&#41;;
        case VK_DELETE: KEY_PUSH4&#40;27, 91, 51, 126&#41;;
        case VK_END:    KEY_PUSH4&#40;27, 91, 52, 126&#41;;
         }

         keyCount = record.Event.KeyEvent.wRepeatCount;
         break;
    default:
         keyCount = 0;
         goto again;
         break;
   }


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: jonathan.stowe@gmail.com [mailto:jonathan.stowe@gmail.com] On Behalf Of Jonathan Stowe
Sent: Wednesday, October 08, 2008 4:19 AM
To: perl5-porters@perl.org; bug-TermReadKey@rt.cpan.org; Jeremy Braun
Subject: Re: [perl #59690][cpan #16538] Term::ReadKey&#39;s Win32PeekChar doesn&#39;t support special keys

Hi Jeremy,
Term::ReadKey is not maintained as part of the Perl core. The ticket
#59690 can be closed.

I already have an ancient RT ticket  &#40;#16538&#41; against this same
feature request with a patch, I&#39;ve held off releasing this because I
haven&#39;t had the facilities to compile and test on Windows.

If someone could volunteer to help test a new release then I&#39;d be
happy to make the fix.



2008/10/7 via RT Jeremy Braun &lt;perlbug-followup@perl.org&gt;:
<div class="message-stanza open">&gt; # New Ticket Created by  Jeremy Braun
&gt; # Please include the string:  [perl #59690]
&gt; # in the subject line of all future correspondence about this issue.
&gt; # &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.perl.org/rt3/Ticket/Display.html?id=59690">http://rt.perl.org/rt3/Ticket/Display.html?id=59690</a></span> &gt;
&gt;
&gt;
&gt; This is a bug report for perl from jerbraun@microsoft.com,
&gt; generated with the help of perlbug 1.36 running under perl 5.10.0.
&gt;
&gt;
&gt; -----------------------------------------------------------------
&gt; [Please enter your report here]
&gt;
&gt; In ReadKey.xs, Win32PeekChar only uses
&gt; record.Event.KeyEvent.uChar.AsciiChar to figure out the *key return
&gt; value.  For text this is okay, but special keys &#40;F1-Fx, HOME, PAGEUP,
&gt; PAGEDOWN, ARROWS, etc&#41; all set AsciiChar to zero.  In these cases, the
&gt; wVirtualKeyCode must be used to figure out what key was pressed.
&gt;
&gt; &#40;Perl&#39;s getc seems to have a similiar bug?&#41;
&gt;
&gt;
&gt; [Please do not change anything below this line]
&gt; -----------------------------------------------------------------
&gt; ---
&gt; Flags:
&gt;    category=library
&gt;    severity=medium
&gt; ---
&gt; Site configuration information for perl 5.10.0:
&gt;
&gt; Configured by SYSTEM at Tue May 13 16:52:25 2008.
&gt;
&gt; Summary of my perl5 &#40;revision 5 version 10 subversion 0&#41; configuration:
&gt;  Platform:
&gt;    osname=MSWin32, osvers=5.00, archname=MSWin32-x86-multi-thread
&gt;    uname=&#39;&#39;
&gt;    config_args=&#39;undef&#39;
&gt;    hint=recommended, useposix=true, d_sigaction=undef
&gt;    useithreads=define, usemultiplicity=define
&gt;    useperlio=define, d_sfio=undef, uselargefiles=define, usesocks=undef
&gt;    use64bitint=undef, use64bitall=undef, uselongdouble=undef
&gt;    usemymalloc=n, bincompat5005=undef
&gt;  Compiler:
&gt;    cc=&#39;cl&#39;, ccflags =&#39;-nologo -GF -W3 -MD -Zi -DNDEBUG -O1 -DWIN32 -D_CONSOLE -DNO_STRICT -DHAVE_DES_FCRYPT -DUSE_SITECUSTOMIZE -DPRIVLIB_LAST_IN_INC -DPERL_IMPLICIT_CONTEXT -DPERL_IMPLICIT_SYS -DUSE_PERLIO -DPERL_MSVCRT_READFIX&#39;,
&gt;    optimize=&#39;-MD -Zi -DNDEBUG -O1&#39;,
&gt;    cppflags=&#39;-DWIN32&#39;
&gt;    ccversion=&#39;14.1.60511&#39;, gccversion=&#39;&#39;, gccosandvers=&#39;&#39;
&gt;    intsize=4, longsize=4, ptrsize=4, doublesize=8, byteorder=1234
&gt;    d_longlong=undef, longlongsize=8, d_longdbl=define, longdblsize=10
&gt;    ivtype=&#39;long&#39;, ivsize=4, nvtype=&#39;double&#39;, nvsize=8, Off_t=&#39;__int64&#39;, lseeksize=8
&gt;    alignbytes=8, prototype=define
&gt;  Linker and Libraries:
&gt;    ld=&#39;link&#39;, ldflags =&#39;-nologo -nodefaultlib -debug -opt:ref,icf  -libpath:&#34;D:\sd\pyxis\source\40\zune\tools\perl\lib\CORE&#34;  -machine:x86&#39;
&gt;    libpth=\lib
&gt;    libs=  oldnames.lib kernel32.lib user32.lib gdi32.lib winspool.lib  comdlg32.lib advapi32.lib shell32.lib ole32.lib oleaut32.lib  netapi32.lib uuid.lib ws2_32.lib mpr.lib winmm.lib  version.lib odbc32.lib odbccp32.lib msvcrt.lib
&gt;    perllibs=  oldnames.lib kernel32.lib user32.lib gdi32.lib winspool.lib  comdlg32.lib advapi32.lib shell32.lib ole32.lib oleaut32.lib  netapi32.lib uuid.lib ws2_32.lib mpr.lib winmm.lib  version.lib odbc32.lib odbccp32.lib msvcrt.lib
&gt;    libc=msvcrt.lib, so=dll, useshrplib=true, libperl=perl510.lib
&gt;    gnulibc_version=&#39;&#39;
&gt;  Dynamic Linking:
&gt;    dlsrc=dl_win32.xs, dlext=dll, d_dlsymun=undef, ccdlflags=&#39; &#39;
&gt;    cccdlflags=&#39; &#39;, lddlflags=&#39;-dll -nologo -nodefaultlib -debug -opt:ref,icf  -libpath:&#34;D:\sd\pyxis\source\40\zune\tools\perl\lib\CORE&#34;  -machine:x86&#39;
&gt;
&gt; Locally applied patches:
&gt;    ACTIVEPERL_LOCAL_PATCHES_ENTRY
&gt;    33741 avoids segfaults invoking S_raise_signal&#40;&#41; &#40;on Linux&#41;
&gt;    33763 Win32 process ids can have more than 16 bits
&gt;    32809 Load &#39;loadable object&#39; with non-default file extension
&gt;    32728 64-bit fix for Time::Local
&gt;
&gt; ---
&gt; @INC for perl 5.10.0:
&gt;    D:/sd/pyxis/source/40/zune/tools/perl/site/lib
&gt;    D:/sd/pyxis/source/40/zune/tools/perl/lib
&gt;    .
&gt;
&gt; ---
&gt; Environment for perl 5.10.0:
&gt;    HOME=C:\Users\jerbraun
&gt;    LANG &#40;unset&#41;
&gt;    LANGUAGE &#40;unset&#41;
&gt;    LD_LIBRARY_PATH &#40;unset&#41;
&gt;    LOGDIR &#40;unset&#41;
&gt;    PATH=D:\sd\pyxis\source\40\sdk\bin\i386\ARM;D:\sd\pyxis\source\40\sdk\bin\i386;D:\sd\pyxis\source\40\public\common\oak\Bin\i386;D:\sd\pyxis\source\40\private\bin\i386;D:\sd\pyxis\source\40\private\bat;D:\sd\pyxis\source\40\public\common\oak\misc;D:\sd\pyxis\source\40\developr\jerbraun;C:\Python25\;C:\Windows\system32;C:\Windows;C:\Windows\System32\Wbem;D:\sd\pyxis\source\40\zune\developer\jerbraun\bin;C:\PROGRA~1\NcFTP;C:\Program Files\Microsoft Application Virtualization Client;C:\Program Files\Microsoft Network Monitor 3\;C:\Windows\system32\WindowsPowerShell\v1.0\;D:\sd\pyxis\source\40\platform\WOOKIE;D:\sd\pyxis\source\40\platform\WOOKIE\tools\bin\i386;D:\sd\pyxis\source\40\platform\WOOKIE\tools\nvflash\bin\i386;D:\sd\pyxis\source\40\platform\WOOKIE\tools\buildbct\bin\i386;D:\sd\pyxis\source\40\zune\tools\bin\i386;D:\sd\pyxis\source\40\zune\tools\bat;D:\sd\pyxis\source\40\zune\tools\perl\bin;D:\sd\pyxis\source\40\zune\tools\perl\site\bin;C:\Program Files\GnuWin32\bin
</div> !
<div class="message-stanza open">&gt;  ;c:\Python25;F:\sd\xbox\cadence\tools\bin;D:\sd\pyxis\source\40\zune\tools\env;C:\Cadence\SPB_16.01\tools\specctra\bin;C:\Cadence\SPB_16.01\tools\pcb\bin;C:\Cadence\SPB_16.01\tools\bin;C:\Cadence\SPB_16.01\tools\libutil\bin;C:\Cadence\SPB_16.01\tools\fet\bin
&gt;    PERLDOC_NROFF=groff -E -mtty-char -Tascii -P-c
&gt;    PERL_BADLANG &#40;unset&#41;
&gt;    SHELL &#40;unset&#41;
&gt;
</div>
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1350130" href="/Public/Bug/Display.html?id=16538#txn-1350130">#</a>      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;13&nbsp;10:13:06&nbsp;2014</span>
    <span class="description">dolmen [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> perl5-porters [...] perl.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1350130/716436/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/716436">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 478b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I had a look at the whole history of this ticket, and the current status is not clear to me.

The report also lacks some sample code to reproduce the issue, so I don&#39;t know hot to reproduce it to help triaging the issue.

Besides that, the Changes file in release 2.31 is completely empty.

So, it would be helpful if someone could add a summary of the current status: is it fixed? has any of the provided patches been merged?

-- 
Olivier MenguÃ© - <span class="clickylink"><a target="new" rel="nofollow" href="http://perlresume.org/DOLMEN">http://perlresume.org/DOLMEN</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1504400" href="/Public/Bug/Display.html?id=16538#txn-1504400">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;05&nbsp;15:48:54&nbsp;2015</span>
    <span class="description">jns [...] gellyfish.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1504400/801708/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/801708">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 310b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,
due to a variety of reason including this module having moved version control several times in the last ten years, I&#39;ve totally lost track of where this is at.  

If anyone has anything to add please send a pull request to <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/jonathanstowe/TermReadKey">https://github.com/jonathanstowe/TermReadKey</a></span> with the appropriate changes.

Thanks,
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1504403" href="/Public/Bug/Display.html?id=16538#txn-1504403">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;05&nbsp;15:49:00&nbsp;2015</span>
    <span class="description">jns [...] gellyfish.co.uk -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.94161</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
