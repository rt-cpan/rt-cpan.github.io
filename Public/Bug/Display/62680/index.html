<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #62680 for MongoDB: Numbers may arrive as parameters to MongoDB as Strings, or vice-versa!</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #62680 for MongoDB: Numbers may arrive as parameters to MongoDB as Strings, or vice-versa!</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/MongoDB/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/MongoDB/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/MongoDB/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/MongoDB/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://jira.mongodb.org/browse/PERL">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/MongoDB">MongoDB CPAN distribution</a>.</p>


<h3>Maintainer&#40;s&#41;&#39; notes</h3>

<p>Please don't report bugs here.  Please use the <a href="https://jira.mongodb.org/browse/PERL">MongoDB Perl driver issue tracker</a> instead.</p>



<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">62680</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/MongoDB/Active/">MongoDB</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
bitcard [...] ew.ewheeler.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-227304-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.39    </td>
  </tr>
  <tr id="CF-227305-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;03&nbsp;17:02:35&nbsp;2010</span>
    <span class="description">bitcard [...] ew.ewheeler.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Numbers may arrive as parameters to MongoDB as Strings, or
 vice-versa!</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Numbers in Perl may arrive as parameters to MongoDB as Strings.  Without
normalization, this can cause the appearance of lost data or data
duplication.

While this might be a feature, you may consider documenting this
behavior as an option.


======= Code To Reproduce Bug on 0.39 ========
use MongoDB;
use MongoDB::Connection;
use strict;
print &#34;MongoDB Version: $MongoDB::VERSION\n&#34;;

my $m = MongoDB::Connection-&gt;new;
my $db = $m-&gt;test_db;
my $c = $db-&gt;test_collection;

# Integers
$c-&gt;insert&#40; { x =&gt; 123 } &#41;;
my $ret = $c-&gt;find_one&#40; { x =&gt; &#39;123&#39; } &#41;;
print &#34;can NOT find &#39;123&#39; because it was stored as an integer\n&#34; if
&#40;!defined&#40;$ret&#41;&#41;;

$ret = $c-&gt;find_one&#40; { x =&gt; 123 } &#41;;
print &#34;CAN     find  123  because it was stored as an integer\n&#34; if &#40;
defined&#40;$ret&#41;&#41;;

# Floats
$c-&gt;insert&#40; { x =&gt; 123.45 } &#41;;
$ret = $c-&gt;find_one&#40; { x =&gt; &#39;123.45&#39; } &#41;;
print &#34;can NOT find &#39;123.45&#39; because it was stored as a float\n&#34; if
&#40;!defined&#40;$ret&#41;&#41;;

$ret = $c-&gt;find_one&#40; { x =&gt; 123.45 } &#41;;
print &#34;CAN     find  123.45  because it was stored as a float\n&#34; if &#40;
defined&#40;$ret&#41;&#41;;


====== Output ======
MongoDB Version: 0.39
can NOT find &#39;123&#39; because it was stored as an integer
CAN     find  123  because it was stored as an integer
can NOT find &#39;123.45&#39; because it was stored as a float
CAN     find  123.45  because it was stored as a float

====== Perl Versions ======
Tested using Perl v5.10.1 as distributed by Ubuntu 10.04
Same result when using ActivePerl v5.12.2

====== Possible Solutions =====
1. Force all values to cast as a string:
   $string = &#39;&#39; . $x

2. Create MongoDB::Number-like datatype objects for explicit typing into
the MongoDB. &#40;If you do this, #1 should be default, IMO&#41;

3. Attempt to guess the data type and cast it appropriately when storing
it in MongoDB. &#40;this could be slow&#41;

4. Do something amazing that only the great insight of the maintainer
would know of, that would resolve this for every possible use of the
perl MongoDB module!

Thank you for your help!

-Eric
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;04&nbsp;13:12:45&nbsp;2010</span>
    <span class="description">KRISTINA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; While this might be a feature, you may consider documenting this
&gt; behavior as an option.
</div>
Good idea, I&#39;ve added a section to the documentation on this.  It is a
feature and cannot be changed.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 1. Force all values to cast as a string:
&gt;    $string = &#39;&#39; . $x
</div>
MongoDB will then treat all numbers as strings, making things like range
queries behave strangely.  Also, strings take up more space than numbers.
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 2. Create MongoDB::Number-like datatype objects for explicit typing into
&gt; the MongoDB. &#40;If you do this, #1 should be default, IMO&#41;
</div>
You can use int or bigint.
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 3. Attempt to guess the data type and cast it appropriately when storing
&gt; it in MongoDB. &#40;this could be slow&#41;
</div>
You might want to check out some of the ODMs, they often enforce type
safety for you.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 4. Do something amazing that only the great insight of the maintainer
&gt; would know of, that would resolve this for every possible use of the
&gt; perl MongoDB module!
</div>
Sadly, no, MongoDB is just different in this respect from SQL dbs. 
MongoDB is more picky about types.



On Wed Nov 03 17:02:35 2010, theg33kb0y wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Numbers in Perl may arrive as parameters to MongoDB as Strings.  Without
&gt; normalization, this can cause the appearance of lost data or data
&gt; duplication.
&gt; 
&gt; While this might be a feature, you may consider documenting this
&gt; behavior as an option.
&gt; 
&gt; 
&gt; ======= Code To Reproduce Bug on 0.39 ========
&gt; use MongoDB;
&gt; use MongoDB::Connection;
&gt; use strict;
&gt; print &#34;MongoDB Version: $MongoDB::VERSION\n&#34;;
&gt; 
&gt; my $m = MongoDB::Connection-&gt;new;
&gt; my $db = $m-&gt;test_db;
&gt; my $c = $db-&gt;test_collection;
&gt; 
&gt; # Integers
&gt; $c-&gt;insert&#40; { x =&gt; 123 } &#41;;
&gt; my $ret = $c-&gt;find_one&#40; { x =&gt; &#39;123&#39; } &#41;;
&gt; print &#34;can NOT find &#39;123&#39; because it was stored as an integer\n&#34; if
&gt; &#40;!defined&#40;$ret&#41;&#41;;
&gt; 
&gt; $ret = $c-&gt;find_one&#40; { x =&gt; 123 } &#41;;
&gt; print &#34;CAN     find  123  because it was stored as an integer\n&#34; if &#40;
&gt; defined&#40;$ret&#41;&#41;;
&gt; 
&gt; # Floats
&gt; $c-&gt;insert&#40; { x =&gt; 123.45 } &#41;;
&gt; $ret = $c-&gt;find_one&#40; { x =&gt; &#39;123.45&#39; } &#41;;
&gt; print &#34;can NOT find &#39;123.45&#39; because it was stored as a float\n&#34; if
&gt; &#40;!defined&#40;$ret&#41;&#41;;
&gt; 
&gt; $ret = $c-&gt;find_one&#40; { x =&gt; 123.45 } &#41;;
&gt; print &#34;CAN     find  123.45  because it was stored as a float\n&#34; if &#40;
&gt; defined&#40;$ret&#41;&#41;;
&gt; 
&gt; 
&gt; ====== Output ======
&gt; MongoDB Version: 0.39
&gt; can NOT find &#39;123&#39; because it was stored as an integer
&gt; CAN     find  123  because it was stored as an integer
&gt; can NOT find &#39;123.45&#39; because it was stored as a float
&gt; CAN     find  123.45  because it was stored as a float
&gt; 
&gt; ====== Perl Versions ======
&gt; Tested using Perl v5.10.1 as distributed by Ubuntu 10.04
&gt; Same result when using ActivePerl v5.12.2
&gt; 
&gt; ====== Possible Solutions =====
&gt; 1. Force all values to cast as a string:
&gt;    $string = &#39;&#39; . $x
&gt; 
&gt; 2. Create MongoDB::Number-like datatype objects for explicit typing into
&gt; the MongoDB. &#40;If you do this, #1 should be default, IMO&#41;
&gt; 
&gt; 3. Attempt to guess the data type and cast it appropriately when storing
&gt; it in MongoDB. &#40;this could be slow&#41;
&gt; 
&gt; 4. Do something amazing that only the great insight of the maintainer
&gt; would know of, that would resolve this for every possible use of the
&gt; perl MongoDB module!
&gt; 
&gt; Thank you for your help!
&gt; 
&gt; -Eric
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;04&nbsp;13:12:45&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;04&nbsp;13:12:45&nbsp;2010</span>
    <span class="description">KRISTINA [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
