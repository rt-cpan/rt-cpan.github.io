<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #81179 for Catalyst-Plugin-Session-Store-DBIC: plugin fails to DELETE rows from storage when table is in a separate schema &#40;PostgreSQL&#41;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #81179 for Catalyst-Plugin-Session-Store-DBIC: plugin fails to DELETE rows from storage when table is in a separate schema &#40;PostgreSQL&#41;</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Catalyst-Plugin-Session-Store-DBIC/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Catalyst-Plugin-Session-Store-DBIC/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Catalyst-Plugin-Session-Store-DBIC/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Catalyst-Plugin-Session-Store-DBIC/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Catalyst-Plugin-Session-Store-DBIC">Catalyst-Plugin-Session-Store-DBIC CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">81179</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Catalyst-Plugin-Session-Store-DBIC/Active/">Catalyst-Plugin-Session-Store-DBIC</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
fernan.aguero [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-38630-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.12    </td>
  </tr>
  <tr id="CF-38631-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;14&nbsp;17:08:13&nbsp;2012</span>
    <span class="description">fernan.aguero [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> plugin fails to DELETE rows from storage when table is in a
 separate schema &#40;PostgreSQL&#41;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The issue is described to some extend in this thread:
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.mail-archive.com/catalyst@lists.scsys.co.uk/msg13542.html">http://www.mail-archive.com/catalyst@lists.scsys.co.uk/msg13542.html</a></span>

Essentially I&#39;m relying on Session, Session::State::Cookie and Session::Store::DBIC to manage session data in my app. 

My app is a frontend to a complex database schema, deployed in PostgreSQL. To isolate the operation that are strictly related to the catalyst webapp &#40;sessions, 
users&#41;, I created a separate schema in the database &#40;called &#39;webapp&#39;&#41;.

With this layout:

1. All queries to the session storage succeed. 
2. The DELETE queries fail. 
3. This is not an issue of PostgreSQL privileges

Configuration:
[fernan@optima] cat tcsnp_local.yml
Model::GUS:
  schema_class: GUS
  connect_info:
    - dbi:Pg:dbname=tcsnp
    - fernan
    - //PASS//
    - AutoCommit: 1

session:
  dbic_class: GUS::WebappSession
  cookie_name: tcsnp_cookie
  cookie_expires: 0

DBIC class for the webapp.sessions table &#40;attached&#41;

Some observed behaviors:

Success &#40;SQL statement shows fully qualified table names&#41;:

using DBIC_TRACE=1

[info] tcsnp powered by Catalyst 5.90018
HTTP::Server::PSGI: Accepting connections at http://0:3006/
BEGIN WORK
SELECT me.id, me.session_data, me.expires FROM webapp.sessions me WHERE &#40;
me.id = ? &#41;: &#39;session:eff3bb1616f1ee3341477c4d1056c51c7ed826a6&#39;
COMMIT
[info] *** Request 1 &#40;0.167/s&#41; [14993] [Wed Nov 14 18:22:13 2012] ***
[debug] Path is &#34;genes&#34;
[debug] &#34;GET&#34; request for &#34;genes&#34; from &#34;127.0.0.1&#34;
[debug] Rendering template &#34;genes/search.tt&#34;
[debug] Applying HTML page layout wrappers to genes/search.tt
[debug] Found sessionid &#34;eff3bb1616f1ee3341477c4d1056c51c7ed826a6&#34; in cookie
[debug] Response Code: 200; Content-Type: text/html; charset=utf-8;
Content-Length: 25221
[info] Request took 0.331861s &#40;3.013/s&#41;

Failure &#40;notice how now the sessions table is not fully qualified with the schema name anymore&#41;:

[debug] Scheduler: Executing /cron/remove_sessions
[error] Scheduler: Error executing /cron/remove_sessions: DBI Exception: DBD::Pg::st execute failed: ERROR:  relation &#34;sessions&#34; does not exist [for Statement 
&#34;DELETE FROM sessions WHERE &#40; expires &lt; ? &#41;&#34; with ParamValues: 1=&#39;1352929241&#39;] at /home/fernan/perl5/lib/perl5/DBIx/Class/Schema.pm line 1101.
        DBIx::Class::Schema::throw_exception&#40;&#39;GUS=HASH&#40;0xbfc2518&#41;&#39;, &#39;DBI Exception: DBD::Pg::st execute failed: ERROR:  relation &#34;...&#39;&#41; called at 
/home/fernan/perl5/lib/perl5/DBIx/Class/Storage.pm line 112
        DBIx::Class::Storage::throw_exception&#40;&#39;DBIx::Class::Storage::DBI::Pg=HASH&#40;0xbfc2a58&#41;&#39;, &#39;DBI Exception: DBD::Pg::st execute failed: ERROR:  relation 
&#34;...&#39;&#41; called at /home/fernan/perl5/lib/perl5/DBIx/Class/Storage/DBI.pm line 1427
        DBIx::Class::Storage::DBI::__ANON__&#40;&#39;DBD::Pg::st execute failed: ERROR:  relation &#34;sessions&#34; does ...&#39;, &#39;DBI::st=HASH&#40;0xe4f8f78&#41;&#39;, undef&#41; called at 
/home/fernan/perl5/lib/perl5/DBIx/Class/Storage/DBI.pm line 1756
        DBIx::Class::Storage::DBI::_dbh_execute&#40;&#39;DBIx::Class::Storage::DBI::Pg=HASH&#40;0xbfc2a58&#41;&#39;, &#39;DBI::db=HASH&#40;0xde9d9d8&#41;&#39;, &#39;DELETE FROM sessions WHERE &#40; expires 
&lt; ? &#41;&#39;, &#39;ARRAY&#40;0xedfbad0&#41;&#39;, &#39;ARRAY&#40;0xd9a0398&#41;&#39;&#41; called at /home/fernan/perl5/lib/perl5/DBIx/Class/Storage/DBI.pm line 799
        DBIx::Class::Storage::DBI::__ANON__&#40;&#41; called at /home/fernan/perl5/lib/perl5/DBIx/Class/Storage/BlockRunner.pm line 137
        DBIx::Class::Storage::BlockRunner::__ANON__&#40;&#41; called at /usr/share/perl5/Try/Tiny.pm line 71
        eval {...} called at /usr/share/perl5/Try/Tiny.pm line 67
        Try::Tiny::try&#40;&#39;CODE&#40;0xedcee30&#41;&#39;, &#39;Try::Tiny::Catch=REF&#40;0xde8b5c8&#41;&#39;&#41; called at /home/fernan/perl5/lib/perl5/DBIx/Class/Storage/BlockRunner.pm line 141
        DBIx::Class::Storage::BlockRunner::__ANON__&#40;&#41; called at /home/fernan/perl5/lib/perl5/Context/Preserve.pm line 42
        Context::Preserve::preserve_context&#40;&#39;CODE&#40;0xedb78c8&#41;&#39;, &#39;replace&#39;, &#39;CODE&#40;0xedc58a8&#41;&#39;&#41; called at 
/home/fernan/perl5/lib/perl5/DBIx/Class/Storage/BlockRunner.pm line 219
        DBIx::Class::Storage::BlockRunner::_run&#40;&#39;DBIx::Class::Storage::BlockRunner=HASH&#40;0xe4f9b10&#41;&#39;&#41; called at 
/home/fernan/perl5/lib/perl5/DBIx/Class/Storage/BlockRunner.pm line 110
        DBIx::Class::Storage::BlockRunner::run&#40;&#39;DBIx::Class::Storage::BlockRunner=HASH&#40;0xe4f9b10&#41;&#39;&#41; called at 
/home/fernan/perl5/lib/perl5/DBIx/Class/Storage/DBI.pm line 802
        DBIx::Class::Storage::DBI::dbh_do&#40;undef, undef, &#39;DELETE FROM sessions WHERE &#40; expires &lt; ? &#41;&#39;, &#39;ARRAY&#40;0xedfbad0&#41;&#39;, &#39;ARRAY&#40;0xd9a0398&#41;&#39;&#41; called at 
/home/fernan/perl5/lib/perl5/DBIx/Class/Storage/DBI.pm line 1721
        DBIx::Class::Storage::DBI::_execute&#40;&#39;DBIx::Class::Storage::DBI::Pg=HASH&#40;0xbfc2a58&#41;&#39;, &#39;delete&#39;, &#39;DBIx::Class::ResultSource::Table=HASH&#40;0xd260188&#41;&#39;, 
&#39;HASH&#40;0xde9e770&#41;&#39;&#41; called at /home/fernan/perl5/lib/perl5/DBIx/Class/Storage/DBI.pm line 2243
        DBIx::Class::Storage::DBI::delete&#40;&#39;DBIx::Class::Storage::DBI::Pg=HASH&#40;0xbfc2a58&#41;&#39;, &#39;DBIx::Class::ResultSource::Table=HASH&#40;0xd260188&#41;&#39;, &#39;HASH&#40;0xde9e770&#41;&#39;&#41; 
called at /home/fernan/perl5/lib/perl5/DBIx/Class/ResultSet.pm line 1804
        DBIx::Class::ResultSet::_rs_update_delete&#40;&#39;DBIx::Class::ResultSet=HASH&#40;0x8b76950&#41;&#39;, &#39;delete&#39;&#41; called at 
/home/fernan/perl5/lib/perl5/DBIx/Class/ResultSet.pm line 2000
        DBIx::Class::ResultSet::delete&#40;&#39;DBIx::Class::ResultSet=HASH&#40;0x8b76950&#41;&#39;&#41; called at /home/fernan/perl5/lib/perl5/Catalyst/Plugin/Session/Store/DBIC.pm 
line 221
        Catalyst::Plugin::Session::Store::DBIC::delete_expired_sessions&#40;&#39;tcsnp=HASH&#40;0xde9d978&#41;&#39;&#41; called at 
/home/fernan/subversion/tcsnp2/development/tcsnp/script/../lib/tcsnp/Controller/cron.pm line 20
        tcsnp::Controller::cron::remove_sessions&#40;&#39;tcsnp::Controller::cron=HASH&#40;0xd99e5e8&#41;&#39;, &#39;tcsnp=HASH&#40;0xde9d978&#41;&#39;&#41; called at 
/home/fernan/perl5/lib/perl5/Catalyst/Action.pm line 65
        Catalyst::Action::execute&#40;&#39;Catalyst::Action=HASH&#40;0xdbdb660&#41;&#39;, &#39;tcsnp::Controller::cron=HASH&#40;0xd99e5e8&#41;&#39;, &#39;tcsnp=HASH&#40;0xde9d978&#41;&#39;&#41; called at 
/home/fernan/perl5/lib/perl5/Catalyst.pm line 1682
        eval {...} called at /home/fernan/perl5/lib/perl5/Catalyst.pm line 1682
        Catalyst::execute&#40;&#39;tcsnp=HASH&#40;0xde9d978&#41;&#39;, &#39;tcsnp::Controller::cron&#39;, &#39;Catalyst::Action=HASH&#40;0xdbdb660&#41;&#39;&#41; called at 
/home/fernan/perl5/lib/perl5/Catalyst/Plugin/StackTrace.pm line 94
        Catalyst::Plugin::StackTrace::execute&#40;&#39;tcsnp=HASH&#40;0xde9d978&#41;&#39;, &#39;tcsnp::Controller::cron&#39;, &#39;Catalyst::Action=HASH&#40;0xdbdb660&#41;&#39;&#41; called at 
/home/fernan/perl5/lib/perl5/Catalyst/Action.pm line 60
        Catalyst::Action::dispatch&#40;&#39;Catalyst::Action=HASH&#40;0xdbdb660&#41;&#39;, &#39;tcsnp=HASH&#40;0xde9d978&#41;&#39;&#41; called at /home/fernan/perl5/lib/perl5/Catalyst/Dispatcher.pm 
line 257
        Catalyst::Dispatcher::_do_forward&#40;&#39;Catalyst::Dispatcher=HASH&#40;0x3553038&#41;&#39;, &#39;forward&#39;, &#39;tcsnp=HASH&#40;0xde9d978&#41;&#39;, &#39;/cron/remove_sessions&#39;&#41; called at 
/home/fernan/perl5/lib/perl5/Catalyst/Dispatcher.pm line 237
        Catalyst::Dispatcher::forward&#40;&#39;Catalyst::Dispatcher=HASH&#40;0x3553038&#41;&#39;, &#39;tcsnp=HASH&#40;0xde9d978&#41;&#39;, &#39;/cron/remove_sessions&#39;&#41; called at 
/home/fernan/perl5/lib/perl5/Catalyst.pm line 372
        Catalyst::forward&#40;&#39;tcsnp=HASH&#40;0xde9d978&#41;&#39;, &#39;/cron/remove_sessions&#39;&#41; called at /home/fernan/perl5/lib/perl5/Catalyst/Plugin/Scheduler.pm line 134
        eval {...} called at /home/fernan/perl5/lib/perl5/Catalyst/Plugin/Scheduler.pm line 121
        Catalyst::Plugin::Scheduler::dispatch&#40;&#39;tcsnp=HASH&#40;0xde9d978&#41;&#39;&#41; called at /home/fernan/perl5/lib/perl5/Catalyst/Plugin/Static/Simple.pm line 77
        Class::MOP::Class:::around&#40;&#39;CODE&#40;0x3d062f0&#41;&#39;, &#39;tcsnp=HASH&#40;0xde9d978&#41;&#39;&#41; called at /home/fernan/perl5/lib/perl5/x86_64-linux-gnu-thread-
multi/Class/MOP/Method/Wrapped.pm line 162
        Class::MOP::Method::Wrapped::__ANON__&#40;&#39;tcsnp=HASH&#40;0xde9d978&#41;&#39;&#41; called at /home/fernan/perl5/lib/perl5/x86_64-linux-gnu-thread-
multi/Class/MOP/Method/Wrapped.pm line 91
        tcsnp::dispatch&#40;&#39;tcsnp=HASH&#40;0xde9d978&#41;&#39;&#41; called at /home/fernan/perl5/lib/perl5/Catalyst.pm line 1978
        Catalyst::__ANON__&#40;&#41; called at /usr/share/perl5/Try/Tiny.pm line 76
        eval {...} called at /usr/share/perl5/Try/Tiny.pm line 67
        Try::Tiny::try&#40;&#39;CODE&#40;0xe50d918&#41;&#39;, &#39;Try::Tiny::Catch=REF&#40;0xde903b0&#41;&#39;&#41; called at /home/fernan/perl5/lib/perl5/Catalyst.pm line 1984
        Catalyst::handle_request&#40;&#39;tcsnp&#39;, &#39;env&#39;, &#39;HASH&#40;0xc79e9d0&#41;&#39;, &#39;response_cb&#39;, &#39;CODE&#40;0x75824d0&#41;&#39;&#41; called at /home/fernan/perl5/lib/perl5/Catalyst/Engine.pm 
line 688
        Catalyst::Engine::__ANON__&#40;&#39;CODE&#40;0x75824d0&#41;&#39;&#41; called at /home/fernan/perl5/lib/perl5/Plack/Util.pm line 302
        Plack::Util::__ANON__&#40;&#39;CODE&#40;0xbe6fff0&#41;&#39;&#41; called at /home/fernan/perl5/lib/perl5/HTTP/Server/PSGI.pm line 181
        HTTP::Server::PSGI::handle_connection&#40;&#39;HTTP::Server::PSGI=HASH&#40;0xdcaa250&#41;&#39;, &#39;HASH&#40;0xc79e9d0&#41;&#39;, &#39;IO::Socket::INET=GLOB&#40;0xd9a1648&#41;&#39;, &#39;CODE&#40;0xdc9dea0&#41;&#39;&#41; 
called at /home/fernan/perl5/lib/perl5/HTTP/Server/PSGI.pm line 129
        HTTP::Server::PSGI::accept_loop&#40;&#39;HTTP::Server::PSGI=HASH&#40;0xdcaa250&#41;&#39;, &#39;CODE&#40;0xdca9ed8&#41;&#39;&#41; called at /home/fernan/perl5/lib/perl5/HTTP/Server/PSGI.pm line 
55
        HTTP::Server::PSGI::run&#40;&#39;HTTP::Server::PSGI=HASH&#40;0xdcaa250&#41;&#39;, &#39;CODE&#40;0xdca9ed8&#41;&#39;&#41; called at /home/fernan/perl5/lib/perl5/Plack/Handler/HTTP/Server/PSGI.pm 
line 14
        Plack::Handler::HTTP::Server::PSGI::run&#40;&#39;Plack::Handler::Standalone=HASH&#40;0x2594b08&#41;&#39;, &#39;CODE&#40;0xdca9ed8&#41;&#39;, &#39;HASH&#40;0x25963a8&#41;&#39;&#41; called at 
/home/fernan/perl5/lib/perl5/Catalyst/Engine.pm line 670
        Catalyst::Engine::run&#40;&#39;Catalyst::Engine=HASH&#40;0x41410f8&#41;&#39;, &#39;tcsnp&#39;, &#39;CODE&#40;0xdca9ed8&#41;&#39;, 3006, undef, &#39;HASH&#40;0x25963a8&#41;&#39;, 
&#39;Plack::Handler::Standalone=HASH&#40;0x2594b08&#41;&#39;&#41; called at /home/fernan/perl5/lib/perl5/Catalyst.pm line 2443
        Catalyst::run&#40;&#39;tcsnp&#39;, 3006, undef, &#39;HASH&#40;0x25963a8&#41;&#39;, &#39;Plack::Handler::Standalone=HASH&#40;0x2594b08&#41;&#39;&#41; called at 
/home/fernan/perl5/lib/perl5/Catalyst/ScriptRole.pm line 91
        Catalyst::ScriptRole::_run_application&#40;&#39;Catalyst::Script::Server=HASH&#40;0x2594c28&#41;&#39;&#41; called at /home/fernan/perl5/lib/perl5/Catalyst/Script/Server.pm line 
242
        Catalyst::Script::Server::run&#40;&#39;Catalyst::Script::Server=HASH&#40;0x2594c28&#41;&#39;&#41; called at /home/fernan/perl5/lib/perl5/Catalyst/ScriptRunner.pm line 50
        Catalyst::ScriptRunner::run&#40;&#39;Catalyst::ScriptRunner&#39;, &#39;tcsnp&#39;, &#39;Server&#39;&#41; called at ./script/tcsnp_server.pl line 8


--
fernan
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> WebappSession.pm</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">use utf8;
package GUS::Result::WebappSession;

# Created by DBIx::Class::Schema::Loader
# DO NOT MODIFY THE FIRST PART OF THIS FILE

=head1 NAME

GUS::Result::WebappSession

=cut

use strict;
use warnings;

use base &#39;DBIx::Class::Core&#39;;

=head1 COMPONENTS LOADED

=over 4

=item * L&lt;DBIx::Class::InflateColumn::DateTime&gt;

=item * L&lt;DBIx::Class::TimeStamp&gt;

=back

=cut

__PACKAGE__-&gt;load_components&#40;&#34;InflateColumn::DateTime&#34;, &#34;TimeStamp&#34;&#41;;

=head1 TABLE: C&lt;webapp.sessions&gt;

=cut

__PACKAGE__-&gt;table&#40;&#34;webapp.sessions&#34;&#41;;

=head1 ACCESSORS

=head2 id

  data_type: &#39;char&#39;
  is_nullable: 0
  size: 72

=head2 session_data

  data_type: &#39;text&#39;
  is_nullable: 1

=head2 expires

  data_type: &#39;integer&#39;
  is_nullable: 1

=cut

__PACKAGE__-&gt;add_columns&#40;
  &#34;id&#34;,
  { data_type =&gt; &#34;char&#34;, is_nullable =&gt; 0, size =&gt; 72 },
  &#34;session_data&#34;,
  { data_type =&gt; &#34;text&#34;, is_nullable =&gt; 1 },
  &#34;expires&#34;,
  { data_type =&gt; &#34;integer&#34;, is_nullable =&gt; 1 },
&#41;;

=head1 PRIMARY KEY

=over 4

=item * L&lt;/id&gt;

=back

=cut

__PACKAGE__-&gt;set_primary_key&#40;&#34;id&#34;&#41;;


# Created by DBIx::Class::Schema::Loader v0.07033 @ 2012-11-14 16:41:47
# DO NOT MODIFY THIS OR ANYTHING ABOVE! md5sum:h+AFAzt8UFPDpxCrgkkFgA


# You can replace this text with custom code or comments, and it will be preserved on regeneration
1;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;15&nbsp;08:30:30&nbsp;2012</span>
    <span class="description">fernan.aguero [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The issue seems to be the direct calling of delete&#40;&#41; on the resultset object. Calling delete&#40;&#41; on the row object works 
fine.

This doesn&#39;t work:

sub remove_sessions : Private {
  my &#40; $self, $c &#41; = @_; 
  $c-&gt;delete_expired_sessions;
}

# DELETE FROM sessions ... ERROR:  relation &#34;sessions&#34; does not exist



And this doesn&#39;t either:

sub remove_sessions : Private {
  my &#40; $self, $c &#41; = @_; 
  my $model = $c-&gt;model&#40;&#39;GUS::WebappSession&#39;&#41;;
  my $rs = $model-&gt;search&#40;  { expires =&gt; { &#39;&lt;&#39; , time&#40;&#41; } } &#41;-&gt;delete;
}

# DELETE FROM sessions ... ERROR:  relation &#34;sessions&#34; does not exist



But this workaround did work:

sub remove_sessions : Private {
  my &#40; $self, $c &#41; = @_; 
  my $model = $c-&gt;model&#40;&#39;GUS::WebappSession&#39;&#41;;
  my $rs = $model-&gt;search&#40;  { expires =&gt; { &#39;&lt;&#39; , time&#40;&#41; } } &#41;;
  while &#40;my $session = $rs-&gt;next&#40;&#41; &#41; { 
    $session-&gt;delete;
  }
}

# SUCCESS, all expired sessions are now gone 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;15&nbsp;08:30:31&nbsp;2012</span>
    <span class="description">fernan.aguero [...] gmail.com -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
