<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #80358 for DBD-Oracle: NUMBER is cast to float, not to nvtype</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #80358 for DBD-Oracle: NUMBER is cast to float, not to nvtype</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/DBD-Oracle/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/DBD-Oracle/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/DBD-Oracle/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/DBD-Oracle/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/pythian/DBD-Oracle/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBD-Oracle">DBD-Oracle CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">80358</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">deleted</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/DBD-Oracle/Active/">DBD-Oracle</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
me [...] awirtz.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-10192-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.50    </td>
  </tr>
  <tr id="CF-10193-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;23&nbsp;16:45:53&nbsp;2012</span>
    <span class="description">me [...] awirtz.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> NUMBER is cast to float, not to nvtype</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">When Perl is compiled with nvtype=&#39;long float&#39;, all numeric equality operations use an epsilon 
value appropriate for this precision.  However, the DBD::Oracle driver always internally casts 
NUMBER values to 8-byte floats even when the Perl binary uses nvsize=16.  This causes a large 
enough rounding error that Perl&#39;s numeric equality operators no longer operate correctly.  The 
following test script illustrates the issue:

#!/usr/bin/perl
use DBI;
use Test::Simple &#39;tests&#39; =&gt; 1;
my $dsn = &#39;dbi:Oracle&#40;Username=&gt;scott,Password=&gt;tiger&#41;:MYORADB&#39;;
my $dbh = DBI-&gt;connect&#40;$dsn&#41; or die $DBI::errstr;
my&#40;$value&#41; = $dbh-&gt;selectrow_array&#40;&#39;select 1.2 from dual&#39;&#41;;
ok&#40;$value == 1.2, &#39;&#40;NUMBER&#41;1.2 == &#40;scalar&#41;1.2&#39;&#41;;

This test script fails on Perl 5.14.2 nvtype=&#39;long double&#39; with DBD::Oracle 1.50
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;24&nbsp;04:11:24&nbsp;2012</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Oct 23 16:45:53 2012, me@awirtz.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; When Perl is compiled with nvtype=&#39;long float&#39;, all numeric equality
&gt; operations use an epsilon
&gt; value appropriate for this precision.  However, the DBD::Oracle driver
&gt; always internally casts
&gt; NUMBER values to 8-byte floats even when the Perl binary uses
&gt; nvsize=16.  This causes a large
&gt; enough rounding error that Perl&#39;s numeric equality operators no longer
&gt; operate correctly.  The
&gt; following test script illustrates the issue:
&gt; 
&gt; #!/usr/bin/perl
&gt; use DBI;
&gt; use Test::Simple &#39;tests&#39; =&gt; 1;
&gt; my $dsn = &#39;dbi:Oracle&#40;Username=&gt;scott,Password=&gt;tiger&#41;:MYORADB&#39;;
&gt; my $dbh = DBI-&gt;connect&#40;$dsn&#41; or die $DBI::errstr;
&gt; my&#40;$value&#41; = $dbh-&gt;selectrow_array&#40;&#39;select 1.2 from dual&#39;&#41;;
&gt; ok&#40;$value == 1.2, &#39;&#40;NUMBER&#41;1.2 == &#40;scalar&#41;1.2&#39;&#41;;
&gt; 
&gt; This test script fails on Perl 5.14.2 nvtype=&#39;long double&#39; with
&gt; DBD::Oracle 1.50
</div>
I&#39;m guessing those casts need to use an NV.

A quick look at the code suggests fixing this might be quite involved.
I&#39;m not familiar with that code but I&#39;ll try and take a look.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;24&nbsp;04:11:26&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;24&nbsp;05:11:10&nbsp;2012</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Oct 24 04:11:24 2012, MJEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Tue Oct 23 16:45:53 2012, me@awirtz.com wrote:
<div class="message-stanza open">&gt; &gt; When Perl is compiled with nvtype=&#39;long float&#39;, all numeric equality
&gt; &gt; operations use an epsilon
&gt; &gt; value appropriate for this precision.  However, the DBD::Oracle driver
&gt; &gt; always internally casts
&gt; &gt; NUMBER values to 8-byte floats even when the Perl binary uses
&gt; &gt; nvsize=16.  This causes a large
&gt; &gt; enough rounding error that Perl&#39;s numeric equality operators no longer
&gt; &gt; operate correctly.  The
&gt; &gt; following test script illustrates the issue:
&gt; &gt; 
&gt; &gt; #!/usr/bin/perl
&gt; &gt; use DBI;
&gt; &gt; use Test::Simple &#39;tests&#39; =&gt; 1;
&gt; &gt; my $dsn = &#39;dbi:Oracle&#40;Username=&gt;scott,Password=&gt;tiger&#41;:MYORADB&#39;;
&gt; &gt; my $dbh = DBI-&gt;connect&#40;$dsn&#41; or die $DBI::errstr;
&gt; &gt; my&#40;$value&#41; = $dbh-&gt;selectrow_array&#40;&#39;select 1.2 from dual&#39;&#41;;
&gt; &gt; ok&#40;$value == 1.2, &#39;&#40;NUMBER&#41;1.2 == &#40;scalar&#41;1.2&#39;&#41;;
&gt; &gt; 
&gt; &gt; This test script fails on Perl 5.14.2 nvtype=&#39;long double&#39; with
&gt; &gt; DBD::Oracle 1.50
</div>&gt; 
&gt; I&#39;m guessing those casts need to use an NV.
&gt; 
&gt; A quick look at the code suggests fixing this might be quite involved.
&gt; I&#39;m not familiar with that code but I&#39;ll try and take a look.
&gt; 
&gt; Martin
</div>
hmmm, DBD::Oracle binds that number as a string. If you look at the SV
for 1.2 and the one returned by DBD::Oracle you&#39;ll get:

SV for 1.2:
SV = NV&#40;0x925b454&#41; at 0x92b3258
  REFCNT = 1
  FLAGS = &#40;PADMY,NOK,pNOK&#41;
  NV = 1.2

SV returned by DBD::Oracle:
SV = PV&#40;0x9386730&#41; at 0x92b7dd8
  REFCNT = 1
  FLAGS = &#40;PADMY,POK,pPOK&#41;   &lt;-- no NV, it is only a string
  PV = 0x93ba478 &#34;1.2&#34;\0
  CUR = 3
  LEN = 12

so I don&#39;t see how this has anything to do with DBD::Oracle.

e.g.,

my $x = &#34;1.2&#34;;
my $y = 1.2;
ok&#40;$x == $y, &#39;test&#39;&#41;;

fails also.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;24&nbsp;15:34:07&nbsp;2012</span>
    <span class="description">me [...] awirtz.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> me [...] awirtz.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Oct 24 05:11:10 2012, MJEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; my $x = &#34;1.2&#34;;
&gt; my $y = 1.2;
&gt; ok&#40;$x == $y, &#39;test&#39;&#41;;
&gt; 
&gt; fails also.
</div>
Something seriously wacky is going on here.
That test, in isolation, actually passes for me... until I connect to an Oracle DB, and then it 
begins failing!
Here&#39;s my current test script wherein only test #6 fails:

use DBI;
use Test::Simple &#39;tests&#39; =&gt; 6;
ok&#40;&#39;1.2&#39; == 1.2&#41;;
ok&#40;&#39;1.2&#39; == &#40;$_ = 1.2&#41;&#41;;
DBI-&gt;connect&#40;&#39;dbi:SQLite:dbname=:memory&#39;&#41;;
ok&#40;&#39;1.2&#39; == 1.2&#41;;
ok&#40;&#39;1.2&#39; == &#40;$_ = 1.2&#41;&#41;;
DBI-&gt;connect&#40;&#39;dbi:Oracle&#40;Username=&gt;scott,Password=&gt;tiger&#41;:MYORADB&#39;&#41;;
ok&#40;&#39;1.2&#39; == 1.2&#41;;
ok&#40;&#39;1.2&#39; == &#40;$_ = 1.2&#41;&#41;;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;24&nbsp;16:24:10&nbsp;2012</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Oct 24 15:34:07 2012, me@awirtz.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed Oct 24 05:11:10 2012, MJEVANS wrote:
<div class="message-stanza open">&gt; &gt;
&gt; &gt; my $x = &#34;1.2&#34;;
&gt; &gt; my $y = 1.2;
&gt; &gt; ok&#40;$x == $y, &#39;test&#39;&#41;;
&gt; &gt;
&gt; &gt; fails also.
</div>&gt; 
&gt; Something seriously wacky is going on here.
&gt; That test, in isolation, actually passes for me... until I connect to
&gt; an Oracle DB, and then it
&gt; begins failing!
&gt; Here&#39;s my current test script wherein only test #6 fails:
&gt; 
&gt; use DBI;
&gt; use Test::Simple &#39;tests&#39; =&gt; 6;
&gt; ok&#40;&#39;1.2&#39; == 1.2&#41;;
&gt; ok&#40;&#39;1.2&#39; == &#40;$_ = 1.2&#41;&#41;;
&gt; DBI-&gt;connect&#40;&#39;dbi:SQLite:dbname=:memory&#39;&#41;;
&gt; ok&#40;&#39;1.2&#39; == 1.2&#41;;
&gt; ok&#40;&#39;1.2&#39; == &#40;$_ = 1.2&#41;&#41;;
&gt; DBI-&gt;connect&#40;&#39;dbi:Oracle&#40;Username=&gt;scott,Password=&gt;tiger&#41;:MYORADB&#39;&#41;;
&gt; ok&#40;&#39;1.2&#39; == 1.2&#41;;
&gt; ok&#40;&#39;1.2&#39; == &#40;$_ = 1.2&#41;&#41;;
</div>
Admittedly, I cannot explain that right but it still doesn&#39;t make sense
to compare floating point numbers because they are not exact.

It is possible the Oracle client libraries define a symbol for a
function that Perl uses but it behaves differently. This won&#39;t be easy
to identify but you could try running your test again with lazy loading
&#40;set and export PERL_DL_NONLAZY=1 before running the test&#41; - didn&#39;t work
for me.

You might be better looking for a wider audience for this issue as I&#39;m
not sure right now. Perhaps, dbi-users list or perlmonks.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;24&nbsp;17:19:29&nbsp;2012</span>
    <span class="description">me [...] awirtz.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> me [...] awirtz.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Oct 24 16:24:10 2012, MJEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Admittedly, I cannot explain that right but it still doesn&#39;t make sense
&gt; to compare floating point numbers because they are not exact.
&gt; 
&gt; It is possible the Oracle client libraries define a symbol for a
&gt; function that Perl uses but it behaves differently. This won&#39;t be easy
&gt; to identify but you could try running your test again with lazy loading
&gt; &#40;set and export PERL_DL_NONLAZY=1 before running the test&#41; - didn&#39;t work
&gt; for me.
&gt; 
&gt; You might be better looking for a wider audience for this issue as I&#39;m
&gt; not sure right now. Perhaps, dbi-users list or perlmonks.
&gt; 
&gt; Martin
</div>
I completely agree as a matter of style regarding floating point comparisons &#40;and am happy to 
discover that DBD::Oracle does indeed preserve decimal precision by casting NUMBER fields to 
PVs - the Perl side of the code I&#39;m maintaining really should have been written as a string-
comparison&#41;.  The only reason this came up was because some existing code which used to 
work suddenly stopped working under very specific conditions.  The decimal value from the 
DB is not the result of arithmetic, but happens to be a constant representing an intermediate 
state which was defined sometime after states &#34;1&#34; and &#34;2&#34; already existed.  Internally Oracle 
has no problem with this as NUMBERs are stored as base-100 floats rather than IEEE binary 
floats.

I have resolved my particular situation by reverting to a perl build which uses 8-byte floats, 
but this remains worrisome in that is seems to indicate a deeper issue with the Oracle XS 
and/or OCI.  I did try the &#34;PERL_DL_NONLAZY&#34; flag, and for me also, it does not resolve the 
issue.  I may do more investigation as time allows.

-Aaron
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;22&nbsp;14:53:40&nbsp;2019</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Oct 24 17:19:29 2012, me@awirtz.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed Oct 24 16:24:10 2012, MJEVANS wrote:
<div class="message-stanza open">&gt; &gt; Admittedly, I cannot explain that right but it still doesn&#39;t make
&gt; &gt; sense
&gt; &gt; to compare floating point numbers because they are not exact.
&gt; &gt;
&gt; &gt; It is possible the Oracle client libraries define a symbol for a
&gt; &gt; function that Perl uses but it behaves differently. This won&#39;t be
&gt; &gt; easy
&gt; &gt; to identify but you could try running your test again with lazy
&gt; &gt; loading
&gt; &gt; &#40;set and export PERL_DL_NONLAZY=1 before running the test&#41; - didn&#39;t
&gt; &gt; work
&gt; &gt; for me.
&gt; &gt;
&gt; &gt; You might be better looking for a wider audience for this issue as
&gt; &gt; I&#39;m
&gt; &gt; not sure right now. Perhaps, dbi-users list or perlmonks.
&gt; &gt;
&gt; &gt; Martin
</div>&gt; 
&gt; I completely agree as a matter of style regarding floating point
&gt; comparisons &#40;and am happy to
&gt; discover that DBD::Oracle does indeed preserve decimal precision by
&gt; casting NUMBER fields to
&gt; PVs - the Perl side of the code I&#39;m maintaining really should have
&gt; been written as a string-
&gt; comparison&#41;.  The only reason this came up was because some existing
&gt; code which used to
&gt; work suddenly stopped working under very specific conditions.  The
&gt; decimal value from the
&gt; DB is not the result of arithmetic, but happens to be a constant
&gt; representing an intermediate
&gt; state which was defined sometime after states &#34;1&#34; and &#34;2&#34; already
&gt; existed.  Internally Oracle
&gt; has no problem with this as NUMBERs are stored as base-100 floats
&gt; rather than IEEE binary
&gt; floats.
&gt; 
&gt; I have resolved my particular situation by reverting to a perl build
&gt; which uses 8-byte floats,
&gt; but this remains worrisome in that is seems to indicate a deeper issue
&gt; with the Oracle XS
&gt; and/or OCI.  I did try the &#34;PERL_DL_NONLAZY&#34; flag, and for me also, it
&gt; does not resolve the
&gt; issue.  I may do more investigation as time allows.
&gt; 
&gt; -Aaron
</div>
Given the age of this issue and the unlikely event of anyone making it work I am deleting the issue. If it really is a problem for you still it can be reported on github as I&#39;m trying to concentrate on more recent issues. I appologies if this seems rather harsh but given my limited time available for DBD::Oracle I&#39;d rather concentrate on newer issues and this one is VERY old.

Martin

-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;22&nbsp;14:53:41&nbsp;2019</span>
    <span class="description">bohica [...] ntlworld.com -  Ticket deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
