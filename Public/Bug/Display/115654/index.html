<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #115654 for RT-Extension-CommandByMail: Request tracker 4.4.0 and 4.4.1 with Commandbymail 2.01</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #115654 for RT-Extension-CommandByMail: Request tracker 4.4.0 and 4.4.1 with Commandbymail 2.01</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/RT-Extension-CommandByMail/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/RT-Extension-CommandByMail/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/RT-Extension-CommandByMail/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/RT-Extension-CommandByMail/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/RT-Extension-CommandByMail">RT-Extension-CommandByMail CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">115654</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/RT-Extension-CommandByMail/Active/">RT-Extension-CommandByMail</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">cbrandt [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
pmtera [...] utu.fi

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-39608-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-39609-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




image001.png<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1648519/884399/image001.png">
Thu Jul 14 02:56:59 2016 (44.2k) by pmtera [...] utu.fi
</a>
</font></li>
</ul>


message headers from ticket 531089.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1648519/884400/message%20headers%20from%20ticket%20531089.txt">
Thu Jul 14 02:56:59 2016 (4k) by pmtera [...] utu.fi
</a>
</font></li>
</ul>


Screen Shot 2016-07-14 at 8.17.36 AM.png<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1648624/884472/Screen%20Shot%202016-07-14%20at%208.17.36%20AM.png">
Thu Jul 14 08:24:43 2016 (75.3k) by cbrandt [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;27&nbsp;06:04:12&nbsp;2016</span>
    <span class="description">pmtera [...] utu.fi -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Request tracker 4.4.0 and 4.4.1 with Commandbymail 2.01</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 27 Jun 2016 10:03:54 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-RT-Extension-CommandByMail [...] rt.cpan.org&#34; &lt;bug-RT-Extension-CommandByMail [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Petri Teräspuro &lt;pmtera [...] utu.fi&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

when the CommandByMail is loaded the emails which subject contains umlauts for instances &#34;Tämä on ääkköesimerkki&#34; will be saved to RT with the umlauts garbled. This occurs when a new ticket is created and the subject is saved for the first time. Also there is the previously mentioned error of acces denied when people are not in the commandbymail group

Kind regards,
Petri Teräspuro
pmtera@utu.fi
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;13&nbsp;15:05:44&nbsp;2016</span>
    <span class="description">cbrandt [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jun 27 06:04:12 2016, pmtera@utu.fi wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi,
&gt; 
&gt; when the CommandByMail is loaded the emails which subject contains
&gt; umlauts for instances &#34;Tämä on ääkköesimerkki&#34; will be saved to RT
&gt; with the umlauts garbled. This occurs when a new ticket is created and
&gt; the subject is saved for the first time. Also there is the previously
&gt; mentioned error of acces denied when people are not in the
&gt; commandbymail group
</div>
Hi Petri

I&#39;m not able to reproduce your issue. I tried a message with umlauts in the subject in a test RT with CommandByMail and it seemed to come through OK in the ticket.

Could you send the headers for your test email and a screenshot of the resulting ticket? If you can query the subject in the DB too, that would be helpful.

select id, Subject from Tickets where id = 12345;

I fixed the groups issue and will be publishing a new release soon.

Thanks,
Jim
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;13&nbsp;15:05:45&nbsp;2016</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;13&nbsp;15:06:01&nbsp;2016</span>
    <span class="description">cbrandt [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;14&nbsp;02:56:59&nbsp;2016</span>
    <span class="description">pmtera [...] utu.fi -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #115654] Request tracker 4.4.0 and 4.4.1 with Commandbymail 2.01</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 14 Jul 2016 06:56:31 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-RT-Extension-CommandByMail [...] rt.cpan.org&#34; &lt;bug-RT-Extension-CommandByMail [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Petri Teräspuro &lt;pmtera [...] utu.fi&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Jim,



thank you for the reply. In the text document are the headers for the message from the incoming request tracker mail server and the headers as reported by the request tracker full headers.



The subject from the sql query

531089;&#34;TÃ¤mÃ¤ on Ã¤Ã¤kkÃ¶sesimerkki&#34;



The picture shows the saved subject to be corrupted in the upper left corner.



After I contacted you I did notice that mail did not come in to the queues with umlauts at all &#40;like queue called Tietojärjestelmät&#41;, so I suspect there might me something wrong in the decoding of messages in the reworked mail gateway in the RT 4.4 itself which might also contribute to the plugin mail filter. I removed the umlauts from the queue names to circumvent the problem. I’ve haven’t had the time to study the changed source code. I have a incoming gateway that there is MailConversionTag in the LDAP that denotes the queue name. This results in the command /usr/bin/perl $RT_MAILGATE --queue $QUEUE --action $ACTION --url $RT_URL where the MailConversionTag is populated in the $QUEUE in UTF-8. This worked in 4.2, but not in the 4.4 series as of late.



Kind regards,

Petri Teräspuro





[cid:image001.png@01D1DDB3.C7A3F2B0]



<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; -----Original Message-----
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; From: Jim Brandt via RT [mailto:bug-RT-Extension-
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; CommandByMail@rt.cpan.org]
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Sent: 13. heinäkuuta 2016 22:06
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; To: Petri Teräspuro &lt;pmtera@utu.fi&gt;
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Subject: [rt.cpan.org #115654] Request tracker 4.4.0 and 4.4.1 with
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Commandbymail 2.01
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=115654">https://rt.cpan.org/Ticket/Display.html?id=115654</a></span> &gt;
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon Jun 27 06:04:12 2016, pmtera@utu.fi&lt;mailto:pmtera@utu.fi&gt; wrote:
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Hi,
</div></div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt;
</div></div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; when the CommandByMail is loaded the emails which subject contains
</div></div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; umlauts for instances &#34;Tämä on ääkköesimerkki&#34; will be saved to RT
</div></div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; with the umlauts garbled. This occurs when a new ticket is created and
</div></div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; the subject is saved for the first time. Also there is the previously
</div></div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; mentioned error of acces denied when people are not in the
</div></div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; commandbymail group
</div></div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi Petri
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m not able to reproduce your issue. I tried a message with umlauts in the
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; subject in a test RT with CommandByMail and it seemed to come through OK
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; in the ticket.
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Could you send the headers for your test email and a screenshot of the
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; resulting ticket? If you can query the subject in the DB too, that would be
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; helpful.
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; select id, Subject from Tickets where id = 12345;
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I fixed the groups issue and will be publishing a new release soon.
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thanks,
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Jim
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
</div>

</div></div>

<div class="messagebody">
</div>
</div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1648519/884399/image001.png">Download image001.png</a><br />
<span class="downloadcontenttype">image/png 44.2k</span>
</div>
<div class="messagebody">
<img alt="image001.png" title="image001.png" src="/Ticket/Attachment/1648519/884399/" /></div>
</div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;14&nbsp;08:24:43&nbsp;2016</span>
    <span class="description">cbrandt [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jul 14 02:56:59 2016, pmtera@utu.fi wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi Jim,
&gt; 
&gt; thank you for the reply. In the text document are the headers for the
&gt; message from the incoming request tracker mail server and the headers
&gt; as reported by the request tracker full headers.
&gt; 
&gt; The subject from the sql query
&gt; 
&gt; 531089;&#34;TÃ¤mÃ¤ on Ã¤Ã¤kkÃ¶sesimerkki&#34;
&gt; 
&gt; The picture shows the saved subject to be corrupted in the upper left
&gt; corner.
&gt; 
&gt; After I contacted you I did notice that mail did not come in to the
&gt; queues with umlauts at all &#40;like queue called Tietojärjestelmät&#41;, so I
&gt; suspect there might me something wrong in the decoding of messages in
&gt; the reworked mail gateway in the RT 4.4 itself which might also
&gt; contribute to the plugin mail filter. I removed the umlauts from the
&gt; queue names to circumvent the problem. I’ve haven’t had the time to
&gt; study the changed source code. I have a incoming gateway that there is
&gt; MailConversionTag in the LDAP that denotes the queue name. This
&gt; results in the command /usr/bin/perl $RT_MAILGATE --queue $QUEUE
&gt; --action $ACTION --url $RT_URL where the MailConversionTag is
&gt; populated in the $QUEUE in UTF-8. This worked in 4.2, but not in the
&gt; 4.4 series as of late.
&gt; 
</div>
I created a queue with an umlaut and sent an email through rt-mailgate with an umlaut in the subject and I get the attached on a vanilla RT 4.4.0 install. I tried with the latest CommandByMail as well and it seems to work for me. This is running on a Mac.

I see your page layout is quite bit different than default RT &#40;pretty cool, actually&#41;. Any chance you have a local customization that might need some updates based on changes in 4.4?
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Screen Shot 2016-07-14 at 8.17.36 AM.png</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1648624/884472/Screen%20Shot%202016-07-14%20at%208.17.36%20AM.png">Download Screen Shot 2016-07-14 at 8.17.36 AM.png</a><br />
<span class="downloadcontenttype">image/png 75.3k</span>
</div>
<div class="messagebody">
<img alt="Screen Shot 2016-07-14 at 8.17.36 AM.png" title="Screen Shot 2016-07-14 at 8.17.36 AM.png" src="/Ticket/Attachment/1648624/884472/" /></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;14&nbsp;08:44:51&nbsp;2016</span>
    <span class="description">cbrandt [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
Another possibility is it might be the DB handling. Are you using MySQL or Postgres?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;15&nbsp;00:41:22&nbsp;2016</span>
    <span class="description">cpan [...] chmrr.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2016-07-14T08:44:51-04:00, CBRANDT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Another possibility is it might be the DB handling. Are you using
&gt; MySQL or Postgres?
</div>
I believe the problem only exhibits itself on Postgres.  See the commits I pushed last night:
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/bestpractical/rt-extension-commandbymail/compare/c1f5331199a01a58cc15a5c51bdf379200cd4e95...master">https://github.com/bestpractical/rt-extension-commandbymail/compare/c1f5331199a01a58cc15a5c51bdf379200cd4e95...master</a></span>

OP: Can your confirm that applying <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/bestpractical/rt-extension-commandbymail/commit/d6c1e9c73e9ec02458921c1e2094b763e8b110f9">https://github.com/bestpractical/rt-extension-commandbymail/commit/d6c1e9c73e9ec02458921c1e2094b763e8b110f9</a></span> resolves this issue for you?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;15&nbsp;02:13:04&nbsp;2016</span>
    <span class="description">pmtera [...] utu.fi -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #115654] Request tracker 4.4.0 and 4.4.1 with Commandbymail 2.01</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 15 Jul 2016 06:12:50 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-RT-Extension-CommandByMail [...] rt.cpan.org&#34; &lt;bug-RT-Extension-CommandByMail [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Petri Teräspuro &lt;pmtera [...] utu.fi&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

I&#39;m indeed using Postgres 9.5 on RHEL7. And the patch did work for the subject &#40;<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/bestpractical/rt-extension-commandbymail/commit/d6c1e9c73e9ec02458921c1e2094b763e8b110f9&#41;">https://github.com/bestpractical/rt-extension-commandbymail/commit/d6c1e9c73e9ec02458921c1e2094b763e8b110f9&#41;</a></span>

Thank you! I noticed however the same encoding problem is probably also in the Customfield saving procedure

From a old style mailer form we use for quick ticket statistics &#40;mainly did the request come from phone, service desk  etc&#41; we gather certain custom fields :

In the messaget the field was set as:
CustomField.{Request source}: Tiskikäynnillä

And was populated as &#34;Request source:   TiskikÃ¤ynnillÃ¤&#34;

Nearly all customizations come from readymade plugins and some went in to the core in 4.4. We&#39;re also using a modified theme to get some distinction between the boxes as RT is now used in all management branches not just IT. 


Thank you for the assistance
//Petri

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Alex Vandiver via RT [mailto:bug-RT-Extension-CommandByMail@rt.cpan.org] 
Sent: 15. heinäkuuta 2016 7:41
To: Petri Teräspuro &lt;pmtera@utu.fi&gt;
Subject: [rt.cpan.org #115654] Request tracker 4.4.0 and 4.4.1 with Commandbymail 2.01

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=115654">https://rt.cpan.org/Ticket/Display.html?id=115654</a></span> &gt;

On 2016-07-14T08:44:51-04:00, CBRANDT wrote:
<div class="message-stanza open">&gt; 
&gt; Another possibility is it might be the DB handling. Are you using 
&gt; MySQL or Postgres?
</div>
I believe the problem only exhibits itself on Postgres.  See the commits I pushed last night:
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/bestpractical/rt-extension-commandbymail/compare/c1f5331199a01a58cc15a5c51bdf379200cd4e95...master">https://github.com/bestpractical/rt-extension-commandbymail/compare/c1f5331199a01a58cc15a5c51bdf379200cd4e95...master</a></span>

OP: Can your confirm that applying <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/bestpractical/rt-extension-commandbymail/commit/d6c1e9c73e9ec02458921c1e2094b763e8b110f9">https://github.com/bestpractical/rt-extension-commandbymail/commit/d6c1e9c73e9ec02458921c1e2094b763e8b110f9</a></span> resolves this issue for you?
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;18&nbsp;03:39:08&nbsp;2016</span>
    <span class="description">alex [...] chmrr.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #115654] Request tracker 4.4.0 and 4.4.1 with Commandbymail 2.01</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 18 Jul 2016 00:38:44 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-RT-Extension-CommandByMail [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Alex Vandiver &lt;alex [...] chmrr.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, 15 Jul 2016 02:13:05 -0400
&#34;Petri Teräspuro via RT&#34; &lt;bug-RT-Extension-CommandByMail@rt.cpan.org&gt;
wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thank you! I noticed however the same encoding problem is probably
&gt; also in the Customfield saving procedure
&gt; 
&gt; From a old style mailer form we use for quick ticket statistics
&gt; &#40;mainly did the request come from phone, service desk  etc&#41; we gather
&gt; certain custom fields :
&gt; 
&gt; In the messaget the field was set as:
&gt; CustomField.{Request source}: Tiskikäynnillä
&gt; 
&gt; And was populated as &#34;Request source:         TiskikÃ¤ynnillÃ¤&#34;
</div>
Did this work prior to your upgrade to 4.4?  From reading the source,
that would surprise me.
 - Alex
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;18&nbsp;05:01:08&nbsp;2016</span>
    <span class="description">pmtera [...] utu.fi -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #115654] Request tracker 4.4.0 and 4.4.1 with Commandbymail 2.01</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 18 Jul 2016 09:00:49 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-RT-Extension-CommandByMail [...] rt.cpan.org&#34; &lt;bug-RT-Extension-CommandByMail [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Petri Teräspuro &lt;pmtera [...] utu.fi&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

I&#39;ve tested the old version and your correct in you assessment. The umlauts did not work in the older Commandbymail and 4.2.12 RT either.  There actually were no umlauts in the values before we made a full overhaul of the system and took in the other organizations. Also the subject field was not used in the earlier version so that is why this just now came up.


Kind regards,
Petri

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; -----Original Message-----
&gt; From: Alex Vandiver via RT [mailto:bug-RT-Extension-
&gt; CommandByMail@rt.cpan.org]
&gt; Sent: 18. heinäkuuta 2016 10:39
&gt; To: Petri Teräspuro &lt;pmtera@utu.fi&gt;
&gt; Subject: Re: [rt.cpan.org #115654] Request tracker 4.4.0 and 4.4.1 with
&gt; Commandbymail 2.01
&gt; 
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=115654">https://rt.cpan.org/Ticket/Display.html?id=115654</a></span> &gt;
&gt; 
&gt; On Fri, 15 Jul 2016 02:13:05 -0400
&gt; &#34;Petri Teräspuro via RT&#34; &lt;bug-RT-Extension-CommandByMail@rt.cpan.org&gt;
&gt; wrote:
<div class="message-stanza open">&gt; &gt; Thank you! I noticed however the same encoding problem is probably
&gt; &gt; also in the Customfield saving procedure
&gt; &gt;
&gt; &gt; From a old style mailer form we use for quick ticket statistics
&gt; &gt; &#40;mainly did the request come from phone, service desk  etc&#41; we gather
&gt; &gt; certain custom fields :
&gt; &gt;
&gt; &gt; In the messaget the field was set as:
&gt; &gt; CustomField.{Request source}: Tiskikäynnillä
&gt; &gt;
&gt; &gt; And was populated as &#34;Request source:       TiskikÃ¤ynnillÃ¤&#34;
</div>&gt; 
&gt; Did this work prior to your upgrade to 4.4?  From reading the source,
&gt; that would surprise me.
&gt;  - Alex
</div>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;03&nbsp;09:15:41&nbsp;2016</span>
    <span class="description">cbrandt [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Petri,

The new version has been released to CPAN:

<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/release/BPS/RT-Extension-CommandByMail-2.03">https://metacpan.org/release/BPS/RT-Extension-CommandByMail-2.03</a></span>

Thanks for the bug report.
Jim
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;03&nbsp;09:15:43&nbsp;2016</span>
    <span class="description">cbrandt [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
