<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #107852 for DBIx-Class: t/105view_deps.t tests fails since SQLite-3.9.0</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #107852 for DBIx-Class: t/105view_deps.t tests fails since SQLite-3.9.0</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/DBIx-Class/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/DBIx-Class/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/DBIx-Class/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/DBIx-Class/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBIx-Class">DBIx-Class CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">107852</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/DBIx-Class/Active/">DBIx-Class</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ppisar [...] redhat.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10410-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10411-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.082821    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




signature.asc<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1552167/828712/signature.asc">
Tue Nov 03 10:06:20 2015 (213b) by ppisar [...] redhat.com
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/1546123/825522/signature.asc">
Mon Oct 19 10:01:07 2015 (213b) by ppisar [...] redhat.com
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/1546121/825518/signature.asc">
Mon Oct 19 08:58:05 2015 (213b) by ppisar [...] redhat.com
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/1546112/825511/signature.asc">
Mon Oct 19 07:25:23 2015 (213b) by ppisar [...] redhat.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;19&nbsp;05:33:56&nbsp;2015</span>
    <span class="description">ppisar [...] redhat.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> t/105view_deps.t tests fails since SQLite-3.9.0</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">After upgrading SQLite from 3.8.11.1 to 3.9.0, t/105view_deps.t tests fails like this:

$ prove -l -v t/105view_deps.t 
t/105view_deps.t .. 
#
ok 1 - use DBIx::Class::ResultSource::View;
ok 2 - &#39;A new view&#39; isa &#39;DBIx::Class::ResultSource&#39;
ok 3 - &#39;A new view also&#39; isa &#39;DBIx::Class&#39;
ok 4 - DBIx::Class::ResultSource::View-&gt;can&#40;&#39;new&#39;&#41;
ok 5 - DBIx::Class::ResultSource::View-&gt;can&#40;&#39;from&#39;&#41;
ok 6 - DBIx::Class::ResultSource::View-&gt;can&#40;&#39;deploy_depends_on&#39;&#41;
ok 7 - Connected to ViewDeps schema OK
ok 8 - SQLT view order triumphantly matches our order.
ok 9 - Query on TrackNumberFives succeeds
ok 10 - Query on AbaNameArtists succeeds
ok 11 - Query on Year2010CDsWithManyTracks succeeds
ok 12 - Query on AbNameArtists succeeds
ok 13 - Query on ANameArtists succeeds
ok 14 - Query on Year2010CDs succeeds
ok 15 - Query on AbaNameArtistsAnd2010CDsWithManyTracks succeeds
ok 16 - Connected to ViewDepsBad schema OK
not ok 17 - Deploying the bad schema produces a warning: aba_name_artists was not created.
ok 18 - SQLT view order triumphantly matches our order.
ok 19 - Query on AbNameArtists succeeds
ok 20 - Query on Year2010CDsWithManyTracks succeeds
ok 21 - Query on TrackNumberFives succeeds
ok 22 - Query on AbaNameArtists succeeds
ok 23 - Query on Year2010CDs succeeds
ok 24 - Query on ANameArtists succeeds
not ok 25 - Query on AbaNameArtistsAnd2010CDsWithManyTracks throws, because the table does not exist
1..25
# Auto checked 6 references for leaks - none detected

#   Failed test &#39;Deploying the bad schema produces a warning: aba_name_artists was not created.&#39;
#   at t/105view_deps.t line 79.
# didn&#39;t find a warning
# expected to find warning: &#40;?^:no such table: main.aba_name_artists&#41;

#   Failed test &#39;Query on AbaNameArtistsAnd2010CDsWithManyTracks throws, because the table does not exist&#39;
#   at t/105view_deps.t line 110.
# expecting: Regexp &#40;&#40;?^:no such table: aba_name_artists_and_2010_cds_with_many_tracks&#41;&#41;
# found: normal exit
# Looks like you failed 2 tests of 25.
Dubious, test returned 2 &#40;wstat 512, 0x200&#41;
Failed 2/25 subtests 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;19&nbsp;06:53:29&nbsp;2015</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #107852] t/105view_deps.t tests fails since SQLite-3.9.0</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 19 Oct 2015 12:53:04 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Peter Rabbitson &lt;ribasushi [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 10/19/2015 11:33 AM, Petr Pisar via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Mon Oct 19 05:33:56 2015: Request 107852 was acted upon.
&gt; Transaction: Ticket created by ppisar
&gt;         Queue: DBIx-Class
&gt;       Subject: t/105view_deps.t tests fails since SQLite-3.9.0
&gt;     Broken in: 0.082820
&gt;      Severity: &#40;no value&#41;
&gt;         Owner: Nobody
&gt;    Requestors: ppisar@redhat.com
&gt;        Status: new
&gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=107852">https://rt.cpan.org/Ticket/Display.html?id=107852</a></span> &gt;
&gt;
&gt;
&gt; After upgrading SQLite from 3.8.11.1 to 3.9.0
</div>
Can you please get me the correct incantation how to do this? 
DBD::SQLite comes prebundled with the older version:


~$ perl -MDBI -MData::Dumper -e &#39;die Dumper [ 
DBI-&gt;connect&#40;&#34;dbi:SQLite::memory:&#34;&#41;-&gt;{sqlite_version}, 
DBD::SQLite-&gt;VERSION]&#39;
$VAR1 = [
           &#39;3.8.11.1&#39;,
           &#39;1.49_02&#39;
         ];

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; #   Failed test &#39;Deploying the bad schema produces a warning: aba_name_artists was not created.&#39;
&gt; #   at t/105view_deps.t line 79.
&gt; # didn&#39;t find a warning
&gt; # expected to find warning: &#40;?^:no such table: main.aba_name_artists&#41;
</div>
This one could very well be a problem with DBIC, however:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; #   Failed test &#39;Query on AbaNameArtistsAnd2010CDsWithManyTracks throws, because the table does not exist&#39;
&gt; #   at t/105view_deps.t line 110.
&gt; # expecting: Regexp &#40;&#40;?^:no such table: aba_name_artists_and_2010_cds_with_many_tracks&#41;&#41;
&gt; # found: normal exit
&gt;
</div>
This can&#39;t be right. I am inclined to blame DBD::SQLite here for not 
interfacing properly with 3.9.0 or something. Hence need instructions 
how to reproduce - an error like this should be resulting in an exception.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;19&nbsp;06:53:32&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;19&nbsp;07:25:23&nbsp;2015</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #107852] t/105view_deps.t tests fails since SQLite-3.9.0</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 19 Oct 2015 13:25:10 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Peter Rabbitson via RT &lt;bug-DBIx-Class [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Petr Pisar &lt;ppisar [...] redhat.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, Oct 19, 2015 at 06:53:33AM -0400, Peter Rabbitson via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; After upgrading SQLite from 3.8.11.1 to 3.9.0
</div>&gt; 
&gt; Can you please get me the correct incantation how to do this? 
&gt; DBD::SQLite comes prebundled with the older version:
&gt; 
&gt; 
&gt; ~$ perl -MDBI -MData::Dumper -e &#39;die Dumper [ 
&gt; DBI-&gt;connect&#40;&#34;dbi:SQLite::memory:&#34;&#41;-&gt;{sqlite_version}, 
&gt; DBD::SQLite-&gt;VERSION]&#39;
&gt; $VAR1 = [
&gt;            &#39;3.8.11.1&#39;,
&gt;            &#39;1.49_02&#39;
&gt;          ];
&gt; 
</div>$VAR1 = [
          &#39;3.9.0&#39;,
          &#39;1.48&#39;
        ];

We build DBD::SQLite against system SQLite library, see
&lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://pkgs.fedoraproject.org/cgit/perl-DBD-SQLite.git/tree/perl-DBD-SQLite.spec">http://pkgs.fedoraproject.org/cgit/perl-DBD-SQLite.git/tree/perl-DBD-SQLite.spec</a></span>&gt;
&#40;the patches are in the same directory&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; #   Failed test &#39;Deploying the bad schema produces a warning: aba_name_artists was not created.&#39;
&gt; &gt; #   at t/105view_deps.t line 79.
&gt; &gt; # didn&#39;t find a warning
&gt; &gt; # expected to find warning: &#40;?^:no such table: main.aba_name_artists&#41;
</div>&gt; 
&gt; This one could very well be a problem with DBIC, however:
&gt; 
<div class="message-stanza open">&gt; &gt;
&gt; &gt; #   Failed test &#39;Query on AbaNameArtistsAnd2010CDsWithManyTracks throws, because the table does not exist&#39;
&gt; &gt; #   at t/105view_deps.t line 110.
&gt; &gt; # expecting: Regexp &#40;&#40;?^:no such table: aba_name_artists_and_2010_cds_with_many_tracks&#41;&#41;
&gt; &gt; # found: normal exit
&gt; &gt;
</div>&gt; 
&gt; This can&#39;t be right. I am inclined to blame DBD::SQLite here for not 
&gt; interfacing properly with 3.9.0 or something. Hence need instructions 
&gt; how to reproduce - an error like this should be resulting in an exception.
&gt; 
</div>That&#39;s quite possible. I will try to rebuild the DBD::SQLite and bisect SQLite
to find what exact SQLite change causes the failure.

-- Petr
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1546112/825511/signature.asc">Download signature.asc</a><br />
<span class="downloadcontenttype">application/pgp-signature 213b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;19&nbsp;08:58:05&nbsp;2015</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #107852] t/105view_deps.t tests fails since SQLite-3.9.0</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 19 Oct 2015 14:57:53 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Peter Rabbitson via RT &lt;bug-DBIx-Class [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Petr Pisar &lt;ppisar [...] redhat.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, Oct 19, 2015 at 06:53:33AM -0400, Peter Rabbitson via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 10/19/2015 11:33 AM, Petr Pisar via RT wrote:
<div class="message-stanza open">&gt; &gt; After upgrading SQLite from 3.8.11.1 to 3.9.0
</div>&gt; 
&gt; Can you please get me the correct incantation how to do this? 
&gt; DBD::SQLite comes prebundled with the older version:
&gt; 
&gt; 
&gt; ~$ perl -MDBI -MData::Dumper -e &#39;die Dumper [ 
&gt; DBI-&gt;connect&#40;&#34;dbi:SQLite::memory:&#34;&#41;-&gt;{sqlite_version}, 
&gt; DBD::SQLite-&gt;VERSION]&#39;
&gt; $VAR1 = [
&gt;            &#39;3.8.11.1&#39;,
&gt;            &#39;1.49_02&#39;
&gt;          ];
&gt; 
</div>DBD::SQLite developmental code &lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/DBD-SQLite/DBD-SQLite.git">https://github.com/DBD-SQLite/DBD-SQLite.git</a></span>&gt;
already bundles SQLite-3.9.1. It can be used to reproduce the test failure.

-- Petr
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1546121/825518/signature.asc">Download signature.asc</a><br />
<span class="downloadcontenttype">application/pgp-signature 213b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;19&nbsp;10:01:07&nbsp;2015</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #107852] t/105view_deps.t tests fails since SQLite-3.9.0</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 19 Oct 2015 16:00:45 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Peter Rabbitson via RT &lt;bug-DBIx-Class [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Petr Pisar &lt;ppisar [...] redhat.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon, Oct 19, 2015 at 01:25:10PM +0200, Petr Pisar wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon, Oct 19, 2015 at 06:53:33AM -0400, Peter Rabbitson via RT wrote:
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; #   Failed test &#39;Deploying the bad schema produces a warning: aba_name_artists was not created.&#39;
&gt; &gt; &gt; #   at t/105view_deps.t line 79.
&gt; &gt; &gt; # didn&#39;t find a warning
&gt; &gt; &gt; # expected to find warning: &#40;?^:no such table: main.aba_name_artists&#41;
</div>&gt; &gt; 
&gt; &gt; This one could very well be a problem with DBIC, however:
&gt; &gt; 
<div class="message-stanza open">&gt; &gt; &gt;
&gt; &gt; &gt; #   Failed test &#39;Query on AbaNameArtistsAnd2010CDsWithManyTracks throws, because the table does not exist&#39;
&gt; &gt; &gt; #   at t/105view_deps.t line 110.
&gt; &gt; &gt; # expecting: Regexp &#40;&#40;?^:no such table: aba_name_artists_and_2010_cds_with_many_tracks&#41;&#41;
&gt; &gt; &gt; # found: normal exit
&gt; &gt; &gt;
</div>&gt; &gt; 
&gt; &gt; This can&#39;t be right. I am inclined to blame DBD::SQLite here for not 
&gt; &gt; interfacing properly with 3.9.0 or something. Hence need instructions 
&gt; &gt; how to reproduce - an error like this should be resulting in an exception.
&gt; &gt; 
</div>&gt; That&#39;s quite possible. I will try to rebuild the DBD::SQLite and bisect SQLite
&gt; to find what exact SQLite change causes the failure.
&gt; 
</div>This SQLite commit &#40;<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/mackyle/sqlite.git&#41;">https://github.com/mackyle/sqlite.git&#41;</a></span> introduced
the test failure:

From e0a6da52a654f3ddcfef8a0c4e9c4f2fe2fd12f5 Mon Sep 17 00:00:00 2001
From: &#34;D. Richard Hipp&#34; &lt;drh@hwaci.com&gt;
Date: Mon, 3 Aug 2015 13:44:45 +0000
Subject: [PATCH] Allow a VIEW to reference undefined tables and functions when
 initially created.  The error report is deferred until the VIEW is used. 
 This allows views to be created before subviews and tables that the view
 references.

---
 src/build.c    | 3 ---
 test/view.test | 2 +-
 2 files changed, 1 insertion&#40;+&#41;, 4 deletions&#40;-&#41;

diff --git a/src/build.c b/src/build.c
index 2936805..a84aa57 100644
--- a/src/build.c
+++ b/src/build.c
@@ -2088,9 +2088,6 @@ void sqlite3CreateView&#40;
   if&#40; db-&gt;mallocFailed &#41;{
     return;
   }
-  if&#40; !db-&gt;init.busy &#41;{
-    sqlite3ViewGetColumnNames&#40;pParse, p&#41;;
-  }
 
   /* Locate the end of the CREATE VIEW statement.  Make sEnd point to
   ** the end.
diff --git a/test/view.test b/test/view.test
index 3ba6c0b..a5fe85e 100644
--- a/test/view.test
+++ b/test/view.test
@@ -599,7 +599,7 @@ do_test view-21.1 {
     CREATE VIEW v8192 AS SELECT * FROM v4096 UNION SELECT * FROM v4096;
     CREATE VIEW v16384 AS SELECT * FROM v8192 UNION SELECT * FROM v8192;
     CREATE VIEW v32768 AS SELECT * FROM v16384 UNION SELECT * FROM v16384;
-    CREATE VIEW vx AS SELECT * FROM v32768 UNION SELECT * FROM v32768;
+    SELECT * FROM v32768 UNION SELECT * FROM v32768;
   }
 } {1 {too many references to &#34;v1&#34;: max 65535}}
 ifcapable progress {
-- 
2.6.2

If I revert the change on top of SQLite-3.9.0, the DBIx::Class test passes
again. It looks like an intentional change and it explains why the first test
cannot see any warning. But the second test should see an error.

I also think DBD::SQLite should raise an error there. If it is so, can you
move this ticket to DBD-SQLite queue?

-- Petr
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1546123/825522/signature.asc">Download signature.asc</a><br />
<span class="downloadcontenttype">application/pgp-signature 213b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;03&nbsp;08:39:58&nbsp;2015</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Oct 19 11:33:56 2015, ppisar wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; #   Failed test &#39;Query on AbaNameArtistsAnd2010CDsWithManyTracks
&gt; throws, because the table does not exist&#39;
</div>
I see what happened. The actual text here is misleading. We are not checking if an underlying *table* doesn&#39;t exist, but merely that the *view* did not get deployed. Hence my confusion.

This is definitely a DBIC-side problem, now addressed to check for the right thing in <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/dbsrgits/dbix-class/commit/26c663f1">https://github.com/dbsrgits/dbix-class/commit/26c663f1</a></span>

Thanks!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;03&nbsp;08:40:00&nbsp;2015</span>
    <span class="description">ribasushi [...] leporine.io -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;03&nbsp;10:06:20&nbsp;2015</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #107852] t/105view_deps.t tests fails since SQLite-3.9.0</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 3 Nov 2015 16:06:03 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Peter Rabbitson via RT &lt;bug-DBIx-Class [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Petr Pisar &lt;ppisar [...] redhat.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue, Nov 03, 2015 at 08:39:59AM -0500, Peter Rabbitson via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon Oct 19 11:33:56 2015, ppisar wrote:
<div class="message-stanza open">&gt; &gt; 
&gt; &gt; #   Failed test &#39;Query on AbaNameArtistsAnd2010CDsWithManyTracks
&gt; &gt; throws, because the table does not exist&#39;
</div>&gt; 
&gt; I see what happened. The actual text here is misleading. We are not checking
&gt; if an underlying *table* doesn&#39;t exist, but merely that the *view* did not
&gt; get deployed. Hence my confusion.
&gt; 
&gt; This is definitely a DBIC-side problem, now addressed to check for the right
&gt; thing in <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/dbsrgits/dbix-class/commit/26c663f1">https://github.com/dbsrgits/dbix-class/commit/26c663f1</a></span>
&gt; 
</div>Thank you for the fix. I confirm that adjusting the test as shown in the
commit makes the test passing again.

-- Petr
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1552167/828712/signature.asc">Download signature.asc</a><br />
<span class="downloadcontenttype">application/pgp-signature 213b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;11&nbsp;14:20:13&nbsp;2016</span>
    <span class="description">ribasushi [...] leporine.io -  Fixed in 0.082821 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;11&nbsp;14:20:14&nbsp;2016</span>
    <span class="description">ribasushi [...] leporine.io -  Broken in 0.082820 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;11&nbsp;14:20:14&nbsp;2016</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Now on CPAN
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;11&nbsp;14:20:20&nbsp;2016</span>
    <span class="description">ribasushi [...] leporine.io -  Status changed from &#39;patched&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
