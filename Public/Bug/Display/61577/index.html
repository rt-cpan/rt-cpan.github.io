<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #61577 for IO: -&gt;sockdomain and -&gt;socktype undefined on newly -&gt;accept&#39;ed sockets</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #61577 for IO: -&gt;sockdomain and -&gt;socktype undefined on newly -&gt;accept&#39;ed sockets</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/IO/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/IO/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/IO/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/IO/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/IO">IO CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">61577</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/IO/Active/">IO</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
leonerd-cpan [...] leonerd.org.uk

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-17026-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.25    </td>
  </tr>
  <tr id="CF-17027-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;22&nbsp;19:30:30&nbsp;2010</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> -&gt;sockdomain and -&gt;socktype undefined on newly -&gt;accept&#39;ed sockets</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Given some socket in listening mode, $sock:

  my $new = $sock-&gt;accept;

  ok&#40; defined $new-&gt;sockdomain &#41;;
  ok&#40; defined $new-&gt;socktype &#41;;

both fail.

I have a workaround in my subclass, which involves:

-----
sub accept
{
   my $self = shift;
   my &#40; $new, $peer &#41; = $self-&gt;SUPER::accept or return;

   ${*$new}{$_} = ${*$self}{$_} for qw&#40; io_socket_domain io_socket_type
io_socket_proto &#41;;

   return wantarray ? &#40; $new, $peer &#41;
                    : $new;
}
-----

Could IO::Socket itself do this please?

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;23&nbsp;06:25:06&nbsp;2011</span>
    <span class="description">SHLOMIF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

On Wed Sep 22 19:30:30 2010, PEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Given some socket in listening mode, $sock:
&gt; 
&gt;   my $new = $sock-&gt;accept;
&gt; 
&gt;   ok&#40; defined $new-&gt;sockdomain &#41;;
&gt;   ok&#40; defined $new-&gt;socktype &#41;;
&gt; 
&gt; both fail.
&gt; 
&gt; I have a workaround in my subclass, which involves:
&gt; 
&gt; -----
&gt; sub accept
&gt; {
&gt;    my $self = shift;
&gt;    my &#40; $new, $peer &#41; = $self-&gt;SUPER::accept or return;
&gt; 
&gt;    ${*$new}{$_} = ${*$self}{$_} for qw&#40; io_socket_domain io_socket_type
&gt; io_socket_proto &#41;;
&gt; 
&gt;    return wantarray ? &#40; $new, $peer &#41;
&gt;                     : $new;
&gt; }
</div>
This also happens with new_from_fd / fdopen . Here is a testcase:

[CODE]

#!/usr/bin/perl

use strict;
use warnings;

use IO::Socket::INET;

my $sock = IO::Socket::INET-&gt;new&#40;
    PeerAddr =&gt; &#39;www.perl.org&#39;,
    PeerPort =&gt; &#39;http&#40;80&#41;&#39;,
    Proto    =&gt; &#39;tcp&#39;
&#41;;

print &#34;Orig domain ==&#34;, $sock-&gt;sockdomain&#40;&#41;, &#34;\n&#34;;

my $dup_sock = IO::Socket::INET-&gt;new_from_fd&#40;$sock, &#39;+&lt;&#39;&#41;;

print &#34;Dup domain ==&#34;, $dup_sock-&gt;sockdomain&#40;&#41;, &#34;\n&#34;;

[/CODE]

This affected IO::Socket::INET6 in this bug report:

<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Public/Bug/Display.html?id=68282">https://rt.cpan.org/Public/Bug/Display.html?id=68282</a></span>

Please correct it.

Regards,

-- Shlomi Fish

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; -----
&gt; 
&gt; Could IO::Socket itself do this please?
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;23&nbsp;06:25:09&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;09&nbsp;01:03:29&nbsp;2012</span>
    <span class="description">dkg [...] fifthhorseman.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [rt.cpan.org #61577] more robust patch to fix un-propagated cached details for IO::Socket objects</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 09 Feb 2012 01:03:55 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-IO [...] rt.cpan.org, 659075 [...] bugs.debian.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Daniel Kahn Gillmor &lt;dkg [...] fifthhorseman.net&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I think my earlier patch for CPAN&#39;s #61577 and debian #659075 only
addressed the accept&#40;&#41; case.  This is a replacement.

The attached patch should cover IO::Socket objects created via accept&#40;&#41;,
new_from_fd&#40;&#41;, new&#40;&#41;, and anywhere else whose details haven&#39;t been
properly cached.

No new code should be executed on IO::Socket objects whose details are
already cached and present.

If there are problems that would prevent this change from being accepted
&#40;either upstream or in debian&#41;, please let me know and i&#39;ll try to
address them.

Regards,

        --dkg
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- a/dist/IO/lib/IO/Socket.pm	2012-02-07 21:12:42.000000000 -0500
+++ b/dist/IO/lib/IO/Socket.pm	2012-02-09 00:54:14.000000000 -0500
@@ -336,18 +336,34 @@
 sub sockdomain {
     @_ == 1 or croak &#39;usage: $sock-&gt;sockdomain&#40;&#41;&#39;;
     my $sock = shift;
+# FIXME: SO_DOMAIN should probably ultimately be included in Socket.pm
+# and the associated XS, but it isn&#39;t necessarily portable.  see:
+# <span class="clickylink"><a target="new" rel="nofollow" href="https://mail.gnome.org/archives/commits-list/2011-September/msg00944.html">https://mail.gnome.org/archives/commits-list/2011-September/msg00944.html</a></span>
+    my $so_domain = 39; 
+    if &#40;!defined&#40;${*$sock}{&#39;io_socket_domain&#39;}&#41;&#41; {
+	my $addr = $sock-&gt;getsockname&#40;&#41;;
+	if &#40;defined&#40;$addr&#41;&#41; {
+	    ${*$sock}{&#39;io_socket_domain&#39;} = sockaddr_family&#40;$addr&#41;;
+	} else {
+	    ${*$sock}{&#39;io_socket_domain&#39;} = $sock-&gt;sockopt&#40;$so_domain&#41;
+	}
+    }
     ${*$sock}{&#39;io_socket_domain&#39;};
 }
 
 sub socktype {
     @_ == 1 or croak &#39;usage: $sock-&gt;socktype&#40;&#41;&#39;;
     my $sock = shift;
+    ${*$sock}{&#39;io_socket_type&#39;} = $sock-&gt;sockopt&#40;SO_TYPE&#41;
+	unless defined&#40;${*$sock}{&#39;io_socket_type&#39;}&#41;;
     ${*$sock}{&#39;io_socket_type&#39;}
 }
 
 sub protocol {
     @_ == 1 or croak &#39;usage: $sock-&gt;protocol&#40;&#41;&#39;;
     my&#40;$sock&#41; = @_;
+    ${*$sock}{&#39;io_socket_proto&#39;} = $sock-&gt;sockopt&#40;SO_PROTOCOL&#41;
+	unless defined&#40;${*$sock}{&#39;io_socket_proto&#39;}&#41;;
     ${*$sock}{&#39;io_socket_proto&#39;};
 }
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;09&nbsp;12:03:42&nbsp;2012</span>
    <span class="description">dkg [...] fifthhorseman.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> 659075 [...] bugs.debian.org, bug-IO [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: Bug#659075: [rt.cpan.org #61577] more robust patch to fix un-propagated cached details for IO::Socket objects</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 09 Feb 2012 12:04:12 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> perl5-porters [...] perl.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Daniel Kahn Gillmor &lt;dkg [...] fifthhorseman.net&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi perl porters--

There appears to be a flaw in IO::Socket where some IO::Socket objects
are unable to properly report their socktype, sockdomain, or protocol
&#40;they return undef, even when the underlying socket is sufficiently
initialized to have these properties&#41;.

The attached patch has been forwarded to CPAN&#39;s #61577 [0] and debian&#39;s
#659075 [1], and should address these issues no matter why the cached
details happen to be missing.

I&#39;d be happy to improve the patch somehow if you have any suggestions
&#40;you&#39;ll note that there&#39;s a FIXME in there because of SO_DOMAIN&#39;s
general non-portability -- i&#39;m not sure how you&#39;d generally want to
approach that sort of thing generally within perl, so i&#39;ve gone for the
narrowly-targeted fix instead of something more intrusive&#41;.

I&#39;m not subscribed to perl5-porters, so please CC me with any replies.

Thanks for maintaining Perl!

        --dkg

[0] <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=61577">https://rt.cpan.org/Ticket/Display.html?id=61577</a></span>
[1] <span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.debian.org/659075">http://bugs.debian.org/659075</a></span>
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;14&nbsp;01:17:23&nbsp;2012</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> dkg [...] fifthhorseman.net, 659075 [...] bugs.debian.org, perl5-porters [...] perl.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Feb 09 12:03:42 2012, dkg@fifthhorseman.net wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi perl porters--
&gt; 
&gt; There appears to be a flaw in IO::Socket where some IO::Socket objects
&gt; are unable to properly report their socktype, sockdomain, or protocol
&gt; &#40;they return undef, even when the underlying socket is sufficiently
&gt; initialized to have these properties&#41;.
&gt; 
&gt; The attached patch has been forwarded to CPAN&#39;s #61577 [0] and debian&#39;s
&gt; #659075 [1], and should address these issues no matter why the cached
&gt; details happen to be missing.
</div>
Is there any chance you could include tests cases, too?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;14&nbsp;01:39:13&nbsp;2012</span>
    <span class="description">659075 [...] bugs.debian.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Bug#659075: Info received &#40;[rt.cpan.org #61577] -&gt;sockdomain and -&gt;socktype undefined on newly -&gt;accept&#39;ed sockets &#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 14 Feb 2012 06:39:05 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-IO [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> owner [...] bugs.debian.org &#40;Debian Bug Tracking System&#41;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thank you for the additional information you have supplied regarding
this Bug report.

This is an automatically generated reply to let you know your message
has been received.

Your message is being forwarded to the package maintainers and other
interested parties for their attention; they will reply in due course.

Your message has been sent to the package maintainer&#40;s&#41;:
 Niko Tyni &lt;ntyni@debian.org&gt;

If you wish to submit further information on this problem, please
send it to 659075@bugs.debian.org.

Please do not send mail to owner@bugs.debian.org unless you wish
to report a problem with the Bug-tracking system.

-- 
659075: <span class="clickylink"><a target="new" rel="nofollow" href="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=659075">http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=659075</a></span>
Debian Bug Tracking System
Contact owner@bugs.debian.org with problems
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;14&nbsp;10:22:40&nbsp;2012</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> dkg [...] fifthhorseman.net, perl5-porters [...] perl.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m a little bit worried about this change.

In my experience, SO_DOMAIN is far from reliable across platforms. Also, 
some operating systems omit it entirely but have instead an SO_FAMILY 
that does the same thing. &#40;I&#39;ve yet to meet an OS that had both, 
however&#41;.

I think it&#39;s OK to optimistically /try/ to fill in the object slots using 
SO_DOMAIN/FAMILY/TYPE/PROTOCOL, but don&#39;t rely on them to necessarily 
yield an answer.


-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;14&nbsp;11:16:54&nbsp;2012</span>
    <span class="description">dkg [...] fifthhorseman.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> perl5-porters [...] perl.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #61577] -&gt;sockdomain and -&gt;socktype undefined on newly -&gt;accept&#39;ed sockets</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 14 Feb 2012 11:16:36 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-IO [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Daniel Kahn Gillmor &lt;dkg [...] fifthhorseman.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 02/14/2012 10:22 AM, Paul Evans via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=61577">https://rt.cpan.org/Ticket/Display.html?id=61577</a></span> &gt;
&gt; 
&gt; I&#39;m a little bit worried about this change.
&gt; 
&gt; In my experience, SO_DOMAIN is far from reliable across platforms. Also, 
&gt; some operating systems omit it entirely but have instead an SO_FAMILY 
&gt; that does the same thing. &#40;I&#39;ve yet to meet an OS that had both, 
&gt; however&#41;.
&gt; 
&gt; I think it&#39;s OK to optimistically /try/ to fill in the object slots using 
&gt; SO_DOMAIN/FAMILY/TYPE/PROTOCOL, but don&#39;t rely on them to necessarily 
&gt; yield an answer.
</div>
at the moment, we have scenarios where there is no attempt at all to
yield an answer, and protocol, sockdomain, and socktype just return
undefined.

So the proposed workaround is a significant improvement anyway.

Note that the proposed code to populate the domain parameter cache
doesn&#39;t just use SO_DOMAIN; it tries getsockname&#40;&#41; first &#40;also
apparently somewhat unportable&#41;, and then falls back to trying SO_DOMAIN
if the earlier attempt fails.

If there are platforms on which the proposed fix doesn&#39;t work on, i&#39;d be
happy to see patches for those platforms.  but i don&#39;t think we should
avoid fixing the platforms which do support these system calls.

        --dkg
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;14&nbsp;13:38:22&nbsp;2012</span>
    <span class="description">dkg [...] fifthhorseman.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> 659075 [...] bugs.debian.org, perl5-porters [...] perl.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #61577] -&gt;sockdomain and -&gt;socktype undefined on newly -&gt;accept&#39;ed sockets</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 14 Feb 2012 13:38:07 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-IO [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Daniel Kahn Gillmor &lt;dkg [...] fifthhorseman.net&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 02/14/2012 01:17 AM, Father Chrysostomos via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Is there any chance you could include tests cases, too?
</div>
Ah yes, good call.  This prompted me to find a bug in my patch as well
&#40;i was calling getsockname&#40;&#41; instead of sockname&#40;&#41; on the IO::Socket
object, i have no idea how i missed that the first time through&#41;.

A revised patch is attached.

Also attached are three test cases that test unix domain sockets, TCP
sockets, and UDP sockets.  Each fails with the when run against an
unpatched IO::Socket.

With my v2 patch applied to IO::Socket, all tests pass for all three
test cases.

Regards,

        --dkg
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;14&nbsp;13:55:00&nbsp;2012</span>
    <span class="description">micah [...] riseup.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> 659075 [...] bugs.debian.org, perl5-porters [...] perl.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #61577] -&gt;sockdomain and -&gt;socktype undefined on newly -&gt;accept&#39;ed sockets</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 14 Feb 2012 13:54:48 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Daniel Kahn Gillmor &lt;dkg [...] fifthhorseman.net&gt;, bug-IO [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> micah anderson &lt;micah [...] riseup.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
On Tue, 14 Feb 2012 13:38:07 -0500, Daniel Kahn Gillmor &lt;dkg@fifthhorseman.net&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 02/14/2012 01:17 AM, Father Chrysostomos via RT wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; Is there any chance you could include tests cases, too?
</div>&gt; 
&gt; Ah yes, good call.  This prompted me to find a bug in my patch as well
&gt; &#40;i was calling getsockname&#40;&#41; instead of sockname&#40;&#41; on the IO::Socket
&gt; object, i have no idea how i missed that the first time through&#41;.
&gt; 
&gt; A revised patch is attached.
</div>
I&#39;ve just applied and tested this revised patch and can confirm that
resolves the error&#40;s&#41; that I was seeing with this issue.

micah
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;14&nbsp;15:58:56&nbsp;2012</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Feb 14 11:16:54 2012, dkg@fifthhorseman.net wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So the proposed workaround is a significant improvement anyway.
&gt; 
&gt; Note that the proposed code to populate the domain parameter cache
&gt; doesn&#39;t just use SO_DOMAIN; it tries getsockname&#40;&#41; first &#40;also
&gt; apparently somewhat unportable&#41;, and then falls back to trying SO_DOMAIN
&gt; if the earlier attempt fails.
&gt; 
&gt; If there are platforms on which the proposed fix doesn&#39;t work on, i&#39;d be
&gt; happy to see patches for those platforms.  but i don&#39;t think we should
&gt; avoid fixing the platforms which do support these system calls.
</div>
I&#39;m not too happy about this patch currently, because it just &#34;guesses&#34; that 
sockopt 38 is SO_DOMAIN. I&#39;m aware that Socket doesn&#39;t currently wrap 
SO_DOMAIN, and I&#39;m happy to add that. The trouble is that there&#39;s a small 
chance some other OS has a different sockopt at 38, and this could lead to 
the wrong answer.

Until then, though I&#39;d suggest just sticking to sockaddr_family&#40;&#41; of 
getsockname&#40;&#41; - that ought to be reliable enough I should think. Since 
SO_TYPE and SO_PROTOCOL come from Socket, those should pose no problem. If 
they work, they work, if not they don&#39;t.

It&#39;s a little too close to perl 5.16 feature-freeze to consider adding 
SO_DOMAIN to Socket now, however, as I am hoping to get the current 1.97_002 
tested in time to call it 1.98, but once that&#39;s done I&#39;ll add SO_DOMAIN / 
SO_FAMILY, and let you know.

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;16&nbsp;00:18:27&nbsp;2012</span>
    <span class="description">dkg [...] fifthhorseman.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> perl5-porters [...] perl.org, 659075 [...] bugs.debian.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #61577] -&gt;sockdomain and -&gt;socktype undefined on newly -&gt;accept&#39;ed sockets</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 16 Feb 2012 00:18:03 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-IO [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Daniel Kahn Gillmor &lt;dkg [...] fifthhorseman.net&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">leonerd-cpan@leonerd.org.uk wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m not too happy about this patch currently, because it just
&gt; &#34;guesses&#34; that sockopt 38 is SO_DOMAIN. I&#39;m aware that Socket doesn&#39;t
&gt; currently wrap SO_DOMAIN, and I&#39;m happy to add that. The trouble is
&gt; that there&#39;s a small chance some other OS has a different sockopt at
&gt; 38, and this could lead to the wrong answer.
</div>
i&#39;m pretty sure you mean 39 here, and not 38. :&#41;  I grabbed that value
From the Linux headers on my debian system, and upon a wider review,
you&#39;re absolutely right that this was inappropriate:

 <span class="clickylink"><a target="new" rel="nofollow" href="http://src.opensolaris.org/source/xref/onnv/onnv-gate/usr/src/uts/common/sys/socket.h#SO_DOMAIN">http://src.opensolaris.org/source/xref/onnv/onnv-gate/usr/src/uts/common/sys/socket.h#SO_DOMAIN</a></span>

I&#39;m attaching a revised, simplified patch that doesn&#39;t make this
non-portable assumption.  On a Debian GNU/Linux wheezy &#40;testing&#41; system
right now, it still passes all tests.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Until then, though I&#39;d suggest just sticking to sockaddr_family&#40;&#41; of
&gt; getsockname&#40;&#41; - that ought to be reliable enough I should think. 
</div>
<span class="clickylink"><a target="new" rel="nofollow" href="https://mail.gnome.org/archives/commits-list/2011-September/msg00944.html">https://mail.gnome.org/archives/commits-list/2011-September/msg00944.html</a></span>
suggests that on Solaris, if the socket isn&#39;t connected, getsockname&#40;&#41;
&#40;i.e. Socket::-&gt;sockname&#40;&#41;&#41; will return an addrlen of 0 and not set the
sockaddr.

So in that situation, we&#39;ll at least be no worse off than the current
implementation, which seems reasonable.

Debian folks -- is this now a patch that folks feel comfortable
applying in anticipation of such a fix upstream?

        --dkg
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- a/dist/IO/lib/IO/Socket.pm
+++ b/dist/IO/lib/IO/Socket.pm
@@ -336,18 +336,27 @@
 sub sockdomain {
     @_ == 1 or croak &#39;usage: $sock-&gt;sockdomain&#40;&#41;&#39;;
     my $sock = shift;
+    if &#40;!defined&#40;${*$sock}{&#39;io_socket_domain&#39;}&#41;&#41; {
+	my $addr = $sock-&gt;sockname&#40;&#41;;
+	${*$sock}{&#39;io_socket_domain&#39;} = sockaddr_family&#40;$addr&#41;
+	   if &#40;defined&#40;$addr&#41;&#41;;
+    }
     ${*$sock}{&#39;io_socket_domain&#39;};
 }
 
 sub socktype {
     @_ == 1 or croak &#39;usage: $sock-&gt;socktype&#40;&#41;&#39;;
     my $sock = shift;
+    ${*$sock}{&#39;io_socket_type&#39;} = $sock-&gt;sockopt&#40;SO_TYPE&#41;
+	unless defined&#40;${*$sock}{&#39;io_socket_type&#39;}&#41;;
     ${*$sock}{&#39;io_socket_type&#39;}
 }
 
 sub protocol {
     @_ == 1 or croak &#39;usage: $sock-&gt;protocol&#40;&#41;&#39;;
     my&#40;$sock&#41; = @_;
+    ${*$sock}{&#39;io_socket_proto&#39;} = $sock-&gt;sockopt&#40;SO_PROTOCOL&#41;
+	unless defined&#40;${*$sock}{&#39;io_socket_proto&#39;}&#41;;
     ${*$sock}{&#39;io_socket_proto&#39;};
 }
 
</div></div>
</div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;16&nbsp;19:22:23&nbsp;2012</span>
    <span class="description">dkg [...] fifthhorseman.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> perl5-porters [...] perl.org, 659075 [...] bugs.debian.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #61577] -&gt;sockdomain and -&gt;socktype undefined on newly -&gt;accept&#39;ed sockets</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 16 Feb 2012 19:22:05 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-IO [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Daniel Kahn Gillmor &lt;dkg [...] fifthhorseman.net&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, 16 Feb 2012 00:18:03 -0500, Daniel Kahn Gillmor &lt;dkg@fifthhorseman.net&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m attaching a revised, simplified patch that doesn&#39;t make this
&gt; non-portable assumption.  On a Debian GNU/Linux wheezy &#40;testing&#41; system
&gt; right now, it still passes all tests.
</div>
Sigh.  I tried the -v3 patch on a FreeBSD system &#40;which doesn&#39;t have
SO_PROTOCOL defined, apparently&#41;, and on such a system, the tests fail
hard &#40;perl process terminates with return code 29&#41; with the following
message:

   Your vendor has not defined Socket macro SO_PROTOCOL, used at
   /usr/lib/perl/5.14/IO/Socket.pm line 359

This is bad, and probably worse than just returning undefined as it has
up til now.

The attached patch &#40;v4&#41; should behave no worse than the existing
misbehavior on systems where SO_PROTOCOL &#40;or SO_TYPE&#41; is not defined by
the OS, while still re-populating missing cached data on operating
systems that do provide these sockopts.

Regards,

        --dkg
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- a/dist/IO/lib/IO/Socket.pm
+++ b/dist/IO/lib/IO/Socket.pm
@@ -336,18 +336,27 @@
 sub sockdomain {
     @_ == 1 or croak &#39;usage: $sock-&gt;sockdomain&#40;&#41;&#39;;
     my $sock = shift;
+    if &#40;!defined&#40;${*$sock}{&#39;io_socket_domain&#39;}&#41;&#41; {
+	my $addr = $sock-&gt;sockname&#40;&#41;;
+	${*$sock}{&#39;io_socket_domain&#39;} = sockaddr_family&#40;$addr&#41;
+	   if &#40;defined&#40;$addr&#41;&#41;;
+    }
     ${*$sock}{&#39;io_socket_domain&#39;};
 }
 
 sub socktype {
     @_ == 1 or croak &#39;usage: $sock-&gt;socktype&#40;&#41;&#39;;
     my $sock = shift;
+    ${*$sock}{&#39;io_socket_type&#39;} = $sock-&gt;sockopt&#40;Socket::SO_TYPE&#41;
+	if &#40;!defined&#40;${*$sock}{&#39;io_socket_type&#39;}&#41; &#38;&#38; defined&#40;eval{Socket::SO_TYPE}&#41;&#41;;
     ${*$sock}{&#39;io_socket_type&#39;}
 }
 
 sub protocol {
     @_ == 1 or croak &#39;usage: $sock-&gt;protocol&#40;&#41;&#39;;
     my&#40;$sock&#41; = @_;
+    ${*$sock}{&#39;io_socket_proto&#39;} = $sock-&gt;sockopt&#40;Socket::SO_PROTOCOL&#41;
+	if &#40;!defined&#40;${*$sock}{&#39;io_socket_proto&#39;}&#41; &#38;&#38; defined&#40;eval{Socket::SO_PROTOCOL}&#41;&#41;;
     ${*$sock}{&#39;io_socket_proto&#39;};
 }
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Feb&nbsp;16&nbsp;19:25:44&nbsp;2012</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Feb 14 15:58:56 2012, PEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It&#39;s a little too close to perl 5.16 feature-freeze to consider adding
&gt; SO_DOMAIN to Socket now, however, as I am hoping to get the current
&gt; 1.97_002
&gt; tested in time to call it 1.98, but once that&#39;s done I&#39;ll add
&gt; SO_DOMAIN /
&gt; SO_FAMILY, and let you know.
</div>
1.98_001 now on CPAN. Contains SO_DOMAIN. SO_FAMILY was already provided.

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;17&nbsp;17:33:27&nbsp;2012</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> dkg [...] fifthhorseman.net, perl5-porters [...] perl.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Feb 16 19:22:23 2012, dkg@fifthhorseman.net wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu, 16 Feb 2012 00:18:03 -0500, Daniel Kahn Gillmor
&gt; &lt;dkg@fifthhorseman.net&gt; wrote:
<div class="message-stanza open">&gt; &gt; I&#39;m attaching a revised, simplified patch that doesn&#39;t make this
&gt; &gt; non-portable assumption.  On a Debian GNU/Linux wheezy &#40;testing&#41;
</div>&gt; system
<div class="message-stanza open">&gt; &gt; right now, it still passes all tests.
</div>&gt; 
&gt; Sigh.  I tried the -v3 patch on a FreeBSD system &#40;which doesn&#39;t have
&gt; SO_PROTOCOL defined, apparently&#41;, and on such a system, the tests fail
&gt; hard &#40;perl process terminates with return code 29&#41; with the following
&gt; message:
&gt; 
&gt;    Your vendor has not defined Socket macro SO_PROTOCOL, used at
&gt;    /usr/lib/perl/5.14/IO/Socket.pm line 359
&gt; 
&gt; This is bad, and probably worse than just returning undefined as it
&gt; has
&gt; up til now.
&gt; 
&gt; The attached patch &#40;v4&#41; should behave no worse than the existing
&gt; misbehavior on systems where SO_PROTOCOL &#40;or SO_TYPE&#41; is not defined
&gt; by
&gt; the OS, while still re-populating missing cached data on operating
&gt; systems that do provide these sockopts.
&gt; 
&gt; Regards,
&gt; 
&gt;         --dkg
</div>
I’ve pushed your patches to the smoke-me/cpan61577 branch at perl5.git.perl.org.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;18&nbsp;14:15:09&nbsp;2012</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> dkg [...] fifthhorseman.net, perl5-porters [...] perl.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Feb 17 17:33:27 2012, SPROUT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu Feb 16 19:22:23 2012, dkg@fifthhorseman.net wrote:
<div class="message-stanza open">&gt; &gt; On Thu, 16 Feb 2012 00:18:03 -0500, Daniel Kahn Gillmor
&gt; &gt; &lt;dkg@fifthhorseman.net&gt; wrote:
<div class="message-stanza open">&gt; &gt; &gt; I&#39;m attaching a revised, simplified patch that doesn&#39;t make this
&gt; &gt; &gt; non-portable assumption.  On a Debian GNU/Linux wheezy &#40;testing&#41;
</div>&gt; &gt; system
<div class="message-stanza open">&gt; &gt; &gt; right now, it still passes all tests.
</div>&gt; &gt;
&gt; &gt; Sigh.  I tried the -v3 patch on a FreeBSD system &#40;which doesn&#39;t have
&gt; &gt; SO_PROTOCOL defined, apparently&#41;, and on such a system, the tests
</div>&gt; fail
<div class="message-stanza open">&gt; &gt; hard &#40;perl process terminates with return code 29&#41; with the
</div>&gt; following
<div class="message-stanza open">&gt; &gt; message:
&gt; &gt;
&gt; &gt;    Your vendor has not defined Socket macro SO_PROTOCOL, used at
&gt; &gt;    /usr/lib/perl/5.14/IO/Socket.pm line 359
&gt; &gt;
&gt; &gt; This is bad, and probably worse than just returning undefined as it
&gt; &gt; has
&gt; &gt; up til now.
&gt; &gt;
&gt; &gt; The attached patch &#40;v4&#41; should behave no worse than the existing
&gt; &gt; misbehavior on systems where SO_PROTOCOL &#40;or SO_TYPE&#41; is not defined
&gt; &gt; by
&gt; &gt; the OS, while still re-populating missing cached data on operating
&gt; &gt; systems that do provide these sockopts.
&gt; &gt;
&gt; &gt; Regards,
&gt; &gt;
&gt; &gt;         --dkg
</div>&gt; 
&gt; I’ve pushed your patches to the smoke-me/cpan61577 branch at
&gt; perl5.git.perl.org.
</div>
These tests are not passing for me on darwin:

Pint:perl.git sprout$ ./perl -Ilib dist/IO/t/cachepropagate-tcp.t
1..8
# Running under perl version 5.015007 for darwin
# Current time local: Sat Feb 18 11:13:49 2012
# Current time GMT:   Sat Feb 18 19:13:49 2012
# Using Test.pm version 1.25_02
ok 1
ok 2
ok 3
ok 4
ok 5
ok 5
not ok 6
# Test 6 got: &lt;UNDEF&gt; &#40;dist/IO/t/cachepropagate-tcp.t at line 39&#41;
#   Expected: &#34;6&#34;
#  dist/IO/t/cachepropagate-tcp.t line 39 is: ok&#40;$new-&gt;protocol&#40;&#41;, $p&#41;;
ok 7
ok 8
Pint:perl.git sprout$ ./perl -Ilib dist/IO/t/cachepropagate-udp.t
1..7
# Running under perl version 5.015007 for darwin
# Current time local: Sat Feb 18 11:13:59 2012
# Current time GMT:   Sat Feb 18 19:13:59 2012
# Using Test.pm version 1.25_02
ok 1
ok 2
ok 3
ok 4
not ok 5
# Test 5 got: &lt;UNDEF&gt; &#40;dist/IO/t/cachepropagate-udp.t at line 25&#41;
#   Expected: &#34;17&#34;
#  dist/IO/t/cachepropagate-udp.t line 25 is: ok&#40;$new-&gt;protocol&#40;&#41;, $p&#41;;
ok 6
ok 7
Pint:perl.git sprout$ ./perl -Ilib dist/IO/t/cachepropagate-unix.t
1..15
# Running under perl version 5.015007 for darwin
# Current time local: Sat Feb 18 11:14:05 2012
# Current time GMT:   Sat Feb 18 19:14:05 2012
# Using Test.pm version 1.25_02
ok 1
ok 2
ok 3
ok 4
ok 5
ok 5
not ok 6
# Test 6 got: &lt;UNDEF&gt; &#40;dist/IO/t/cachepropagate-unix.t at line 39&#41;
#   Expected: &#34;0&#34;
#  dist/IO/t/cachepropagate-unix.t line 39 is: ok&#40;$new-&gt;protocol&#40;&#41;, $p&#41;;
ok 7
ok 8
ok 9
ok 10
ok 11
ok 12
not ok 13
# Test 13 got: &lt;UNDEF&gt; &#40;dist/IO/t/cachepropagate-unix.t at line 61&#41;
#    Expected: &#34;0&#34;
#  dist/IO/t/cachepropagate-unix.t line 61 is: ok&#40;$new-&gt;protocol&#40;&#41;, $p&#41;;
ok 14
ok 15

Summary of my perl5 &#40;revision 5 version 15 subversion 7&#41; configuration:
  Derived from: c72a6582fd80cdcf24404819bef6101cdfb4f1c4
  Ancestor: a0ee90d6275e8e8ed2d2366771ed2111c3dc870d
  Platform:
    osname=darwin, osvers=10.5.0, archname=darwin-thread-multi-2level
    uname=&#39;darwin pint.local 10.5.0 darwin kernel version 10.5.0: fri nov 5 23:20:39 pdt 2010; 
root:xnu-1504.9.17~1release_i386 i386 &#39;
    config_args=&#39;-de -Dusedevel -DDEBUGGING -Duseithreads -Dmad&#39;
    hint=recommended, useposix=true, d_sigaction=define
    useithreads=define, usemultiplicity=define
    useperlio=define, d_sfio=undef, uselargefiles=define, usesocks=undef
    use64bitint=undef, use64bitall=undef, uselongdouble=undef
    usemymalloc=n, bincompat5005=undef
  Compiler:
    cc=&#39;cc&#39;, ccflags =&#39;-fno-common -DPERL_DARWIN -DDEBUGGING -fno-strict-aliasing -
pipe -fstack-protector -I/usr/local/include&#39;,
    optimize=&#39;-O3 -g&#39;,
    cppflags=&#39;-fno-common -DPERL_DARWIN -DDEBUGGING -fno-strict-aliasing -pipe -
fstack-protector -I/usr/local/include&#39;
    ccversion=&#39;&#39;, gccversion=&#39;4.2.1 &#40;Apple Inc. build 5664&#41;&#39;, gccosandvers=&#39;&#39;
    intsize=4, longsize=4, ptrsize=4, doublesize=8, byteorder=1234
    d_longlong=define, longlongsize=8, d_longdbl=define, longdblsize=16
    ivtype=&#39;long&#39;, ivsize=4, nvtype=&#39;double&#39;, nvsize=8, Off_t=&#39;off_t&#39;, lseeksize=8
    alignbytes=8, prototype=define
  Linker and Libraries:
    ld=&#39;env MACOSX_DEPLOYMENT_TARGET=10.3 cc&#39;, ldflags =&#39; -fstack-protector -
L/usr/local/lib&#39;
    libpth=/usr/local/lib /usr/lib
    libs=-ldbm -ldl -lm -lutil -lc
    perllibs=-ldl -lm -lutil -lc
    libc=, so=dylib, useshrplib=false, libperl=libperl.a
    gnulibc_version=&#39;&#39;
  Dynamic Linking:
    dlsrc=dl_dlopen.xs, dlext=bundle, d_dlsymun=undef, ccdlflags=&#39; &#39;
    cccdlflags=&#39; &#39;, lddlflags=&#39; -bundle -undefined dynamic_lookup -L/usr/local/lib -fstack-
protector&#39;


Characteristics of this binary &#40;from libperl&#41;: 
  Compile-time options: DEBUGGING HAS_TIMES MULTIPLICITY PERLIO_LAYERS
                        PERL_DONT_CREATE_GVSV PERL_IMPLICIT_CONTEXT PERL_MAD
                        PERL_MALLOC_WRAP PERL_PRESERVE_IVUV
                        PERL_TRACK_MEMPOOL PERL_USE_DEVEL USE_ITHREADS
                        USE_LARGE_FILES USE_LOCALE USE_LOCALE_COLLATE
                        USE_LOCALE_CTYPE USE_LOCALE_NUMERIC USE_PERLIO
                        USE_PERL_ATOF USE_REENTRANT_API
  Locally applied patches:
        uncommitted-changes
        c72a6582fd80cdcf24404819bef6101cdfb4f1c4
  Built under darwin
  Compiled at Feb 17 2012 14:40:56
  @INC:
    lib
    /usr/local/lib/perl5/site_perl/5.15.7/darwin-thread-multi-2level
    /usr/local/lib/perl5/site_perl/5.15.7
    /usr/local/lib/perl5/5.15.7/darwin-thread-multi-2level
    /usr/local/lib/perl5/5.15.7
    /usr/local/lib/perl5/site_perl
    .
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;19&nbsp;18:25:58&nbsp;2012</span>
    <span class="description">dkg [...] fifthhorseman.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> perl5-porters [...] perl.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #61577] -&gt;sockdomain and -&gt;socktype undefined on newly -&gt;accept&#39;ed sockets</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 19 Feb 2012 18:25:52 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-IO [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Daniel Kahn Gillmor &lt;dkg [...] fifthhorseman.net&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 02/18/2012 02:15 PM, Father Chrysostomos via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; These tests are not passing for me on darwin:
&gt; 
&gt; Pint:perl.git sprout$ ./perl -Ilib dist/IO/t/cachepropagate-tcp.t
</div>[...]
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; not ok 6
&gt; # Test 6 got: &lt;UNDEF&gt; &#40;dist/IO/t/cachepropagate-tcp.t at line 39&#41;
&gt; #   Expected: &#34;6&#34;
&gt; #  dist/IO/t/cachepropagate-tcp.t line 39 is: ok&#40;$new-&gt;protocol&#40;&#41;, $p&#41;;
</div>[...]
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Pint:perl.git sprout$ ./perl -Ilib dist/IO/t/cachepropagate-udp.t
</div>[...]
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; not ok 5
&gt; # Test 5 got: &lt;UNDEF&gt; &#40;dist/IO/t/cachepropagate-udp.t at line 25&#41;
&gt; #   Expected: &#34;17&#34;
&gt; #  dist/IO/t/cachepropagate-udp.t line 25 is: ok&#40;$new-&gt;protocol&#40;&#41;, $p&#41;;
</div>[...]
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Pint:perl.git sprout$ ./perl -Ilib dist/IO/t/cachepropagate-unix.t
</div>[...]
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; not ok 6
&gt; # Test 6 got: &lt;UNDEF&gt; &#40;dist/IO/t/cachepropagate-unix.t at line 39&#41;
&gt; #   Expected: &#34;0&#34;
&gt; #  dist/IO/t/cachepropagate-unix.t line 39 is: ok&#40;$new-&gt;protocol&#40;&#41;, $p&#41;;
</div>[...]
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; not ok 13
&gt; # Test 13 got: &lt;UNDEF&gt; &#40;dist/IO/t/cachepropagate-unix.t at line 61&#41;
&gt; #    Expected: &#34;0&#34;
&gt; #  dist/IO/t/cachepropagate-unix.t line 61 is: ok&#40;$new-&gt;protocol&#40;&#41;, $p&#41;;
</div>

This indicates that darwin does not have SO_PROTOCOL defined.  The
number of failed tests with the patch should be less than the number of
failed tests without the patch, but on systems with no SO_PROTOCOL or
SO_TYPE defined in Socket, some of the tests will still fail.

Perhaps a porter familiar with Darwin wants to propose a way to request
the protocol identifier for a given socket?

Would perl&#39;s development approach need such a fix &#40;for darwin and other
no-SO_PROTOCOL architectures&#41; in order to accept the patchset upstream
even though it fixes a bunch of failures on many architectures?

        --dkg
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;19&nbsp;19:11:15&nbsp;2012</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">By the way, a far simply way to solve this entire problem is just to
copy the values from the parent socket at -&gt;accept time:

<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/PEVANS/IO-Socket-IP-0.08/lib/IO/Socket/IP.pm#L655">https://metacpan.org/source/PEVANS/IO-Socket-IP-0.08/lib/IO/Socket/IP.pm#L655</a></span>

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;19&nbsp;19:11:58&nbsp;2012</span>
    <span class="description">leonerd-cpan [...] leonerd.org.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Feb 19 19:11:15 2012, PEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; By the way, a far simply way to solve this entire problem is just to
&gt; copy the values from the parent socket at -&gt;accept time:
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/PEVANS/IO-Socket-IP-">https://metacpan.org/source/PEVANS/IO-Socket-IP-</a></span>
&gt; 0.08/lib/IO/Socket/IP.pm#L655
</div>
Or, since that link didn&#39;t quite work properly:

sub accept
{
   my $self = shift;
   my &#40; $new, $peer &#41; = $self-&gt;SUPER::accept or return;
 
   ${*$new}{$_} = ${*$self}{$_} for qw&#40; io_socket_domain io_socket_type
io_socket_proto &#41;;
 
   return wantarray ? &#40; $new, $peer &#41;
                    : $new;
}

-- 

Paul Evans
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;24&nbsp;15:11:50&nbsp;2012</span>
    <span class="description">DKG [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Feb 19 19:11:15 2012, PEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; By the way, a far simply way to solve this entire problem is just to
&gt; copy the values from the parent socket at -&gt;accept time:
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/PEVANS/IO-Socket-IP-">https://metacpan.org/source/PEVANS/IO-Socket-IP-</a></span>
&gt; 0.08/lib/IO/Socket/IP.pm#L655
</div>

Unfortunately, the problem isn&#39;t just caused by accept&#40;&#41;.  there are
several other ways that these values can fail to propagate &#40;e.g.
new_from_fd&#40;&#41;, etc&#41;, and not all of them are fixable in the way you
describe.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;28&nbsp;12:55:43&nbsp;2012</span>
    <span class="description">dkg [...] fifthhorseman.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> perl5-porters [...] perl.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #61577] -&gt;sockdomain and -&gt;socktype undefined on newly -&gt;accept&#39;ed sockets</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 28 Feb 2012 12:55:55 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-IO [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Daniel Kahn Gillmor &lt;dkg [...] fifthhorseman.net&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun, 19 Feb 2012 18:25:52 -0500, Daniel Kahn Gillmor &lt;dkg@fifthhorseman.net&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This indicates that darwin does not have SO_PROTOCOL defined.  The
&gt; number of failed tests with the patch should be less than the number of
&gt; failed tests without the patch, but on systems with no SO_PROTOCOL or
&gt; SO_TYPE defined in Socket, some of the tests will still fail.
</div>
As i noted earlier, this same failure will happen with FreeBSD since it
does not define SO_PROTOCOL either.

However, i just learned that FreeBSD is about to get SO_PROTOCOL:

  <span class="clickylink"><a target="new" rel="nofollow" href="http://www.freebsd.org/cgi/query-pr.cgi?pr=162352">http://www.freebsd.org/cgi/query-pr.cgi?pr=162352</a></span>

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Perhaps a porter familiar with Darwin wants to propose a way to request
&gt; the protocol identifier for a given socket?
</div>
This question is still outstanding.  I don&#39;t have a Darwin machine to
experiment with.

Can we get these fixes into IO::Socket?

    --dkg
</div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;07&nbsp;05:51:27&nbsp;2012</span>
    <span class="description">intrigeri [...] boum.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> 659075 [...] bugs.debian.org,  bug-IO [...] rt.cpan.org,  perl5-porters [...] perl.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: Bug#659075: [rt.cpan.org #61577] -&gt;sockdomain and -&gt;socktype undefined on newly -&gt;accept&#39;ed sockets</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 07 Apr 2012 11:51:08 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Daniel Kahn Gillmor &lt;dkg [...] fifthhorseman.net&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> intrigeri &lt;intrigeri [...] boum.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

I confirm Daniel&#39;s v4 patch fixes Debian#607674 and RT#68282 for me,
and eventually allows me to run a recent Net::Server.

Thanks, Daniel, for your persistence in getting this bug fixed both
upstream and in Debian.

Cheers,
--
  intrigeri
  | GnuPG key @ <span class="clickylink"><a target="new" rel="nofollow" href="https://gaffer.ptitcanardnoir.org/intrigeri/intrigeri.asc">https://gaffer.ptitcanardnoir.org/intrigeri/intrigeri.asc</a></span>
  | OTR fingerprint @ <span class="clickylink"><a target="new" rel="nofollow" href="https://gaffer.ptitcanardnoir.org/intrigeri/otr.asc">https://gaffer.ptitcanardnoir.org/intrigeri/otr.asc</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;02&nbsp;18:35:55&nbsp;2012</span>
    <span class="description">dom [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is also 

<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.perl.org/rt3/Ticket/Display.html?id=112736">https://rt.perl.org/rt3/Ticket/Display.html?id=112736</a></span>

created since IO::Socket is core-maintained.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;10&nbsp;15:45:19&nbsp;2012</span>
    <span class="description">$_ = &#39;spro^^*%*^6ut# [...] &#38;$%*c&gt;#!^!#&#38;!pan.org&#39;; y/a-z.@//cd; print -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is resolved by perl commits 271d04eee, b6903614d and 01b71c89216.  But I don’t have 
permission to mark it as such.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;19&nbsp;18:37:00&nbsp;2018</span>
    <span class="description">TODDR [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ticket migrated to github as <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/toddr/IO/issues/40">https://github.com/toddr/IO/issues/40</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;19&nbsp;18:37:00&nbsp;2018</span>
    <span class="description">TODDR [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
