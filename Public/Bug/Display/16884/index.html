<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #16884 for SOAP-Lite: Sending an XML string using SOAP::Lite doesn&#39;t work</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #16884 for SOAP-Lite: Sending an XML string using SOAP::Lite doesn&#39;t work</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/SOAP-Lite/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/SOAP-Lite/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/SOAP-Lite/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/SOAP-Lite/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/SOAP-Lite">SOAP-Lite CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">16884</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/SOAP-Lite/Active/">SOAP-Lite</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
d.rowles [...] outcometechnologies.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-29122-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.66    </td>
  </tr>
  <tr id="CF-29123-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;03&nbsp;08:46:51&nbsp;2006</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Sending an XML string using SOAP::Lite doesn&#39;t work</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The attached patch adds some tests to the SOAP::Lite test suite that attempt to serialize and deserialize an XML string. These tests fail using perl 5.8.3, SOAP::Lite 0.66 on Debian Linux, expat 1.95.8-3.

These tests die with:-
  &#34;xml declaration not at start of external entity at line 1, column 391, byte 391 at /opt/perl/lib/site_perl/5.8.3/XML/Parser.pm line 187&#34;

I&#39;m not at all familiar with the SOAP::Lite internals or with the test suite - so I *believe* that these tests are correctly demonstrating my problem, however please let me know if there are any problems.
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -urN SOAP-Lite-0.66.orig/t/01-core.t SOAP-Lite-0.66.new/t/01-core.t
--- SOAP-Lite-0.66.orig/t/01-core.t	2005-05-15 21:22:37.000000000 +0100
+++ SOAP-Lite-0.66.new/t/01-core.t	2006-01-03 13:43:54.000000000 +0000
@@ -10,7 +10,7 @@
 use strict;
 use Test;
 
-BEGIN { plan tests =&gt; 35; }
+BEGIN { plan tests =&gt; 49; }
 
 use SOAP::Lite;
 
@@ -275,3 +275,52 @@
   $ret = $deserializer-&gt;deserialize&#40;$input&#41;;
   ok&#40;&#34;one&#34; eq $ret-&gt;result-&gt;{&#39;complexFoo&#39;}{&#39;arrayFoo&#39;}&#41;;
 }
+
+
+
+
+# Check that serialization and deserialization of XML strings works OK too
+#
+{
+    # Firstly, check that this works for normal data....
+    print &#34;Testing serialization / deserialization of XML entities part 1... \n&#34;;
+
+    my @args = &#40;&#34;bob&#34;, &#40;bless { &#34;name&#34; =&gt; &#34;Bob&#34; }, &#34;My::Module&#34;&#41;, 27, &#34;&lt;hello&gt;World!&lt;/hello&gt;&#34;&#41;;
+    my $serializer = SOAP::Serializer-&gt;new&#40;&#41;;
+    my $deserializer = SOAP::Deserializer-&gt;new&#40;&#41;;
+    my $out = $deserializer-&gt;deserialize&#40;$serializer-&gt;serialize&#40;\@args&#41;&#41;-&gt;root;
+    ok&#40;ref&#40;$out&#41;, &#34;ARRAY&#34;&#41;;
+    ok&#40;$out-&gt;[0], &#34;bob&#34;&#41;;
+    ok&#40;UNIVERSAL::isa&#40;$out-&gt;[1], &#34;My::Module&#34;&#41;&#41;;
+    ok&#40;$out-&gt;[1]-&gt;{name}, &#34;Bob&#34;&#41;;
+    ok&#40;$out-&gt;[2], 27&#41;;
+    ok&#40;$out-&gt;[3], &#34;&lt;hello&gt;World!&lt;/hello&gt;&#34;&#41;;
+}
+
+{
+    print &#34;Testing serialization / deserialization of XML entities part 2... \n&#34;;
+
+    # Now make one of our thingies an XML string that includes a namespace
+    my @args = &#40;&#34;bob&#34;, &#39;&lt;hello xmlns:bob=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.example.com/bob">http://www.example.com/bob</a></span>&#34;&gt;World!&lt;/hello&gt;&#39;, &#34;Bobbage&#34;&#41;;
+    my $serializer = SOAP::Serializer-&gt;new&#40;&#41;;
+    my $deserializer = SOAP::Deserializer-&gt;new&#40;&#41;;
+    my $out = $deserializer-&gt;deserialize&#40;$serializer-&gt;serialize&#40;\@args&#41;&#41;-&gt;root;
+    ok&#40;ref&#40;$out&#41;, &#34;ARRAY&#34;&#41;;
+    ok&#40;$out-&gt;[0], $args[0]&#41;;
+    ok&#40;$out-&gt;[1], $args[1]&#41;;
+    ok&#40;$out-&gt;[2], $args[2]&#41;;
+}
+
+{
+    print &#34;Testing serialization / deserialization of XML entities part 3... \n&#34;;
+
+    # Finally, add an xml header, and watch things die.....
+    my @args = &#40;&#34;bob&#34;, &#39;&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;hello xmlns:bob=&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.example.com/bob">http://www.example.com/bob</a></span>&#34;&gt;World!&lt;/hello&gt;&#39;, &#34;Bobbage&#34;&#41;;
+    my $serializer = SOAP::Serializer-&gt;new&#40;&#41;;
+    my $deserializer = SOAP::Deserializer-&gt;new&#40;&#41;;
+    my $out = $deserializer-&gt;deserialize&#40;$serializer-&gt;serialize&#40;\@args&#41;&#41;-&gt;root;
+    ok&#40;ref&#40;$out&#41;, &#34;ARRAY&#34;&#41;;
+    ok&#40;$out-&gt;[0], $args[0]&#41;;
+    ok&#40;$out-&gt;[1], $args[1]&#41;;
+    ok&#40;$out-&gt;[2], $args[2]&#41;;
+}
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;30&nbsp;15:39:39&nbsp;2008</span>
    <span class="description">kutterma [...] users.sourceforge.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

The XML spec disallows the use of a XML declaration statement &#40;the
&lt;?...?&gt; stuff after the beginning of the document.

That is, you may not store an unescaped XML declaration inside a
SOAP::Data node.

This is a restriction &#40;not a bug&#41; of XML, not of SOAP::Lite.

Regards,

Martin
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;30&nbsp;15:39:54&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;30&nbsp;15:40:08&nbsp;2008</span>
    <span class="description">kutterma [...] users.sourceforge.net -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;12&nbsp;20:31:24&nbsp;2008</span>
    <span class="description">d.rowles [...] outcometechnologies.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #16884] Sending an XML string using SOAP::Lite doesn&#39;t work</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 12 Feb 2008 22:41:42 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SOAP-Lite [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dan Rowles &lt;d.rowles [...] outcometechnologies.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

We&#39;re using a SOAP::Server object in order to allow a client to access 
some methods in a class.

On the server side, the code uses an exception object that captures the 
call stack and arguments when it is thrown, and we&#39;re sending that back 
to the client. This allows the client to see exactly what went wrong on 
the server, which is really handy during development.

Unfortunately, the exception object picks up a call to 
&#34;SOAP::Server::handle&#34; that includes the raw XML. SOAP::Lite does not 
encode this &#40;eg in Base64&#41;, so that the XML that is sent across the wire 
looks like:-

.... some stuff ....
&lt;item xsi:type=&#34;xsd:anyURI&#34;&gt;Called 
SOAP::Server::handle&#40;SOAP::Transport::HTTP::Server=HASH&#40;0x87e7538&#41;, 
&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;&lt;soap:Envelope
.... etc ....

This can&#39;t then be decoded at the client end &#40;which is fair enough, 
really, as it&#39;s invalid XML&#41;.

My suggestion is that SOAP::Lite should check to see if it is encoding a 
string that contains XML, and if so, should Base64 encode it first, when 
it is serializing a datastructure.

Thanks,

Dan





Martin Kutter via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=16884">http://rt.cpan.org/Ticket/Display.html?id=16884</a></span> &gt;
&gt; 
&gt; Hi,
&gt; 
&gt; The XML spec disallows the use of a XML declaration statement &#40;the
&gt; &lt;?...?&gt; stuff after the beginning of the document.
&gt; 
&gt; That is, you may not store an unescaped XML declaration inside a
&gt; SOAP::Data node.
&gt; 
&gt; This is a restriction &#40;not a bug&#41; of XML, not of SOAP::Lite.
&gt; 
&gt; Regards,
&gt; 
&gt; Martin
</div>
-- 
Dan Rowles
Outcome Technologies Ltd
BUPA House, 15-19 Bloomsbury Way, London WC1A 2BA
Registered in England, No: 3829851
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Feb&nbsp;12&nbsp;20:31:29&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;rejected&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;16&nbsp;05:19:54&nbsp;2008</span>
    <span class="description">kutterma [...] users.sourceforge.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

you may trigger encoding data as base64 by passing it as SOAP::Data
object to SOAP::Lite:

SOAP::Data-&gt;type&#40;&#39;base64binary&#39;&#41;-&gt;name&#40;&#39;element name&#39;&#41;-&gt;value&#40;$xml&#41;

Encoding XML by default would break all clients/servers, which put some
&#40;valid&#41; XML fragment inside the SOAP envelope &#40;that is SOAP::Lite apps
which decide to built up the body content&#39;s XML by themselves&#41;.

Regards,

Martin
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;16&nbsp;05:20:12&nbsp;2008</span>
    <span class="description">kutterma [...] users.sourceforge.net -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
