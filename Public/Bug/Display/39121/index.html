<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #39121 for DBIx-Class: hierarchical queries - Postgres WITH</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #39121 for DBIx-Class: hierarchical queries - Postgres WITH</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/DBIx-Class/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/DBIx-Class/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/DBIx-Class/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/DBIx-Class/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBIx-Class">DBIx-Class CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">39121</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">stalled</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/DBIx-Class/Active/">DBIx-Class</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
alex [...] keusch.at

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
rbo [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-10410-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10411-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;09&nbsp;11:04:16&nbsp;2008</span>
    <span class="description">alex [...] keusch.at -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [patch] hierarchical queries - oracle specific</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Oracle supports a Oracle specific syntax to run hierarchical queries:
<span class="clickylink"><a target="new" rel="nofollow" href="http://download.oracle.com/docs/cd/B19306_01/server.102/b14200/queries003.htm">http://download.oracle.com/docs/cd/B19306_01/server.102/b14200/queries003.htm</a></span>

This patch enables the Oracle storage modul to handle the
resultset-attributes &#39;connect_by&#39;, &#39;start_with&#39;, and
&#39;order_siblings_by&#39;. This makes it possible to run hierarchical queries
through DBIx::Class.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> oracle-hierarchical-queries.patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -Nurb DBIx-Class-0.08010-orig/lib/DBIx/Class/Storage/DBI/Oracle/Generic.pm DBIx-Class-0.08010/lib/DBIx/Class/Storage/DBI/Oracle/Generic.pm
--- DBIx-Class-0.08010-orig/lib/DBIx/Class/Storage/DBI/Oracle/Generic.pm	2007-09-04 20:33:11.000000000 +0200
+++ DBIx-Class-0.08010/lib/DBIx/Class/Storage/DBI/Oracle/Generic.pm	2008-09-09 16:47:57.000000000 +0200
@@ -4,9 +4,69 @@
 use strict;
 use warnings;
 
+__PACKAGE__-&gt;sql_maker_class&#40;&#39;DBIC::SQL::Abstract::Oracle&#39;&#41;;
+
+BEGIN {
+  package DBIC::SQL::Abstract::Oracle;
+
+  use base qw&#40; DBIC::SQL::Abstract &#41;;
+
+  sub select {
+    my &#40;$self, $table, $fields, $where, $order, @rest&#41; = @_;
+
+    my $db_specific_attrs = pop @rest;
+
+    my &#40;$sql, @bind&#41; = $self-&gt;SUPER::select&#40;$table, $fields, $where, $order, @rest&#41;;
+    my &#40;$cb_sql, @cb_bind&#41; = $self-&gt;_connect_by&#40;$db_specific_attrs&#41;;
+    $sql .= $cb_sql;
+    push @bind, @cb_bind;
+
+    return wantarray ? &#40;$sql, @bind&#41; : $sql;
+  }
+
+  sub _connect_by {
+    my &#40;$self, $attrs&#41; = @_;
+    my $sql = &#39;&#39;;
+    my @bind;
+
+    if &#40; ref&#40;$attrs&#41; eq &#39;HASH&#39; &#41; {
+      if &#40; $attrs-&gt;{&#39;start_with&#39;} &#41; {
+        my &#40;$ws, @wb&#41; = $self-&gt;_recurse_where&#40; $attrs-&gt;{&#39;start_with&#39;} &#41;;
+        $sql .= $self-&gt;_sqlcase&#40;&#39; start with &#39;&#41; . $ws;
+        push @bind, @wb;
+      }
+      if &#40; my $connect_by = $attrs-&gt;{&#39;connect_by&#39;}&#41; {
+        $sql .= $self-&gt;_sqlcase&#40;&#39; connect by&#39;&#41;;
+        foreach my $key &#40; keys %$connect_by &#41; {
+          $sql .= &#34; $key = &#34; . $connect_by-&gt;{$key};
+        }
+      }
+      if &#40; $attrs-&gt;{&#39;order_siblings_by&#39;} &#41; {
+        $sql .= $self-&gt;_order_siblings_by&#40; $attrs-&gt;{&#39;order_siblings_by&#39;} &#41;;
+      }
+    }
+
+    return wantarray ? &#40;$sql, @bind&#41; : $sql;
+  }
+
+  sub _order_siblings_by {
+    my $self = shift;
+    my $ref = ref $_[0];
+
+    my @vals = $ref eq &#39;ARRAY&#39;  ? @{$_[0]} :
+               $ref eq &#39;SCALAR&#39; ? ${$_[0]} :
+               $ref eq &#39;&#39;       ? $_[0]    :
+               puke&#40; &#34;Unsupported data struct $ref for ORDER SIBILINGS BY&#34; &#41;;
+
+    my $val = join &#39;, &#39;, map { $self-&gt;_quote&#40;$_&#41; } @vals;
+    return $val ? $self-&gt;_sqlcase&#40;&#39; order siblings by&#39;&#41;.&#34; $val&#34; : &#39;&#39;;
+  }
+
+} # end of BEGIN - package DBIC::SQL::Abstract::Oracle
+
 =head1 NAME
 
-DBIx::Class::Storage::DBI::Oracle - Automatic primary key class for Oracle
+DBIx::Class::Storage::DBI::Oracle - Automatic primary key class and &#34;Connect By&#34; support for Oracle
 
 =head1 SYNOPSIS
 
@@ -15,12 +75,67 @@
   __PACKAGE__-&gt;set_primary_key&#40;&#39;id&#39;&#41;;
   __PACKAGE__-&gt;sequence&#40;&#39;mysequence&#39;&#41;;
 
+  # with a resultset using a hierarchical relationship
+  my $rs = $schema-&gt;resultset&#40;&#39;Person&#39;&#41;-&gt;search&#40;{},
+                {
+                  &#39;start_with&#39; =&gt; { &#39;firstname&#39; =&gt; &#39;Foo&#39;, &#39;lastname&#39; =&gt; &#39;Bar&#39; },
+                  &#39;connect_by&#39; =&gt; { &#39;parentid&#39; =&gt; &#39;prior persionid&#39;},
+                  &#39;order_siblings_by&#39; =&gt; &#39;firstname ASC&#39;,
+                };
+  &#41;;
+
 =head1 DESCRIPTION
 
-This class implements autoincrements for Oracle.
+This class implements autoincrements for Oracle and adds support for Oracle
+specific hierarchical queries.
 
 =head1 METHODS
 
+=head1 ATTRIBUTES
+
+Following additional attributes can be used in resultsets.
+
+=head2 connect_by
+
+=over 4
+
+=item Value: \%connect_by
+
+=back
+
+A hashref of conditions used to specify the relationship between parent rows
+and child rows of the hierarchy.
+
+  connect_by =&gt; { parentid =&gt; &#39;prior personid&#39; }
+
+=head2 start_with
+
+=over 4
+
+=item Value: \%condition
+
+=back
+
+A hashref of conditions which specify the root row&#40;s&#41; of the hierarchy.
+
+It uses the same syntax as L&lt;DBIx::Class::ResultSet/search&gt;
+
+  start_with =&gt; { firstname =&gt; &#39;Foo&#39;, lastname =&gt; &#39;Bar&#39; }
+
+=head2 order_siblings_by
+
+=over 4
+
+=item Value: &#40;$order_siblings_by | \@order_siblings_by&#41;
+
+=back
+
+Which column&#40;s&#41; to order the siblings by.
+
+It uses the same syntax as L&lt;DBIx::Class::ResultSet/order_by&gt;
+
+  &#39;order_siblings_by&#39; =&gt; &#39;firstname ASC&#39;
+
 =cut
 
 use Carp::Clan qw/^DBIx::Class/;
@@ -29,6 +144,21 @@
 
 # __PACKAGE__-&gt;load_components&#40;qw/PK::Auto/&#41;;
 
+sub _db_specific_attrs {
+  my &#40;$self, $attrs&#41; = @_;
+
+  my $rv = {};
+  if &#40; $attrs-&gt;{connect_by} || $attrs-&gt;{start_with} || $attrs-&gt;{order_siblings_by} &#41; {
+    $rv = {
+      connect_by =&gt; $attrs-&gt;{connect_by},
+      start_with =&gt; $attrs-&gt;{start_with},
+      order_siblings_by =&gt; $attrs-&gt;{order_siblings_by},
+    }
+  }
+
+  return $rv;
+}
+
 sub _dbh_last_insert_id {
   my &#40;$self, $dbh, $source, $col&#41; = @_;
   my $seq = &#40;$source-&gt;column_info&#40;$col&#41;-&gt;{sequence} ||= $self-&gt;get_autoinc_seq&#40;$source,$col&#41;&#41;;
diff -Nurb DBIx-Class-0.08010-orig/lib/DBIx/Class/Storage/DBI.pm DBIx-Class-0.08010/lib/DBIx/Class/Storage/DBI.pm
--- DBIx-Class-0.08010-orig/lib/DBIx/Class/Storage/DBI.pm	2008-02-27 14:49:09.000000000 +0100
+++ DBIx-Class-0.08010/lib/DBIx/Class/Storage/DBI.pm	2008-09-09 14:31:17.000000000 +0200
@@ -1125,9 +1125,18 @@
     push @args, $attrs-&gt;{rows}, $attrs-&gt;{offset};
   }
 
+  # give DB specific DBI subclasses the chance to pass DB specific attributes to
+  # the spl_maker, without overriding the whole _select method
+  if &#40;my $db_specific_attrs = $self-&gt;_db_specific_attrs&#40;$attrs&#41; &#41; {
+    push @args, $db_specific_attrs;
+  }
+
   return $self-&gt;_execute&#40;@args&#41;;
 }
 
+# override this method to add DB specific attributes
+sub _db_specific_attrs { undef; }
+
 sub source_bind_attributes {
   my &#40;$self, $source&#41; = @_;
   
diff -Nurb DBIx-Class-0.08010-orig/t/73oracle.t DBIx-Class-0.08010/t/73oracle.t
--- DBIx-Class-0.08010-orig/t/73oracle.t	2007-08-11 23:07:59.000000000 +0200
+++ DBIx-Class-0.08010/t/73oracle.t	2008-09-09 16:52:47.000000000 +0200
@@ -11,7 +11,7 @@
   &#39;Warning: This test drops and creates tables called \&#39;artist\&#39;, \&#39;cd\&#39; and \&#39;track\&#39;&#39;
   unless &#40;$dsn &#38;&#38; $user &#38;&#38; $pass&#41;;
 
-plan tests =&gt; 7;
+plan tests =&gt; 14;
 
 my $schema = DBICTest::Schema-&gt;connect&#40;$dsn, $user, $pass&#41;;
 
@@ -24,10 +24,12 @@
   $dbh-&gt;do&#40;&#34;DROP TABLE track&#34;&#41;;
 };
 $dbh-&gt;do&#40;&#34;CREATE SEQUENCE artist_seq START WITH 1 MAXVALUE 999999 MINVALUE 0&#34;&#41;;
-$dbh-&gt;do&#40;&#34;CREATE TABLE artist &#40;artistid NUMBER&#40;12&#41;, name VARCHAR&#40;255&#41;&#41;&#34;&#41;;
+$dbh-&gt;do&#40;&#34;CREATE TABLE artist &#40;artistid NUMBER&#40;12&#41;, parentid NUMBER&#40;12&#41;, name VARCHAR&#40;255&#41;&#41;&#34;&#41;;
 $dbh-&gt;do&#40;&#34;CREATE TABLE cd &#40;cdid NUMBER&#40;12&#41;, artist NUMBER&#40;12&#41;, title VARCHAR&#40;255&#41;, year VARCHAR&#40;4&#41;&#41;&#34;&#41;;
 $dbh-&gt;do&#40;&#34;CREATE TABLE track &#40;trackid NUMBER&#40;12&#41;, cd NUMBER&#40;12&#41;, position NUMBER&#40;12&#41;, title VARCHAR&#40;255&#41;, last_updated_on DATE&#41;&#34;&#41;;
 
+$schema-&gt;class&#40;&#39;Artist&#39;&#41;-&gt;add_columns&#40;&#39;parentid&#39;&#41;;
+
 $dbh-&gt;do&#40;&#34;ALTER TABLE artist ADD &#40;CONSTRAINT artist_pk PRIMARY KEY &#40;artistid&#41;&#41;&#34;&#41;;
 $dbh-&gt;do&#40;qq{
   CREATE OR REPLACE TRIGGER artist_insert_trg
@@ -95,6 +97,71 @@
   is&#40; scalar @results, 1, &#34;Group by with limit OK&#34; &#41;;
 }
 
+# create a tree of artists
+my $afoo_id = $schema-&gt;resultset&#40;&#39;Artist&#39;&#41;-&gt;create&#40;{ name =&gt; &#39;afoo&#39;, parentid =&gt; 1 }&#41;-&gt;id;
+$schema-&gt;resultset&#40;&#39;Artist&#39;&#41;-&gt;create&#40;{ name =&gt; &#39;bfoo&#39;, parentid =&gt; 1 }&#41;;
+my $cfoo_id = $schema-&gt;resultset&#40;&#39;Artist&#39;&#41;-&gt;create&#40;{ name =&gt; &#39;cfoo&#39;, parentid =&gt; $afoo_id }&#41;-&gt;id;
+$schema-&gt;resultset&#40;&#39;Artist&#39;&#41;-&gt;create&#40;{ name =&gt; &#39;dfoo&#39;, parentid =&gt; $cfoo_id }&#41;;
+my $xfoo_id = $schema-&gt;resultset&#40;&#39;Artist&#39;&#41;-&gt;create&#40;{ name =&gt; &#39;xfoo&#39; }&#41;-&gt;id;
+
+# create some cds and tracks
+$schema-&gt;resultset&#40;&#39;CD&#39;&#41;-&gt;create&#40;{ cdid =&gt; 2, artist =&gt; $cfoo_id, title =&gt; &#34;cfoo&#39;s cd&#34;, year =&gt; &#39;2008&#39; }&#41;;
+$schema-&gt;resultset&#40;&#39;Track&#39;&#41;-&gt;create&#40;{ trackid =&gt; 2, cd =&gt; 2, position =&gt; 1, title =&gt; &#39;Track1 cfoo&#39; }&#41;;
+$schema-&gt;resultset&#40;&#39;CD&#39;&#41;-&gt;create&#40;{ cdid =&gt; 3, artist =&gt; $xfoo_id, title =&gt; &#34;xfoo&#39;s cd&#34;, year =&gt; &#39;2008&#39; }&#41;;
+$schema-&gt;resultset&#40;&#39;Track&#39;&#41;-&gt;create&#40;{ trackid =&gt; 3, cd =&gt; 3, position =&gt; 1, title =&gt; &#39;Track1 xfoo&#39; }&#41;;
+
+{
+  my $rs = $schema-&gt;resultset&#40;&#39;Artist&#39;&#41;-&gt;search&#40;{}, # get the whole tree
+                          {
+                            &#39;start_with&#39; =&gt; { &#39;name&#39; =&gt; &#39;foo&#39; },
+                            &#39;connect_by&#39; =&gt; { &#39;parentid&#39; =&gt; &#39;prior artistid&#39;},
+                          }&#41;;
+  is&#40; $rs-&gt;count, 5, &#39;Connect By count ok&#39; &#41;;
+  my $ok = 1;
+  foreach my $node_name &#40;qw&#40;foo afoo cfoo dfoo bfoo&#41;&#41; {
+    $ok = 0 if $rs-&gt;next-&gt;name ne $node_name;
+  }
+  ok&#40; $ok, &#39;got artist tree&#39;&#41;;
+}
+
+{
+  # use order siblings by statement
+  my $rs = $schema-&gt;resultset&#40;&#39;Artist&#39;&#41;-&gt;search&#40;{},
+                          {
+                            &#39;start_with&#39; =&gt; { &#39;name&#39; =&gt; &#39;foo&#39; },
+                            &#39;connect_by&#39; =&gt; { &#39;parentid&#39; =&gt; &#39;prior artistid&#39;},
+                            &#39;order_siblings_by&#39; =&gt; &#39;name DESC&#39;,
+                          }&#41;;
+  my $ok = 1;
+  foreach my $node_name &#40;qw&#40;foo bfoo afoo cfoo dfoo&#41;&#41; {
+    $ok = 0 if $rs-&gt;next-&gt;name ne $node_name;
+  }
+  ok&#40; $ok, &#39;Order Siblings By ok&#39;&#41;;
+}
+
+{
+  # get the root node
+  my $rs = $schema-&gt;resultset&#40;&#39;Artist&#39;&#41;-&gt;search&#40;{ parentid =&gt; undef },
+                          {
+                            &#39;start_with&#39; =&gt; { &#39;name&#39; =&gt; &#39;dfoo&#39; },
+                            &#39;connect_by&#39; =&gt; { &#39;prior parentid&#39; =&gt; &#39;artistid&#39;},
+                          }&#41;;
+  is&#40; $rs-&gt;count, 1, &#39;root node count ok&#39; &#41;;
+  ok&#40; $rs-&gt;next-&gt;name eq &#39;foo&#39;, &#39;found root node&#39;&#41;;
+}
+
+{
+  # combine a connect by with a join
+  my $rs = $schema-&gt;resultset&#40;&#39;Artist&#39;&#41;-&gt;search&#40;{&#39;cds.title&#39; =&gt; { &#39;like&#39; =&gt; &#39;%cd&#39;}},
+                          {
+                            &#39;join&#39; =&gt; &#39;cds&#39;,
+                            &#39;start_with&#39; =&gt; { &#39;name&#39; =&gt; &#39;foo&#39; },
+                            &#39;connect_by&#39; =&gt; { &#39;parentid&#39; =&gt; &#39;prior artistid&#39;},
+                          }&#41;;
+  is&#40; $rs-&gt;count, 1, &#39;Connect By with a join; count ok&#39; &#41;;
+  ok&#40; $rs-&gt;next-&gt;name eq &#39;cfoo&#39;, &#39;Connect By with a join; result name ok&#39;&#41;
+}
+
 # clean up our mess
 END {
     if&#40;$dbh&#41; {
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;10&nbsp;08:37:06&nbsp;2008</span>
    <span class="description">alex [...] keusch.at -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> alex [...] keusch.at</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">With the last patch limiting hierarchical queries does not work.

The attached patch fixes this Problem.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -Nurb DBIx-Class-0.08010-orig/lib/DBIx/Class/Storage/DBI/Oracle/Generic.pm DBIx-Class-0.08010/lib/DBIx/Class/Storage/DBI/Oracle/Generic.pm
--- DBIx-Class-0.08010-orig/lib/DBIx/Class/Storage/DBI/Oracle/Generic.pm	2007-09-04 20:33:11.000000000 +0200
+++ DBIx-Class-0.08010/lib/DBIx/Class/Storage/DBI/Oracle/Generic.pm	2008-09-10 16:16:17.000000000 +0200
@@ -4,9 +4,78 @@
 use strict;
 use warnings;
 
+__PACKAGE__-&gt;sql_maker_class&#40;&#39;DBIC::SQL::Abstract::Oracle&#39;&#41;;
+
+BEGIN {
+  package DBIC::SQL::Abstract::Oracle;
+
+  use base qw&#40; DBIC::SQL::Abstract &#41;;
+
+  sub select {
+    my &#40;$self, $table, $fields, $where, $order, @rest&#41; = @_;
+
+    $self-&gt;{_db_specific_attrs} = pop @rest;
+
+    my &#40;$sql, @bind&#41; = $self-&gt;SUPER::select&#40;$table, $fields, $where, $order, @rest&#41;;
+    push @bind, @{$self-&gt;{_oracle_connect_by_binds}};
+
+    return wantarray ? &#40;$sql, @bind&#41; : $sql;
+  }
+
+  sub _emulate_limit {
+    my &#40; $self, $syntax, $sql, $order, $rows, $offset &#41; = @_;
+
+    my &#40;$cb_sql, @cb_bind&#41; = $self-&gt;_connect_by&#40;&#41;;
+    $sql .= $cb_sql;
+    $self-&gt;{_oracle_connect_by_binds} = \@cb_bind;
+
+    return $self-&gt;SUPER::_emulate_limit&#40;$syntax, $sql, $order, $rows, $offset&#41;;
+  }
+
+  sub _connect_by {
+    my &#40;$self&#41; = @_;
+    my $attrs = $self-&gt;{_db_specific_attrs};
+    my $sql = &#39;&#39;;
+    my @bind;
+
+    if &#40; ref&#40;$attrs&#41; eq &#39;HASH&#39; &#41; {
+      if &#40; $attrs-&gt;{&#39;start_with&#39;} &#41; {
+        my &#40;$ws, @wb&#41; = $self-&gt;_recurse_where&#40; $attrs-&gt;{&#39;start_with&#39;} &#41;;
+        $sql .= $self-&gt;_sqlcase&#40;&#39; start with &#39;&#41; . $ws;
+        push @bind, @wb;
+      }
+      if &#40; my $connect_by = $attrs-&gt;{&#39;connect_by&#39;}&#41; {
+        $sql .= $self-&gt;_sqlcase&#40;&#39; connect by&#39;&#41;;
+        foreach my $key &#40; keys %$connect_by &#41; {
+          $sql .= &#34; $key = &#34; . $connect_by-&gt;{$key};
+        }
+      }
+      if &#40; $attrs-&gt;{&#39;order_siblings_by&#39;} &#41; {
+        $sql .= $self-&gt;_order_siblings_by&#40; $attrs-&gt;{&#39;order_siblings_by&#39;} &#41;;
+      }
+    }
+
+    return wantarray ? &#40;$sql, @bind&#41; : $sql;
+  }
+
+  sub _order_siblings_by {
+    my $self = shift;
+    my $ref = ref $_[0];
+
+    my @vals = $ref eq &#39;ARRAY&#39;  ? @{$_[0]} :
+               $ref eq &#39;SCALAR&#39; ? ${$_[0]} :
+               $ref eq &#39;&#39;       ? $_[0]    :
+               puke&#40; &#34;Unsupported data struct $ref for ORDER SIBILINGS BY&#34; &#41;;
+
+    my $val = join &#39;, &#39;, map { $self-&gt;_quote&#40;$_&#41; } @vals;
+    return $val ? $self-&gt;_sqlcase&#40;&#39; order siblings by&#39;&#41;.&#34; $val&#34; : &#39;&#39;;
+  }
+
+} # end of BEGIN - package DBIC::SQL::Abstract::Oracle
+
 =head1 NAME
 
-DBIx::Class::Storage::DBI::Oracle - Automatic primary key class for Oracle
+DBIx::Class::Storage::DBI::Oracle - Automatic primary key class and &#34;Connect By&#34; support for Oracle
 
 =head1 SYNOPSIS
 
@@ -15,12 +84,67 @@
   __PACKAGE__-&gt;set_primary_key&#40;&#39;id&#39;&#41;;
   __PACKAGE__-&gt;sequence&#40;&#39;mysequence&#39;&#41;;
 
+  # with a resultset using a hierarchical relationship
+  my $rs = $schema-&gt;resultset&#40;&#39;Person&#39;&#41;-&gt;search&#40;{},
+                {
+                  &#39;start_with&#39; =&gt; { &#39;firstname&#39; =&gt; &#39;Foo&#39;, &#39;lastname&#39; =&gt; &#39;Bar&#39; },
+                  &#39;connect_by&#39; =&gt; { &#39;parentid&#39; =&gt; &#39;prior persionid&#39;},
+                  &#39;order_siblings_by&#39; =&gt; &#39;firstname ASC&#39;,
+                };
+  &#41;;
+
 =head1 DESCRIPTION
 
-This class implements autoincrements for Oracle.
+This class implements autoincrements for Oracle and adds support for Oracle
+specific hierarchical queries.
 
 =head1 METHODS
 
+=head1 ATTRIBUTES
+
+Following additional attributes can be used in resultsets.
+
+=head2 connect_by
+
+=over 4
+
+=item Value: \%connect_by
+
+=back
+
+A hashref of conditions used to specify the relationship between parent rows
+and child rows of the hierarchy.
+
+  connect_by =&gt; { parentid =&gt; &#39;prior personid&#39; }
+
+=head2 start_with
+
+=over 4
+
+=item Value: \%condition
+
+=back
+
+A hashref of conditions which specify the root row&#40;s&#41; of the hierarchy.
+
+It uses the same syntax as L&lt;DBIx::Class::ResultSet/search&gt;
+
+  start_with =&gt; { firstname =&gt; &#39;Foo&#39;, lastname =&gt; &#39;Bar&#39; }
+
+=head2 order_siblings_by
+
+=over 4
+
+=item Value: &#40;$order_siblings_by | \@order_siblings_by&#41;
+
+=back
+
+Which column&#40;s&#41; to order the siblings by.
+
+It uses the same syntax as L&lt;DBIx::Class::ResultSet/order_by&gt;
+
+  &#39;order_siblings_by&#39; =&gt; &#39;firstname ASC&#39;
+
 =cut
 
 use Carp::Clan qw/^DBIx::Class/;
@@ -29,6 +153,21 @@
 
 # __PACKAGE__-&gt;load_components&#40;qw/PK::Auto/&#41;;
 
+sub _db_specific_attrs {
+  my &#40;$self, $attrs&#41; = @_;
+
+  my $rv = {};
+  if &#40; $attrs-&gt;{connect_by} || $attrs-&gt;{start_with} || $attrs-&gt;{order_siblings_by} &#41; {
+    $rv = {
+      connect_by =&gt; $attrs-&gt;{connect_by},
+      start_with =&gt; $attrs-&gt;{start_with},
+      order_siblings_by =&gt; $attrs-&gt;{order_siblings_by},
+    }
+  }
+
+  return $rv;
+}
+
 sub _dbh_last_insert_id {
   my &#40;$self, $dbh, $source, $col&#41; = @_;
   my $seq = &#40;$source-&gt;column_info&#40;$col&#41;-&gt;{sequence} ||= $self-&gt;get_autoinc_seq&#40;$source,$col&#41;&#41;;
diff -Nurb DBIx-Class-0.08010-orig/lib/DBIx/Class/Storage/DBI.pm DBIx-Class-0.08010/lib/DBIx/Class/Storage/DBI.pm
--- DBIx-Class-0.08010-orig/lib/DBIx/Class/Storage/DBI.pm	2008-02-27 14:49:09.000000000 +0100
+++ DBIx-Class-0.08010/lib/DBIx/Class/Storage/DBI.pm	2008-09-09 14:31:17.000000000 +0200
@@ -1125,9 +1125,18 @@
     push @args, $attrs-&gt;{rows}, $attrs-&gt;{offset};
   }
 
+  # give DB specific DBI subclasses the chance to pass DB specific attributes to
+  # the spl_maker, without overriding the whole _select method
+  if &#40;my $db_specific_attrs = $self-&gt;_db_specific_attrs&#40;$attrs&#41; &#41; {
+    push @args, $db_specific_attrs;
+  }
+
   return $self-&gt;_execute&#40;@args&#41;;
 }
 
+# override this method to add DB specific attributes
+sub _db_specific_attrs { undef; }
+
 sub source_bind_attributes {
   my &#40;$self, $source&#41; = @_;
   
diff -Nurb DBIx-Class-0.08010-orig/t/73oracle.t DBIx-Class-0.08010/t/73oracle.t
--- DBIx-Class-0.08010-orig/t/73oracle.t	2007-08-11 23:07:59.000000000 +0200
+++ DBIx-Class-0.08010/t/73oracle.t	2008-09-10 16:23:00.000000000 +0200
@@ -11,7 +11,7 @@
   &#39;Warning: This test drops and creates tables called \&#39;artist\&#39;, \&#39;cd\&#39; and \&#39;track\&#39;&#39;
   unless &#40;$dsn &#38;&#38; $user &#38;&#38; $pass&#41;;
 
-plan tests =&gt; 7;
+plan tests =&gt; 17;
 
 my $schema = DBICTest::Schema-&gt;connect&#40;$dsn, $user, $pass&#41;;
 
@@ -24,10 +24,12 @@
   $dbh-&gt;do&#40;&#34;DROP TABLE track&#34;&#41;;
 };
 $dbh-&gt;do&#40;&#34;CREATE SEQUENCE artist_seq START WITH 1 MAXVALUE 999999 MINVALUE 0&#34;&#41;;
-$dbh-&gt;do&#40;&#34;CREATE TABLE artist &#40;artistid NUMBER&#40;12&#41;, name VARCHAR&#40;255&#41;&#41;&#34;&#41;;
+$dbh-&gt;do&#40;&#34;CREATE TABLE artist &#40;artistid NUMBER&#40;12&#41;, parentid NUMBER&#40;12&#41;, name VARCHAR&#40;255&#41;&#41;&#34;&#41;;
 $dbh-&gt;do&#40;&#34;CREATE TABLE cd &#40;cdid NUMBER&#40;12&#41;, artist NUMBER&#40;12&#41;, title VARCHAR&#40;255&#41;, year VARCHAR&#40;4&#41;&#41;&#34;&#41;;
 $dbh-&gt;do&#40;&#34;CREATE TABLE track &#40;trackid NUMBER&#40;12&#41;, cd NUMBER&#40;12&#41;, position NUMBER&#40;12&#41;, title VARCHAR&#40;255&#41;, last_updated_on DATE&#41;&#34;&#41;;
 
+$schema-&gt;class&#40;&#39;Artist&#39;&#41;-&gt;add_columns&#40;&#39;parentid&#39;&#41;;
+
 $dbh-&gt;do&#40;&#34;ALTER TABLE artist ADD &#40;CONSTRAINT artist_pk PRIMARY KEY &#40;artistid&#41;&#41;&#34;&#41;;
 $dbh-&gt;do&#40;qq{
   CREATE OR REPLACE TRIGGER artist_insert_trg
@@ -95,6 +97,104 @@
   is&#40; scalar @results, 1, &#34;Group by with limit OK&#34; &#41;;
 }
 
+# create a tree of artists
+my $afoo_id = $schema-&gt;resultset&#40;&#39;Artist&#39;&#41;-&gt;create&#40;{ name =&gt; &#39;afoo&#39;, parentid =&gt; 1 }&#41;-&gt;id;
+$schema-&gt;resultset&#40;&#39;Artist&#39;&#41;-&gt;create&#40;{ name =&gt; &#39;bfoo&#39;, parentid =&gt; 1 }&#41;;
+my $cfoo_id = $schema-&gt;resultset&#40;&#39;Artist&#39;&#41;-&gt;create&#40;{ name =&gt; &#39;cfoo&#39;, parentid =&gt; $afoo_id }&#41;-&gt;id;
+$schema-&gt;resultset&#40;&#39;Artist&#39;&#41;-&gt;create&#40;{ name =&gt; &#39;dfoo&#39;, parentid =&gt; $cfoo_id }&#41;;
+my $xfoo_id = $schema-&gt;resultset&#40;&#39;Artist&#39;&#41;-&gt;create&#40;{ name =&gt; &#39;xfoo&#39; }&#41;-&gt;id;
+
+# create some cds and tracks
+$schema-&gt;resultset&#40;&#39;CD&#39;&#41;-&gt;create&#40;{ cdid =&gt; 2, artist =&gt; $cfoo_id, title =&gt; &#34;cfoo&#39;s cd&#34;, year =&gt; &#39;2008&#39; }&#41;;
+$schema-&gt;resultset&#40;&#39;Track&#39;&#41;-&gt;create&#40;{ trackid =&gt; 2, cd =&gt; 2, position =&gt; 1, title =&gt; &#39;Track1 cfoo&#39; }&#41;;
+$schema-&gt;resultset&#40;&#39;CD&#39;&#41;-&gt;create&#40;{ cdid =&gt; 3, artist =&gt; $xfoo_id, title =&gt; &#34;xfoo&#39;s cd&#34;, year =&gt; &#39;2008&#39; }&#41;;
+$schema-&gt;resultset&#40;&#39;Track&#39;&#41;-&gt;create&#40;{ trackid =&gt; 3, cd =&gt; 3, position =&gt; 1, title =&gt; &#39;Track1 xfoo&#39; }&#41;;
+
+{
+  my $rs = $schema-&gt;resultset&#40;&#39;Artist&#39;&#41;-&gt;search&#40;{}, # get the whole tree
+                          {
+                            &#39;start_with&#39; =&gt; { &#39;name&#39; =&gt; &#39;foo&#39; },
+                            &#39;connect_by&#39; =&gt; { &#39;parentid&#39; =&gt; &#39;prior artistid&#39;},
+                          }&#41;;
+  is&#40; $rs-&gt;count, 5, &#39;Connect By count ok&#39; &#41;;
+  my $ok = 1;
+  foreach my $node_name &#40;qw&#40;foo afoo cfoo dfoo bfoo&#41;&#41; {
+    $ok = 0 if $rs-&gt;next-&gt;name ne $node_name;
+  }
+  ok&#40; $ok, &#39;got artist tree&#39;&#41;;
+}
+
+{
+  # use order siblings by statement
+  my $rs = $schema-&gt;resultset&#40;&#39;Artist&#39;&#41;-&gt;search&#40;{},
+                          {
+                            &#39;start_with&#39; =&gt; { &#39;name&#39; =&gt; &#39;foo&#39; },
+                            &#39;connect_by&#39; =&gt; { &#39;parentid&#39; =&gt; &#39;prior artistid&#39;},
+                            &#39;order_siblings_by&#39; =&gt; &#39;name DESC&#39;,
+                          }&#41;;
+  my $ok = 1;
+  foreach my $node_name &#40;qw&#40;foo bfoo afoo cfoo dfoo&#41;&#41; {
+    $ok = 0 if $rs-&gt;next-&gt;name ne $node_name;
+  }
+  ok&#40; $ok, &#39;Order Siblings By ok&#39;&#41;;
+}
+
+{
+  # get the root node
+  my $rs = $schema-&gt;resultset&#40;&#39;Artist&#39;&#41;-&gt;search&#40;{ parentid =&gt; undef },
+                          {
+                            &#39;start_with&#39; =&gt; { &#39;name&#39; =&gt; &#39;dfoo&#39; },
+                            &#39;connect_by&#39; =&gt; { &#39;prior parentid&#39; =&gt; &#39;artistid&#39;},
+                          }&#41;;
+  is&#40; $rs-&gt;count, 1, &#39;root node count ok&#39; &#41;;
+  ok&#40; $rs-&gt;next-&gt;name eq &#39;foo&#39;, &#39;found root node&#39;&#41;;
+}
+
+{
+  # combine a connect by with a join
+  my $rs = $schema-&gt;resultset&#40;&#39;Artist&#39;&#41;-&gt;search&#40;{&#39;cds.title&#39; =&gt; { &#39;like&#39; =&gt; &#39;%cd&#39;}},
+                          {
+                            &#39;join&#39; =&gt; &#39;cds&#39;,
+                            &#39;start_with&#39; =&gt; { &#39;name&#39; =&gt; &#39;foo&#39; },
+                            &#39;connect_by&#39; =&gt; { &#39;parentid&#39; =&gt; &#39;prior artistid&#39;},
+                          }&#41;;
+  is&#40; $rs-&gt;count, 1, &#39;Connect By with a join; count ok&#39; &#41;;
+  ok&#40; $rs-&gt;next-&gt;name eq &#39;cfoo&#39;, &#39;Connect By with a join; result name ok&#39;&#41;
+}
+
+{
+  # combine a connect by with order_by
+  my $rs = $schema-&gt;resultset&#40;&#39;Artist&#39;&#41;-&gt;search&#40;{},
+                          {
+                            &#39;start_with&#39; =&gt; { &#39;name&#39; =&gt; &#39;dfoo&#39; },
+                            &#39;connect_by&#39; =&gt; { &#39;prior parentid&#39; =&gt; &#39;artistid&#39;},
+                            &#39;order_by&#39; =&gt; &#39;name ASC&#39;,
+                          }&#41;;
+  my $ok = 1;
+  foreach my $node_name &#40;qw&#40;afoo cfoo dfoo foo&#41;&#41; {
+    $ok = 0 if $rs-&gt;next-&gt;name ne $node_name;
+  }
+  ok&#40; $ok, &#39;Connect By with a order_by; result name ok&#39;&#41;;
+}
+
+{
+  # limit a connect by
+  my $rs = $schema-&gt;resultset&#40;&#39;Artist&#39;&#41;-&gt;search&#40;{},
+                          {
+                            &#39;start_with&#39; =&gt; { &#39;name&#39; =&gt; &#39;dfoo&#39; },
+                            &#39;connect_by&#39; =&gt; { &#39;prior parentid&#39; =&gt; &#39;artistid&#39;},
+                            &#39;order_by&#39; =&gt; &#39;name ASC&#39;,
+                            &#39;rows&#39; =&gt; 2,
+                            &#39;page&#39; =&gt; 1,
+                          }&#41;;
+  is&#40; $rs-&gt;count&#40;&#41;, 2, &#39;Connect By; LIMIT count ok&#39; &#41;;
+  my $ok = 1;
+  foreach my $node_name &#40;qw&#40;afoo cfoo&#41;&#41; {
+    $ok = 0 if $rs-&gt;next-&gt;name ne $node_name;
+  }
+  ok&#40; $ok, &#39;LIMIT a Connect By query ok&#39;&#41;;
+}
+
 # clean up our mess
 END {
     if&#40;$dbh&#41; {
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;24&nbsp;11:42:06&nbsp;2008</span>
    <span class="description">mst [...] shadowcat.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #39121] [patch] hierarchical queries - oracle specific</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 24 Sep 2008 16:41:34 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Alexande Keusch via RT &lt;bug-DBIx-Class [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Matt S Trout &lt;mst [...] shadowcat.co.uk&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed, Sep 10, 2008 at 08:37:11AM -0400, Alexande Keusch via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: DBIx-Class
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=39121">http://rt.cpan.org/Ticket/Display.html?id=39121</a></span> &gt;
&gt; 
&gt; With the last patch limiting hierarchical queries does not work.
&gt; 
&gt; The attached patch fixes this Problem.
</div>
You need to send this to the dbix-class mailing list, not RT.

The people who maintain the oracle stuff don&#39;t do releases of DBIx::Class
and rt.cpan.org only sets up release managers as queue users.

-- 
      Matt S Trout       Need help with your Catalyst or DBIx::Class project?
   Technical Director                    <span class="clickylink"><a target="new" rel="nofollow" href="http://www.shadowcat.co.uk/catalyst/">http://www.shadowcat.co.uk/catalyst/</a></span>
 Shadowcat Systems Ltd.  Want a managed development or deployment platform?
<span class="clickylink"><a target="new" rel="nofollow" href="http://chainsawblues.vox.com/">http://chainsawblues.vox.com/</a></span>            <span class="clickylink"><a target="new" rel="nofollow" href="http://www.shadowcat.co.uk/servers/">http://www.shadowcat.co.uk/servers/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;24&nbsp;11:42:09&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;12&nbsp;05:59:55&nbsp;2009</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">No practical way to shoehorn this into 0.08, stalling until 0.09
development begins in earnest.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;12&nbsp;05:59:56&nbsp;2009</span>
    <span class="description">ribasushi [...] leporine.io -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;11&nbsp;14:46:28&nbsp;2009</span>
    <span class="description">ribasushi [...] leporine.io -  Severity Normal changed to Wishlist</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;21&nbsp;03:33:41&nbsp;2009</span>
    <span class="description">alex [...] keusch.at -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;v create a patch for newer versions of DBIx::Class. Patch against
0.08112 is attached.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;21&nbsp;03:33:42&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;21&nbsp;21:19:14&nbsp;2009</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Oct 21 03:33:41 2009, kalex wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;v create a patch for newer versions of DBIx::Class. Patch against
&gt; 0.08112 is attached.
</div>
This is *very* interesting, and much cleaner. Please rewrite the test to
use multicreate, so it is clearer what is it you are doing. Also add
resulting SQL in the POD, so the user &#40;and the reviewers&#41; know what the
result is without trying it.

P.S. for a wicked MC example:
<span class="clickylink"><a target="new" rel="nofollow" href="http://dev.catalyst.perl.org/svnweb/bast/view/DBIx-Class/0.08/trunk/t/multi_create/torture.t">http://dev.catalyst.perl.org/svnweb/bast/view/DBIx-Class/0.08/trunk/t/multi_create/torture.t</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;28&nbsp;06:21:03&nbsp;2009</span>
    <span class="description">alex [...] keusch.at -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Glad to see some interest!

A patch with tests using multicreate is attached. This patch also
includes the autoincrement changes I&#39;ve reported in #39121. Otherwise MC
doesn&#39;t work with the DBICTest schema and a Oracle DB.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;12&nbsp;06:34:35&nbsp;2009</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Oct 28 06:21:03 2009, kalex wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Glad to see some interest!
&gt; 
&gt; A patch with tests using multicreate is attached. This patch also
&gt; includes the autoincrement changes I&#39;ve reported in #39121. Otherwise MC
&gt; doesn&#39;t work with the DBICTest schema and a Oracle DB.
</div>
Sorry I wasn&#39;t clear. I was asking you to put the SQL snippets in the
POD, so the user has an idea what is actually going to happen when he
uses each attribute &#40;however what you did in the tests is great as well,
thank you for that&#41;. So could you adjust the patch one last time adding
actual SQL snippets to the examples in the user-visible documentation.

Thank you
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;18&nbsp;05:26:32&nbsp;2009</span>
    <span class="description">alex [...] keusch.at -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Nov 12 06:34:35 2009, RIBASUSHI wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Sorry I wasn&#39;t clear. I was asking you to put the SQL snippets in the
&gt; POD, so the user has an idea what is actually going to happen when he
&gt; uses each attribute &#40;however what you did in the tests is great as well,
&gt; thank you for that&#41;. So could you adjust the patch one last time adding
&gt; actual SQL snippets to the examples in the user-visible documentation.
&gt; 
&gt; Thank you
</div>
Done!

Patch against 0.08114 is attached.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;19&nbsp;05:15:59&nbsp;2009</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Nov 18 02:26:32 2009, kalex wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu Nov 12 06:34:35 2009, RIBASUSHI wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; Sorry I wasn&#39;t clear. I was asking you to put the SQL snippets in the
&gt; &gt; POD, so the user has an idea what is actually going to happen when he
&gt; &gt; uses each attribute &#40;however what you did in the tests is great as well,
&gt; &gt; thank you for that&#41;. So could you adjust the patch one last time adding
&gt; &gt; actual SQL snippets to the examples in the user-visible documentation.
&gt; &gt; 
&gt; &gt; Thank you
</div>&gt; 
&gt; Done!
&gt; 
&gt; Patch against 0.08114 is attached.
</div>
Ok, I created a branch with your code in it:
<span class="clickylink"><a target="new" rel="nofollow" href="http://dev.catalyst.perl.org/repos/bast/DBIx-Class/0.08/branches/oracle_hierarchical_queries_rt39121/">http://dev.catalyst.perl.org/repos/bast/DBIx-Class/0.08/branches/oracle_hierarchical_queries_rt39121/</a></span>
As far as the code itself - I am happy. It is clean, unobtrusive and
generally easy to follow. Now it needs another Oracle user to validate
it and it can merge. I already brought it to the attention of folk that
might be interested on irc.perl.org#dbix-class. Expect to hear something
soon.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;19&nbsp;05:16:07&nbsp;2009</span>
    <span class="description">ribasushi [...] leporine.io -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;19&nbsp;09:16:51&nbsp;2009</span>
    <span class="description">RKINYON [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">kalex -

    I&#39;ve reviewed the patch and have a few concerns about the construction of the CONNECT BY 
clause:

* The LHS is a column name and so needs to be quotable &#40;there&#39;s a config that specifies this&#41;
* The operator can be something other than &#39;=&#39;
* The RHS can be either a column name &#40;and so needs to be quotable&#41; or a value &#40;and so needs 
to be a bind variable&#41;.

Rob
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;19&nbsp;09:16:51&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;patched&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;18&nbsp;01:22:58&nbsp;2009</span>
    <span class="description">rbo [...] cpan.org -  Cc rbo added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;25&nbsp;05:11:21&nbsp;2010</span>
    <span class="description">alex [...] keusch.at -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">better late than never ...

I&#39;am still working on this feature and made some changes an bugfixes
since the last patch I&#39;ve posted here. Also support for Postgres has
been added &#40;simulating the &#34;connect by&#34; statement with a &#34;with
recursice&#34; statement&#41;.

Now I&#39;m not sure anymore if this features should be a part of &#39;core&#39;
DBIx::Class, as it is not an generic feature but also simulates a DB
specific feature for other databases.
My idea is to release a custom storage driver &#40;like
DBIx::Class::Storge::Hierarchical&#41; which could be used optionally to the
default storage driver.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;25&nbsp;08:22:40&nbsp;2010</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue May 25 05:11:21 2010, kalex wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; better late than never ...
</div>
In fact work has been progressing on the branch I made some time ago.
The thing is feature complete and prompted a number of rewrites in
various subsystems. It was supposed to merge to trunk last week, but
there is one last outstanding issue that needed a change of dbic-core.
 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;am still working on this feature and made some changes an bugfixes
&gt; since the last patch I&#39;ve posted here. Also support for Postgres has
&gt; been added &#40;simulating the &#34;connect by&#34; statement with a &#34;with
&gt; recursice&#34; statement&#41;.
&gt; 
&gt; Now I&#39;m not sure anymore if this features should be a part of &#39;core&#39;
&gt; DBIx::Class, as it is not an generic feature but also simulates a DB
&gt; specific feature for other databases.
&gt; My idea is to release a custom storage driver &#40;like
&gt; DBIx::Class::Storge::Hierarchical&#41; which could be used optionally to the
&gt; default storage driver.
</div>
Please reconsider this plan, as the Storage API is not stable, nor
public. If you go ahead and release an alternative storage driver, it
will never be guaranteed to work with newer versions of DBIC, as there
will never be any effort to stabilize the source-storage communication
mechanisms.

Please review what has been done so far at
<span class="clickylink"><a target="new" rel="nofollow" href="http://dev.catalyst.perl.org/repos/bast/DBIx-Class/0.08/branches/oracle_hierarchical_queries_rt39121/">http://dev.catalyst.perl.org/repos/bast/DBIx-Class/0.08/branches/oracle_hierarchical_queries_rt39121/</a></span>
and consider contributing whatever fixes you find necessary. 

It is currently blocked by a lapse in count&#40;&#41; handling, which will be
rectified within a couple of weeks at the most.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;27&nbsp;02:55:10&nbsp;2010</span>
    <span class="description">alex [...] keusch.at -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I took a look at the branch and found another problem:

Combining a &#34;connect by&#34; statement with a &#34;group by&#34; statement creates
bind values in the wrong order. The &#34;connect by&#34; bind should be inserted
before the &#34;group by&#34; and &#34;order by&#34; binds.

A &#40;little bit hackish&#41; patch is attached.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> group_by_bind_position.diff</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Index: t/73oracle.t
===================================================================
--- t/73oracle.t	&#40;Revision 9439&#41;
+++ t/73oracle.t	&#40;Arbeitskopie&#41;
@@ -343,13 +343,16 @@
 
     $schema-&gt;resultset&#40;&#39;Artist&#39;&#41;-&gt;create &#40;{
         name =&gt; &#39;root&#39;,
+        rank =&gt; 1,
         cds =&gt; [],
         children =&gt; [
             {
                 name =&gt; &#39;child1&#39;,
+                rank =&gt; 2,
                 children =&gt; [
                     {
                         name =&gt; &#39;grandchild&#39;,
+                        rank =&gt; 3,
                         cds =&gt; [
                             {
                                 title =&gt; &#34;grandchilds&#39;s cd&#34; ,
@@ -365,6 +368,7 @@
                         children =&gt; [
                             {
                                 name =&gt; &#39;greatgrandchild&#39;,
+                                rank =&gt; 3,
                             }
                         ],
                     }
@@ -372,6 +376,7 @@
             },
             {
                 name =&gt; &#39;child2&#39;,
+                rank =&gt; 3,
             },
         ],
     }&#41;;
@@ -623,6 +628,36 @@
       is&#40; $rs-&gt;count, 2, &#39;Connect By; LIMIT count ok&#39; &#41;;
     }
 
+    # combine a connect_by with group_by and having
+    {
+      my $rs = $schema-&gt;resultset&#40;&#39;Artist&#39;&#41;-&gt;search&#40;{}, {
+        select =&gt; [&#39;count&#40;rank&#41;&#39;],
+        start_with =&gt; { name =&gt; &#39;root&#39; },
+        connect_by =&gt; { parentid =&gt; { -prior =&gt; \ &#39;artistid&#39; } },
+        group_by =&gt; [&#39;rank&#39;],
+        having =&gt; { &#39;count&#40;rank&#41;&#39; =&gt; { &#39;&lt;&#39;, 2 } },
+      }&#41;;
+
+      is_same_sql_bind &#40;
+        $rs-&gt;as_query,
+        &#39;&#40;
+            SELECT count&#40;rank&#41;
+            FROM artist me
+            START WITH name = ?
+            CONNECT BY parentid = PRIOR artistid
+            GROUP BY rank HAVING count&#40;rank&#41; &lt; ?
+        &#41;&#39;,
+        [ [ name =&gt; &#39;root&#39; ], [ &#39;count&#40;rank&#41;&#39; =&gt; 2 ] ],
+      &#41;;
+
+      is_deeply &#40;
+        [ $rs-&gt;get_column &#40;&#39;count&#40;rank&#41;&#39;&#41;-&gt;all ],
+        [1, 1],
+        &#39;Group By a Connect By query - correct values&#39;
+      &#41;;
+    }
+
+
     # select the whole cycle tree without nocylce
     {
       my $rs = $schema-&gt;resultset&#40;&#39;Artist&#39;&#41;-&gt;search&#40;{}, {
Index: lib/DBIx/Class/SQLAHacks/Oracle.pm
===================================================================
--- lib/DBIx/Class/SQLAHacks/Oracle.pm	&#40;Revision 9439&#41;
+++ lib/DBIx/Class/SQLAHacks/Oracle.pm	&#40;Arbeitskopie&#41;
@@ -28,7 +28,9 @@
     my &#40;$self, $table, $fields, $where, $rs_attrs, @rest&#41; = @_;
 
     my &#40;$sql, @bind&#41; = $self-&gt;SUPER::select&#40;$table, $fields, $where, $rs_attrs, @rest&#41;;
-    push @bind, @{$self-&gt;{_oracle_connect_by_binds}};
+    # insert &#39;_oracle_connect_by_binds&#39; before &#39;having_bind&#39; and &#39;order_bind&#39;
+    @bind = @bind[0..@bind-@{$self-&gt;{having_bind}}-@{$self-&gt;{order_bind}}-1];
+    push @bind, @{$self-&gt;{_oracle_connect_by_binds}}, @{$self-&gt;{having_bind}}, @{$self-&gt;{order_bind}};
 
     return wantarray ? &#40;$sql, @bind&#41; : $sql;
 }
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;27&nbsp;04:20:40&nbsp;2010</span>
    <span class="description">rbo [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu May 27 08:55:10 2010, kalex wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I took a look at the branch and found another problem:
&gt; 
&gt; Combining a &#34;connect by&#34; statement with a &#34;group by&#34; statement creates
&gt; bind values in the wrong order. The &#34;connect by&#34; bind should be inserted
&gt; before the &#34;group by&#34; and &#34;order by&#34; binds.
&gt; 
&gt; A &#40;little bit hackish&#41; patch is attached.
</div>
Patch has been adjusted and committed.

<span class="clickylink"><a target="new" rel="nofollow" href="http://dev.catalystframework.org/svnweb/bast/revision?rev=9449">http://dev.catalystframework.org/svnweb/bast/revision?rev=9449</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;28&nbsp;03:00:22&nbsp;2010</span>
    <span class="description">alex [...] keusch.at -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">As stated above I&#39;ve also added hierarchical query support for Postgres.

I&#39;m using the &#34;with recursive&#34; statement to imitate the behavior of
Oracles hierarchical implementation:
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.postgresql.org/docs/8.4/static/queries-with.html">http://www.postgresql.org/docs/8.4/static/queries-with.html</a></span>

Apart from following incompatibilitys it behaves like Oracle:

* rows are retured in a different order
* order_siblings_by is not supported
* cycles within a connect_by statement will result in an endless loop
* connect_by_nocycle will return one row twice

count&#40;&#41; tests are failing.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> postgres_hierarchical_queries.diff</td>
  </tr>
</table>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;31&nbsp;20:50:06&nbsp;2010</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi!

The long journey is at its end \o/ I just committed what I think is the
last piece of branches/oracle_hierarchical_queries_rt39121. It would be
greatly appreciated if you look through the code again and see if there
is anything else we missed. If I do not hear from you by 21:00 UTC
Tuesday the 1st, I will just merge it to trunk as-is.
Also please provide us with a name/email you would like to see added to
the Contributors section of DBIx/Class.pm

On Fri May 28 03:00:22 2010, kalex wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As stated above I&#39;ve also added hierarchical query support for Postgres.
&gt; 
&gt; I&#39;m using the &#34;with recursive&#34; statement to imitate the behavior of
&gt; Oracles hierarchical implementation:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.postgresql.org/docs/8.4/static/queries-with.html">http://www.postgresql.org/docs/8.4/static/queries-with.html</a></span>
&gt; 
&gt; Apart from following incompatibilitys it behaves like Oracle:
&gt; 
&gt; * rows are retured in a different order
&gt; * order_siblings_by is not supported
&gt; * cycles within a connect_by statement will result in an endless loop
&gt; * connect_by_nocycle will return one row twice
&gt; 
&gt; count&#40;&#41; tests are failing.
</div>
Right... this patch leaves a lot to be desired. I will just note some
random thoughts here:

* The &#34;temp_rec_query&#34; table rename in select&#40;&#41; - is this really
necessary? I do not see a subselect taking place...

* What is the idea behind _get_prior_sqlmaker&#40;&#41; ? I don&#39;t see why $self
isn&#39;t sufficient

* You &#40;as per comments&#41; &#34;simulate connect by nocycle&#34; - if this is not a
native operator, why do we support it? Also in the POD you state &#34;It
tries to be as compatible as possilbe to the Oracle implementation&#34;. The
point behind the Oracle stuff was that it is oracle-specific syntax, not
something that is to be made to work transparently across multiple
backends. Even if we had the infrastructure for this &#40;we don&#39;t&#41;, the
functionality would be locked behind a higher level API, not based on
one or another flavor of RDBMS.

So I guess a viable strategy after the oracle stuff merges, is to define
the *interesting* subset of Pg hierarchical queries support, and
implement it just like we did for Oracle, but without striving for a
certain degree of compatibility. The functionality being added now is
strictly to make queries specific to a certain rdbms possible. A side
benefit is a build up of a test suite and use cases, which would be very
useful when work on Data::Query &#40;a dialect-aware SQL::Abstract
replacement&#41; begins in earnest.

If you are interested in working more on pg - please come to #dbix-class
on irc.perl.org, so we can fit you with a commit-bit.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;01&nbsp;07:40:38&nbsp;2010</span>
    <span class="description">alex [...] keusch.at -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Am Mo 31. Mai 2010, 20:50:06, RIBASUSHI schrieb:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The long journey is at its end \o/ I just committed what I think is the
&gt; last piece of branches/oracle_hierarchical_queries_rt39121.
</div>
Great to hear! :&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It would be
&gt; greatly appreciated if you look through the code again and see if there
&gt; is anything else we missed.
</div>
No more issues from my side. Just ran the testsuite of our product
&#40;which is heavily using hierarchical queries&#41;, and it passed without any
problems.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Also please provide us with a name/email you would like to see added to
&gt; the Contributors section of DBIx/Class.pm
</div>
Alexander Keusch cpan@keusch.at

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The
&gt; point behind the Oracle stuff was that it is oracle-specific syntax, not
&gt; something that is to be made to work transparently across multiple
&gt; backends. Even if we had the infrastructure for this &#40;we don&#39;t&#41;, the
&gt; functionality would be locked behind a higher level API, not based on
&gt; one or another flavor of RDBMS.
</div>
The intention behind this was, that we have a product running on oracle,
and now we also need to support postgres. With the &#40;largely&#41; compatible
postgres implementation, we can switch between databases by just
changing the connection string. 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; So I guess a viable strategy after the oracle stuff merges, is to define
&gt; the *interesting* subset of Pg hierarchical queries support, and
&gt; implement it just like we did for Oracle, but without striving for a
&gt; certain degree of compatibility.
</div>
Yes, I agree with you. That was the reason I was thinking of a custom
storage driver &#40;so that people optionally can use such a &#34;compatibility
layer&#34;&#41;. But for the moment I&#39;am very happy with the upcoming
DBIx::Class Version, it will make things alot easier.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;01&nbsp;10:13:59&nbsp;2010</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Jun 01 07:40:38 2010, kalex wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Am Mo 31. Mai 2010, 20:50:06, RIBASUSHI schrieb:
<div class="message-stanza open">&gt; &gt; The long journey is at its end \o/ I just committed what I think is the
&gt; &gt; last piece of branches/oracle_hierarchical_queries_rt39121.
</div>&gt; 
&gt; Great to hear! :&#41;
&gt; 
<div class="message-stanza open">&gt; &gt; It would be
&gt; &gt; greatly appreciated if you look through the code again and see if there
&gt; &gt; is anything else we missed.
</div>&gt; 
&gt; No more issues from my side. Just ran the testsuite of our product
&gt; &#40;which is heavily using hierarchical queries&#41;, and it passed without any
&gt; problems.
&gt; 
<div class="message-stanza open">&gt; &gt; Also please provide us with a name/email you would like to see added to
&gt; &gt; the Contributors section of DBIx/Class.pm
</div>&gt; 
&gt; Alexander Keusch cpan@keusch.at
</div>
Authorship committed and everything is merged to trunk. A release should
come along in a couple of days. Thank you for all the work \o/

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; The
&gt; &gt; point behind the Oracle stuff was that it is oracle-specific syntax, not
&gt; &gt; something that is to be made to work transparently across multiple
&gt; &gt; backends. Even if we had the infrastructure for this &#40;we don&#39;t&#41;, the
&gt; &gt; functionality would be locked behind a higher level API, not based on
&gt; &gt; one or another flavor of RDBMS.
</div>&gt; 
&gt; The intention behind this was, that we have a product running on oracle,
&gt; and now we also need to support postgres. With the &#40;largely&#41; compatible
&gt; postgres implementation, we can switch between databases by just
&gt; changing the connection string. 
&gt; 
<div class="message-stanza open">&gt; &gt; So I guess a viable strategy after the oracle stuff merges, is to define
&gt; &gt; the *interesting* subset of Pg hierarchical queries support, and
&gt; &gt; implement it just like we did for Oracle, but without striving for a
&gt; &gt; certain degree of compatibility.
</div>&gt; 
&gt; Yes, I agree with you. That was the reason I was thinking of a custom
&gt; storage driver &#40;so that people optionally can use such a &#34;compatibility
&gt; layer&#34;&#41;. But for the moment I&#39;am very happy with the upcoming
&gt; DBIx::Class Version, it will make things alot easier.
</div>
Well - why stop here: you can still work on a paralel Pg implementation,
just do not couple it so tightly with what we already have for Oracle.
Once the Pg part is implemented we can do proper merging/rename of the
common parts, before we actually merge the support to trunk.

I am very open to contributions, given we don&#39;t resort to
&#34;afroengineering&#34; just for the sake of pushing something out. So if you
have the time - please join us on #dbix-class so you can be properly set
with commit access &#40;and discuss whatever technicalities there are to
discuss&#41;

Cheers!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;01&nbsp;10:14:01&nbsp;2010</span>
    <span class="description">ribasushi [...] leporine.io -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;04&nbsp;07:13:15&nbsp;2010</span>
    <span class="description">ribasushi [...] leporine.io -  Status changed from &#39;patched&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;04&nbsp;07:13:16&nbsp;2010</span>
    <span class="description">ribasushi [...] leporine.io -  Fixed in 0.08122 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;31&nbsp;05:25:20&nbsp;2011</span>
    <span class="description">ribasushi [...] leporine.io -  Fixed in 0.08122 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;31&nbsp;05:25:20&nbsp;2011</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> hierarchical queries - Pg WITH</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Reopening/renaming ticket, it got closed by mistake, still contains a
patch we are very interested in. Patch however requires some work, see
<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Public/Bug/Display.html?id=39121#txn-784658">https://rt.cpan.org/Public/Bug/Display.html?id=39121#txn-784658</a></span> for details.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;31&nbsp;05:25:23&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;31&nbsp;05:25:23&nbsp;2011</span>
    <span class="description">ribasushi [...] leporine.io -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;31&nbsp;05:25:54&nbsp;2011</span>
    <span class="description">ribasushi [...] leporine.io -  Subject changed from &#39;[patch] hierarchical queries - oracle specific&#39; to &#39;hierarchical queries - Postgres WITH&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
