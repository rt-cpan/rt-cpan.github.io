<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #70135 for DBD-SQLite: All operations fail with &#34;not an error&#34; when APR::Table is loaded</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #70135 for DBD-SQLite: All operations fail with &#34;not an error&#34; when APR::Table is loaded</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/DBD-SQLite/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/DBD-SQLite/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/DBD-SQLite/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/DBD-SQLite/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBD-SQLite">DBD-SQLite CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">70135</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/DBD-SQLite/Active/">DBD-SQLite</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
siracusa [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-10248-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.33    </td>
  </tr>
  <tr id="CF-10249-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;08&nbsp;10:12:52&nbsp;2011</span>
    <span class="description">siracusa [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> All operations fail with &#34;not an error&#34; when APR::Table is loaded</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">There are several mod_perl-related &#34;not an error&#34; bugs reported.  This may be related to, and perhaps a minimal 
reproduction of them.  Simply loading the APR::Table module causes DBD::SQLite 1.33 &#40;and possibly earlier 
versions&#41; to fail all attempted operations with a &#34;not an error&#34; error on CentOS 5.4 and perl 5.8.8.  Reproduction 
script:

---

#!/usr/bin/perl

use strict;

use DBI;

use APR::Table; # XXX: comment out this line and the code below works

my $dbh = DBI-&gt;connect&#40;&#39;dbi:SQLite:dbname=my.db&#39;, &#39;&#39;, &#39;&#39;, { RaiseError  =&gt; 1 }&#41; or die $DBI::errstr;
$dbh-&gt;do&#40;&#39;SELECT 1&#39;&#41;;
$dbh-&gt;disconnect;

print &#34;OK\n&#34;;

---

Expected output: OK

Actual output:

DBD::SQLite::db do failed: not an error at sqlite.pl line 10.
DBD::SQLite::db do failed: not an error at sqlite.pl line 10.

System information:

% uname -a
Linux xxx.com 2.6.18-238.1.1.el5 #1 SMP Tue Jan 4 13:32:19 EST 2011 x86_64 x86_64 x86_64 GNU/Linux

% perl -V

Summary of my perl5 &#40;revision 5 version 8 subversion 8&#41; configuration:
  Platform:
    osname=linux, osvers=2.6.18-53.el5, archname=x86_64-linux-thread-multi
    uname=&#39;linux builder10.centos.org 2.6.18-53.el5 #1 smp mon nov 12 02:14:55 est 2007 x86_64 x86_64 
x86_64 gnulinux &#39;
    config_args=&#39;-des -Doptimize=-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-
protector --param=ssp-buffer-size=4 -m64 -mtune=generic -Dversion=5.8.8 -Dmyhostname=localhost -
Dperladmin=root@localhost -Dcc=gcc -Dcf_by=Red Hat, Inc. -Dinstallprefix=/usr -Dprefix=/usr -
Dlibpth=/usr/local/lib64 /lib64 /usr/lib64 -Dprivlib=/usr/lib/perl5/5.8.8 -
Dsitelib=/usr/lib/perl5/site_perl/5.8.8 -Dvendorlib=/usr/lib/perl5/vendor_perl/5.8.8 -
Darchlib=/usr/lib64/perl5/5.8.8/x86_64-linux-thread-multi -
Dsitearch=/usr/lib64/perl5/site_perl/5.8.8/x86_64-linux-thread-multi -
Dvendorarch=/usr/lib64/perl5/vendor_perl/5.8.8/x86_64-linux-thread-multi -Darchname=x86_64-linux-
thread-multi -Dvendorprefix=/usr -Dsiteprefix=/usr -Duseshrplib -Dusethreads -Duseithreads -Duselargefiles 
-Dd_dosuid -Dd_semctl_semun -Di_db -Ui_ndbm -Di_gdbm -Di_shadow -Di_syslog -Dman3ext=3pm -
Duseperlio -Dinstallusrbinperl=n -Ubincompat5005 -Uversiononly -Dpager=/usr/bin/less -isr -
Dd_gethostent_r_proto -Ud_endhostent_r_proto -Ud_sethostent_r_proto -Ud_endprotoent_r_proto -
Ud_setprotoent_r_proto -Ud_endservent_r_proto -Ud_setservent_r_proto -Dinc_version_list=5.8.7 5.8.6 5.8.5 -
Dscriptdir=/usr/bin&#39;
    hint=recommended, useposix=true, d_sigaction=define
    usethreads=define use5005threads=undef useithreads=define usemultiplicity=define
    useperlio=define d_sfio=undef uselargefiles=define usesocks=undef
    use64bitint=define use64bitall=define uselongdouble=undef
    usemymalloc=n, bincompat5005=undef
  Compiler:
    cc=&#39;gcc&#39;, ccflags =&#39;-D_REENTRANT -D_GNU_SOURCE -fno-strict-aliasing -pipe -Wdeclaration-after-statement 
-I/usr/local/include -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 -I/usr/include/gdbm&#39;,
    optimize=&#39;-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-
buffer-size=4 -m64 -mtune=generic&#39;,
    cppflags=&#39;-D_REENTRANT -D_GNU_SOURCE -fno-strict-aliasing -pipe -Wdeclaration-after-statement -
I/usr/local/include -I/usr/include/gdbm&#39;
    ccversion=&#39;&#39;, gccversion=&#39;4.1.2 20080704 &#40;Red Hat 4.1.2-46&#41;&#39;, gccosandvers=&#39;&#39;
    intsize=4, longsize=8, ptrsize=8, doublesize=8, byteorder=12345678
    d_longlong=define, longlongsize=8, d_longdbl=define, longdblsize=16
    ivtype=&#39;long&#39;, ivsize=8, nvtype=&#39;double&#39;, nvsize=8, Off_t=&#39;off_t&#39;, lseeksize=8
    alignbytes=8, prototype=define
  Linker and Libraries:
    ld=&#39;gcc&#39;, ldflags =&#39;&#39;
    libpth=/usr/local/lib64 /lib64 /usr/lib64
    libs=-lresolv -lnsl -lgdbm -ldb -ldl -lm -lcrypt -lutil -lpthread -lc
    perllibs=-lresolv -lnsl -ldl -lm -lcrypt -lutil -lpthread -lc
    libc=, so=so, useshrplib=true, libperl=libperl.so
    gnulibc_version=&#39;2.5&#39;
  Dynamic Linking:
    dlsrc=dl_dlopen.xs, dlext=so, d_dlsymun=undef, ccdlflags=&#39;-Wl,-E -Wl,-
rpath,/usr/lib64/perl5/5.8.8/x86_64-linux-thread-multi/CORE&#39;
    cccdlflags=&#39;-fPIC&#39;, lddlflags=&#39;-shared -O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-
protector --param=ssp-buffer-size=4 -m64 -mtune=generic&#39;


Characteristics of this binary &#40;from libperl&#41;: 
  Compile-time options: MULTIPLICITY PERL_IMPLICIT_CONTEXT
                        PERL_MALLOC_WRAP USE_64_BIT_ALL USE_64_BIT_INT
                        USE_ITHREADS USE_LARGE_FILES USE_PERLIO
                        USE_REENTRANT_API
  Built under linux
  Compiled at Sep  3 2009 10:26:51
  %ENV:
    PERL_READLINE_NOWARN=&#34;&#34;
    PERL_RL=&#34; o=0&#34;
  @INC:
    /usr/lib64/perl5/site_perl/5.8.8/x86_64-linux-thread-multi
    /usr/lib/perl5/site_perl/5.8.8
    /usr/lib/perl5/site_perl
    /usr/lib64/perl5/vendor_perl/5.8.8/x86_64-linux-thread-multi
    /usr/lib/perl5/vendor_perl/5.8.8
    /usr/lib/perl5/vendor_perl
    /usr/lib64/perl5/5.8.8/x86_64-linux-thread-multi
    /usr/lib/perl5/5.8.8
    .
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;08&nbsp;10:18:38&nbsp;2011</span>
    <span class="description">siracusa [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">More information on where APR::Table comes from:

% pmpath APR::Table
/usr/lib64/perl5/vendor_perl/5.8.8/x86_64-linux-thread-multi/APR/Table.pm

% pmvers APR::Table
0.009000

% rpm -qf /usr/lib64/perl5/vendor_perl/5.8.8/x86_64-linux-thread-multi/APR/Table.pm
mod_perl-2.0.4-6.el5

% rpm -qi mod_perl-2.0.4-6.el5
Name        : mod_perl                     Relocations: &#40;not relocatable&#41;
Version     : 2.0.4                             Vendor: CentOS
Release     : 6.el5                         Build Date: Wed 21 Jan 2009 01:22:44 AM EST
Install Date: Fri 28 May 2010 03:20:33 PM EDT      Build Host: builder10.centos.org
Group       : System Environment/Daemons    Source RPM: mod_perl-2.0.4-6.el5.src.rpm
Size        : 7085550                          License: ASL 2.0
Signature   : DSA/SHA1, Tue 17 Mar 2009 07:35:59 AM EDT, Key ID a8a447dce8562897
URL         : <span class="clickylink"><a target="new" rel="nofollow" href="http://perl.apache.org/">http://perl.apache.org/</a></span>
Summary     : An embedded Perl interpreter for the Apache Web server
Description :
Mod_perl incorporates a Perl interpreter into the Apache web server,
so that the Apache web server can directly execute Perl code.
Mod_perl links the Perl runtime library into the Apache web server and
provides an object-oriented Perl interface for Apache&#39;s C language
API.  The end result is a quicker CGI script turnaround process, since
no external Perl interpreter has to be started.

Install mod_perl if you&#39;re installing the Apache web server and you&#39;d
like for it to directly incorporate a Perl interpreter.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;08&nbsp;10:18:40&nbsp;2011</span>
    <span class="description">siracusa [...] gmail.com -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;09&nbsp;16:28:14&nbsp;2011</span>
    <span class="description">siracusa [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">When APR::Table is NOT loaded and the test script &#40;see above&#41; is run, the sqlite3_open&#40;&#41; 
function resolves to the one defined in the sqlite3.c file in the DBD::SQLite distribution, and 
the code works:

---

dev [DBD-SQLite-1.33]% gdb --args /usr/bin/perl -I blib/lib -I blib/arch -I blib/lib/auto 
sqlite.pl
...
88          rc = sqlite3_open&#40;dbname, db&#41;;
&#40;gdb&#41; stepi
0x00002b591b114fd3      88          rc = sqlite3_open&#40;dbname, db&#41;;
&#40;gdb&#41; 
0x00002b591b114fd6      88          rc = sqlite3_open&#40;dbname, db&#41;;
&#40;gdb&#41; 
0x00002b591b107030 in sqlite3_open@plt &#40;&#41; from blib/arch/auto/DBD/SQLite/SQLite.so
&#40;gdb&#41; 
sqlite3_open &#40;zFilename=0x8f94dc0 &#34;my.db&#34;, ppDb=0x8f93508&#41; at sqlite3.c:109185
109185  &#41;{
&#40;gdb&#41; 

---

When APR::Table IS loaded, the sqlite3_open&#40;&#41; function resolves to the one defined in the 
system-wide SQLIte library /usr/lib64/libsqlite3.so.0

---

dev [DBD-SQLite-1.33]% gdb --args /usr/bin/perl -I blib/lib -I blib/arch -I blib/lib/auto 
sqlite.pl
...
88          rc = sqlite3_open&#40;dbname, db&#41;;
&#40;gdb&#41; stepi
0x00002b5c593f6fd3      88          rc = sqlite3_open&#40;dbname, db&#41;;
&#40;gdb&#41; 
0x00002b5c593f6fd6      88          rc = sqlite3_open&#40;dbname, db&#41;;
&#40;gdb&#41; 
0x00002b5c593e9030 in sqlite3_open@plt &#40;&#41; from blib/arch/auto/DBD/SQLite/SQLite.so
&#40;gdb&#41; 
0x0000003098e28750 in sqlite3_open &#40;&#41; from /usr/lib64/libsqlite3.so.0
&#40;gdb&#41; 
 
---

Later, this causes db-&gt;magic to be 0 instead of SQLITE_MAGIC_OPEN, and the call to 
sqlite3SafetyCheckOk&#40;&#41; from sqlite3LockAndPrepare&#40;&#41; returns false, causing 
SQLITE_MISUSE_BKPT to be returned.

Loading APR::Table by itself causes this file to be loaded:

/usr/lib64/perl5/vendor_perl/5.8.8/x86_64-linux-thread-multi/auto/APR/APR.so

APR.so apparently links to the system-installed SQLite library:

% ldd /usr/lib64/perl5/vendor_perl/5.8.8/x86_64-linux-thread-multi/auto/APR/APR.so | 
grep sql
        libsqlite3.so.0 =&gt; /usr/lib64/libsqlite3.so.0 &#40;0x00002ac50224b000&#41;

This seems to explain why, when APR::Table is loaded, the sqlite3_open&#40;&#41; function resolves to 
the one in /usr/lib64/libsqlite3.so.0 and not the one in DBD::SQLite&#39;s sqlite3.c file.

I haven&#39;t figured out how to stop this from happening, nor do I understand why APR.so links 
to /usr/lib64/libsqlite3.so.0 &#40;I don&#39;t see any references to SQLite in the mod_perl code&#41;.  I just 
wanted to add some more information.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;15&nbsp;11:22:12&nbsp;2011</span>
    <span class="description">mdootson [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have experienced similar issues with symbol resolution in a different 
module and found that you force resolution to the symbols within your 
own shared module / code definitions by using the ld option &#39;-Bsymbolic&#39; 
&#40;option to gcc /g++ therefore is &#39;-Wl,-Bsymbolic&#39;.&#41;

The attached patch adds the necessary changes to Makefile.PL of DBD-
SQLite-1.33.

It may be worth giving this a try and seeing if it solves your issue.

Regards

Mark


On Tue Aug 09 16:28:14 2011, JSIRACUSA wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; When APR::Table is NOT loaded and the test script &#40;see above&#41; is run,
&gt; the sqlite3_open&#40;&#41;
&gt; function resolves to the one defined in the sqlite3.c file in the
&gt; DBD::SQLite distribution, and
&gt; the code works:
</div></div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> symbolic.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- Makefile.PL 2011-09-15 16:00:20.282300000 +0100
+++ Makefile.PL 2011-09-15 16:02:27.235100000 +0100
@@ -242,6 +242,9 @@
    &#40; @CC_LIBS ? &#40;
        LIBS =&gt; join&#40; &#39; &#39;, @CC_LIBS &#41;
    &#41; : &#40;&#41; &#41;,
+   CCFLAGS       =&gt; $Config{ccflags}   . &#39;  -Wl,-Bsymbolic&#39;,
+   LDFLAGS       =&gt; $Config{ldflags}   . &#39;  -Wl,-Bsymbolic&#39;,
+   LDDLFLAGS     =&gt; $Config{lddlflags} . &#39;  -Wl,-Bsymbolic&#39;,
 &#41;;
 
 #####################################################################
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;15&nbsp;20:46:49&nbsp;2011</span>
    <span class="description">ishigaki [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Works great for me. Applied in the trunk with a slight modification &#40;to 
exclude MSVC&#41;. Thanks!

Kenichi

On Fri Sep 16 00:22:12 2011, MDOOTSON wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I have experienced similar issues with symbol resolution in a 
</div>different 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; module and found that you force resolution to the symbols within your 
&gt; own shared module / code definitions by using the ld option &#39;-
</div>Bsymbolic&#39; 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#40;option to gcc /g++ therefore is &#39;-Wl,-Bsymbolic&#39;.&#41;
&gt; 
&gt; The attached patch adds the necessary changes to Makefile.PL of DBD-
&gt; SQLite-1.33.
&gt; 
&gt; It may be worth giving this a try and seeing if it solves your issue.
&gt; 
&gt; Regards
&gt; 
&gt; Mark
&gt; 
&gt; 
&gt; On Tue Aug 09 16:28:14 2011, JSIRACUSA wrote:
<div class="message-stanza open">&gt; &gt; When APR::Table is NOT loaded and the test script &#40;see above&#41; is 
</div></div>run,
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; the sqlite3_open&#40;&#41;
&gt; &gt; function resolves to the one defined in the sqlite3.c file in the
&gt; &gt; DBD::SQLite distribution, and
&gt; &gt; the code works:
</div>&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;15&nbsp;20:46:51&nbsp;2011</span>
    <span class="description">ishigaki [...] cpan.org -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;21&nbsp;22:44:35&nbsp;2011</span>
    <span class="description">ishigaki [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Closing this ticket as DBD::SQLite 1.34_01 with this fix is out. If you 
still experience the problem, please reopen this. Thanks.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;21&nbsp;22:44:36&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;patched&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;21&nbsp;22:44:37&nbsp;2011</span>
    <span class="description">ishigaki [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;10&nbsp;07:12:46&nbsp;2011</span>
    <span class="description">GUIDO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Sep 21 22:44:35 2011, ISHIGAKI wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Closing this ticket as DBD::SQLite 1.34_01 with this fix is out. If you 
&gt; still experience the problem, please reopen this. Thanks.
</div>
The fix in Makefile.PL looks suspicious.

You match $Config::Config{cc} =~ /^g?cc/ but you should do instead:

    if &#40;$Config::Config{ccname} eq &#39;gcc&#39;&#41; {
        ...
    }

gcc is an alias for cc, not the other way round.  Besides, the variable
&#39;cc&#39; often contains gcc&#39;s full name including the architecture.  For
example on Gentoo Linux it is something like &#34;x86_64-pc-linux-gnu-gcc&#34;
and the fix is not applied although it should.

But using ccname may still fail on systems where you use gcc with a
native &#40;non-GNU&#41; linker.  I&#39;m not sure whether gcc will then silently
ignore that option or the linker will bail out with an error.

Since the option is not portable, it is probably best to compile and
link some test code instead of guessing.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;10&nbsp;07:12:48&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;10&nbsp;12:44:23&nbsp;2012</span>
    <span class="description">ishigaki [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hopefully this is fixed in 1.35 &#40;actually 1.34_01/02&#41;. If you still 
suffer from this issue, please reopen this. Thanks.

On Mon Aug 08 23:12:52 2011, JSIRACUSA wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; There are several mod_perl-related &#34;not an error&#34; bugs reported.  This
&gt; may be related to, and perhaps a minimal
&gt; reproduction of them.  Simply loading the APR::Table module causes
&gt; DBD::SQLite 1.33 &#40;and possibly earlier
&gt; versions&#41; to fail all attempted operations with a &#34;not an error&#34; error
&gt; on CentOS 5.4 and perl 5.8.8.  Reproduction
&gt; script:
&gt; 
&gt; ---
&gt; 
&gt; #!/usr/bin/perl
&gt; 
&gt; use strict;
&gt; 
&gt; use DBI;
&gt; 
&gt; use APR::Table; # XXX: comment out this line and the code below works
&gt; 
&gt; my $dbh = DBI-&gt;connect&#40;&#39;dbi:SQLite:dbname=my.db&#39;, &#39;&#39;, &#39;&#39;, { RaiseError
&gt; =&gt; 1 }&#41;       or die $DBI::errstr;
&gt; $dbh-&gt;do&#40;&#39;SELECT 1&#39;&#41;;
&gt; $dbh-&gt;disconnect;
&gt; 
&gt; print &#34;OK\n&#34;;
&gt; 
&gt; ---
&gt; 
&gt; Expected output: OK
&gt; 
&gt; Actual output:
&gt; 
&gt; DBD::SQLite::db do failed: not an error at sqlite.pl line 10.
&gt; DBD::SQLite::db do failed: not an error at sqlite.pl line 10.
&gt; 
&gt; System information:
&gt; 
&gt; % uname -a
&gt; Linux xxx.com 2.6.18-238.1.1.el5 #1 SMP Tue Jan 4 13:32:19 EST 2011
&gt; x86_64 x86_64 x86_64 GNU/Linux
&gt; 
&gt; % perl -V
&gt; 
&gt; Summary of my perl5 &#40;revision 5 version 8 subversion 8&#41; configuration:
&gt;   Platform:
&gt;     osname=linux, osvers=2.6.18-53.el5, archname=x86_64-linux-thread-
&gt; multi
&gt;     uname=&#39;linux builder10.centos.org 2.6.18-53.el5 #1 smp mon nov 12
&gt; 02:14:55 est 2007 x86_64 x86_64
&gt; x86_64 gnulinux &#39;
&gt;     config_args=&#39;-des -Doptimize=-O2 -g -pipe -Wall
&gt; -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-
&gt; protector --param=ssp-buffer-size=4 -m64 -mtune=generic
&gt; -Dversion=5.8.8 -Dmyhostname=localhost -
&gt; Dperladmin=root@localhost -Dcc=gcc -Dcf_by=Red Hat, Inc.
&gt; -Dinstallprefix=/usr -Dprefix=/usr -
&gt; Dlibpth=/usr/local/lib64 /lib64 /usr/lib64
&gt; -Dprivlib=/usr/lib/perl5/5.8.8 -
&gt; Dsitelib=/usr/lib/perl5/site_perl/5.8.8
&gt; -Dvendorlib=/usr/lib/perl5/vendor_perl/5.8.8 -
&gt; Darchlib=/usr/lib64/perl5/5.8.8/x86_64-linux-thread-multi -
&gt; Dsitearch=/usr/lib64/perl5/site_perl/5.8.8/x86_64-linux-thread-multi -
&gt; Dvendorarch=/usr/lib64/perl5/vendor_perl/5.8.8/x86_64-linux-thread-
&gt; multi -Darchname=x86_64-linux-
&gt; thread-multi -Dvendorprefix=/usr -Dsiteprefix=/usr -Duseshrplib
&gt; -Dusethreads -Duseithreads -Duselargefiles
&gt; -Dd_dosuid -Dd_semctl_semun -Di_db -Ui_ndbm -Di_gdbm -Di_shadow
&gt; -Di_syslog -Dman3ext=3pm -
&gt; Duseperlio -Dinstallusrbinperl=n -Ubincompat5005 -Uversiononly
&gt; -Dpager=/usr/bin/less -isr -
&gt; Dd_gethostent_r_proto -Ud_endhostent_r_proto -Ud_sethostent_r_proto
&gt; -Ud_endprotoent_r_proto -
&gt; Ud_setprotoent_r_proto -Ud_endservent_r_proto -Ud_setservent_r_proto
&gt; -Dinc_version_list=5.8.7 5.8.6 5.8.5 -
&gt; Dscriptdir=/usr/bin&#39;
&gt;     hint=recommended, useposix=true, d_sigaction=define
&gt;     usethreads=define use5005threads=undef useithreads=define
&gt; usemultiplicity=define
&gt;     useperlio=define d_sfio=undef uselargefiles=define usesocks=undef
&gt;     use64bitint=define use64bitall=define uselongdouble=undef
&gt;     usemymalloc=n, bincompat5005=undef
&gt;   Compiler:
&gt;     cc=&#39;gcc&#39;, ccflags =&#39;-D_REENTRANT -D_GNU_SOURCE
&gt; -fno-strict-aliasing -pipe -Wdeclaration-after-statement
&gt; -I/usr/local/include -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64
&gt; -I/usr/include/gdbm&#39;,
&gt;     optimize=&#39;-O2 -g -pipe -Wall -Wp,-D_FORTIFY_SOURCE=2 -fexceptions
&gt; -fstack-protector --param=ssp-
&gt; buffer-size=4 -m64 -mtune=generic&#39;,
&gt;     cppflags=&#39;-D_REENTRANT -D_GNU_SOURCE -fno-strict-aliasing -pipe
&gt; -Wdeclaration-after-statement -
&gt; I/usr/local/include -I/usr/include/gdbm&#39;
&gt;     ccversion=&#39;&#39;, gccversion=&#39;4.1.2 20080704 &#40;Red Hat 4.1.2-46&#41;&#39;,
&gt; gccosandvers=&#39;&#39;
&gt;     intsize=4, longsize=8, ptrsize=8, doublesize=8, byteorder=12345678
&gt;     d_longlong=define, longlongsize=8, d_longdbl=define,
&gt; longdblsize=16
&gt;     ivtype=&#39;long&#39;, ivsize=8, nvtype=&#39;double&#39;, nvsize=8, Off_t=&#39;off_t&#39;,
&gt; lseeksize=8
&gt;     alignbytes=8, prototype=define
&gt;   Linker and Libraries:
&gt;     ld=&#39;gcc&#39;, ldflags =&#39;&#39;
&gt;     libpth=/usr/local/lib64 /lib64 /usr/lib64
&gt;     libs=-lresolv -lnsl -lgdbm -ldb -ldl -lm -lcrypt -lutil -lpthread
&gt; -lc
&gt;     perllibs=-lresolv -lnsl -ldl -lm -lcrypt -lutil -lpthread -lc
&gt;     libc=, so=so, useshrplib=true, libperl=libperl.so
&gt;     gnulibc_version=&#39;2.5&#39;
&gt;   Dynamic Linking:
&gt;     dlsrc=dl_dlopen.xs, dlext=so, d_dlsymun=undef, ccdlflags=&#39;-Wl,-E
&gt; -Wl,-
&gt; rpath,/usr/lib64/perl5/5.8.8/x86_64-linux-thread-multi/CORE&#39;
&gt;     cccdlflags=&#39;-fPIC&#39;, lddlflags=&#39;-shared -O2 -g -pipe -Wall
&gt; -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-
&gt; protector --param=ssp-buffer-size=4 -m64 -mtune=generic&#39;
&gt; 
&gt; 
&gt; Characteristics of this binary &#40;from libperl&#41;:
&gt;   Compile-time options: MULTIPLICITY PERL_IMPLICIT_CONTEXT
&gt;                         PERL_MALLOC_WRAP USE_64_BIT_ALL USE_64_BIT_INT
&gt;                         USE_ITHREADS USE_LARGE_FILES USE_PERLIO
&gt;                         USE_REENTRANT_API
&gt;   Built under linux
&gt;   Compiled at Sep  3 2009 10:26:51
&gt;   %ENV:
&gt;     PERL_READLINE_NOWARN=&#34;&#34;
&gt;     PERL_RL=&#34; o=0&#34;
&gt;   @INC:
&gt;     /usr/lib64/perl5/site_perl/5.8.8/x86_64-linux-thread-multi
&gt;     /usr/lib/perl5/site_perl/5.8.8
&gt;     /usr/lib/perl5/site_perl
&gt;     /usr/lib64/perl5/vendor_perl/5.8.8/x86_64-linux-thread-multi
&gt;     /usr/lib/perl5/vendor_perl/5.8.8
&gt;     /usr/lib/perl5/vendor_perl
&gt;     /usr/lib64/perl5/5.8.8/x86_64-linux-thread-multi
&gt;     /usr/lib/perl5/5.8.8
&gt;     .
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;10&nbsp;12:44:24&nbsp;2012</span>
    <span class="description">ishigaki [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
