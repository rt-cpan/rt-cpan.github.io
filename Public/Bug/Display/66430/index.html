<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #66430 for DBIx-Class: DB2_400_SQL error Fetch First in LimitDialects.pm</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #66430 for DBIx-Class: DB2_400_SQL error Fetch First in LimitDialects.pm</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/DBIx-Class/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/DBIx-Class/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/DBIx-Class/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/DBIx-Class/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBIx-Class">DBIx-Class CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">66430</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/DBIx-Class/Active/">DBIx-Class</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
carlosyr [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10410-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-10411-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.08191    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;06&nbsp;17:19:01&nbsp;2011</span>
    <span class="description">carlosyr [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> DB2_400_SQL error Fetch First in LimitDialects.pm</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 6 Mar 2011 17:48:52 -0430</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Carlos Ramírez &lt;carlosyr [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sorry for my bad English.

I found a bug in the execution of LimitDialects between
DBIx::Class:SQLMaker::LimitDialects and iSeries V5R3.
The error:

&#34;Unsupported data struct HASH for ORDER BY&#34;

I make work whith the next modification:
!!!!!!!
--- LimitDialectsOriginal.pm    2011-03-06 16:01:52.000000000 -0430
+++ LimitDialectsNew.pm    2011-03-06 16:48:07.000000000 -0430
@@ -23,7 +23,7 @@

     my $last = $rows + $offset;

-    my &#40; $order_by_up, $order_by_down &#41; = $self-&gt;_order_directions&#40; $order
&#41;;
+    my &#40; $order_by_up, $order_by_down &#41; = $self-&gt;_order_directions&#40;
$order-&gt;{order_by} &#41;;

     $sql = &#34;
       SELECT * FROM &#40;
!!!!!!



My Plataform:  Debian GNU V 6.0 &#40;Squeeze&#41; =&gt; &#40;uname -a&#41;: Linux os400-linux
2.6.32-5-486 #1 Wed Jan 12 03:28:50 UTC 2011 i686 GNU/Linu
Perl: 5.10
DBIx::Class: 0.08127


Carlos Ramírez
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;06&nbsp;18:00:40&nbsp;2011</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #66430] DB2_400_SQL error Fetch First in LimitDialects.pm</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 07 Mar 2011 00:00:27 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Peter Rabbitson &lt;ribasushi [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Carlos Ramírez via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Sun Mar 06 17:19:01 2011: Request 66430 was acted upon.
&gt; Transaction: Ticket created by carlosyr@gmail.com
&gt;        Queue: DBIx-Class
&gt;      Subject: DB2_400_SQL error Fetch First in LimitDialects.pm
&gt;    Broken in: &#40;no value&#41;
&gt;     Severity: &#40;no value&#41;
&gt;        Owner: Nobody
&gt;   Requestors: carlosyr@gmail.com
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=66430">http://rt.cpan.org/Ticket/Display.html?id=66430</a></span> &gt;
&gt; 
&gt; 
&gt; Sorry for my bad English.
&gt; 
&gt; I found a bug in the execution of LimitDialects between
&gt; DBIx::Class:SQLMaker::LimitDialects and iSeries V5R3.
</div>
Hello Carlos!

Am I understanding correctly you have access to DB2/AS400 ?
If yes - the real fix is to test if all of the legacy code
can be thrown away. Attached is a patch against 0.08127,
please verify it still passes t/746db2_400.t for you.

Thanks!
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git a/lib/DBIx/Class/SQLMaker/LimitDialects.pm b/lib/DBIx/Class/SQLMaker/LimitDialects.pm
index 1c30436..b06362f 100644
--- a/lib/DBIx/Class/SQLMaker/LimitDialects.pm
+++ b/lib/DBIx/Class/SQLMaker/LimitDialects.pm
@@ -7,78 +7,6 @@ use Carp::Clan qw/^DBIx::Class|^SQL::Abstract|^Try::Tiny/;
 use List::Util &#39;first&#39;;
 use namespace::clean;
 
-# FIXME
-# This dialect has not been ported to the subquery-realiasing code
-# that all other subquerying dialects are using. It is very possible
-# that this dialect is entirely unnecessary - it is currently only
-# used by ::Storage::DBI::ODBC::DB2_400_SQL which *should* be able to
-# just subclass ::Storage::DBI::DB2 and use the already rewritten
-# RowNumberOver. However nobody has access to this specific database
-# engine, thus keeping legacy code as-is
-# IF someone ever manages to test DB2-AS/400 with RNO, all the code
-# in this block should go on to meet its maker
-{
-  sub _FetchFirst {
-    my &#40; $self, $sql, $order, $rows, $offset &#41; = @_;
-
-    my $last = $rows + $offset;
-
-    my &#40; $order_by_up, $order_by_down &#41; = $self-&gt;_order_directions&#40; $order &#41;;
-
-    $sql = &#34;
-      SELECT * FROM &#40;
-        SELECT * FROM &#40;
-          $sql
-          $order_by_up
-          FETCH FIRST $last ROWS ONLY
-        &#41; foo
-        $order_by_down
-        FETCH FIRST $rows ROWS ONLY
-      &#41; bar
-      $order_by_up
-    &#34;;
-
-    return $sql;
-  }
-
-  sub _order_directions {
-    my &#40; $self, $order &#41; = @_;
-
-    return unless $order;
-
-    my $ref = ref $order;
-
-    my @order;
-
-    CASE: {
-      @order = @$order,     last CASE if $ref eq &#39;ARRAY&#39;;
-      @order = &#40; $order &#41;,  last CASE unless $ref;
-      @order = &#40; $$order &#41;, last CASE if $ref eq &#39;SCALAR&#39;;
-      croak __PACKAGE__ . &#34;: Unsupported data struct $ref for ORDER BY&#34;;
-    }
-
-    my &#40; $order_by_up, $order_by_down &#41;;
-
-    foreach my $spec &#40; @order &#41;
-    {
-        my @spec = split &#39; &#39;, $spec;
-        croak&#40; &#34;bad column order spec: $spec&#34; &#41; if @spec &gt; 2;
-        push&#40; @spec, &#39;ASC&#39; &#41; unless @spec == 2;
-        my &#40; $col, $up &#41; = @spec; # or maybe down
-        $up = uc&#40; $up &#41;;
-        croak&#40; &#34;bad direction: $up&#34; &#41; unless $up =~ /^&#40;?:ASC|DESC&#41;$/;
-        $order_by_up .= &#34;, $col $up&#34;;
-        my $down = $up eq &#39;ASC&#39; ? &#39;DESC&#39; : &#39;ASC&#39;;
-        $order_by_down .= &#34;, $col $down&#34;;
-    }
-
-    s/^,/ORDER BY/ for &#40; $order_by_up, $order_by_down &#41;;
-
-    return $order_by_up, $order_by_down;
-  }
-}
-### end-of-FIXME
-
 =head1 NAME
 
 DBIx::Class::SQLMaker::LimitDialects - SQL::Abstract::Limit-like functionality for DBIx::Class::SQLMaker
diff --git a/lib/DBIx/Class/Storage/DBI/ODBC/DB2_400_SQL.pm b/lib/DBIx/Class/Storage/DBI/ODBC/DB2_400_SQL.pm
index 29e9da9..eed265f 100644
--- a/lib/DBIx/Class/Storage/DBI/ODBC/DB2_400_SQL.pm
+++ b/lib/DBIx/Class/Storage/DBI/ODBC/DB2_400_SQL.pm
@@ -2,53 +2,9 @@ package DBIx::Class::Storage::DBI::ODBC::DB2_400_SQL;
 use strict;
 use warnings;
 
-use base qw/DBIx::Class::Storage::DBI::ODBC/;
+use base qw/DBIx::Class::Storage::DBI::DB2/;
 use mro &#39;c3&#39;;
 
-warn &#39;Major advances took place in the DBIC codebase since this driver&#39;
-  .&#39; &#40;::Storage::DBI::ODBC::DB2_400_SQL&#41; was written. However since the&#39;
-  .&#39; RDBMS in question is so rare it is not possible for us to test any&#39;
-  .&#39; of the &#34;new hottness&#34;. If you are using DB2 on AS-400 please get&#39;
-  .&#39; in contact with the developer team:&#39;
-  .&#39; <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/dist/DBIx-Class/lib/DBIx/Class.pm#GETTING_HELP/SUPPORT&#39;">http://search.cpan.org/dist/DBIx-Class/lib/DBIx/Class.pm#GETTING_HELP/SUPPORT&#39;</a></span>
-  .&#34;\n&#34;
-;
-
-# FIXME
-# Most likely all of this code is redundant and unnecessary. We should
-# be able to simply use base qw/DBIx::Class::Storage::DBI::DB2/;
-# Unfortunately nobody has an RDBMS engine to test with, so keeping
-# things as-is for the time being
-
-sub _dbh_last_insert_id {
-    my &#40;$self, $dbh, $source, $col&#41; = @_;
-
-    # get the schema/table separator:
-    #    &#39;.&#39; when SQL naming is active
-    #    &#39;/&#39; when system naming is active
-    my $sep = $dbh-&gt;get_info&#40;41&#41;;
-    my $sth = $dbh-&gt;prepare_cached&#40;
-        &#34;SELECT IDENTITY_VAL_LOCAL&#40;&#41; FROM SYSIBM${sep}SYSDUMMY1&#34;, {}, 3&#41;;
-    $sth-&gt;execute&#40;&#41;;
-
-    my @res = $sth-&gt;fetchrow_array&#40;&#41;;
-
-    return @res ? $res[0] : undef;
-}
-
-sub _sql_maker_opts {
-    my &#40;$self&#41; = @_;
-
-    $self-&gt;dbh_do&#40;sub {
-        my &#40;$self, $dbh&#41; = @_;
-
-        return {
-            limit_dialect =&gt; &#39;FetchFirst&#39;,
-            name_sep =&gt; $dbh-&gt;get_info&#40;41&#41;
-        };
-    }&#41;;
-}
-
 1;
 
 =head1 NAME
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;06&nbsp;18:00:42&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;06&nbsp;19:21:46&nbsp;2011</span>
    <span class="description">carlosyr [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #66430] DB2_400_SQL error Fetch First in LimitDialects.pm</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 6 Mar 2011 19:51:34 -0430</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Carlos Ramírez &lt;carlosyr [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Peter

First I have  to  answers you:
- Am I understanding correctly you have access to DB2/AS400 ?
Yes, I have.

Now, I apply the patch and ran test and die with error en insert clausule:

DBIx::Class::ResultSet::create&#40;&#41;: DBI Exception: DBD::ODBC::db
prepare_cached failed: [unixODBC][IBM][Controlador ODBC de iSeries
Access][DB2 UDB]SQL0029 - Falta la clausula INTO de la sentencia
intercalada. &#40;SQL-HY000&#41; [for Statement &#34;VALUES&#40;IDENTITY_VAL_LOCAL&#40;&#41;&#41;&#34;] at
t/746db2_400.t line 37
# Looks like your test exited with 11 before it could output anything.
t/746db2_400.t .. Dubious, test returned 11 &#40;wstat 2816, 0xb00&#41;
Failed 6/6 subtests

I will trie to translate the spanish text:

DBIx::Class::ResultSet::create&#40;&#41;: DBI Exception: DBD::ODBC::db
prepare_cached failed: [unixODBC][IBM][Controller/Driver ODBC iSeries
Access][DB2 UDB]SQL0029 - Missing  INTO clausule of the sentence
&#34;intercalated?&#34;. &#40;SQL-HY000&#41; [for Statement &#34;VALUES&#40;IDENTITY_VAL_LOCAL&#40;&#41;&#41;&#34;]
at t/746db2_400.t line 37
# Looks like your test exited with 11 before it could output anything.
t/746db2_400.t .. Dubious, test returned 11 &#40;wstat 2816, 0xb00&#41;
Failed 6/6 subtests

Line 37 says:

my $new = $schema-&gt;resultset&#40;&#39;Artist&#39;&#41;-&gt;create&#40;{ name =&gt; &#39;foo&#39; }&#41;;


After the test, I Created  the table artis manually on my OS400 and this
created ok, a ran a simple insert clausule and OK.


How I Can Help?




<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; diff --git a/lib/DBIx/Class/SQLMaker/LimitDialects.pm
&gt; b/lib/DBIx/Class/SQLMaker/LimitDialects.pm
&gt; index 1c30436..b06362f 100644
&gt; --- a/lib/DBIx/Class/SQLMaker/LimitDialects.pm
&gt; +++ b/lib/DBIx/Class/SQLMaker/LimitDialects.pm
&gt; @@ -7,78 +7,6 @@ use Carp::Clan qw/^DBIx::Class|^SQL::Abstract|^Try::Tiny/;
&gt;  use List::Util &#39;first&#39;;
&gt;  use namespace::clean;
&gt;
&gt; -# FIXME
&gt; -# This dialect has not been ported to the subquery-realiasing code
&gt; -# that all other subquerying dialects are using. It is very possible
&gt; -# that this dialect is entirely unnecessary - it is currently only
&gt; -# used by ::Storage::DBI::ODBC::DB2_400_SQL which *should* be able to
&gt; -# just subclass ::Storage::DBI::DB2 and use the already rewritten
&gt; -# RowNumberOver. However nobody has access to this specific database
&gt; -# engine, thus keeping legacy code as-is
&gt; -# IF someone ever manages to test DB2-AS/400 with RNO, all the code
&gt; -# in this block should go on to meet its maker
&gt; -{
&gt; -  sub _FetchFirst {
&gt; -    my &#40; $self, $sql, $order, $rows, $offset &#41; = @_;
&gt; -
&gt; -    my $last = $rows + $offset;
&gt; -
&gt; -    my &#40; $order_by_up, $order_by_down &#41; = $self-&gt;_order_directions&#40; $order
&gt; &#41;;
&gt; -
&gt; -    $sql = &#34;
&gt; -      SELECT * FROM &#40;
&gt; -        SELECT * FROM &#40;
&gt; -          $sql
&gt; -          $order_by_up
&gt; -          FETCH FIRST $last ROWS ONLY
&gt; -        &#41; foo
&gt; -        $order_by_down
&gt; -        FETCH FIRST $rows ROWS ONLY
&gt; -      &#41; bar
&gt; -      $order_by_up
&gt; -    &#34;;
&gt; -
&gt; -    return $sql;
&gt; -  }
&gt; -
&gt; -  sub _order_directions {
&gt; -    my &#40; $self, $order &#41; = @_;
&gt; -
&gt; -    return unless $order;
&gt; -
&gt; -    my $ref = ref $order;
&gt; -
&gt; -    my @order;
&gt; -
&gt; -    CASE: {
&gt; -      @order = @$order,     last CASE if $ref eq &#39;ARRAY&#39;;
&gt; -      @order = &#40; $order &#41;,  last CASE unless $ref;
&gt; -      @order = &#40; $$order &#41;, last CASE if $ref eq &#39;SCALAR&#39;;
&gt; -      croak __PACKAGE__ . &#34;: Unsupported data struct $ref for ORDER BY&#34;;
&gt; -    }
&gt; -
&gt; -    my &#40; $order_by_up, $order_by_down &#41;;
&gt; -
&gt; -    foreach my $spec &#40; @order &#41;
&gt; -    {
&gt; -        my @spec = split &#39; &#39;, $spec;
&gt; -        croak&#40; &#34;bad column order spec: $spec&#34; &#41; if @spec &gt; 2;
&gt; -        push&#40; @spec, &#39;ASC&#39; &#41; unless @spec == 2;
&gt; -        my &#40; $col, $up &#41; = @spec; # or maybe down
&gt; -        $up = uc&#40; $up &#41;;
&gt; -        croak&#40; &#34;bad direction: $up&#34; &#41; unless $up =~ /^&#40;?:ASC|DESC&#41;$/;
&gt; -        $order_by_up .= &#34;, $col $up&#34;;
&gt; -        my $down = $up eq &#39;ASC&#39; ? &#39;DESC&#39; : &#39;ASC&#39;;
&gt; -        $order_by_down .= &#34;, $col $down&#34;;
&gt; -    }
&gt; -
&gt; -    s/^,/ORDER BY/ for &#40; $order_by_up, $order_by_down &#41;;
&gt; -
&gt; -    return $order_by_up, $order_by_down;
&gt; -  }
&gt; -}
&gt; -### end-of-FIXME
&gt; -
&gt;  =head1 NAME
&gt;
&gt;  DBIx::Class::SQLMaker::LimitDialects - SQL::Abstract::Limit-like
&gt; functionality for DBIx::Class::SQLMaker
&gt; diff --git a/lib/DBIx/Class/Storage/DBI/ODBC/DB2_400_SQL.pm
&gt; b/lib/DBIx/Class/Storage/DBI/ODBC/DB2_400_SQL.pm
&gt; index 29e9da9..eed265f 100644
&gt; --- a/lib/DBIx/Class/Storage/DBI/ODBC/DB2_400_SQL.pm
&gt; +++ b/lib/DBIx/Class/Storage/DBI/ODBC/DB2_400_SQL.pm
&gt; @@ -2,53 +2,9 @@ package DBIx::Class::Storage::DBI::ODBC::DB2_400_SQL;
&gt;  use strict;
&gt;  use warnings;
&gt;
&gt; -use base qw/DBIx::Class::Storage::DBI::ODBC/;
&gt; +use base qw/DBIx::Class::Storage::DBI::DB2/;
&gt;  use mro &#39;c3&#39;;
&gt;
&gt; -warn &#39;Major advances took place in the DBIC codebase since this driver&#39;
&gt; -  .&#39; &#40;::Storage::DBI::ODBC::DB2_400_SQL&#41; was written. However since the&#39;
&gt; -  .&#39; RDBMS in question is so rare it is not possible for us to test any&#39;
&gt; -  .&#39; of the &#34;new hottness&#34;. If you are using DB2 on AS-400 please get&#39;
&gt; -  .&#39; in contact with the developer team:&#39;
&gt; -  .&#39;
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/dist/DBIx-Class/lib/DBIx/Class.pm#GETTING_HELP/SUPPORT">http://search.cpan.org/dist/DBIx-Class/lib/DBIx/Class.pm#GETTING_HELP/SUPPORT</a></span>
&gt; &#39;
&gt; -  .&#34;\n&#34;
&gt; -;
&gt; -
&gt; -# FIXME
&gt; -# Most likely all of this code is redundant and unnecessary. We should
&gt; -# be able to simply use base qw/DBIx::Class::Storage::DBI::DB2/;
&gt; -# Unfortunately nobody has an RDBMS engine to test with, so keeping
&gt; -# things as-is for the time being
&gt; -
&gt; -sub _dbh_last_insert_id {
&gt; -    my &#40;$self, $dbh, $source, $col&#41; = @_;
&gt; -
&gt; -    # get the schema/table separator:
&gt; -    #    &#39;.&#39; when SQL naming is active
&gt; -    #    &#39;/&#39; when system naming is active
&gt; -    my $sep = $dbh-&gt;get_info&#40;41&#41;;
&gt; -    my $sth = $dbh-&gt;prepare_cached&#40;
&gt; -        &#34;SELECT IDENTITY_VAL_LOCAL&#40;&#41; FROM SYSIBM${sep}SYSDUMMY1&#34;, {}, 3&#41;;
&gt; -    $sth-&gt;execute&#40;&#41;;
&gt; -
&gt; -    my @res = $sth-&gt;fetchrow_array&#40;&#41;;
&gt; -
&gt; -    return @res ? $res[0] : undef;
&gt; -}
&gt; -
&gt; -sub _sql_maker_opts {
&gt; -    my &#40;$self&#41; = @_;
&gt; -
&gt; -    $self-&gt;dbh_do&#40;sub {
&gt; -        my &#40;$self, $dbh&#41; = @_;
&gt; -
&gt; -        return {
&gt; -            limit_dialect =&gt; &#39;FetchFirst&#39;,
&gt; -            name_sep =&gt; $dbh-&gt;get_info&#40;41&#41;
&gt; -        };
&gt; -    }&#41;;
&gt; -}
&gt; -
&gt;  1;
&gt;
&gt;  =head1 NAME
&gt;
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;06&nbsp;19:36:25&nbsp;2011</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #66430] DB2_400_SQL error Fetch First in LimitDialects.pm</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 07 Mar 2011 01:36:12 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Peter Rabbitson &lt;ribasushi [...] cpan.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Carlos Ramírez via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: DBIx-Class
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=66430">https://rt.cpan.org/Ticket/Display.html?id=66430</a></span> &gt;
&gt; 
&gt; Hi Peter
&gt; 
&gt; First I have  to  answers you:
&gt; - Am I understanding correctly you have access to DB2/AS400 ?
&gt; Yes, I have.
</div>
Excellent, you will be my DB2 AS/400 tester-in-residence :&#41;


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Now, I apply the patch and ran test and die with error en insert clausule:
&gt; 
&gt; ...
&gt; 
&gt; How I Can Help?
&gt; 
</div>
Try this new patch I am sending you &#40;again written against 0.08127, do not
apply it over the old one&#41;.
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git a/lib/DBIx/Class/SQLMaker/LimitDialects.pm b/lib/DBIx/Class/SQLMaker/LimitDialects.pm
index 1c30436..b06362f 100644
--- a/lib/DBIx/Class/SQLMaker/LimitDialects.pm
+++ b/lib/DBIx/Class/SQLMaker/LimitDialects.pm
@@ -7,78 +7,6 @@ use Carp::Clan qw/^DBIx::Class|^SQL::Abstract|^Try::Tiny/;
 use List::Util &#39;first&#39;;
 use namespace::clean;
 
-# FIXME
-# This dialect has not been ported to the subquery-realiasing code
-# that all other subquerying dialects are using. It is very possible
-# that this dialect is entirely unnecessary - it is currently only
-# used by ::Storage::DBI::ODBC::DB2_400_SQL which *should* be able to
-# just subclass ::Storage::DBI::DB2 and use the already rewritten
-# RowNumberOver. However nobody has access to this specific database
-# engine, thus keeping legacy code as-is
-# IF someone ever manages to test DB2-AS/400 with RNO, all the code
-# in this block should go on to meet its maker
-{
-  sub _FetchFirst {
-    my &#40; $self, $sql, $order, $rows, $offset &#41; = @_;
-
-    my $last = $rows + $offset;
-
-    my &#40; $order_by_up, $order_by_down &#41; = $self-&gt;_order_directions&#40; $order &#41;;
-
-    $sql = &#34;
-      SELECT * FROM &#40;
-        SELECT * FROM &#40;
-          $sql
-          $order_by_up
-          FETCH FIRST $last ROWS ONLY
-        &#41; foo
-        $order_by_down
-        FETCH FIRST $rows ROWS ONLY
-      &#41; bar
-      $order_by_up
-    &#34;;
-
-    return $sql;
-  }
-
-  sub _order_directions {
-    my &#40; $self, $order &#41; = @_;
-
-    return unless $order;
-
-    my $ref = ref $order;
-
-    my @order;
-
-    CASE: {
-      @order = @$order,     last CASE if $ref eq &#39;ARRAY&#39;;
-      @order = &#40; $order &#41;,  last CASE unless $ref;
-      @order = &#40; $$order &#41;, last CASE if $ref eq &#39;SCALAR&#39;;
-      croak __PACKAGE__ . &#34;: Unsupported data struct $ref for ORDER BY&#34;;
-    }
-
-    my &#40; $order_by_up, $order_by_down &#41;;
-
-    foreach my $spec &#40; @order &#41;
-    {
-        my @spec = split &#39; &#39;, $spec;
-        croak&#40; &#34;bad column order spec: $spec&#34; &#41; if @spec &gt; 2;
-        push&#40; @spec, &#39;ASC&#39; &#41; unless @spec == 2;
-        my &#40; $col, $up &#41; = @spec; # or maybe down
-        $up = uc&#40; $up &#41;;
-        croak&#40; &#34;bad direction: $up&#34; &#41; unless $up =~ /^&#40;?:ASC|DESC&#41;$/;
-        $order_by_up .= &#34;, $col $up&#34;;
-        my $down = $up eq &#39;ASC&#39; ? &#39;DESC&#39; : &#39;ASC&#39;;
-        $order_by_down .= &#34;, $col $down&#34;;
-    }
-
-    s/^,/ORDER BY/ for &#40; $order_by_up, $order_by_down &#41;;
-
-    return $order_by_up, $order_by_down;
-  }
-}
-### end-of-FIXME
-
 =head1 NAME
 
 DBIx::Class::SQLMaker::LimitDialects - SQL::Abstract::Limit-like functionality for DBIx::Class::SQLMaker
diff --git a/lib/DBIx/Class/Storage/DBI/ODBC/DB2_400_SQL.pm b/lib/DBIx/Class/Storage/DBI/ODBC/DB2_400_SQL.pm
index 29e9da9..cdbdee6 100644
--- a/lib/DBIx/Class/Storage/DBI/ODBC/DB2_400_SQL.pm
+++ b/lib/DBIx/Class/Storage/DBI/ODBC/DB2_400_SQL.pm
@@ -2,51 +2,22 @@ package DBIx::Class::Storage::DBI::ODBC::DB2_400_SQL;
 use strict;
 use warnings;
 
-use base qw/DBIx::Class::Storage::DBI::ODBC/;
+use base qw/DBIx::Class::Storage::DBI::DB2/;
 use mro &#39;c3&#39;;
 
-warn &#39;Major advances took place in the DBIC codebase since this driver&#39;
-  .&#39; &#40;::Storage::DBI::ODBC::DB2_400_SQL&#41; was written. However since the&#39;
-  .&#39; RDBMS in question is so rare it is not possible for us to test any&#39;
-  .&#39; of the &#34;new hottness&#34;. If you are using DB2 on AS-400 please get&#39;
-  .&#39; in contact with the developer team:&#39;
-  .&#39; <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/dist/DBIx-Class/lib/DBIx/Class.pm#GETTING_HELP/SUPPORT&#39;">http://search.cpan.org/dist/DBIx-Class/lib/DBIx/Class.pm#GETTING_HELP/SUPPORT&#39;</a></span>
-  .&#34;\n&#34;
-;
-
-# FIXME
-# Most likely all of this code is redundant and unnecessary. We should
-# be able to simply use base qw/DBIx::Class::Storage::DBI::DB2/;
-# Unfortunately nobody has an RDBMS engine to test with, so keeping
-# things as-is for the time being
-
 sub _dbh_last_insert_id {
-    my &#40;$self, $dbh, $source, $col&#41; = @_;
-
-    # get the schema/table separator:
-    #    &#39;.&#39; when SQL naming is active
-    #    &#39;/&#39; when system naming is active
-    my $sep = $dbh-&gt;get_info&#40;41&#41;;
-    my $sth = $dbh-&gt;prepare_cached&#40;
-        &#34;SELECT IDENTITY_VAL_LOCAL&#40;&#41; FROM SYSIBM${sep}SYSDUMMY1&#34;, {}, 3&#41;;
-    $sth-&gt;execute&#40;&#41;;
-
-    my @res = $sth-&gt;fetchrow_array&#40;&#41;;
-
-    return @res ? $res[0] : undef;
-}
-
-sub _sql_maker_opts {
-    my &#40;$self&#41; = @_;
-
-    $self-&gt;dbh_do&#40;sub {
-        my &#40;$self, $dbh&#41; = @_;
-
-        return {
-            limit_dialect =&gt; &#39;FetchFirst&#39;,
-            name_sep =&gt; $dbh-&gt;get_info&#40;41&#41;
-        };
-    }&#41;;
+  #my &#40;$self, $dbh, $source, $col&#41; = @_;
+
+  # get the schema/table separator:
+  #    &#39;.&#39; when SQL naming is active
+  #    &#39;/&#39; when system naming is active
+  my $sep = $_[1]-&gt;get_info&#40;41&#41;;
+  my $sth = $_[1]-&gt;prepare_cached&#40;
+    &#34;SELECT IDENTITY_VAL_LOCAL&#40;&#41; FROM SYSIBM${sep}SYSDUMMY1&#34;, {}, 3
+  &#41;;
+  $sth-&gt;execute&#40;&#41;;
+
+  return &#40;$sth-&gt;fetchrow_array&#40;&#41;&#41;[0];
 }
 
 1;
@@ -65,16 +36,12 @@ over ODBC
 
 =head1 DESCRIPTION
 
-This class implements support specific to DB2/400 over ODBC, including
-auto-increment primary keys, SQL::Abstract::Limit dialect, and name separator
-for connections using either SQL naming or System naming.
-
-
-=head1 AUTHORS
+This class implements functionality specific to DB2/400 over ODBC,
+particularly support for auto-increment primary keys.
 
-Marc Mims C&lt;&lt; &lt;marc@questright.com&gt; &gt;&gt;
+=head1 AUTHOR
 
-Based on DBIx::Class::Storage::DBI::DB2 by Jess Robinson.
+See L&lt;DBIx::Class/AUTHOR&gt; and L&lt;DBIx::Class/CONTRIBUTORS&gt;.
 
 =head1 LICENSE
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;06&nbsp;21:32:29&nbsp;2011</span>
    <span class="description">carlosyr [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #66430] DB2_400_SQL error Fetch First in LimitDialects.pm</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 6 Mar 2011 22:02:19 -0430</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Carlos Ramírez &lt;carlosyr [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Excellent, you will be my DB2 AS/400 tester-in-residence :&#41;
&gt;
&gt; That&#39;s Fine :-D, I hope help
</div>


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Try this new patch I am sending you &#40;again written against 0.08127, do not
&gt; apply it over the old one&#41;.
&gt;
&gt;
</div>....

Ok, First, a I comment to you that procedure that I&#39;m doing to apply the
patch &#40;maybe I&#39;m doing something wrong&#41;
1. perl -MCPAN -e shell
2. look DBIx::Class
3. patch -p1 &lt; /some/place/patch_you_send_me &#40;this says ok and apply two
patch&#41;
4. perl Makefile.PL
5. Edit Makefile and delete all other test and add manually t/746db2_400.t
6. make test

Now, this time die in select clausule:

BIx::Class::ResultSet::next&#40;&#41;: DBI Exception: DBD::ODBC::db prepare_cached
failed: [unixODBC][IBM][Controlador ODBC de iSeries Access][DB2 UDB]SQL0104
- Symbol  &#40; not valid. Symbols valids: , FROM INTO. &#40;SQL-42000&#41; [for
Statement &#34;
SELECT artistid, name, rank, charfield FROM &#40;
  SELECT artistid, name, rank, charfield, ROW_NUMBER&#40;&#41; OVER&#40;  ORDER BY
artistid &#41; AS rno__row__index FROM &#40;
    SELECT me.artistid, me.name, me.rank, me.charfield FROM artist me
  &#41; me
&#41; me WHERE rno__row__index BETWEEN 1 AND 3


Now I tell you that the ROW_NUMBER&#40;&#41; Function not exist in my OS400 Versión
&#40;V5R3&#41; but I think so,  exist in more &#34;new&#34;&#40;new against my version &#39;cause
the version OS is in V7R1 :-s &#41;  versions &#40;like V5R4&#41;. Unfortunally I can&#39;t
probe in superior version &#40;In Inferior Version V5R1, broken the original
sentence based in Fetch First &#39;cause this version not admit complex
subquerys like Order By &#34;anidate?&#34;&#41;

The Symbol &#34;&#40;&#34; that refer the error it&#39;s the parentesis of  function OVER
that&#39;s no exist in my OS Version neither

For my OS Version the clausule to paginate have to be based on Fetch First
:&#40;, &#40;but your clausule it&#39;s fine as ibm documentation for release V5R4 and
superior&#41;


Again sorry for my english.

Carlos
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Mar&nbsp;06&nbsp;21:51:08&nbsp;2011</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #66430] DB2_400_SQL error Fetch First in LimitDialects.pm</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 07 Mar 2011 03:50:57 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Peter Rabbitson &lt;ribasushi [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Carlos Ramírez via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: DBIx-Class
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=66430">https://rt.cpan.org/Ticket/Display.html?id=66430</a></span> &gt;
&gt; 
<div class="message-stanza open">&gt;&gt; Excellent, you will be my DB2 AS/400 tester-in-residence :&#41;
&gt;&gt;
&gt;&gt; That&#39;s Fine :-D, I hope help
</div>&gt; 
&gt; 
&gt; 
<div class="message-stanza open">&gt;&gt; Try this new patch I am sending you &#40;again written against 0.08127, do not
&gt;&gt; apply it over the old one&#41;.
&gt;&gt;
&gt;&gt;
</div>&gt; ....
&gt; 
&gt; Ok, First, a I comment to you that procedure that I&#39;m doing to apply the
&gt; patch &#40;maybe I&#39;m doing something wrong&#41;
&gt; 1. perl -MCPAN -e shell
&gt; 2. look DBIx::Class
&gt; 3. patch -p1 &lt; /some/place/patch_you_send_me &#40;this says ok and apply two
&gt; patch&#41;
&gt; 4. perl Makefile.PL
&gt; 5. Edit Makefile and delete all other test and add manually t/746db2_400.t
</div>
^^^ never do this, editing the makefile is quite insane :&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 6. make test
</div>
`prove -l t/746db2_400.t` is what you want

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Now, this time die in select clausule:
&gt; 
&gt; BIx::Class::ResultSet::next&#40;&#41;: DBI Exception: DBD::ODBC::db prepare_cached
&gt; failed: [unixODBC][IBM][Controlador ODBC de iSeries Access][DB2 UDB]SQL0104
&gt; - Symbol  &#40; not valid. Symbols valids: , FROM INTO. &#40;SQL-42000&#41; [for
&gt; Statement &#34;
&gt; SELECT artistid, name, rank, charfield FROM &#40;
&gt;   SELECT artistid, name, rank, charfield, ROW_NUMBER&#40;&#41; OVER&#40;  ORDER BY
&gt; artistid &#41; AS rno__row__index FROM &#40;
&gt;     SELECT me.artistid, me.name, me.rank, me.charfield FROM artist me
&gt;   &#41; me
&gt; &#41; me WHERE rno__row__index BETWEEN 1 AND 3
&gt; 
&gt; 
&gt; Now I tell you that the ROW_NUMBER&#40;&#41; Function not exist in my OS400 Versión
&gt; &#40;V5R3&#41; but I think so,  exist in more &#34;new&#34;&#40;new against my version &#39;cause
&gt; the version OS is in V7R1 :-s &#41;  versions &#40;like V5R4&#41;. Unfortunally I can&#39;t
&gt; probe in superior version &#40;In Inferior Version V5R1, broken the original
&gt; sentence based in Fetch First &#39;cause this version not admit complex
&gt; subquerys like Order By &#34;anidate?&#34;&#41;
&gt; 
&gt; The Symbol &#34;&#40;&#34; that refer the error it&#39;s the parentesis of  function OVER
&gt; that&#39;s no exist in my OS Version neither
&gt; 
&gt; For my OS Version the clausule to paginate have to be based on Fetch First
&gt; :&#40;, &#40;but your clausule it&#39;s fine as ibm documentation for release V5R4 and
&gt; superior&#41;
&gt; 
</div>
Excellent! It is very late now, so I am going to send you a &#34;fetch-first&#34;
patch tomorrow. Even with this patch however you need to be aware of a major
drawback of the FETCH FIRST technique - it has a serious bug that can not be
worked around:

Consider what happens if you have a 5-row resultset, and you do:

-&gt;search&#40;{}, { rows =&gt; 3, offset =&gt; 4 }&#41;;

The resulting SQL will be roughly

SELECT * FROM &#40;
   SELECT * FROM &#40;
     SELECT * FROM foo ORDER BY foo.id
     FETCH FIRST 7 ROWS ONLY
   &#41;
   ORDER BY foo.id DESC
   FETCH FIRST 3 ROWS ONLY
&#41;
ORDER BY foo.id

instead of the expected 1 row you got 3&#40;!&#41;.

Therefore what you need to do is
1&#41; give me a reliable way to distinguish one db2 version from another, and
tell me which is the minimal version supporting ROW_NUMBER OVER. As I have
shown above we always want to use RNO if it is available.
2&#41; do some research and see if there are any other ways to do offset-limiting
with your version of DB2 &#40;again, since FETCH FIRST is potentially buggy&#41;.

Here is an example how we determine the limit dialect for MSSQL:

<span class="clickylink"><a target="new" rel="nofollow" href="http://git.shadowcat.co.uk/gitweb/gitweb.cgi?p=dbsrgits/DBIx-Class.git;a=blob;f=lib/DBIx/Class/Storage/DBI/MSSQL.pm;h=07d3a4f20965135031c13e968e9acefeb4bdfe15;hb=HEAD#l190">http://git.shadowcat.co.uk/gitweb/gitweb.cgi?p=dbsrgits/DBIx-Class.git;a=blob;f=lib/DBIx/Class/Storage/DBI/MSSQL.pm;h=07d3a4f20965135031c13e968e9acefeb4bdfe15;hb=HEAD#l190</a></span>

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Again sorry for my english.
</div>
This is the 3rd email in a row where you apologize for your decent english,
can you please stop that? I can understand you and you can understand me,
ergo your english is just fine :&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;07&nbsp;11:18:42&nbsp;2011</span>
    <span class="description">carlosyr [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #66430] DB2_400_SQL error Fetch First in LimitDialects.pm</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 7 Mar 2011 11:48:26 -0430</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Carlos Ramírez &lt;carlosyr [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Peter,


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; 5. Edit Makefile and delete all other test and add manually t/746db2_400.t
</div>&gt;
&gt; ^^^ never do this, editing the makefile is quite insane :&#41;
&gt;
<div class="message-stanza open">&gt; &gt; 6. make test
</div>&gt;
&gt; `prove -l t/746db2_400.t` is what you want
&gt;
</div>
Ok, Understood, This it&#39;s my first time that help in something like
this, never gonna happen again. Thanks :&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Consider what happens if you have a 5-row resultset, and you do:
&gt;
&gt; -&gt;search&#40;{}, { rows =&gt; 3, offset =&gt; 4 }&#41;;
&gt;
&gt; The resulting SQL will be roughly
&gt;
&gt; SELECT * FROM &#40;
&gt;   SELECT * FROM &#40;
&gt;     SELECT * FROM foo ORDER BY foo.id
&gt;     FETCH FIRST 7 ROWS ONLY
&gt;   &#41;
&gt;   ORDER BY foo.id DESC
&gt;   FETCH FIRST 3 ROWS ONLY
&gt; &#41;
&gt; ORDER BY foo.id
&gt;
&gt; instead of the expected 1 row you got 3&#40;!&#41;.
</div>
You&#39;re right it&#39;s a horrible bug.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Therefore what you need to do is
&gt; 1&#41; give me a reliable way to distinguish one db2 version from another, and
</div>
Jejeje, You broken my head with this homework, but at the end, the
solution it&#39;s a quite simple
After of broken my head &#40;and my system&#41; for many  hours, and not found
any solution for obtain DB2 Version trough SQL, I look you patch and
advised from function get_info for obtain the system name separator,
then I make this simple perl program:

#!/usr/bin/perl -w
use DBI;
my $dbh = DBI-&gt;connect&#40;&#34;dbi:ODBC:DSN&#34;,&#34;USER&#34;,&#34;password&#34;&#41;;
for&#40;$i=0; $i&lt;=41;$i++&#41;{
        print $i,&#34; =&gt; &#34;,$dbh-&gt;func&#40;$i,GetInfo&#41;,&#34;\n&#34;;
}


Note:  I used 41 for you reference of separator.

So, the func-&gt;&#40;18,GetInfo&#41; answer the DB2&#40;and OS version&#41; in the next
format Version.Release.build_packs_and_other

I ran the test against two system: V5R1 and V5R3. &#40;I don&#39;t have access
to another&#41;  this was the result:
V5R1 &#40;Versión 5 release 1&#41;: 05.01.0010
V5R3 &#40;Versión 5 release 3&#41;: 05.03.0014

&#40;Another tip: with 16 Obtain the SYSTEM NAME &#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; tell me which is the minimal version supporting ROW_NUMBER OVER. As I have
&gt; shown above we always want to use RNO if it is available.
</div>
I read IBM Doc. and say&#39;s it&#39;s V5R4. I Talked with some friends to
research version of OS/DB &#40;it&#39; the same&#41; but I have not positive
answers yet to probe. But in multiple sites on Internet the people ran
ROW_NUMBER OVER with V5R4.


Other tip:
V5R1 can not execute complex subquery Fetch First Not function, Order
By anidate no Function neither.

Another way to comunicate with AS400/DB2 it&#39;s with DBD::DB2 but it&#39;s
necesary the program &#40;and licensing&#41; the DB2Connector. and it&#39;s for
pay. for that I use ODBC.

The Versión of the ODBC iSeries  that i use it&#39;s 5.04 &#40;V5R4&#41; but there are V5R7.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 2&#41; do some research and see if there are any other ways to do offset-limiting
&gt; with your version of DB2 &#40;again, since FETCH FIRST is potentially buggy&#41;.
&gt;
</div>
Until now, nothing. I find the use of  rrn&#40;&#41; but it&#39;s not
functionally, by example:

Assuming one table &#40;artistid,name&#41; and 5 records:

Select rrn&#40;artist&#41; as row,* from artist:
row   artistid name
1       1          Carlos
2       2          Pedro
3       3          Juan
4       4          Peter
5       5          Charlie

Next delete one id by example artistid 2
Delete from artist where artistid = 2

Now Select:

Select rrn&#40;artist&#41; as row,* from artist:
row   artistid name
1       1          Carlos
3       3          Juan
4       4          Peter
5       5          Charlie

You See? This it&#39;s &#39;cause the rrn&#40;&#41; it&#39;s a position relative when was
insert the record and identify each row simply and unique.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Again sorry for my english.
</div>&gt;
&gt; This is the 3rd email in a row where you apologize for your decent english,
&gt; can you please stop that? I can understand you and you can understand me,
&gt; ergo your english is just fine :&#41;
</div>
I learned by my self, with nobody to practice, so, I don&#39;t know if
people understand me well.  But if you say that wer&#39;e OK :&#41;

Thanks a lot.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;17&nbsp;10:17:52&nbsp;2011</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

What you sent me is really helpful, I just got super busy and didn&#39;t
have a chance to send you the update. I will do so a bit later today,

Cheers!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;22&nbsp;07:05:16&nbsp;2011</span>
    <span class="description">rkitover [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Carlos,

any chance you could arrange an SSH tunnel to a test DB on your AS/400
DB2 instance for us?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;28&nbsp;10:57:59&nbsp;2011</span>
    <span class="description">rkitover [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Please try my branch with FetchFirst fixes and other refactorings:

git clone git://git.shadowcat.co.uk/dbsrgits/DBIx-Class.git dbic
cd dbic
git branch --track people/caelum/db2_limit_dialect
origin/people/caelum/db2_limit_dialect
git checkout people/caelum/db2_limit_dialect
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;28&nbsp;19:51:28&nbsp;2011</span>
    <span class="description">carlosyr [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #66430] DB2_400_SQL error Fetch First in LimitDialects.pm</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 28 Mar 2011 19:20:59 -0430</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Carlos Ramírez &lt;carlosyr [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 22/03/11 06:35, Rafael Kitover via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=66430">https://rt.cpan.org/Ticket/Display.html?id=66430</a></span>&gt;
&gt;
&gt; Hi Carlos,
&gt;
&gt; any chance you could arrange an SSH tunnel to a test DB on your AS/400
&gt; DB2 instance for us?
&gt;    
</div>Hi Rafael, Sorry for the too late answer.

I really appreciate your help, but I can&#39;t do that  for security 
reasons. My network environment it&#39;s quite complicated. my network 
administrator says no. But I can run all test that you need.

Carlos
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;01&nbsp;10:07:38&nbsp;2011</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">We merged the improvements into mainline. Marking the bug as patched for
the time being, but please do test when you have a chance.

<span class="clickylink"><a target="new" rel="nofollow" href="http://git.shadowcat.co.uk/gitweb/gitweb.cgi?p=dbsrgits/DBIx-Class.git;a=commit;h=96eacdb705e37cca2a5a420ec92e353d0d8823b9">http://git.shadowcat.co.uk/gitweb/gitweb.cgi?p=dbsrgits/DBIx-Class.git;a=commit;h=96eacdb705e37cca2a5a420ec92e353d0d8823b9</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;01&nbsp;10:07:39&nbsp;2011</span>
    <span class="description">ribasushi [...] leporine.io -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;01&nbsp;15:03:07&nbsp;2011</span>
    <span class="description">carlosyr [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #66430] DB2_400_SQL error Fetch First in LimitDialects.pm</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 1 Apr 2011 14:32:59 -0430</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Carlos Ramírez &lt;carlosyr [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">2011/3/28 Rafael Kitover via RT &lt;bug-DBIx-Class@rt.cpan.org&gt;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=66430">https://rt.cpan.org/Ticket/Display.html?id=66430</a></span> &gt;
&gt;
&gt; Please try my branch with FetchFirst fixes and other refactorings:
&gt;
&gt; git clone git://git.shadowcat.co.uk/dbsrgits/DBIx-Class.git dbic
&gt; cd dbic
&gt; git branch --track people/caelum/db2_limit_dialect
&gt; origin/people/caelum/db2_limit_dialect
&gt; git checkout people/caelum/db2_limit_dialect
&gt;
</div>
Hi Rafael/Peter, sorry for the late answer, I have been very busy in
recent days. All test ran successfull. This was against System V5R3

This was the procedure:

git clone git://git.shadowcat.co.uk/dbsrgits/DBIx-Class.git dbic
cd dbic
git branch --track people/caelum/db2_limit_dialect
git branch --track  origin/people/caelum/db2_limit_dialect
git checkout people/caelum/db2_limit_dialect

export DBICTEST_DB2_400_&#40;DSN|_USER|_PASS&#41;=right_value_for_every_one
prove t/746db2_400.t


I&#39;m not familiar with using git. It&#39;s the procedure OK?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;01&nbsp;15:03:08&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;patched&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;02&nbsp;05:59:54&nbsp;2011</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Apr 01 15:03:07 2011, carlosyr@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 2011/3/28 Rafael Kitover via RT &lt;bug-DBIx-Class@rt.cpan.org&gt;:
<div class="message-stanza open">&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=66430">https://rt.cpan.org/Ticket/Display.html?id=66430</a></span> &gt;
&gt; &gt;
&gt; &gt; Please try my branch with FetchFirst fixes and other refactorings:
&gt; &gt;
&gt; &gt; git clone git://git.shadowcat.co.uk/dbsrgits/DBIx-Class.git dbic
&gt; &gt; cd dbic
&gt; &gt; git branch --track people/caelum/db2_limit_dialect
&gt; &gt; origin/people/caelum/db2_limit_dialect
&gt; &gt; git checkout people/caelum/db2_limit_dialect
&gt; &gt;
</div>&gt; 
&gt; Hi Rafael/Peter, sorry for the late answer, I have been very busy in
&gt; recent days. All test ran successfull. This was against System V5R3
&gt; 
&gt; This was the procedure:
&gt; 
&gt; git clone git://git.shadowcat.co.uk/dbsrgits/DBIx-Class.git dbic
&gt; cd dbic
&gt; git branch --track people/caelum/db2_limit_dialect
&gt; git branch --track  origin/people/caelum/db2_limit_dialect
&gt; git checkout people/caelum/db2_limit_dialect
&gt; 
&gt; export DBICTEST_DB2_400_&#40;DSN|_USER|_PASS&#41;=right_value_for_every_one
&gt; prove t/746db2_400.t
&gt; 
&gt; 
&gt; I&#39;m not familiar with using git. It&#39;s the procedure OK?
</div>
You did the checkout correctly. However you ran prove incorrectly -
prove &lt;test&gt; simply runs the test against you system-installed lib. What
you want instead is prove -l &lt;test&gt;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;02&nbsp;06:00:12&nbsp;2011</span>
    <span class="description">ribasushi [...] leporine.io -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;03&nbsp;07:04:52&nbsp;2011</span>
    <span class="description">carlosyr [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #66430] DB2_400_SQL error Fetch First in LimitDialects.pm</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 3 Apr 2011 06:34:39 -0430</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Carlos Ramírez &lt;carlosyr [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; You did the checkout correctly. However you ran prove incorrectly -
&gt; prove &lt;test&gt; simply runs the test against you system-installed lib. What
&gt; you want instead is prove -l &lt;test&gt;
&gt;
&gt;
&gt;
&gt;
</div>
Thanks Peter,

I run again with prove -l and fails:

t/746db2_400.t .. DBIx::Class::ResultSet::create&#40;&#41;: DBI Exception:
DBD::ODBC::db prepare_cached failed: [unixODBC][IBM][Controlador ODBC
de iSeries Access][DB2 UDB]SQL5016 - Texto de mensaje de error no
disponible. El mensaje no se puede traducir satisfactoriamente.
&#40;SQL-HY000&#41; [for Statement &#34;SELECT IDENTITY_VAL_LOCAL&#40;&#41; FROM
sysibm.sysdummy1&#34;] at t/746db2_400.t line 38
# Looks like your test exited with 11 before it could output anything.
t/746db2_400.t .. Dubious, test returned 11 &#40;wstat 2816, 0xb00&#41;
Failed 6/6 subtests

Test Summary Report
-------------------
t/746db2_400.t &#40;Wstat: 2816 Tests: 0 Failed: 0&#41;
  Non-zero exit status: 11
  Parse errors: Bad plan.  You planned 6 tests but ran 0.
Files=1, Tests=0,  2 wallclock secs &#40; 0.03 usr  0.02 sys +  0.49 cusr
0.06 csys =  0.60 CPU&#41;
Result: FAIL

Spanish  Text: Text Message not available. Can&#39;t Translate the message.

Carlos
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;03&nbsp;07:04:53&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;patched&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;04&nbsp;03:10:50&nbsp;2011</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #66430] DB2_400_SQL error Fetch First in LimitDialects.pm</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 04 Apr 2011 09:10:30 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Peter Rabbitson &lt;ribasushi [...] cpan.org&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Carlos Ramírez via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: DBIx-Class
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=66430">https://rt.cpan.org/Ticket/Display.html?id=66430</a></span> &gt;
&gt; 
<div class="message-stanza open">&gt;&gt; You did the checkout correctly. However you ran prove incorrectly -
&gt;&gt; prove &lt;test&gt; simply runs the test against you system-installed lib. What
&gt;&gt; you want instead is prove -l &lt;test&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
&gt;&gt;
</div>&gt; 
&gt; Thanks Peter,
&gt; 
&gt; I run again with prove -l and fails:
&gt; 
&gt; t/746db2_400.t .. DBIx::Class::ResultSet::create&#40;&#41;: DBI Exception:
&gt; DBD::ODBC::db prepare_cached failed: [unixODBC][IBM][Controlador ODBC
&gt; de iSeries Access][DB2 UDB]SQL5016 - Texto de mensaje de error no
&gt; disponible. El mensaje no se puede traducir satisfactoriamente.
&gt; &#40;SQL-HY000&#41; [for Statement &#34;SELECT IDENTITY_VAL_LOCAL&#40;&#41; FROM
&gt; sysibm.sysdummy1&#34;] at t/746db2_400.t line 38
&gt; # Looks like your test exited with 11 before it could output anything.
&gt; t/746db2_400.t .. Dubious, test returned 11 &#40;wstat 2816, 0xb00&#41;
&gt; Failed 6/6 subtests
&gt; 
&gt; Test Summary Report
&gt; -------------------
&gt; t/746db2_400.t &#40;Wstat: 2816 Tests: 0 Failed: 0&#41;
&gt;   Non-zero exit status: 11
&gt;   Parse errors: Bad plan.  You planned 6 tests but ran 0.
&gt; Files=1, Tests=0,  2 wallclock secs &#40; 0.03 usr  0.02 sys +  0.49 cusr
&gt; 0.06 csys =  0.60 CPU&#41;
&gt; Result: FAIL
&gt; 
</div>
Ouch, exit 11 is a segfault. Something else is fishy. Which perl version
are you using?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;04&nbsp;12:29:48&nbsp;2011</span>
    <span class="description">carlosyr [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #66430] DB2_400_SQL error Fetch First in LimitDialects.pm</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 4 Apr 2011 12:29:33 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Carlos Ramírez &lt;carlosyr [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Ouch, exit 11 is a segfault. Something else is fishy. Which perl version
&gt; are you using?
&gt;
&gt;
</div>
hmmm... Perl: 5.10 on Debian squeeze.... Let me do the test on another machine.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;29&nbsp;22:17:38&nbsp;2011</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Apr 04 12:29:48 2011, carlosyr@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Ouch, exit 11 is a segfault. Something else is fishy. Which perl
</div>&gt; version
<div class="message-stanza open">&gt; &gt; are you using?
&gt; &gt;
&gt; &gt;
</div>&gt; 
&gt; hmmm... Perl: 5.10 on Debian squeeze.... Let me do the test on another
&gt; machine.
</div>
Any luck with this?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;29&nbsp;22:17:39&nbsp;2011</span>
    <span class="description">ribasushi [...] leporine.io -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;30&nbsp;09:34:37&nbsp;2011</span>
    <span class="description">carlosyr [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #66430] DB2_400_SQL error Fetch First in LimitDialects.pm</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 30 Apr 2011 09:03:42 -0430</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-DBIx-Class [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Carlos Ramírez &lt;carlosyr [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">El vie, 29-04-2011 a las 22:17 -0400, Peter Rabbitson via RT escribió:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=66430">https://rt.cpan.org/Ticket/Display.html?id=66430</a></span> &gt;
&gt; 
&gt; On Mon Apr 04 12:29:48 2011, carlosyr@gmail.com wrote:
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; Ouch, exit 11 is a segfault. Something else is fishy. Which perl
</div>&gt; &gt; version
<div class="message-stanza open">&gt; &gt; &gt; are you using?
&gt; &gt; &gt;
&gt; &gt; &gt;
</div>&gt; &gt; 
&gt; &gt; hmmm... Perl: 5.10 on Debian squeeze.... Let me do the test on another
&gt; &gt; machine.
</div>&gt; 
&gt; Any luck with this?
&gt; 
</div>Sorry Peter, I can&#39;t do the test yet.

I actually installing a virtual machine &#40;kvm&#41; for this, but for personal
reasons I can&#39;t complete yet.

Maybe this weekend I can&#39;t do the test again.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;30&nbsp;09:34:53&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;patched&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;07&nbsp;08:29:18&nbsp;2011</span>
    <span class="description">ribasushi [...] leporine.io -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Apr 30 09:34:37 2011, carlosyr@gmail.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; El vie, 29-04-2011 a las 22:17 -0400, Peter Rabbitson via RT escribió:
&gt; Sorry Peter, I can&#39;t do the test yet.
&gt; 
&gt; I actually installing a virtual machine &#40;kvm&#41; for this, but for personal
&gt; reasons I can&#39;t complete yet.
&gt; 
</div>
Sure thing. For the time being I will mark this ticket as resolved, as
the devs are pretty confident they nailed it. Feel free to re-open it if
the problem persists.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;07&nbsp;08:29:20&nbsp;2011</span>
    <span class="description">ribasushi [...] leporine.io -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sat&nbsp;May&nbsp;07&nbsp;08:34:39&nbsp;2011</span>
    <span class="description">ribasushi [...] leporine.io -  Fixed in 0.08191 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
