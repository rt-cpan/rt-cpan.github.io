<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #34474 for Text-CSV_XS: wish: integrate row-as-hashref feature from Parse::CSV</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #34474 for Text-CSV_XS: wish: integrate row-as-hashref feature from Parse::CSV</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Text-CSV_XS">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Text-CSV_XS">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Text-CSV_XS">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Text-CSV_XS">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Text-CSV_XS">Text-CSV_XS CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">34474</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Text-CSV_XS">Text-CSV_XS</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">HMBRAND [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
MARKSTOS [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-31868-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.37    </td>
  </tr>
  <tr id="CF-31869-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.42    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




getline_hr.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/443369/217460/getline_hr.patch">
Thu Apr 03 13:21:00 2008 (5.8k) by MARKSTOS [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=34474">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-440528" href="/Public/Bug/Display.html?id=34474#txn-440528">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;27&nbsp;11:05:14&nbsp;2008</span>
    <span class="description">MARKSTOS [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> wish: integrate row-as-hashref feature from Parse::CSV</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/440528/215847/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/215847">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Merijn,

Thanks for your careful maintainership of Text::CSV_XS. It is an
important, widely used module and I appreciate your help with it.

There is perhaps only one important feature I think it lacks, and it is
already mentioned on the &#34;TODO&#34; list: That&#39;s the ability to get a row
back has a hashref.

Parse::CSV has now been published and has code for this which can be
borrowed, so that something like &#34;getline_href&#34; can be added. 

Currently Parse::CSV has a couple of weaknesses which prevent it from
being useful as a wrapper:
  - It hardcoded all of the Text::CVS options to new, so new options
added  by Text::CSV_XS like blank_is_undef are not automatically supported.
  - It does not use &#34;getline&#40;&#41;&#34;, so binary mode is not supported. 

While Parse::CSV could also be patched to fix these things, it strikes
me as a better solution for Text::CSV_XS to borrow the one great feature
that it adds. 

I have some potential interest helping with this, since I have a current
desire for being able to parse CSV files with embedded newlines and get
a hashref back. 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-440574" href="/Public/Bug/Display.html?id=34474#txn-440574">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;27&nbsp;12:24:24&nbsp;2008</span>
    <span class="description">HMBRAND [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/440574/215882/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/215882">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 475b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I first thought that that could be done rather simple in-line, but it 
was rather easy to implement. Would you be happy with this:

 use Text::CSV_XS;

 my $csv = Text::CSV_XS-&gt;new &#40;&#41;;
 $csv-&gt;set_keys &#40;qw&#40; code name price description &#41;&#41;;
 while &#40;my $hr = $csv-&gt;getline_hr &#40;*IO&#41;&#41; {
     print &#34;The price of a $hr-&gt;{name} is $hr-&gt;{price} \x{20ac}\n&#34;;
     }

or, if the first line has the field names

 $csv-&gt;set_keys &#40;@{$csv-&gt;getline &#40;*IO&#41;}&#41;;

give or take a few error checks
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-440575" href="/Public/Bug/Display.html?id=34474#txn-440575">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;27&nbsp;12:24:26&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Give even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-440577" href="/Public/Bug/Display.html?id=34474#txn-440577">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;27&nbsp;12:24:27&nbsp;2008</span>
    <span class="description">HMBRAND [...] cpan.org -  Given to HMBRAND</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-440598" href="/Public/Bug/Display.html?id=34474#txn-440598">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;27&nbsp;12:57:44&nbsp;2008</span>
    <span class="description">mark [...] summersault.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #34474] wish: integrate row-as-hashref feature from Parse::CSV</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 27 Mar 2008 13:01:52 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Text-CSV_XS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Stosberg &lt;mark [...] summersault.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/440598/215896/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/215896">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">HMBRAND via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"> &gt;
&gt; I first thought that that could be done rather simple in-line, but it 
&gt; was rather easy to implement. Would you be happy with this:
&gt; 
&gt;  use Text::CSV_XS;
&gt; 
&gt;  my $csv = Text::CSV_XS-&gt;new &#40;&#41;;
&gt;  $csv-&gt;set_keys &#40;qw&#40; code name price description &#41;&#41;;
&gt;  while &#40;my $hr = $csv-&gt;getline_hr &#40;*IO&#41;&#41; {
&gt;      print &#34;The price of a $hr-&gt;{name} is $hr-&gt;{price} \x{20ac}\n&#34;;
&gt;      }
&gt; 
&gt; or, if the first line has the field names
&gt; 
&gt;  $csv-&gt;set_keys &#40;@{$csv-&gt;getline &#40;*IO&#41;}&#41;;
&gt; 
&gt; give or take a few error checks
</div>
Thanks for the fast response!

What you suggest would be sufficient, but I would suggest the follow 
syntax improvements. I prefer the Parse::CSV options for declaring what 
the fields name are:

...-&gt;new&#40;
   fields =&gt; \@fields
&#41;;

or:

...-&gt;new&#40;
   fields =&gt; &#39;auto&#39;,
&#41;;

I also have one more suggestion, which is unrelated: It would be nice if 
   functions were tagged with &#34;=head2&#34; or &#34;=head3&#34; in the POD. This 
would make the docs easier to browse on search.cpan.org and perhaps 
through other tools.

     Mark


-- 
  . . . . . . . . . . . . . . . . . . . . . . . . . . .
    Mark Stosberg            Principal Developer
    mark@summersault.com     Summersault, LLC
    765-939-9301 ext 202     database driven websites
  . . . . . <span class="clickylink"><a target="new" rel="nofollow" href="http://www.summersault.com/">http://www.summersault.com/</a></span> . . . . . . . .
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-440628" href="/Public/Bug/Display.html?id=34474#txn-440628">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;27&nbsp;13:31:48&nbsp;2008</span>
    <span class="description">HMBRAND [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/440628/215913/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/215913">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 753b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I understand your wish, but I will not honour that. I&#39;ll explain

1. &#39;fields&#39; as an attribute would be confusing, as it would be 
completely unrelated to the existing fields &#40;&#41; method.
2. passing field names to the constructor will be the odd-one-out
When you read CSV files where the first line defines the column names, 
it has to use $csv to read the names, which makes this a chicken-and-
egg problem.
3. &#39;auto&#39; is not an option, as Text::CSV_XS does not have a memory 
about previous lines, unless you want the first call to getline_hr &#40;&#41; 
return the column names *AND* put them in the header if that is still 
undefined. Too many open questions IMHO.

I renamed set_keys &#40;&#41; to hr_keys &#40;&#41;, so I can also query them.

I&#39;ll look at the pod stuff too.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-440670" href="/Public/Bug/Display.html?id=34474#txn-440670">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;27&nbsp;15:55:05&nbsp;2008</span>
    <span class="description">mark [...] summersault.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #34474] wish: integrate row-as-hashref feature from Parse::CSV</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 27 Mar 2008 15:59:01 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Text-CSV_XS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Stosberg &lt;mark [...] summersault.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/440670/215935/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/215935">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">HMBRAND via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; I understand your wish, but I will not honour that. I&#39;ll explain
&gt; 
&gt; 1. &#39;fields&#39; as an attribute would be confusing, as it would be 
&gt; completely unrelated to the existing fields &#40;&#41; method.
&gt; 2. passing field names to the constructor will be the odd-one-out
&gt; When you read CSV files where the first line defines the column names, 
&gt; it has to use $csv to read the names, which makes this a chicken-and-
&gt; egg problem.
&gt; 3. &#39;auto&#39; is not an option, as Text::CSV_XS does not have a memory 
&gt; about previous lines, unless you want the first call to getline_hr &#40;&#41; 
&gt; return the column names *AND* put them in the header if that is still 
&gt; undefined. Too many open questions IMHO.
</div>
Merijn, your line of thinking sounds very reasonable. Thanks for 
considering this.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I renamed set_keys &#40;&#41; to hr_keys &#40;&#41;, so I can also query them.
</div>
Querying them will perhaps be useful, but I think the &#34;hr_keys&#34; name 
could be improved. I suggest &#34;column_names&#34;. I wouldn&#39;t immediately 
think that &#34;hr&#34; meant &#34;hashref&#34;. Just as I wrote that I realize that 
perhaps it means &#34;header row&#34;!

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ll look at the pod stuff too.
</div>
Thank you!

    Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-443369" href="/Public/Bug/Display.html?id=34474#txn-443369">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;03&nbsp;13:20:59&nbsp;2008</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> PATCH: getline_hr&#40;&#41; and column_names&#40;&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> MARKSTOS [...] cpan.org</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/443369/217457/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/217457">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Merijn,

I needed this functionality and went ahead and wrote my own patch for
it, although I later found your GIT respository, where you had also
written some patch for this.  &#40;
<span class="clickylink"><a target="new" rel="nofollow" href="http://repo.or.cz/w/Text-CSV_XS.git?a=shortlog">http://repo.or.cz/w/Text-CSV_XS.git?a=shortlog</a></span> &#41;

I&#39;ve compared our work, and would like to point out some features of mine: 

- It uses &#34;column_names&#34;, which I think is a clearer name.

- It allows the names to be set from an array or an arrayref. The array
would be clearer if setting the names by hand, an the arrayref is is
nice because it is what getlines&#40;&#41; returns.

- I include error checking for a number of cases including:
   - invalid input to column_names&#40;&#41;
   - calling getlines_hr&#40;&#41; before column_names&#40;&#41;
   - mismatching the number of colum names and values

My patch also includes tests and documentation updates. The one thing in
your patch I was curious about was the stub mention in one of the XS
files. My implementation doesn&#39;t use such a stub, although it appears to
function fine with one. 

Since there are a lot of Text::CSV_XS users, I may get some feedback
from some others on the alternatives. 

   Mark
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/443369/217460/getline_hr.patch">Download getline_hr.patch</a><br />
<span class="downloadcontenttype">text/x-diff 5.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -rN -u old-Text-CSV_XS-0.37/ChangeLog new-Text-CSV_XS-0.37/ChangeLog
--- old-Text-CSV_XS-0.37/ChangeLog	2008-04-03 13:13:30.000000000 -0400
+++ new-Text-CSV_XS-0.37/ChangeLog	2008-04-03 13:13:30.000000000 -0400
@@ -1,3 +1,7 @@
+
+	* Added getline_hr&#40;&#41; and column_names&#40;&#41; to support returning
+	  rows as hashrefs &#40;Mark Stosberg, H.Merijn Brand&#41; 
+
 2008-03-11  0.37 - H.Merijn Brand   &lt;h.m.brand@xs4all.nl&gt;
 
 	* Copied GIT repo to public mirror
diff -rN -u old-Text-CSV_XS-0.37/CSV_XS.pm new-Text-CSV_XS-0.37/CSV_XS.pm
--- old-Text-CSV_XS-0.37/CSV_XS.pm	2008-04-03 13:13:30.000000000 -0400
+++ new-Text-CSV_XS-0.37/CSV_XS.pm	2008-04-03 13:13:30.000000000 -0400
@@ -380,6 +380,62 @@
     $self-&gt;{_STATUS};
     } # parse
 
+sub column_names {
+    my $self = shift;
+    my &#40;$first,@rest&#41; = @_;
+    my @cols;
+    # First use? Initialize.
+    $self-&gt;{_COLUMN_NAMES} ||= [];
+
+    # Error checking and unpacking @_
+    if &#40;ref $first eq &#39;ARRAY&#39;&#41; {
+        if &#40;scalar @rest&#41; {
+            die &#34;column_names&#40;&#41; expects only one arg when given an arrayref&#34;
+        }
+        else {
+            $self-&gt;{_COLUMN_NAMES} = $first;
+        }
+    }
+    elsif &#40;ref $first&#41; {  
+        die &#34;column_names&#40;&#41; was passed a reference which was not of type ARRAY&#34;;
+    }
+    # Array of column names expected
+    elsif &#40;&#40;defined $first&#41; or &#40;scalar @rest&#41;&#41;  {
+        @cols = &#40;$first,@rest&#41;;
+        $self-&gt;{_COLUMN_NAMES} = \@cols;
+    }
+    else {
+        # No input processing!
+    }
+
+    return @{ $self-&gt;{_COLUMN_NAMES} }; 
+}
+
+sub getline_hr {
+    my $self = shift;
+    my $io = shift;
+
+    unless &#40;defined $self-&gt;{_COLUMN_NAMES}&#41; {
+        die &#34;You must call column_names before calling getline_hr&#34;;
+    }
+
+    my $vals = $self-&gt;getline&#40;$io&#41;;
+    my @keys = $self-&gt;column_names;
+
+    my $n_vals = scalar @$vals;
+    my $n_keys = scalar @keys;
+    unless &#40;$n_keys == $n_vals&#41; {  
+        die &#34;Number of column_names &#40;$n_keys&#41; doesn&#39;t match the number of entries in this row &#40;$n_vals&#41;&#34;
+    }
+
+    my %row;
+    @row{@keys} = @$vals;
+    return \%row ;
+}
+
+
+
+
 bootstrap Text::CSV_XS $VERSION;
 
 sub types
@@ -431,6 +487,10 @@
  $colref = $csv-&gt;getline &#40;$io&#41;;        # Read a line from file $io,
                                        # parse it and return an array
                                        # ref of fields
+
+ $csv-&gt;column_names&#40;&#39;Name&#39;,&#39;Address&#39;&#41;  # Set array of column names 
+ $href = $csv-&gt;getline_hr&#40;$io&#41;         # Return line as hashref
+
  $eof = $csv-&gt;eof &#40;&#41;;                  # Indicate if last parse or
                                        # getline &#40;&#41; hit End Of File
 
@@ -862,6 +922,29 @@
 The I&lt;$csv-E&lt;gt&gt;string &#40;&#41;&gt;, I&lt;$csv-E&lt;gt&gt;fields &#40;&#41;&gt; and I&lt;$csv-E&lt;gt&gt;status &#40;&#41;&gt;
 methods are meaningless, again.
 
+=item getline_hr
+
+=item column_names
+
+ $csv-&gt;column_names&#40;&#39;Name&#39;,&#39;Address&#39;&#41;;
+ # Or, with an arrayref
+ $csv-&gt;column_names&#40;[&#39;Name&#39;,&#39;Address&#39;]&#41;;
+
+ # Now, later you can do:
+ my $href = $csv-&gt;getline_hr&#40;$io&#41;;
+
+The C&lt;getline_hr&gt; and C&lt;column_names&gt; methods work together to allow you to
+have rows returned as hashrefs. You must call C&lt;column_names&gt; first to declare
+your column names. 
+
+  # Set the column names from a row in the CSV file
+  $csv-&gt;column_names&#40; $csv-&gt;getline&#40;$io&#41; &#41;;
+
+Then you can call C&lt;getline_hr&#40;&#41;&gt; as you would C&lt;getline&#40;&#41;&gt;, and a hashref of
+the row will be returned:
+
+ my $href = $csv-&gt;getline_hr&#40;$io&#41;;
+
 =item eof
 
  $eof = $csv-&gt;eof &#40;&#41;;
diff -rN -u old-Text-CSV_XS-0.37/MANIFEST new-Text-CSV_XS-0.37/MANIFEST
--- old-Text-CSV_XS-0.37/MANIFEST	2008-04-03 13:13:30.000000000 -0400
+++ new-Text-CSV_XS-0.37/MANIFEST	2008-04-03 13:13:30.000000000 -0400
@@ -24,6 +24,7 @@
 t/70_rt.t		Tests based on RT reports
 t/80_diag.t		Error diagnostics
 t/util.pl		Extra test utilities
+t/getline_hr.t  Test column_names&#40;&#41; and getline_hr&#40;&#41;
 examples/csv2xls	Script to onvert CSV files to M$Excel
 examples/speed.pl	Small benchmark script
 META.yml                                 Module meta-data &#40;added by MakeMaker&#41;
diff -rN -u old-Text-CSV_XS-0.37/t/getline_hr.t new-Text-CSV_XS-0.37/t/getline_hr.t
--- old-Text-CSV_XS-0.37/t/getline_hr.t	1969-12-31 19:00:00.000000000 -0500
+++ new-Text-CSV_XS-0.37/t/getline_hr.t	2008-04-03 13:13:30.000000000 -0400
@@ -0,0 +1,77 @@
+#!/usr/bin/perl
+
+use strict;
+$^W = 1;
+
+
+use Config;
+use Test::More;
+
+BEGIN {
+    if &#40;exists  $Config{useperlio} &#38;&#38;
+	    defined $Config{useperlio} &#38;&#38;
+	    $Config{useperlio} eq &#34;define&#34;&#41; {
+    	plan tests =&gt; 7 ;
+	}
+    else {
+    	plan skip_all =&gt; &#34;No perlIO available&#34;;
+	}
+}
+
+BEGIN {
+    require_ok &#34;Text::CSV_XS&#34;;
+    plan skip_all =&gt; &#34;Cannot load Text::CSV_XS&#34; if $@;
+}
+
+# Setup
+ my $io; # filehandle
+ my $io_str; # storage
+ my $csv = Text::CSV_XS-&gt;new;
+ # Store a row in the $io handle, which uses $io_str for storage. 
+ open  $io, &#34;+&gt;&#34;, \$io_str or die &#34;_test.csv: $!&#34;;
+ $csv-&gt;print &#40;$io, [&#39;av&#39;,&#39;bv&#39;]&#41;;
+ # reset file handle to beginning. 
+ seek&#40;$io,0,0&#41;;
+
+{
+    my $test = &#34;calling getline_hr before column_names dies with hint you&#39;ve done something wrong&#34;;
+    eval { my $hr = $csv-&gt;getline_hr&#40;$io&#41;; };
+    like&#40;$@,qr/column_names/, $test&#41;;
+}
+
+
+{
+    my $test = &#39;reality check column_names&#39;;
+    $csv-&gt;column_names&#40;&#39;c&#39;,&#39;d&#39;&#41;;
+    my @cols = $csv-&gt;column_names;
+    is_deeply&#40;[&#39;c&#39;,&#39;d&#39;],\@cols,$test&#41;;
+}
+
+{
+    my $test = &#39;column_names&#40;&#41; called a second time with arrayref should work, and clobber current values&#39;;
+    $csv-&gt;column_names&#40;[&#39;a&#39;,&#39;b&#39;]&#41;;
+    my @cols = $csv-&gt;column_names;
+    is_deeply&#40;[&#39;a&#39;,&#39;b&#39;],\@cols,$test&#41;;
+}
+
+{ 
+    my $hr = $csv-&gt;getline_hr&#40;$io&#41;;
+    is&#40;$hr-&gt;{a},&#39;av&#39;, &#34;getline_hr test for first key&#34;&#41;;
+    is&#40;$hr-&gt;{b},&#39;bv&#39;, &#34;getline_hr test for last key&#34;&#41;;
+}
+
+{
+    my $test = &#34;mismatched number of column names and values returns an error&#34;;
+     # reset file handle to beginning. 
+     seek&#40;$io,0,0&#41;;
+    $csv-&gt;column_names&#40;&#39;a&#39;&#41;;
+    eval { my $hr = $csv-&gt;getline_hr&#40;$io&#41;; };
+    like&#40;$@, qr/doesn&#39;t match/, $test&#41;;
+
+}
+
+
+
+
+
+

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-443419" href="/Public/Bug/Display.html?id=34474#txn-443419">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;03&nbsp;15:26:49&nbsp;2008</span>
    <span class="description">MARKSTOS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> row-as-hashref feedback from peers</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/443419/217489/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/217489">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 160b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I posted a request for other feedback here, and Aristotle has already
replied with some helpful feedback:

<span class="clickylink"><a target="new" rel="nofollow" href="http://use.perl.org/~markjugg/journal/36046">http://use.perl.org/~markjugg/journal/36046</a></span>

    Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-443462" href="/Public/Bug/Display.html?id=34474#txn-443462">#</a>      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;03&nbsp;17:35:49&nbsp;2008</span>
    <span class="description">h.m.brand [...] xs4all.nl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #34474] PATCH: getline_hr&#40;&#41; and column_names&#40;&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 3 Apr 2008 23:35:05 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Text-CSV_XS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;H.Merijn Brand&#34; &lt;h.m.brand [...] xs4all.nl&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/443462/217513/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/217513">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, 03 Apr 2008 13:21:02 -0400, &#34;MARKSTOS via RT&#34;
&lt;bug-Text-CSV_XS@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt;        Queue: Text-CSV_XS
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=34474">http://rt.cpan.org/Ticket/Display.html?id=34474</a></span> &gt;
&gt; 
&gt; Merijn,
</div>
Looks promising. I&#39;m  now in Norway, I&#39;ll dig deeper when I&#39;m back.
Thanks for the work!

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I needed this functionality and went ahead and wrote my own patch for
&gt; it, although I later found your GIT respository, where you had also
&gt; written some patch for this.  &#40;
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://repo.or.cz/w/Text-CSV_XS.git?a=shortlog">http://repo.or.cz/w/Text-CSV_XS.git?a=shortlog</a></span> &#41;
&gt; 
&gt; I&#39;ve compared our work, and would like to point out some features of mine: 
&gt; 
&gt; - It uses &#34;column_names&#34;, which I think is a clearer name.
&gt; 
&gt; - It allows the names to be set from an array or an arrayref. The array
&gt; would be clearer if setting the names by hand, an the arrayref is is
&gt; nice because it is what getlines&#40;&#41; returns.
</div>
Good. I&#39;ll include that

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; - I include error checking for a number of cases including:
&gt;    - invalid input to column_names&#40;&#41;
&gt;    - calling getlines_hr&#40;&#41; before column_names&#40;&#41;
&gt;    - mismatching the number of colum names and values
</div>
Very good :&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; My patch also includes tests and documentation updates.
</div>
Very very good! :&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The one thing in your patch I was curious about was the stub mention
&gt; in one of the XS files. My implementation doesn&#39;t use such a stub,
&gt; although it appears to function fine with one. 
</div>
Can you expand on that? I have only one xs file.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Since there are a lot of Text::CSV_XS users, I may get some feedback
&gt; from some others on the alternatives. 
</div>
Yes, which is why I didn&#39;t release it yet.

-- 
H.Merijn Brand         Amsterdam Perl Mongers &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://amsterdam.pm.org/&#41;">http://amsterdam.pm.org/&#41;</a></span>
using &#38; porting perl 5.6.2, 5.8.x, 5.10.x  on HP-UX 10.20, 11.00, 11.11,
&#38; 11.23, SuSE 10.1 &#38; 10.2, AIX 5.2, and Cygwin.       <span class="clickylink"><a target="new" rel="nofollow" href="http://qa.perl.org">http://qa.perl.org</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="http://mirrors.develooper.com/hpux/">http://mirrors.develooper.com/hpux/</a></span>            <span class="clickylink"><a target="new" rel="nofollow" href="http://www.test-smoke.org">http://www.test-smoke.org</a></span>
                        <span class="clickylink"><a target="new" rel="nofollow" href="http://www.goldmark.org/jeff/stupid-disclaimers/">http://www.goldmark.org/jeff/stupid-disclaimers/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-443678" href="/Public/Bug/Display.html?id=34474#txn-443678">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;04&nbsp;05:21:45&nbsp;2008</span>
    <span class="description">h.m.brand [...] xs4all.nl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #34474] PATCH: getline_hr&#40;&#41; and column_names&#40;&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 4 Apr 2008 11:20:52 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Text-CSV_XS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;H.Merijn Brand&#34; &lt;h.m.brand [...] xs4all.nl&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/443678/217600/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/217600">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, 03 Apr 2008 13:21:02 -0400, &#34;MARKSTOS via RT&#34;
&lt;bug-Text-CSV_XS@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt;        Queue: Text-CSV_XS
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=34474">http://rt.cpan.org/Ticket/Display.html?id=34474</a></span> &gt;
&gt; 
&gt; Merijn,
&gt; 
&gt; I needed this functionality and went ahead and wrote my own patch for
&gt; it, although I later found your GIT respository, where you had also
&gt; written some patch for this.  &#40;
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://repo.or.cz/w/Text-CSV_XS.git?a=shortlog">http://repo.or.cz/w/Text-CSV_XS.git?a=shortlog</a></span> &#41;
</div>
Can you check that one again, and see it it meets your needs?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;ve compared our work, and would like to point out some features of mine: 
&gt; 
&gt; - It uses &#34;column_names&#34;, which I think is a clearer name.
</div>
I read the use.perl discussion. I concede. Done.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; - It allows the names to be set from an array or an arrayref. The array
&gt;   would be clearer if setting the names by hand, an the arrayref is is
&gt;   nice because it is what getlines &#40;&#41; returns.
</div>
Good point. Done.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; - I include error checking for a number of cases including:
</div>
I was still in a design phase. Error checking was &#40;and always is&#41;
planned to be extended.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;    - invalid input to column_names &#40;&#41;
</div>
Yes.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;    - calling getlines_hr &#40;&#41; before column_names &#40;&#41;
</div>
Yes.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;    - mismatching the number of colum names and values
</div>
No. I really don&#39;t care. If a line half-way the CSV file has less &#40;or
more&#41; fields than the header line, it is perfectly sane CSV. Probably
not what was intended, but certainly not illegal.

The way I assign to the hash makes the missing fields undef.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; My patch also includes tests and documentation updates. The one thing in
</div>
I&#39;d like all test files to start with a number, so they are called in a
somewhat logical order.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; your patch I was curious about was the stub mention in one of the XS
</div>
What do you mean?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; files. My implementation doesn&#39;t use such a stub, although it appears to
&gt; function fine with one. 
&gt; 
&gt; Since there are a lot of Text::CSV_XS users, I may get some feedback
&gt; from some others on the alternatives. 
</div>
I value feedback a lot, and as you can see in the Changelog, RT, and on
PerlMonks, I also act upon the feedback.

-- 
H.Merijn Brand         Amsterdam Perl Mongers &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://amsterdam.pm.org/&#41;">http://amsterdam.pm.org/&#41;</a></span>
using &#38; porting perl 5.6.2, 5.8.x, 5.10.x  on HP-UX 10.20, 11.00, 11.11,
&#38; 11.23, SuSE 10.1 &#38; 10.2, AIX 5.2, and Cygwin.       <span class="clickylink"><a target="new" rel="nofollow" href="http://qa.perl.org">http://qa.perl.org</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="http://mirrors.develooper.com/hpux/">http://mirrors.develooper.com/hpux/</a></span>            <span class="clickylink"><a target="new" rel="nofollow" href="http://www.test-smoke.org">http://www.test-smoke.org</a></span>
                        <span class="clickylink"><a target="new" rel="nofollow" href="http://www.goldmark.org/jeff/stupid-disclaimers/">http://www.goldmark.org/jeff/stupid-disclaimers/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-443723" href="/Public/Bug/Display.html?id=34474#txn-443723">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;04&nbsp;10:35:08&nbsp;2008</span>
    <span class="description">mark [...] summersault.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #34474] PATCH: getline_hr&#40;&#41; and column_names&#40;&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 04 Apr 2008 10:34:39 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Text-CSV_XS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Stosberg &lt;mark [...] summersault.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/443723/217624/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/217624">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Can you check that one again, and see it it meets your needs?
</div>
I&#39;ve looked through it some more. It looks good!

Some minor refinements:

- A typo: proagated

- Instead of:
   &#34;getline_hr &#40;&#41; called without column_names&#34;
   I suggest
   &#34;getline_hr &#40;&#41; called before column_names&#34;

The former makes it seem like &#34;column_names&#34; might be an attribute which 
needs to be passed to getline_hr&#40;&#41;. I think the latter makes it clearer 
that it is the ordering that matters.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; your patch I was curious about was the stub mention in one of the XS
</div>&gt; 
&gt; What do you mean?
</div>
I was mistaken. I must have seen this:

+    _hr_keys           =&gt; undef,

But that is nothing unusual. It it just a more formal declaration of an 
internal attribute than I used.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I value feedback a lot, and as you can see in the Changelog, RT, and on
&gt; PerlMonks, I also act upon the feedback.
</div>
I think you have been a great maintainer, Merijn! I appreciate your work.

A final suggestion: I suggest bumping the version to be at least .4 or 
.5 for the final text release, as I think hashref support will be 
considered a major feature for a number of people. Frankly, I find the 
module so solid, it could easily be considered at least &#34;1.0&#34; quality.

    Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-444076" href="/Public/Bug/Display.html?id=34474#txn-444076">#</a>      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;05&nbsp;04:53:32&nbsp;2008</span>
    <span class="description">h.m.brand [...] xs4all.nl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #34474] PATCH: getline_hr&#40;&#41; and column_names&#40;&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 5 Apr 2008 10:53:09 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Text-CSV_XS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;H.Merijn Brand&#34; &lt;h.m.brand [...] xs4all.nl&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/444076/217794/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/217794">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri, 04 Apr 2008 10:35:12 -0400, &#34;mark@summersault.com via RT&#34;
&lt;bug-Text-CSV_XS@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt;        Queue: Text-CSV_XS
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=34474">http://rt.cpan.org/Ticket/Display.html?id=34474</a></span> &gt;
&gt; 
&gt; 
<div class="message-stanza open">&gt; &gt; Can you check that one again, and see it it meets your needs?
</div>&gt; 
&gt; I&#39;ve looked through it some more. It looks good!
&gt; 
&gt; Some minor refinements:
&gt; 
&gt; - A typo: proagated
</div>
Fixed

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; - Instead of:
&gt;    &#34;getline_hr &#40;&#41; called without column_names&#34;
&gt;    I suggest
&gt;    &#34;getline_hr &#40;&#41; called before column_names&#34;
</div>
Done

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The former makes it seem like &#34;column_names&#34; might be an attribute which 
&gt; needs to be passed to getline_hr&#40;&#41;. I think the latter makes it clearer 
&gt; that it is the ordering that matters.
&gt; 
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt; your patch I was curious about was the stub mention in one of the XS
</div>&gt; &gt; 
&gt; &gt; What do you mean?
</div>&gt; 
&gt; I was mistaken. I must have seen this:
&gt; 
&gt; +    _hr_keys           =&gt; undef,
</div>
That was what _COLUMN_NAMES is now. What&#39;s in a name.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; But that is nothing unusual. It it just a more formal declaration of an 
&gt; internal attribute than I used.
&gt; 
<div class="message-stanza open">&gt; &gt; I value feedback a lot, and as you can see in the Changelog, RT, and on
&gt; &gt; PerlMonks, I also act upon the feedback.
</div>&gt; 
&gt; I think you have been a great maintainer, Merijn! I appreciate your work.
&gt; 
&gt; A final suggestion: I suggest bumping the version to be at least .4 or 
&gt; .5 for the final text release, as I think hashref support will be 
&gt; considered a major feature for a number of people. Frankly, I find the 
&gt; module so solid, it could easily be considered at least &#34;1.0&#34; quality.
</div>
I was thinking about 1.00 when I implemented the bind_columns &#40;&#41; thing.
That should warrant a big release.

Another thing I now need is a XS binding to make to fit non-XS errors,
like the two new croak&#39;s into the error_diag system

-- 
H.Merijn Brand         Amsterdam Perl Mongers &#40;<span class="clickylink"><a target="new" rel="nofollow" href="http://amsterdam.pm.org/&#41;">http://amsterdam.pm.org/&#41;</a></span>
using &#38; porting perl 5.6.2, 5.8.x, 5.10.x  on HP-UX 10.20, 11.00, 11.11,
&#38; 11.23, SuSE 10.1 &#38; 10.2, AIX 5.2, and Cygwin.       <span class="clickylink"><a target="new" rel="nofollow" href="http://qa.perl.org">http://qa.perl.org</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="http://mirrors.develooper.com/hpux/">http://mirrors.develooper.com/hpux/</a></span>            <span class="clickylink"><a target="new" rel="nofollow" href="http://www.test-smoke.org">http://www.test-smoke.org</a></span>
                        <span class="clickylink"><a target="new" rel="nofollow" href="http://www.goldmark.org/jeff/stupid-disclaimers/">http://www.goldmark.org/jeff/stupid-disclaimers/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-451586" href="/Public/Bug/Display.html?id=34474#txn-451586">#</a>      
    </span>
    <span class="date">Sat&nbsp;Apr&nbsp;19&nbsp;13:38:39&nbsp;2008</span>
    <span class="description">HMBRAND [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-452438" href="/Public/Bug/Display.html?id=34474#txn-452438">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;21&nbsp;18:43:48&nbsp;2008</span>
    <span class="description">HMBRAND [...] cpan.org -  Fixed in 0.42 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.758958</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
