<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #15798 for Net-DNS: Bugs in TXT handling</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #15798 for Net-DNS: Bugs in TXT handling</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-DNS/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-DNS/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-DNS/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-DNS/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-DNS">Net-DNS CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">15798</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-DNS/Active/">Net-DNS</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">OLAF [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
bugs [...] jth.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-22454-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.53    </td>
  </tr>
  <tr id="CF-22455-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




PGP.sig<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/148447/44267/PGP.sig">
Mon Nov 21 03:38:41 2005 (227b) by JEB [...] cpan.org
</a>
</font></li>


<li><font size="-2">
<a href="/Ticket/Attachment/148445/44233/PGP.sig">
Sun Nov 20 14:26:25 2005 (227b) by JEB [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;14&nbsp;17:45:50&nbsp;2005</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Bugs in TXT handling</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">1&#41; In RR.pm semicolons in the TXT data are considered as start of comment which they should not. 
... TXT &#34;abc;def&#34; 
will be truncated to 
... TXT &#34;abc
with open quotes.
Escaping \; will result in
... TXT &#34;abc\\\;def&#34; 

Could be fixed as shown provided the rdata is enclosed in &#39;&#39; or &#34;&#34; with no comments. &#40;Why be concerned with comments in the input anyway ? Strange. &#41;

        # strip out comments
        # Test for non escaped &#34;;&#34; by means of the look-behind assertion
        # &#40;the backslash is escaped&#41;
        $rrstring   =~ s/&#40;?&lt;!\\&#41;;[^&#34;&#39;]*$//g;

2&#41; Creating a TXT record by hash does not work. rdata =&gt; &#39;....&#39; does not get recognized.

- Jørgen Thomsen

Perl 5.8.7
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;15&nbsp;04:03:59&nbsp;2005</span>
    <span class="description">OLAF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">[guest - Mon Nov 14 17:45:50 2005]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 1&#41; In RR.pm semicolons in the TXT data are considered as start of
&gt;    comment which they should not.
</div>
The RR.pm takes &#34;zonefile format&#34; as input. In a zonefile a semicolon is defined as the start 
of a comment.

Net::DNS::RR-&gt;new &#40; &#34;net-dns.org.            3600 IN SOA ns1.net-dns.org. olaf.dacht.net. &#40;
                                2005092303 ; serial
                                450        ; refresh &#40;7 minutes 30 seconds&#41;
                                600        ; retry &#40;10 minutes&#41;
                                345600     ; expire &#40;4 days&#41;
                                300        ; minimum &#40;5 minutes&#41;
                                &#41;
&#34;&#41;;

is  therefore perfectly valid input. &#40;makes easy cut and paste&#41;.

Having said that the interaction in TXT RRs is somewhat troublesome.

Note that a TXT RR is made out of several character strings, that even further complicates 
matters.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; ... TXT &#34;abc;def&#34;
&gt; will be truncated to
&gt; ... TXT &#34;abc
&gt; with open quotes.
&gt; Escaping \; will result in
&gt; ... TXT &#34;abc\\\;def&#34;
&gt; 
&gt; Could be fixed as shown provided the rdata is enclosed in &#39;&#39; or &#34;&#34;
&gt;    with no comments. &#40;Why be concerned with comments in the input
&gt;    anyway ? Strange. &#41;
</div>
I think the comments are useful in general.

The trick here is to use single quotes &#40;and still escape the ;.

See e.g. t/07-misc.t:
my $TXTrr2=Net::DNS::RR-&gt;new&#40;&#39;txt2.t.net-dns.org.       60      IN
        TXT  &#34;Test1 \&#34; \; more stuff&#34;  &#34;Test2&#34;&#39;&#41;;

is&#40;&#40;$TXTrr2-&gt;char_str_list&#40;&#41;&#41;[0],&#39;Test1 &#34; ; more stuff&#39;, &#34;First arg string in TXT RR read from 
zonefileformat&#34;&#41;;
is&#40;&#40;$TXTrr2-&gt;char_str_list&#40;&#41;&#41;[1],&#39;Test2&#39;,&#34;Second Char string in TXT RR read from 
zonefileformat&#34;&#41;;

Also see ticket 8803.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 2&#41; Creating a TXT record by hash does not work. rdata =&gt; &#39;....&#39; does
&gt;    not get recognized.
</div>

There is no such attribute as rdata. If you want to fill the datastructure directly using a hash 
you probably have to use the char_str_list =&gt; [&lt;anonymous hash of character strings&gt;] 
construct.


--Olaf
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;16&nbsp;07:08:06&nbsp;2005</span>
    <span class="description">OLAF [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;16&nbsp;08:09:09&nbsp;2005</span>
    <span class="description">OLAF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve added the  chapter below to the perlpod.

I will close the ticket, feel free to reopen it if you have specific suggestions on how
to do this better.


--Olaf

=head1 Features

The RR.pm module accepts semi-colons as a start of a comment. This is
to allow the RR.pm to deal with RFC1035 specified zonefile format.

For some applications of the TXT RR the semicolon is relevant, you
will need to escape it on input.

Also note that you should specify the several character strings
seperatly. The easiest way to do so is to include the whole argument
in single quotes and the several character strings in double
quotes. Double quotes inside the character strings will need to be
escaped.

my $TXTrr=Net::DNS::RR-&gt;new&#40;&#39;txt2.t.net-dns.org.        60      IN
        TXT  &#34;Test1 \&#34; \; more stuff&#34;  &#34;Test2&#34;&#39;&#41;;

would result in 
$TXTrr-&gt;char_str_list&#40;&#41;&#41;[0] containing &#39;Test1 &#34; ; more stuff&#39;
and
$TXTrr-&gt;char_str_list&#40;&#41;&#41;[1] containing &#39;Test2&#39;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;16&nbsp;08:09:10&nbsp;2005</span>
    <span class="description">OLAF [...] cpan.org -  Status changed from &#39;new&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;19&nbsp;16:44:45&nbsp;2005</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;19&nbsp;16:44:45&nbsp;2005</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> bugs [...] jth.net</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; There is no such attribute as rdata. If you want to fill the
&gt;    datastructure directly using a hash
&gt; you probably have to use the char_str_list =&gt; [&lt;anonymous hash of
&gt;    character strings&gt;]
&gt; construct.
</div>
The &#39;rdata&#39; is mentioned all over in the code, but anyway don&#39;t you 
think it odd having &#40;quoting your documentation&#41;
       new &#40;from hash&#41;

        $rr = Net::DNS::RR-&gt;new&#40;
                name    =&gt; &#34;foo.example.com&#34;,
                ttl     =&gt; 86400,
                class   =&gt; &#34;IN&#34;,
                type    =&gt; &#34;A&#34;,
                address =&gt; &#34;10.1.2.3&#34;,
        &#41;;


but not a similar one for TXT data or resource records in general ?

- Jørgen Thomsen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;19&nbsp;17:06:50&nbsp;2005</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> bugs [...] jth.net</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">[OLAF - Tue Nov 15 04:03:59 2005]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The trick here is to use single quotes &#40;and still escape the ;.
&gt; 
&gt; See e.g. t/07-misc.t:
&gt; my $TXTrr2=Net::DNS::RR-&gt;new&#40;&#39;txt2.t.net-dns.org.     60      IN
&gt;       TXT  &#34;Test1 \&#34; \; more stuff&#34;  &#34;Test2&#34;&#39;&#41;;
&gt; 
&gt; is&#40;&#40;$TXTrr2-&gt;char_str_list&#40;&#41;&#41;[0],&#39;Test1 &#34; ; more stuff&#39;, &#34;First arg
&gt;    string in TXT RR read from
&gt; zonefileformat&#34;&#41;;
&gt; is&#40;&#40;$TXTrr2-&gt;char_str_list&#40;&#41;&#41;[1],&#39;Test2&#39;,&#34;Second Char string in TXT RR
&gt;    read from
&gt; zonefileformat&#34;&#41;;
&gt;
</div>
You didn&#39;t test this against a real running BIND server, right ?
TXT     &#34;\&#34;Test1 \&#34; \\\; more stuff\&#34; \&#34;Test2\&#34;&#34;
is not exactly what is wanted.

- Jørgen Thomsen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;19&nbsp;17:50:48&nbsp;2005</span>
    <span class="description">OLAF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
I am affraid I do not exactly understand how you tested against a bind server. I also do not 
understand what produces the output you provided with all the backslashes.

As for the new_from_hash method you want to use the char_str_list. Some example code is 
below.

In order to show that this is wire compatible with BIND I set up a perl nameserver and use dig 
to query it.

First the code:
------------------- cut ---------------------
#!/usr/local/bin/perl -Wall

use strict;
use warnings;
use Net::DNS::Nameserver;

my $nameserver=Net::DNS::Nameserver-&gt;new &#40;
    LocalAddr =&gt; &#34;127.0.0.1&#34;,
    LocalPort =&gt; 3553,
    Verbose =&gt; 1,
    ReplyHandler =&gt; \&#38;reply_handler,
    &#41;;


my   $rr = Net::DNS::RR-&gt;new&#40;
                name    =&gt; &#34;foo.example.com&#34;,
                ttl     =&gt; 86400,
                class   =&gt; &#34;IN&#34;,
                type    =&gt; &#34;TXT&#34;,
                char_str_list =&gt; [&#39;bla&#39;,&#39;;&#39;],
        &#41;;


my $rr2=Net::DNS::RR-&gt;new&#40;&#39;foo2.example.com  600 IN TXT &#34;Test1 \&#34; \; more stuff&#34;  
&#34;Test2&#34;&#39;&#41;;

$rr-&gt;print;
$rr2-&gt;print;



sub reply_handler {
    my &#40;$qname, $qclass, $qtype, $peerhost&#41; = @_;
    my &#40;$rcode, @ans, @auth, @add&#41;;

    if &#40;$qtype eq &#34;TXT&#34; &#38;&#38; $qname eq &#34;foo.example.com&#34;&#41; {
        push @ans, $rr;
    }elsif &#40;$qtype eq &#34;TXT&#34; &#38;&#38; $qname eq &#34;foo2.example.com&#34;&#41; {
        push @ans, $rr;
    } else {
        $rcode = &#34;SERFAIL&#34;;
    }
    return &#40;$rcode, \@ans, \@auth, \@add, { aa =&gt; 1 }&#41;;
}


$nameserver-&gt;main_loop;


---------------- cut ---------------------------------

And these are the queries that return exactly what I think should be returned


grover-Secret-Wg-org:~ olaf$ dig @127.0.0.1 -p 3553 foo.example.com TXT

; &lt;&lt;&gt;&gt; DiG 9.3.1 &lt;&lt;&gt;&gt; @127.0.0.1 -p 3553 foo.example.com TXT
; &#40;1 server found&#41;
;; global options:  printcmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 35736
;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0

;; QUESTION SECTION:
;foo.example.com.               IN      TXT

;; ANSWER SECTION:
foo.example.com.        86400   IN      TXT     &#34;bla&#34; &#34;\;&#34;

;; Query time: 197 msec
;; SERVER: 127.0.0.1#3553&#40;127.0.0.1&#41;
;; WHEN: Sat Nov 19 23:43:31 2005
;; MSG SIZE  rcvd: 51

grover-Secret-Wg-org:~ olaf$ dig @127.0.0.1 -p 3553 foo2.example.com TXT

; &lt;&lt;&gt;&gt; DiG 9.3.1 &lt;&lt;&gt;&gt; @127.0.0.1 -p 3553 foo2.example.com TXT
; &#40;1 server found&#41;
;; global options:  printcmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 44794
;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0

;; QUESTION SECTION:
;foo2.example.com.              IN      TXT

;; ANSWER SECTION:
foo.example.com.        86400   IN      TXT     &#34;bla&#34; &#34;\;&#34;

;; Query time: 36 msec
;; SERVER: 127.0.0.1#3553&#40;127.0.0.1&#41;
;; WHEN: Sat Nov 19 23:43:37 2005
;; MSG SIZE  rcvd: 56





I hope this helps... 

--Olaf 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;19&nbsp;17:50:49&nbsp;2005</span>
    <span class="description">OLAF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
I am affraid I do not exactly understand how you tested against a bind server. I also do not 
understand what produces the output you provided with all the backslashes.

As for the new_from_hash method you want to use the char_str_list. Some example code is 
below.

In order to show that this is wire compatible with BIND I set up a perl nameserver and use dig 
to query it.

First the code:
------------------- cut ---------------------
#!/usr/local/bin/perl -Wall

use strict;
use warnings;
use Net::DNS::Nameserver;

my $nameserver=Net::DNS::Nameserver-&gt;new &#40;
    LocalAddr =&gt; &#34;127.0.0.1&#34;,
    LocalPort =&gt; 3553,
    Verbose =&gt; 1,
    ReplyHandler =&gt; \&#38;reply_handler,
    &#41;;


my   $rr = Net::DNS::RR-&gt;new&#40;
                name    =&gt; &#34;foo.example.com&#34;,
                ttl     =&gt; 86400,
                class   =&gt; &#34;IN&#34;,
                type    =&gt; &#34;TXT&#34;,
                char_str_list =&gt; [&#39;bla&#39;,&#39;;&#39;],
        &#41;;


my $rr2=Net::DNS::RR-&gt;new&#40;&#39;foo2.example.com  600 IN TXT &#34;Test1 \&#34; \; more stuff&#34;  
&#34;Test2&#34;&#39;&#41;;

$rr-&gt;print;
$rr2-&gt;print;



sub reply_handler {
    my &#40;$qname, $qclass, $qtype, $peerhost&#41; = @_;
    my &#40;$rcode, @ans, @auth, @add&#41;;

    if &#40;$qtype eq &#34;TXT&#34; &#38;&#38; $qname eq &#34;foo.example.com&#34;&#41; {
        push @ans, $rr;
    }elsif &#40;$qtype eq &#34;TXT&#34; &#38;&#38; $qname eq &#34;foo2.example.com&#34;&#41; {
        push @ans, $rr;
    } else {
        $rcode = &#34;SERFAIL&#34;;
    }
    return &#40;$rcode, \@ans, \@auth, \@add, { aa =&gt; 1 }&#41;;
}


$nameserver-&gt;main_loop;


---------------- cut ---------------------------------

And these are the queries that return exactly what I think should be returned


grover-Secret-Wg-org:~ olaf$ dig @127.0.0.1 -p 3553 foo.example.com TXT

; &lt;&lt;&gt;&gt; DiG 9.3.1 &lt;&lt;&gt;&gt; @127.0.0.1 -p 3553 foo.example.com TXT
; &#40;1 server found&#41;
;; global options:  printcmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 35736
;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0

;; QUESTION SECTION:
;foo.example.com.               IN      TXT

;; ANSWER SECTION:
foo.example.com.        86400   IN      TXT     &#34;bla&#34; &#34;\;&#34;

;; Query time: 197 msec
;; SERVER: 127.0.0.1#3553&#40;127.0.0.1&#41;
;; WHEN: Sat Nov 19 23:43:31 2005
;; MSG SIZE  rcvd: 51

grover-Secret-Wg-org:~ olaf$ dig @127.0.0.1 -p 3553 foo2.example.com TXT

; &lt;&lt;&gt;&gt; DiG 9.3.1 &lt;&lt;&gt;&gt; @127.0.0.1 -p 3553 foo2.example.com TXT
; &#40;1 server found&#41;
;; global options:  printcmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 44794
;; flags: qr aa rd; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0

;; QUESTION SECTION:
;foo2.example.com.              IN      TXT

;; ANSWER SECTION:
foo.example.com.        86400   IN      TXT     &#34;bla&#34; &#34;\;&#34;

;; Query time: 36 msec
;; SERVER: 127.0.0.1#3553&#40;127.0.0.1&#41;
;; WHEN: Sat Nov 19 23:43:37 2005
;; MSG SIZE  rcvd: 56





I hope this helps... 

--Olaf 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;19&nbsp;17:58:39&nbsp;2005</span>
    <span class="description">OLAF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
Ooops...

Forget my last mail..  $rr2 failed...
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;19&nbsp;18:15:31&nbsp;2005</span>
    <span class="description">OLAF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Ooops...
&gt; 
&gt; Forget my last mail..  $rr2 failed...
</div>
There were two small typos --- I should not do this shortly before going to bed ---, the 
demoscript does work now. Instead of copying it here again it is on 
www.net-dns.org/txtdemo.pl

It runs on ip 127.0.0.1 port 3553 and the two queries it answers to are
dig @127.0.0.1 -p 3553 foo.example.com TXT
and
dig @127.0.0.1 -p 3553 foo2.example.com TXT

Note that although we use \; in our input and  dig prints \; in its output only the semi-colon 
character travels the wire. See the ethereal output below for the reply to the 
foo2.example.com TXT query.

&#40;The  relevant  sequence is 20 22 20 3b 20&#41;


0000  00 00 00 02 45 00 00 65  01 0b 00 00 40 11 00 00   ....E..e ....@...
0010  7f 00 00 01 7f 00 00 01  00 35 ec e9 00 51 fe 64   ........ .5...Q.d
0020  da 5b 85 00 00 01 00 01  00 00 00 00 04 66 6f 6f   .[...... .....foo
0030  32 07 65 78 61 6d 70 6c  65 03 63 6f 6d 00 00 10   2.exampl e.com...
0040  00 01 c0 0c 00 10 00 01  00 00 02 58 00 1b 14 54   ........ ...X...T
0050  65 73 74 31 20 22 20 3b  20 6d 6f 72 65 20 73 74   est1 &#34; ;  more st
0060  75 66 66 05 54 65 73 74  32                        uff.Test 2       

Hope this all helps a bit,

--Olaf
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;19&nbsp;21:20:10&nbsp;2005</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> bugs [...] jth.net</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">[OLAF - Sat Nov 19 17:50:49 2005]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; I am affraid I do not exactly understand how you tested against a bind
&gt;    server. I also do not
&gt; understand what produces the output you provided with all the
&gt;    backslashes.
&gt; 
</div>
        $tmp = rr_add&#40;&#34;$name $ttl $rrtype &#39;$txt&#39;&#34;&#41;;
        $update-&gt;push&#40;&#34;update&#34;, $tmp&#41;;

With your code &#40;$rrstring   =~ s/&#40;?&lt;!\\&#41;;.*//g;&#41;
----
test.demo1.kom 14400 TXT &#39;abc\;def&#39; 
;; ANSWER SECTION:
test.demo1.kom.         14400   IN      TXT     &#34;abc\\\;def&#34;
----
test.demo1.kom 14400 TXT &#39;abc;def&#39;
test.demo1.kom. 14400 IN TXT ; no data 
Returkode: FORMERR
-----
With my code &#40;$rrstring   =~ s/&#40;?&lt;!\\&#41;;[^&#34;&#39;]*$//g;&#41;

test1.demo1.kom.        14400   IN      TXT     &#34;abc\;def&#34;
;; ANSWER SECTION:
test1.demo1.kom.        14400   IN      TXT     &#34;abc\\\;def&#34;
-----
test1.demo1.kom 14400 TXT &#39;abc;def&#39;
;; ANSWER SECTION:
test1.demo1.kom.        14400   IN      TXT     &#34;abc\;def&#34;
-----

- Jørgen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;20&nbsp;05:48:48&nbsp;2005</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> bugs [...] jth.net</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">[OLAF - Sat Nov 19 17:50:49 2005]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; I am affraid I do not exactly understand how you tested against a bind
&gt;    server. I also do not
&gt; understand what produces the output you provided with all the
&gt;    backslashes.
&gt; 
</div>
        $tmp = rr_add&#40;&#34;$name $ttl $rrtype &#39;$txt&#39;&#34;&#41;;
        $update-&gt;push&#40;&#34;update&#34;, $tmp&#41;;

With your code &#40;$rrstring   =~ s/&#40;?&lt;!\\&#41;;.*//g;&#41;
----
test.demo1.kom 14400 TXT &#39;abc\;def&#39; 
;; ANSWER SECTION:
test.demo1.kom.         14400   IN      TXT     &#34;abc\\\;def&#34;
----
test.demo1.kom 14400 TXT &#39;abc;def&#39;
test.demo1.kom. 14400 IN TXT ; no data 
Returkode: FORMERR
-----
With my code &#40;$rrstring   =~ s/&#40;?&lt;!\\&#41;;[^&#34;&#39;]*$//g;&#41;

test1.demo1.kom.        14400   IN      TXT     &#34;abc\;def&#34;
;; ANSWER SECTION:
test1.demo1.kom.        14400   IN      TXT     &#34;abc\\\;def&#34;
-----
test1.demo1.kom 14400 TXT &#39;abc;def&#39;
;; ANSWER SECTION:
test1.demo1.kom.        14400   IN      TXT     &#34;abc\;def&#34;
-----

- Jørgen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;20&nbsp;14:26:25&nbsp;2005</span>
    <span class="description">olaf [...] dacht.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Olaf M. Kolkman&#34; &lt;olaf [...] dacht.net&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #15798] Bugs in TXT handling </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 20 Nov 2005 20:25:43 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-DNS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">RT-Send-Cc:</td>
    <td class="message-header-value"> </td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">

Hello Jørgen

Aha, I was not aware you were using dynamic updates.

In a dynamic update scheme this is what works:

my $update2= Net::DNS::Update-&gt;new&#40;&#39;net-dns.org&#39;&#41;;
my $name=&#34;dynup.net-dns.org&#34;;
my $ttl=1;
my $rrtype=&#34;TXT&#34;;
my $txt=&#39;&#34;fooFoo2&#34; &#34;Bla \; Foo&#34;&#39;;

$update2-&gt;push&#40;update =&gt;rr_add&#40;&#34;$name $ttl $rrtype $txt&#34;&#41;&#41;;
$update2-&gt;push&#40;additional =&gt; $tsig&#41;;

&#34;dig&#34; at the dynamically updated zone gives me:
;; ANSWER SECTION:
dynup.net-dns.org.      1       IN      TXT     &#34;fooFoo2&#34; &#34;Bla \; Foo&#34;

The TXT records rdata is two character strings, one containing  
&#34;fooFoo2&#34; and one &#34;Bla ; Foo&#34;. In presentation format the semi colon  
is escaped. &#39;dig&#39; prints presentation format.

The case with which Net::DNS bails out is if there is an unescaped  
comment in a character string:
$txt=&#39; &#34;foo&#34;  &#34; bla ; comment&#34; &#39;
But then again the semicolon is AFAIK a special character that should  
be escaped as by RFC1035.

Anyway I did manage to reconstruct the problem you reported. And it  
seems to be due by the fact that you put single quotes around $txt in  
the rr_add argument.

you use rr_add&#40;&#34;$name $ttl $rrtype &#39;$txt&#39;&#34;&#41;;
while the for rr_add&#40;&#34;$name $ttl $rrtype $txt&#34;&#41;;

the correct thing happens.

Just remember that the formal way to represent TXT RRs is using one  
or more &lt;character-strings&gt; that are surrounded by double quotes.

$txt=&#39;  &#34;character-string1&#34;   &#34;character-string2&#34; &#39;



I hope this helps.


--Olaf









------------------------------------------------------
Ik dacht net... heel even maar.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/148445/44233/PGP.sig">Download PGP.sig</a><br />
<span class="downloadcontenttype">application/pgp-signature 227b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;20&nbsp;17:20:30&nbsp;2005</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> bugs [...] jth.net</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">[olaf@dacht.net - Sun Nov 20 14:26:25 2005]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Anyway I did manage to reconstruct the problem you reported. And it
&gt; seems to be due by the fact that you put single quotes around $txt in
&gt; the rr_add argument.
&gt; 
&gt; you use rr_add&#40;&#34;$name $ttl $rrtype &#39;$txt&#39;&#34;&#41;;
&gt; while the for rr_add&#40;&#34;$name $ttl $rrtype $txt&#34;&#41;;
&gt; 
</div>
Quoting from man Net::DNS:RR

$txt   = Net::DNS::RR-&gt;new&#40;&#34;baz.example.com 3600 HS TXT &#39;text record&#39;&#34;&#41;;

May I suggest updating the documentation.

- Jørgen 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;21&nbsp;03:38:41&nbsp;2005</span>
    <span class="description">olaf [...] dacht.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Olaf M. Kolkman&#34; &lt;olaf [...] dacht.net&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [cpan #15798] Bugs in TXT handling </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 21 Nov 2005 09:37:53 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-DNS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">RT-Send-Cc:</td>
    <td class="message-header-value"> </td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Quoting from man Net::DNS:RR
&gt;
&gt; $txt   = Net::DNS::RR-&gt;new&#40;&#34;baz.example.com 3600 HS TXT &#39;text  
&gt; record&#39;&#34;&#41;;
</div>


Because of your question I already added some explanation to the  
Net::DNS::RR::TXT documentation.
I fixed the Net::DNS::RR and Net::DNS::Update documentation.


I&#39;ll close the ticket.

Thanks for your patience.

--Olaf


------------------------------------------------------
Ik dacht net... heel even maar.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/148447/44267/PGP.sig">Download PGP.sig</a><br />
<span class="downloadcontenttype">application/pgp-signature 227b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;21&nbsp;04:18:27&nbsp;2005</span>
    <span class="description">OLAF [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
