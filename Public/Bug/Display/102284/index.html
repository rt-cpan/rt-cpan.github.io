<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #102284 for Date-Manip: ParseDate&#40;&#41; TZ processing is a significant &#40;~8x&#41; performance bottleneck</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #102284 for Date-Manip: ParseDate&#40;&#41; TZ processing is a significant &#40;~8x&#41; performance bottleneck</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Date-Manip/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Date-Manip/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Date-Manip/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Date-Manip/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Date-Manip">Date-Manip CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">102284</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Date-Manip/Active/">Date-Manip</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
gdg [...] zplane.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-45268-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-45269-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Feb&nbsp;22&nbsp;12:16:23&nbsp;2015</span>
    <span class="description">gdg [...] zplane.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> ParseDate&#40;&#41; TZ processing is a significant &#40;~8x&#41; performance bottleneck</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 22 Feb 2015 10:15:35 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Sullivan Beck via RT &lt;bug-Date-Manip [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Glenn Golden &lt;gdg [...] zplane.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Just for completeness, filing this as a separate ticket pertaining only to
DM6, rather than confusing the issue with differential comparisons relative to
DM5, per the earlier ticket &#40;102188&#41;.

The intent is just to document the behavior of DM6 in hopes that at some future
time it might be examined to see if the with-TZ performance can perhaps be
improved, since it&#39;s clearly a bottleneck as it stands now.

The two attached datasets &#40;dateset3.txt and dateset3_notz.txt&#41; contain about
2400 date strings drawn from email messages, and are identical except that in
the latter set the TZ strings have been removed.

The script displays timing results for both DM5 and DM6, but the intent here
is just to draw attention to the DM6 ParseDate&#40;&#41; performance differential
between dates with vs. without TZs.  I see about 7x - 9x across three machines
&#40;two x86-64, one x686&#41; and two perl versions &#40;5.16.3 and 5.20.1&#41;. This suggests
that something like 80% of the ParseDate&#40;&#41; realtime is spent in handling the
TZ info.

Again, I&#39;m not complaining, since realtime performance was explicitly not a
design consideration; just trying to document the behavior and provide a
helpful example in case it becomes of interest at a later time to look into
potential speedups.

Thanks,

Glenn
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;23&nbsp;16:09:05&nbsp;2015</span>
    <span class="description">sbeck [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have spent some time adding some optimizations and that has speeded up timezone handling somewhat.

Unfortunately, I don&#39;t anticipate being able to get anywhere near even with Date::Manip 5 in terms of speed because there is just too much overhead for each new timezone.  When you load almost all of the timezone modules &#40;which your test case does&#41;, it&#39;ll be slow.

I have added a note to this effect in the docs... but I&#39;ve also stated &#40;correctly&#41; that the results for 5.x cannot be relied upon for accuracy.  I&#39;m afraid that if timezones are important to you... you just have to pay the priced.  Incidentally, this isn&#39;t unique to Date::Manip.  DateTime will have the same issue since it also stores all of the timezones in separate modules that have to be read in upon first use.

I&#39;m going to continue to play with this and try to get more optimizations, but at this point, I am pretty comfortable with the current state of things &#40;meaning that it is working as desired and expected, and while I hope to speed things up, I don&#39;t think I&#39;ll be getting factors of 2 out of it&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Feb&nbsp;23&nbsp;16:09:06&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;27&nbsp;22:03:00&nbsp;2015</span>
    <span class="description">gdg [...] zplane.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #102284] ParseDate&#40;&#41; TZ processing is a significant &#40;~8x&#41; performance bottleneck</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 27 Feb 2015 20:02:42 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Sullivan Beck via RT &lt;bug-Date-Manip [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Glenn Golden &lt;gdg [...] zplane.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sullivan Beck via RT &lt;bug-Date-Manip@rt.cpan.org&gt; [2015-02-23 16:09:06 -0500]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=102284">https://rt.cpan.org/Ticket/Display.html?id=102284</a></span> &gt;
&gt; 
&gt; Unfortunately, I don&#39;t anticipate being able to get anywhere near even with
&gt; Date::Manip 5 in terms of speed because there is just too much overhead for
&gt; each new timezone.  When you load almost all of the timezone modules &#40;which
&gt; your test case does&#41;, it&#39;ll be slow.
&gt; 
</div>
Aha... I did not appreciate earlier that so much TZ info was being loaded for
this test case. I naively thought that since the test case TZs were all
expressed as numeric offsets, there would be no need to load more than 24 TZ
modules.  But now I understand &#40;I think?&#41; that it has to load every module
whose offset is equal to the given numerical offset. Is that right? &#40;My question
is only for curiosity at this point.&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Incidentally, this isn&#39;t unique to Date::Manip.  DateTime will have the same
&gt; issue since it also stores all of the timezones in separate modules that have
&gt; to be read in upon first use.
&gt; 
</div>
Date::Parse seems to handle RFC-5322 dates ok &#40;except for a few that were
malformed and technically not in compliance&#41; so wound up using that when
I needed blazing speed.


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m going to continue to play with this and try to get more
&gt; optimizations, but at this point, I am pretty comfortable with the
&gt; current state of things &#40;meaning that it is working as desired and
&gt; expected, and while I hope to speed things up, I don&#39;t think I&#39;ll
&gt; be getting factors of 2 out of it&#41;.
</div>
Understandable, and totally in agreement given the design philosophy of the
module.

Once again I thank you for your time in looking into this and responding to
the queries. It&#39;s really an extremely useful and well-documented module,
thanks for writing and maintaining it.

Glenn
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Feb&nbsp;28&nbsp;07:35:14&nbsp;2015</span>
    <span class="description">sbeck [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Aha... I did not appreciate earlier that so much TZ info was being
&gt; loaded for
&gt; this test case. I naively thought that since the test case TZs were
&gt; all
&gt; expressed as numeric offsets, there would be no need to load more than
&gt; 24 TZ
&gt; modules.  But now I understand &#40;I think?&#41; that it has to load every
&gt; module
&gt; whose offset is equal to the given numerical offset. Is that right?
&gt; &#40;My question
&gt; is only for curiosity at this point.&#41;
</div>
You are correct.  Offsets are not timezones... offsets are simply the current offset from GMT.  A timezone is a full description of time changes over all of history and includes any number of offsets, abbreviations &#40;EDT, EST, etc.&#41;, and critical dates &#40;dates where the offset and/or abbreviation change&#41;.

So, when you use an offset of -0700, Date::Manip has to check every timezone that has ever used that offset, and then it tries to determine which timezone you are actually referring to.

In actuality, your test case loaded over 340 timezones &#40;there are right around 450 total timezones&#41;, so you really managed to come up with a worst-case sceneario.

Luckily, I consider this case fairly rare in that most real-life situations, you&#39;ll be parsing dates in your timezone, and that&#39;s it.

Also, although your test case seemed large, it was only a few thousand dates, and spreading the overhead of loading so many timezones over such a small number of dates exagerated the difference.  If you were bump up the number of dates by several orders of magnitude, I believe that the ratio of 6.xx to 5.xx would come down.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Incidentally, this isn&#39;t unique to Date::Manip.  DateTime will have
&gt; &gt; the same
&gt; &gt; issue since it also stores all of the timezones in separate modules
&gt; &gt; that have
&gt; &gt; to be read in upon first use.
&gt; &gt;
</div>&gt; 
&gt; Date::Parse seems to handle RFC-5322 dates ok &#40;except for a few that
&gt; were
&gt; malformed and technically not in compliance&#41; so wound up using that
&gt; when
&gt; I needed blazing speed.
</div>
Date::Parse is not going to help you get timezones correct.  As a matter of fact, Date::Parse is closely related to Date::Manip 5.xx.  Date::Parse is written by Graham Barr and is an extension to a simple timezone module that he wrote quite a long time ago, which I borrowed and expanded for use in Date::Manip 5.xx.  Both are able to parse a very small subset of timezone offsets and abbreviations.  Neither is guaranteed to do them right though.  For example, if you parse a date with an offset of -0700, is that in daylight saving time or in standard time?  Neither module knows when the critical dates are &#40;i.e. when it switched&#41; so they just guess you&#39;re referring to standard time usually.

Unfortunately, in the US, standard time only lasts for 1/3 of the year!  So 2/3 of the time, parsing a date with an offset will assign it to the wrong timezone.

What this means is that you will not be able to do calculations or conversions with the date, because your results will be wrong.  Also, if you look at any timezone information about the date &#40;i.e. what timezone or abbreviation it has&#41;, it&#39;ll be wrong so often as to be useless.


To wrap all of this up...

If you want to parse dates where timezone information is not important, there are any number of options.  If you want to parse dates where timezone information is important, there are only two options:  Date::Manip 6.xx and DateTime.  Both are slowere than your other options.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;07&nbsp;14:51:22&nbsp;2015</span>
    <span class="description">gdg [...] zplane.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #102284] ParseDate&#40;&#41; TZ processing is a significant &#40;~8x&#41; performance bottleneck</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 7 Mar 2015 12:51:04 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Sullivan Beck via RT &lt;bug-Date-Manip [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Glenn Golden &lt;gdg [...] zplane.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sullivan Beck via RT &lt;bug-Date-Manip@rt.cpan.org&gt; [2015-02-28 07:35:14 -0500]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=102284">https://rt.cpan.org/Ticket/Display.html?id=102284</a></span> &gt;
&gt; 
&gt; You are correct.  Offsets are not timezones... offsets are simply
&gt; the current offset from GMT.  A timezone is a full description of
&gt; time changes over all of history and includes any number of offsets,
&gt; abbreviations &#40;EDT, EST, etc.&#41;, and critical dates &#40;dates where
&gt; the offset and/or abbreviation change&#41;.
&gt;
</div>
OK, got it, thanks.

I&#39;ve thought about this a lot more now, and did some experiments over the past
week to understand better how DM6 behaves in the face of dates with offsets.
I still have some further questions and comments though, hope you&#39;ll bear with
me on this.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; So, when you use an offset of -0700, Date::Manip has to check every timezone
&gt; that has ever +used that offset, and then it tries to determine which
&gt; timezone you are actually +referring to.
&gt;
</div>
But if a date is supplied with only an offset and no explicit putative TZ --
as the case for the &#34;dateset3.txt&#34; example dataset from the earlier post -- 
then DM can&#39;t uniquely determine which TZ was intended. The best it can do is
choose one among the &#40;possibly several&#41; feasible TZs, and then assign that TZ
to the date object.  &#40;At least, that seems to be how it behaves, based on a
number of experiments.  Is that right?&#41;

If so, I was wondering if you&#39;d entertain knocking around some ideas about a
potential enhancement to DM, in the form of an option that allows date strings
of this specific type &#40;offset only, no explicit putative TZ&#41; to be special-cased
during parsing.

The general idea would be that enabling this option would affect validation
and TZ assignment something along the following lines:

  * Validation would be relaxed, so as to avoid the need to load all the
    feasible TZs &#40;which I presume is required in order to validate that the
    given {absolute time, offset} pair actually corresponds to a period
    contained in some extant TZ in your database&#41;.

    Exactly what might be meant by &#34;relaxed&#34; is open to some debate. For 
    example, perhaps accept only offsets having the minimum granularity
    among all actual TZs &#40;I think this would be 15 mins?&#41;. Or perhaps just have
    a small in-core table listing all valid TZ offsets and permit the given
    offset iff it appears in that table.

  * Assigning a TZ to the date object would become somewhat tricky with the
    option enabled, since there might be no actual tabled TZ satisfying both
    the offset and the {absolute time, offset} pair simultaneously. But
    perhaps instead there could be the notion of a &#34;pseudo-TZ&#34; especially for
    offset-only cases, which would be dynamically created based on the offset,
    rather than drawn from the database. &#40;For example PSEUDO+0100, or 
    PSEUDO-0445, etc.&#41;

The benefits of enabling the option would be &#40;a&#41; much faster parsing of offset-
only dates, and &#40;b&#41; avoidance of assigning artificially chosen TZs from the
database, in preference for a more &#34;honest&#34; pseudo-TZ assignment which
essentially admits, &#34;we have no clue what TZ you mean, but the information in
this pseudo-TZ is consistent with your supplied offset.&#34;

I have some more detailed ideas on the above, but first wanted to ask whether
this even sounds like something you&#39;d consider debating about or whether, due
to implementation constraints or lack of utility, it is simply a non-starter.

Anyway... just tossing it out as a hopefully constructive suggestion.  I&#39;m very
well aware that simple-sounding suggestions may be hugely complicated to
actually implement, and not even worth considering for that reason of course.
Just thinking out loud.

One more topic though, related to &#40;and motivating the above&#41;: Honestly, I can&#39;t
agree with your assessment:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Luckily, I consider this case fairly rare in that most real-life situations,
&gt; you&#39;ll be parsing dates in your timezone, and that&#39;s it.
&gt;
</div>
IMO, the parsing of large sets of dates having different offsets is not a corner
case at all, but probably reasonably common, especially for email processing.

Any application parsing email &#34;Date&#34; or &#34;Received&#34; header fields will very
quickly wind up having to handle a significant fraction of all the possible
offsets. The &#34;dateset3.txt&#34; dataset from my earlier post was derived in exactly
this way, not artificially at all, by simply extracting &#34;Date&#34; headers from a
few of my own mail folders.  And if &#34;Received&#34; headers are considered as well,
then an even wider fraction of offsets is going to quickly arise: Even in the
case when senders are all located in geographically narrow area and their
&#34;Date&#34; fields are closely clustered in a few TZs, there will generally be a
much wider array of &#34;Received&#34; dates because server locations &#40;which handle
intermediate movements of the message&#41; are scattered all over.

I can&#39;t justify the above based on any objective facts that I&#39;m aware of,
just opining based on my own experiences.

Anyway... once again, thank you for all your time on this.

Regards,

Glenn
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
