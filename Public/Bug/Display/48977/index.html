<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #48977 for SQLite-VirtualTable: Support for older perl and newer SQLite</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #48977 for SQLite-VirtualTable: Support for older perl and newer SQLite</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/SQLite-VirtualTable/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/SQLite-VirtualTable/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/SQLite-VirtualTable/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/SQLite-VirtualTable/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/SQLite-VirtualTable">SQLite-VirtualTable CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">48977</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="time worked">
    <td class="label">Worked:</td>
    <td class="value">20 min

</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/SQLite-VirtualTable/Active/">SQLite-VirtualTable</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
markkidwell [...] comcast.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-40256-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.03    </td>
  </tr>
  <tr id="CF-40257-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;24&nbsp;18:32:15&nbsp;2009</span>
    <span class="description">markkidwell [...] comcast.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Support for older perl and newer SQLite</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

2 things:

In Perl 5.8.4, the module doesn&#39;t seem to compile due to its use of
&#34;Newxz&#34; in perlvtab.c. Using &#34;Newz&#34; lets it compile on that version.

The module doesn&#39;t find the sqlite3ext.h file with newer SQLite distros,
which do away with the src directory. Looking in the top level dir as
well as src resolves this.

See the attached patch for suggested fixes for both issues.

After getting this working, the module worked great and is very useful!

Thanks and regards,
Mark
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> sqlite-vt.patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -u -r SQLite-VirtualTable-0.03/Makefile.PL SQLite-VirtualTable-0.03-patched/Makefile.PL
--- SQLite-VirtualTable-0.03/Makefile.PL	2006-07-13 02:53:16.000000000 -0700
+++ SQLite-VirtualTable-0.03-patched/Makefile.PL	2009-08-24 14:59:07.000000000 -0700
@@ -17,7 +17,7 @@
 defined $sqlite_source
     or die &#34;Usage: perl Makefile.PL SQLITE_SOURCE=/path/to/sqlite/source ...\n&#34;;
 
--f $sqlite_source . &#34;/src/sqlite3ext.h&#34;
+&#40;-f $sqlite_source . &#34;/src/sqlite3ext.h&#34; || -f $sqlite_source . &#34;/sqlite3ext.h&#34;&#41;
     or die &#34;SQLite source not found on the path given\n&#34;;
 
 WriteMakefile&#40; NAME =&gt; &#39;SQLite::VirtualTable&#39;,
Only in SQLite-VirtualTable-0.03-patched: Makefile.bak
diff -u -r SQLite-VirtualTable-0.03/perlvtab.c SQLite-VirtualTable-0.03-patched/perlvtab.c
--- SQLite-VirtualTable-0.03/perlvtab.c	2006-07-13 03:27:57.000000000 -0700
+++ SQLite-VirtualTable-0.03-patched/perlvtab.c	2009-08-24 13:44:38.000000000 -0700
@@ -117,7 +117,7 @@
     if &#40;rc != SQLITE_OK&#41;
         goto cleanup;
 
-    Newxz&#40;vtab, 1, perl_vtab&#41;;
+    Newz&#40;0, vtab, 1, perl_vtab&#41;;
     vtab-&gt;sv = SvREFCNT_inc&#40;vtabsv&#41;;
     vtab-&gt;db = db;
 #ifdef MULTIPLICITY
@@ -287,7 +287,7 @@
         goto cleanup;
     }
 
-    Newxz&#40;cursor, 1, perl_vtab_cursor&#41;;
+    Newz&#40;0, cursor, 1, perl_vtab_cursor&#41;;
     cursor-&gt;sv = SvREFCNT_inc&#40;cursv&#41;;
     SvREFCNT_inc&#40;vtabsv&#41;;
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;24&nbsp;19:07:23&nbsp;2009</span>
    <span class="description">markkidwell [...] comcast.net -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;24&nbsp;19:10:30&nbsp;2009</span>
    <span class="description">markkidwell [...] comcast.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #48977] AutoReply: Support for older perl and newer SQLite</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 24 Aug 2009 23:09:57 +0000 &#40;UTC&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-SQLite-VirtualTable [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> markkidwell [...] comcast.net</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi, 

After sending this I realized my patch was way off - it&#39;s easier / better to use ppport.h. It&#39;s included in the distro, but not ref&#39;d by the perlvtab.c file. This patch &#40;produced by the ppport.h file in the distro&#41; lets it compile on 5.8.4: 

--- SQLite-VirtualTable-0.03/perlvtab.c 
+++ SQLite-VirtualTable-0.03/perlvtab.c.patched 
@@ -3,6 +3,9 @@ 
#include &#34;EXTERN.h&#34; 
#include &#34;perl.h&#34; 
#include &#34;XSUB.h&#34; 
+#define NEED_newRV_noinc 
+#define NEED_sv_2pv_nolen 
+#include &#34;ppport.h&#34; 

#include &lt;sqlite3ext.h&gt; 
SQLITE_EXTENSION_INIT1 


Thanks and regards, 
Mark 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">----- Original Message ----- 
From: &#34;Bugs in SQLite-VirtualTable via RT&#34; &lt;bug-SQLite-VirtualTable@rt.cpan.org&gt; 
To: markkidwell@comcast.net 
Sent: Monday, August 24, 2009 3:32:16 PM GMT -08:00 US/Canada Pacific 
Subject: [rt.cpan.org #48977] AutoReply: Support for older perl and newer SQLite 


Greetings, 

This message has been automatically generated in response to the 
creation of a trouble ticket regarding: 
&#34;Support for older perl and newer SQLite&#34;, 
a summary of which appears below. 

There is no need to reply to this message right now. Your ticket has been 
assigned an ID of [rt.cpan.org #48977]. Your ticket is accessible 
on the web at: 

<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=48977">https://rt.cpan.org/Ticket/Display.html?id=48977</a></span> 

Please include the string: 

[rt.cpan.org #48977] 

in the subject line of all future correspondence about this issue. To do so, 
you may reply to this message. 

Thank you, 
bug-SQLite-VirtualTable@rt.cpan.org 

------------------------------------------------------------------------- 
Hi, 

2 things: 

In Perl 5.8.4, the module doesn&#39;t seem to compile due to its use of 
&#34;Newxz&#34; in perlvtab.c. Using &#34;Newz&#34; lets it compile on that version. 

The module doesn&#39;t find the sqlite3ext.h file with newer SQLite distros, 
which do away with the src directory. Looking in the top level dir as 
well as src resolves this. 

See the attached patch for suggested fixes for both issues. 

After getting this working, the module worked great and is very useful! 

Thanks and regards, 
Mark 
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;23&nbsp;16:43:46&nbsp;2009</span>
    <span class="description">salva [...] cpan.org -  Correspondence added</span>
    <span class="time-taken">20 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Opps, sorry for being so late!

A new version of the module has been released.

Thanks for the report.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;23&nbsp;16:43:48&nbsp;2009</span>
    <span class="description">salva [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
