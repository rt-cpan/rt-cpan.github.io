<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #6086 for Tcl: Tcl module on FreeBSD</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #6086 for Tcl: Tcl module on FreeBSD</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Tcl/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Tcl/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Tcl/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Tcl/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Tcl">Tcl CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">6086</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Tcl/Active/">Tcl</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
slaven [...] rezic.de

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-30776-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.75    </td>
  </tr>
  <tr id="CF-30777-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;21&nbsp;11:43:06&nbsp;2004</span>
    <span class="description">SREZIC [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Tcl module on FreeBSD</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The attached patch changes the Tcl.pm Makefile.PL to autodetect the latest Tcl library on FreeBSD.

Regards,
    Slaven
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"># 
# 
# To apply this patch:
# STEP 1: Chdir to the source directory.
# STEP 2: Run the &#39;applypatch&#39; program with this patch file as input.
#
# If you do not have &#39;applypatch&#39;, it is part of the &#39;makepatch&#39; package
# that you can fetch from the Comprehensive Perl Archive Network:
# <span class="clickylink"><a target="new" rel="nofollow" href="http://www.perl.com/CPAN/authors/Johan_Vromans/makepatch-x.y.tar.gz">http://www.perl.com/CPAN/authors/Johan_Vromans/makepatch-x.y.tar.gz</a></span>
# In the above URL, &#39;x&#39; should be 2 or higher.
#
# To apply this patch without the use of &#39;applypatch&#39;:
# STEP 1: Chdir to the source directory.
# STEP 2: Run the &#39;patch&#39; program with this file as input.
#
#### End of Preamble ####

#### Patch data follows ####
diff -up &#39;../../build/Tcl-0.75/Makefile.PL&#39; &#39;Makefile.PL&#39;
Index: ./Makefile.PL
--- ./Makefile.PL	Tue Mar 23 00:44:58 2004
+++ ./Makefile.PL	Wed Apr 21 00:06:52 2004
@@ -1,10 +1,17 @@
 # before running this script make sure you have &#39;tclsh&#39; in your path, 
 # and this &#39;tcl&#39; distribution is required one.
-# FreeBSD users may want to modify name of tcl interpreter &#40;this is
-# $tclsh variable below&#41; as long as &#39;tclsh&#39; does not work in their case
 
 my $tclsh = &#39;tclsh&#39;;
 
+if &#40;$^O eq &#39;freebsd&#39; &#38;&#38; `$tclsh /dev/null 2&gt;&#38;1` =~ /named with a version/&#41; {
+    for my $ver &#40;qw&#40;8.4 8.3 8.2 8.1 8.0&#41;&#41; {
+	if &#40;is_in_path&#40;&#34;$tclsh$ver&#34;&#41;&#41; {
+	    $tclsh = &#34;$tclsh$ver&#34;;
+	    last;
+	}
+    }
+}
+
 open TCLSH, &#34;$tclsh tclcfg.tcl |&#34;;
 my $tclcfg = join &#39;&#39;, &lt;TCLSH&gt;;
 print $tclcfg;
@@ -36,5 +43,44 @@ WriteMakefile&#40;
     LIBS =&gt; [&#34;$tclcfg{libpath} -l${libpref}tcl$tclver&#34;],
     INC =&gt; &#34;$tclcfg{incpath}&#34;,
 &#41;;
+
+# Utility functions
+
+BEGIN {
+    if &#40;eval { require File::Spec; defined &#38;File::Spec::file_name_is_absolute }&#41; {
+	*file_name_is_absolute = \&#38;File::Spec::file_name_is_absolute;
+    } else {
+	*file_name_is_absolute = sub {
+	    my $file = shift;
+	    my $r;
+	    if &#40;$^O eq &#39;MSWin32&#39;&#41; {
+		$r = &#40;$file =~ m;^&#40;[a-z]:&#40;/|\\&#41;|\\\\|//&#41;;i&#41;;
+	    } else {
+		$r = &#40;$file =~ m|^/|&#41;;
+	    }
+	    $r;
+	};
+    }
+}
+
+sub is_in_path {
+    my&#40;$prog&#41; = @_;
+    return $prog if &#40;file_name_is_absolute&#40;$prog&#41; and -f $prog and -x $prog&#41;;
+    require Config;
+    my $sep = $Config::Config{&#39;path_sep&#39;} || &#39;:&#39;;
+    foreach &#40;split&#40;/$sep/o, $ENV{PATH}&#41;&#41; {
+	if &#40;$^O eq &#39;MSWin32&#39;&#41; {
+	    # maybe use $ENV{PATHEXT} like maybe_command in ExtUtils/MM_Win32.pm?
+	    return &#34;$_\\$prog&#34;
+		if &#40;-x &#34;$_\\$prog.bat&#34; ||
+		    -x &#34;$_\\$prog.com&#34; ||
+		    -x &#34;$_\\$prog.exe&#34; ||
+		    -x &#34;$_\\$prog.cmd&#34;&#41;;
+	} else {
+	    return &#34;$_/$prog&#34; if &#40;-x &#34;$_/$prog&#34; &#38;&#38; !-d &#34;$_/$prog&#34;&#41;;
+	}
+    }
+    undef;
+}
 
 #EOS
#### End of Patch data ####

#### ApplyPatch data follows ####
# Data version        : 1.0
# Date generated      : Wed Apr 21 00:08:24 2004
# Generated by        : makepatch 2.00_05
# Recurse directories : Yes
# p &#39;Makefile.PL&#39; 998 1082498812 0100751
#### End of ApplyPatch data ####

#### End of Patch kit [created: Wed Apr 21 00:08:24 2004] ####
#### Patch checksum: 81 2277 36133 ####
#### Checksum: 99 2901 22124 ####
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;08&nbsp;17:15:48&nbsp;2004</span>
    <span class="description">VKON [...] cpan.org -  Status changed from &#39;new&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;08&nbsp;17:15:48&nbsp;2004</span>
    <span class="description">VKON [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">[SREZIC - Wed Apr 21 11:43:06 2004]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The attached patch changes the Tcl.pm Makefile.PL to autodetect the
&gt;    latest Tcl library on FreeBSD.
</div>
as long as starting from version 0.81 we drop support for Tcl/Tk elder
than 8.4 &#40;unfortunately&#41;, this means on FreeBSD better will be
&#34;tclsh8.4&#34; taken directly.

Additionally, it looks to me that growing Makefile.PL that much is not
good, your algorithm &#34;file_name_is_absolute&#34; should be discussed, and
better yet just excluded, yet is_in_path should go away because let&#39;s
assume we either have right tclsh in path or right parameters to
Makefile.PL will be given

Thanks for your input.

Best regards,
Vadim.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;09&nbsp;08:11:04&nbsp;2004</span>
    <span class="description">VKON [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;&gt; Additionally, it looks to me that growing Makefile.PL that much is not
&gt;&gt; good,
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">srdvR&gt; Makefile.PL is meant exactly for configuration purposes. It&#39;s some
srdvR&gt; kind of autoconf-generated &#34;configure&#34; usually found in the Unix
srdvR&gt; world.
</div>
IMHO thin module must have small Makefile.PL &#40;and Tcl, Tcl::Tk
supposed to be thin as opposed to perlTk&#41;

The point is - I refer to it to make people know how to build Makefile
for WinCE devices, and it was quite easy before it started to grow,
and all people will think Makefile.PL is huge because of WinCE
complexity.

Actually earlier version had ceMakefile.PL separatedly, I should
return to that.

But must to take care of not installing that ceMakefile.PL on user&#39;s
system,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;&gt; your algorithm &#34;file_name_is_absolute&#34; should be discussed,
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">srdvR&gt; Basically it just calls File::Spec::file_name_is_absolute for current
srdvR&gt; perl versions. But this is not available in older File::Spec versions
srdvR&gt; &#40;e.g. perl 5.00503&#41; and File::Spec is not bundled with perl 5.004 and
srdvR&gt; older, so I usually use the few lines to add a reasonable fallback.
</div>
Surplrisingly, 5.00503 no longer supoprted.
Let us bring module to good shape first, and then will return to
supporting elder things: Tk 8.3, perl-5.005_03 and so on.

Please do not include there own Perl modules!

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;&gt; and
&gt;&gt; better yet just excluded, yet is_in_path should go away because let&#39;s
&gt;&gt; assume we either have right tclsh in path or right parameters to
&gt;&gt; Makefile.PL will be given
</div> 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">srdvR&gt; I am concerned about automatic install from CPAN.pm or CPANPLUS.pm,
srdvR&gt; where passing parameters to Makefile.PL is not easy.
</div>
That&#39;s a good point.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;09&nbsp;08:11:43&nbsp;2004</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;01&nbsp;08:17:23&nbsp;2018</span>
    <span class="description">VKON [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">please see <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/gisle/tcl.pm/commit/658d79354b4b7b8d0b95358ce4429a1ae99d2b17">https://github.com/gisle/tcl.pm/commit/658d79354b4b7b8d0b95358ce4429a1ae99d2b17</a></span> and let me know whether that is okay for freebsd case;

also, is the picture the same for openbsd and netbsd?

thanks!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;01&nbsp;13:29:20&nbsp;2018</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2018-07-01 08:17:23, VKON wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; please see
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/gisle/tcl.pm/commit/658d79354b4b7b8d0b95358ce4429a1ae99d2b17">https://github.com/gisle/tcl.pm/commit/658d79354b4b7b8d0b95358ce4429a1ae99d2b17</a></span>
&gt; and let me know whether that is okay for freebsd case;
</div>
Unfortunately what was valid 14 years ago is not anymore: there&#39;s no &#34;tclsh&#34; binary anymore in my FreeBSD installations. Something like this has to be done to run the Makefile.PL step successfully &#40;rough diff only&#41;:

diff --git a/Makefile.PL b/Makefile.PL
index 6e1a805..22caaa8 100644
--- a/Makefile.PL
+++ b/Makefile.PL
@@ -46,9 +46,10 @@ sub _die &#40;$&#41; {
 my $tclsh_default = &#39;tclsh&#39;;
 
 # for FreeBSD users, according to ticket 6086, try to guess their name for tclsh
-if &#40;$^O eq &#39;freebsd&#39; &#38;&#38; `tclsh /dev/null 2&gt;&#38;1` =~ /named with a version/&#41; {
+if &#40;$^O eq &#39;freebsd&#39;&#41; {
     for my $ver &#40;qw&#40;8.9 8.8 8.7 8.6 8.5 8.4 8.3 8.2 8.1 8.0&#41;&#41; {
-       if &#40;`tclsh$ver /dev/null 2&gt;&#38;1` !~ /named with a version/&#41; {
+       system &#34;which tclsh$ver &gt;/dev/null 2&gt;&#38;1&#34;;
+       if &#40;$? == 0&#41; {
            $tclsh_default = &#34;tclsh$ver&#34;; # ok will use that
            last;
        }


Compilation is also successful, but all tests fail:

PERL_DL_NONLAZY=1 &#34;/usr/perl5.26.1p/bin/perl&#34; &#34;-MExtUtils::Command::MM&#34; &#34;-MTest::Harness&#34; &#34;-e&#34; &#34;undef *Test::Harness::Switches; test_harness&#40;0, &#39;blib/lib&#39;, &#39;blib/arch&#39;&#41;&#34; t/*.t                                                                                               
t/call.t ............. Can&#39;t load &#39;/tmp/tcl.pm/blib/arch/auto/Tcl/Tcl.so&#39; for module Tcl: /tmp/tcl.pm/blib/arch/auto/Tcl/Tcl.so: Undefined symbol &#34;Tcl_Init&#34; at /usr/perl5.26.1p/lib/5.26.1/amd64-freebsd/DynaLoader.pm line 193.                                             
 at t/call.t line 6.                                                                                                                                                                                                                                                          
Compilation failed in require at t/call.t line 6.                                                                                                                                                                                                                             
BEGIN failed--compilation aborted at t/call.t line 6.                                                                                                                                                                                                                         
Undefined subroutine &#38;Tcl::_Finalize called at /tmp/tcl.pm/blib/lib/Tcl.pm line 599.                                                                                                                                                                                          
END failed--call queue aborted at t/call.t line 6.                                                                                                                                                                                                                            
t/call.t ............. Dubious, test returned 22 &#40;wstat 5632, 0x1600&#41;                                                                                                                                                                                                         
No subtests run                                                                                                                                                                                                                                                               
... &#40;etc&#41; ...


Tried with freebsd10.3 + perl 5.26.1 and freebsd1 + perl 5.28.0

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; also, is the picture the same for openbsd and netbsd?
&gt; 
</div>
I don&#39;t know the other BSDs. Probably it&#39;s better to get support from Alceu in the case of OpenBSD.

Regards,
    Slaven
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;02&nbsp;02:42:13&nbsp;2018</span>
    <span class="description">VKON [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">thank you, applied as f7730b9cc63804eece9cdb336261dc06f78bde10

indeed, we&#39;re getting FAILs that you&#39;ve mentioned such as this - <span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpantesters.org/cpan/report/8c0b0318-7d7c-11e8-8f68-9fdccf1570f6">http://www.cpantesters.org/cpan/report/8c0b0318-7d7c-11e8-8f68-9fdccf1570f6</a></span>

again, we&#39;re moving back default on FreeBSD to --usestubs

but this is not cure, because we had similar
&#34;/home/cpansand/.cpan/build/2018062715/Tcl-1.09-0/blib/arch/auto/Tcl/Tcl.so: Undefined symbol &#34;tclStubsPtr&#34; at.....&#34;
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpantesters.org/cpan/report/fe371178-7a54-11e8-8df7-db842dc43508">http://www.cpantesters.org/cpan/report/fe371178-7a54-11e8-8df7-db842dc43508</a></span>

IOW, working on this problem further :&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;14&nbsp;02:43:43&nbsp;2018</span>
    <span class="description">sjaluo [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2018-Jul-02 02:42:13 Mon，VKON wrote：

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; again, we&#39;re moving back default on FreeBSD to --usestubs
&gt; 
&gt; but this is not cure, because we had similar
&gt; &#34;/home/cpansand/.cpan/build/2018062715/Tcl-1.09-
&gt; 0/blib/arch/auto/Tcl/Tcl.so: Undefined symbol &#34;tclStubsPtr&#34; at.....&#34;
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpantesters.org/cpan/report/fe371178-7a54-11e8-8df7-">http://www.cpantesters.org/cpan/report/fe371178-7a54-11e8-8df7-</a></span>
&gt; db842dc43508
</div>
The above Tcl-1.09 problem in link &#34;fe371178-7a54-....&#34; was solved in RT#125701
  
        <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=125701">https://rt.cpan.org/Ticket/Display.html?id=125701</a></span>
    
The FreeBSD problem in Tcl-1.11 is another problem 
&#39;Undefined symbol &#34;Tcl_Init&#34;&#39;, which is basically the same as the one I
encountered in Cygwin &#40;RT#125597&#41;:
  
        <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=125597">https://rt.cpan.org/Ticket/Display.html?id=125597</a></span>

Tcl_Init&#40;&#41; is not a function. Rather, it is a macro. The root cause is that 
tcl8.5/8.6 changed the definition of Tcl_Init&#40;&#41;. Then preprocessor
failed to expand the following line.

        <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/VKON/Tcl-1.11/Tcl.xs#L126">https://metacpan.org/source/VKON/Tcl-1.11/Tcl.xs#L126</a></span>

The definition of Tcl_Init&#40;&#41; is as follows:

        #define Tcl_Init&#40;interp&#41; &#40;tclStubsPtr-&gt;tcl_Init&#40;interp&#41;&#41;    /* 8.5 */
        #define Tcl_Init &#40;tclStubsPtr-&gt;tcl_Init&#41;                    /* 8.4 */
        

It is a general problem if we want to compile Tcl.xs and link it against tclstub8.5 and above. I proposed a patch to force redefine the macro back to tcl8.4 style. Please give
it a try. 
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Tcl-StubMacro.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git a/Tcl.xs b/Tcl.xs
index 65fefab..17b2c68 100755
--- a/Tcl.xs
+++ b/Tcl.xs
@@ -32,6 +32,17 @@
 #include &lt;tcl.h&gt;
 
 #ifdef USE_TCL_STUBS
+
+/* Let Tcl_Init&#40;&#41; stub could be pointed by a function pointer.
+ * Since tcl8.5, Tcl_Init&#40;&#41; is defined as a macro with an argument and
+ * unable to be assigned to a function pointer. We need to redefine it back
+ * to tcl8.4 style  .
+ */
+#ifdef Tcl_Init
+#  undef  Tcl_Init
+#  define Tcl_Init  &#40;tclStubsPtr-&gt;tcl_Init&#41;
+#endif
+
 /*
  * If we use the Tcl stubs mechanism, this provides us Tcl version
  * and direct dll independence, but we must force the loading of
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;14&nbsp;03:54:29&nbsp;2018</span>
    <span class="description">Vadim.Konovalov [...] dell.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #6086] Tcl module on FreeBSD</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 14 Jul 2018 07:53:58 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Tcl [...] rt.cpan.org&#34; &lt;bug-Tcl [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Konovalov, Vadim&#34; &lt;Vadim.Konovalov [...] dell.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks, applied

Will make a fresh release with your patch!

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: SJ Luo via RT [mailto:bug-Tcl@rt.cpan.org] 
Sent: Saturday, July 14, 2018 9:44 AM
Subject: [rt.cpan.org #6086] Tcl module on FreeBSD

       Queue: Tcl
 Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=6086">https://rt.cpan.org/Ticket/Display.html?id=6086</a></span> &gt;

On 2018-Jul-02 02:42:13 Mon，VKON wrote：

<div class="message-stanza open">&gt; again, we&#39;re moving back default on FreeBSD to --usestubs
&gt; 
&gt; but this is not cure, because we had similar
&gt; &#34;/home/cpansand/.cpan/build/2018062715/Tcl-1.09-
&gt; 0/blib/arch/auto/Tcl/Tcl.so: Undefined symbol &#34;tclStubsPtr&#34; at.....&#34;
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpantesters.org/cpan/report/fe371178-7a54-11e8-8df7-">http://www.cpantesters.org/cpan/report/fe371178-7a54-11e8-8df7-</a></span>
&gt; db842dc43508
</div>
The above Tcl-1.09 problem in link &#34;fe371178-7a54-....&#34; was solved in RT#125701
  
        <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=125701">https://rt.cpan.org/Ticket/Display.html?id=125701</a></span>
    
The FreeBSD problem in Tcl-1.11 is another problem &#39;Undefined symbol &#34;Tcl_Init&#34;&#39;, which is basically the same as the one I encountered in Cygwin &#40;RT#125597&#41;:
  
        <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=125597">https://rt.cpan.org/Ticket/Display.html?id=125597</a></span>

Tcl_Init&#40;&#41; is not a function. Rather, it is a macro. The root cause is that
tcl8.5/8.6 changed the definition of Tcl_Init&#40;&#41;. Then preprocessor failed to expand the following line.

        <span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/source/VKON/Tcl-1.11/Tcl.xs#L126">https://metacpan.org/source/VKON/Tcl-1.11/Tcl.xs#L126</a></span>

The definition of Tcl_Init&#40;&#41; is as follows:

        #define Tcl_Init&#40;interp&#41; &#40;tclStubsPtr-&gt;tcl_Init&#40;interp&#41;&#41;    /* 8.5 */
        #define Tcl_Init &#40;tclStubsPtr-&gt;tcl_Init&#41;                    /* 8.4 */
        

It is a general problem if we want to compile Tcl.xs and link it against tclstub8.5 and above. I proposed a patch to force redefine the macro back to tcl8.4 style. Please give it a try. 

</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jul&nbsp;14&nbsp;03:56:03&nbsp;2018</span>
    <span class="description">VKON [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
