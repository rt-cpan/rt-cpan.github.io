<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #74043 for Imager: Can&#39;t get to build with PNG on Windows without strange workaround</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #74043 for Imager: Can&#39;t get to build with PNG on Windows without strange workaround</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Imager/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Imager/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Imager/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Imager/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Imager">Imager CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">74043</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">40/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Imager/Active/">Imager</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
Ralf.Neubauer [...] wido.bv.aok.de

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-16790-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-16791-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;16&nbsp;13:05:07&nbsp;2012</span>
    <span class="description">Ralf.Neubauer [...] wido.bv.aok.de -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Can&#39;t get to build with PNG on Windows without strange workaround</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 16 Jan 2012 19:04:53 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Imager [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Neubauer, Ralf&#34; &lt;Ralf.Neubauer [...] wido.bv.aok.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I am struggling to get PNG support under Windows:

libpng needs zlib. I use the official DLL from
<span class="clickylink"><a target="new" rel="nofollow" href="http://zlib.net/zlib125-dll.zip">http://zlib.net/zlib125-dll.zip</a></span> , which gives me a lib\libzdll.a &#40;via
the recommended &#34;copy lib\zdll.lib lib\libzdll.a&#34;&#41;. Thus i get a
libpng.a, which is only linkable together with libzdll. I.e. if you use
-lpng, you also have to pass -lzdll, or the zlib symbols will be
missing. &#40;Maybe I&#39;m doing something wrong in this step; as I want/have
to build with the compiler perl was built with &#40;MinGW&#41;, I can&#39;t use the
windows build commands distributed with
<span class="clickylink"><a target="new" rel="nofollow" href="http://download.sourceforge.net/libpng/lpng157.zip&#41;">http://download.sourceforge.net/libpng/lpng157.zip&#41;</a></span>.

Normally i would just set IM_LFLAGS=-lzdll, but Imager\Probe.pm totally
ignores the LFLAGS. And Win32 won&#39;t get detected with -lzdll on the
command line, because the IM_LIBPATH is ignored by the Win32 probing
code, apparently. So I resorted to this workaround:

Imager 0.86 and before:
perl -i.bak -pe &#34;$q=&#39;\\&#39;.chr&#40;34&#41;; s/&#40;$q-l\$libbase&#41;&#40;$q&#41;/$1 -lzdll$2/&#34;
lib\Imager\Probe.pm

&#40;Note the difficulties with escaping the &#34; for the CMD shell and for the
perl running under the shell&#41;

Imager 0.87:
perl -i.bak -pe &#34;$q=&#39;\\&#39;.chr&#40;34&#41;;
s/&#40;$q-l\$req-&gt;\{libbase\}&#41;&#40;$q&#41;/\$req-&gt;\{libbase\} eq &#39;png&#39; ? $1 -lzdll$2
: $1$2/; s/&#40;$q-l\$base&#41;&#40;$q&#41;/&#40;$1$2, \$base eq &#39;png&#39; ? &#40;$2-lzdll$2&#41; :
&#40;&#41;&#41;/&#34; lib\Imager\Probe.pm

Note the special casing for png. Do you think this could be made easier?
E.g. with a zoo of per library environment variables like IM_LFLAGS_PNG,
which get evaluated for building and for probing?

Ralf
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;18&nbsp;20:34:40&nbsp;2012</span>
    <span class="description">TONYC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jan 16 13:05:07 2012, Ralf.Neubauer@wido.bv.aok.de wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I am struggling to get PNG support under Windows:
&gt; 
&gt; libpng needs zlib. I use the official DLL from
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://zlib.net/zlib125-dll.zip">http://zlib.net/zlib125-dll.zip</a></span> , which gives me a lib\libzdll.a &#40;via
&gt; the recommended &#34;copy lib\zdll.lib lib\libzdll.a&#34;&#41;. Thus i get a
&gt; libpng.a, which is only linkable together with libzdll. I.e. if you use
&gt; -lpng, you also have to pass -lzdll, or the zlib symbols will be
&gt; missing. &#40;Maybe I&#39;m doing something wrong in this step; as I want/have
&gt; to build with the compiler perl was built with &#40;MinGW&#41;, I can&#39;t use the
&gt; windows build commands distributed with
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://download.sourceforge.net/libpng/lpng157.zip&#41;">http://download.sourceforge.net/libpng/lpng157.zip&#41;</a></span>.
&gt; 
&gt; Normally i would just set IM_LFLAGS=-lzdll, but Imager\Probe.pm totally
&gt; ignores the LFLAGS. And Win32 won&#39;t get detected with -lzdll on the
&gt; command line, because the IM_LIBPATH is ignored by the Win32 probing
&gt; code, apparently. So I resorted to this workaround:
&gt; 
&gt; Imager 0.86 and before:
&gt; perl -i.bak -pe &#34;$q=&#39;\\&#39;.chr&#40;34&#41;; s/&#40;$q-l\$libbase&#41;&#40;$q&#41;/$1 -lzdll$2/&#34;
&gt; lib\Imager\Probe.pm
&gt; 
&gt; &#40;Note the difficulties with escaping the &#34; for the CMD shell and for the
&gt; perl running under the shell&#41;
&gt; 
&gt; Imager 0.87:
&gt; perl -i.bak -pe &#34;$q=&#39;\\&#39;.chr&#40;34&#41;;
&gt; s/&#40;$q-l\$req-&gt;\{libbase\}&#41;&#40;$q&#41;/\$req-&gt;\{libbase\} eq &#39;png&#39; ? $1 -lzdll$2
&gt; : $1$2/; s/&#40;$q-l\$base&#41;&#40;$q&#41;/&#40;$1$2, \$base eq &#39;png&#39; ? &#40;$2-lzdll$2&#41; :
&gt; &#40;&#41;&#41;/&#34; lib\Imager\Probe.pm
&gt; 
&gt; Note the special casing for png. Do you think this could be made easier?
&gt; E.g. with a zoo of per library environment variables like IM_LFLAGS_PNG,
&gt; which get evaluated for building and for probing?
</div>
Sorry I haven&#39;t replied earlier.

I&#39;ll need to think about how to approach this.  

If libpng and libzdll are both DLL I&#39;m kind of surprised that Windows
doesn&#39;t load libz by reference from libpng.dll.

I&#39;ll need to do some testing and experimentation to see how to solve it.

The way I&#39;ve been testing this on Win32 is with the libraries shipped
with Strawberry perl, and only -lpng is supplied to the link process there.

Tony
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;18&nbsp;20:34:40&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;23&nbsp;03:15:48&nbsp;2012</span>
    <span class="description">TONYC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jan 16 13:05:07 2012, Ralf.Neubauer@wido.bv.aok.de wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I am struggling to get PNG support under Windows:
&gt; 
&gt; libpng needs zlib. I use the official DLL from
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://zlib.net/zlib125-dll.zip">http://zlib.net/zlib125-dll.zip</a></span> , which gives me a lib\libzdll.a &#40;via
&gt; the recommended &#34;copy lib\zdll.lib lib\libzdll.a&#34;&#41;. Thus i get a
&gt; libpng.a, which is only linkable together with libzdll. I.e. if you use
&gt; -lpng, you also have to pass -lzdll, or the zlib symbols will be
&gt; missing. &#40;Maybe I&#39;m doing something wrong in this step; as I want/have
&gt; to build with the compiler perl was built with &#40;MinGW&#41;, I can&#39;t use the
&gt; windows build commands distributed with
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://download.sourceforge.net/libpng/lpng157.zip&#41;">http://download.sourceforge.net/libpng/lpng157.zip&#41;</a></span>.
</div>
I&#39;m trying to reproduce your problem - how did you build libpng.a?

Tony
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;23&nbsp;04:13:02&nbsp;2012</span>
    <span class="description">TONYC [...] cpan.org -  Priority changed from &#40;no value&#41; to &#39;40&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;23&nbsp;04:13:02&nbsp;2012</span>
    <span class="description">TONYC [...] cpan.org -  Severity Normal added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Mar&nbsp;05&nbsp;05:05:12&nbsp;2012</span>
    <span class="description">TONYC [...] cpan.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;17&nbsp;04:35:04&nbsp;2012</span>
    <span class="description">Ralf.Neubauer [...] wido.bv.aok.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #74043] Can&#39;t get to build with PNG on Windows without strange workaround </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 17 Apr 2012 10:34:45 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Imager [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Neubauer, Ralf&#34; &lt;Ralf.Neubauer [...] wido.bv.aok.de&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">[...]

for %%p in &#40;MinGW Tk Win32::FileOP File::Slurp Perl::OSType Module::Metadata&#41; do call ppm install %%p

[...]

:makezlib
cd /d %DOWNLOAD%
wget -N <span class="clickylink"><a target="new" rel="nofollow" href="http://zlib.net/zlib-1.2.6.tar.gz">http://zlib.net/zlib-1.2.6.tar.gz</a></span>
cd /d %BUILD%
gzip -cd %DOWNLOAD%\zlib-1.2.6.tar.gz | tar xvf -
cd zlib-1.2.6
perl -i.bak -pe &#34;s/strip/echo/&#34; win32\Makefile.gcc
dmake -f win32\Makefile.gcc
copy *.h %INCLUDE%
copy lib*.a %LIB%
copy *.dll %DLL%

:makepng
cd /d %DOWNLOAD%
wget -N <span class="clickylink"><a target="new" rel="nofollow" href="http://download.sourceforge.net/libpng/lpng159.zip">http://download.sourceforge.net/libpng/lpng159.zip</a></span>
cd /d %BUILD%
unzip %DOWNLOAD%\lpng159.zip
cd lpng159
perl -pe &#34;s/^&#40;ZLIBINC = &#41;.*$s/$1$ENV{INCLUDE}/; s/^&#40;ZLIBLIB = &#41;.*$s/$1$ENV{LIB}/; s/^&#40;RANLIB = &#41;.*$/$1echo/; s/^&#40;EXE = &#41;.*$/$1.exe/;&#34; scripts\makefile.gcc &gt; makefile
dmake
copy *.h %INCLUDE%
copy lib*.a %LIB%

[...]

-- 

Mit freundlichen Grüßen

Ralf Neubauer
Arzneimittelinformationssysteme und Analysen
Wissenschaftliches Institut der AOK &#40;WIdO&#41;
Rosenthaler Straße 31
10178 Berlin
www.wido.de

Tel.:           030-34646-2583
Fax:            030-34646-2144
E-Mail: Ralf.Neubauer@wido.bv.aok.de



<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; -----Original Message-----
&gt; From: TONYC via RT [mailto:bug-Imager@rt.cpan.org]
&gt; Sent: Monday, January 23, 2012 9:16 AM
&gt; To: Neubauer, Ralf
&gt; Subject: [rt.cpan.org #74043] Can&#39;t get to build with PNG on Windows without strange workaround
&gt; 
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=74043">https://rt.cpan.org/Ticket/Display.html?id=74043</a></span> &gt;
&gt; 
&gt; On Mon Jan 16 13:05:07 2012, Ralf.Neubauer@wido.bv.aok.de wrote:
<div class="message-stanza open">&gt; &gt; I am struggling to get PNG support under Windows:
&gt; &gt;
&gt; &gt; libpng needs zlib. I use the official DLL from
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://zlib.net/zlib125-dll.zip">http://zlib.net/zlib125-dll.zip</a></span> , which gives me a lib\libzdll.a &#40;via
&gt; &gt; the recommended &#34;copy lib\zdll.lib lib\libzdll.a&#34;&#41;. Thus i get a
&gt; &gt; libpng.a, which is only linkable together with libzdll. I.e. if you use
&gt; &gt; -lpng, you also have to pass -lzdll, or the zlib symbols will be
&gt; &gt; missing. &#40;Maybe I&#39;m doing something wrong in this step; as I want/have
&gt; &gt; to build with the compiler perl was built with &#40;MinGW&#41;, I can&#39;t use the
&gt; &gt; windows build commands distributed with
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://download.sourceforge.net/libpng/lpng157.zip&#41;">http://download.sourceforge.net/libpng/lpng157.zip&#41;</a></span>.
</div>&gt; 
&gt; I&#39;m trying to reproduce your problem - how did you build libpng.a?
&gt; 
&gt; Tony
</div>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Apr&nbsp;17&nbsp;04:35:05&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;27&nbsp;22:54:26&nbsp;2012</span>
    <span class="description">TONYC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jan 16 13:05:07 2012, Ralf.Neubauer@wido.bv.aok.de wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Note the special casing for png. Do you think this could be made easier?
&gt; E.g. with a zoo of per library environment variables like IM_LFLAGS_PNG,
&gt; which get evaluated for building and for probing?
</div>
Hi Ralf,

I believe I&#39;ve fixed this for the next release of Imager.

I built and installed libz and libpng per your detailed &#40;thank you!&#41;
instructions and reproduced the failure.

I made three basic changes:

- Imager::Probe now does the testcode check as part of accepting a
configuration as good, so if it fails it can go on to test other
alternatives

- the libbase parameter can now be an arrayref, so I can specify that
both libpng and libz are required.

- PNG/Makefile.PL now includes extra configurations that test for libpng
and libz.

If you want to test it out and have a git client, please:

  git clone git://git.imager.perl.org/imager.git
  cd imager
  perl Makefile.PL
  # the summary should show PNG as detected
  dmake test

Thanks for your help with this

Tony
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;27&nbsp;22:54:27&nbsp;2012</span>
    <span class="description">TONYC [...] cpan.org -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;27&nbsp;22:54:50&nbsp;2012</span>
    <span class="description">Ralf.Neubauer [...] wido.bv.aok.de -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Abwesenheitsnotiz: [rt.cpan.org #74043] Can&#39;t get to build with PNG on Windows without strange workaround </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 28 Apr 2012 04:54:38 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;TONYC via RT&#34; &lt;bug-Imager [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Neubauer, Ralf&#34; &lt;Ralf.Neubauer [...] wido.bv.aok.de&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Guten Tag,

vielen Dank für Ihre Nachricht. 

Am 02. Mai bin ich wieder im Hause. Ihre Mail wird nicht weitergeleitet. In dringenden Fällen können Sie sich, wenn es das Projekt ZenDa betrifft, an die ZenDa-Projektadresse &#40;zenda@wido.bv.aok.de&#41; und bei Fragen zum Projekt pharmPRO an die pharmPRO-Projektadresse &#40;pharmpro@wido.bv.aok.de&#41; wenden.

Mit freundlichen Grüßen,
Ralf Neubauer
</div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;27&nbsp;22:54:51&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;patched&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Apr&nbsp;29&nbsp;00:50:53&nbsp;2012</span>
    <span class="description">TONYC [...] cpan.org -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;30&nbsp;09:14:50&nbsp;2012</span>
    <span class="description">TONYC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Apr 27 22:54:26 2012, TONYC wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon Jan 16 13:05:07 2012, Ralf.Neubauer@wido.bv.aok.de wrote:
<div class="message-stanza open">&gt; &gt; Note the special casing for png. Do you think this could be made easier?
&gt; &gt; E.g. with a zoo of per library environment variables like IM_LFLAGS_PNG,
&gt; &gt; which get evaluated for building and for probing?
</div>&gt; 
&gt; Hi Ralf,
&gt; 
&gt; I believe I&#39;ve fixed this for the next release of Imager.
&gt; 
&gt; I built and installed libz and libpng per your detailed &#40;thank you!&#41;
&gt; instructions and reproduced the failure.
&gt; 
&gt; I made three basic changes:
&gt; 
&gt; - Imager::Probe now does the testcode check as part of accepting a
&gt; configuration as good, so if it fails it can go on to test other
&gt; alternatives
&gt; 
&gt; - the libbase parameter can now be an arrayref, so I can specify that
&gt; both libpng and libz are required.
&gt; 
&gt; - PNG/Makefile.PL now includes extra configurations that test for libpng
&gt; and libz.
&gt; 
&gt; If you want to test it out and have a git client, please:
&gt; 
&gt;   git clone git://git.imager.perl.org/imager.git
&gt;   cd imager
&gt;   perl Makefile.PL
&gt;   # the summary should show PNG as detected
&gt;   dmake test
&gt; 
&gt; Thanks for your help with this
</div>
This has been released as Imager 0.90.

Thanks,
Tony
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;30&nbsp;09:14:51&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;patched&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;30&nbsp;09:14:51&nbsp;2012</span>
    <span class="description">TONYC [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
