<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #30380 for Archive-Tar: directory traversal vulnerability in Archive-Tar</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #30380 for Archive-Tar: directory traversal vulnerability in Archive-Tar</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Archive-Tar/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Archive-Tar/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Archive-Tar/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Archive-Tar/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Archive-Tar">Archive-Tar CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">30380</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Archive-Tar/Active/">Archive-Tar</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
anicka [...] suse.cz

<br />
smithj [...] freethemallocs.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-2526-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-2527-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;20&nbsp;13:59:25&nbsp;2007</span>
    <span class="description">anicka [...] suse.cz - Ticket #29517:  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Archive::Tar cannot handle extracted files securely</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 20 Sep 2007 19:59:11 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-archive-tar [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Anicka Bernathova &lt;anicka [...] suse.cz&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello,

this is a feature request more than a bugreport:

Archive::Tar does not take any care for controlling whether the
extracted files leave the current directory or not. It is willing to try
to rewrite any files in the system by extracting archived files with
absolute paths, following any archived symlinks and so on.

This is usually considered a security problem and ie. GNU tar has many
fixes to avoid this behavior. Are you willing to add some switch to
enable a secure way of handling the extracted files in Archive::Tar too?

I will gladly help with implementation, if you find it worth of doing.

Thanks!

-- 
Best Regards,

Anna Bernathova, software developer
---------------------------------------------------------------------
SUSE LINUX, s.r.o.                             e-mail: anicka@suse.cz
Lihovarska 1060/12                             tel: +420 2 9654 2375
190 00 Praha 9                                 fax: +420 2 8309 5374
Czech Republic                                 <span class="clickylink"><a target="new" rel="nofollow" href="http://www.suse.cz">http://www.suse.cz</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;04&nbsp;10:02:40&nbsp;2007</span>
    <span class="description">kane [...] cpan.org - Ticket #29517:  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Anna,

On Thu Sep 20 13:59:25 2007, anicka@suse.cz wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Archive::Tar does not take any care for controlling whether the
&gt; extracted files leave the current directory or not. It is willing to try
&gt; to rewrite any files in the system by extracting archived files with
&gt; absolute paths, following any archived symlinks and so on.
&gt; 
&gt; This is usually considered a security problem and ie. GNU tar has many
&gt; fixes to avoid this behavior. Are you willing to add some switch to
&gt; enable a secure way of handling the extracted files in Archive::Tar too?
&gt; 
&gt; I will gladly help with implementation, if you find it worth of doing.
</div>
Thanks for your suggestion -- you&#39;re indeed correct that A::T doesn&#39;t
do any special handling of files to prevent them from leaving the current
directory.

To add a switch that enables this safety feature sounds like a valuable
feature and one I&#39;m interested in adding. If you have a patch or an idea
on how to approach this, I&#39;m happy to discuss this with you.

Kind regards,

Jos
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;04&nbsp;10:02:52&nbsp;2007</span>
    <span class="description">The RT System itself - Ticket #29517:  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Create even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;30&nbsp;22:44:05&nbsp;2007</span>
    <span class="description">smithj [...] freethemallocs.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> directory traversal vulnerability in Archive-Tar</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 30 Oct 2007 18:37:37 -0800</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Archive-Tar [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jonathan Smith &lt;smithj [...] freethemallocs.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

rPath is tracking an issue from awhile back [1] where perl-Archive-Tar
can be coerced via a specially-crafted tar file to overwrite arbitrary
files on the system, a security issue. I think we missed contacting you
&#40;many programs were affected&#41; but as I&#39;m not familiar with the codebase,
your help in formulating a fix and including that fix in the next
release would be appreciated.

[1]: <span class="clickylink"><a target="new" rel="nofollow" href="https://issues.rpath.com/browse/RPL-1716">https://issues.rpath.com/browse/RPL-1716</a></span>

        smithj

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.7 &#40;GNU/Linux&#41;
Comment: Using GnuPG with Mozilla - <span class="clickylink"><a target="new" rel="nofollow" href="http://enigmail.mozdev.org">http://enigmail.mozdev.org</a></span>

iD8DBQFHJ+m/CG91qXPaRekRAuvEAJ9Xjbc/d+UkEKjlJFkqzhYUc/horQCgjyYm
/GyGdY19g8fg4J0fBheMsOQ=
=QzPL
-----END PGP SIGNATURE-----
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;03&nbsp;13:42:28&nbsp;2007</span>
    <span class="description">kane [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Oct 30 22:44:05 2007, smithj@freethemallocs.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; rPath is tracking an issue from awhile back [1] where perl-Archive-Tar
&gt; can be coerced via a specially-crafted tar file to overwrite arbitrary
&gt; files on the system, a security issue. I think we missed contacting you
&gt; &#40;many programs were affected&#41; but as I&#39;m not familiar with the codebase,
&gt; your help in formulating a fix and including that fix in the next
&gt; release would be appreciated.
</div>
Thanks for bringing this to my attention. A similar report was made a few
weeks ago &#40;but seemingly unrelated to rPath&#41; here:

  <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=29517">https://rt.cpan.org/Ticket/Display.html?id=29517</a></span>

We&#39;ll take this issue under advisement.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;03&nbsp;13:42:31&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;03&nbsp;13:42:46&nbsp;2007</span>
    <span class="description">kane [...] cpan.org - Ticket #29517:  Merged into ticket #30380</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;03&nbsp;13:42:46&nbsp;2007</span>
    <span class="description">kane [...] cpan.org -  Merged into ticket #30380</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;11&nbsp;07:00:58&nbsp;2007</span>
    <span class="description">kane [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Greetings,

On Tue Oct 30 22:44:05 2007, smithj@freethemallocs.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; rPath is tracking an issue from awhile back [1] where perl-Archive-Tar
&gt; can be coerced via a specially-crafted tar file to overwrite arbitrary
&gt; files on the system, a security issue. I think we missed contacting you
&gt; &#40;many programs were affected&#41; but as I&#39;m not familiar with the codebase,
&gt; your help in formulating a fix and including that fix in the next
&gt; release would be appreciated.
&gt; 
&gt; [1]: <span class="clickylink"><a target="new" rel="nofollow" href="https://issues.rpath.com/browse/RPL-1716">https://issues.rpath.com/browse/RPL-1716</a></span>
</div>
I have just uploaded a development version of Archive::Tar [1] to CPAN,
which should address this is issue. It may take a little while untill it has 
propagated around the CPAN mirrors.

Please let me know if this addresses the issue fully, and we&#39;ll release it
as a stable version and merge it back into the perl core.

Thanks again for reporting,

Jos Boumans

[1] <span class="clickylink"><a target="new" rel="nofollow" href="http://search.cpan.org/~kane/Archive-Tar-1.37_01/">http://search.cpan.org/~kane/Archive-Tar-1.37_01/</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;11&nbsp;07:01:12&nbsp;2007</span>
    <span class="description">kane [...] cpan.org -  Status changed from &#39;open&#39; to &#39;stalled&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;21&nbsp;05:07:29&nbsp;2007</span>
    <span class="description">anicka [...] suse.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #30380] directory traversal vulnerability in Archive-Tar</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 21 Nov 2007 11:05:32 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Archive-Tar [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Anna Bernathova &lt;anicka [...] suse.cz&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Please let me know if this addresses the issue fully, and we&#39;ll release it
&gt; as a stable version and merge it back into the perl core.
&gt; 
&gt; Thanks again for reporting,
</div>
Hello,

the problem with absolute paths in filenames and directory traversal
seems to be fixed, many thanks.

But there is one more related, very similar issue, which has not been
addressed yet. If you run:

rm -rf dir &#38;&#38; mkdir dir &#38;&#38; ln -s
.//..//..//..//..//..//..//..//..//..//..//etc dir/subdir &#38;&#38; tar -cf
dir.tar --numeric-owner --owner=0 --group=0 dir/subdir dir/subdir/passwd

and then

use Archive::Tar;
my $tar = Archive::Tar-&gt;new&#40;$ARGV[0]&#41;;
$tar-&gt;extract&#40;&#41;;

on your archive, you will get attempt to rewrite /etc/passwd:

mkdir&#40;&#34;/tmp/wtf/dir&#34;, 0777&#41;             = 0
symlink&#40;&#34;./../../../../../../../../etc&#34;, &#34;/tmp/wtf/dir/subdir&#34;&#41; = 0
...
open&#40;&#34;/tmp/wtf/dir/subdir/passwd&#34;, O_WRONLY|O_CREAT|O_TRUNC, 0666&#41; = -1
EACCES
&#40;Permission denied&#41;

I have played with a possible ways to fix this second issue and it seems
that the only way to fix is to remember all the symlinks you create when
deciding which ones to follow.

Anicka
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Nov&nbsp;21&nbsp;05:07:41&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;stalled&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;22&nbsp;09:27:20&nbsp;2008</span>
    <span class="description">lkundrak [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #30380] directory traversal vulnerability in Archive-Tar</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 22 Feb 2008 15:26:56 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Archive-Tar [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Lubomir Kundrak &lt;lkundrak [...] redhat.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Anicka: Having a file in a tarball, not its parent directory, but a
symlink named as its parent directory is by no means sane and useful. I
would expect attempt extract from such archive to fail with an error
about nonexistent path to the destination file.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I have played with a possible ways to fix this second issue and it seems
&gt; that the only way to fix is to remember all the symlinks you create when
&gt; deciding which ones to follow.
</div>
You know it doesn&#39;t sound well.

Possible resolution is not to follow symlinks while extracting &#40;it&#39;s not
useful, see first paragraph&#41;. That would be done like this:

--- /usr/lib/perl5/vendor_perl/5.8.8/Archive/Tar.pm.orig
2008-02-22 15:22:05.000000000 +0100
+++ /usr/lib/perl5/vendor_perl/5.8.8/Archive/Tar.pm     2008-02-22 15:21:28.000000000 +0100
@@ -595,7 +595,7 @@ sub _extract_file {
 
     if&#40; length $entry-&gt;type &#38;&#38; $entry-&gt;is_file &#41; {
         my $fh = IO::File-&gt;new;
-        $fh-&gt;open&#40; &#39;&gt;&#39; . $full &#41; or &#40;
+        $fh-&gt;open&#40; &#39;&gt;&#39; . $full, O_NOFOLLOW &#41; or &#40;
             $self-&gt;_error&#40; qq[Could not open file &#39;$full&#39;: $!] &#41;,
             return
         &#41;;

Note that the same would need to be done for directories and special
files too.

Currently it&#39;s probably not a good idea, as it would break extraction if
working directory path contained a symlink due to the code below &#40;note
that I haven&#39;t tried that nor read that extensively, I might be wrong&#41;:

 549         my $cwd     = &#40;defined $self-&gt;{cwd} ? $self-&gt;{cwd} : cwd&#40;&#41;&#41;;
 550         my @dirs    = File::Spec::Unix-&gt;splitdir&#40; $dirs &#41;;
 551         my @cwd     = File::Spec-&gt;splitdir&#40; $cwd &#41;;
 552         $dir        = File::Spec-&gt;catdir&#40; @cwd, @dirs &#41;;

Is something wrong with nofollow approach?

-- 
Lubomir Kundrak &#40;Red Hat Security Response Team&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;19&nbsp;09:22:29&nbsp;2008</span>
    <span class="description">msuchy [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> msuchy [...] redhat.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne pá 22.úno.2008 09:27:20, lkundrak@redhat.com napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; +        $fh-&gt;open&#40; &#39;&gt;&#39; . $full, O_NOFOLLOW &#41; or &#40;
</div>..
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Is something wrong with nofollow approach?
</div>
No. But if you use mode &#40;O_NOFOLLOW&#41; in open, then &#39;&gt;&#39; is not
interpreted.  So correct patch should be:

--- Archive-Tar-1.38.orig/lib/Archive/Tar.pm    2007-12-14
13:33:55.000000000 +0100
+++ Archive-Tar-1.38/lib/Archive/Tar.pm 2008-03-18 15:03:55.000000000 +0100
@@ -650,7 +650,7 @@

     if&#40; length $entry-&gt;type &#38;&#38; $entry-&gt;is_file &#41; {
         my $fh = IO::File-&gt;new;
-        $fh-&gt;open&#40; &#39;&gt;&#39; . $full &#41; or &#40;
+        $fh-&gt;open&#40; $full,
O_WRONLY|O_CREAT|O_TRUNC|O_LARGEFILE|O_NOFOLLOW &#41; or &#40;
             $self-&gt;_error&#40; qq[Could not open file &#39;$full&#39;: $!] &#41;,
             return
         &#41;;

Although still remain the &#39;open&#39; on line 255, which create tgz. But I
think it is safe to leave this unchecked, becouse with this you can not
create normal files.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;22&nbsp;12:34:03&nbsp;2008</span>
    <span class="description">kane [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve just uploaded 1.39_01, which should address the second part of this issue.

Unfortunately, O_FOLLOW can&#39;t be used, as it&#39;s not portable, but i&#39;ve implemented a fix on the 
code level with the same intention. From the changes file:

* important changes in version 1.39_01 22/08/2008:
- Address the second part mentioned in this report:
  #30380: directory traversal vulnerability in Archive-Tar
  Archives are no longer allowed to extract into symlinked directories,
  unless Insecure Extract Mode is enabled &#40;which is off by default&#41;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;22&nbsp;12:34:07&nbsp;2008</span>
    <span class="description">kane [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
