<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #21176 for Inline-Java: Undoccumented $@ &#40;eval/die&#41; behaviour.</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #21176 for Inline-Java: Undoccumented $@ &#40;eval/die&#41; behaviour.</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Inline-Java">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Inline-Java">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Inline-Java">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Inline-Java">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Inline-Java">Inline-Java CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">21176</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Inline-Java">Inline-Java</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">patl [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
artem [...] bizlink.ru

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-16926-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.51    </td>
  </tr>
  <tr id="CF-16927-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




testcase.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/235489/98972/testcase.pl">
Fri Aug 25 15:13:39 2006 (371b) by artem [...] bizlink.ru
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=21176">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-235366" href="/Public/Bug/Display.html?id=21176#txn-235366">#</a>      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;25&nbsp;03:16:34&nbsp;2006</span>
    <span class="description">artem [...] bizlink.ru -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Undoccumented $@ &#40;eval/die&#41; behaviour.</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/235366/98905/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/98905">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 977b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Had a chance to use Inline::Java::Handle recently.
First thing: it worked!  : &#41;
But, i&#39;ve spent a lot of time trying to understand, why some of my
errors aren&#39;t propagated. I discovered, that when using
Inline::Java::Handle, the error message - $@ - is cleared when the
handlers are closed. This is disastrous, becouse by default they are
closed automatically upon an exit from the subroutine, and it renders
any exceptions inside the subroutine invisible. This property should be
at least docummented, becouse it is then possible to workaround.

Example code:

sub foo {
  local *STDIN  = new Inline::Java::Handle&#40;$in&#41;;
  local *STDOUT = new Inline::Java::Handle&#40;$out&#41;;
  die &#34;bar&#34;;
}
eval {foo&#40;&#41;;};
report&#40;$@&#41; if $@;

The workaround:

sub foo {
  local *STDIN  = new Inline::Java::Handle&#40;$in&#41;;
  local *STDOUT = new Inline::Java::Handle&#40;$out&#41;;
  eval { die &#34;bar&#34;; };
  my $err = $@;
  close&#40;*STDOUT&#41;;
  close&#40;*STDIN&#41;;
  die $err if $err;
}
eval { foo&#40;&#41;; };
report&#40;$@&#41; if $@;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-235483" href="/Public/Bug/Display.html?id=21176#txn-235483">#</a>      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;25&nbsp;14:35:49&nbsp;2006</span>
    <span class="description">patrick.leboutillier [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #21176] Undoccumented $@ &#40;eval/die&#41; behaviour.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 25 Aug 2006 14:35:34 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Inline-Java [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Patrick LeBoutillier&#34; &lt;patrick.leboutillier [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/235483/98967/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/98967">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

That&#39;s really a bug. Can you help me out in fixing it?

Here is a patch you could try:

Index: Java/Handle.pm
===================================================================
RCS file: /cvsroot/inline-java/Inline-Java/Java/Handle.pm,v
retrieving revision 1.6
diff -r1.6 Handle.pm
118c118,119
&lt;       my $ret = undef  ;
---
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;       my $ret = undef ;
&gt;       local $@ ;
</div>

Cheers,

Patrick



On 8/25/06, artem@bizlink.ru via RT &lt;bug-Inline-Java@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Fri Aug 25 03:16:34 2006: Request 21176 was acted upon.
&gt; Transaction: Ticket created by artem@bizlink.ru
&gt;        Queue: Inline-Java
&gt;      Subject: Undoccumented $@ &#40;eval/die&#41; behaviour.
&gt;    Broken in: 0.51
&gt;     Severity: Important
&gt;        Owner: Nobody
&gt;   Requestors: artem@bizlink.ru
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=21176">http://rt.cpan.org/Ticket/Display.html?id=21176</a></span> &gt;
&gt;
&gt;
&gt; Had a chance to use Inline::Java::Handle recently.
&gt; First thing: it worked!  : &#41;
&gt; But, i&#39;ve spent a lot of time trying to understand, why some of my
&gt; errors aren&#39;t propagated. I discovered, that when using
&gt; Inline::Java::Handle, the error message - $@ - is cleared when the
&gt; handlers are closed. This is disastrous, becouse by default they are
&gt; closed automatically upon an exit from the subroutine, and it renders
&gt; any exceptions inside the subroutine invisible. This property should be
&gt; at least docummented, becouse it is then possible to workaround.
&gt;
&gt; Example code:
&gt;
&gt; sub foo {
&gt;   local *STDIN  = new Inline::Java::Handle&#40;$in&#41;;
&gt;   local *STDOUT = new Inline::Java::Handle&#40;$out&#41;;
&gt;   die &#34;bar&#34;;
&gt; }
&gt; eval {foo&#40;&#41;;};
&gt; report&#40;$@&#41; if $@;
&gt;
&gt; The workaround:
&gt;
&gt; sub foo {
&gt;   local *STDIN  = new Inline::Java::Handle&#40;$in&#41;;
&gt;   local *STDOUT = new Inline::Java::Handle&#40;$out&#41;;
&gt;   eval { die &#34;bar&#34;; };
&gt;   my $err = $@;
&gt;   close&#40;*STDOUT&#41;;
&gt;   close&#40;*STDIN&#41;;
&gt;   die $err if $err;
&gt; }
&gt; eval { foo&#40;&#41;; };
&gt; report&#40;$@&#41; if $@;
&gt;
&gt;
</div>

-- 
=====================
Patrick LeBoutillier
Laval, QuÃ©bec, Canada
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-235484" href="/Public/Bug/Display.html?id=21176#txn-235484">#</a>      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;25&nbsp;14:35:50&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-235489" href="/Public/Bug/Display.html?id=21176#txn-235489">#</a>      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;25&nbsp;15:13:39&nbsp;2006</span>
    <span class="description">artem [...] bizlink.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #21176] Undoccumented $@ &#40;eval/die&#41; behaviour.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 25 Aug 2006 23:13:04 +0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Inline-Java [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Artem Gr &lt;artem [...] bizlink.ru&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/235489/98971/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/98971">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Yeah, it seems to fix the issue.
Testcase attached.

Patrick LeBoutillier via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=21176">http://rt.cpan.org/Ticket/Display.html?id=21176</a></span> &gt;
&gt;
&gt; Hi,
&gt;
&gt; That&#39;s really a bug. Can you help me out in fixing it?
&gt;
&gt; Here is a patch you could try:
&gt;
&gt; Index: Java/Handle.pm
&gt; ===================================================================
&gt; RCS file: /cvsroot/inline-java/Inline-Java/Java/Handle.pm,v
&gt; retrieving revision 1.6
&gt; diff -r1.6 Handle.pm
&gt; 118c118,119
&gt; &lt;       my $ret = undef  ;
&gt; ---
&gt;   
<div class="message-stanza open">&gt;&gt;       my $ret = undef ;
&gt;&gt;       local $@ ;
&gt;&gt;     
</div>&gt;
&gt;
&gt; Cheers,
&gt;
&gt; Patrick
&gt;
&gt;
&gt;
&gt; On 8/25/06, artem@bizlink.ru via RT &lt;bug-Inline-Java@rt.cpan.org&gt; wrote:
&gt;   
<div class="message-stanza open">&gt;&gt; Fri Aug 25 03:16:34 2006: Request 21176 was acted upon.
&gt;&gt; Transaction: Ticket created by artem@bizlink.ru
&gt;&gt;        Queue: Inline-Java
&gt;&gt;      Subject: Undoccumented $@ &#40;eval/die&#41; behaviour.
&gt;&gt;    Broken in: 0.51
&gt;&gt;     Severity: Important
&gt;&gt;        Owner: Nobody
&gt;&gt;   Requestors: artem@bizlink.ru
&gt;&gt;       Status: new
&gt;&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=21176">http://rt.cpan.org/Ticket/Display.html?id=21176</a></span> &gt;
&gt;&gt;
&gt;&gt;
&gt;&gt; Had a chance to use Inline::Java::Handle recently.
&gt;&gt; First thing: it worked!  : &#41;
&gt;&gt; But, i&#39;ve spent a lot of time trying to understand, why some of my
&gt;&gt; errors aren&#39;t propagated. I discovered, that when using
&gt;&gt; Inline::Java::Handle, the error message - $@ - is cleared when the
&gt;&gt; handlers are closed. This is disastrous, becouse by default they are
&gt;&gt; closed automatically upon an exit from the subroutine, and it renders
&gt;&gt; any exceptions inside the subroutine invisible. This property should be
&gt;&gt; at least docummented, becouse it is then possible to workaround.
&gt;&gt;
&gt;&gt; Example code:
&gt;&gt;
&gt;&gt; sub foo {
&gt;&gt;   local *STDIN  = new Inline::Java::Handle&#40;$in&#41;;
&gt;&gt;   local *STDOUT = new Inline::Java::Handle&#40;$out&#41;;
&gt;&gt;   die &#34;bar&#34;;
&gt;&gt; }
&gt;&gt; eval {foo&#40;&#41;;};
&gt;&gt; report&#40;$@&#41; if $@;
&gt;&gt;
&gt;&gt; The workaround:
&gt;&gt;
&gt;&gt; sub foo {
&gt;&gt;   local *STDIN  = new Inline::Java::Handle&#40;$in&#41;;
&gt;&gt;   local *STDOUT = new Inline::Java::Handle&#40;$out&#41;;
&gt;&gt;   eval { die &#34;bar&#34;; };
&gt;&gt;   my $err = $@;
&gt;&gt;   close&#40;*STDOUT&#41;;
&gt;&gt;   close&#40;*STDIN&#41;;
&gt;&gt;   die $err if $err;
&gt;&gt; }
&gt;&gt; eval { foo&#40;&#41;; };
&gt;&gt; report&#40;$@&#41; if $@;
&gt;&gt;
&gt;&gt;
&gt;&gt;     
</div>&gt;
&gt;
&gt;   
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/235489/98972/testcase.pl">Download testcase.pl</a><br />
<span class="downloadcontenttype">text/x-perl 371b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl

use Inline &#40;
	Java =&gt; &#39;
public class Foo {
  public java.io.InputStream foo&#40;&#41; {
    return new java.io.ByteArrayInputStream&#40;&#34;foo&#34;.getBytes&#40;&#41;&#41;;  
  }
}&#39;
&#41;;

sub bar {
	my $foo = new Foo&#40;&#41;;
	local *FH = new Inline::Java::Handle&#40;$foo-&gt;foo&#40;&#41;&#41;;
	die &#34;okay\n&#34;;
}

my $got = eval { bar&#40;&#41;; };
warn&#40;&#41;           if $@;
print &#34;Error!\n&#34; if !$@;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-235491" href="/Public/Bug/Display.html?id=21176#txn-235491">#</a>      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;25&nbsp;15:17:53&nbsp;2006</span>
    <span class="description">artem [...] bizlink.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> artem [...] bizlink.ru</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/235491/98974/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/98974">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 30b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">And thanks for the patch.  : &#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-235502" href="/Public/Bug/Display.html?id=21176#txn-235502">#</a>      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;25&nbsp;15:37:09&nbsp;2006</span>
    <span class="description">patrick.leboutillier [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #21176] Undoccumented $@ &#40;eval/die&#41; behaviour.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 25 Aug 2006 15:36:59 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Inline-Java [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Patrick LeBoutillier&#34; &lt;patrick.leboutillier [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/235502/98979/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/98979">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 438b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 8/25/06, artem@bizlink.ru via RT &lt;bug-Inline-Java@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt;        Queue: Inline-Java
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=21176">http://rt.cpan.org/Ticket/Display.html?id=21176</a></span> &gt;
&gt;
&gt; And thanks for the patch.  : &#41;
&gt;
</div>
No problem. I have also spotted quite a few other places where $@ should
probably be localized. I&#39;ll work on that and include it in the next release.

Patrick


-- 
=====================
Patrick LeBoutillier
Laval, QuÃ©bec, Canada
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people Take odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-242744" href="/Public/Bug/Display.html?id=21176#txn-242744">#</a>      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;20&nbsp;09:00:47&nbsp;2006</span>
    <span class="description">patl [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-242762" href="/Public/Bug/Display.html?id=21176#txn-242762">#</a>      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;20&nbsp;09:05:15&nbsp;2006</span>
    <span class="description">patl [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/242762/103246/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/103246">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 67b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">$@ now localized in whe nused in DESTROY. Will be available in 0.52
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-242764" href="/Public/Bug/Display.html?id=21176#txn-242764">#</a>      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;20&nbsp;09:05:16&nbsp;2006</span>
    <span class="description">patl [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.450786</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
