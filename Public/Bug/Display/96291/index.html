<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #96291 for Inline: t/08taint.t fails on perl 5.20.0</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #96291 for Inline: t/08taint.t fails on perl 5.20.0</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Inline/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Inline/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Inline/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Inline/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/ingydotnet/inline-pm/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/Inline">Inline CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">96291</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Inline/Active/">Inline</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ETJ [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-16878-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.55    </td>
  </tr>
  <tr id="CF-16879-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;06&nbsp;20:50:00&nbsp;2014</span>
    <span class="description">ETJ [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> t/08taint.t fails on perl 5.20.0</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">It says &#40;on my system&#41;: &#34;sh: make: command not found&#34;.

A little instrumentation in the &#34;make&#34; method indicated its $ENV{PATH} was empty, which sort of makes sense as a secure thing to do, but doesn&#39;t seem to offer any obvious place for a workaround.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;06&nbsp;21:34:28&nbsp;2014</span>
    <span class="description">ETJ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Confirmation from #perl on irc.perl.org - it&#39;s a deliberate change in perl 5.20.0. A quick fix would be either to explicitly set $ENV{PATH} to &#39;/bin:/usr/bin&#39;, or skip the test for 5.20.0.

The rationale is that taint mode is rarely used anymore. The following suggestion was made:

&lt;@mst&gt; maybe the best way to fix the test would be to try /bin, /usr/bin, /usr/local/bin
&lt;@mst&gt; and see if the necessary binaries are there
&lt;@mst&gt; and if yes, you can run the test
&lt;@mst&gt; and if no, skip all
&lt;@mst&gt; but still run the test in cases where we can do

I hoped there would be a sensible value available in %Config, but there isn&#39;t.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;06&nbsp;21:41:09&nbsp;2014</span>
    <span class="description">sisyphus1 [...] optusnet.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #96291] t/08taint.t fails on perl 5.20.0</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 7 Jun 2014 11:39:53 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Inline [...] rt.cpan.org&gt;, &lt;inline [...] perl.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &lt;sisyphus1 [...] optusnet.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message----- 
From: Ed J via RT

<div class="message-stanza open">&gt; It says &#40;on my system&#41;: &#34;sh: make: command not found&#34;.
</div>
Yes, this happens on some systems.
The problem has not yet been fixed - see

<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=65703">https://rt.cpan.org/Ticket/Display.html?id=65703</a></span>

for a fuller discussion. I think there are some workarounds mentioned in 
there if you&#39;re actually wanting to run Inline taint-activated.
If you&#39;re not wanting to run Inline with taint turned on, just &#34;force&#34; 
install the module.

Note that this failure simply signifies that you can&#39;t run Inline under 
taint. It doesn&#39;t impact on any other aspects of the module.

Cheers,
Rob
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;06&nbsp;21:41:10&nbsp;2014</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;07&nbsp;03:53:07&nbsp;2014</span>
    <span class="description">sisyphus1 [...] optusnet.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #96291] t/08taint.t fails on perl 5.20.0</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 7 Jun 2014 17:51:56 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Inline [...] rt.cpan.org&gt;, &lt;inline [...] perl.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &lt;sisyphus1 [...] optusnet.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message----- 
From: Ed J via RT

<div class="message-stanza open">&gt; Confirmation from #perl on irc.perl.org - it&#39;s a deliberate change in perl 
&gt; 5.20.0. A quick fix would be either to explicitly set $ENV{PATH} to 
&gt; &#39;/bin:/usr/bin&#39;, or skip the test for 5.20.0.
</div>
Really ? I thought it was purely dependent upon system configuration, and 
completely independent of perl version.
On my Windows 7, Ubuntu 12.04, and Debian Wheezy systems the 08taint.t tests 
pass &#40;for perl-5.20.0 as well as earlier versions of perl&#41;.

<div class="message-stanza open">&gt; I hoped there would be a sensible value available in %Config, but there 
&gt; isn&#39;t.
</div>
I would happily dismantle Inline&#39;s attempted taint handling if:
a&#41; Ingy gives his blessing for that to happen;
&#38;&#38;
b&#41; there&#39;s a consensus that this is the right thing to do.

So far neither has happened.
In the meantime, patches are welcome.

I guess there are other things we could do - eg skip the 08taint.t test 
script if &#40;eg&#41; $ENV{INLINE_NTT} was set. &#40;&#34;NTT&#34; being a mnemonic for &#34;No 
Taint Testing&#34;&#41;.
I&#39;ve no objection to doing that. In fact, I think I might do just that - it 
comes at no cost to those who don&#39;t want to make use of the option.

However, I don&#39;t think I would like to force those tests to be skipped for 
5.20. Someone might not notice that - and then get really annoyed because 
the test suite didn&#39;t disclose to them that taint did not work.

Cheers,
Rob 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;07&nbsp;13:15:45&nbsp;2014</span>
    <span class="description">ej_zg [...] hotmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #96291] t/08taint.t fails on perl 5.20.0</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 7 Jun 2014 18:15:21 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Inline [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Ed .&#34; &lt;ej_zg [...] hotmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Rob,

Per the discussion with mst on #perl &#40;ex pumpkin holder&#41;, I propose &#40;and 
will do if you haven&#39;t already&#41; that at the top of 08taint.t:

1. Check for existence of $ENV{PATH}
2. If not, set to &#39;/bin:/usr/bin&#39;
3. Test in $ENV{PATH} for &#39;make&#39; and $Config{cc}
4. If found, continue; if not, skip &#40;since there&#39;s nothing else reasonable 
to do, and I prefer not to make people force install&#41;

Do you approve of this strategy?

On the systems you tested on, did Configure find &#34;truly secure setuid 
scripts&#34;? Mine said no - I predict that&#39;s why it zeroes the path.

Cheers,
Ed

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message----- 
From: sisyphus1@optusnet.com.au via RT
Sent: Saturday, June 07, 2014 8:53 AM
To: ETJ@cpan.org
Subject: Re: [rt.cpan.org #96291] t/08taint.t fails on perl 5.20.0

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=96291">https://rt.cpan.org/Ticket/Display.html?id=96291</a></span> &gt;

<div class="message-stanza open">-----Original Message----- 
From: Ed J via RT

<div class="message-stanza open">&gt; Confirmation from #perl on irc.perl.org - it&#39;s a deliberate change in perl
&gt; 5.20.0. A quick fix would be either to explicitly set $ENV{PATH} to
&gt; &#39;/bin:/usr/bin&#39;, or skip the test for 5.20.0.
</div>
Really ? I thought it was purely dependent upon system configuration, and
completely independent of perl version.
On my Windows 7, Ubuntu 12.04, and Debian Wheezy systems the 08taint.t tests
pass &#40;for perl-5.20.0 as well as earlier versions of perl&#41;.

<div class="message-stanza open">&gt; I hoped there would be a sensible value available in %Config, but there
&gt; isn&#39;t.
</div>
I would happily dismantle Inline&#39;s attempted taint handling if:
a&#41; Ingy gives his blessing for that to happen;
&#38;&#38;
b&#41; there&#39;s a consensus that this is the right thing to do.

So far neither has happened.
In the meantime, patches are welcome.

I guess there are other things we could do - eg skip the 08taint.t test
script if &#40;eg&#41; $ENV{INLINE_NTT} was set. &#40;&#34;NTT&#34; being a mnemonic for &#34;No
Taint Testing&#34;&#41;.
I&#39;ve no objection to doing that. In fact, I think I might do just that - it
comes at no cost to those who don&#39;t want to make use of the option.

However, I don&#39;t think I would like to force those tests to be skipped for
5.20. Someone might not notice that - and then get really annoyed because
the test suite didn&#39;t disclose to them that taint did not work.

Cheers,
Rob
</div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;08&nbsp;05:09:33&nbsp;2014</span>
    <span class="description">sisyphus1 [...] optusnet.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #96291] t/08taint.t fails on perl 5.20.0</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 8 Jun 2014 19:08:35 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Inline [...] rt.cpan.org&gt;, &lt;inline [...] perl.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &lt;sisyphus1 [...] optusnet.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message----- 
From: Ed . via RT

<div class="message-stanza open">&gt; Per the discussion with mst on #perl &#40;ex pumpkin holder&#41;, I propose &#40;and
&gt; will do if you haven&#39;t already&#41; that at the top of 08taint.t:
&gt; 1. Check for existence of $ENV{PATH}
&gt; 2. If not, set to &#39;/bin:/usr/bin&#39;
&gt; 3. Test in $ENV{PATH} for &#39;make&#39; and $Config{cc}
&gt; 4. If found, continue; if not, skip &#40;since there&#39;s nothing else reasonable
&gt; to do, and I prefer not to make people force install&#41;
</div>
Yes, CPAN.pm and friends are quite deficient in the way they handle test
failures. I don&#39;t like them and avoid them &#40;except for very long dependency
chains&#41; for that and other reasons.
IMO, if there&#39;s a test failure, they should prompt you as to whether the
module should be installed - not just make you re-run the process with
force.
Perhaps there&#39;s already an option for them to do that. If there&#39;s not such
an option, then maybe you should complain to the developers of those
modules.

<div class="message-stanza open">&gt; Do you approve of this strategy?
</div>
Not sure about step 2.
If the test succeeds only because 08taint.t sets $PATH to &#39;/bin:/usr/bin&#39;,
then it has passed because we&#39;ve rigged the test. We have deceived the user
into thinking that taint enabling in Inline works straight out of the box -
which is not the case &#40;as he must first set $PATH appropriately&#41;.

Can we do just steps 3 and 4 ? If we can detect that the 08taint.t test is
bound to fail because &#39;make&#39; and/or $Config{cc} are not going to be found,
then I&#39;ll accept that we skip the test.
If you&#39;ve got a patch that performs that detection and then skips the tests,
send it out and I&#39;ll apply it.

In those cases where 08taint.t is then skipped, we need to bellow out that
&#34;INLINE WILL NOT RUN UNDER -T ON THIS SYSTEM&#34; ... and we probably also need
to alter the documentation.
But I can take care of those aspects.

It&#39;s not really the right thing to do.
I mean, the idea is that if 08taint.t fails then the user should make the
call on whether the module gets installed. With your proposed changes, the
decision to install has already been made for him .... and he doesn&#39;t even
know that his Inline is not capable of running under -T &#40;unless he was
paying close attention to the build output&#41;.
But I&#39;m ready to go with that approach anyway :-&#41;

Alternatively, if you like, I&#39;m now prepared to turn off the 08taint.t by
default, and have it run only if $ENV{INLINE_TT_ON} is set.
That&#39;s not the right thing to do either, but I simply don&#39;t want to continue
having to devote attention to a feature of Inline that no-one uses, and that
should never have been created in the first place.
It has been ongoing for way too long.

Cheers,
Rob 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;08&nbsp;23:59:42&nbsp;2014</span>
    <span class="description">NERDVANA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Jun 06 20:50:00 2014, ETJ wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It says &#40;on my system&#41;: &#34;sh: make: command not found&#34;.
&gt; 
&gt; A little instrumentation in the &#34;make&#34; method indicated its $ENV{PATH}
&gt; was empty, which sort of makes sense as a secure thing to do, but
&gt; doesn&#39;t seem to offer any obvious place for a workaround.
</div>

I&#39;d like to report that I&#39;m having this same problem on EVERY gentoo system I&#39;ve tried, each of varying architecture and updated-ness.  It worked fine on Linux Mint 15 and 16.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;09&nbsp;00:02:51&nbsp;2014</span>
    <span class="description">NERDVANA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Oh, and the perls involved were 5.12.4 and 5.16.3, so it isn&#39;t specific to 5.20
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;09&nbsp;00:15:21&nbsp;2014</span>
    <span class="description">mamod.mehyar [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #96291] t/08taint.t fails on perl 5.20.0</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 9 Jun 2014 07:15:11 +0300</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Inline [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mahmoud Mehyar &lt;mamod.mehyar [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">In my case taint test always fail on all platforms I tried to install on,
ubuntu and freeBSD I don&#39;t remember if that was the same with windows but I
started to use force install every time I update or install Inline as a
habit :&#41;


On Mon, Jun 9, 2014 at 6:59 AM, Michael Conrad via RT &lt;
bug-Inline@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Sun Jun 08 23:59:42 2014: Request 96291 was acted upon.
&gt; Transaction: Correspondence added by NERDVANA
&gt;        Queue: Inline
&gt;      Subject: t/08taint.t fails on perl 5.20.0
&gt;    Broken in: 0.55
&gt;     Severity: &#40;no value&#41;
&gt;        Owner: Nobody
&gt;   Requestors: ETJ@cpan.org
&gt;       Status: open
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=96291">https://rt.cpan.org/Ticket/Display.html?id=96291</a></span> &gt;
&gt;
&gt;
&gt; On Fri Jun 06 20:50:00 2014, ETJ wrote:
<div class="message-stanza open">&gt; &gt; It says &#40;on my system&#41;: &#34;sh: make: command not found&#34;.
&gt; &gt;
&gt; &gt; A little instrumentation in the &#34;make&#34; method indicated its $ENV{PATH}
&gt; &gt; was empty, which sort of makes sense as a secure thing to do, but
&gt; &gt; doesn&#39;t seem to offer any obvious place for a workaround.
</div>&gt;
&gt;
&gt; I&#39;d like to report that I&#39;m having this same problem on EVERY gentoo
&gt; system I&#39;ve tried, each of varying architecture and updated-ness.  It
&gt; worked fine on Linux Mint 15 and 16.
&gt;
</div></div></div>

<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;09&nbsp;01:00:03&nbsp;2014</span>
    <span class="description">NERDVANA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jun 09 00:02:51 2014, NERDVANA wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Oh, and the perls involved were 5.12.4 and 5.16.3, so it isn&#39;t
&gt; specific to 5.20
</div>
I have further discovered that it only happens when I run cpan or cpanm as root.  When I run &#34;make test&#34; manually as a normal user &#40;with the files chown&#39;d to that user&#41; the test passes.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;09&nbsp;11:01:15&nbsp;2014</span>
    <span class="description">sisyphus1 [...] optusnet.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #96291] t/08taint.t fails on perl 5.20.0</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 10 Jun 2014 01:00:17 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Inline [...] rt.cpan.org&gt;, &lt;inline [...] perl.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &lt;sisyphus1 [...] optusnet.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message----- 
From: Mahmoud Mehyar via RT

<div class="message-stanza open">&gt; In my case taint test always fail on all platforms I tried to install on, 
&gt; ubuntu and freeBSD
&gt; I don&#39;t remember if that was the same with windows
</div>
I don&#39;t think I&#39;ve ever seen a report of it having failed on Windows - 
though I suppose it may be possible to set things up on Windows so that the 
failure happens.

<div class="message-stanza open">&gt; but I started to use force install every time I update or install Inline 
&gt; as a habit :&#41;
</div>
That&#39;s probably another reason we should turn off testing of t/08taint.t. 
One day something more important than t/08taint.t might also fail and you 
won&#39;t notice ... and Inline will still be installed anyway. &#40;I guess if it&#39;s 
&#34;something important&#34; you&#39;ll *eventually* discover the failure ;-&#41;

I don&#39;t know of anyone that wants this taint handling fixed so that they can 
actually make use of it. AFAICT people want it fixed only so that they can 
avoid using force when installing Inline with any of the &#34;cpan&#34; tools.

So I think I *will* turn t/08taint.t testing off unless $ENV{INLINE_TT_ON} 
is set ... and see what results/reactions that produces.
I should never have added t/08taint.t in the first place. I should have just 
left the taint handling in its completely broken state. &#40;No-one would  ever 
have known.&#41;

Cheers,
Rob 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;09&nbsp;17:40:39&nbsp;2014</span>
    <span class="description">NERDVANA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jun 09 11:01:15 2014, sisyphus1@optusnet.com.au wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I don&#39;t know of anyone that wants this taint handling fixed so that
&gt; they can
&gt; actually make use of it. AFAICT people want it fixed only so that they
&gt; can
&gt; avoid using force when installing Inline with any of the &#34;cpan&#34; tools.
&gt; 
&gt; So I think I *will* turn t/08taint.t testing off unless
&gt; $ENV{INLINE_TT_ON}
&gt; is set ... and see what results/reactions that produces.
&gt; I should never have added t/08taint.t in the first place. I should
&gt; have just
&gt; left the taint handling in its completely broken state. &#40;No-one would
&gt; ever
&gt; have known.&#41;
&gt; 
&gt; Cheers,
&gt;  Rob
</div>
Sounds fine by me.

But in case anyone ever comes asking for proper handling with taint mode, here&#39;s a quick way to reproduce a system where it fails, using a Gentoo chroot:

  wget <span class="clickylink"><a target="new" rel="nofollow" href="http://distfiles.gentoo.org/releases/amd64/autobuilds/current-stage3-amd64-nomultilib/stage3-amd64-nomultilib-20140529.tar.bz2">http://distfiles.gentoo.org/releases/amd64/autobuilds/current-stage3-amd64-nomultilib/stage3-amd64-nomultilib-20140529.tar.bz2</a></span>
  mkdir gentoo-chroot
  tar -xjf stage3-amd64-nomultilib-20140529.tar.bz2 -C gentoo-chroot
  mount --rbind /dev gentoo-chroot/dev
  mount --bind /proc gentoo-chroot/proc
  cp /etc/resolv.conf gentoo-chroot/etc/
  chroot gentoo-chroot /bin/bash
  source /etc/profile
  sed -ie &#39;s/^#en_US/en_US/&#39; /etc/locale.gen
  locale-gen
  cpan Inline
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;09&nbsp;19:53:53&nbsp;2014</span>
    <span class="description">ETJ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">If no-one else wants to, I&#39;ll do both the test-possible-skipping and a doc update? It would probably be a candidate for a fast new release.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;09&nbsp;22:00:02&nbsp;2014</span>
    <span class="description">sisyphus1 [...] optusnet.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #96291] t/08taint.t fails on perl 5.20.0</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 10 Jun 2014 11:59:24 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Inline [...] rt.cpan.org&gt;, &lt;inline [...] perl.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &lt;sisyphus1 [...] optusnet.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message----- 
From: Ed J via RT

<div class="message-stanza open">&gt; If no-one else wants to, I&#39;ll do both the test-possible-skipping and a doc 
&gt; update?
</div>
Ok - thanks for the offer.
See my response &#40;posted just a few minutes ago&#41; to Reini&#39;s post in this 
thread.

I think, go with your original 4-point plan:

1. Check for existence of $ENV{PATH}
2. If not, set to &#39;/bin:/usr/bin&#39;
3. Test in $ENV{PATH} for &#39;make&#39; and $Config{cc}
4. If found, continue; if not, skip &#40;since there&#39;s nothing else reasonable
to do, and I prefer not to make people force install&#41;

But steps 1 and 2 need to be taken inside Inline.pm &#40;not inside 
t/08taint.t&#41;.
And replace &#39;skip&#39; with &#39;todo&#39; in step 4.

I think there should be no need for any changes to the documentation as a 
result of that ... but feel free to make any documentary changes that you 
see fit.

If you can do that, I think it would be most helpful. &#40;I&#39;m a bit pressed for 
time .... and also don&#39;t have machine that exhibits the problem, for 
testing.&#41;

<div class="message-stanza open">&gt; It would probably be a candidate for a fast new release.
</div>
Yep - early next week I could make a devel release, followed by a new stable 
release a week later, all being well.
&#40;I can always find time to make another release.&#41;

Thanks for pursuing and persisting ;-&#41;

Cheers,
Rob 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jun&nbsp;11&nbsp;05:52:23&nbsp;2014</span>
    <span class="description">ETJ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">RT-Send-CC:</td>
    <td class="message-header-value"> inline [...] perl.org, sisyphus1 [...] optusnet.com.au, mamod.mehyar [...] gmail.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jun 09 01:00:03 2014, NERDVANA wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon Jun 09 00:02:51 2014, NERDVANA wrote:
<div class="message-stanza open">&gt; &gt; Oh, and the perls involved were 5.12.4 and 5.16.3, so it isn&#39;t
&gt; &gt; specific to 5.20
</div>&gt; 
&gt; I have further discovered that it only happens when I run cpan or
&gt; cpanm as root.  When I run &#34;make test&#34; manually as a normal user &#40;with
&gt; the files chown&#39;d to that user&#41; the test passes.
</div>
Reason was the logic in Inline.pm untainting PATH disallows any directories writable by that user - for root, that&#39;s all of them!

Change proposed is visible on github.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;20&nbsp;23:56:25&nbsp;2014</span>
    <span class="description">sisyphus [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Inline-0.55_01 was released a couple of days ago, partly to see how t/08taint.t fares following the latest round of amendments to the Inline code.

I&#39;ve just received the first FAIL report for 0.55_01:
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.cpantesters.org/cpan/report/a3185cf8-f82f-11e3-919b-572b4803b899">http://www.cpantesters.org/cpan/report/a3185cf8-f82f-11e3-919b-572b4803b899</a></span>

The culprit is, of course, C/t/08taint.t.

What to do wrt this ?

If it&#39;s fixable, and we can fix it, then I guess we should do that.
If we can&#39;t fix it, then we need to detect in advance that the failure will occur and either SKIP or TODO the remaining 9 tests.

There&#39;s a couple of issues with taking the TODO route:

1&#41; The script is actually dying before all tests have been run - so I don&#39;t think TODO&#39;ing the remaining tests is going to prevent the script from being reported as a FAIL. &#40;We can probably workaround that by running the remaining tests inside eval{}.&#41;

2&#41; 3 of the tests are warnings_like&#40;&#41; from Test::Warn, and it seems that TODO is ignored for them. That being so, we need to work around that shortcoming, too. &#40;I was unable to find a way to make those 3 tests honor TODO - but that doesn&#39;t necessarily mean it can&#39;t be done.&#41;

However, I think that if there&#39;s no chance of Inline being able to run correctly under -T on a particular system, then we are quite entitled to SKIP those tests on that system.

Thoughts ?

Cheers,
Rob
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;21&nbsp;18:47:52&nbsp;2014</span>
    <span class="description">ETJ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The failure is because on that test system, input PATH:

/srv/smoker/bin:/usr/lib/ccache:/srv/smoker/perl5/perlbrew/bin:/srv/smoker/perl5/perlbrew/perls/perl-5.20.0/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games

is being stripped down to this:

/srv/smoker/bin:/usr/lib/ccache:/srv/smoker/perl5/perlbrew/bin:/srv/smoker/perl5/perlbrew/perls/perl-5.20.0/bin:/usr/bin:/usr/games

These were removed:

/usr/local/bin /bin /usr/local/games

The untainting code, on non-Windows &#40;this system is Linux&#41; removes directories from PATH if they are NOT: absolute, directories, and neither group- nor world- writable.

The &#34;problem&#34; here is that the relevant system has configured /bin to be either group- or world-writable. It therefore gets removed, so chmod &#40;which typically lives in /bin&#41; is unavailable.

The issue we face here is that tainting is designed to deal with two different situations: CGIs, and suid scripts on multi-user systems.

A. For CGIs, there is no point in stripping the PATH, because the entire content of the system is under the control of the admin, and the only threat is web-user input.

B. For suid scripts on multi-user systems, there IS a point to stripping the PATH, because a malicious user could provide a PATH where e.g. a chmod command under their control would be found before the &#34;real&#34; one. However, the &#34;correct&#34; value to set PATH to is probably not by stripping some values out, but by setting it to a known value, eg &#34;/bin:/usr/bin:/usr/local/bin&#34;. This might be problematic because that will not always be the correct value for a given system, and would therefore need to be configured on installation, which is not a road Inline has yet needed to go down.

I believe there are two decent ways forward here:
1. document that Inline does not build when used in taint mode &#40;although it can still safely run code&#41; and make it be a fatal error to try to do so;
2. update the PATH-untainting code to being nearly what it was before I changed it, but instead of &#34;-w $_ || -W $_&#34;, which I believe was a mistake, since it means &#34;writable by either effective or real uid&#34;, make it &#34;-W $_&#34; - &#34;writable by real uid&#34;.

I advocate method 2, since it deals effectively with situations A and B &#40;including the real threat in B&#41;, and will almost certainly pass on the system that failed the test. The following patch implements it, and all the tests still pass on my Linux system:

diff --git a/Inline.pm b/Inline.pm
index 32868a3..5fced1c 100644
--- a/Inline.pm
+++ b/Inline.pm
@@ -1075,7 +1075,7 @@ sub env_untaint {
                  join &#39;;&#39;, grep {not /^\./ and -d $_
                                  } split /;/, $ENV{PATH}
                  :
-                 join &#39;:&#39;, grep {/^\// and -d $_ and not &#40;&#40;stat&#40;$_&#41;&#41;[2] &#38; 0022&#41;
+                 join &#39;:&#39;, grep {/^\// and -d $_ and not -W $_
                                   } split /:/, $ENV{PATH};
 
     map {&#40;$_&#41; = /&#40;.*&#41;/} @INC;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;21&nbsp;19:22:11&nbsp;2014</span>
    <span class="description">ETJ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On further reflection, the previous logic and patch is slightly imperfect; a malicious user could include a directory under their control, put in a &#34;chmod&#34; command, then deny themselves write permission, and the directory would still be permitted. Instead, this patch, which replaces the previous one, will strip out directories either writable OR owned by the real uid:

diff --git a/Inline.pm b/Inline.pm
index 32868a3..3b62337 100644
--- a/Inline.pm
+++ b/Inline.pm
@@ -1075,7 +1075,7 @@ sub env_untaint {
                  join &#39;;&#39;, grep {not /^\./ and -d $_
                                  } split /;/, $ENV{PATH}
                  :
-                 join &#39;:&#39;, grep {/^\// and -d $_ and not &#40;&#40;stat&#40;$_&#41;&#41;[2] &#38; 0022&#41;
+                 join &#39;:&#39;, grep {/^\// and -d $_ and not &#40;-W $_ or -O $_&#41;
                                   } split /:/, $ENV{PATH};
 
     map {&#40;$_&#41; = /&#40;.*&#41;/} @INC;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;21&nbsp;22:28:50&nbsp;2014</span>
    <span class="description">ETJ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On further further reflection, the previous logic is bound to give false positives when running as root, which means installing as root using CPAN &#40;a reasonable thing to do&#41; will fail tests, which is where we came in. Instead, this patch &#40;replacing previous two&#41; actually tests $&lt; != $&gt;, which revealed a couple of quirks, hence a couple of extra changes:

diff --git a/C/t/08taint.t b/C/t/08taint.t
index 9effb6f..357b551 100644
--- a/C/t/08taint.t
+++ b/C/t/08taint.t
@@ -21,13 +21,15 @@ BEGIN {
 use warnings;
 use strict;
 use Test::More tests =&gt; 10;
-
 use Test::Warn;
 
 # Suppress &#34;Set up gcc environment ...&#34; warning.
 # &#40;Affects ActivePerl only.&#41;
 $ENV{ACTIVEPERL_CONFIG_SILENT} = 1;
 
+# deal with running as root - actually simulate running as setuid program
+$&lt; = 1; # ignore failure
+
 my $w1 = &#39;Blindly untainting tainted fields in %ENV&#39;;
 my $w2 = &#39;Blindly untainting Inline configuration file information&#39;;
 my $w3 = &#39;Blindly untainting tainted fields in Inline object&#39;;
diff --git a/Inline.pm b/Inline.pm
index 32868a3..83f7035 100644
--- a/Inline.pm
+++ b/Inline.pm
@@ -846,6 +846,8 @@ sub create_config_file {
                next;
            }
            next if $mod =~ /^&#40;MakeMaker|denter|messages&#41;$/;
+           # @INC is made safe by -T disallowing PERL5LIB et al
+           &#40;$mod&#41; = $mod =~ /&#40;.*&#41;/;
            eval &#34;require Inline::$mod;&#34;;
             warn&#40;$@&#41;, next if $@;
            eval &#34;\$register=&#38;Inline::${mod}::register&#34;;
@@ -1075,11 +1077,16 @@ sub env_untaint {
                  join &#39;;&#39;, grep {not /^\./ and -d $_
                                  } split /;/, $ENV{PATH}
                  :
-                 join &#39;:&#39;, grep {/^\// and -d $_ and not &#40;&#40;stat&#40;$_&#41;&#41;[2] &#38; 0022&#41;
+                 join &#39;:&#39;, grep {/^\// and -d $_ and $&lt; == $&gt; ? 1 : not &#40;-W $_ or -O $_&#41;
                                   } split /:/, $ENV{PATH};
 
     map {&#40;$_&#41; = /&#40;.*&#41;/} @INC;
 
+    # list cherry-picked from `perldoc perlrun`
+    delete @ENV{qw&#40;PERL5OPT PERL5SHELL PERL_ROOT IFS CDPATH ENV BASH_ENV&#41;};
+    $ENV{SHELL} = &#39;/bin/sh&#39; if -x &#39;/bin/sh&#39;;
+
+    $&lt; = $&gt; if $&lt; != $&gt;; # so child processes retain euid - ignore failure
 }
 #==============================================================================
 # Blindly untaint tainted fields in Inline object.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;22&nbsp;07:05:25&nbsp;2014</span>
    <span class="description">sisyphus [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Jun 21 22:28:50 2014, ETJ wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Instead, this patch &#40;replacing previous two&#41; actually
&gt; tests $&lt; != $&gt;, which revealed a couple of quirks, hence a couple of
&gt; extra changes:
</div>
Thanks Ed - checks out ok here, so I&#39;ve applied the patches and released Inline-0.55_02.

On Windows both $&lt; and $&gt; are 0 and cannot be altered as seteuid&#40;&#41; and setruid&#40;&#41; are not implemented.
In C/t/08taint.t I therefore had to make the setting of $&lt; to 1 conditional upon OS not being Windows &#40;to avoid fatal error on that OS&#41;.

With that in place, everything tests fine for me on Windows, Cygwin, Ubuntu and Debian Wheezy.
Now we sit back and see what the smokers/testers throw at us :-&#41;

Cheers,
Rob
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;24&nbsp;05:01:44&nbsp;2014</span>
    <span class="description">sisyphus [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
Fixed as of 0.55_02
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;24&nbsp;05:01:46&nbsp;2014</span>
    <span class="description">sisyphus [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
