<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #91309 for MailTools: Mail::Header-&gt;unfold and -&gt;fold don&#39;t work</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #91309 for MailTools: Mail::Header-&gt;unfold and -&gt;fold don&#39;t work</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=MailTools">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=MailTools">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=MailTools">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=MailTools">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/MailTools">MailTools CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">91309</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=MailTools">MailTools</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
dolmen [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-20244-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
2.12    </td>
  </tr>
  <tr id="CF-20245-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




unfold-fold-2.12-failure.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1300455/688981/unfold-fold-2.12-failure.pl">
Tue Dec 10 16:00:48 2013 (834b) by dolmen [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=91309">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1300455" href="/Public/Bug/Display.html?id=91309#txn-1300455">#</a>      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;10&nbsp;16:00:48&nbsp;2013</span>
    <span class="description">dolmen [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Mail::Header-&gt;unfold and -&gt;fold don&#39;t work</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1300455/688980/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/688980">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 326b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Two issues:
- Mail::Header-&gt;unfold keeps the spaces instead of removing them.
- Mail::Header-&gt;fold&#40;72&#41; seems to do nothing at all, at least in my test case where the header value contains no spaces.

See the testcase &#40;using Test::More&#41; attached to fully reproduce the issue.

-- 
Olivier Mengué - <span class="clickylink"><a target="new" rel="nofollow" href="http://perlresume.org/DOLMEN">http://perlresume.org/DOLMEN</a></span>
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> unfold-fold-2.12-failure.pl</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1300455/688981/unfold-fold-2.12-failure.pl">Download unfold-fold-2.12-failure.pl</a><br />
<span class="downloadcontenttype">text/x-perl 834b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!perl

use Test::More 0.98;
use Mail::Header;

my $input = &lt;&lt;&#39;EOF&#39;;
Import-Package: fr.bytel.mf.device;version=&#34;3.2&#34;,fr.bytel.mf.smartobject
 ;version=&#34;3.2&#34;,fr.bytel.mf.util;version=&#34;3.2&#34;,javax.net.ssl;resolution:
 =optional,org.osgi.framework;version=&#34;1.3.0&#34;,org.osgi.service.event;ver
 sion=&#34;1.1.0&#34;,org.osgi.util.tracker;version=&#34;[1.3,2&#41;&#34;
EOF

open my $in, &#39;&lt;&#39;, \$input or die;
my $head = Mail::Header-&gt;new&#40;$in, FoldLength =&gt; 72&#41;;
close $in;

$head-&gt;unfold;

my $imppkg = $head-&gt;get&#40;&#39;Import-Package&#39;&#41;;

#note $imppkg;

unlike&#40;$imppkg, qr/ /, &#34;no spaces!&#34;&#41;;

# Fix it
$imppkg =~ s/ //g;
$head-&gt;replace&#40;&#39;Import-Package&#39;, $imppkg&#41;;

# Fold back
$head-&gt;fold&#40;72&#41;;

my $output = $head-&gt;as_string;

like&#40;$input, qr/\n /s, &#39;input is folded!&#39;&#41;; # Just to check our regexp works
like&#40;$output, qr/\n /s, &#39;output is folded!&#39;&#41;;

done_testing;

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1300502" href="/Public/Bug/Display.html?id=91309#txn-1300502">#</a>      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;10&nbsp;16:58:58&nbsp;2013</span>
    <span class="description">secretaris [...] nluug.nl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #91309] Mail::Header-&gt;unfold and -&gt;fold don&#39;t work</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 10 Dec 2013 22:58:41 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Olivier Mengué via RT &lt;bug-MailTools [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;secretaris [...] nluug.nl&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1300502/689015/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/689015">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Olivier Mengué via RT &#40;bug-MailTools@rt.cpan.org&#41; [131210 21:00]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Tue Dec 10 16:00:48 2013: Request 91309 was acted upon.
&gt; Transaction: Ticket created by DOLMEN
&gt; 
&gt; Two issues:
&gt; - Mail::Header-&gt;unfold keeps the spaces instead of removing them.
</div>
It keeps 1 space.  That&#39;s because the implementation is wrong &#40;but
kept that way for backwards compatibility.  The replacement rule is

        {   $$ln =~ s/\r?\n\s+/ /sog
                if defined $ln &#38;&#38; defined $$ln;
        }

The correct implementation would be

        {   $$ln =~ s/\r?\n\s//sog
                if defined $ln &#38;&#38; defined $$ln;
        }

It think it will work for you with

        {   $$ln =~ s/\r?\n\s&#40;\s*&#41;/length $1 ? &#39; &#39; : &#39;&#39;/soge
                if defined $ln &#38;&#38; defined $$ln;
        }

What do you think?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; - Mail::Header-&gt;fold&#40;72&#41; seems to do nothing at all, at least in
&gt;    my test case where the header value contains no spaces.
</div>
Folding is a complex algorithm... it prefers to break lines on blanks.
-- 
Regards,

               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
drs Mark A.C.J. Overmeer                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1300503" href="/Public/Bug/Display.html?id=91309#txn-1300503">#</a>      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;10&nbsp;16:58:58&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1301606" href="/Public/Bug/Display.html?id=91309#txn-1301606">#</a>      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;13&nbsp;09:34:31&nbsp;2013</span>
    <span class="description">dolmen [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1301606/689627/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/689627">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Le 2013-12-10 22:58:58, secretaris@nluug.nl a écrit :
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; * Olivier Mengué via RT &#40;bug-MailTools@rt.cpan.org&#41; [131210 21:00]:
<div class="message-stanza open">&gt; &gt; Tue Dec 10 16:00:48 2013: Request 91309 was acted upon.
&gt; &gt; Transaction: Ticket created by DOLMEN
&gt; &gt; 
&gt; &gt; Two issues:
&gt; &gt; - Mail::Header-&gt;unfold keeps the spaces instead of removing them.
</div>&gt; 
&gt; It keeps 1 space.  That&#39;s because the implementation is wrong &#40;but
&gt; kept that way for backwards compatibility.  The replacement rule is
&gt; 
&gt;         {   $$ln =~ s/\r?\n\s+/ /sog
&gt;                 if defined $ln &#38;&#38; defined $$ln;
&gt;         }
&gt; 
&gt; The correct implementation would be
&gt; 
&gt;         {   $$ln =~ s/\r?\n\s//sog
&gt;                 if defined $ln &#38;&#38; defined $$ln;
&gt;         }
&gt; 
&gt; It think it will work for you with
&gt; 
&gt;         {   $$ln =~ s/\r?\n\s&#40;\s*&#41;/length $1 ? &#39; &#39; : &#39;&#39;/soge
&gt;                 if defined $ln &#38;&#38; defined $$ln;
&gt;         }
&gt; 
&gt; What do you think?
&gt; 
<div class="message-stanza open">&gt; &gt; - Mail::Header-&gt;fold&#40;72&#41; seems to do nothing at all, at least in
&gt; &gt;    my test case where the header value contains no spaces.
</div>&gt; 
&gt; Folding is a complex algorithm... it prefers to break lines on blanks.
</div>
That would be wrong. What if the first character of the content on the line is effectively a space? &#34;\s*&#34; would delete it instead of keeping it.

Besides that, using \s is wrong because \s is more than just space and tab &#40;and is tab allowed?&#41;. If only spaces is allowed [ ] must be used. If tab too, [ \t].

-- 
Olivier Mengué - <span class="clickylink"><a target="new" rel="nofollow" href="http://perlresume.org/DOLMEN">http://perlresume.org/DOLMEN</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1301610" href="/Public/Bug/Display.html?id=91309#txn-1301610">#</a>      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;13&nbsp;09:41:06&nbsp;2013</span>
    <span class="description">dolmen [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1301610/689629/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/689629">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 552b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Le 2013-12-10 22:58:58, secretaris@nluug.nl a écrit :

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Folding is a complex algorithm... it prefers to break lines on blanks.
</div>
Folding in mail headers is an algorithm for computers, not for humans. For old computers with old implementations that had short line buffers of less than 80 characters. If the folding doesn&#39;t work for that case when the header value has no space, what is it useful for?

A folding implementation that does not fold is even worst that if the API user is not calling it.

-- 
Olivier Mengué - <span class="clickylink"><a target="new" rel="nofollow" href="http://perlresume.org/DOLMEN">http://perlresume.org/DOLMEN</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1301612" href="/Public/Bug/Display.html?id=91309#txn-1301612">#</a>      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;13&nbsp;09:42:25&nbsp;2013</span>
    <span class="description">solutions [...] overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #91309] Mail::Header-&gt;unfold and -&gt;fold don&#39;t work</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 13 Dec 2013 15:42:06 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Olivier Mengué via RT &lt;bug-MailTools [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;solutions [...] overmeer.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1301612/689631/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/689631">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Olivier Mengué via RT &#40;bug-MailTools@rt.cpan.org&#41; [131213 14:34]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: MailTools
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=91309">https://rt.cpan.org/Ticket/Display.html?id=91309</a></span> &gt;
<div class="message-stanza open">&gt; &gt; The correct implementation would be
&gt; &gt; 
&gt; &gt;         {   $$ln =~ s/\r?\n\s//sog
&gt; &gt;                 if defined $ln &#38;&#38; defined $$ln;
&gt; &gt;         }
&gt; &gt; 
&gt; &gt; It think it will work for you with
&gt; &gt; 
&gt; &gt;         {   $$ln =~ s/\r?\n\s&#40;\s*&#41;/length $1 ? &#39; &#39; : &#39;&#39;/soge
&gt; &gt;                 if defined $ln &#38;&#38; defined $$ln;
&gt; &gt;         }
&gt; &gt; 
&gt; &gt; What do you think?
&gt; &gt; 
<div class="message-stanza open">&gt; &gt; &gt; - Mail::Header-&gt;fold&#40;72&#41; seems to do nothing at all, at least in
&gt; &gt; &gt;    my test case where the header value contains no spaces.
</div>&gt; &gt; 
&gt; &gt; Folding is a complex algorithm... it prefers to break lines on blanks.
</div>&gt; 
&gt; That would be wrong. What if the first character of the content on the
&gt; line is effectively a space? &#34;\s*&#34; would delete it instead of keeping it.
</div>
The folding pattern is &#34;\r\n&lt;space&gt;&#34;, but I am sure that many applications
use &lt;tab&gt; instead of &lt;space&gt;.  That first blank of the line needs to be
removed.  But to stay backwards compatible, I have to replace all leading
blanks.  I think the intermediate solution, which fixes the unfold where
the header is correct, but does not break it when it is incorrect, is
best.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Besides that, using \s is wrong because \s is more than just space
&gt; and tab &#40;and is tab allowed?&#41;. If only spaces is allowed [ ] must be
&gt; used. If tab too, [ \t].
</div>
Maybe better, yes.
------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1301615" href="/Public/Bug/Display.html?id=91309#txn-1301615">#</a>      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;13&nbsp;09:49:47&nbsp;2013</span>
    <span class="description">solutions [...] overmeer.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #91309] Mail::Header-&gt;unfold and -&gt;fold don&#39;t work</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 13 Dec 2013 15:49:32 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Olivier Mengué via RT &lt;bug-MailTools [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mark Overmeer &lt;solutions [...] overmeer.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1301615/689634/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/689634">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">* Olivier Mengué via RT &#40;bug-MailTools@rt.cpan.org&#41; [131213 14:41]:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: MailTools
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=91309">https://rt.cpan.org/Ticket/Display.html?id=91309</a></span> &gt;
&gt; 
&gt; Le 2013-12-10 22:58:58, secretaris@nluug.nl a écrit :
&gt; 
<div class="message-stanza open">&gt; &gt; Folding is a complex algorithm... it prefers to break lines on blanks.
</div>&gt; 
&gt; A folding implementation that does not fold is even worst that if the
&gt; API user is not calling it.
</div>
It does fold.  Read the code.  Just not as you expect.  The parameter
is a guideline, not fixed maximum length.  Besides, folding is always
optional, until your lines get longer than 992 characters.

MailTools first got released as one of the first modules to CPAN in 1995.
The code is in many books, and that is the only reason that I maintain
it: it is not good code, but has a huge number of users who can live
with its current condition and mistakes.  I will keep it working, but
not break backwards compatibility.

There are many better email libraries on CPAN.  For instance, my own
MailBox.  Much newer: started in 2000 ;-&#41;  Strictly follows all RFCs.
-- 
Regards,
               MarkOv

------------------------------------------------------------------------
       Mark Overmeer MSc                                MARKOV Solutions
       Mark@Overmeer.net                          solutions@overmeer.net
<span class="clickylink"><a target="new" rel="nofollow" href="http://Mark.Overmeer.net">http://Mark.Overmeer.net</a></span>                   <span class="clickylink"><a target="new" rel="nofollow" href="http://solutions.overmeer.net">http://solutions.overmeer.net</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1419668" href="/Public/Bug/Display.html?id=91309#txn-1419668">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;10&nbsp;14:20:02&nbsp;2014</span>
    <span class="description">MARKOV [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1419668/753786/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/753786">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 9b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">not taken
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1419670" href="/Public/Bug/Display.html?id=91309#txn-1419670">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;10&nbsp;14:20:03&nbsp;2014</span>
    <span class="description">MARKOV [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.567888</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
