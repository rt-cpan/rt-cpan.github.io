<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #71138 for Spreadsheet-ParseExcel-Stream: Cells alignment in row array may break if null presents</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #71138 for Spreadsheet-ParseExcel-Stream: Cells alignment in row array may break if null presents</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Spreadsheet-ParseExcel-Stream/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Spreadsheet-ParseExcel-Stream/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Spreadsheet-ParseExcel-Stream/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Spreadsheet-ParseExcel-Stream/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Spreadsheet-ParseExcel-Stream">Spreadsheet-ParseExcel-Stream CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">71138</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Spreadsheet-ParseExcel-Stream/Active/">Spreadsheet-ParseExcel-Stream</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
SHYOKOU [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-239666-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.01    </td>
  </tr>
  <tr id="CF-239667-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.02    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;22&nbsp;05:24:22&nbsp;2011</span>
    <span class="description">SHYOKOU [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Cells alignment in row array may break if null presents</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">In order to reduce memory usage, the upstream Spreadsheet::ParseExcel 
parser calls the cell handler call-back only when the cell has 
something. Thus both leading and in-between nulls may interfer the 
alignment of cells in the outcome row array, if the positions of cells 
are ignored. An example following:
 
original sheet w/ null          properly aligned array          array 
w/o alignment
 
|A1|B1|C1|D1|E1|F1|G1|H1|       {A1|B1|C1|D1|E1|F1|G1|H1}
        {A1|B1|C1|D1|E1|F1|G1|H1}
|  |  |C2|D2|E2|F2|G2|H2|       {||C2|D2|E2|F2|G2|H2}   
        {C2|D2|E2|F2|G2|H2}
|  |  |  |  |E3|F3|G3|H3|       {||||E3|F3|G3|H3}       
        {E3|F3|G3|H3}
|  |  |  |  |  |  |G4|H4|       {||||||G4|H4}                   {G4|H4}
 
|  |B1|C1|D1|E1|F1|G1|H1|       {B1|C1|D1|E1|F1|G1|H1}  
        {B1|C1|D1|E1|F1|G1|H1}
|  |  |  |D2|E2|F2|G2|H2|       {||D2|E2|F2|G2|H2}      
        {D2|E2|F2|G2|H2}
|  |  |  |  |  |F3|G3|H3|       {||||F3|G3|H3}          
        {F3|G3|H3}
|  |  |  |  |  |  |  |H4|       {||||||H4}                      {H4}
 
|  |B1|C1|D1|E1|F1|G1|H1|       {|B1|C1|D1|E1|F1|G1|H1} 
        {B1|C1|D1|E1|F1|G1|H1}
|  |  |  |D2|E2|F2|G2|H2|       {|||D2|E2|F2|G2|H2}     
        {D2|E2|F2|G2|H2}
|A3|B3|  |  |  |F3|G3|H3|       {A3|B3||||F3|G3|H3}     
        {A3|B3|F3|G3|H3}
|A4|B4|C4|D4|  |  |  |H4|       {A4|B4|C4|D4||||H4}     
        {A4|B4|C4|D4|H4}
 
The attached diff file tries to reuse the position of cell to build the 
row array.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Stream.pm.diff</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- Stream.pm	2011-07-30 03:06:14.000000000 +0800
+++ Stream.pm	2011-07-30 03:06:14.000000000 +0800
@@ -92,13 +92,22 @@
   my $f = $self-&gt;{SUB};
 
   # Initialize row with first cell
+=begin	comment	may_misplace
   my @row = &#40;$curr_cell&#41;;
+=end	comment	may_misplace
+=cut
+  my @row = &#40;&#41;;
+  $row[ $curr_cell-&gt;[3] - &#40; $curr_cell-&gt;[0] -&gt; worksheet&#40; $curr_cell-&gt;[1] &#41; -&gt; col_range &#41;[0] ] = $curr_cell;
   my $nxt_cell = $f-&gt;&#40;&#41;;
 
   # Collect current row on current worksheet
   while &#40; $nxt_cell &#38;&#38; $nxt_cell-&gt;[1] == $curr_cell-&gt;[1] &#38;&#38; $nxt_cell-&gt;[2] == $curr_cell-&gt;[2] &#41; {
     $curr_cell = $nxt_cell;
+=begin	comment	may_misplace
     push @row, $curr_cell;
+=end	comment	may_misplace
+=cut
+    $row[ $curr_cell-&gt;[3] - &#40; $curr_cell-&gt;[0] -&gt; worksheet&#40; $curr_cell-&gt;[1] &#41; -&gt; col_range &#41;[0] ] = $curr_cell;
     $nxt_cell = $f-&gt;&#40;&#41;;
   }
   $self-&gt;{NEXT_CELL} = $nxt_cell;
@@ -112,7 +121,11 @@
     my $row = $self-&gt;next_row&#40;&#41;;
     return unless $row;
   }
+=begin	comment	may_mistreat
   return [ map { $_-&gt;[4]-&gt;value&#40;&#41; } @{$self-&gt;{CURR_ROW}} ];
+=end	comment	may_mistreat
+=cut
+  return [ map { defined $_ ? $_-&gt;[4]-&gt;value&#40;&#41; : $_ } @{$self-&gt;{CURR_ROW}} ];
 }
 
 sub row_unformatted {
@@ -121,7 +134,11 @@
     my $row = $self-&gt;next_row&#40;&#41;;
     return unless $row;
   }
+=begin	comment	may_mistreat
   return [ map { $_-&gt;[4]-&gt;unformatted&#40;&#41; } @{$self-&gt;{CURR_ROW}} ];
+=end	comment	may_mistreat
+=cut
+  return [ map { defined $_ ? $_-&gt;[4]-&gt;unformatted&#40;&#41; : $_ } @{$self-&gt;{CURR_ROW}} ];
 }
 
 1;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;22&nbsp;05:28:47&nbsp;2011</span>
    <span class="description">SHYOKOU [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;22&nbsp;18:21:25&nbsp;2011</span>
    <span class="description">DOUGW [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Sep 22 05:24:22 2011, SHYOKOU wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The attached diff file tries to reuse the position of cell to build the 
&gt; row array.
</div>
Tried your patch, but still get same results. Attached are scripts that
create and then read a workbook.

If you can supply a patch &#40;and preferably a test similar to t/00-base.t
in the distribution&#41; that works, I&#39;ll apply it. I don&#39;t know how much
time I&#39;ll have to work on this in the near future.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> tst_nulls</td>
  </tr>
</table>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> create_null_cells</td>
  </tr>
</table>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;22&nbsp;18:26:40&nbsp;2011</span>
    <span class="description">DOUGW [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Sep 22 18:21:25 2011, DOUGW wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu Sep 22 05:24:22 2011, SHYOKOU wrote:
&gt; Tried your patch, but still get same results. Attached are scripts that
&gt; create and then read a workbook.
</div>
My mistake...your patch seems to almost work, but output is:
New sheet
[][C][D]
New sheet
[A][][C][D]

That first row is missing the &#34;B&#34;.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;22&nbsp;18:54:02&nbsp;2011</span>
    <span class="description">DOUGW [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Sep 22 18:26:40 2011, DOUGW wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; My mistake...your patch seems to almost work, but output is:
</div>...
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; That first row is missing the &#34;B&#34;.
</div>
The problem is that col_range&#40;&#41; doesn&#39;t work, it always returns &#40;0,-1&#41;
probably because, well, the worksheet is not yet parsed, so we don&#39;t yet
know what the min/max column range is for the worksheet.

So the patch can probably be reworked to not worry about what the
minimum column is, and then we maybe have some leading null columns in
every row.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;22&nbsp;19:09:08&nbsp;2011</span>
    <span class="description">DOUGW [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Fixed. new version 0.02 on the way.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;22&nbsp;19:09:09&nbsp;2011</span>
    <span class="description">DOUGW [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;22&nbsp;19:26:54&nbsp;2011</span>
    <span class="description">DOUGW [...] cpan.org -  Fixed in 0.02 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;22&nbsp;22:47:06&nbsp;2011</span>
    <span class="description">SHYOKOU [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Excuse me for my against to &#34;have some leading null columns in every 
row&#34; ;-&#41;

I spent a while just to look into it, why I didn&#39;t but you 
saw &#34;col_range&#40;&#41; doesn&#39;t work&#34;, found only because it was native Excel 
versus Spreadsheet::WriteExcel, where whether 
Spreadsheet::ParseExcel::Worksheet-&gt;{MinCol,MaxCol} defined or not even 
before &#34;the worksheet is not yet parsed&#34; ...

I would recommend a &#34;dirty&#34; and &#34;delayed&#34; version to &#34;Initialize row 
with first cell&#34; right after &#34;my $nxt_cell = $f-&gt;&#40;&#41;;&#34;, where col_range
&#40;&#41; may work after parsing the worksheet; only when both $curr_cell and 
$nxt_cell are on different sheets, the &#34;dirty&#34; breaks out ;-&#41;

Anyway, I don&#39;t think it is a good idea to &#34;have some leading null 
columns in every row&#34; ...

On Thu Sep 22 18:54:02 2011, DOUGW wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu Sep 22 18:26:40 2011, DOUGW wrote:
<div class="message-stanza open">&gt; &gt; My mistake...your patch seems to almost work, but output is:
</div>&gt; ...
<div class="message-stanza open">&gt; &gt; That first row is missing the &#34;B&#34;.
</div>&gt; 
&gt; The problem is that col_range&#40;&#41; doesn&#39;t work, it always returns &#40;0,-1&#41;
&gt; probably because, well, the worksheet is not yet parsed, so we don&#39;t 
</div>yet
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; know what the min/max column range is for the worksheet.
&gt; 
&gt; So the patch can probably be reworked to not worry about what the
&gt; minimum column is, and then we maybe have some leading null columns in
&gt; every row.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;22&nbsp;22:47:07&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;23&nbsp;03:30:51&nbsp;2011</span>
    <span class="description">SHYOKOU [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Here comes the diff to the v0.03 Stream.pm, w/ delayed row init right 
after &#34;my $nxt_cell = $f-&gt;&#40;&#41;;&#34;, such that no more leading nulls in 
every row ...

Another issue &#40;dunno if a neo ticket &#39;cause as if sth in upstream 
Spreadsheet::ParseExcel-&gt;new matters&#41; occurred in &#34;my $tmp = my 
$handler = sub {&#34; while compared side-by-side with the old &#34;bycicle&#34; 
Spreadsheet::DataFromExcel, where the latter passed no &#34;CellHandler&#34; 
but Spreadsheet::ParseExcel called previous &#34;$handler&#34; ...

On Thu Sep 22 18:54:02 2011, DOUGW wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu Sep 22 18:26:40 2011, DOUGW wrote:
<div class="message-stanza open">&gt; &gt; My mistake...your patch seems to almost work, but output is:
</div>&gt; ...
<div class="message-stanza open">&gt; &gt; That first row is missing the &#34;B&#34;.
</div>&gt; 
&gt; The problem is that col_range&#40;&#41; doesn&#39;t work, it always returns &#40;0,-1&#41;
&gt; probably because, well, the worksheet is not yet parsed, so we don&#39;t 
</div>yet
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; know what the min/max column range is for the worksheet.
&gt; 
&gt; So the patch can probably be reworked to not worry about what the
&gt; minimum column is, and then we maybe have some leading null columns in
&gt; every row.
</div></div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Stream.pm-0.03.diff</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- Stream.pm	2011-09-23 07:44:13.000000000 +0800
+++ Stream.pm	2011-09-23 07:44:13.000000000 +0800
@@ -18,6 +18,7 @@
   my &#40;$wb, $idx, $row, $col, $cell&#41;;
   my $tmp = my $handler = sub {
     &#40;$wb, $idx, $row, $col, $cell&#41; = @_;
+    defined $parser and	## avoid being trapped by other Spreadsheet::ParseExcel-&gt;new instance w/o CellHandler, per &#34;$_CellHandler = $hParam{CellHandler} if &#40; $hParam{CellHandler} &#41;;&#34;
     $parser-&gt;transfer&#40;$main&#41;;
   };
 
@@ -93,13 +94,21 @@
 
   # Initialize row with first cell
   my @row = &#40;&#41;;
+=begin	comment	may_null_prefix
   $row[ $curr_cell-&gt;[3] ] = $curr_cell;
+=end	comment	may_null_prefix
+=cut
   my $nxt_cell = $f-&gt;&#40;&#41;;
+  $row[ $curr_cell-&gt;[3] - &#40; $curr_cell-&gt;[0] -&gt; worksheet&#40; $curr_cell-&gt;[1] &#41; -&gt; col_range &#41;[0] ] = $curr_cell;
 
   # Collect current row on current worksheet
   while &#40; $nxt_cell &#38;&#38; $nxt_cell-&gt;[1] == $curr_cell-&gt;[1] &#38;&#38; $nxt_cell-&gt;[2] == $curr_cell-&gt;[2] &#41; {
     $curr_cell = $nxt_cell;
+=begin	comment	may_null_prefix
     $row[ $curr_cell-&gt;[3] ] = $curr_cell;
+=end	comment	may_null_prefix
+=cut
+    $row[ $curr_cell-&gt;[3] - &#40; $curr_cell-&gt;[0] -&gt; worksheet&#40; $curr_cell-&gt;[1] &#41; -&gt; col_range &#41;[0] ] = $curr_cell;
     $nxt_cell = $f-&gt;&#40;&#41;;
   }
   $self-&gt;{NEXT_CELL} = $nxt_cell;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;24&nbsp;03:26:52&nbsp;2011</span>
    <span class="description">DOUGW [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Sep 23 03:30:51 2011, SHYOKOU wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Here comes the diff to the v0.03 Stream.pm, w/ delayed row init right 
&gt; after &#34;my $nxt_cell = $f-&gt;&#40;&#41;;&#34;, such that no more leading nulls in 
&gt; every row ...
</div>
Actually, I would rather have leading nulls in every row than have it
&#34;sometimes&#34; not align &#40;when spreadsheet is created
w/Spreadsheet::WriteExcel&#41;. It would also behave more like
Spreadsheet::ParseExcel::Simple which makes no attempt to remove leading
empty cells, and I&#39;d like this module to be as much as possible
identical to that module. I could, however, see the below behaviour
implemented in an option, maybe adding a hashref to the end of the
argument list something like -&gt;new&#40;&#39;filename.xls&#39;, { StripEmptyCells =&gt;
1 } &#41; or something like that.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Another issue &#40;dunno if a neo ticket &#39;cause as if sth in upstream 
&gt; Spreadsheet::ParseExcel-&gt;new matters&#41; occurred in &#34;my $tmp = my 
&gt; $handler = sub {&#34; while compared side-by-side with the old &#34;bycicle&#34; 
&gt; Spreadsheet::DataFromExcel, where the latter passed no &#34;CellHandler&#34; 
&gt; but Spreadsheet::ParseExcel called previous &#34;$handler&#34; ...
</div>
I think that is a bug in Spreadsheet::ParseExcel. The CellHandler is a
package global variable that does not get reset on new S::PE objects
that don&#39;t have their own CellHandler &#40;and you can&#39;t have two
spreadsheet objects with their own cellhandlers either&#41;. It should be an
object/instance attribute, not a global variable. I&#39;d report that to
S:PE&#39;s maintainer.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;26&nbsp;12:46:35&nbsp;2011</span>
    <span class="description">DOUGW [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Added TrimEmpty option in 0.04
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;26&nbsp;12:46:36&nbsp;2011</span>
    <span class="description">DOUGW [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
