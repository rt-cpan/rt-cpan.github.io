<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #89416 for YAML-Tiny: Boost test coverage</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #89416 for YAML-Tiny: Boost test coverage</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/YAML-Tiny/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/YAML-Tiny/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/YAML-Tiny/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/YAML-Tiny/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/YAML-Tiny">YAML-Tiny CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">89416</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/YAML-Tiny/Active/">YAML-Tiny</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
jkeenan [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-39260-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-39261-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;11&nbsp;20:51:34&nbsp;2013</span>
    <span class="description">jkeenan [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Boost test coverage</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The patch attached increases the cover which YAML-Tiny&#39;s test suite provides to its source code.

At the start of my work on YAML-Tiny, coverage, as measured by Devel::Cover, was:

file                    stmt    bran    cond     sub
blib/lib/YAML/Tiny.pm   88.6    77.7    73.0    92.6

At the point represented by the patch, coverage has increased to:

file                    stmt    bran    cond     sub
blib/lib/YAML/Tiny.pm   91.3    83.0    73.0   100.0

There are areas in the code where, if it were cleaned up, coverage could probably be improved further.  But at the very least, we now have coverage of all subroutines in lib/YAML/Tiny.pm.

If there is a particular style for writing tests for YAML-Tiny to which all tests much conform, please let me know.  You can ping me &#40;kid51&#41; on #toolchain when you see me on channel.

Thank you very much.
Jim Keenan
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> boost_coverage_1.diff</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff --git a/t/19_errors.t b/t/19_errors.t
index a8a7b43..11223cb 100644
--- a/t/19_errors.t
+++ b/t/19_errors.t
@@ -10,7 +10,7 @@ BEGIN {
 
 use File::Spec::Functions &#39;:ALL&#39;;
 use t::lib::Test;
-use Test::More tests =&gt; 20;
+use Test::More tests =&gt; 25;
 use YAML::Tiny &#40;&#41;;
 
 my $FEATURE = &#39;does not support a feature&#39;;
@@ -71,3 +71,46 @@ END_YAML
 yaml_error&#40; &lt;&lt;&#39;END_YAML&#39;, $PLAIN &#41;;
 foo: `perl -V`
 END_YAML
+
+#####################################################################
+
+# tests for read&#40;&#41;
+{
+    eval { YAML::Tiny-&gt;read&#40;&#41;; };
+    like&#40;YAML::Tiny-&gt;errstr, qr/You did not specify a file name/,
+        &#34;Got expected error: no filename provided to read&#40;&#41;&#34;&#41;;
+    $YAML::Tiny::errstr = &#39;&#39;;
+}
+
+{
+    my $file = catfile&#40; test_data_directory&#40;&#41;, &#39;nonexistent.yml&#39; &#41;;
+    eval { YAML::Tiny-&gt;read&#40;$file&#41;; };
+    like&#40;YAML::Tiny-&gt;errstr, qr/File &#39;$file&#39; does not exist/,
+        &#34;Got expected error: nonexistent filename provided to read&#40;&#41;&#34;&#41;;
+    $YAML::Tiny::errstr = &#39;&#39;;
+}
+
+{
+    my $file = catfile&#40; test_data_directory&#40;&#41;, &#39;/&#39; &#41;;
+    eval { YAML::Tiny-&gt;read&#40;$file&#41;; };
+    like&#40;YAML::Tiny-&gt;errstr, qr/&#39;$file&#39; is a directory, not a file/,
+        &#34;Got expected error: directory provided to read&#40;&#41;&#34;&#41;;
+    $YAML::Tiny::errstr = &#39;&#39;;
+}
+
+# tests for read_string&#40;&#41;
+{
+    eval { YAML::Tiny-&gt;read_string&#40;&#41;; };
+    like&#40;YAML::Tiny-&gt;errstr, qr/Did not provide a string to load/,
+        &#34;Got expected error: no string provided to read_string&#40;&#41;&#34;&#41;;
+    $YAML::Tiny::errstr = &#39;&#39;;
+}
+
+{
+    my $str = join&#40;&#34;\n&#34; =&gt; &#40;&#39;---&#39;, &#39;- foo&#39;, &#39;---&#39;, &#39;- bar&#39;, &#39;---&#39;&#41;&#41;;
+    eval { YAML::Tiny-&gt;read_string&#40;$str&#41;; };
+    like&#40;YAML::Tiny-&gt;errstr, qr/Stream does not end with newline character/,
+        &#34;Got expected error: stream did not end with newline&#34;&#41;;
+    $YAML::Tiny::errstr = &#39;&#39;;
+}
+
diff --git a/t/24_misc.t b/t/24_misc.t
new file mode 100644
index 0000000..81aade5
--- /dev/null
+++ b/t/24_misc.t
@@ -0,0 +1,131 @@
+# Testing of statements in the YAML-Tiny codebase not exercised elsewhere.
+use strict;
+use warnings;
+
+BEGIN {
+    $|  = 1;
+    $^W = 1;
+}
+
+use File::Spec::Functions &#39;:ALL&#39;;
+use t::lib::Test;
+use Test::More qw&#40;no_plan&#41;; # tests =&gt; 24;;
+use YAML::Tiny;
+use File::Temp qw&#40;tempfile&#41;;
+
+# tests for read&#40;&#41;
+{
+    my &#40;$obj, $str, $yaml, $file&#41;;
+    $obj = YAML::Tiny-&gt;new&#40;&#41;;
+    isa_ok&#40; $obj, &#39;YAML::Tiny&#39; &#41;;
+    $file = catfile&#40; test_data_directory&#40;&#41;, &#39;one.yml&#39; &#41;;
+    eval { $yaml = $obj-&gt;read&#40;$file&#41;; };
+    ok&#40;! YAML::Tiny-&gt;errstr, &#34;\$obj-&gt;read: No error, as expected&#34;&#41;;
+    isa_ok&#40; $yaml, &#39;YAML::Tiny&#39; &#41;;
+    $YAML::Tiny::errstr = &#39;&#39;;
+}
+
+{
+    my &#40;$obj, $str, $yaml, $file&#41;;
+    $obj = YAML::Tiny-&gt;new&#40;&#41;;
+    isa_ok&#40; $obj, &#39;YAML::Tiny&#39; &#41;;
+    $file = catfile&#40; test_data_directory&#40;&#41;, &#39;nonexistent.yml&#39; &#41;;
+    eval { $obj-&gt;read&#40;$file&#41;; };
+    like&#40;YAML::Tiny-&gt;errstr, qr/File &#39;$file&#39; does not exist/,
+        &#34;Got expected error: nonexistent filename provided to read&#40;&#41;&#34;&#41;;
+    $YAML::Tiny::errstr = &#39;&#39;;
+}
+
+# tests for read_string&#40;&#41;
+{
+    my &#40;$obj, $str, $yaml&#41;;
+    $obj = YAML::Tiny-&gt;new&#40;&#41;;
+    isa_ok&#40; $obj, &#39;YAML::Tiny&#39; &#41;;
+    $str = join&#40;&#34;\n&#34; =&gt; &#40;&#39;---&#39;, &#39;- foo&#39;, &#39;---&#39;, &#39;- bar&#39;, &#39;---&#39;&#41;&#41;;
+    $str .= &#34;\n&#34;;
+    eval { $yaml = $obj-&gt;read_string&#40;$str&#41;; };
+    ok&#40;! YAML::Tiny-&gt;errstr, &#34;\$obj-&gt;read_str: No error, as expected&#34;&#41;;
+    isa_ok&#40; $yaml, &#39;YAML::Tiny&#39; &#41;;
+    $YAML::Tiny::errstr = &#39;&#39;;
+}
+
+{
+    my &#40;$obj, $str, $yaml&#41;;
+    $obj = YAML::Tiny-&gt;new&#40;&#41;;
+    isa_ok&#40; $obj, &#39;YAML::Tiny&#39; &#41;;
+    $str = &#34;--\n&#34;;
+    eval { $yaml = $obj-&gt;read_string&#40;$str&#41;; };
+    like&#40;
+        YAML::Tiny-&gt;errstr,
+        qr/YAML::Tiny found illegal characters in plain scalar/,
+        &#34;Illegal characters in plain scalar&#34;
+    &#41;;
+    $YAML::Tiny::errstr = &#39;&#39;;
+}
+
+{
+    my &#40;$obj, $str, $yaml&#41;;
+    $obj = YAML::Tiny-&gt;new&#40;&#41;;
+    isa_ok&#40; $obj, &#39;YAML::Tiny&#39; &#41;;
+    $str = join&#40;&#34;\n&#34; =&gt; &#40;&#39;---&#39;, &#39;- foo&#39;, &#39;---&#39;, &#39;- bar&#39;, &#39;---&#39;&#41;&#41;;
+    eval { $yaml = $obj-&gt;read_string&#40;$str&#41;; };
+    like&#40;YAML::Tiny-&gt;errstr, qr/Stream does not end with newline character/,
+        &#34;Got expected error: stream did not end with newline&#34;&#41;;
+    $YAML::Tiny::errstr = &#39;&#39;;
+}
+
+{
+    my &#40;$obj, $str, $yaml&#41;;
+    $obj = YAML::Tiny-&gt;new&#40;&#41;;
+    isa_ok&#40; $obj, &#39;YAML::Tiny&#39; &#41;;
+    $str = join&#40;&#34;\n&#34; =&gt; &#40;&#39;# comment&#39;, &#39;---&#39;, &#39;- foo&#39;, &#39;---&#39;, &#39;- bar&#39;, &#39;---&#39;&#41;&#41;;
+    $str .= &#34;\n&#34;;
+    eval { $yaml = $obj-&gt;read_string&#40;$str&#41;; };
+    ok&#40;! YAML::Tiny-&gt;errstr, &#34;\$obj-&gt;read_str: No error, as expected&#34;&#41;;
+    isa_ok&#40; $yaml, &#39;YAML::Tiny&#39; &#41;;
+    $YAML::Tiny::errstr = &#39;&#39;;
+}
+
+{
+    my $scalar = &#39;this is a string&#39;;
+    my $arrayref = [ 1 .. 5 ];
+    my $hashref = { alpha =&gt; &#39;beta&#39;, gamma =&gt; &#39;delta&#39; };
+
+    my $yamldump = YAML::Tiny::Dump&#40; $scalar, $arrayref, $hashref &#41;;
+    my @yamldocsloaded = YAML::Tiny::Load&#40;$yamldump&#41;;
+    is_deeply&#40;
+        [ @yamldocsloaded ],
+        [ $scalar, $arrayref, $hashref ],
+        &#34;Functional interface: Dump to Load roundtrip works as expected&#34;
+    &#41;;
+}
+
+{
+    my $scalar = &#39;this is a string&#39;;
+    my $arrayref = [ 1 .. 5 ];
+    my $hashref = { alpha =&gt; &#39;beta&#39;, gamma =&gt; &#39;delta&#39; };
+
+    my &#40;$fh, $filename&#41; = tempfile;
+
+    my $rv = YAML::Tiny::DumpFile&#40;
+        $filename, $scalar, $arrayref, $hashref&#41;;
+    ok&#40;$rv, &#34;DumpFile returned true value&#34;&#41;;
+
+    my @yamldocsloaded = YAML::Tiny::LoadFile&#40;$filename&#41;;
+    is_deeply&#40;
+        [ @yamldocsloaded ],
+        [ $scalar, $arrayref, $hashref ],
+        &#34;Functional interface: DumpFile to LoadFile roundtrip works as expected&#34;
+    &#41;;
+}
+
+{
+    my $str = &#34;This is not real YAML&#34;;
+    my @yamldocsloaded;
+    eval { @yamldocsloaded = YAML::Tiny::Load&#40;&#34;$str\n&#34;&#41;; };
+    like&#40;YAML::Tiny-&gt;errstr,
+        qr/YAML::Tiny failed to classify line &#39;$str&#39;/,
+        &#34;Correctly failed to load non-YAML string&#34;
+    &#41;;
+}
+
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;11&nbsp;20:55:54&nbsp;2013</span>
    <span class="description">jkeenan [...] cpan.org -  Reference to http://thenceforward.net/YAML-Tiny/coverage/coverage.html added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;11&nbsp;21:35:06&nbsp;2013</span>
    <span class="description">dagolden [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Awesome!  Thank you.

I&#39;ve applied it &#40;with your name on it&#41; and pushed it up to PTG.

I don&#39;t feel attached to a particular style.  &#40;I&#39;d be happy to modernize it a bit as long as we work back to 5.8.1&#41; It looks like you copied the style relatively faithfully.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;11&nbsp;21:35:06&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;11&nbsp;21:35:07&nbsp;2013</span>
    <span class="description">dagolden [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
