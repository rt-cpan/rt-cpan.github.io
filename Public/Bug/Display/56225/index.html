<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #56225 for PathTools: Innocent-looking Cwd change breaks EPIC + debugger on win32</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #56225 for PathTools: Innocent-looking Cwd change breaks EPIC + debugger on win32</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=PathTools">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=PathTools">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=PathTools">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=PathTools">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/PathTools">PathTools CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">56225</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=PathTools">PathTools</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
jkeenan [...] cpan.org

<br />
jpl [...] plosquare.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">
perl5-porters [...] perl.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-24906-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
3.31    </td>
  </tr>
  <tr id="CF-24907-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




cwd_debug_fix.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/829713/429817/cwd_debug_fix.patch">
Fri Sep 10 16:17:49 2010 (334b) by https://www.google.com/accounts/o8/id?id=AItOawn_DiEb3KC_WyL1eDoRstaKxFknWBpUgiw
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=56225">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-757447" href="/Public/Bug/Display.html?id=56225#txn-757447">#</a>      
    </span>
    <span class="date">Fri&nbsp;Apr&nbsp;02&nbsp;08:45:12&nbsp;2010</span>
    <span class="description">jpl [...] plosquare.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/757447/391717/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/391717">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">A minor undocumented change to Cwd.pm introduced in release 3.31 of 
PathTools prevents the EPIC debugger frontend from working under 
Windows. Version 3.28_01 of PathTools works correctly. This is the 
fatal change:

 sub _win32_cwd {
-    if &#40;defined &#38;DynaLoader::boot_DynaLoader&#41; {
+    if &#40;eval &#39;defined &#38;DynaLoader::boot_DynaLoader&#39;&#41; {
        $ENV{&#39;PWD&#39;} = Win32::GetCwd&#40;&#41;;
     }
     else { # miniperl

The original EPIC bug report can be found here:

<span class="clickylink"><a target="new" rel="nofollow" href="https://sourceforge.net/tracker/">https://sourceforge.net/tracker/</a></span>?
func=detail&#38;aid=2907155&#38;group_id=75859&#38;atid=545274

Background information: while in debugging mode, EPIC invokes perl -d 
with an -I path that points to a directory with a patched version of 
the perl5db.pl file from the local Perl installation. The EPIC patch 
consists of the following code:

    # Do we have any breakpoints to put in this file?
    { use epic_breakpoints; my $osingle = $single; $single = 0; $single 
= epic_breakpoints::_postponed&#40;$filename, $line&#41; || $osingle; }

In epic_breakpoints.pm we have the statement &#34;use Cwd &#39;abs_path&#39;;&#34;

Within this context the attempt to compile perl5db.pl with PathTools 
3.31 before it is invoked fails with the following message:

Use of uninitialized value in subroutine dereference at &#40;null&#41; line 1.
perl5db.pl did not return a true value.
BEGIN failed--compilation aborted.

Can you undo the offending change or, if it was intentional, suggest a 
workaround that could be implemented in EPIC? Right now EPIC users must 
be advised to patch their Cwd.pm manually in order to restore the 
correct functionality.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-829656" href="/Public/Bug/Display.html?id=56225#txn-829656">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;10&nbsp;13:44:27&nbsp;2010</span>
    <span class="description">https://www.google.com/accounts/o8/id?id=AItOawn_DiEb3KC_WyL1eDoRstaKxFknWBpUgiw -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> *Bump*</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Garen</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/829656/429786/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/429786">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 89b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ping?

The fix for this is so trivial and straightforward and fixes debugging
on Windows.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-829659" href="/Public/Bug/Display.html?id=56225#txn-829659">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;10&nbsp;13:44:28&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-829660" href="/Public/Bug/Display.html?id=56225#txn-829660">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;10&nbsp;14:17:43&nbsp;2010</span>
    <span class="description">kwilliams [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/829660/429789/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/429789">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 310b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">This change was made first in core perl and then later merged into
Cwd.pm, so unfortunately I&#39;m not really sure what motivated it.

What happens if you change this:

   if &#40;eval &#39;defined &#38;DynaLoader::boot_DynaLoader&#39;&#41; {

to this:

   if &#40;eval &#39;use DynaLoader; defined &#38;DynaLoader::boot_DynaLoader&#39;&#41; {

?

 -Ken
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-829689" href="/Public/Bug/Display.html?id=56225#txn-829689">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;10&nbsp;15:27:27&nbsp;2010</span>
    <span class="description">jpl [...] plosquare.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> jpl [...] plosquare.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/829689/429804/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/429804">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 428b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Same problem as before with this change.

On Fri Sep 10 14:17:43 2010, KWILLIAMS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This change was made first in core perl and then later merged into
&gt; Cwd.pm, so unfortunately I&#39;m not really sure what motivated it.
&gt; 
&gt; What happens if you change this:
&gt; 
&gt;    if &#40;eval &#39;defined &#38;DynaLoader::boot_DynaLoader&#39;&#41; {
&gt; 
&gt; to this:
&gt; 
&gt;    if &#40;eval &#39;use DynaLoader; defined &#38;DynaLoader::boot_DynaLoader&#39;&#41; {
&gt; 
&gt; ?
&gt; 
&gt;  -Ken
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-829713" href="/Public/Bug/Display.html?id=56225#txn-829713">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;10&nbsp;16:17:48&nbsp;2010</span>
    <span class="description">https://www.google.com/accounts/o8/id?id=AItOawn_DiEb3KC_WyL1eDoRstaKxFknWBpUgiw -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Working patch</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Garen</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/829713/429816/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/429816">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 203b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ditto - the only thing that has worked for me is the suggested patch
from the EPIC forums.  Attaching to this message; works for me using
Komodo with Strawberry Perl 5.12.1 and ActiveState Perl 5.12.2.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> cwd_debug_fix.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/829713/429817/cwd_debug_fix.patch">Download cwd_debug_fix.patch</a><br />
<span class="downloadcontenttype">text/x-diff 334b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- vanilla_Cwd.pm	2010-04-26 02:08:28.000000000 -0700
+++ Cwd.pm	2010-09-09 15:35:14.000000000 -0700
@@ -748,7 +748,7 @@
 }
 
 sub _win32_cwd {
-    if &#40;eval &#39;defined &#38;DynaLoader::boot_DynaLoader&#39;&#41; {
+    if &#40;eval { defined &#38;DynaLoader::boot_DynaLoader; }&#41; {
 	$ENV{&#39;PWD&#39;} = Win32::GetCwd&#40;&#41;;
     }
     else { # miniperl
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-829941" href="/Public/Bug/Display.html?id=56225#txn-829941">#</a>      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;11&nbsp;03:19:05&nbsp;2010</span>
    <span class="description">smueller [...] cpan.org -  Cc p5p added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-829942" href="/Public/Bug/Display.html?id=56225#txn-829942">#</a>      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;11&nbsp;03:20:09&nbsp;2010</span>
    <span class="description">smueller [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Innocent-looking Cwd change breaks EPIC + debugger on win32</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/829942/429920/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/429920">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;m quoting the original bug report for those reading along on p5p:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; A minor undocumented change to Cwd.pm introduced in release 3.31 of
&gt; PathTools prevents the EPIC debugger frontend from working under
&gt; Windows. Version 3.28_01 of PathTools works correctly. This is the
&gt; fatal change:
&gt; 
&gt; sub _win32_cwd {
&gt; - if &#40;defined &#38;DynaLoader::boot_DynaLoader&#41; {
&gt; + if &#40;eval &#39;defined &#38;DynaLoader::boot_DynaLoader&#39;&#41; {
&gt; $ENV{&#39;PWD&#39;} = Win32::GetCwd&#40;&#41;;
&gt; }
&gt; else { # miniperl
&gt; 
&gt; The original EPIC bug report can be found here:
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://sourceforge.net/tracker/">https://sourceforge.net/tracker/</a></span>?
&gt; func=detail&#38;aid=2907155&#38;group_id=75859&#38;atid=545274
&gt; 
&gt; Background information: while in debugging mode, EPIC invokes perl -d
&gt; with an -I path that points to a directory with a patched version of
&gt; the perl5db.pl file from the local Perl installation. The EPIC patch
&gt; consists of the following code:
&gt; 
&gt; # Do we have any breakpoints to put in this file?
&gt; { use epic_breakpoints; my $osingle = $single; $single = 0; $single
&gt; = epic_breakpoints::_postponed&#40;$filename, $line&#41; || $osingle; }
&gt; 
&gt; In epic_breakpoints.pm we have the statement &#34;use Cwd &#39;abs_path&#39;;&#34;
&gt; 
&gt; Within this context the attempt to compile perl5db.pl with PathTools
&gt; 3.31 before it is invoked fails with the following message:
&gt; 
&gt; Use of uninitialized value in subroutine dereference at &#40;null&#41; line 1.
&gt; perl5db.pl did not return a true value.
&gt; BEGIN failed--compilation aborted.
&gt; 
&gt; Can you undo the offending change or, if it was intentional, suggest a
&gt; workaround that could be implemented in EPIC? Right now EPIC users
&gt; must be advised to patch their Cwd.pm manually in order to restore
&gt; the correct functionality.
</div>
On Fri Sep 10 16:17:48 2010,
<span class="clickylink"><a target="new" rel="nofollow" href="https://www.google.com/accounts/o8/id?id=AItOawn_DiEb3KC_WyL1eDoRstaKxFknWBpUgiw">https://www.google.com/accounts/o8/id?id=AItOawn_DiEb3KC_WyL1eDoRstaKxFknWBpUgiw</a></span>
wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Ditto - the only thing that has worked for me is the suggested patch
&gt; from the EPIC forums.  Attaching to this message; works for me using
&gt; Komodo with Strawberry Perl 5.12.1 and ActiveState Perl 5.12.2.
&gt; 
</div>
A friendly soul on IRC &#40;Nicholas&#41; dug out the original discussion of the
change that&#39;s causing trouble for you:

<span class="clickylink"><a target="new" rel="nofollow" href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2009-09/msg00326.html">http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2009-09/msg00326.html</a></span>

Please read that carefully &#40;starting from the first follow-up&#41;. We
cannot revert the change without exposing another bug. Either one could
be investigated, but I assume finding out why this is causing trouble
for you in the debugger would be the natural place to start. I don&#39;t
have a good idea on what the culprit could be.

--Steffen
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Set odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-829945" href="/Public/Bug/Display.html?id=56225#txn-829945">#</a>      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;11&nbsp;03:20:42&nbsp;2010</span>
    <span class="description">smueller [...] cpan.org -  Subject changed from &#40;no value&#41; to &#39;Innocent-looking Cwd change breaks EPIC + debugger on win32&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-829961" href="/Public/Bug/Display.html?id=56225#txn-829961">#</a>      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;11&nbsp;04:04:34&nbsp;2010</span>
    <span class="description">https://www.google.com/accounts/o8/id?id=AItOawn_DiEb3KC_WyL1eDoRstaKxFknWBpUgiw -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Garen</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/829961/429933/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/429933">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The proposed patch from the EPIC forums doesn&#39;t revert the fix - it does
the eval inside of a curly brace block instead of inside a quoted string.  

Why that happens to work I have no idea, but wouldn&#39;t be surprised if it
also fixes the original &#34;bug&#34; on the ancient win2k system from the
original post in 2009 that inspired the current &#34;fix&#34;.

Anyone still have a win2k system to confirm? :&#41;

On Sat Sep 11 03:20:09 2010, SMUELLER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m quoting the original bug report for those reading along on p5p:
&gt; 
<div class="message-stanza open">&gt; &gt; A minor undocumented change to Cwd.pm introduced in release 3.31 of
&gt; &gt; PathTools prevents the EPIC debugger frontend from working under
&gt; &gt; Windows. Version 3.28_01 of PathTools works correctly. This is the
&gt; &gt; fatal change:
&gt; &gt;
&gt; &gt; sub _win32_cwd {
&gt; &gt; - if &#40;defined &#38;DynaLoader::boot_DynaLoader&#41; {
&gt; &gt; + if &#40;eval &#39;defined &#38;DynaLoader::boot_DynaLoader&#39;&#41; {
&gt; &gt; $ENV{&#39;PWD&#39;} = Win32::GetCwd&#40;&#41;;
&gt; &gt; }
&gt; &gt; else { # miniperl
&gt; &gt;
&gt; &gt; The original EPIC bug report can be found here:
&gt; &gt;
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://sourceforge.net/tracker/">https://sourceforge.net/tracker/</a></span>?
&gt; &gt; func=detail&#38;aid=2907155&#38;group_id=75859&#38;atid=545274
&gt; &gt;
&gt; &gt; Background information: while in debugging mode, EPIC invokes perl
</div>&gt; -d
<div class="message-stanza open">&gt; &gt; with an -I path that points to a directory with a patched version of
&gt; &gt; the perl5db.pl file from the local Perl installation. The EPIC patch
&gt; &gt; consists of the following code:
&gt; &gt;
&gt; &gt; # Do we have any breakpoints to put in this file?
&gt; &gt; { use epic_breakpoints; my $osingle = $single; $single = 0; $single
&gt; &gt; = epic_breakpoints::_postponed&#40;$filename, $line&#41; || $osingle; }
&gt; &gt;
&gt; &gt; In epic_breakpoints.pm we have the statement &#34;use Cwd &#39;abs_path&#39;;&#34;
&gt; &gt;
&gt; &gt; Within this context the attempt to compile perl5db.pl with PathTools
&gt; &gt; 3.31 before it is invoked fails with the following message:
&gt; &gt;
&gt; &gt; Use of uninitialized value in subroutine dereference at &#40;null&#41; line
</div>&gt; 1.
<div class="message-stanza open">&gt; &gt; perl5db.pl did not return a true value.
&gt; &gt; BEGIN failed--compilation aborted.
&gt; &gt;
&gt; &gt; Can you undo the offending change or, if it was intentional, suggest
</div>&gt; a
<div class="message-stanza open">&gt; &gt; workaround that could be implemented in EPIC? Right now EPIC users
&gt; &gt; must be advised to patch their Cwd.pm manually in order to restore
&gt; &gt; the correct functionality.
</div>&gt; 
&gt; On Fri Sep 10 16:17:48 2010,
&gt;
</div><span class="clickylink"><a target="new" rel="nofollow" href="https://www.google.com/accounts/o8/id?id=AItOawn_DiEb3KC_WyL1eDoRstaKxFknWBpUgiw">https://www.google.com/accounts/o8/id?id=AItOawn_DiEb3KC_WyL1eDoRstaKxFknWBpUgiw</a></span>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; wrote:
<div class="message-stanza open">&gt; &gt; Ditto - the only thing that has worked for me is the suggested patch
&gt; &gt; from the EPIC forums.  Attaching to this message; works for me using
&gt; &gt; Komodo with Strawberry Perl 5.12.1 and ActiveState Perl 5.12.2.
&gt; &gt;
</div>&gt; 
&gt; A friendly soul on IRC &#40;Nicholas&#41; dug out the original discussion of
&gt; the
&gt; change that&#39;s causing trouble for you:
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2009-">http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2009-</a></span>
&gt; 09/msg00326.html
&gt; 
&gt; Please read that carefully &#40;starting from the first follow-up&#41;. We
&gt; cannot revert the change without exposing another bug. Either one
&gt; could
&gt; be investigated, but I assume finding out why this is causing trouble
&gt; for you in the debugger would be the natural place to start. I don&#39;t
&gt; have a good idea on what the culprit could be.
&gt; 
&gt; --Steffen
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-830098" href="/Public/Bug/Display.html?id=56225#txn-830098">#</a>      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;11&nbsp;14:14:04&nbsp;2010</span>
    <span class="description">nick [...] ccl4.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> jpl [...] plosquare.com, perl5-porters [...] perl.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #56225] Innocent-looking Cwd change breaks EPIC + debugger on win32</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 11 Sep 2010 19:13:55 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;<span class="clickylink"><a target="new" rel="nofollow" href="https://www.google.com/accounts/o8/id?id=AItOawn_DiEb3KC_WyL1eDoRstaKxFknWBpUgiw">https://www.google.com/accounts/o8/id?id=AItOawn_DiEb3KC_WyL1eDoRstaKxFknWBpUgiw</a></span> via RT&#34; &lt;bug-PathTools [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Nicholas Clark &lt;nick [...] ccl4.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/830098/429997/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/429997">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat, Sep 11, 2010 at 04:04:35AM -0400, <span class="clickylink"><a target="new" rel="nofollow" href="https://www.google.com/accounts/o8/id?id=AItOawn_DiEb3KC_WyL1eDoRstaKxFknWBpUgiw">https://www.google.com/accounts/o8/id?id=AItOawn_DiEb3KC_WyL1eDoRstaKxFknWBpUgiw</a></span> via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=56225">https://rt.cpan.org/Ticket/Display.html?id=56225</a></span> &gt;
&gt; 
&gt; The proposed patch from the EPIC forums doesn&#39;t revert the fix - it does
&gt; the eval inside of a curly brace block instead of inside a quoted string.  
</div>
Try it. I predict that it&#39;s not going to work.

&#40;In that it will re-create the bug that this fixed, unless something else has
changed&#41;.
The point of the *string* eval was to avoid early &#40;well normal&#41; binding the CV
to the optree, given that later in execution the CV gets deleted.
&#40;by MakeMaker::Test::NoXS to simulate miniperl&#41;

Thread related to all of this
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2009-09/msg00326.html">http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2009-09/msg00326.html</a></span>
&#40;which you reference below&#41;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Why that happens to work I have no idea, but wouldn&#39;t be surprised if it
&gt; also fixes the original &#34;bug&#34; on the ancient win2k system from the
&gt; original post in 2009 that inspired the current &#34;fix&#34;.
&gt; 
&gt; Anyone still have a win2k system to confirm? :&#41;
</div>
I don&#39;t think that this is win2k specific. My hunch is that it will have the
same &#34;problem&#34; on anything win32. However, I don&#39;t have a win32 system to
test that out on.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sat Sep 11 03:20:09 2010, SMUELLER wrote:
<div class="message-stanza open">&gt; &gt; I&#39;m quoting the original bug report for those reading along on p5p:
</div></div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &gt; A friendly soul on IRC &#40;Nicholas&#41; dug out the original discussion of
&gt; &gt; the
&gt; &gt; change that&#39;s causing trouble for you:
&gt; &gt; 
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2009-">http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2009-</a></span>
&gt; &gt; 09/msg00326.html
&gt; &gt; 
&gt; &gt; Please read that carefully &#40;starting from the first follow-up&#41;. We
&gt; &gt; cannot revert the change without exposing another bug. Either one
&gt; &gt; could
&gt; &gt; be investigated, but I assume finding out why this is causing trouble
&gt; &gt; for you in the debugger would be the natural place to start. I don&#39;t
&gt; &gt; have a good idea on what the culprit could be.
</div>
There is some sort of real bug here, if doing a string eval causes strange
SV behaviour.

Nicholas Clark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-830124" href="/Public/Bug/Display.html?id=56225#txn-830124">#</a>      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;11&nbsp;16:16:07&nbsp;2010</span>
    <span class="description">rgs [...] consttype.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> jpl [...] plosquare.com, perl5-porters [...] perl.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #56225] Innocent-looking Cwd change breaks EPIC + debugger on win32</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 11 Sep 2010 22:15:58 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PathTools [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Rafael Garcia-Suarez &lt;rgs [...] consttype.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/830124/430010/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/430010">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 423b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 11 September 2010 09:20, Steffen Mueller via RT
&lt;bug-PathTools@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;&gt; Background information: while in debugging mode, EPIC invokes perl -d
&gt;&gt; with an -I path that points to a directory with a patched version of
&gt;&gt; the perl5db.pl file from the local Perl installation. The EPIC patch
&gt;&gt; consists of the following code:
</div>[...]

at this point I&#39;d like to ask: why not use the &#34;perl -d:Foo&#34; syntax instead ?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-830129" href="/Public/Bug/Display.html?id=56225#txn-830129">#</a>      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;11&nbsp;17:08:00&nbsp;2010</span>
    <span class="description">jpl [...] plosquare.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> jpl [...] plosquare.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/830129/430015/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/430015">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">To everyone, thanks for having a look into this.

There is no good reason why -d:Foo is not used by EPIC, but I don&#39;t
think it would change anything in the observed behavior - do you?

Here are a few more observations:

&#40;1&#41; This behavior is not win2k specific. I&#39;m also seeing it in Windows 7.

&#40;2&#41; Doing any string eval &#40;e.g. eval &#39;1&#39;&#41; anywhere in that particular
stack context causes the same trouble. So strictly speaking, it&#39;s not a
Cwd.pm bug. It&#39;s just that Cwd happens to be used by EPIC in this
particular context and it contains an &#40;otherwise harmless&#41; string eval.
Here is a sample call stack trace in which a string eval becomes evil:

 at C:/Perl/lib/Cwd.pm line 660
        Cwd::fast_abs_path&#40;&#39;C:/Users/admin/workspace.debug/HelloPerl/&#39;&#41; called
at C:/Perl/lib/Cwd.pm line 652
        Cwd::fast_abs_path&#40;&#39;C:/Users/admin/workspace.debug/HelloPerl/perl5db.pl&#39;&#41; called at C:/Users/admin/workspace.debug/.metadata/.plugins/org.epic.debug/epic_breakpoints.pm line 76
        eval {...} called at
C:/Users/admin/workspace.debug/.metadata/.plugins/org.epic.debug/epic_breakpoints.pm
line 76
        epic_breakpoints::_abs_path&#40;&#39;C:/Users/admin/workspace.debug/HelloPerl/perl5db.pl&#39;&#41; called at C:/Users/admin/workspace.debug/.metadata/.plugins/org.epic.debug/epic_breakpoints.pm line 133
        epic_breakpoints::_postponed&#40;&#39;C:/Users/admin/workspace.debug/HelloPerl/perl5db.pl&#39;, undef&#41; called at C:/Users/admin/workspace.debug/HelloPerl/perl5db.pl line 5527
        DB::postponed&#40;&#39;*main::_&lt;C:/Users/admin/workspace.debug/HelloPerl/perl5db.pl&#39;&#41; called at C:/Users/admin/workspace.debug/HelloPerl/perl5db.pl line 0
        require perl5db.pl called at
C:/Users/admin/workspace.debug/HelloPerl/hello.pl line 0
        main::BEGIN&#40;&#41; called at
C:/Users/admin/workspace.debug/HelloPerl/perl5db.pl line 0
        eval {...} called at
C:/Users/admin/workspace.debug/HelloPerl/perl5db.pl line 0
perl5db.pl did not return a true value.
BEGIN failed--compilation aborted.

Actually, it doesn&#39;t fail instantly at the point of eval, nor even
within that stack trace. Several such stack traces appear in my
debugging output before the debugger eventuelly collapses &#40;this one
quoted here is the last one, hence final the error message with
&#34;compilation aborted&#34;&#41;.

I suspect it has something to do with perl5db.pl itself redefining sub
eval, but I&#39;m not enough of a Perl hacker to explain what is exactly
going on. I&#39;m going to check whether the same trouble with eval occurs
under Linux. Of course, the _win32_cwd path is not taken in Cwd.pm under
Linux, which is why the problem popped up as Windows-specific in EPIC
bug tracker, but that&#39;s beside the point.

I lean toward either it&#39;s a genuine implementation bug in Perl or a case
of illegal use of certain constructs under special circumstances &#40;an
EPIC bug due to my ignorance or alternatively an underspecification bug
in Perl&#41;.

On Sat Sep 11 16:16:07 2010, rgs@consttype.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 11 September 2010 09:20, Steffen Mueller via RT
&gt; &lt;bug-PathTools@rt.cpan.org&gt; wrote:
<div class="message-stanza open">&gt; &gt;&gt; Background information: while in debugging mode, EPIC invokes perl
</div>&gt; -d
<div class="message-stanza open">&gt; &gt;&gt; with an -I path that points to a directory with a patched version
</div>&gt; of
<div class="message-stanza open">&gt; &gt;&gt; the perl5db.pl file from the local Perl installation. The EPIC
</div>&gt; patch
<div class="message-stanza open">&gt; &gt;&gt; consists of the following code:
</div>&gt; [...]
&gt; 
&gt; at this point I&#39;d like to ask: why not use the &#34;perl -d:Foo&#34; syntax
&gt; instead ?
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-833232" href="/Public/Bug/Display.html?id=56225#txn-833232">#</a>      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;19&nbsp;02:00:14&nbsp;2010</span>
    <span class="description">https://www.google.com/accounts/o8/id?id=AItOawn_DiEb3KC_WyL1eDoRstaKxFknWBpUgiw -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Garen</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/833232/431608/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/431608">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Sep 11 17:08:00 2010, jploski wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; To everyone, thanks for having a look into this.
&gt; 
&gt; There is no good reason why -d:Foo is not used by EPIC, but I don&#39;t
&gt; think it would change anything in the observed behavior - do you?
&gt; 
&gt; Here are a few more observations:
&gt; 
&gt; &#40;1&#41; This behavior is not win2k specific. I&#39;m also seeing it in Windows
&gt; 7.
&gt; 
&gt; &#40;2&#41; Doing any string eval &#40;e.g. eval &#39;1&#39;&#41; anywhere in that particular
&gt; stack context causes the same trouble. So strictly speaking, it&#39;s not
&gt; a
&gt; Cwd.pm bug. It&#39;s just that Cwd happens to be used by EPIC in this
&gt; particular context and it contains an &#40;otherwise harmless&#41; string
&gt; eval.
&gt; Here is a sample call stack trace in which a string eval becomes evil:
&gt; 
&gt;  at C:/Perl/lib/Cwd.pm line 660
&gt;       Cwd::fast_abs_path&#40;&#39;C:/Users/admin/workspace.debug/HelloPerl/&#39;&#41;
&gt; called
&gt; at C:/Perl/lib/Cwd.pm line 652
&gt;       Cwd::fast_abs_path&#40;&#39;C:/Users/admin/workspace.debug/HelloPerl/perl5db.pl&#39;&#41;
&gt; called at
&gt;
</div>C:/Users/admin/workspace.debug/.metadata/.plugins/org.epic.debug/epic_breakpoints.pm
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; line 76
&gt;       eval {...} called at
&gt;
</div>C:/Users/admin/workspace.debug/.metadata/.plugins/org.epic.debug/epic_breakpoints.pm
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; line 76
&gt; 
</div>epic_breakpoints::_abs_path&#40;&#39;C:/Users/admin/workspace.debug/HelloPerl/perl5db.pl&#39;&#41;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; called at
&gt;
</div>C:/Users/admin/workspace.debug/.metadata/.plugins/org.epic.debug/epic_breakpoints.pm
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; line 133
&gt; 
</div>epic_breakpoints::_postponed&#40;&#39;C:/Users/admin/workspace.debug/HelloPerl/perl5db.pl&#39;,
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; undef&#41; called at C:/Users/admin/workspace.debug/HelloPerl/perl5db.pl
&gt; line 5527
&gt; 
</div>DB::postponed&#40;&#39;*main::_&lt;C:/Users/admin/workspace.debug/HelloPerl/perl5db.pl&#39;&#41;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; called at C:/Users/admin/workspace.debug/HelloPerl/perl5db.pl line 0
&gt;       require perl5db.pl called at
&gt; C:/Users/admin/workspace.debug/HelloPerl/hello.pl line 0
&gt;       main::BEGIN&#40;&#41; called at
&gt; C:/Users/admin/workspace.debug/HelloPerl/perl5db.pl line 0
&gt;       eval {...} called at
&gt; C:/Users/admin/workspace.debug/HelloPerl/perl5db.pl line 0
&gt; perl5db.pl did not return a true value.
&gt; BEGIN failed--compilation aborted.
&gt; 
&gt; Actually, it doesn&#39;t fail instantly at the point of eval, nor even
&gt; within that stack trace. Several such stack traces appear in my
&gt; debugging output before the debugger eventuelly collapses &#40;this one
&gt; quoted here is the last one, hence final the error message with
&gt; &#34;compilation aborted&#34;&#41;.
&gt; 
&gt; I suspect it has something to do with perl5db.pl itself redefining sub
&gt; eval, but I&#39;m not enough of a Perl hacker to explain what is exactly
&gt; going on. I&#39;m going to check whether the same trouble with eval occurs
&gt; under Linux. Of course, the _win32_cwd path is not taken in Cwd.pm
&gt; under
&gt; Linux, which is why the problem popped up as Windows-specific in EPIC
&gt; bug tracker, but that&#39;s beside the point.
&gt; 
&gt; I lean toward either it&#39;s a genuine implementation bug in Perl or a
&gt; case
&gt; of illegal use of certain constructs under special circumstances &#40;an
&gt; EPIC bug due to my ignorance or alternatively an underspecification
&gt; bug
&gt; in Perl&#41;.
&gt; 
&gt; On Sat Sep 11 16:16:07 2010, rgs@consttype.org wrote:
<div class="message-stanza open">&gt; &gt; On 11 September 2010 09:20, Steffen Mueller via RT
&gt; &gt; &lt;bug-PathTools@rt.cpan.org&gt; wrote:
<div class="message-stanza open">&gt; &gt; &gt;&gt; Background information: while in debugging mode, EPIC invokes
</div></div>&gt; perl
<div class="message-stanza open">&gt; &gt; -d
<div class="message-stanza open">&gt; &gt; &gt;&gt; with an -I path that points to a directory with a patched version
</div>&gt; &gt; of
<div class="message-stanza open">&gt; &gt; &gt;&gt; the perl5db.pl file from the local Perl installation. The EPIC
</div>&gt; &gt; patch
<div class="message-stanza open">&gt; &gt; &gt;&gt; consists of the following code:
</div>&gt; &gt; [...]
&gt; &gt;
&gt; &gt; at this point I&#39;d like to ask: why not use the &#34;perl -d:Foo&#34; syntax
&gt; &gt; instead ?
</div>&gt; 
&gt; 
</div>
I was hoping to come up with a minimized test case for this issue, but
after hours of trying, can&#39;t come up with anything.

I also tried to reproduce the original issue from 11 Sep 2009 with
Strawberry Perl 5.12.1 on Windows XP 32-bit and Windows 7 x64 by running
&#39;test ExtUtils::MakeMaker&#39; but couldn&#39;t reproduce the failure.

I tried all three combinations of the line of interest from Cwd.pm in
each environment:

1&#41; Cwd.pm code as it was prior to the patch on 11 Sep 2009:

  if &#40;defined &#38;DynaLoader::boot_DynaLoader&#41; {
  ...
2&#41; Cwd.pm code as it is now in 5.12

  if &#40;eval &#39;use DynaLoader; defined &#38;DynaLoader::boot_DynaLoader&#39;&#41; {
  ...
3&#41; Cwd.pm code with the curly brace eval patch, attached to this bug:
  if &#40;eval { defined &#38;DynaLoader::boot_DynaLoader; }&#41; {
  ...

In all three cases, all tests pass. 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-946457" href="/Public/Bug/Display.html?id=56225#txn-946457">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;17&nbsp;12:08:06&nbsp;2011</span>
    <span class="description">vvm [...] tut.by -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> vvm [...] tut.by</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/946457/492140/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/492140">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 788b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Apr 02 08:45:12 2010, jploski wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; A minor undocumented change to Cwd.pm introduced in release 3.31 of 
&gt; PathTools prevents the EPIC debugger frontend from working under 
&gt; Windows. Version 3.28_01 of PathTools works correctly. This is the 
&gt; fatal change:
&gt; 
&gt;  sub _win32_cwd {
&gt; -    if &#40;defined &#38;DynaLoader::boot_DynaLoader&#41; {
&gt; +    if &#40;eval &#39;defined &#38;DynaLoader::boot_DynaLoader&#39;&#41; {
&gt;         $ENV{&#39;PWD&#39;} = Win32::GetCwd&#40;&#41;;
&gt;      }
&gt;      else { # miniperl
</div> 
 on SB Perl x64:

==
sub _win32_cwd {
 # Orig -- bad    ##  if &#40;eval &#39;defined &#38;DynaLoader::boot_DynaLoader&#39;&#41; {
 # Non full Ok ##  if &#40;eval { defined &#38;DynaLoader::boot_DynaLoader } &#41; {
 #VVM Ok       ## if &#40; &#38;DynaLoader::boot_DynaLoader&#41; {
 #VVM Ok N2       
    if &#40; defined &#38;DynaLoader::boot_DynaLoader&#41; {
==
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-946653" href="/Public/Bug/Display.html?id=56225#txn-946653">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;18&nbsp;06:08:16&nbsp;2011</span>
    <span class="description">rurban [...] x-ray.at -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> jpl [...] plosquare.com, perl5-porters [...] perl.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #56225] Innocent-looking Cwd change breaks EPIC + debugger on win32</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 18 Jun 2011 05:08:07 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-PathTools [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Reini Urban &lt;rurban [...] x-ray.at&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/946653/492243/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/492243">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">2011/6/17 Victor Miasnikov via RT &lt;bug-PathTools@rt.cpan.org&gt;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=56225">https://rt.cpan.org/Ticket/Display.html?id=56225</a></span> &gt;
&gt;
&gt; On Fri Apr 02 08:45:12 2010, jploski wrote:
&gt;
<div class="message-stanza open">&gt;&gt; A minor undocumented change to Cwd.pm introduced in release 3.31 of
&gt;&gt; PathTools prevents the EPIC debugger frontend from working under
&gt;&gt; Windows. Version 3.28_01 of PathTools works correctly. This is the
&gt;&gt; fatal change:
&gt;&gt;
&gt;&gt; Â sub _win32_cwd {
&gt;&gt; - Â  Â if &#40;defined &#38;DynaLoader::boot_DynaLoader&#41; {
&gt;&gt; + Â  Â if &#40;eval &#39;defined &#38;DynaLoader::boot_DynaLoader&#39;&#41; {
&gt;&gt; Â  Â  Â  Â  $ENV{&#39;PWD&#39;} = Win32::GetCwd&#40;&#41;;
&gt;&gt; Â  Â  Â }
&gt;&gt; Â  Â  Â else { # miniperl
</div>&gt;
&gt; Â on SB Perl x64:
&gt;
&gt; ==
&gt; sub _win32_cwd {
&gt; Â # Orig -- bad Â  Â ## Â if &#40;eval &#39;defined &#38;DynaLoader::boot_DynaLoader&#39;&#41; {
&gt; Â # Non full Ok ## Â if &#40;eval { defined &#38;DynaLoader::boot_DynaLoader } &#41; {
&gt; Â #VVM Ok Â  Â  Â  ## if &#40; &#38;DynaLoader::boot_DynaLoader&#41; {
&gt; Â #VVM Ok N2
&gt; Â  Â if &#40; defined &#38;DynaLoader::boot_DynaLoader&#41; {
&gt; ==
</div>
The purpose of the string eval was to avoid autovivication of the CV.

If the context stack is broken on win32 somehow,
a different, less intrusive fix would be:

  if &#40; *DynaLoader::boot_DynaLoader{CODE}  &#41; {

-- 
Reini Urban
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-947232" href="/Public/Bug/Display.html?id=56225#txn-947232">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;20&nbsp;10:46:20&nbsp;2011</span>
    <span class="description">vvm [...] tut.by -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> vvm [...] tut.by</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/947232/492550/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/492550">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 332b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; 2011/6/17 Victor Miasnikov via RT &lt;bug-PathTools@rt.cpan.org&gt;:
</div>&gt;On Sat Jun 18 06:08:16 2011, rurban@x-ray.at wrote:
&gt; a different, less intrusive fix would be:
&gt; 
&gt;   if &#40; *DynaLoader::boot_DynaLoader{CODE}  &#41; {
&gt; 
</div>
 Yes -- work Ok
==
sub _win32_cwd {
 #Reini Urban Var Ok##
    if &#40; *DynaLoader::boot_DynaLoader{CODE} &#41; {  
==
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-953381" href="/Public/Bug/Display.html?id=56225#txn-953381">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;07&nbsp;09:55:49&nbsp;2011</span>
    <span class="description">nick [...] ccl4.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #56225] Innocent-looking Cwd change breaks EPIC + debugger on win32</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 7 Jul 2011 14:55:36 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;<span class="clickylink"><a target="new" rel="nofollow" href="https://www.google.com/accounts/o8/id?id=AItOawn_DiEb3KC_WyL1eDoRstaKxFknWBpUgiw">https://www.google.com/accounts/o8/id?id=AItOawn_DiEb3KC_WyL1eDoRstaKxFknWBpUgiw</a></span> via RT&#34; &lt;bug-PathTools [...] rt.cpan.org&gt;, jpl [...] plosquare.com, perl5-porters [...] perl.org, Reini Urban &lt;rurban [...] x-ray.at&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Nicholas Clark &lt;nick [...] ccl4.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/953381/495893/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/495893">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat, Sep 11, 2010 at 07:13:55PM +0100, Nicholas Clark wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Try it. I predict that it&#39;s not going to work.
&gt; 
&gt; &#40;In that it will re-create the bug that this fixed, unless something else has
&gt; changed&#41;.
&gt; The point of the *string* eval was to avoid early &#40;well normal&#41; binding the CV
&gt; to the optree, given that later in execution the CV gets deleted.
&gt; &#40;by MakeMaker::Test::NoXS to simulate miniperl&#41;
&gt; 
&gt; Thread related to all of this
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2009-09/msg00326.html">http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2009-09/msg00326.html</a></span>
&gt; &#40;which you reference below&#41;
</div>
On Sat, Jun 18, 2011 at 05:08:07AM -0500, Reini Urban wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The purpose of the string eval was to avoid autovivication of the CV.
&gt; 
&gt; If the context stack is broken on win32 somehow,
&gt; a different, less intrusive fix would be:
&gt; 
&gt;   if &#40; *DynaLoader::boot_DynaLoader{CODE}  &#41; {
&gt; 
</div>
However that construction doesn&#39;t actually address the issue I described
above, because:

./perl -le &#39;delete $DynaLoader::{boot_DynaLoader}; print defined *DynaLoader::boot_DynaLoader{CODE}&#39;
1

whereas we want a construction that returns 0 after
C&lt;delete $DynaLoader::{boot_DynaLoader}&gt; has been run. Inspired by Reini&#39;s
approach, I committed this:

commit 5ec06e76dc20e3154110c2955f25db63f00c527d
Author: Nicholas Clark &lt;nick@ccl4.org&gt;
Date:   Sat Jun 18 14:42:07 2011 +0200

    In Cwd::_win32_cwd&#40;&#41; avoid a string eval when checking if we&#39;re miniperl.
    
    To allow ExtUtils::MakeMaker to run tests as if it&#39;s &#34;miniperl&#34; we need to avoid
    taking any sort of reference to the typeglob or the code in the optree, as its
    test modules are loaded later than Cwd. Previously this was done with a string
    eval, but that was causing problems &#40;for unclear reasons - rt.cpan.org #56225&#41;.
    Using a symbol table lookup and *foo{THING} syntax avoids the string eval.
    
    Evolved from a suggestion by Reini Urban.

diff --git a/dist/Cwd/Cwd.pm b/dist/Cwd/Cwd.pm
index 4683e10..ecd14ae 100644
--- a/dist/Cwd/Cwd.pm
+++ b/dist/Cwd/Cwd.pm
@@ -171,7 +171,7 @@ use strict;
 use Exporter;
 use vars qw&#40;@ISA @EXPORT @EXPORT_OK $VERSION&#41;;
 
-$VERSION = &#39;3.36&#39;;
+$VERSION = &#39;3.37&#39;;
 my $xs_version = $VERSION;
 $VERSION = eval $VERSION;
 
@@ -755,7 +755,14 @@ sub _win32_cwd_simple {
 }
 
 sub _win32_cwd {
-    if &#40;eval &#39;defined &#38;DynaLoader::boot_DynaLoader&#39;&#41; {
+    # Need to avoid taking any sort of reference to the typeglob or the code in
+    # the optree, so that this tests the runtime state of things, as the
+    # ExtUtils::MakeMaker tests for &#34;miniperl&#34; need to be able to fake things at
+    # runtime by deleting the subroutine. *foo{THING} syntax on a symbol table
+    # lookup avoids needing a string eval, which has been reported to cause
+    # problems &#40;for reasons that we haven&#39;t been able to get to the bottom of -
+    # rt.cpan.org #56225&#41;
+    if &#40;*{$DynaLoader::{boot_DynaLoader}}{CODE}&#41; {
        $ENV{&#39;PWD&#39;} = Win32::GetCwd&#40;&#41;;
     }
     else { # miniperl


On Mon, Jun 20, 2011 at 10:46:22AM -0400, Victor Miasnikov via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=56225">https://rt.cpan.org/Ticket/Display.html?id=56225</a></span> &gt;
&gt; 
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt;&gt; 2011/6/17 Victor Miasnikov via RT &lt;bug-PathTools@rt.cpan.org&gt;:
</div>&gt; &gt;On Sat Jun 18 06:08:16 2011, rurban@x-ray.at wrote:
&gt; &gt; a different, less intrusive fix would be:
&gt; &gt; 
&gt; &gt;   if &#40; *DynaLoader::boot_DynaLoader{CODE}  &#41; {
&gt; &gt; 
</div>&gt; 
&gt;  Yes -- work Ok
</div>
As the string eval is the problem, I&#39;m assuming that the change I made will
solve the symptoms too.

Nicholas Clark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1293040" href="/Public/Bug/Display.html?id=56225#txn-1293040">#</a>      
    </span>
    <span class="date">Sun&nbsp;Nov&nbsp;24&nbsp;11:04:14&nbsp;2013</span>
    <span class="description">jkeenan [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1293040/685138/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/685138">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jul 07 09:55:49 2011, nick@ccl4.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sat, Sep 11, 2010 at 07:13:55PM +0100, Nicholas Clark wrote:
<div class="message-stanza open">&gt; &gt; Try it. I predict that it&#39;s not going to work.
&gt; &gt;
&gt; &gt; &#40;In that it will re-create the bug that this fixed, unless something
&gt; &gt; else has
&gt; &gt; changed&#41;.
&gt; &gt; The point of the *string* eval was to avoid early &#40;well normal&#41;
&gt; &gt; binding the CV
&gt; &gt; to the optree, given that later in execution the CV gets deleted.
&gt; &gt; &#40;by MakeMaker::Test::NoXS to simulate miniperl&#41;
&gt; &gt;
&gt; &gt; Thread related to all of this
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2009-">http://www.xray.mpe.mpg.de/mailing-lists/perl5-porters/2009-</a></span>
&gt; &gt; 09/msg00326.html
&gt; &gt; &#40;which you reference below&#41;
</div>&gt; 
&gt; On Sat, Jun 18, 2011 at 05:08:07AM -0500, Reini Urban wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; The purpose of the string eval was to avoid autovivication of the CV.
&gt; &gt;
&gt; &gt; If the context stack is broken on win32 somehow,
&gt; &gt; a different, less intrusive fix would be:
&gt; &gt;
&gt; &gt; if &#40; *DynaLoader::boot_DynaLoader{CODE}  &#41; {
&gt; &gt;
</div>&gt; 
&gt; However that construction doesn&#39;t actually address the issue I
&gt; described
&gt; above, because:
&gt; 
&gt; ./perl -le &#39;delete $DynaLoader::{boot_DynaLoader}; print defined
&gt; *DynaLoader::boot_DynaLoader{CODE}&#39;
&gt; 1
&gt; 
&gt; whereas we want a construction that returns 0 after
&gt; C&lt;delete $DynaLoader::{boot_DynaLoader}&gt; has been run. Inspired by
&gt; Reini&#39;s
&gt; approach, I committed this:
&gt; 
&gt; commit 5ec06e76dc20e3154110c2955f25db63f00c527d
&gt; Author: Nicholas Clark &lt;nick@ccl4.org&gt;
&gt; Date:   Sat Jun 18 14:42:07 2011 +0200
&gt; 
&gt; In Cwd::_win32_cwd&#40;&#41; avoid a string eval when checking if we&#39;re
&gt; miniperl.
&gt; 
&gt; To allow ExtUtils::MakeMaker to run tests as if it&#39;s &#34;miniperl&#34; we
&gt; need to avoid
&gt; taking any sort of reference to the typeglob or the code in the
&gt; optree, as its
&gt; test modules are loaded later than Cwd. Previously this was done with
&gt; a string
&gt; eval, but that was causing problems &#40;for unclear reasons - rt.cpan.org
&gt; #56225&#41;.
&gt; Using a symbol table lookup and *foo{THING} syntax avoids the string
&gt; eval.
&gt; 
&gt; Evolved from a suggestion by Reini Urban.
&gt; 
&gt; diff --git a/dist/Cwd/Cwd.pm b/dist/Cwd/Cwd.pm
&gt; index 4683e10..ecd14ae 100644
&gt; --- a/dist/Cwd/Cwd.pm
&gt; +++ b/dist/Cwd/Cwd.pm
&gt; @@ -171,7 +171,7 @@ use strict;
&gt;  use Exporter;
&gt;  use vars qw&#40;@ISA @EXPORT @EXPORT_OK $VERSION&#41;;
&gt; 
&gt; -$VERSION = &#39;3.36&#39;;
&gt; +$VERSION = &#39;3.37&#39;;
&gt;  my $xs_version = $VERSION;
&gt;  $VERSION = eval $VERSION;
&gt; 
&gt; @@ -755,7 +755,14 @@ sub _win32_cwd_simple {
&gt;  }
&gt; 
&gt; sub _win32_cwd {
&gt; -    if &#40;eval &#39;defined &#38;DynaLoader::boot_DynaLoader&#39;&#41; {
&gt; +    # Need to avoid taking any sort of reference to the typeglob or
&gt; the code in
&gt; +    # the optree, so that this tests the runtime state of things, as
&gt; the
&gt; +    # ExtUtils::MakeMaker tests for &#34;miniperl&#34; need to be able to
&gt; fake things at
&gt; +    # runtime by deleting the subroutine. *foo{THING} syntax on a
&gt; symbol table
&gt; +    # lookup avoids needing a string eval, which has been reported to
&gt; cause
&gt; +    # problems &#40;for reasons that we haven&#39;t been able to get to the
&gt; bottom of -
&gt; +    # rt.cpan.org #56225&#41;
&gt; +    if &#40;*{$DynaLoader::{boot_DynaLoader}}{CODE}&#41; {
&gt;        $ENV{&#39;PWD&#39;} = Win32::GetCwd&#40;&#41;;
&gt;     }
&gt;     else { # miniperl
&gt; 
&gt; 
&gt; On Mon, Jun 20, 2011 at 10:46:22AM -0400, Victor Miasnikov via RT
&gt; wrote:
<div class="message-stanza open">&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=56225">https://rt.cpan.org/Ticket/Display.html?id=56225</a></span> &gt;
&gt; &gt;
<div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt;&gt; 2011/6/17 Victor Miasnikov via RT &lt;bug-PathTools@rt.cpan.org&gt;:
</div>&gt; &gt; &gt; On Sat Jun 18 06:08:16 2011, rurban@x-ray.at wrote:
&gt; &gt; &gt;  a different, less intrusive fix would be:
&gt; &gt; &gt;
&gt; &gt; &gt; if &#40; *DynaLoader::boot_DynaLoader{CODE}  &#41; {
&gt; &gt; &gt;
</div>&gt; &gt;
&gt; &gt; Yes -- work Ok
</div>&gt; 
&gt; As the string eval is the problem, I&#39;m assuming that the change I made
&gt; will
&gt; solve the symptoms too.
&gt; 
&gt; Nicholas Clark
</div>

There has been no discussion in this ticket for over two years.

Can we therefore conclude that Nicholas&#39;s patch has resolved the problem and that this ticket is closable?

Thank you very much.
Jim Keenan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1294197" href="/Public/Bug/Display.html?id=56225#txn-1294197">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Tue&nbsp;Nov&nbsp;26&nbsp;18:34:10&nbsp;2013</span>
    <span class="description">jkeenan [...] cpan.org -  Requestor JKEENAN added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.78231</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
