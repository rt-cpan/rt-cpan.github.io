<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #112853 for File-Rsync: Bug in perl-File-Rsync-0.48-40.1.noarch</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #112853 for File-Rsync: Bug in perl-File-Rsync-0.48-40.1.noarch</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=File-Rsync">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=File-Rsync">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=File-Rsync">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=File-Rsync">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/File-Rsync">File-Rsync CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">112853</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=File-Rsync">File-Rsync</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
Michal.Krupicka [...] skoda-auto.cz

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-13078-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-13079-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=112853">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1605508" href="/Public/Bug/Display.html?id=112853#txn-1605508">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;09&nbsp;05:17:57&nbsp;2016</span>
    <span class="description">Michal.Krupicka [...] skoda-auto.cz -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Bug in perl-File-Rsync-0.48-40.1.noarch</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 9 Mar 2016 10:17:40 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-File-Rsync [...] rt.cpan.org&#34; &lt;bug-File-Rsync [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Krupicka, Michal &#40;FIE&#41;&#34; &lt;Michal.Krupicka [...] skoda-auto.cz&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1605508/858881/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/858881">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dear File-Rsync developers,

I would like to report a bug in this module.

File-Rsync-0.48 hangs in forever loop if you use infun parametr which aims to a function which generates a list of files to be transferred.

Here is a small perl source code of test_rsync_fail.pl &#40;needed in test steps bellow&#41;:

#!/usr/bin/perl

use File::Rsync;

sub infun {

        print &#34;test.file&#34;;
}

my $rs = File::Rsync-&gt;new&#40; {
        &#39;recursive&#39; =&gt; 1,
        &#39;links&#39; =&gt; 1,
        &#39;copy-unsafe-links&#39; =&gt; 1,
        &#39;perms&#39; =&gt; 1,
        &#39;times&#39; =&gt; 1,
        &#39;group&#39; =&gt; 1,
        &#39;owner&#39; =&gt; 1,
        &#39;verbose&#39; =&gt; 1,
        &#39;update&#39; =&gt; 1,
        &#39;stats&#39; =&gt; 1,
        &#39;whole-file&#39; =&gt; 1,
        &#39;rsh&#39; =&gt; &#39;/usr/bin/rsh&#39;,
} &#41;;

$rs-&gt;exec&#40; {    src =&gt; &#39;src&#39;,
                dest =&gt; &#39;dest&#39;,
                &#39;files-from&#39; =&gt; &#39;-&#39;,
                infun =&gt; \&#38;infun } &#41;;


test steps in bash:
0&#41; test_rsync_fail.pl is in actual directory
1&#41; mkdir src dest
2&#41; echo &#34;test&#34; &gt; /src/test.file
3&#41; perl test_rsync_fail.pl

observation in File-Rsync-0.45:
it works a s expected, directory ./dest contains one file &#34;test.file&#34;

observation in File-Rsync-0.48:
output is filled up with neverending string &#34;test.file test.file test.file test.file test.file test.file test.file ......&#34;
it cycles forever

My environment:
kernel 3.12.28-4-default
rsync-3.1.0-2.7.x86_64
 perl-File-Rsync-0.48-40.1.noarch
perl-5.18.2-3.7.x86_64




Thank you for your time
Kind regards
Michal Krupicka
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1605508/858882/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/858882">with headers</a>
<br />
<span class="downloadcontenttype">text/html 7.8k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1606092" href="/Public/Bug/Display.html?id=112853#txn-1606092">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;10&nbsp;09:16:23&nbsp;2016</span>
    <span class="description">leakin [...] ti.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #112853] Bug in perl-File-Rsync-0.48-40.1.noarch</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 10 Mar 2016 08:16:06 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;Krupicka, Michal via RT&#34; &lt;bug-File-Rsync [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Lee Eakin &lt;leakin [...] ti.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1606092/859178/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/859178">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Michal,
Thanks for catching this!  I see how I broke it during the re-design at
0.46 &#40;not reading my own documentation was a big part of it&#41;.  Sorry if
it caused you much trouble.

Can you check out <span class="clickylink"><a target="new" rel="nofollow" href="http://www.japh.net/File-Rsync-0.49.tar.gz">http://www.japh.net/File-Rsync-0.49.tar.gz</a></span> before I
release it and make sure it fixes your code, and check out the top of
Changelog and let me know if you are OK with the attribution?  I want to
give proper credit, but also respect everyone&#39;s privacy.

I fixed my infun test case, but I&#39;d like a second test and eyes before
posting the new version.
-Lee

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Date: Wed, 9 Mar 2016 05:17:58 -0500
&gt; From: &#34;Krupicka, Michal via RT&#34; &lt;bug-File-Rsync@rt.cpan.org&gt;
&gt; To: undisclosed-recipients: ;
&gt; Subject: [rt.cpan.org #112853] Bug in perl-File-Rsync-0.48-40.1.noarch
&gt; 
&gt; Wed Mar 09 05:17:57 2016: Request 112853 was acted upon.
&gt; Transaction: Ticket created by Michal.Krupicka@skoda-auto.cz
&gt;        Queue: File-Rsync
&gt;      Subject: Bug in perl-File-Rsync-0.48-40.1.noarch
&gt;    Broken in: &#40;no value&#41;
&gt;     Severity: &#40;no value&#41;
&gt;        Owner: Nobody
&gt;   Requestors: Michal.Krupicka@skoda-auto.cz
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=112853">https://rt.cpan.org/Ticket/Display.html?id=112853</a></span> &gt;
&gt; 
&gt; 
&gt; Dear File-Rsync developers,
&gt; 
&gt; I would like to report a bug in this module.
&gt; 
&gt; File-Rsync-0.48 hangs in forever loop if you use infun parametr which aims to a function which generates a list of files to be transferred.
&gt; 
&gt; Here is a small perl source code of test_rsync_fail.pl &#40;needed in test steps bellow&#41;:
&gt; 
&gt; #!/usr/bin/perl
&gt; 
&gt; use File::Rsync;
&gt; 
&gt; sub infun {
&gt; 
&gt;         print &#34;test.file&#34;;
&gt; }
&gt; 
&gt; my $rs = File::Rsync-&gt;new&#40; {
&gt;         &#39;recursive&#39; =&gt; 1,
&gt;         &#39;links&#39; =&gt; 1,
&gt;         &#39;copy-unsafe-links&#39; =&gt; 1,
&gt;         &#39;perms&#39; =&gt; 1,
&gt;         &#39;times&#39; =&gt; 1,
&gt;         &#39;group&#39; =&gt; 1,
&gt;         &#39;owner&#39; =&gt; 1,
&gt;         &#39;verbose&#39; =&gt; 1,
&gt;         &#39;update&#39; =&gt; 1,
&gt;         &#39;stats&#39; =&gt; 1,
&gt;         &#39;whole-file&#39; =&gt; 1,
&gt;         &#39;rsh&#39; =&gt; &#39;/usr/bin/rsh&#39;,
&gt; } &#41;;
&gt; 
&gt; $rs-&gt;exec&#40; {    src =&gt; &#39;src&#39;,
&gt;                 dest =&gt; &#39;dest&#39;,
&gt;                 &#39;files-from&#39; =&gt; &#39;-&#39;,
&gt;                 infun =&gt; \&#38;infun } &#41;;
&gt; 
&gt; 
&gt; test steps in bash:
&gt; 0&#41; test_rsync_fail.pl is in actual directory
&gt; 1&#41; mkdir src dest
&gt; 2&#41; echo &#34;test&#34; &gt; /src/test.file
&gt; 3&#41; perl test_rsync_fail.pl
&gt; 
&gt; observation in File-Rsync-0.45:
&gt; it works a s expected, directory ./dest contains one file &#34;test.file&#34;
&gt; 
&gt; observation in File-Rsync-0.48:
&gt; output is filled up with neverending string &#34;test.file test.file test.file test.file test.file test.file test.file ......&#34;
&gt; it cycles forever
&gt; 
&gt; My environment:
&gt; kernel 3.12.28-4-default
&gt; rsync-3.1.0-2.7.x86_64
&gt;  perl-File-Rsync-0.48-40.1.noarch
&gt; perl-5.18.2-3.7.x86_64
&gt; 
&gt; 
&gt; 
&gt; 
&gt; Thank you for your time
&gt; Kind regards
&gt; Michal Krupicka
&gt; 
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1606093" href="/Public/Bug/Display.html?id=112853#txn-1606093">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;10&nbsp;09:16:24&nbsp;2016</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1606111" href="/Public/Bug/Display.html?id=112853#txn-1606111">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;10&nbsp;10:10:22&nbsp;2016</span>
    <span class="description">Michal.Krupicka [...] skoda-auto.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #112853] Bug in perl-File-Rsync-0.48-40.1.noarch</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 10 Mar 2016 15:10:02 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-File-Rsync [...] rt.cpan.org&#34; &lt;bug-File-Rsync [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Krupicka, Michal &#40;FIE&#41;&#34; &lt;Michal.Krupicka [...] skoda-auto.cz&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1606111/859205/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/859205">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Lee,

thank you very much for the fix and also that the issue was resolved so quickly:-&#41;
I have tested it in my environment and the fix is OK. No problem with Changelog.

Thanks again for your time and willingness.

Kind regards,
Michal


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Eakin, Lee via RT [mailto:bug-File-Rsync@rt.cpan.org] 
Sent: Thursday, March 10, 2016 3:16 PM
To: Krupicka, Michal &#40;FIE&#41; &lt;Michal.Krupicka@skoda-auto.cz&gt;
Subject: Re: [rt.cpan.org #112853] Bug in perl-File-Rsync-0.48-40.1.noarch

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=112853">https://rt.cpan.org/Ticket/Display.html?id=112853</a></span> &gt;

Michal,
Thanks for catching this!  I see how I broke it during the re-design at
0.46 &#40;not reading my own documentation was a big part of it&#41;.  Sorry if it caused you much trouble.

Can you check out <span class="clickylink"><a target="new" rel="nofollow" href="http://www.japh.net/File-Rsync-0.49.tar.gz">http://www.japh.net/File-Rsync-0.49.tar.gz</a></span> before I release it and make sure it fixes your code, and check out the top of Changelog and let me know if you are OK with the attribution?  I want to give proper credit, but also respect everyone&#39;s privacy.

I fixed my infun test case, but I&#39;d like a second test and eyes before posting the new version.
-Lee

<div class="message-stanza open">&gt; Date: Wed, 9 Mar 2016 05:17:58 -0500
&gt; From: &#34;Krupicka, Michal via RT&#34; &lt;bug-File-Rsync@rt.cpan.org&gt;
&gt; To: undisclosed-recipients: ;
&gt; Subject: [rt.cpan.org #112853] Bug in perl-File-Rsync-0.48-40.1.noarch
&gt; 
&gt; Wed Mar 09 05:17:57 2016: Request 112853 was acted upon.
&gt; Transaction: Ticket created by Michal.Krupicka@skoda-auto.cz
&gt;        Queue: File-Rsync
&gt;      Subject: Bug in perl-File-Rsync-0.48-40.1.noarch
&gt;    Broken in: &#40;no value&#41;
&gt;     Severity: &#40;no value&#41;
&gt;        Owner: Nobody
&gt;   Requestors: Michal.Krupicka@skoda-auto.cz
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=112853">https://rt.cpan.org/Ticket/Display.html?id=112853</a></span> &gt;
&gt; 
&gt; 
&gt; Dear File-Rsync developers,
&gt; 
&gt; I would like to report a bug in this module.
&gt; 
&gt; File-Rsync-0.48 hangs in forever loop if you use infun parametr which aims to a function which generates a list of files to be transferred.
&gt; 
&gt; Here is a small perl source code of test_rsync_fail.pl &#40;needed in test steps bellow&#41;:
&gt; 
&gt; #!/usr/bin/perl
&gt; 
&gt; use File::Rsync;
&gt; 
&gt; sub infun {
&gt; 
&gt;         print &#34;test.file&#34;;
&gt; }
&gt; 
&gt; my $rs = File::Rsync-&gt;new&#40; {
&gt;         &#39;recursive&#39; =&gt; 1,
&gt;         &#39;links&#39; =&gt; 1,
&gt;         &#39;copy-unsafe-links&#39; =&gt; 1,
&gt;         &#39;perms&#39; =&gt; 1,
&gt;         &#39;times&#39; =&gt; 1,
&gt;         &#39;group&#39; =&gt; 1,
&gt;         &#39;owner&#39; =&gt; 1,
&gt;         &#39;verbose&#39; =&gt; 1,
&gt;         &#39;update&#39; =&gt; 1,
&gt;         &#39;stats&#39; =&gt; 1,
&gt;         &#39;whole-file&#39; =&gt; 1,
&gt;         &#39;rsh&#39; =&gt; &#39;/usr/bin/rsh&#39;,
&gt; } &#41;;
&gt; 
&gt; $rs-&gt;exec&#40; {    src =&gt; &#39;src&#39;,
&gt;                 dest =&gt; &#39;dest&#39;,
&gt;                 &#39;files-from&#39; =&gt; &#39;-&#39;,
&gt;                 infun =&gt; \&#38;infun } &#41;;
&gt; 
&gt; 
&gt; test steps in bash:
&gt; 0&#41; test_rsync_fail.pl is in actual directory
&gt; 1&#41; mkdir src dest
&gt; 2&#41; echo &#34;test&#34; &gt; /src/test.file
&gt; 3&#41; perl test_rsync_fail.pl
&gt; 
&gt; observation in File-Rsync-0.45:
&gt; it works a s expected, directory ./dest contains one file &#34;test.file&#34;
&gt; 
&gt; observation in File-Rsync-0.48:
&gt; output is filled up with neverending string &#34;test.file test.file test.file test.file test.file test.file test.file ......&#34;
&gt; it cycles forever
&gt; 
&gt; My environment:
&gt; kernel 3.12.28-4-default
&gt; rsync-3.1.0-2.7.x86_64
&gt;  perl-File-Rsync-0.48-40.1.noarch
&gt; perl-5.18.2-3.7.x86_64
&gt; 
&gt; 
&gt; 
&gt; 
&gt; Thank you for your time
&gt; Kind regards
&gt; Michal Krupicka
&gt; 
&gt; 
</div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1606121" href="/Public/Bug/Display.html?id=112853#txn-1606121">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;10&nbsp;10:54:09&nbsp;2016</span>
    <span class="description">leakin [...] ti.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #112853] Bug in perl-File-Rsync-0.48-40.1.noarch</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 10 Mar 2016 09:53:47 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;Krupicka, Michal via RT&#34; &lt;bug-File-Rsync [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Lee Eakin &lt;leakin [...] ti.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1606121/859212/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/859212">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 3.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Glad I could get it fixed quickly for you &#40;and everyone else who didn&#39;t
report it yet ;&#41;.  I&#39;ll post it to CPAN and close the bug report.

Thanks again for reporting it.
-Lee

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Date: Thu, 10 Mar 2016 10:10:23 -0500
&gt; From: &#34;Krupicka, Michal via RT&#34; &lt;bug-File-Rsync@rt.cpan.org&gt;
&gt; To: undisclosed-recipients: ;
&gt; Subject: RE: [rt.cpan.org #112853] Bug in perl-File-Rsync-0.48-40.1.noarch
&gt; 
&gt;        Queue: File-Rsync
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=112853">https://rt.cpan.org/Ticket/Display.html?id=112853</a></span> &gt;
&gt; 
&gt; Lee,
&gt; 
&gt; thank you very much for the fix and also that the issue was resolved so quickly:-&#41;
&gt; I have tested it in my environment and the fix is OK. No problem with Changelog.
&gt; 
&gt; Thanks again for your time and willingness.
&gt; 
&gt; Kind regards,
&gt; Michal
&gt; 
&gt; 
&gt; -----Original Message-----
&gt; From: Eakin, Lee via RT [mailto:bug-File-Rsync@rt.cpan.org] 
&gt; Sent: Thursday, March 10, 2016 3:16 PM
&gt; To: Krupicka, Michal &#40;FIE&#41; &lt;Michal.Krupicka@skoda-auto.cz&gt;
&gt; Subject: Re: [rt.cpan.org #112853] Bug in perl-File-Rsync-0.48-40.1.noarch
&gt; 
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=112853">https://rt.cpan.org/Ticket/Display.html?id=112853</a></span> &gt;
&gt; 
&gt; Michal,
&gt; Thanks for catching this!  I see how I broke it during the re-design at
&gt; 0.46 &#40;not reading my own documentation was a big part of it&#41;.  Sorry if it caused you much trouble.
&gt; 
&gt; Can you check out <span class="clickylink"><a target="new" rel="nofollow" href="http://www.japh.net/File-Rsync-0.49.tar.gz">http://www.japh.net/File-Rsync-0.49.tar.gz</a></span> before I release it and make sure it fixes your code, and check out the top of Changelog and let me know if you are OK with the attribution?  I want to give proper credit, but also respect everyone&#39;s privacy.
&gt; 
&gt; I fixed my infun test case, but I&#39;d like a second test and eyes before posting the new version.
&gt; -Lee
&gt; 
<div class="message-stanza open">&gt; &gt; Date: Wed, 9 Mar 2016 05:17:58 -0500
&gt; &gt; From: &#34;Krupicka, Michal via RT&#34; &lt;bug-File-Rsync@rt.cpan.org&gt;
&gt; &gt; To: undisclosed-recipients: ;
&gt; &gt; Subject: [rt.cpan.org #112853] Bug in perl-File-Rsync-0.48-40.1.noarch
&gt; &gt; 
&gt; &gt; Wed Mar 09 05:17:57 2016: Request 112853 was acted upon.
&gt; &gt; Transaction: Ticket created by Michal.Krupicka@skoda-auto.cz
&gt; &gt;        Queue: File-Rsync
&gt; &gt;      Subject: Bug in perl-File-Rsync-0.48-40.1.noarch
&gt; &gt;    Broken in: &#40;no value&#41;
&gt; &gt;     Severity: &#40;no value&#41;
&gt; &gt;        Owner: Nobody
&gt; &gt;   Requestors: Michal.Krupicka@skoda-auto.cz
&gt; &gt;       Status: new
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=112853">https://rt.cpan.org/Ticket/Display.html?id=112853</a></span> &gt;
&gt; &gt; 
&gt; &gt; 
&gt; &gt; Dear File-Rsync developers,
&gt; &gt; 
&gt; &gt; I would like to report a bug in this module.
&gt; &gt; 
&gt; &gt; File-Rsync-0.48 hangs in forever loop if you use infun parametr which aims to a function which generates a list of files to be transferred.
&gt; &gt; 
&gt; &gt; Here is a small perl source code of test_rsync_fail.pl &#40;needed in test steps bellow&#41;:
&gt; &gt; 
&gt; &gt; #!/usr/bin/perl
&gt; &gt; 
&gt; &gt; use File::Rsync;
&gt; &gt; 
&gt; &gt; sub infun {
&gt; &gt; 
&gt; &gt;         print &#34;test.file&#34;;
&gt; &gt; }
&gt; &gt; 
&gt; &gt; my $rs = File::Rsync-&gt;new&#40; {
&gt; &gt;         &#39;recursive&#39; =&gt; 1,
&gt; &gt;         &#39;links&#39; =&gt; 1,
&gt; &gt;         &#39;copy-unsafe-links&#39; =&gt; 1,
&gt; &gt;         &#39;perms&#39; =&gt; 1,
&gt; &gt;         &#39;times&#39; =&gt; 1,
&gt; &gt;         &#39;group&#39; =&gt; 1,
&gt; &gt;         &#39;owner&#39; =&gt; 1,
&gt; &gt;         &#39;verbose&#39; =&gt; 1,
&gt; &gt;         &#39;update&#39; =&gt; 1,
&gt; &gt;         &#39;stats&#39; =&gt; 1,
&gt; &gt;         &#39;whole-file&#39; =&gt; 1,
&gt; &gt;         &#39;rsh&#39; =&gt; &#39;/usr/bin/rsh&#39;,
&gt; &gt; } &#41;;
&gt; &gt; 
&gt; &gt; $rs-&gt;exec&#40; {    src =&gt; &#39;src&#39;,
&gt; &gt;                 dest =&gt; &#39;dest&#39;,
&gt; &gt;                 &#39;files-from&#39; =&gt; &#39;-&#39;,
&gt; &gt;                 infun =&gt; \&#38;infun } &#41;;
&gt; &gt; 
&gt; &gt; 
&gt; &gt; test steps in bash:
&gt; &gt; 0&#41; test_rsync_fail.pl is in actual directory
&gt; &gt; 1&#41; mkdir src dest
&gt; &gt; 2&#41; echo &#34;test&#34; &gt; /src/test.file
&gt; &gt; 3&#41; perl test_rsync_fail.pl
&gt; &gt; 
&gt; &gt; observation in File-Rsync-0.45:
&gt; &gt; it works a s expected, directory ./dest contains one file &#34;test.file&#34;
&gt; &gt; 
&gt; &gt; observation in File-Rsync-0.48:
&gt; &gt; output is filled up with neverending string &#34;test.file test.file test.file test.file test.file test.file test.file ......&#34;
&gt; &gt; it cycles forever
&gt; &gt; 
&gt; &gt; My environment:
&gt; &gt; kernel 3.12.28-4-default
&gt; &gt; rsync-3.1.0-2.7.x86_64
&gt; &gt;  perl-File-Rsync-0.48-40.1.noarch
&gt; &gt; perl-5.18.2-3.7.x86_64
&gt; &gt; 
&gt; &gt; 
&gt; &gt; 
&gt; &gt; 
&gt; &gt; Thank you for your time
&gt; &gt; Kind regards
&gt; &gt; Michal Krupicka
&gt; &gt; 
&gt; &gt; 
</div>&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1608710" href="/Public/Bug/Display.html?id=112853#txn-1608710">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;17&nbsp;09:33:21&nbsp;2016</span>
    <span class="description">Michal.Krupicka [...] skoda-auto.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #112853] Bug in perl-File-Rsync-0.48-40.1.noarch</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 17 Mar 2016 13:32:59 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-File-Rsync [...] rt.cpan.org&#34; &lt;bug-File-Rsync [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Krupicka, Michal &#40;FIE&#41;&#34; &lt;Michal.Krupicka [...] skoda-auto.cz&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1608710/860654/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/860654">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 5.8k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dear Lee,

unfortunately  the last fix &#40;release 0.49&#41; doesn&#39;t work properly. 

There is a problem with end of lines after each file in  the list...

Look at this example. It differs from the previous only in count of files &#40;now 2&#41; and output section:

#!/usr/bin/perl

use File::Rsync;

sub infun {

        print &#34;test.file\ntest2.file&#34;;
}

my $rs = File::Rsync-&gt;new&#40; {
        &#39;recursive&#39; =&gt; 1,
        &#39;links&#39; =&gt; 1,
        &#39;copy-unsafe-links&#39; =&gt; 1,
        &#39;perms&#39; =&gt; 1,
        &#39;times&#39; =&gt; 1,
        &#39;group&#39; =&gt; 1,
        &#39;owner&#39; =&gt; 1,
        &#39;verbose&#39; =&gt; 1,
        &#39;update&#39; =&gt; 1,
        &#39;stats&#39; =&gt; 1,
        &#39;whole-file&#39; =&gt; 1,
        &#39;rsh&#39; =&gt; &#39;/usr/bin/rsh&#39;,
        &#39;errfun&#39; =&gt; \&#38;out
} &#41;;

sub out {

        my $msg = shift;
        print $msg;
}
$rs-&gt;exec&#40; {    src =&gt; &#39;src&#39;,
                dest =&gt; &#39;dest&#39;,
                &#39;files-from&#39; =&gt; &#39;-&#39;,
                infun =&gt; \&#38;infun } &#41;;

test steps in bash: 
0&#41; test_rsync_fail.pl is in actual directory 
1&#41; mkdir src dest 
2&#41; echo &#34;test&#34; &gt; /src/test.file 
3&#41; echo &#34;test&#34; &gt; /src/test2.file
4&#41; perl test_rsync_fail.pl

It generates this error:
rsync: link_stat &#34;/tmp/src/test.filetest2.file&#34; failed: No such file or directory &#40;2&#41;
rsync error: some files/attrs were not transferred &#40;see previous errors&#41; &#40;code 23&#41; at main.c&#40;1165&#41; [sender=3.1.0]


It seems, that EOL &#34;\n&#34; is lost.


This was working as expected in version 0.45

Please take a look on it.
Kind regards,
Michal


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Eakin, Lee via RT [mailto:bug-File-Rsync@rt.cpan.org] 
Sent: Thursday, March 10, 2016 4:54 PM
To: Krupicka, Michal &#40;FIE&#41; &lt;Michal.Krupicka@skoda-auto.cz&gt;
Subject: Re: [rt.cpan.org #112853] Bug in perl-File-Rsync-0.48-40.1.noarch

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=112853">https://rt.cpan.org/Ticket/Display.html?id=112853</a></span> &gt;

Glad I could get it fixed quickly for you &#40;and everyone else who didn&#39;t report it yet ;&#41;.  I&#39;ll post it to CPAN and close the bug report.

Thanks again for reporting it.
-Lee

<div class="message-stanza open">&gt; Date: Thu, 10 Mar 2016 10:10:23 -0500
&gt; From: &#34;Krupicka, Michal via RT&#34; &lt;bug-File-Rsync@rt.cpan.org&gt;
&gt; To: undisclosed-recipients: ;
&gt; Subject: RE: [rt.cpan.org #112853] Bug in 
&gt; perl-File-Rsync-0.48-40.1.noarch
&gt; 
&gt;        Queue: File-Rsync
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=112853">https://rt.cpan.org/Ticket/Display.html?id=112853</a></span> &gt;
&gt; 
&gt; Lee,
&gt; 
&gt; thank you very much for the fix and also that the issue was resolved 
&gt; so quickly:-&#41; I have tested it in my environment and the fix is OK. No problem with Changelog.
&gt; 
&gt; Thanks again for your time and willingness.
&gt; 
&gt; Kind regards,
&gt; Michal
&gt; 
&gt; 
&gt; -----Original Message-----
&gt; From: Eakin, Lee via RT [mailto:bug-File-Rsync@rt.cpan.org]
&gt; Sent: Thursday, March 10, 2016 3:16 PM
&gt; To: Krupicka, Michal &#40;FIE&#41; &lt;Michal.Krupicka@skoda-auto.cz&gt;
&gt; Subject: Re: [rt.cpan.org #112853] Bug in 
&gt; perl-File-Rsync-0.48-40.1.noarch
&gt; 
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=112853">https://rt.cpan.org/Ticket/Display.html?id=112853</a></span> &gt;
&gt; 
&gt; Michal,
&gt; Thanks for catching this!  I see how I broke it during the re-design 
&gt; at
&gt; 0.46 &#40;not reading my own documentation was a big part of it&#41;.  Sorry if it caused you much trouble.
&gt; 
&gt; Can you check out <span class="clickylink"><a target="new" rel="nofollow" href="http://www.japh.net/File-Rsync-0.49.tar.gz">http://www.japh.net/File-Rsync-0.49.tar.gz</a></span> before I release it and make sure it fixes your code, and check out the top of Changelog and let me know if you are OK with the attribution?  I want to give proper credit, but also respect everyone&#39;s privacy.
&gt; 
&gt; I fixed my infun test case, but I&#39;d like a second test and eyes before posting the new version.
&gt; -Lee
&gt; 
<div class="message-stanza open">&gt; &gt; Date: Wed, 9 Mar 2016 05:17:58 -0500
&gt; &gt; From: &#34;Krupicka, Michal via RT&#34; &lt;bug-File-Rsync@rt.cpan.org&gt;
&gt; &gt; To: undisclosed-recipients: ;
&gt; &gt; Subject: [rt.cpan.org #112853] Bug in 
&gt; &gt; perl-File-Rsync-0.48-40.1.noarch
&gt; &gt; 
&gt; &gt; Wed Mar 09 05:17:57 2016: Request 112853 was acted upon.
&gt; &gt; Transaction: Ticket created by Michal.Krupicka@skoda-auto.cz
&gt; &gt;        Queue: File-Rsync
&gt; &gt;      Subject: Bug in perl-File-Rsync-0.48-40.1.noarch
&gt; &gt;    Broken in: &#40;no value&#41;
&gt; &gt;     Severity: &#40;no value&#41;
&gt; &gt;        Owner: Nobody
&gt; &gt;   Requestors: Michal.Krupicka@skoda-auto.cz
&gt; &gt;       Status: new
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=112853">https://rt.cpan.org/Ticket/Display.html?id=112853</a></span> &gt;
&gt; &gt; 
&gt; &gt; 
&gt; &gt; Dear File-Rsync developers,
&gt; &gt; 
&gt; &gt; I would like to report a bug in this module.
&gt; &gt; 
&gt; &gt; File-Rsync-0.48 hangs in forever loop if you use infun parametr which aims to a function which generates a list of files to be transferred.
&gt; &gt; 
&gt; &gt; Here is a small perl source code of test_rsync_fail.pl &#40;needed in test steps bellow&#41;:
&gt; &gt; 
&gt; &gt; #!/usr/bin/perl
&gt; &gt; 
&gt; &gt; use File::Rsync;
&gt; &gt; 
&gt; &gt; sub infun {
&gt; &gt; 
&gt; &gt;         print &#34;test.file&#34;;
&gt; &gt; }
&gt; &gt; 
&gt; &gt; my $rs = File::Rsync-&gt;new&#40; {
&gt; &gt;         &#39;recursive&#39; =&gt; 1,
&gt; &gt;         &#39;links&#39; =&gt; 1,
&gt; &gt;         &#39;copy-unsafe-links&#39; =&gt; 1,
&gt; &gt;         &#39;perms&#39; =&gt; 1,
&gt; &gt;         &#39;times&#39; =&gt; 1,
&gt; &gt;         &#39;group&#39; =&gt; 1,
&gt; &gt;         &#39;owner&#39; =&gt; 1,
&gt; &gt;         &#39;verbose&#39; =&gt; 1,
&gt; &gt;         &#39;update&#39; =&gt; 1,
&gt; &gt;         &#39;stats&#39; =&gt; 1,
&gt; &gt;         &#39;whole-file&#39; =&gt; 1,
&gt; &gt;         &#39;rsh&#39; =&gt; &#39;/usr/bin/rsh&#39;,
&gt; &gt; } &#41;;
&gt; &gt; 
&gt; &gt; $rs-&gt;exec&#40; {    src =&gt; &#39;src&#39;,
&gt; &gt;                 dest =&gt; &#39;dest&#39;,
&gt; &gt;                 &#39;files-from&#39; =&gt; &#39;-&#39;,
&gt; &gt;                 infun =&gt; \&#38;infun } &#41;;
&gt; &gt; 
&gt; &gt; 
&gt; &gt; test steps in bash:
&gt; &gt; 0&#41; test_rsync_fail.pl is in actual directory
&gt; &gt; 1&#41; mkdir src dest
&gt; &gt; 2&#41; echo &#34;test&#34; &gt; /src/test.file
&gt; &gt; 3&#41; perl test_rsync_fail.pl
&gt; &gt; 
&gt; &gt; observation in File-Rsync-0.45:
&gt; &gt; it works a s expected, directory ./dest contains one file &#34;test.file&#34;
&gt; &gt; 
&gt; &gt; observation in File-Rsync-0.48:
&gt; &gt; output is filled up with neverending string &#34;test.file test.file test.file test.file test.file test.file test.file ......&#34;
&gt; &gt; it cycles forever
&gt; &gt; 
&gt; &gt; My environment:
&gt; &gt; kernel 3.12.28-4-default
&gt; &gt; rsync-3.1.0-2.7.x86_64
&gt; &gt;  perl-File-Rsync-0.48-40.1.noarch
&gt; &gt; perl-5.18.2-3.7.x86_64
&gt; &gt; 
&gt; &gt; 
&gt; &gt; 
&gt; &gt; 
&gt; &gt; Thank you for your time
&gt; &gt; Kind regards
&gt; &gt; Michal Krupicka
&gt; &gt; 
&gt; &gt; 
</div>&gt; 
</div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1612690" href="/Public/Bug/Display.html?id=112853#txn-1612690">#</a>      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;29&nbsp;14:47:21&nbsp;2016</span>
    <span class="description">leakin [...] ti.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #112853] Bug in perl-File-Rsync-0.48-40.1.noarch</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 29 Mar 2016 13:47:04 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;Krupicka, Michal via RT&#34; &lt;bug-File-Rsync [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Lee Eakin &lt;leakin [...] ti.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1612690/862976/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/862976">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 6.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Michal,
Sorry, work gets in the way sometimes.  I have an unreleased update that
looks like it behaves properly.  You can pull a copy for testing here:
<span class="clickylink"><a target="new" rel="nofollow" href="http://japh.net/File-Rsync-0.50.tar.gz">http://japh.net/File-Rsync-0.50.tar.gz</a></span>

Thanks again for the report.  If it looks good I&#39;ll push to CPAN.
-Lee

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Date: Thu, 17 Mar 2016 09:33:22 -0400
&gt; From: &#34;Krupicka, Michal via RT&#34; &lt;bug-File-Rsync@rt.cpan.org&gt;
&gt; To: undisclosed-recipients: ;
&gt; Subject: RE: [rt.cpan.org #112853] Bug in perl-File-Rsync-0.48-40.1.noarch
&gt; 
&gt;        Queue: File-Rsync
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=112853">https://rt.cpan.org/Ticket/Display.html?id=112853</a></span> &gt;
&gt; 
&gt; Dear Lee,
&gt; 
&gt; unfortunately  the last fix &#40;release 0.49&#41; doesn&#39;t work properly. 
&gt; 
&gt; There is a problem with end of lines after each file in  the list...
&gt; 
&gt; Look at this example. It differs from the previous only in count of files &#40;now 2&#41; and output section:
&gt; 
&gt; #!/usr/bin/perl
&gt; 
&gt; use File::Rsync;
&gt; 
&gt; sub infun {
&gt; 
&gt;         print &#34;test.file\ntest2.file&#34;;
&gt; }
&gt; 
&gt; my $rs = File::Rsync-&gt;new&#40; {
&gt;         &#39;recursive&#39; =&gt; 1,
&gt;         &#39;links&#39; =&gt; 1,
&gt;         &#39;copy-unsafe-links&#39; =&gt; 1,
&gt;         &#39;perms&#39; =&gt; 1,
&gt;         &#39;times&#39; =&gt; 1,
&gt;         &#39;group&#39; =&gt; 1,
&gt;         &#39;owner&#39; =&gt; 1,
&gt;         &#39;verbose&#39; =&gt; 1,
&gt;         &#39;update&#39; =&gt; 1,
&gt;         &#39;stats&#39; =&gt; 1,
&gt;         &#39;whole-file&#39; =&gt; 1,
&gt;         &#39;rsh&#39; =&gt; &#39;/usr/bin/rsh&#39;,
&gt;         &#39;errfun&#39; =&gt; \&#38;out
&gt; } &#41;;
&gt; 
&gt; sub out {
&gt; 
&gt;         my $msg = shift;
&gt;         print $msg;
&gt; }
&gt; $rs-&gt;exec&#40; {    src =&gt; &#39;src&#39;,
&gt;                 dest =&gt; &#39;dest&#39;,
&gt;                 &#39;files-from&#39; =&gt; &#39;-&#39;,
&gt;                 infun =&gt; \&#38;infun } &#41;;
&gt; 
&gt; test steps in bash: 
&gt; 0&#41; test_rsync_fail.pl is in actual directory 
&gt; 1&#41; mkdir src dest 
&gt; 2&#41; echo &#34;test&#34; &gt; /src/test.file 
&gt; 3&#41; echo &#34;test&#34; &gt; /src/test2.file
&gt; 4&#41; perl test_rsync_fail.pl
&gt; 
&gt; It generates this error:
&gt; rsync: link_stat &#34;/tmp/src/test.filetest2.file&#34; failed: No such file or directory &#40;2&#41;
&gt; rsync error: some files/attrs were not transferred &#40;see previous errors&#41; &#40;code 23&#41; at main.c&#40;1165&#41; [sender=3.1.0]
&gt; 
&gt; 
&gt; It seems, that EOL &#34;\n&#34; is lost.
&gt; 
&gt; 
&gt; This was working as expected in version 0.45
&gt; 
&gt; Please take a look on it.
&gt; Kind regards,
&gt; Michal
&gt; 
&gt; 
&gt; -----Original Message-----
&gt; From: Eakin, Lee via RT [mailto:bug-File-Rsync@rt.cpan.org] 
&gt; Sent: Thursday, March 10, 2016 4:54 PM
&gt; To: Krupicka, Michal &#40;FIE&#41; &lt;Michal.Krupicka@skoda-auto.cz&gt;
&gt; Subject: Re: [rt.cpan.org #112853] Bug in perl-File-Rsync-0.48-40.1.noarch
&gt; 
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=112853">https://rt.cpan.org/Ticket/Display.html?id=112853</a></span> &gt;
&gt; 
&gt; Glad I could get it fixed quickly for you &#40;and everyone else who didn&#39;t report it yet ;&#41;.  I&#39;ll post it to CPAN and close the bug report.
&gt; 
&gt; Thanks again for reporting it.
&gt; -Lee
&gt; 
<div class="message-stanza open">&gt; &gt; Date: Thu, 10 Mar 2016 10:10:23 -0500
&gt; &gt; From: &#34;Krupicka, Michal via RT&#34; &lt;bug-File-Rsync@rt.cpan.org&gt;
&gt; &gt; To: undisclosed-recipients: ;
&gt; &gt; Subject: RE: [rt.cpan.org #112853] Bug in 
&gt; &gt; perl-File-Rsync-0.48-40.1.noarch
&gt; &gt; 
&gt; &gt;        Queue: File-Rsync
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=112853">https://rt.cpan.org/Ticket/Display.html?id=112853</a></span> &gt;
&gt; &gt; 
&gt; &gt; Lee,
&gt; &gt; 
&gt; &gt; thank you very much for the fix and also that the issue was resolved 
&gt; &gt; so quickly:-&#41; I have tested it in my environment and the fix is OK. No problem with Changelog.
&gt; &gt; 
&gt; &gt; Thanks again for your time and willingness.
&gt; &gt; 
&gt; &gt; Kind regards,
&gt; &gt; Michal
&gt; &gt; 
&gt; &gt; 
&gt; &gt; -----Original Message-----
&gt; &gt; From: Eakin, Lee via RT [mailto:bug-File-Rsync@rt.cpan.org]
&gt; &gt; Sent: Thursday, March 10, 2016 3:16 PM
&gt; &gt; To: Krupicka, Michal &#40;FIE&#41; &lt;Michal.Krupicka@skoda-auto.cz&gt;
&gt; &gt; Subject: Re: [rt.cpan.org #112853] Bug in 
&gt; &gt; perl-File-Rsync-0.48-40.1.noarch
&gt; &gt; 
&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=112853">https://rt.cpan.org/Ticket/Display.html?id=112853</a></span> &gt;
&gt; &gt; 
&gt; &gt; Michal,
&gt; &gt; Thanks for catching this!  I see how I broke it during the re-design 
&gt; &gt; at
&gt; &gt; 0.46 &#40;not reading my own documentation was a big part of it&#41;.  Sorry if it caused you much trouble.
&gt; &gt; 
&gt; &gt; Can you check out <span class="clickylink"><a target="new" rel="nofollow" href="http://www.japh.net/File-Rsync-0.49.tar.gz">http://www.japh.net/File-Rsync-0.49.tar.gz</a></span> before I release it and make sure it fixes your code, and check out the top of Changelog and let me know if you are OK with the attribution?  I want to give proper credit, but also respect everyone&#39;s privacy.
&gt; &gt; 
&gt; &gt; I fixed my infun test case, but I&#39;d like a second test and eyes before posting the new version.
&gt; &gt; -Lee
&gt; &gt; 
<div class="message-stanza open">&gt; &gt; &gt; Date: Wed, 9 Mar 2016 05:17:58 -0500
&gt; &gt; &gt; From: &#34;Krupicka, Michal via RT&#34; &lt;bug-File-Rsync@rt.cpan.org&gt;
&gt; &gt; &gt; To: undisclosed-recipients: ;
&gt; &gt; &gt; Subject: [rt.cpan.org #112853] Bug in 
&gt; &gt; &gt; perl-File-Rsync-0.48-40.1.noarch
&gt; &gt; &gt; 
&gt; &gt; &gt; Wed Mar 09 05:17:57 2016: Request 112853 was acted upon.
&gt; &gt; &gt; Transaction: Ticket created by Michal.Krupicka@skoda-auto.cz
&gt; &gt; &gt;        Queue: File-Rsync
&gt; &gt; &gt;      Subject: Bug in perl-File-Rsync-0.48-40.1.noarch
&gt; &gt; &gt;    Broken in: &#40;no value&#41;
&gt; &gt; &gt;     Severity: &#40;no value&#41;
&gt; &gt; &gt;        Owner: Nobody
&gt; &gt; &gt;   Requestors: Michal.Krupicka@skoda-auto.cz
&gt; &gt; &gt;       Status: new
&gt; &gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=112853">https://rt.cpan.org/Ticket/Display.html?id=112853</a></span> &gt;
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; Dear File-Rsync developers,
&gt; &gt; &gt; 
&gt; &gt; &gt; I would like to report a bug in this module.
&gt; &gt; &gt; 
&gt; &gt; &gt; File-Rsync-0.48 hangs in forever loop if you use infun parametr which aims to a function which generates a list of files to be transferred.
&gt; &gt; &gt; 
&gt; &gt; &gt; Here is a small perl source code of test_rsync_fail.pl &#40;needed in test steps bellow&#41;:
&gt; &gt; &gt; 
&gt; &gt; &gt; #!/usr/bin/perl
&gt; &gt; &gt; 
&gt; &gt; &gt; use File::Rsync;
&gt; &gt; &gt; 
&gt; &gt; &gt; sub infun {
&gt; &gt; &gt; 
&gt; &gt; &gt;         print &#34;test.file&#34;;
&gt; &gt; &gt; }
&gt; &gt; &gt; 
&gt; &gt; &gt; my $rs = File::Rsync-&gt;new&#40; {
&gt; &gt; &gt;         &#39;recursive&#39; =&gt; 1,
&gt; &gt; &gt;         &#39;links&#39; =&gt; 1,
&gt; &gt; &gt;         &#39;copy-unsafe-links&#39; =&gt; 1,
&gt; &gt; &gt;         &#39;perms&#39; =&gt; 1,
&gt; &gt; &gt;         &#39;times&#39; =&gt; 1,
&gt; &gt; &gt;         &#39;group&#39; =&gt; 1,
&gt; &gt; &gt;         &#39;owner&#39; =&gt; 1,
&gt; &gt; &gt;         &#39;verbose&#39; =&gt; 1,
&gt; &gt; &gt;         &#39;update&#39; =&gt; 1,
&gt; &gt; &gt;         &#39;stats&#39; =&gt; 1,
&gt; &gt; &gt;         &#39;whole-file&#39; =&gt; 1,
&gt; &gt; &gt;         &#39;rsh&#39; =&gt; &#39;/usr/bin/rsh&#39;,
&gt; &gt; &gt; } &#41;;
&gt; &gt; &gt; 
&gt; &gt; &gt; $rs-&gt;exec&#40; {    src =&gt; &#39;src&#39;,
&gt; &gt; &gt;                 dest =&gt; &#39;dest&#39;,
&gt; &gt; &gt;                 &#39;files-from&#39; =&gt; &#39;-&#39;,
&gt; &gt; &gt;                 infun =&gt; \&#38;infun } &#41;;
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; test steps in bash:
&gt; &gt; &gt; 0&#41; test_rsync_fail.pl is in actual directory
&gt; &gt; &gt; 1&#41; mkdir src dest
&gt; &gt; &gt; 2&#41; echo &#34;test&#34; &gt; /src/test.file
&gt; &gt; &gt; 3&#41; perl test_rsync_fail.pl
&gt; &gt; &gt; 
&gt; &gt; &gt; observation in File-Rsync-0.45:
&gt; &gt; &gt; it works a s expected, directory ./dest contains one file &#34;test.file&#34;
&gt; &gt; &gt; 
&gt; &gt; &gt; observation in File-Rsync-0.48:
&gt; &gt; &gt; output is filled up with neverending string &#34;test.file test.file test.file test.file test.file test.file test.file ......&#34;
&gt; &gt; &gt; it cycles forever
&gt; &gt; &gt; 
&gt; &gt; &gt; My environment:
&gt; &gt; &gt; kernel 3.12.28-4-default
&gt; &gt; &gt; rsync-3.1.0-2.7.x86_64
&gt; &gt; &gt;  perl-File-Rsync-0.48-40.1.noarch
&gt; &gt; &gt; perl-5.18.2-3.7.x86_64
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; Thank you for your time
&gt; &gt; &gt; Kind regards
&gt; &gt; &gt; Michal Krupicka
&gt; &gt; &gt; 
&gt; &gt; &gt; 
</div>&gt; &gt; 
</div>&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1612787" href="/Public/Bug/Display.html?id=112853#txn-1612787">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;30&nbsp;07:46:34&nbsp;2016</span>
    <span class="description">Michal.Krupicka [...] skoda-auto.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #112853] Bug in perl-File-Rsync-0.48-40.1.noarch</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 30 Mar 2016 11:46:12 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-File-Rsync [...] rt.cpan.org&#34; &lt;bug-File-Rsync [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Krupicka, Michal &#40;FIE&#41;&#34; &lt;Michal.Krupicka [...] skoda-auto.cz&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1612787/863031/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/863031">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 7.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dear Lee,

 thanks for the new fix, but it works only partly.
 
The problem occurs when you add &#34;END block&#34;  into your test code. You can easilly simulate it by adding this into test_rsync_fail.pl &#40;source code sent in previous e-mails&#41;:

END {
        print &#40;&#39;Backend module finished&#39;&#41;;
}


If you add this END block, then the tastcase fails:

bash$ perl test_rsync_fail.pl
rsync: link_stat &#34;/tmp/src/test.fileBackend module finished&#34; failed: No such file or directory &#40;2&#41;
rsync error: some files/attrs were not transferred &#40;see previous errors&#41; &#40;code 23&#41; at main.c&#40;1165&#41; [sender=3.1.0]
Backend module finished

The infun output is somehow mixed up with END block output.

Please take a look on it.
Thank you very much in advance.

Kind regards,
Michal



<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Eakin, Lee via RT [mailto:bug-File-Rsync@rt.cpan.org] 
Sent: Tuesday, March 29, 2016 8:47 PM
To: Krupicka, Michal &#40;FIE&#41; &lt;Michal.Krupicka@skoda-auto.cz&gt;
Subject: Re: [rt.cpan.org #112853] Bug in perl-File-Rsync-0.48-40.1.noarch

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=112853">https://rt.cpan.org/Ticket/Display.html?id=112853</a></span> &gt;

Michal,
Sorry, work gets in the way sometimes.  I have an unreleased update that looks like it behaves properly.  You can pull a copy for testing here:
<span class="clickylink"><a target="new" rel="nofollow" href="http://japh.net/File-Rsync-0.50.tar.gz">http://japh.net/File-Rsync-0.50.tar.gz</a></span>

Thanks again for the report.  If it looks good I&#39;ll push to CPAN.
-Lee

<div class="message-stanza open">&gt; Date: Thu, 17 Mar 2016 09:33:22 -0400
&gt; From: &#34;Krupicka, Michal via RT&#34; &lt;bug-File-Rsync@rt.cpan.org&gt;
&gt; To: undisclosed-recipients: ;
&gt; Subject: RE: [rt.cpan.org #112853] Bug in 
&gt; perl-File-Rsync-0.48-40.1.noarch
&gt; 
&gt;        Queue: File-Rsync
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=112853">https://rt.cpan.org/Ticket/Display.html?id=112853</a></span> &gt;
&gt; 
&gt; Dear Lee,
&gt; 
&gt; unfortunately  the last fix &#40;release 0.49&#41; doesn&#39;t work properly. 
&gt; 
&gt; There is a problem with end of lines after each file in  the list...
&gt; 
&gt; Look at this example. It differs from the previous only in count of files &#40;now 2&#41; and output section:
&gt; 
&gt; #!/usr/bin/perl
&gt; 
&gt; use File::Rsync;
&gt; 
&gt; sub infun {
&gt; 
&gt;         print &#34;test.file\ntest2.file&#34;; }
&gt; 
&gt; my $rs = File::Rsync-&gt;new&#40; {
&gt;         &#39;recursive&#39; =&gt; 1,
&gt;         &#39;links&#39; =&gt; 1,
&gt;         &#39;copy-unsafe-links&#39; =&gt; 1,
&gt;         &#39;perms&#39; =&gt; 1,
&gt;         &#39;times&#39; =&gt; 1,
&gt;         &#39;group&#39; =&gt; 1,
&gt;         &#39;owner&#39; =&gt; 1,
&gt;         &#39;verbose&#39; =&gt; 1,
&gt;         &#39;update&#39; =&gt; 1,
&gt;         &#39;stats&#39; =&gt; 1,
&gt;         &#39;whole-file&#39; =&gt; 1,
&gt;         &#39;rsh&#39; =&gt; &#39;/usr/bin/rsh&#39;,
&gt;         &#39;errfun&#39; =&gt; \&#38;out
&gt; } &#41;;
&gt; 
&gt; sub out {
&gt; 
&gt;         my $msg = shift;
&gt;         print $msg;
&gt; }
&gt; $rs-&gt;exec&#40; {    src =&gt; &#39;src&#39;,
&gt;                 dest =&gt; &#39;dest&#39;,
&gt;                 &#39;files-from&#39; =&gt; &#39;-&#39;,
&gt;                 infun =&gt; \&#38;infun } &#41;;
&gt; 
&gt; test steps in bash: 
&gt; 0&#41; test_rsync_fail.pl is in actual directory
&gt; 1&#41; mkdir src dest
&gt; 2&#41; echo &#34;test&#34; &gt; /src/test.file
&gt; 3&#41; echo &#34;test&#34; &gt; /src/test2.file
&gt; 4&#41; perl test_rsync_fail.pl
&gt; 
&gt; It generates this error:
&gt; rsync: link_stat &#34;/tmp/src/test.filetest2.file&#34; failed: No such file 
&gt; or directory &#40;2&#41; rsync error: some files/attrs were not transferred 
&gt; &#40;see previous errors&#41; &#40;code 23&#41; at main.c&#40;1165&#41; [sender=3.1.0]
&gt; 
&gt; 
&gt; It seems, that EOL &#34;\n&#34; is lost.
&gt; 
&gt; 
&gt; This was working as expected in version 0.45
&gt; 
&gt; Please take a look on it.
&gt; Kind regards,
&gt; Michal
&gt; 
&gt; 
&gt; -----Original Message-----
&gt; From: Eakin, Lee via RT [mailto:bug-File-Rsync@rt.cpan.org]
&gt; Sent: Thursday, March 10, 2016 4:54 PM
&gt; To: Krupicka, Michal &#40;FIE&#41; &lt;Michal.Krupicka@skoda-auto.cz&gt;
&gt; Subject: Re: [rt.cpan.org #112853] Bug in 
&gt; perl-File-Rsync-0.48-40.1.noarch
&gt; 
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=112853">https://rt.cpan.org/Ticket/Display.html?id=112853</a></span> &gt;
&gt; 
&gt; Glad I could get it fixed quickly for you &#40;and everyone else who didn&#39;t report it yet ;&#41;.  I&#39;ll post it to CPAN and close the bug report.
&gt; 
&gt; Thanks again for reporting it.
&gt; -Lee
&gt; 
<div class="message-stanza open">&gt; &gt; Date: Thu, 10 Mar 2016 10:10:23 -0500
&gt; &gt; From: &#34;Krupicka, Michal via RT&#34; &lt;bug-File-Rsync@rt.cpan.org&gt;
&gt; &gt; To: undisclosed-recipients: ;
&gt; &gt; Subject: RE: [rt.cpan.org #112853] Bug in 
&gt; &gt; perl-File-Rsync-0.48-40.1.noarch
&gt; &gt; 
&gt; &gt;        Queue: File-Rsync
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=112853">https://rt.cpan.org/Ticket/Display.html?id=112853</a></span> &gt;
&gt; &gt; 
&gt; &gt; Lee,
&gt; &gt; 
&gt; &gt; thank you very much for the fix and also that the issue was resolved 
&gt; &gt; so quickly:-&#41; I have tested it in my environment and the fix is OK. No problem with Changelog.
&gt; &gt; 
&gt; &gt; Thanks again for your time and willingness.
&gt; &gt; 
&gt; &gt; Kind regards,
&gt; &gt; Michal
&gt; &gt; 
&gt; &gt; 
&gt; &gt; -----Original Message-----
&gt; &gt; From: Eakin, Lee via RT [mailto:bug-File-Rsync@rt.cpan.org]
&gt; &gt; Sent: Thursday, March 10, 2016 3:16 PM
&gt; &gt; To: Krupicka, Michal &#40;FIE&#41; &lt;Michal.Krupicka@skoda-auto.cz&gt;
&gt; &gt; Subject: Re: [rt.cpan.org #112853] Bug in 
&gt; &gt; perl-File-Rsync-0.48-40.1.noarch
&gt; &gt; 
&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=112853">https://rt.cpan.org/Ticket/Display.html?id=112853</a></span> &gt;
&gt; &gt; 
&gt; &gt; Michal,
&gt; &gt; Thanks for catching this!  I see how I broke it during the re-design 
&gt; &gt; at
&gt; &gt; 0.46 &#40;not reading my own documentation was a big part of it&#41;.  Sorry if it caused you much trouble.
&gt; &gt; 
&gt; &gt; Can you check out <span class="clickylink"><a target="new" rel="nofollow" href="http://www.japh.net/File-Rsync-0.49.tar.gz">http://www.japh.net/File-Rsync-0.49.tar.gz</a></span> before I release it and make sure it fixes your code, and check out the top of Changelog and let me know if you are OK with the attribution?  I want to give proper credit, but also respect everyone&#39;s privacy.
&gt; &gt; 
&gt; &gt; I fixed my infun test case, but I&#39;d like a second test and eyes before posting the new version.
&gt; &gt; -Lee
&gt; &gt; 
<div class="message-stanza open">&gt; &gt; &gt; Date: Wed, 9 Mar 2016 05:17:58 -0500
&gt; &gt; &gt; From: &#34;Krupicka, Michal via RT&#34; &lt;bug-File-Rsync@rt.cpan.org&gt;
&gt; &gt; &gt; To: undisclosed-recipients: ;
&gt; &gt; &gt; Subject: [rt.cpan.org #112853] Bug in 
&gt; &gt; &gt; perl-File-Rsync-0.48-40.1.noarch
&gt; &gt; &gt; 
&gt; &gt; &gt; Wed Mar 09 05:17:57 2016: Request 112853 was acted upon.
&gt; &gt; &gt; Transaction: Ticket created by Michal.Krupicka@skoda-auto.cz
&gt; &gt; &gt;        Queue: File-Rsync
&gt; &gt; &gt;      Subject: Bug in perl-File-Rsync-0.48-40.1.noarch
&gt; &gt; &gt;    Broken in: &#40;no value&#41;
&gt; &gt; &gt;     Severity: &#40;no value&#41;
&gt; &gt; &gt;        Owner: Nobody
&gt; &gt; &gt;   Requestors: Michal.Krupicka@skoda-auto.cz
&gt; &gt; &gt;       Status: new
&gt; &gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=112853">https://rt.cpan.org/Ticket/Display.html?id=112853</a></span> &gt;
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; Dear File-Rsync developers,
&gt; &gt; &gt; 
&gt; &gt; &gt; I would like to report a bug in this module.
&gt; &gt; &gt; 
&gt; &gt; &gt; File-Rsync-0.48 hangs in forever loop if you use infun parametr which aims to a function which generates a list of files to be transferred.
&gt; &gt; &gt; 
&gt; &gt; &gt; Here is a small perl source code of test_rsync_fail.pl &#40;needed in test steps bellow&#41;:
&gt; &gt; &gt; 
&gt; &gt; &gt; #!/usr/bin/perl
&gt; &gt; &gt; 
&gt; &gt; &gt; use File::Rsync;
&gt; &gt; &gt; 
&gt; &gt; &gt; sub infun {
&gt; &gt; &gt; 
&gt; &gt; &gt;         print &#34;test.file&#34;;
&gt; &gt; &gt; }
&gt; &gt; &gt; 
&gt; &gt; &gt; my $rs = File::Rsync-&gt;new&#40; {
&gt; &gt; &gt;         &#39;recursive&#39; =&gt; 1,
&gt; &gt; &gt;         &#39;links&#39; =&gt; 1,
&gt; &gt; &gt;         &#39;copy-unsafe-links&#39; =&gt; 1,
&gt; &gt; &gt;         &#39;perms&#39; =&gt; 1,
&gt; &gt; &gt;         &#39;times&#39; =&gt; 1,
&gt; &gt; &gt;         &#39;group&#39; =&gt; 1,
&gt; &gt; &gt;         &#39;owner&#39; =&gt; 1,
&gt; &gt; &gt;         &#39;verbose&#39; =&gt; 1,
&gt; &gt; &gt;         &#39;update&#39; =&gt; 1,
&gt; &gt; &gt;         &#39;stats&#39; =&gt; 1,
&gt; &gt; &gt;         &#39;whole-file&#39; =&gt; 1,
&gt; &gt; &gt;         &#39;rsh&#39; =&gt; &#39;/usr/bin/rsh&#39;,
&gt; &gt; &gt; } &#41;;
&gt; &gt; &gt; 
&gt; &gt; &gt; $rs-&gt;exec&#40; {    src =&gt; &#39;src&#39;,
&gt; &gt; &gt;                 dest =&gt; &#39;dest&#39;,
&gt; &gt; &gt;                 &#39;files-from&#39; =&gt; &#39;-&#39;,
&gt; &gt; &gt;                 infun =&gt; \&#38;infun } &#41;;
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; test steps in bash:
&gt; &gt; &gt; 0&#41; test_rsync_fail.pl is in actual directory
&gt; &gt; &gt; 1&#41; mkdir src dest
&gt; &gt; &gt; 2&#41; echo &#34;test&#34; &gt; /src/test.file
&gt; &gt; &gt; 3&#41; perl test_rsync_fail.pl
&gt; &gt; &gt; 
&gt; &gt; &gt; observation in File-Rsync-0.45:
&gt; &gt; &gt; it works a s expected, directory ./dest contains one file &#34;test.file&#34;
&gt; &gt; &gt; 
&gt; &gt; &gt; observation in File-Rsync-0.48:
&gt; &gt; &gt; output is filled up with neverending string &#34;test.file test.file test.file test.file test.file test.file test.file ......&#34;
&gt; &gt; &gt; it cycles forever
&gt; &gt; &gt; 
&gt; &gt; &gt; My environment:
&gt; &gt; &gt; kernel 3.12.28-4-default
&gt; &gt; &gt; rsync-3.1.0-2.7.x86_64
&gt; &gt; &gt;  perl-File-Rsync-0.48-40.1.noarch
&gt; &gt; &gt; perl-5.18.2-3.7.x86_64
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; Thank you for your time
&gt; &gt; &gt; Kind regards
&gt; &gt; &gt; Michal Krupicka
&gt; &gt; &gt; 
&gt; &gt; &gt; 
</div>&gt; &gt; 
</div>&gt; 
</div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1612794" href="/Public/Bug/Display.html?id=112853#txn-1612794">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;30&nbsp;08:51:44&nbsp;2016</span>
    <span class="description">leakin [...] ti.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #112853] Bug in perl-File-Rsync-0.48-40.1.noarch</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 30 Mar 2016 07:51:25 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;Krupicka, Michal via RT&#34; &lt;bug-File-Rsync [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Lee Eakin &lt;leakin [...] ti.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1612794/863036/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/863036">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 9.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">That is because I used a child process to convert the infun output into
an array reference for IPC::Run3.  I have pushed an updated tar file
that keeps the END block from running in the child process.  Hopefully
this one behaves sanely.

Same file location and version number since it hasn&#39;t been released yet.
<span class="clickylink"><a target="new" rel="nofollow" href="http://japh.net/File-Rsync-0.50.tar.gz">http://japh.net/File-Rsync-0.50.tar.gz</a></span>

Here is the diff from what you have &#40;1 add, one change&#41;:

diff --git a/Rsync.pm b/Rsync.pm
index 03b3598..b57afc8 100644
--- a/Rsync.pm
+++ b/Rsync.pm
@@ -21,0 +22 @@ use Data::Dumper;
+use POSIX qw&#40;_exit&#41;;
@@ -698 +699 @@ sub exec {
-         exit;
+         POSIX::_exit&#40;0&#41;;


-Lee

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Date: Wed, 30 Mar 2016 07:46:34 -0400
&gt; From: &#34;Krupicka, Michal via RT&#34; &lt;bug-File-Rsync@rt.cpan.org&gt;
&gt; To: undisclosed-recipients: ;
&gt; Subject: RE: [rt.cpan.org #112853] Bug in perl-File-Rsync-0.48-40.1.noarch
&gt; 
&gt;        Queue: File-Rsync
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=112853">https://rt.cpan.org/Ticket/Display.html?id=112853</a></span> &gt;
&gt; 
&gt; Dear Lee,
&gt; 
&gt;  thanks for the new fix, but it works only partly.
&gt;  
&gt; The problem occurs when you add &#34;END block&#34;  into your test code. You can easilly simulate it by adding this into test_rsync_fail.pl &#40;source code sent in previous e-mails&#41;:
&gt; 
&gt; END {
&gt;         print &#40;&#39;Backend module finished&#39;&#41;;
&gt; }
&gt; 
&gt; 
&gt; If you add this END block, then the tastcase fails:
&gt; 
&gt; bash$ perl test_rsync_fail.pl
&gt; rsync: link_stat &#34;/tmp/src/test.fileBackend module finished&#34; failed: No such file or directory &#40;2&#41;
&gt; rsync error: some files/attrs were not transferred &#40;see previous errors&#41; &#40;code 23&#41; at main.c&#40;1165&#41; [sender=3.1.0]
&gt; Backend module finished
&gt; 
&gt; The infun output is somehow mixed up with END block output.
&gt; 
&gt; Please take a look on it.
&gt; Thank you very much in advance.
&gt; 
&gt; Kind regards,
&gt; Michal
&gt; 
&gt; 
&gt; 
&gt; -----Original Message-----
&gt; From: Eakin, Lee via RT [mailto:bug-File-Rsync@rt.cpan.org] 
&gt; Sent: Tuesday, March 29, 2016 8:47 PM
&gt; To: Krupicka, Michal &#40;FIE&#41; &lt;Michal.Krupicka@skoda-auto.cz&gt;
&gt; Subject: Re: [rt.cpan.org #112853] Bug in perl-File-Rsync-0.48-40.1.noarch
&gt; 
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=112853">https://rt.cpan.org/Ticket/Display.html?id=112853</a></span> &gt;
&gt; 
&gt; Michal,
&gt; Sorry, work gets in the way sometimes.  I have an unreleased update that looks like it behaves properly.  You can pull a copy for testing here:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://japh.net/File-Rsync-0.50.tar.gz">http://japh.net/File-Rsync-0.50.tar.gz</a></span>
&gt; 
&gt; Thanks again for the report.  If it looks good I&#39;ll push to CPAN.
&gt; -Lee
&gt; 
<div class="message-stanza open">&gt; &gt; Date: Thu, 17 Mar 2016 09:33:22 -0400
&gt; &gt; From: &#34;Krupicka, Michal via RT&#34; &lt;bug-File-Rsync@rt.cpan.org&gt;
&gt; &gt; To: undisclosed-recipients: ;
&gt; &gt; Subject: RE: [rt.cpan.org #112853] Bug in 
&gt; &gt; perl-File-Rsync-0.48-40.1.noarch
&gt; &gt; 
&gt; &gt;        Queue: File-Rsync
&gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=112853">https://rt.cpan.org/Ticket/Display.html?id=112853</a></span> &gt;
&gt; &gt; 
&gt; &gt; Dear Lee,
&gt; &gt; 
&gt; &gt; unfortunately  the last fix &#40;release 0.49&#41; doesn&#39;t work properly. 
&gt; &gt; 
&gt; &gt; There is a problem with end of lines after each file in  the list...
&gt; &gt; 
&gt; &gt; Look at this example. It differs from the previous only in count of files &#40;now 2&#41; and output section:
&gt; &gt; 
&gt; &gt; #!/usr/bin/perl
&gt; &gt; 
&gt; &gt; use File::Rsync;
&gt; &gt; 
&gt; &gt; sub infun {
&gt; &gt; 
&gt; &gt;         print &#34;test.file\ntest2.file&#34;; }
&gt; &gt; 
&gt; &gt; my $rs = File::Rsync-&gt;new&#40; {
&gt; &gt;         &#39;recursive&#39; =&gt; 1,
&gt; &gt;         &#39;links&#39; =&gt; 1,
&gt; &gt;         &#39;copy-unsafe-links&#39; =&gt; 1,
&gt; &gt;         &#39;perms&#39; =&gt; 1,
&gt; &gt;         &#39;times&#39; =&gt; 1,
&gt; &gt;         &#39;group&#39; =&gt; 1,
&gt; &gt;         &#39;owner&#39; =&gt; 1,
&gt; &gt;         &#39;verbose&#39; =&gt; 1,
&gt; &gt;         &#39;update&#39; =&gt; 1,
&gt; &gt;         &#39;stats&#39; =&gt; 1,
&gt; &gt;         &#39;whole-file&#39; =&gt; 1,
&gt; &gt;         &#39;rsh&#39; =&gt; &#39;/usr/bin/rsh&#39;,
&gt; &gt;         &#39;errfun&#39; =&gt; \&#38;out
&gt; &gt; } &#41;;
&gt; &gt; 
&gt; &gt; sub out {
&gt; &gt; 
&gt; &gt;         my $msg = shift;
&gt; &gt;         print $msg;
&gt; &gt; }
&gt; &gt; $rs-&gt;exec&#40; {    src =&gt; &#39;src&#39;,
&gt; &gt;                 dest =&gt; &#39;dest&#39;,
&gt; &gt;                 &#39;files-from&#39; =&gt; &#39;-&#39;,
&gt; &gt;                 infun =&gt; \&#38;infun } &#41;;
&gt; &gt; 
&gt; &gt; test steps in bash: 
&gt; &gt; 0&#41; test_rsync_fail.pl is in actual directory
&gt; &gt; 1&#41; mkdir src dest
&gt; &gt; 2&#41; echo &#34;test&#34; &gt; /src/test.file
&gt; &gt; 3&#41; echo &#34;test&#34; &gt; /src/test2.file
&gt; &gt; 4&#41; perl test_rsync_fail.pl
&gt; &gt; 
&gt; &gt; It generates this error:
&gt; &gt; rsync: link_stat &#34;/tmp/src/test.filetest2.file&#34; failed: No such file 
&gt; &gt; or directory &#40;2&#41; rsync error: some files/attrs were not transferred 
&gt; &gt; &#40;see previous errors&#41; &#40;code 23&#41; at main.c&#40;1165&#41; [sender=3.1.0]
&gt; &gt; 
&gt; &gt; 
&gt; &gt; It seems, that EOL &#34;\n&#34; is lost.
&gt; &gt; 
&gt; &gt; 
&gt; &gt; This was working as expected in version 0.45
&gt; &gt; 
&gt; &gt; Please take a look on it.
&gt; &gt; Kind regards,
&gt; &gt; Michal
&gt; &gt; 
&gt; &gt; 
&gt; &gt; -----Original Message-----
&gt; &gt; From: Eakin, Lee via RT [mailto:bug-File-Rsync@rt.cpan.org]
&gt; &gt; Sent: Thursday, March 10, 2016 4:54 PM
&gt; &gt; To: Krupicka, Michal &#40;FIE&#41; &lt;Michal.Krupicka@skoda-auto.cz&gt;
&gt; &gt; Subject: Re: [rt.cpan.org #112853] Bug in 
&gt; &gt; perl-File-Rsync-0.48-40.1.noarch
&gt; &gt; 
&gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=112853">https://rt.cpan.org/Ticket/Display.html?id=112853</a></span> &gt;
&gt; &gt; 
&gt; &gt; Glad I could get it fixed quickly for you &#40;and everyone else who didn&#39;t report it yet ;&#41;.  I&#39;ll post it to CPAN and close the bug report.
&gt; &gt; 
&gt; &gt; Thanks again for reporting it.
&gt; &gt; -Lee
&gt; &gt; 
<div class="message-stanza open">&gt; &gt; &gt; Date: Thu, 10 Mar 2016 10:10:23 -0500
&gt; &gt; &gt; From: &#34;Krupicka, Michal via RT&#34; &lt;bug-File-Rsync@rt.cpan.org&gt;
&gt; &gt; &gt; To: undisclosed-recipients: ;
&gt; &gt; &gt; Subject: RE: [rt.cpan.org #112853] Bug in 
&gt; &gt; &gt; perl-File-Rsync-0.48-40.1.noarch
&gt; &gt; &gt; 
&gt; &gt; &gt;        Queue: File-Rsync
&gt; &gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=112853">https://rt.cpan.org/Ticket/Display.html?id=112853</a></span> &gt;
&gt; &gt; &gt; 
&gt; &gt; &gt; Lee,
&gt; &gt; &gt; 
&gt; &gt; &gt; thank you very much for the fix and also that the issue was resolved 
&gt; &gt; &gt; so quickly:-&#41; I have tested it in my environment and the fix is OK. No problem with Changelog.
&gt; &gt; &gt; 
&gt; &gt; &gt; Thanks again for your time and willingness.
&gt; &gt; &gt; 
&gt; &gt; &gt; Kind regards,
&gt; &gt; &gt; Michal
&gt; &gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; -----Original Message-----
&gt; &gt; &gt; From: Eakin, Lee via RT [mailto:bug-File-Rsync@rt.cpan.org]
&gt; &gt; &gt; Sent: Thursday, March 10, 2016 3:16 PM
&gt; &gt; &gt; To: Krupicka, Michal &#40;FIE&#41; &lt;Michal.Krupicka@skoda-auto.cz&gt;
&gt; &gt; &gt; Subject: Re: [rt.cpan.org #112853] Bug in 
&gt; &gt; &gt; perl-File-Rsync-0.48-40.1.noarch
&gt; &gt; &gt; 
&gt; &gt; &gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=112853">https://rt.cpan.org/Ticket/Display.html?id=112853</a></span> &gt;
&gt; &gt; &gt; 
&gt; &gt; &gt; Michal,
&gt; &gt; &gt; Thanks for catching this!  I see how I broke it during the re-design 
&gt; &gt; &gt; at
&gt; &gt; &gt; 0.46 &#40;not reading my own documentation was a big part of it&#41;.  Sorry if it caused you much trouble.
&gt; &gt; &gt; 
&gt; &gt; &gt; Can you check out <span class="clickylink"><a target="new" rel="nofollow" href="http://www.japh.net/File-Rsync-0.49.tar.gz">http://www.japh.net/File-Rsync-0.49.tar.gz</a></span> before I release it and make sure it fixes your code, and check out the top of Changelog and let me know if you are OK with the attribution?  I want to give proper credit, but also respect everyone&#39;s privacy.
&gt; &gt; &gt; 
&gt; &gt; &gt; I fixed my infun test case, but I&#39;d like a second test and eyes before posting the new version.
&gt; &gt; &gt; -Lee
&gt; &gt; &gt; 
<div class="message-stanza open">&gt; &gt; &gt; &gt; Date: Wed, 9 Mar 2016 05:17:58 -0500
&gt; &gt; &gt; &gt; From: &#34;Krupicka, Michal via RT&#34; &lt;bug-File-Rsync@rt.cpan.org&gt;
&gt; &gt; &gt; &gt; To: undisclosed-recipients: ;
&gt; &gt; &gt; &gt; Subject: [rt.cpan.org #112853] Bug in 
&gt; &gt; &gt; &gt; perl-File-Rsync-0.48-40.1.noarch
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Wed Mar 09 05:17:57 2016: Request 112853 was acted upon.
&gt; &gt; &gt; &gt; Transaction: Ticket created by Michal.Krupicka@skoda-auto.cz
&gt; &gt; &gt; &gt;        Queue: File-Rsync
&gt; &gt; &gt; &gt;      Subject: Bug in perl-File-Rsync-0.48-40.1.noarch
&gt; &gt; &gt; &gt;    Broken in: &#40;no value&#41;
&gt; &gt; &gt; &gt;     Severity: &#40;no value&#41;
&gt; &gt; &gt; &gt;        Owner: Nobody
&gt; &gt; &gt; &gt;   Requestors: Michal.Krupicka@skoda-auto.cz
&gt; &gt; &gt; &gt;       Status: new
&gt; &gt; &gt; &gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=112853">https://rt.cpan.org/Ticket/Display.html?id=112853</a></span> &gt;
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Dear File-Rsync developers,
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; I would like to report a bug in this module.
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; File-Rsync-0.48 hangs in forever loop if you use infun parametr which aims to a function which generates a list of files to be transferred.
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Here is a small perl source code of test_rsync_fail.pl &#40;needed in test steps bellow&#41;:
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; #!/usr/bin/perl
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; use File::Rsync;
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; sub infun {
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt;         print &#34;test.file&#34;;
&gt; &gt; &gt; &gt; }
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; my $rs = File::Rsync-&gt;new&#40; {
&gt; &gt; &gt; &gt;         &#39;recursive&#39; =&gt; 1,
&gt; &gt; &gt; &gt;         &#39;links&#39; =&gt; 1,
&gt; &gt; &gt; &gt;         &#39;copy-unsafe-links&#39; =&gt; 1,
&gt; &gt; &gt; &gt;         &#39;perms&#39; =&gt; 1,
&gt; &gt; &gt; &gt;         &#39;times&#39; =&gt; 1,
&gt; &gt; &gt; &gt;         &#39;group&#39; =&gt; 1,
&gt; &gt; &gt; &gt;         &#39;owner&#39; =&gt; 1,
&gt; &gt; &gt; &gt;         &#39;verbose&#39; =&gt; 1,
&gt; &gt; &gt; &gt;         &#39;update&#39; =&gt; 1,
&gt; &gt; &gt; &gt;         &#39;stats&#39; =&gt; 1,
&gt; &gt; &gt; &gt;         &#39;whole-file&#39; =&gt; 1,
&gt; &gt; &gt; &gt;         &#39;rsh&#39; =&gt; &#39;/usr/bin/rsh&#39;,
&gt; &gt; &gt; &gt; } &#41;;
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; $rs-&gt;exec&#40; {    src =&gt; &#39;src&#39;,
&gt; &gt; &gt; &gt;                 dest =&gt; &#39;dest&#39;,
&gt; &gt; &gt; &gt;                 &#39;files-from&#39; =&gt; &#39;-&#39;,
&gt; &gt; &gt; &gt;                 infun =&gt; \&#38;infun } &#41;;
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; test steps in bash:
&gt; &gt; &gt; &gt; 0&#41; test_rsync_fail.pl is in actual directory
&gt; &gt; &gt; &gt; 1&#41; mkdir src dest
&gt; &gt; &gt; &gt; 2&#41; echo &#34;test&#34; &gt; /src/test.file
&gt; &gt; &gt; &gt; 3&#41; perl test_rsync_fail.pl
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; observation in File-Rsync-0.45:
&gt; &gt; &gt; &gt; it works a s expected, directory ./dest contains one file &#34;test.file&#34;
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; observation in File-Rsync-0.48:
&gt; &gt; &gt; &gt; output is filled up with neverending string &#34;test.file test.file test.file test.file test.file test.file test.file ......&#34;
&gt; &gt; &gt; &gt; it cycles forever
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; My environment:
&gt; &gt; &gt; &gt; kernel 3.12.28-4-default
&gt; &gt; &gt; &gt; rsync-3.1.0-2.7.x86_64
&gt; &gt; &gt; &gt;  perl-File-Rsync-0.48-40.1.noarch
&gt; &gt; &gt; &gt; perl-5.18.2-3.7.x86_64
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Thank you for your time
&gt; &gt; &gt; &gt; Kind regards
&gt; &gt; &gt; &gt; Michal Krupicka
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; 
</div>&gt; &gt; &gt; 
</div>&gt; &gt; 
</div>&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1613196" href="/Public/Bug/Display.html?id=112853#txn-1613196">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;31&nbsp;08:01:34&nbsp;2016</span>
    <span class="description">Michal.Krupicka [...] skoda-auto.cz -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #112853] Bug in perl-File-Rsync-0.48-40.1.noarch</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 31 Mar 2016 12:01:10 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-File-Rsync [...] rt.cpan.org&#34; &lt;bug-File-Rsync [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Krupicka, Michal &#40;FIE&#41;&#34; &lt;Michal.Krupicka [...] skoda-auto.cz&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1613196/863313/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/863313">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 13.1k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1613221" href="/Public/Bug/Display.html?id=112853#txn-1613221">#</a>      
    </span>
    <span class="date">Thu&nbsp;Mar&nbsp;31&nbsp;08:55:16&nbsp;2016</span>
    <span class="description">leakin [...] ti.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #112853] Bug in perl-File-Rsync-0.48-40.1.noarch</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 31 Mar 2016 07:55:01 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;Krupicka, Michal via RT&#34; &lt;bug-File-Rsync [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Lee Eakin &lt;leakin [...] ti.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1613221/863333/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/863333">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 13.8k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1629536" href="/Public/Bug/Display.html?id=112853#txn-1629536">#</a>      
    </span>
    <span class="date">Mon&nbsp;May&nbsp;23&nbsp;16:03:22&nbsp;2016</span>
    <span class="description">leakin [...] ti.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #112853] Bug in perl-File-Rsync-0.48-40.1.noarch</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 23 May 2016 15:03:04 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;Krupicka, Michal via RT&#34; &lt;bug-File-Rsync [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Lee Eakin &lt;leakin [...] ti.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1629536/873078/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/873078">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 13.9k</span>
</div>
<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.517574</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
