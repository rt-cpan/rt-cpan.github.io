<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #21024 for Tripletail: patch to compile Tripletail::SMIME under Windows</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #21024 for Tripletail: patch to compile Tripletail::SMIME under Windows</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Tripletail">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Tripletail">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Tripletail">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Tripletail">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Tripletail">Tripletail CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">21024</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Tripletail">Tripletail</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">HIO [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
alexchorny [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">
HIO [...] cpan.org

<br />

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-40402-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.15    </td>
  </tr>
  <tr id="CF-40403-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




ext-Makefile.PL<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/232905/97528/ext-Makefile.PL">
Wed Aug 16 12:48:58 2006 (2.1k) by alexchorny [...] gmail.com
</a>
</font></li>
</ul>


ext-Makefile.PL.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/232905/97525/ext-Makefile.PL.patch">
Wed Aug 16 12:48:58 2006 (1k) by alexchorny [...] gmail.com
</a>
</font></li>
</ul>


ext-Tripletail-SMIME-Makefile.PL<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/232905/97522/ext-Tripletail-SMIME-Makefile.PL">
Wed Aug 16 12:48:58 2006 (976b) by alexchorny [...] gmail.com
</a>
</font></li>
</ul>


ext-Tripletail-SMIME-Makefile.PL.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/232905/97531/ext-Tripletail-SMIME-Makefile.PL.patch">
Wed Aug 16 12:48:58 2006 (1.3k) by alexchorny [...] gmail.com
</a>
</font></li>
</ul>


smime.t<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/232958/97568/smime.t">
Wed Aug 16 15:34:42 2006 (2.5k) by alexchorny [...] gmail.com
</a>
</font></li>
</ul>


smime.t.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/232958/97571/smime.t.patch">
Wed Aug 16 15:34:42 2006 (1.3k) by alexchorny [...] gmail.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=21024">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-232905" href="/Public/Bug/Display.html?id=21024#txn-232905">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;16&nbsp;12:48:58&nbsp;2006</span>
    <span class="description">alexchorny [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> patch to compile Tripletail::SMIME under Windows</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/232905/97519/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/97519">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 336b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Patched ext/Makefile.PL to look for openssl in c:/openssl and add
directories for compiler.
Patched ext/Tripletail-SMIME/Makefile.PL the same and to link correct
libraries.
This all will make compiling it under Windows possible and convinient.
Patches and patched Makefiles.PL are included.

-------
Alexandr Ciornii, <span class="clickylink"><a target="new" rel="nofollow" href="http://chorny.net">http://chorny.net</a></span>
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> ext-Tripletail-SMIME-Makefile.PL</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/232905/97522/ext-Tripletail-SMIME-Makefile.PL">Download ext-Tripletail-SMIME-Makefile.PL</a><br />
<span class="downloadcontenttype">text/x-perl 976b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">use strict;
use warnings;
use ExtUtils::MakeMaker;

my $OPENSSL_LIBS = $ENV{LDFLAGS} || &#39;&#39;;
my $OPENSSL_CFLAGS = $ENV{CFLAGS} || &#39;&#39;;

  my $openssl_path=&#39;&#39;;
  if&#40;$^O eq &#39;MSWin32&#39;&#41; {
    $openssl_path=&#39;c:/openssl&#39;  if -x &#39;c:/openssl/bin/openssl.exe&#39;;
    if &#40;$openssl_path&#41; {
     $OPENSSL_CFLAGS.=&#34; -I$openssl_path/include&#34;;
     $OPENSSL_LIBS.=&#34; -L$openssl_path/lib -lssleay32 -llibeay32&#34;;
    }
  } else {
   $OPENSSL_LIBS.=&#34; -L$openssl_path/lib -lcrypto&#34;;
  }

WriteMakefile&#40;
    NAME                =&gt; &#39;Tripletail::SMIME&#39;,
    AUTHOR              =&gt; &#39;Ymirlink &lt;tl@tripletail.jp&gt;&#39;,
    VERSION_FROM        =&gt; &#39;SMIME.pm&#39;,
    ABSTRACT_FROM       =&gt; &#39;SMIME.pm&#39;,
    PL_FILES            =&gt; {},
    PREREQ_PM =&gt; {
        &#39;Test::More&#39; =&gt; 0,
    },
    LIBS                =&gt; [&#34;$OPENSSL_LIBS&#34;],
    INC                 =&gt; &#34;$OPENSSL_CFLAGS&#34;,
    dist                =&gt; { COMPRESS =&gt; &#39;gzip -9f&#39;, SUFFIX =&gt; &#39;gz&#39;, },
    clean               =&gt; { FILES =&gt; &#39;Tripletail-SMIME-*&#39; },
&#41;;
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> ext-Makefile.PL.patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/232905/97525/ext-Makefile.PL.patch">Download ext-Makefile.PL.patch</a><br />
<span class="downloadcontenttype">text/x-diff 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">*** ext/Makefile.PL.dist	Tue Aug 15 08:10:07 2006
--- ext/Makefile.PL	Wed Aug 16 18:37:10 2006
***************
*** 46,53 ****
    use ExtUtils::Embed;
    my $cc = exists $argv{CC} ? $argv{CC} : $Config{cc};
    my $ccopts = $argv{CCFLAGS}||ExtUtils::Embed::ccopts&#40;&#41;;
!   
    my $cmd = &#34;$cc $ccopts $xstest_src -o $xstest_out&#34;;
    print &#34;Checking XS Compiling... : $cmd\n&#34;;
    my $rc = 0xffff &#38; system&#40;$cmd&#41;;
    unlink&#40;$xstest_out&#41;;
--- 46,62 ----
    use ExtUtils::Embed;
    my $cc = exists $argv{CC} ? $argv{CC} : $Config{cc};
    my $ccopts = $argv{CCFLAGS}||ExtUtils::Embed::ccopts&#40;&#41;;
!   my $windows=0;
!   my $openssl_path=&#39;&#39;;
    my $cmd = &#34;$cc $ccopts $xstest_src -o $xstest_out&#34;;
+   if&#40;$^O eq &#39;MSWin32&#39;&#41; {
+     $openssl_path=&#39;c:/openssl&#39;  if -x &#39;c:/openssl/bin/openssl.exe&#39;;
+     $windows=1;
+     if &#40;$openssl_path&#41; {
+      $cmd = &#34;$cc -I$openssl_path/include $ccopts $xstest_src -o $xstest_out  -L$openssl_path/lib&#34;;
+     }
+   }
+   
    print &#34;Checking XS Compiling... : $cmd\n&#34;;
    my $rc = 0xffff &#38; system&#40;$cmd&#41;;
    unlink&#40;$xstest_out&#41;;
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> ext-Makefile.PL</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/232905/97528/ext-Makefile.PL">Download ext-Makefile.PL</a><br />
<span class="downloadcontenttype">text/x-perl 2.1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">use strict;
use warnings;
use ExtUtils::MakeMaker;

our %OPTS;
&#38;check_openssl&#40;&#41;;

WriteMakefile&#40;
    NAME                =&gt; &#39;Tripletail-ext&#39;,
    %OPTS,
&#41;;

sub check_openssl
{
  if&#40; !openssl_is_available&#40;&#41; &#41;
  {
    $OPTS{DIR} = [&#39;Tripletail-HtmlFilter&#39;];
  }
}

sub openssl_is_available
{
  my $xstest_src = &#34;openssl_check.c&#34;;
  my $xstest_out = &#34;openssl_check&#34;;
  if&#40; !open&#40;FILE, &#34;&gt; $xstest_src&#34;&#41; &#41;
  {
    return;
  }
  print FILE &lt;&lt;XSTEST_CODE;
#include &lt;string.h&gt;
#include &lt;openssl/crypto.h&gt;
#include &lt;openssl/pem.h&gt;
#include &lt;openssl/err.h&gt;
#include &lt;openssl/pkcs12.h&gt;
#include &lt;openssl/x509.h&gt;
int main&#40;&#41;
{
  return 0;
}
XSTEST_CODE
  close&#40;FILE&#41;;
  
  # compile.
  my %argv = map{ /^&#40;\w+&#41;=&#40;.*&#41;$/ } @ARGV;
  use Config;
  use ExtUtils::Embed;
  my $cc = exists $argv{CC} ? $argv{CC} : $Config{cc};
  my $ccopts = $argv{CCFLAGS}||ExtUtils::Embed::ccopts&#40;&#41;;
  my $windows=0;
  my $openssl_path=&#39;&#39;;
  my $cmd = &#34;$cc $ccopts $xstest_src -o $xstest_out&#34;;
  if&#40;$^O eq &#39;MSWin32&#39;&#41; {
    $openssl_path=&#39;c:/openssl&#39;  if -x &#39;c:/openssl/bin/openssl.exe&#39;;
    $windows=1;
    if &#40;$openssl_path&#41; {
     $cmd = &#34;$cc -I$openssl_path/include $ccopts $xstest_src -o $xstest_out  -L$openssl_path/lib&#34;;
    }
  }
  
  print &#34;Checking XS Compiling... : $cmd\n&#34;;
  my $rc = 0xffff &#38; system&#40;$cmd&#41;;
  unlink&#40;$xstest_out&#41;;
  unlink&#40;$xstest_src&#41;;
  if&#40; $rc &#41;
  {
    if&#40; $rc == 0xffff &#41;
    {
      print &#34;  &gt;&gt; Here environment cannot use XS.\n&#34;;
      print &#34;  &gt;&gt; Because : command failed : $!\n&#34;;
      return;
    }elsif&#40; $rc &gt; 0x80 &#41;
    {
      print &#34;  &gt;&gt; Here environment cannot use XS.\n&#34;;
      print &#34;  &gt;&gt; Because : ran with non-zero exit status $rc\n&#34;;
      return;
    }elsif&#40; $rc &#38; 0x80 &#41;
    {
      $rc &#38;= ~0x80;
      print &#34;  &gt;&gt; Compile failed..\n&#34;;
      print &#34;  &gt;&gt; Because : ran with coredump from signal $rc\n&#34;;
      exit 1;
    }else
    {
      print &#34;  &gt;&gt; Compile failed..\n&#34;;
      print &#34;  &gt;&gt; Because : ran with signal $rc\n&#34;;
      exit 1;
    }
  }
  print &#34;  &gt;&gt; ok, compile succeed.\n&#34;;
  1;
}

# -----------------------------------------------------------------------------
# End of File.
# -----------------------------------------------------------------------------
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> ext-Tripletail-SMIME-Makefile.PL.patch</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/232905/97531/ext-Tripletail-SMIME-Makefile.PL.patch">Download ext-Tripletail-SMIME-Makefile.PL.patch</a><br />
<span class="downloadcontenttype">text/x-diff 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">*** ext/Tripletail-SMIME/Makefile.PL.dist	Wed Aug 16 18:36:18 2006
--- ext/Tripletail-SMIME/Makefile.PL	Wed Aug 16 18:20:59 2006
***************
*** 5,10 ****
--- 5,21 ----
  my $OPENSSL_LIBS = $ENV{LDFLAGS} || &#39;&#39;;
  my $OPENSSL_CFLAGS = $ENV{CFLAGS} || &#39;&#39;;
  
+   my $openssl_path=&#39;&#39;;
+   if&#40;$^O eq &#39;MSWin32&#39;&#41; {
+     $openssl_path=&#39;c:/openssl&#39;  if -x &#39;c:/openssl/bin/openssl.exe&#39;;
+     if &#40;$openssl_path&#41; {
+      $OPENSSL_CFLAGS.=&#34; -I$openssl_path/include&#34;;
+      $OPENSSL_LIBS.=&#34; -L$openssl_path/lib -lssleay32 -llibeay32&#34;;
+     }
+   } else {
+    $OPENSSL_LIBS.=&#34; -L$openssl_path/lib -lcrypto&#34;;
+   }
+ 
  WriteMakefile&#40;
      NAME                =&gt; &#39;Tripletail::SMIME&#39;,
      AUTHOR              =&gt; &#39;Ymirlink &lt;tl@tripletail.jp&gt;&#39;,
***************
*** 14,20 ****
      PREREQ_PM =&gt; {
          &#39;Test::More&#39; =&gt; 0,
      },
!     LIBS                =&gt; [&#34;$OPENSSL_LIBS -lcrypto&#34;],
      INC                 =&gt; &#34;$OPENSSL_CFLAGS&#34;,
      dist                =&gt; { COMPRESS =&gt; &#39;gzip -9f&#39;, SUFFIX =&gt; &#39;gz&#39;, },
      clean               =&gt; { FILES =&gt; &#39;Tripletail-SMIME-*&#39; },
--- 25,31 ----
      PREREQ_PM =&gt; {
          &#39;Test::More&#39; =&gt; 0,
      },
!     LIBS                =&gt; [&#34;$OPENSSL_LIBS&#34;],
      INC                 =&gt; &#34;$OPENSSL_CFLAGS&#34;,
      dist                =&gt; { COMPRESS =&gt; &#39;gzip -9f&#39;, SUFFIX =&gt; &#39;gz&#39;, },
      clean               =&gt; { FILES =&gt; &#39;Tripletail-SMIME-*&#39; },
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-232958" href="/Public/Bug/Display.html?id=21024#txn-232958">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;16&nbsp;15:34:42&nbsp;2006</span>
    <span class="description">alexchorny [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> patch for Tripletail::SMIME test under Windows</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Alexandr Ciornii &lt;alexchorny [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/232958/97565/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/97565">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 282b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Patched smime.t to use c:\openssl\bin\openssl.exe and Windows nul.
Test still fails for me, because my openssl cannot find it&#39;s
configuration file &#40;with error &#34;Unable to load config info from
/usr/local/ssl/openssl.cnf&#34;&#41; on second call.

-------
Alexandr Ciornii, <span class="clickylink"><a target="new" rel="nofollow" href="http://chorny.net">http://chorny.net</a></span>
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/232958/97568/smime.t">Download smime.t</a><br />
<span class="downloadcontenttype">text/x-perl 2.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">use Test::More tests =&gt; 23;
use Test::Exception;
use strict;
use warnings;

BEGIN {
    use Tripletail::SMIME;
    my $openssl = &#39;/usr/local/ymir/perl/openssl/bin/openssl&#39;;
    my $null=&#39;/dev/null&#39;;
    if&#40;$^O eq &#39;MSWin32&#39;&#41; {
        $openssl = &#39;c:\openssl\bin\openssl.exe&#39;;
        $null=&#39;null&#39;;
    }
    if &#40;!-x $openssl&#41; {
        $openssl = &#39;/usr/bin/openssl&#39;;
    }

    foreach my $i &#40;1 .. 2&#41; {
	system&#40;qq{$openssl genrsa &gt; tmp$i-$$.key 2&gt;$null}&#41; and die $!;
        system&#40;qq{yes &#34;&#34; | $openssl req -new -key tmp$i-$$.key -out tmp$i-$$.csr 2&gt;&#38;1 &gt;$null}&#41; and die $!;
	system&#40;qq{$openssl x509 -in tmp$i-$$.csr -out tmp$i-$$.crt -req -signkey tmp$i-$$.key 2&gt;&#38;1 &gt;$null}&#41; and die $!;
    }
}

END {
    foreach my $i &#40;1 .. 2&#41; {
	unlink &#34;tmp$i-$$.key&#34;, &#34;tmp$i-$$.csr&#34;, &#34;tmp$i-$$.crt&#34;;
    }
}

sub key {
    my $i = shift;

    local $/ = undef;
    open my $fh, &#39;&lt;&#39;, &#34;tmp$i-$$.key&#34;;
    &lt;$fh&gt;;
}

sub crt {
    my $i = shift;

    local $/ = undef;
    open my $fh, &#39;&lt;&#39;, &#34;tmp$i-$$.crt&#34;;
    &lt;$fh&gt;;
}

my $plain = q{From: alice@example.org
To: bob@example.org
Subject: Tripletail::SMIME test

This is a test mail. Please ignore...
};
$plain =~ s/\r?\n|\r/\r\n/g;
my $verify = q{Subject: Tripletail::SMIME test

This is a test mail. Please ignore...
};
$verify =~ s/\r?\n|\r/\r\n/g;

#-----------------------

my $smime;
ok&#40;$smime = Tripletail::SMIME-&gt;new, &#39;new&#39;&#41;;

ok&#40;$smime-&gt;setPrivateKey&#40;key&#40;1&#41;, crt&#40;1&#41;&#41;, &#39;setPrivateKey &#40;without passphrase&#41;&#39;&#41;;

dies_ok {$smime-&gt;sign} &#39;sign undef&#39;;
dies_ok {$smime-&gt;sign&#40;\123&#41;} &#39;sign ref&#39;;
dies_ok {$smime-&gt;signonly} &#39;signonly undef&#39;;
dies_ok {$smime-&gt;signonly&#40;\123&#41;} &#39;signonly ref&#39;;
dies_ok {$smime-&gt;encrypt} &#39;encrypt undef&#39;;
dies_ok {$smime-&gt;encrypt&#40;\123&#41;} &#39;encrypt ref&#39;;
dies_ok {$smime-&gt;isSigned} &#39;isSigned undef&#39;;
dies_ok {$smime-&gt;isSigned&#40;\123&#41;} &#39;isSigned ref&#39;;
dies_ok {$smime-&gt;isEncrypted} &#39;isEncrypted undef&#39;;
dies_ok {$smime-&gt;isEncrypted&#40;\123&#41;} &#39;isEncrypted ref&#39;;

my $signed;
ok&#40;$signed = $smime-&gt;sign&#40;$plain&#41;, &#39;sign&#39;&#41;;
ok&#40;$smime-&gt;isSigned&#40;$signed&#41;, &#39;signed&#39;&#41;;

ok&#40;$smime-&gt;setPublicKey&#40;crt&#40;1&#41;&#41;, &#39;setPublicKey &#40;one key&#41;&#39;&#41;;

my $checked;
ok&#40;$checked = $smime-&gt;check&#40;$signed&#41;, &#39;check&#39;&#41;;
is&#40;$checked, $verify, &#39;$verify eq check&#40;sign&#40;$plain&#41;&#41;&#39;&#41;;

ok&#40;$smime-&gt;setPublicKey&#40;[crt&#40;1&#41;, crt&#40;2&#41;]&#41;, &#39;setPublicKey &#40;two keys&#41;&#39;&#41;;

my $encrypted;
ok&#40;$encrypted = $smime-&gt;encrypt&#40;$plain&#41;, &#39;encrypt&#39;&#41;;
ok&#40;$smime-&gt;isEncrypted&#40;$encrypted&#41;, &#39;isEncrypted&#39;&#41;;

my $decrypted;
ok&#40;$decrypted = $smime-&gt;decrypt&#40;$encrypted&#41;, &#39;decrypt &#40;by sender\&#39;s key&#41;&#39;&#41;;
is&#40;$decrypted, $verify, &#39;$plain eq decrypt&#40;encrypt&#40;$plain&#41;&#41;&#39;&#41;;

$smime-&gt;setPrivateKey&#40;key&#40;2&#41;, crt&#40;2&#41;&#41;;
ok&#40;$decrypted = $smime-&gt;decrypt&#40;$encrypted&#41;, &#39;decrypt &#40;by recipient\&#39;s key&#41;&#39;&#41;;

1;
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/232958/97571/smime.t.patch">Download smime.t.patch</a><br />
<span class="downloadcontenttype">text/x-diff 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">*** smime.t.dist	Tue Aug 15 08:08:06 2006
--- smime.t	Wed Aug 16 22:10:12 2006
***************
*** 6,19 ****
  BEGIN {
      use Tripletail::SMIME;
      my $openssl = &#39;/usr/local/ymir/perl/openssl/bin/openssl&#39;;
      if &#40;!-x $openssl&#41; {
          $openssl = &#39;/usr/bin/openssl&#39;;
      }
  
      foreach my $i &#40;1 .. 2&#41; {
! 	system&#40;qq{$openssl genrsa &gt; tmp$i-$$.key 2&gt;/dev/null}&#41; and die $!;
!         system&#40;qq{yes &#34;&#34; | $openssl req -new -key tmp$i-$$.key -out tmp$i-$$.csr 2&gt;&#38;1 &gt;/dev/null}&#41; and die $!;
! 	system&#40;qq{$openssl x509 -in tmp$i-$$.csr -out tmp$i-$$.crt -req -signkey tmp$i-$$.key 2&gt;&#38;1 &gt;/dev/null}&#41; and die $!;
      }
  }
  
--- 6,24 ----
  BEGIN {
      use Tripletail::SMIME;
      my $openssl = &#39;/usr/local/ymir/perl/openssl/bin/openssl&#39;;
+     my $null=&#39;/dev/null&#39;;
+     if&#40;$^O eq &#39;MSWin32&#39;&#41; {
+         $openssl = &#39;c:\openssl\bin\openssl.exe&#39;;
+         $null=&#39;null&#39;;
+     }
      if &#40;!-x $openssl&#41; {
          $openssl = &#39;/usr/bin/openssl&#39;;
      }
  
      foreach my $i &#40;1 .. 2&#41; {
! 	system&#40;qq{$openssl genrsa &gt; tmp$i-$$.key 2&gt;$null}&#41; and die $!;
!         system&#40;qq{yes &#34;&#34; | $openssl req -new -key tmp$i-$$.key -out tmp$i-$$.csr 2&gt;&#38;1 &gt;$null}&#41; and die $!;
! 	system&#40;qq{$openssl x509 -in tmp$i-$$.csr -out tmp$i-$$.crt -req -signkey tmp$i-$$.key 2&gt;&#38;1 &gt;$null}&#41; and die $!;
      }
  }
  
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-233418" href="/Public/Bug/Display.html?id=21024#txn-233418">#</a>      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;18&nbsp;01:16:31&nbsp;2006</span>
    <span class="description">HIO [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/233418/97833/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/97833">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 185b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">both problems are fixed. 
I used precompiled openssl library, and that runs well.
my environment is:
+ Visual Studio .Net 2003
+ ActivePerl 5.8.8 Build 817
+ OpenSSL 0.9.8b

thank you.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-233419" href="/Public/Bug/Display.html?id=21024#txn-233419">#</a>      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;18&nbsp;01:16:32&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people AddWatcher odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-233425" href="/Public/Bug/Display.html?id=21024#txn-233425">#</a>      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;18&nbsp;01:37:32&nbsp;2006</span>
    <span class="description">mikage [...] ymir.co.jp -  AdminCc HIO added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Give even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-233426" href="/Public/Bug/Display.html?id=21024#txn-233426">#</a>      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;18&nbsp;01:37:43&nbsp;2006</span>
    <span class="description">mikage [...] ymir.co.jp -  Given to HIO</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-233432" href="/Public/Bug/Display.html?id=21024#txn-233432">#</a>      
    </span>
    <span class="date">Fri&nbsp;Aug&nbsp;18&nbsp;01:47:15&nbsp;2006</span>
    <span class="description">HIO [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.730302</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
