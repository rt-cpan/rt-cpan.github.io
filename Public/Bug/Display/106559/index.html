<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #106559 for Net-SFTP-Foreign: setcwd fails in taint mode</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #106559 for Net-SFTP-Foreign: setcwd fails in taint mode</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-SFTP-Foreign/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-SFTP-Foreign/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-SFTP-Foreign/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-SFTP-Foreign/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-SFTP-Foreign">Net-SFTP-Foreign CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">106559</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-SFTP-Foreign/Active/">Net-SFTP-Foreign</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
Julian.Bridle [...] mrhgb.co.uk

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-23164-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-23165-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;20&nbsp;06:04:55&nbsp;2015</span>
    <span class="description">Julian.Bridle [...] mrhgb.co.uk -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> setcwd fails in taint mode</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 20 Aug 2015 10:04:26 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;&#39;bug-Net-SFTP-Foreign [...] rt.cpan.org&#39;&#34; &lt;bug-Net-SFTP-Foreign [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Julian Bridle &lt;Julian.Bridle [...] mrhgb.co.uk&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Firstly, thank you for the Net::SFTP:Foreign module.  I use it for a communications subsystem transferring files between various third parties using a mixture of protocols and encryption, and have found it very useful alongside Net::FTP and LWP.  On porting this system to a new server, I encountered a new problem.  I realise something similar has been reported before with an incorrect example, but I&#39;m reasonably experienced with taint mode and I&#39;m pretty sure there is a bug:

If I pass a guaranteed untainted variable &#40;a literal value of &#34;/&#34; in this test case&#41; to the setcwd method, it fails with a taint error.

$remote-&gt;setcwd&#40;&#34;/&#34;&#41;;

The environment where this issue occurs is:

debian Jessie 8.1
perl 5.20.2
Net::SFTP::Foreign 1.77  &#40;standard Jessie package libnet-sftp-foreign-perl&#41;

My old environment does NOT exhibit the problem with the same test script:

debian squeeze 6.0.4
perl 5.10.1
Net::SFTP::Foreign 1.57  &#40;standard squeeze package libnet-sftp-foreign-perl&#41;

I attach a test case. To show the error.

perl setcwd_test.prl
[ unsorted list of files/directories ]

perl -T setcwd_test.prl
Insecure argument &#39;/&#39; on &#39;stat&#39; method call while running with -T switch at setcwd_test.prl line 13.

Regards,

Julian Bridle

This e-mail has been sent by a company that is a member of the MRH &#40;GB&#41; Limited group of companies. MRH &#40;GB&#41; Limited is a company registered in England and Wales with the registration number 6360543. The Registered Office is Vincent House, 4 Grove Lane, Epping, Essex, CM16 4LH. Tel: +44 &#40;0&#41;1992 571937, Fax: +44 &#40;0&#41;1992 571950. The VAT Registration Number is: 718 6378 04. Different VAT numbers are in use by some of the other companies within the MRH &#40;GB&#41; Limited group. Confidentiality: This e-mail and its attachments are confidential, may be legally privileged and are intended solely for the above named addressee&#40;s&#41;. However, in certain circumstances the contents of this e-mail may have to be disclosed in response to a request pursuant to the Data Protection Act. If you have received this e-mail in error you must take no action based on it or its attachments, nor must you copy or show them to anyone. You must notify the sender immediately and then delete the e-mail and any attachments. Security: Please note that this e-mail has been created in the knowledge that Internet e-mail is not a 100% secure communications medium. E-mails are susceptible to interference. If you are in any doubt about the origins of this e-mail or whether its original content has been accurately reproduced, please verify its authenticity with the sender. We advise that you understand and observe this lack of security when e-mailing us. Viruses: Although reasonable steps have been taken to ensure that this e-mail and its attachments are free from any virus, we advise that in keeping with good computing practice the recipient should ensure that they are actually virus free.
</div></div>

<div class="messagebody">
</div>
</div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;04&nbsp;15:54:18&nbsp;2015</span>
    <span class="description">CHOROBA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The error comes from setcwd from the following line&#40;s&#41;:

            my $a = $sftp-&gt;stat&#40;$cwd&#41;
                or return undef;

$cwd is tainted, it comes from

            $cwd = $sftp-&gt;realpath&#40;$cwd&#41;;

realpath is defined as follows:

*realpath = _gen_getpath_method&#40;SSH2_FXP_REALPATH,
                                SFTP_ERR_REMOTE_REALPATH_FAILED,
                                &#34;realpath&#34;&#41;;

In the sub returned from _gen_getpath_method, the path is created as

    return $sftp-&gt;_fs_decode&#40;$msg-&gt;get_str&#41;;

I&#39;m not sure which part is the correct one for untainting.

Ch.

On Thu Aug 20 06:04:55 2015, Julian.Bridle@mrhgb.co.uk wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Firstly, thank you for the Net::SFTP:Foreign module.  I use it for a
&gt; communications subsystem transferring files between various third
&gt; parties using a mixture of protocols and encryption, and have found it
&gt; very useful alongside Net::FTP and LWP.  On porting this system to a
&gt; new server, I encountered a new problem.  I realise something similar
&gt; has been reported before with an incorrect example, but I&#39;m reasonably
&gt; experienced with taint mode and I&#39;m pretty sure there is a bug:
&gt; 
&gt; If I pass a guaranteed untainted variable &#40;a literal value of &#34;/&#34; in
&gt; this test case&#41; to the setcwd method, it fails with a taint error.
&gt; 
&gt; $remote-&gt;setcwd&#40;&#34;/&#34;&#41;;
&gt; 
&gt; The environment where this issue occurs is:
&gt; 
&gt; debian Jessie 8.1
&gt; perl 5.20.2
&gt; Net::SFTP::Foreign 1.77  &#40;standard Jessie package libnet-sftp-foreign-
&gt; perl&#41;
&gt; 
&gt; My old environment does NOT exhibit the problem with the same test
&gt; script:
&gt; 
&gt; debian squeeze 6.0.4
&gt; perl 5.10.1
&gt; Net::SFTP::Foreign 1.57  &#40;standard squeeze package libnet-sftp-
&gt; foreign-perl&#41;
&gt; 
&gt; I attach a test case. To show the error.
&gt; 
&gt; perl setcwd_test.prl
&gt; [ unsorted list of files/directories ]
&gt; 
&gt; perl -T setcwd_test.prl
&gt; Insecure argument &#39;/&#39; on &#39;stat&#39; method call while running with -T
&gt; switch at setcwd_test.prl line 13.
&gt; 
&gt; Regards,
&gt; 
&gt; Julian Bridle
&gt; 
&gt; This e-mail has been sent by a company that is a member of the MRH
&gt; &#40;GB&#41; Limited group of companies. MRH &#40;GB&#41; Limited is a company
&gt; registered in England and Wales with the registration number 6360543.
&gt; The Registered Office is Vincent House, 4 Grove Lane, Epping, Essex,
&gt; CM16 4LH. Tel: +44 &#40;0&#41;1992 571937, Fax: +44 &#40;0&#41;1992 571950. The VAT
&gt; Registration Number is: 718 6378 04. Different VAT numbers are in use
&gt; by some of the other companies within the MRH &#40;GB&#41; Limited group.
&gt; Confidentiality: This e-mail and its attachments are confidential, may
&gt; be legally privileged and are intended solely for the above named
&gt; addressee&#40;s&#41;. However, in certain circumstances the contents of this
&gt; e-mail may have to be disclosed in response to a request pursuant to
&gt; the Data Protection Act. If you have received this e-mail in error you
&gt; must take no action based on it or its attachments, nor must you copy
&gt; or show them to anyone. You must notify the sender immediately and
&gt; then delete the e-mail and any attachments. Security: Please note that
&gt; this e-mail has been created in the knowledge that Internet e-mail is
&gt; not a 100% secure communications medium. E-mails are susceptible to
&gt; interference. If you are in any doubt about the origins of this e-mail
&gt; or whether its original content has been accurately reproduced, please
&gt; verify its authenticity with the sender. We advise that you understand
&gt; and observe this lack of security when e-mailing us. Viruses: Although
&gt; reasonable steps have been taken to ensure that this e-mail and its
&gt; attachments are free from any virus, we advise that in keeping with
&gt; good computing practice the recipient should ensure that they are
&gt; actually virus free.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;04&nbsp;15:54:18&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;06&nbsp;08:34:24&nbsp;2015</span>
    <span class="description">sfandino [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #106559] setcwd fails in taint mode</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 6 Oct 2015 12:34:09 +0000 &#40;UTC&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-Net-SFTP-Foreign [...] rt.cpan.org&#34; &lt;bug-Net-SFTP-Foreign [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Salvador Fandino &lt;sfandino [...] yahoo.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">



<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">----- Original Message -----
<div class="message-stanza open">&gt; From: E. Choroba via RT &lt;bug-Net-SFTP-Foreign@rt.cpan.org&gt;
&gt; To: 
&gt; Cc: 
&gt; Sent: Sunday, October 4, 2015 9:54 PM
&gt; Subject: [rt.cpan.org #106559] setcwd fails in taint mode
&gt; 
&gt;        Queue: Net-SFTP-Foreign
&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=106559">https://rt.cpan.org/Ticket/Display.html?id=106559</a></span> &gt;
&gt; 
&gt; The error comes from setcwd from the following line&#40;s&#41;:
&gt; 
&gt;             my $a = $sftp-&gt;stat&#40;$cwd&#41;
&gt;                 or return undef;
&gt; 
&gt; $cwd is tainted, it comes from
&gt; 
&gt;             $cwd = $sftp-&gt;realpath&#40;$cwd&#41;;
&gt; 
&gt; realpath is defined as follows:
&gt; 
&gt; *realpath = _gen_getpath_method&#40;SSH2_FXP_REALPATH,
&gt;                 SFTP_ERR_REMOTE_REALPATH_FAILED,
&gt;                 &#34;realpath&#34;&#41;;
&gt; 
&gt; In the sub returned from _gen_getpath_method, the path is created as
&gt; 
&gt;     return $sftp-&gt;_fs_decode&#40;$msg-&gt;get_str&#41;;
&gt; 
</div>
<div class="message-stanza open">&gt; I&#39;m not sure which part is the correct one for untainting.
</div>
That is a tricky matter as the data coming from the SFTP connection should be left marked as tainted.

For now, it is just untainting the realpath coming from the remote host explicitly inside setcwd. A new developing version of the module with that fix is available:

<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/release/SALVA/Net-SFTP-Foreign-1.78_07">https://metacpan.org/release/SALVA/Net-SFTP-Foreign-1.78_07</a></span>

Anyway, other high level methods would probably have similar issues. Don&#39;t hesitate to report them if you find any.


Thank you!
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;06&nbsp;09:38:33&nbsp;2015</span>
    <span class="description">salva [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;08&nbsp;06:25:47&nbsp;2015</span>
    <span class="description">Julian.Bridle [...] mrhgb.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #106559] setcwd fails in taint mode</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 8 Oct 2015 10:25:21 +0000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;&#39;bug-Net-SFTP-Foreign [...] rt.cpan.org&#39;&#34; &lt;bug-Net-SFTP-Foreign [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Julian Bridle &lt;Julian.Bridle [...] mrhgb.co.uk&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for that - I&#39;ll give it a try.

Julian

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Salvador \&#34;Fandiño\&#34; via RT [mailto:bug-Net-SFTP-Foreign@rt.cpan.org]
Sent: 06 October 2015 13:34
To: Julian Bridle
Subject: Re: [rt.cpan.org #106559] setcwd fails in taint mode

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=106559">https://rt.cpan.org/Ticket/Display.html?id=106559</a></span> &gt;





<div class="message-stanza open">----- Original Message -----
<div class="message-stanza open">&gt; From: E. Choroba via RT &lt;bug-Net-SFTP-Foreign@rt.cpan.org&gt;
&gt; To:
&gt; Cc:
&gt; Sent: Sunday, October 4, 2015 9:54 PM
&gt; Subject: [rt.cpan.org #106559] setcwd fails in taint mode
&gt;
&gt;        Queue: Net-SFTP-Foreign
&gt; Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=106559">https://rt.cpan.org/Ticket/Display.html?id=106559</a></span> &gt;
&gt;
&gt; The error comes from setcwd from the following line&#40;s&#41;:
&gt;
&gt;             my $a = $sftp-&gt;stat&#40;$cwd&#41;
&gt;                 or return undef;
&gt;
&gt; $cwd is tainted, it comes from
&gt;
&gt;             $cwd = $sftp-&gt;realpath&#40;$cwd&#41;;
&gt;
&gt; realpath is defined as follows:
&gt;
&gt; *realpath = _gen_getpath_method&#40;SSH2_FXP_REALPATH,
&gt;                 SFTP_ERR_REMOTE_REALPATH_FAILED,
&gt;                 &#34;realpath&#34;&#41;;
&gt;
&gt; In the sub returned from _gen_getpath_method, the path is created as
&gt;
&gt;     return $sftp-&gt;_fs_decode&#40;$msg-&gt;get_str&#41;;
&gt;
</div>
<div class="message-stanza open">&gt; I&#39;m not sure which part is the correct one for untainting.
</div>
That is a tricky matter as the data coming from the SFTP connection should be left marked as tainted.

For now, it is just untainting the realpath coming from the remote host explicitly inside setcwd. A new developing version of the module with that fix is available:

<span class="clickylink"><a target="new" rel="nofollow" href="https://metacpan.org/release/SALVA/Net-SFTP-Foreign-1.78_07">https://metacpan.org/release/SALVA/Net-SFTP-Foreign-1.78_07</a></span>

Anyway, other high level methods would probably have similar issues. Don&#39;t hesitate to report them if you find any.


Thank you!


This e-mail has been sent by a company that is a member of the MRH &#40;GB&#41; Limited group of companies. MRH &#40;GB&#41; Limited is a company registered in England and Wales with the registration number 6360543. The Registered Office is Vincent House, 4 Grove Lane, Epping, Essex, CM16 4LH. Tel: +44 &#40;0&#41;1992 571937, Fax: +44 &#40;0&#41;1992 571950. The VAT Registration Number is: 718 6378 04. Different VAT numbers are in use by some of the other companies within the MRH &#40;GB&#41; Limited group. Confidentiality: This e-mail and its attachments are confidential, may be legally privileged and are intended solely for the above named addressee&#40;s&#41;. However, in certain circumstances the contents of this e-mail may have to be disclosed in response to a request pursuant to the Data Protection Act. If you have received this e-mail in error you must take no action based on it or its attachments, nor must you copy or show them to anyone. You must notify the sender immediately and then delete the e-mail and any attachments. Security: Please note that this e-mail has been created in the knowledge that Internet e-mail is not a 100% secure communications medium. E-mails are susceptible to interference. If you are in any doubt about the origins of this e-mail or whether its original content has been accurately reproduced, please verify its authenticity with the sender. We advise that you understand and observe this lack of security when e-mailing us. Viruses: Although reasonable steps have been taken to ensure that this e-mail and its attachments are free from any virus, we advise that in keeping with good computing practice the recipient should ensure that they are actually virus free.
</div></div></div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
