<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #41938 for Perl-Critic: Perl::Critic::Policy::Variables::ProhibitMatchVars exception</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #41938 for Perl-Critic: Perl::Critic::Policy::Variables::ProhibitMatchVars exception</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Perl-Critic/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Perl-Critic/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Perl-Critic/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Perl-Critic/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/Perl-Critic/Perl-Critic/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/Perl-Critic">Perl-Critic CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">41938</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Perl-Critic/Active/">Perl-Critic</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
jpierce [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-25198-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.093_03    </td>
  </tr>
  <tr id="CF-25199-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;24&nbsp;15:47:59&nbsp;2008</span>
    <span class="description">jpierce [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Perl::Critic::Policy::Variables::ProhibitMatchVars exception</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Perl::Critic::Policy::Variables::ProhibitMatchVars should permit English
match vars if they&#39;re &#40;likely&#41; from Regexp::MatchContext
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;24&nbsp;17:24:45&nbsp;2008</span>
    <span class="description">perl [...] galumph.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #41938] Perl::Critic::Policy::Variables::ProhibitMatchVars exception</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 24 Dec 2008 16:24:29 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Perl-Critic [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Elliot Shank &lt;perl [...] galumph.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Jerrad Pierce via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Perl::Critic::Policy::Variables::ProhibitMatchVars should permit English
&gt; match vars if they&#39;re &#40;likely&#41; from Regexp::MatchContext
</div>
Ew.  I don&#39;t see much point to the module.  Why not just use captures to get the stuff in front and in back? 

    m/\A&#40;.*&#41;&#40;whatever&#41;&#40;.*&#41;\z/s

I don&#39;t think use of variables with the same names as those from English should be used because it encourages their use even when that module isn&#39;t present.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;24&nbsp;17:24:46&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;24&nbsp;17:57:23&nbsp;2008</span>
    <span class="description">belg4mit [...] MIT.EDU -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #41938] Perl::Critic::Policy::Variables::ProhibitMatchVars exception</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 24 Dec 2008 17:52:09 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Perl-Critic [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jerrad Pierce &lt;belg4mit [...] MIT.EDU&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;Ew.  I don&#39;t see much point to the module.  Why not just use captures to get
&gt;the stuff in front and in back? 
</div>...
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;I don&#39;t think use of variables with the same names as those from English
&gt;should be used because it encourages their use even when that module isn&#39;t present.
</div>Neither of these opinions really speaks to the *accuracy* of this policy meant
to save one from a marginal performance hit, which is what this bug is about.
&lt;<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=41936">https://rt.cpan.org/Ticket/Display.html?id=41936</a></span>&gt;

But if you must have some justification of the module&#39;s existence in order
to ammend this code so that it is robust and accurate: unlike the internal
implementation of these variables, ContextMatch results can be assigned to.

Besides which you&#39;re also forbidding the perfectly legitimate:

   do{ $PREMATCH = $1; $MATCH =$2; $POSTMATCH = $3 } if /\A&#40;.*&#41;&#40;EXPR&#41;&#40;.*&#41;\Z/

These variable names are logical and self-descriptive, and there&#39;s no
reason to forbid them so absolutely except for the complexity of accurately
checking for the forms described in the documentation. If the current
draconian form persists, more accurate documentation and diagnostics are
warranted.
-- 
Free map of local environmental resources: <span class="clickylink"><a target="new" rel="nofollow" href="http://CambridgeMA.GreenMap.org">http://CambridgeMA.GreenMap.org</a></span>
--
MOTD on Pungenday, the 66th of The Aftermath, in the YOLD 3174:
Honi soit la vache qui rit.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;24&nbsp;21:14:32&nbsp;2008</span>
    <span class="description">perl [...] galumph.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #41938] Perl::Critic::Policy::Variables::ProhibitMatchVars exception</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 24 Dec 2008 20:14:21 -0600</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Perl-Critic [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Elliot Shank &lt;perl [...] galumph.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Jerrad Pierce via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt;&gt; I don&#39;t think use of variables with the same names as those from English
&gt;&gt; should be used because it encourages their use even when that module isn&#39;t present.
</div>&gt;
&gt; Neither of these opinions really speaks to the *accuracy* of this policy meant
&gt; to save one from a marginal performance hit, which is what this bug is about.
</div>[chop]
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Besides which you&#39;re also forbidding the perfectly legitimate:
&gt; 
&gt;    do{ $PREMATCH = $1; $MATCH =$2; $POSTMATCH = $3 } if /\A&#40;.*&#41;&#40;EXPR&#41;&#40;.*&#41;\Z/
</div>
You&#39;re misunderstanding me.  Due to the history of English, I believe those names should not be used, period.

I personally won&#39;t change that policy to allow them, but that doesn&#39;t mean that you can&#39;t convince one of the other P::C developers to make the change.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Dec&nbsp;24&nbsp;21:52:18&nbsp;2008</span>
    <span class="description">belg4mit [...] MIT.EDU -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #41938] Perl::Critic::Policy::Variables::ProhibitMatchVars exception</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 24 Dec 2008 21:46:05 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Perl-Critic [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Jerrad Pierce &lt;belg4mit [...] MIT.EDU&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Okay, your position is clearer, if not extreme and subjective.

As the link in my previous message shows &#40;though I didn&#39;t explicitly point
it out&#41; the impact of saw ampersand and friends is seriously overstated.
Regardless, I also suggested that if the test is going to conintue to
completely forbid them, the documentation should better explain why*:

Someone at one time made these variables do questionable things so unless
you remove this policy we&#39;ll never allow you to use these names, even if
you&#39;re doing so &#34;safely.&#34;

Even with better documentation perhaps there should be an additional,
&#34;laxer&#34; policy that should have a higher severity than the existing
&#40;revised severity&#41; policy &#40;as per Perl::Critic::Policy::default_severity&#41;?
i.e; Perl::Critic::Policy::Variables::Prohibit*Unsafe*MatchVars

* And ideally list the alternatives, something lacking in many of the PODs
-- 
Free map of local environmental resources: <span class="clickylink"><a target="new" rel="nofollow" href="http://CambridgeMA.GreenMap.org">http://CambridgeMA.GreenMap.org</a></span>
--
MOTD on Pungenday, the 66th of The Aftermath, in the YOLD 3174:
Honi soit la vache qui rit.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;26&nbsp;22:50:59&nbsp;2008</span>
    <span class="description">jpierce [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Patches for ProhibitMatchVars exception</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;ve clarified the text of the POD in ProhibitMatchVars,
and changed it to medium severity.

The new ProhibitCOREMatchVars is a modified variant
&#40;still high severity&#41; of the original ProhibitMatchVars
that should allow the various cases previously discussed.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">##############################################################################
#      $URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://perlcritic.tigris.org/svn/perlcritic/tags/Perl-Critic-1.092/lib/Perl/Critic/Policy/Variables/ProhibitMatchVars.pm">http://perlcritic.tigris.org/svn/perlcritic/tags/Perl-Critic-1.092/lib/Perl/Critic/Policy/Variables/ProhibitMatchVars.pm</a></span> $
#     $Date: 2008-09-02 09:43:48 -0700 &#40;Tue, 02 Sep 2008&#41; $
#   $Author: thaljef $
# $Revision: 2721 $
##############################################################################

package Perl::Critic::Policy::Variables::ProhibitMatchVars;

use 5.006001;
use strict;
use warnings;
use Readonly;

use Perl::Critic::Utils qw{ :severities :data_conversion };
use base &#39;Perl::Critic::Policy&#39;;

our $VERSION = &#39;1.092&#39;;

#-----------------------------------------------------------------------------

Readonly::Scalar my $DESC =&gt; q{Match variable used};
Readonly::Scalar my $EXPL =&gt; [ 82 ];

Readonly::Array my @FORBIDDEN =&gt; qw&#40; $` $&#38; $&#39; $MATCH $PREMATCH $POSTMATCH &#41;;
Readonly::Hash my %FORBIDDEN =&gt; hashify&#40; @FORBIDDEN &#41;;

#-----------------------------------------------------------------------------

sub supported_parameters { return &#40;&#41;                  }
sub default_severity     { return $SEVERITY_MEDIUM    }
sub default_themes       { return qw&#40; core bugs pbp &#41; }
sub applies_to           { return qw&#40; PPI::Token::Symbol
                                      PPI::Statement::Include &#41; }

#-----------------------------------------------------------------------------

sub violates {
    my &#40; $self, $elem, undef &#41; = @_;
    if &#40;_is_use_english&#40;$elem&#41; ||
         #Explicit import of match vars
        _is_use_english&#40;$elem&#41;
        return $self-&gt;violation&#40; $DESC, $EXPL, $elem &#41;;
    }
    return;  #ok!
}

#-----------------------------------------------------------------------------

sub _is_use_english {
    my $elem = shift;
    $elem-&gt;isa&#40;&#39;PPI::Statement::Include&#39;&#41; || return;
    $elem-&gt;type&#40;&#41; eq &#39;use&#39; || return;
    $elem-&gt;module&#40;&#41; eq &#39;English&#39; || return;

    # Bare, lacking -no_match_vars.  Now handled by
    # Modules::RequireNoMatchVarsWithUseEnglish.
    return 0 if &#40;$elem =~ m/\A use \s+ English \s* ;\z/xms&#41;;

    return 1 if &#40;$elem =~ m/\$&#40;?:PRE|POST|&#41;MATCH/xms&#41;;
    return;  # either &#34;-no_match_vars&#34; or a specific list
}

sub _is_forbidden_var {
    my $elem = shift;
    $elem-&gt;isa&#40;&#39;PPI::Token::Symbol&#39;&#41; || return;
    return exists $FORBIDDEN{$elem};
}

1;

__END__

#-----------------------------------------------------------------------------

=pod

=head1 NAME

Perl::Critic::Policy::Variables::ProhibitMatchVars - Avoid Saw Ampersand et al.


=head1 AFFILIATION

This Policy is part of the core L&lt;Perl::Critic|Perl::Critic&gt;
distribution.


=head1 DESCRIPTION

Using the &#34;match variables&#34; C&lt;$`&gt;, C&lt;$&#38;&gt;, and/or C&lt;$&#39;&gt; can significantly
degrade the performance of perl&#39;s regular expression engine.
See B&lt;perldoc English&gt; or PBP page 82 for more information.

This policy forbids using these variables; the C&lt;English&gt; aliases
I&lt;$PREMATCH&gt;, I&lt;$MATCH&gt;, I&lt;$POSTMATCH&gt;; or any other variables with
those names. As an alternative, consider the following idiom:

  /\A&#40;.*?&#41;&#40;PATTERN&#41;&#40;.*&#41;\Z/;

Or to avoid throwing off any numbered captures:

  /PATTERN/;
  substr&#40;$_, 0, $-[0]&#41;, substr&#40;$_, $-[0], $+[0]-$-[0]&#41;, substr&#40;$_, $+[0]&#41;;

This policy used to forbid plain C&lt;use English;&gt; because its aliasing of the
match variables involved triggers the aforementioned performance hit. However,
the message emitted for that situation was not at all clear and there is now
L&lt;Perl::Critic::Policy::Modules::RequireNoMatchVarsWithUseEnglish|Perl::Critic::Policy::Modules::RequireNoMatchVarsWithUseEnglish&gt;,
which addresses this situation directly.


=head1 CONFIGURATION

This Policy is not configurable except for the standard options.


=head1 AUTHOR

Chris Dolan &lt;cdolan@cpan.org&gt;


=head1 COPYRIGHT

Copyright &#40;c&#41; 2006-2008 Chris Dolan.  All rights reserved.

This program is free software; you can redistribute it and/or modify
it under the same terms as Perl itself.  The full text of this license
can be found in the LICENSE file included with this module.

=cut

# Local Variables:
#   mode: cperl
#   cperl-indent-level: 4
#   fill-column: 78
#   indent-tabs-mode: nil
#   c-indentation-style: bsd
# End:
# ex: set ts=8 sts=4 sw=4 tw=78 ft=perl expandtab shiftround :
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">##############################################################################
#      $URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://perlcritic.tigris.org/svn/perlcritic/tags/Perl-Critic-1.092/lib/Perl/Critic/Policy/Variables/ProhibitMatchVars.pm">http://perlcritic.tigris.org/svn/perlcritic/tags/Perl-Critic-1.092/lib/Perl/Critic/Policy/Variables/ProhibitMatchVars.pm</a></span> $
#     $Date: 2008-09-02 09:43:48 -0700 &#40;Tue, 02 Sep 2008&#41; $
#   $Author: thaljef $
# $Revision: 2721 $
##############################################################################

package Perl::Critic::Policy::Variables::ProhibitCOREMatchVars;

use 5.006001;
use strict;
use warnings;
use Readonly;

use Perl::Critic::Utils qw{ :severities :data_conversion };
use base &#39;Perl::Critic::Policy&#39;;

our $VERSION = &#39;1.092&#39;;

#-----------------------------------------------------------------------------

Readonly::Scalar my $DESC =&gt; q{Match variable used};
Readonly::Scalar my $EXPL =&gt; [ 82 ];

Readonly::Array my @FORBIDDEN =&gt; qw&#40; $` $&#38; $&#39; $MATCH $PREMATCH $POSTMATCH &#41;;
Readonly::Hash  my %FORBIDDEN =&gt; hashify&#40; @FORBIDDEN &#41;;

#-----------------------------------------------------------------------------

sub supported_parameters { return &#40;&#41;                  }
sub default_severity     { return $SEVERITY_HIGH      }
sub default_themes       { return qw&#40; core bugs &#41;     }
sub applies_to           { return qw&#40; PPI::Token::Symbol
                                      PPI::Statement::Include &#41; }

#-----------------------------------------------------------------------------

sub violates {
    my &#40; $self, $elem, undef &#41; = @_;
    if &#40;_is_forbidden_var&#40;$elem&#41; ||
         #Explicit import of match vars
        _is_use_english&#40;$elem&#41;
       &#41; {
        return $self-&gt;violation&#40; $DESC, $EXPL, $elem &#41;;
    }
    return;  #ok!
}

#-----------------------------------------------------------------------------

sub _is_forbidden_var {
    my $elem = shift;
    $elem-&gt;isa&#40;&#39;PPI::Token::Symbol&#39;&#41; || return;
    return exists $FORBIDDEN{$elem};
}

sub _is_use_english {
    my $elem = shift;
    $elem-&gt;isa&#40;&#39;PPI::Statement::Include&#39;&#41; || return;
    $elem-&gt;type&#40;&#41; eq &#39;use&#39; || return;
    $elem-&gt;module&#40;&#41; eq &#39;English&#39; || return;

    # Bare, lacking -no_match_vars.  Now handled by
    # Modules::RequireNoMatchVarsWithUseEnglish.
    return 0 if &#40;$elem =~ m/\A use \s+ English \s* ;\z/xms&#41;;

    return 1 if &#40;$elem =~ m/\$&#40;?:PRE|POST|&#41;MATCH/xms&#41;;
    return;  # either &#34;-no_match_vars&#34; or a specific list
}

1;

__END__

#-----------------------------------------------------------------------------

=pod

=head1 NAME

Perl::Critic::Policy::Variables::ProhibitCOREMatchVars - Avoid most forms of Saw Ampersand et al.


=head1 AFFILIATION

This Policy is part of the core L&lt;Perl::Critic|Perl::Critic&gt; distribution.


=head1 DESCRIPTION

Using the &#34;match variables&#34; C&lt;$`&gt;, C&lt;$&#38;&gt;, and/or C&lt;$&#39;&gt; can significantly
degrade the performance of perl&#39;s regular expression engine.
See B&lt;perldoc English&gt; or PBP page 82 for more details.

This policy forbids using them or their C&lt;English&gt; aliases, but it does
permit dopplegangers such as the variable interface to the more featureful
L&lt;Regexp::MatchContext|Regexp::MatchContext&gt;, and the following idiom which
is a low-cost alternative to the native match variables:

  do{ $PREMATCH = $1; $MATCH =$2; $POSTMATCH = $3 } if /\A&#40;.*&#41;&#40;EXPR&#41;&#40;.*&#41;\Z/

If you fear potential confusion from these exceptions, 
L&lt;Perl::Critic::Policy::Variables::ProhibitMatchVars&gt;.

=head1 CONFIGURATION

This Policy is not configurable except for the standard options.


=head1 AUTHOR

Jerrad Pierce &lt;jpierce@cpan.org&gt;


=head1 COPYRIGHT

Copyright &#40;c&#41; 2006-2008 Chris Dolan.  All rights reserved.

This program is free software; you can redistribute it and/or modify
it under the same terms as Perl itself.  The full text of this license
can be found in the LICENSE file included with this module.

=cut

# Local Variables:
#   mode: cperl
#   cperl-indent-level: 4
#   fill-column: 78
#   indent-tabs-mode: nil
#   c-indentation-style: bsd
# End:
# ex: set ts=8 sts=4 sw=4 tw=78 ft=perl expandtab shiftround :
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- ProhibitMatchVars.bak	Fri Dec 26 20:51:09 2008
+++ ProhibitMatchVars.pm	Fri Dec 26 22:41:35 2008
@@ -28,7 +28,7 @@
 #-----------------------------------------------------------------------------
 
 sub supported_parameters { return &#40;&#41;                  }
-sub default_severity     { return $SEVERITY_HIGH      }
+sub default_severity     { return $SEVERITY_MEDIUM    }
 sub default_themes       { return qw&#40; core bugs pbp &#41; }
 sub applies_to           { return qw&#40; PPI::Token::Symbol
                                       PPI::Statement::Include &#41; }
@@ -37,7 +37,9 @@
 
 sub violates {
     my &#40; $self, $elem, undef &#41; = @_;
-    if &#40;_is_use_english&#40;$elem&#41; || _is_forbidden_var&#40;$elem&#41;&#41; {
+    if &#40;_is_use_english&#40;$elem&#41; ||
+         #Explicit import of match vars
+        _is_use_english&#40;$elem&#41;
         return $self-&gt;violation&#40; $DESC, $EXPL, $elem &#41;;
     }
     return;  #ok!
@@ -75,7 +77,7 @@
 
 =head1 NAME
 
-Perl::Critic::Policy::Variables::ProhibitMatchVars - Avoid C&lt;$`&gt;, C&lt;$&#38;&gt;, C&lt;$&#39;&gt; and their English equivalents.
+Perl::Critic::Policy::Variables::ProhibitMatchVars - Avoid Saw Ampersand et al.
 
 
 =head1 AFFILIATION
@@ -86,14 +88,24 @@
 
 =head1 DESCRIPTION
 
-Using the &#34;match variables&#34; C&lt;$`&gt;, C&lt;$&#38;&gt;, and/or C&lt;$&#39;&gt; can
-significantly degrade the performance of a program.  This policy
-forbids using them or their English equivalents.  See B&lt;perldoc
-English&gt; or PBP page 82 for more information.
-
-It used to forbid plain C&lt;use English;&gt; because it ends up causing the
-performance side-effects of the match variables.  However, the message
-emitted for that situation was not at all clear and there is now
+Using the &#34;match variables&#34; C&lt;$`&gt;, C&lt;$&#38;&gt;, and/or C&lt;$&#39;&gt; can significantly
+degrade the performance of perl&#39;s regular expression engine.
+See B&lt;perldoc English&gt; or PBP page 82 for more information.
+
+This policy forbids using these variables; the C&lt;English&gt; aliases
+I&lt;$PREMATCH&gt;, I&lt;$MATCH&gt;, I&lt;$POSTMATCH&gt;; or any other variables with
+those names. As an alternative, consider the following idiom:
+
+  /\A&#40;.*?&#41;&#40;PATTERN&#41;&#40;.*&#41;\Z/;
+
+Or to avoid throwing off any numbered captures:
+
+  /PATTERN/;
+  substr&#40;$_, 0, $-[0]&#41;, substr&#40;$_, $-[0], $+[0]-$-[0]&#41;, substr&#40;$_, $+[0]&#41;;
+
+This policy used to forbid plain C&lt;use English;&gt; because its aliasing of the
+match variables involved triggers the aforementioned performance hit. However,
+the message emitted for that situation was not at all clear and there is now
 L&lt;Perl::Critic::Policy::Modules::RequireNoMatchVarsWithUseEnglish|Perl::Critic::Policy::Modules::RequireNoMatchVarsWithUseEnglish&gt;,
 which addresses this situation directly.
 
</div></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
