<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #81993 for Net-Server: Net-Server-2.006 test stuck on Windows</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #81993 for Net-Server: Net-Server-2.006 test stuck on Windows</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Net-Server/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Net-Server/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Net-Server/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Net-Server/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-Server">Net-Server CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">81993</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Net-Server/Active/">Net-Server</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
gabor [...] szabgab.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-23138-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
2.006</li>
<li>
2.007</li>
<li>
2.008</li>
<li>
2.009</li>
</ul>
    </td>
  </tr>
  <tr id="CF-23139-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;15&nbsp;03:55:32&nbsp;2012</span>
    <span class="description">gabor [...] szabgab.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Net-Server-2.006 test stuck on Windows</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 15 Dec 2012 10:55:20 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-Server [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Gabor Szabo &lt;gabor [...] szabgab.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">running Strawberry Perl 5.16.2 32 bit the test gets stuck


  CPAN.pm: Building R/RH/RHANDOM/Net-Server-2.006.tar.gz

Checking if your kit is complete...
Looks good
Writing Makefile for Net::Server
Writing MYMETA.yml and MYMETA.json
&#40;C:\strawberry_5_16_2_1\perl\bin\perl.exe Makefile.PL exited with 0&#41;
CPAN::Reporter: Makefile.PL result is &#39;pass&#39;, No errors.
cp lib/Net/Server/Proto/UDP.pm blib\lib\Net\Server\Proto\UDP.pm
cp lib/Net/Server/Proto/UNIX.pm blib\lib\Net\Server\Proto\UNIX.pm
cp lib/Net/Server/PreFork.pm blib\lib\Net\Server\PreFork.pm
cp lib/Net/Server/PSGI.pm blib\lib\Net\Server\PSGI.pm
cp lib/Net/Server/Proto/SSL.pm blib\lib\Net\Server\Proto\SSL.pm
cp lib/Net/Server.pm blib\lib\Net\Server.pm
cp lib/Net/Server/Proto/TCP.pm blib\lib\Net\Server\Proto\TCP.pm
cp lib/Net/Server/MultiType.pm blib\lib\Net\Server\MultiType.pm
cp lib/Net/Server/SIG.pm blib\lib\Net\Server\SIG.pm
cp lib/Net/Server/Proto/SSLEAY.pm blib\lib\Net\Server\Proto\SSLEAY.pm
cp lib/Net/Server/Log/Sys/Syslog.pm blib\lib\Net\Server\Log\Sys\Syslog.pm
cp lib/Net/Server/INET.pm blib\lib\Net\Server\INET.pm
cp lib/Net/Server/Fork.pm blib\lib\Net\Server\Fork.pm
cp lib/Net/Server/Multiplex.pm blib\lib\Net\Server\Multiplex.pm
cp lib/Net/Server.pod blib\lib\Net\Server.pod
cp lib/Net/Server/Proto/UNIXDGRAM.pm blib\lib\Net\Server\Proto\UNIXDGRAM.pm
cp lib/Net/Server/Log/Log/Log4perl.pm blib\lib\Net\Server\Log\Log\Log4perl.pm
cp lib/Net/Server/Daemonize.pm blib\lib\Net\Server\Daemonize.pm
cp lib/Net/Server/PreForkSimple.pm blib\lib\Net\Server\PreForkSimple.pm
cp lib/Net/Server/Proto.pm blib\lib\Net\Server\Proto.pm
cp lib/Net/Server/Single.pm blib\lib\Net\Server\Single.pm
cp lib/Net/Server/HTTP.pm blib\lib\Net\Server\HTTP.pm
C:\strawberry_5_16_2_1\perl\bin\perl.exe -MExtUtils::Command -e cp --
bin/net-server blib\script\net-server
pl2bat.bat blib\script\net-server
&#40;C:\strawberry_5_16_2_1\c\bin\dmake.exe exited with 0&#41;
CPAN::Reporter: dmake result is &#39;pass&#39;, No errors.
  RHANDOM/Net-Server-2.006.tar.gz
  C:\strawberry_5_16_2_1\c\bin\dmake.exe -- OK
Running make test
C:\strawberry_5_16_2_1\perl\bin\perl.exe &#34;-MExtUtils::Command::MM&#34;
&#34;-e&#34; &#34;test_harness&#40;0, &#39;blib\lib&#39;, &#39;blib\arch&#39;&#41;&#34; t/*.t
Error removing C:\DOCUME~1\GABORS~1\LOCALS~1\Temp\iW1Kf4ONFP.log at
C:/strawberry_5_16_2_1/perl/lib/File/Temp.pm line 890.
t/Options.t ............... ok
t/Port_Configuration.t .... ok
t/Server_BASE.t ........... ok
t/Server_Fork.t ........... ok
t/Server_http.t ........... ok
t/Server_INET.t ........... ok
t/Server_Multiplex.t ...... ok
t/Server_MultiType.t ...... ok
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;10&nbsp;03:08:54&nbsp;2013</span>
    <span class="description">paul [...] seamons.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The tests should no longer stick - though now we hopefully will see why
it is failing better.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;10&nbsp;03:08:55&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;10&nbsp;03:08:55&nbsp;2013</span>
    <span class="description">paul [...] seamons.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;10&nbsp;15:15:38&nbsp;2013</span>
    <span class="description">gabor [...] szabgab.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #81993] Net-Server-2.006 test stuck on Windows</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 10 Jan 2013 22:15:28 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-Server [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Gabor Szabo &lt;gabor [...] szabgab.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I don&#39;t see the fix in the released code.
If you add these two lines to both t\Server_PreFork.t and
t\Server_PreForkSimple.t

print &#34;1..0 # SKIP Gets stuck on Windows\n&#34; if $^O eq &#39;MSWin32&#39;;
exit&#40;0&#41;;

like  this:

use NetServerTest qw&#40;prepare_test ok use_ok diag&#41;;
print &#34;1..0 # SKIP Gets stuck on Windows\n&#34; if $^O eq &#39;MSWin32&#39;;
exit&#40;0&#41;;
my $env = prepare_test&#40;{n_tests =&gt; 5, start_port =&gt; 20600, n_ports =&gt;
2}&#41;; # runs three of its own tests

That will skip the test files on windows.

Gabor
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;10&nbsp;15:15:38&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;11&nbsp;00:30:44&nbsp;2013</span>
    <span class="description">paul [...] seamons.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #81993] Net-Server-2.006 test stuck on Windows</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 10 Jan 2013 22:30:19 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-Server [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Paul Seamons &lt;paul [...] seamons.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I&#39;d like to know what is failing - I have made them timeout faster, but 
I&#39;d like to know what is hanging, and perhaps when I can bring up a 
windows vm i will load strawberry again and try and get it going again - 
it is possible the fork servers will just have to skip since they are 
the problem because of the apparent inability to double fork in windows.

Paul

On 01/10/2013 01:15 PM, Gabor Szabo via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;         Queue: Net-Server
&gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=81993">https://rt.cpan.org/Ticket/Display.html?id=81993</a></span> &gt;
&gt;
&gt; I don&#39;t see the fix in the released code.
&gt; If you add these two lines to both t\Server_PreFork.t and
&gt; t\Server_PreForkSimple.t
&gt;
&gt; print &#34;1..0 # SKIP Gets stuck on Windows\n&#34; if $^O eq &#39;MSWin32&#39;;
&gt; exit&#40;0&#41;;
&gt;
&gt; like  this:
&gt;
&gt; use NetServerTest qw&#40;prepare_test ok use_ok diag&#41;;
&gt; print &#34;1..0 # SKIP Gets stuck on Windows\n&#34; if $^O eq &#39;MSWin32&#39;;
&gt; exit&#40;0&#41;;
&gt; my $env = prepare_test&#40;{n_tests =&gt; 5, start_port =&gt; 20600, n_ports =&gt;
&gt; 2}&#41;; # runs three of its own tests
&gt;
&gt; That will skip the test files on windows.
&gt;
&gt; Gabor
&gt;
&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;11&nbsp;00:39:39&nbsp;2013</span>
    <span class="description">gabor [...] szabgab.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #81993] Net-Server-2.006 test stuck on Windows</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 11 Jan 2013 07:39:29 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-Server [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Gabor Szabo &lt;gabor [...] szabgab.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">As they are now, the Prefork tests just get stuck which means I need
to manually stop them
or just disable smoking Net-Server.

If you&#39;d like I can check certain changes in the PreFork tests
manually and then let you know if
something happens to work.

I am also going to post on the win32 mailing list asking for other
people to take a look.

Gabor

On Fri, Jan 11, 2013 at 7:30 AM, Paul Seamons via RT
&lt;bug-Net-Server@rt.cpan.org&gt; wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=81993">https://rt.cpan.org/Ticket/Display.html?id=81993</a></span> &gt;
&gt;
&gt; I&#39;d like to know what is failing - I have made them timeout faster, but
&gt; I&#39;d like to know what is hanging, and perhaps when I can bring up a
&gt; windows vm i will load strawberry again and try and get it going again -
&gt; it is possible the fork servers will just have to skip since they are
&gt; the problem because of the apparent inability to double fork in windows.
&gt;
&gt; Paul
&gt;
&gt; On 01/10/2013 01:15 PM, Gabor Szabo via RT wrote:
<div class="message-stanza open">&gt;&gt;         Queue: Net-Server
&gt;&gt;   Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=81993">https://rt.cpan.org/Ticket/Display.html?id=81993</a></span> &gt;
&gt;&gt;
&gt;&gt; I don&#39;t see the fix in the released code.
&gt;&gt; If you add these two lines to both t\Server_PreFork.t and
&gt;&gt; t\Server_PreForkSimple.t
&gt;&gt;
&gt;&gt; print &#34;1..0 # SKIP Gets stuck on Windows\n&#34; if $^O eq &#39;MSWin32&#39;;
&gt;&gt; exit&#40;0&#41;;
&gt;&gt;
&gt;&gt; like  this:
&gt;&gt;
&gt;&gt; use NetServerTest qw&#40;prepare_test ok use_ok diag&#41;;
&gt;&gt; print &#34;1..0 # SKIP Gets stuck on Windows\n&#34; if $^O eq &#39;MSWin32&#39;;
&gt;&gt; exit&#40;0&#41;;
&gt;&gt; my $env = prepare_test&#40;{n_tests =&gt; 5, start_port =&gt; 20600, n_ports =&gt;
&gt;&gt; 2}&#41;; # runs three of its own tests
&gt;&gt;
&gt;&gt; That will skip the test files on windows.
&gt;&gt;
&gt;&gt; Gabor
&gt;&gt;
&gt;&gt;
</div>&gt;
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;29&nbsp;00:45:54&nbsp;2013</span>
    <span class="description">mmusgrove [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jan 10 03:08:54 2013, RHANDOM wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The tests should no longer stick - though now we hopefully will see why
&gt; it is failing better.
</div>
Still happening in 2.007 under Strawberry Perl 5.12.3.

Running make for R/RH/RHANDOM/Net-Server-2.007.tar.gz
Checksum for
C:\strawberry\cpan\sources\authors\id\R\RH\RHANDOM\Net-Server-2.007
.tar.gz ok

  CPAN.pm: Building R/RH/RHANDOM/Net-Server-2.007.tar.gz

Checking if your kit is complete...
Looks good
Writing Makefile for Net::Server
Writing MYMETA.yml and MYMETA.json
&#40;C:\strawberry\perl\bin\perl.exe Makefile.PL exited with 0&#41;
CPAN::Reporter: Makefile.PL result is &#39;pass&#39;, No errors.
cp lib/Net/Server/Proto/UDP.pm blib\lib\Net\Server\Proto\UDP.pm
cp lib/Net/Server/Proto/UNIX.pm blib\lib\Net\Server\Proto\UNIX.pm
cp lib/Net/Server/PreFork.pm blib\lib\Net\Server\PreFork.pm
cp lib/Net/Server/PSGI.pm blib\lib\Net\Server\PSGI.pm
cp lib/Net/Server/Proto/SSL.pm blib\lib\Net\Server\Proto\SSL.pm
cp lib/Net/Server.pm blib\lib\Net\Server.pm
cp lib/Net/Server/Proto/TCP.pm blib\lib\Net\Server\Proto\TCP.pm
cp lib/Net/Server/MultiType.pm blib\lib\Net\Server\MultiType.pm
cp lib/Net/Server/SIG.pm blib\lib\Net\Server\SIG.pm
cp lib/Net/Server/Proto/SSLEAY.pm blib\lib\Net\Server\Proto\SSLEAY.pm
cp lib/Net/Server/Log/Sys/Syslog.pm blib\lib\Net\Server\Log\Sys\Syslog.pm
cp lib/Net/Server/INET.pm blib\lib\Net\Server\INET.pm
cp lib/Net/Server/Fork.pm blib\lib\Net\Server\Fork.pm
cp lib/Net/Server/Multiplex.pm blib\lib\Net\Server\Multiplex.pm
cp lib/Net/Server.pod blib\lib\Net\Server.pod
cp lib/Net/Server/Proto/UNIXDGRAM.pm blib\lib\Net\Server\Proto\UNIXDGRAM.pm
cp lib/Net/Server/Log/Log/Log4perl.pm
blib\lib\Net\Server\Log\Log\Log4perl.pm
cp lib/Net/Server/Daemonize.pm blib\lib\Net\Server\Daemonize.pm
cp lib/Net/Server/PreForkSimple.pm blib\lib\Net\Server\PreForkSimple.pm
cp lib/Net/Server/Proto.pm blib\lib\Net\Server\Proto.pm
cp lib/Net/Server/Single.pm blib\lib\Net\Server\Single.pm
cp lib/Net/Server/HTTP.pm blib\lib\Net\Server\HTTP.pm
C:\strawberry\perl\bin\perl.exe -MExtUtils::Command -e cp --
bin/net-server blib
\script\net-server
pl2bat.bat blib\script\net-server
&#40;C:\strawberry\c\bin\dmake.EXE exited with 0&#41;
CPAN::Reporter: dmake result is &#39;pass&#39;, No errors.
  RHANDOM/Net-Server-2.007.tar.gz
  C:\strawberry\c\bin\dmake.EXE -- OK
Running make test
C:\strawberry\perl\bin\perl.exe &#34;-MExtUtils::Command::MM&#34; &#34;-e&#34;
&#34;test_harness&#40;0,
&#39;blib\lib&#39;, &#39;blib\arch&#39;&#41;&#34; t/*.t
t/Options.t ............... ok
# number of tests ran 35 did not match number of specified tests 51
t/Port_Configuration.t ....
Failed 17/51 subtests
t/Server_BASE.t ........... ok
t/Server_Fork.t ........... ok
t/Server_http.t ........... ok
t/Server_INET.t ........... ok
t/Server_Multiplex.t ...... ok
t/Server_MultiType.t ...... ok
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;29&nbsp;01:22:12&nbsp;2013</span>
    <span class="description">mmusgrove [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Under Strawberry Perl 5.16.2 it hangs in a different place. If you need
help testing changes, just let me know.

  CPAN.pm: Building R/RH/RHANDOM/Net-Server-2.007.tar.gz

CPAN: CPAN::Reporter loaded ok &#40;v1.2009&#41;
Checking if your kit is complete...
Looks good
Writing Makefile for Net::Server
Writing MYMETA.yml and MYMETA.json
&#40;C:\strawberry\perl\bin\perl.exe Makefile.PL exited with 0&#41;
CPAN::Reporter: Makefile.PL result is &#39;pass&#39;, No errors.
cp lib/Net/Server/Proto/UDP.pm blib\lib\Net\Server\Proto\UDP.pm
cp lib/Net/Server/Proto/UNIX.pm blib\lib\Net\Server\Proto\UNIX.pm
cp lib/Net/Server/PreFork.pm blib\lib\Net\Server\PreFork.pm
cp lib/Net/Server/PSGI.pm blib\lib\Net\Server\PSGI.pm
cp lib/Net/Server/Proto/SSL.pm blib\lib\Net\Server\Proto\SSL.pm
cp lib/Net/Server.pm blib\lib\Net\Server.pm
cp lib/Net/Server/Proto/TCP.pm blib\lib\Net\Server\Proto\TCP.pm
cp lib/Net/Server/MultiType.pm blib\lib\Net\Server\MultiType.pm
cp lib/Net/Server/SIG.pm blib\lib\Net\Server\SIG.pm
cp lib/Net/Server/Proto/SSLEAY.pm blib\lib\Net\Server\Proto\SSLEAY.pm
cp lib/Net/Server/Log/Sys/Syslog.pm blib\lib\Net\Server\Log\Sys\Syslog.pm
cp lib/Net/Server/INET.pm blib\lib\Net\Server\INET.pm
cp lib/Net/Server/Fork.pm blib\lib\Net\Server\Fork.pm
cp lib/Net/Server/Multiplex.pm blib\lib\Net\Server\Multiplex.pm
cp lib/Net/Server.pod blib\lib\Net\Server.pod
cp lib/Net/Server/Proto/UNIXDGRAM.pm blib\lib\Net\Server\Proto\UNIXDGRAM.pm
cp lib/Net/Server/Log/Log/Log4perl.pm
blib\lib\Net\Server\Log\Log\Log4perl.pm
cp lib/Net/Server/Daemonize.pm blib\lib\Net\Server\Daemonize.pm
cp lib/Net/Server/PreForkSimple.pm blib\lib\Net\Server\PreForkSimple.pm
cp lib/Net/Server/Proto.pm blib\lib\Net\Server\Proto.pm
cp lib/Net/Server/Single.pm blib\lib\Net\Server\Single.pm
cp lib/Net/Server/HTTP.pm blib\lib\Net\Server\HTTP.pm
C:\strawberry\perl\bin\perl.exe -MExtUtils::Command -e cp --
bin/net-server blib
\script\net-server
pl2bat.bat blib\script\net-server
&#40;C:\strawberry\c\bin\dmake.exe exited with 0&#41;
CPAN::Reporter: dmake result is &#39;pass&#39;, No errors.
  RHANDOM/Net-Server-2.007.tar.gz
  C:\strawberry\c\bin\dmake.exe -- OK
Running make test
C:\strawberry\perl\bin\perl.exe &#34;-MExtUtils::Command::MM&#34; &#34;-e&#34;
&#34;test_harness&#40;0,
&#39;blib\lib&#39;, &#39;blib\arch&#39;&#41;&#34; t/*.t
t/Options.t ............... ok
# number of tests ran 35 did not match number of specified tests 51
t/Port_Configuration.t ....
Failed 17/51 subtests
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;02&nbsp;11:50:56&nbsp;2013</span>
    <span class="description">CHORNY [...] cpan.org -  Broken in 2.006 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jun&nbsp;02&nbsp;11:50:56&nbsp;2013</span>
    <span class="description">CHORNY [...] cpan.org -  Broken in 2.007 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;05&nbsp;16:15:21&nbsp;2014</span>
    <span class="description">MRHORNER [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Under Strawberry Perl 5.18.2 multi-thread x64 it hangs in Server_PreFork.t as Gabor mentioned skipping the tests on windows would be appreciated.  However, I do understand the want to resolve the issue.

The stack info for the most childish perl process running has two threads shows&#40;perl.exe0x14e0&#41;:
ntdll.dll!NtReadFile+0xa
KERNELBASE.dll!ReadFile+0x78
ConEmuHk64.dll!SetFarHookMode+0x6eb4
msvcrt.dll!swscanf+0x6fd
msvcrt.dll!read+0xa9
perl518.dll!PerlIOBuf_get_base+0x458
perl518.dll!PerlIOBuf_fill+0xdf
perl518.dll!Perl_PerlIO_fill+0x28
perl518.dll!PerlIOBase_read+0x100
perl518.dll!Perl_setdefout+0x18ea
perl518.dll!Perl_runops_standard+0x16
perl518.dll!perl_run+0x379
perl518.dll!RunPerl+0x168
perl.exe+0x13d7
perl.exe+0x14f8
KERNEL32.DLL!BaseThreadInitThunk+0xd
ntdll.dll!RtlUserThreadStart+0x1d

the stack remains the same during lock time.

swscanf surprises me in that output...

the other thread: &#40;perl518.dll!Perl_get_re_arg+0x44c0&#41;

ntdll.dll!NtWaitForSingleObject+0xa
ntdll.dll!AlpcFreeCompletionListMessage+0x1f1
ntdll.dll!RtlEnterCriticalSection+0xe4
msvcrt.dll!isleadbyte_l+0x20e
msvcrt.dll!fstat64+0xac
perl518.dll!PerlIO_init+0x2a8
perl518.dll!PerlIO_init+0x34f
perl518.dll!PerlIOBase_dup+0x53
perl518.dll!PerlIOBuf_dup+0x70
perl518.dll!Perl_fp_dup+0x45
perl518.dll!PerlIO_list_free+0x327
perl518.dll!perl_clone_using+0xac6
perl518.dll!Perl_get_re_arg+0x3d3f
perl518.dll!Perl_setdefout+0x74c4
perl518.dll!Perl_runops_standard+0x16
perl518.dll!Perl_get_re_arg+0x4690
KERNEL32.DLL!BaseThreadInitThunk+0xd
ntdll.dll!RtlUserThreadStart+0x1d

A solution or a skip is appreciated; as I am tempted to filter the module to stop having to kill the most childish process.

I would be interested in a strawberry build with debug symbols that I could step through issues like this;  not there yet.  this stack info from procexp is the best info I&#39;ve found so far. probably not illuminating enough, to resolve; idk.

thanks
Cheers.
--dave
<span class="clickylink"><a target="new" rel="nofollow" href="http://perlmonks.org/?node_id=1064341">http://perlmonks.org/?node_id=1064341</a></span> hanging camels?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;07&nbsp;01:14:48&nbsp;2014</span>
    <span class="description">MRHORNER [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">If no skip is put in place; a smoker can not simply modify local code to include, so exclusion is a remedy but I don&#39;t want to do that just yet...
Plus better to start a list of hanging tests and strange behavior than to ignore it.

I haven&#39;t gone so far as to schedule it to run in the background looking for problematic on my smokers, but i may in the future.

from inside a ps1 script or inside a powershell:

Get-WmiObject Win32_Process -Filter &#34;name = &#39;perl.exe&#39;&#34; | where {$_.CommandLine -eq &#39;&#34;C:\strawberry\perl\bin\perl.exe&#34; t/Server_PreFork.t&#39;} | ForEach-Object { Invoke-WmiMethod -Path $_.__Path –Name Terminate }
 Get-WmiObject Win32_Process -Filter &#34;name = &#39;perl.exe&#39;&#34; | where {$_.CommandLine -eq &#39;&#34;C:\strawberry\perl\bin\perl.exe&#34; t/Server_PreForkSimple.t&#39;} | ForEach-Object { Invoke-WmiMethod -Path $_.__Path –Name Terminate }

this is sorta brute force, but it&#39;s quick and works without visually expanding a process tree and having to discern details.

i&#39;m not sure how to schedule these checks best on the smoker;  maybe a module to hook into the smoking process and perform a task/run a command every x minutes? idk.  anyways for now I&#39;ve got a quicker resolution. a solution would be appreciated.

cheers to an unstuck tester.
--dave
<span class="clickylink"><a target="new" rel="nofollow" href="http://dave.thehorners.com/tech-talk/windows-os/356-powershell-net-control-and-automation">http://dave.thehorners.com/tech-talk/windows-os/356-powershell-net-control-and-automation</a></span>

On Tue Aug 05 16:15:21 2014, MRHORNER wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Under Strawberry Perl 5.18.2 multi-thread x64 it hangs in
&gt; Server_PreFork.t as Gabor mentioned skipping the tests on windows
&gt; would be appreciated.  However, I do understand the want to resolve
&gt; the issue.
&gt; 
&gt; The stack info for the most childish perl process running has two
&gt; threads shows&#40;perl.exe0x14e0&#41;:
&gt; ntdll.dll!NtReadFile+0xa
&gt; KERNELBASE.dll!ReadFile+0x78
&gt; ConEmuHk64.dll!SetFarHookMode+0x6eb4
&gt; msvcrt.dll!swscanf+0x6fd
&gt; msvcrt.dll!read+0xa9
&gt; perl518.dll!PerlIOBuf_get_base+0x458
&gt; perl518.dll!PerlIOBuf_fill+0xdf
&gt; perl518.dll!Perl_PerlIO_fill+0x28
&gt; perl518.dll!PerlIOBase_read+0x100
&gt; perl518.dll!Perl_setdefout+0x18ea
&gt; perl518.dll!Perl_runops_standard+0x16
&gt; perl518.dll!perl_run+0x379
&gt; perl518.dll!RunPerl+0x168
&gt; perl.exe+0x13d7
&gt; perl.exe+0x14f8
&gt; KERNEL32.DLL!BaseThreadInitThunk+0xd
&gt; ntdll.dll!RtlUserThreadStart+0x1d
&gt; 
&gt; the stack remains the same during lock time.
&gt; 
&gt; swscanf surprises me in that output...
&gt; 
&gt; the other thread: &#40;perl518.dll!Perl_get_re_arg+0x44c0&#41;
&gt; 
&gt; ntdll.dll!NtWaitForSingleObject+0xa
&gt; ntdll.dll!AlpcFreeCompletionListMessage+0x1f1
&gt; ntdll.dll!RtlEnterCriticalSection+0xe4
&gt; msvcrt.dll!isleadbyte_l+0x20e
&gt; msvcrt.dll!fstat64+0xac
&gt; perl518.dll!PerlIO_init+0x2a8
&gt; perl518.dll!PerlIO_init+0x34f
&gt; perl518.dll!PerlIOBase_dup+0x53
&gt; perl518.dll!PerlIOBuf_dup+0x70
&gt; perl518.dll!Perl_fp_dup+0x45
&gt; perl518.dll!PerlIO_list_free+0x327
&gt; perl518.dll!perl_clone_using+0xac6
&gt; perl518.dll!Perl_get_re_arg+0x3d3f
&gt; perl518.dll!Perl_setdefout+0x74c4
&gt; perl518.dll!Perl_runops_standard+0x16
&gt; perl518.dll!Perl_get_re_arg+0x4690
&gt; KERNEL32.DLL!BaseThreadInitThunk+0xd
&gt; ntdll.dll!RtlUserThreadStart+0x1d
&gt; 
&gt; A solution or a skip is appreciated; as I am tempted to filter the
&gt; module to stop having to kill the most childish process.
&gt; 
&gt; I would be interested in a strawberry build with debug symbols that I
&gt; could step through issues like this;  not there yet.  this stack info
&gt; from procexp is the best info I&#39;ve found so far. probably not
&gt; illuminating enough, to resolve; idk.
&gt; 
&gt; thanks
&gt; Cheers.
&gt; --dave
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://perlmonks.org/?node_id=1064341">http://perlmonks.org/?node_id=1064341</a></span> hanging camels?
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;30&nbsp;16:16:37&nbsp;2015</span>
    <span class="description">CHORNY [...] cpan.org -  Broken in 2.008 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;21&nbsp;18:43:50&nbsp;2015</span>
    <span class="description">BULKDD [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">A better/more accurate callstack for Server_PreFork.t hang.

first thread
----------------------------------------------------------------------
        ntdll.dll!_KiFastSystemCallRet@0&#40;&#41;      
        ntdll.dll!_NtReadFile@36&#40;&#41;  + 0xc       
        kernel32.dll!_ReadFile@20&#40;&#41;  + 0x67     
        msvcr71.dll!_read_lk&#40;int fh=3, void * buf=0x00e5815c, unsigned int cnt=8192&#41;  Line 154 + 0x15   C
        msvcr71.dll!_read&#40;int fh=3, void * buf=0x00e5815c, unsigned int cnt=8192&#41;  Line 75 + 0xc        C
        perl523.dll!PerlLIORead&#40;IPerlLIO * piPerl=0x003664a4, int handle=3, void * buffer=0x00e5815c, unsigned int count=8192&#41;  Line 1029 + 0x12        C
        perl523.dll!PerlIOUnix_read&#40;interpreter * my_perl=0x003642d4, _PerlIO * * f=0x00e8ef84, void * vbuf=0x00e5815c, unsigned int count=8192&#41;  Line 2730 + 0x14      C
        perl523.dll!Perl_PerlIO_read&#40;interpreter * my_perl=0x003642d4, _PerlIO * * f=0x00e8ef84, void * vbuf=0x00e5815c, unsigned int count=8192&#41;  Line 1591 + 0x27     C
        perl523.dll!PerlIOBuf_fill&#40;interpreter * my_perl=0x003642d4, _PerlIO * * f=0x008f5c74&#41;  Line 4032 + 0xb C
        perl523.dll!Perl_PerlIO_fill&#40;interpreter * my_perl=0x003642d4, _PerlIO * * f=0x008f5c74&#41;  Line 1686 + 0x23      C
        perl523.dll!PerlIOBase_read&#40;interpreter * my_perl=0x003642d4, _PerlIO * * f=0x008f5c74, void * vbuf=0x0140e624, unsigned int count=1&#41;  Line 2082 + 0xb  C
        perl523.dll!PerlIOBuf_read&#40;interpreter * my_perl=0x003642d4, _PerlIO * * f=0x008f5c74, void * vbuf=0x0140e624, unsigned int count=1&#41;  Line 4056 + 0xf   C
        perl523.dll!Perl_PerlIO_read&#40;interpreter * my_perl=0x003642d4, _PerlIO * * f=0x008f5c74, void * vbuf=0x0140e624, unsigned int count=1&#41;  Line 1591 + 0x27        C
        perl523.dll!Perl_pp_sysread&#40;interpreter * my_perl=0x01000000&#41;  Line 1819 + 0xd  C
        perl523.dll!Perl_runops_standard&#40;interpreter * my_perl=0x003642d4&#41;  Line 41 + 0x4       C
        perl523.dll!S_run_body&#40;interpreter * my_perl=0x00000724, long oldscope=1&#41;  Line 2448 + 0xa      C
        perl523.dll!perl_run&#40;interpreter * my_perl=0x003642d4&#41;  Line 2371 + 0x8 C
        perl523.dll!RunPerl&#40;int argc=2, char * * argv=0x01362cf0, char * * env=0x003632a8&#41;  Line 258 + 0x6      C
        perl.exe!mainCRTStartup&#40;&#41;  Line 398 + 0xe       C
        kernel32.dll!_BaseProcessStart@4&#40;&#41;  + 0x23      
----------------------------------------------------------------------
curcop is
----------------------------------------------------------------------
    warn &#34;# Checking pipe serialization\n&#34; if debug;
    pipe&#40;NST_READ, NST_WRITE&#41;;
    NST_READ-&gt;autoflush&#40;1&#41;;
    NST_WRITE-&gt;autoflush&#40;1&#41;;
    print NST_WRITE &#34;22&#34;;
    is&#40;read&#40;NST_READ, my $buf, 2&#41;, 2, &#34;Pipe works&#34;&#41; || do { SKIP: { skip &#40;&#34;Couldn&#39;t use working pipe&#34;, $N - 3&#41; }; exit };
    warn &#34;# Checked pipe serialization\n&#34; if debug;
    $env{&#39;block_until_ready_to_test&#39;} = sub { read&#40;NST_READ, my $buf, 1&#41; };&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;HERE
    $env{&#39;signal_ready_to_test&#39;}      = sub { print NST_WRITE &#34;1&#34;; NST_WRITE-&gt;flush; };

    return \%env;
}
----------------------------------------------------------------------
2nd thread
----------------------------------------------------------------------
        ntdll.dll!_KiFastSystemCallRet@0&#40;&#41;      
        ntdll.dll!_ZwWaitForSingleObject@12&#40;&#41;  + 0xc    
        ntdll.dll!_RtlpWaitForCriticalSection@4&#40;&#41;  + 0x8c       
        ntdll.dll!_RtlEnterCriticalSection@4&#40;&#41;  + 0x46  
        msvcr71.dll!_lock_fhandle&#40;int fh=3&#41;  Line 453   C
        msvcr71.dll!_fstati64&#40;int fildes=3, _stati64 * buf=0x01bdfdcc&#41;  Line 86 + 0x6   C
        perl523.dll!PerlLIOFileStat&#40;IPerlLIO * piPerl=0x00ed2e9c, int handle=3, _stati64 * buffer=0x01bdfdcc&#41;  Line 968 + 0xe   C
        perl523.dll!PerlIOUnix_setfd&#40;interpreter * my_perl=0x00000401, _PerlIO * * f=0x00070023, int fd=29228120, int imode=0&#41;  Line 2579 + 0x12        C
        perl523.dll!PerlIOUnix_dup&#40;interpreter * my_perl=0x00f18a64, _PerlIO * * f=0x00f1d974, _PerlIO * * o=0x00edd0d4, clone_params * param=0x01bdfeb4, int flags=1&#41;  Line 2705 + 0xc C
        perl523.dll!PerlIOBase_dup&#40;interpreter * my_perl=0x00f18a64, _PerlIO * * f=0x00f1d974, _PerlIO * * o=0x00e27094, clone_params * param=0x01bdfeb4, int flags=1&#41;  Line 2205       C
        perl523.dll!PerlIO_fdupopen&#40;interpreter * my_perl=0x01bdfc58, _PerlIO * * f=0x00070023, clone_params * param=0x01bdfeb4, int flags=1&#41;  Line 505 + 0x13  C
        perl523.dll!Perl_fp_dup&#40;interpreter * my_perl=0x00f18a64, _PerlIO * * const fp=0x00e27094, const char type=0, clone_params * const param=0x01bdfeb4&#41;  Line 12904 + 0xb  C
        perl523.dll!PerlIO_clone&#40;interpreter * my_perl=0x00000000, interpreter * proto=0x00000401, clone_params * param=0x01bdfeb4&#41;  Line 618 + 0xc     C
        perl523.dll!perl_clone_using&#40;interpreter * proto_perl=0x00e1bc9c, unsigned long flags=1, IPerlMem * ipM=0x00000001, IPerlMem * ipMS=0x00ed2d90, IPerlMem * ipMP=0x00ed2dac, IPerlEnv * ipE=0x00ed2dc8, IPerlStdIO * ipStd=0x00ed2e00, IPerlLIO * ipLIO=0x00ed2e9c, IPerlDir * ipD=0x00ed2f04, IPerlSock * ipS=0x00ed2f30, IPerlProc * ipP=0x00ed2fe0&#41;  Line 14770       C
        perl523.dll!PerlProcFork&#40;IPerlProc * piPerl=0x00a50300&#41;  Line 1831 + 0x3e       C
        perl523.dll!Perl_pp_fork&#40;interpreter * my_perl=0x00e1bc9c&#41;  Line 4173 + 0xa     C
        perl523.dll!Perl_runops_standard&#40;interpreter * my_perl=0x00e1bc9c&#41;  Line 41 + 0x4       C
        perl523.dll!win32_start_child&#40;void * arg=0x00e1bc9c&#41;  Line 1744 C
        kernel32.dll!_BaseThreadStart@8&#40;&#41;  + 0x37       
----------------------------------------------------------------------
sub run_n_children {
    my &#40;$self, $n&#41; = @_;
    my $prop  = $self-&gt;{&#39;server&#39;};
    return unless $n &gt; 0;

    $self-&gt;run_n_children_hook&#40;$n&#41;;

    my &#40;$parentsock, $childsock&#41;;
    $self-&gt;log&#40;3, &#34;Starting \&#34;$n\&#34; children&#34;&#41;;
    $prop-&gt;{&#39;last_start&#39;} = time&#40;&#41;;

    for &#40;1 .. $n&#41; {

        if &#40;$prop-&gt;{&#39;child_communication&#39;}&#41; {
            require IO::Socket::UNIX;
            &#40;$parentsock, $childsock&#41; = IO::Socket::UNIX-&gt;socketpair&#40;IO::Socket::AF_UNIX, IO::Socket::SOCK_STREAM, IO::Socket::PF_UNSPEC&#41;;
        }

        $self-&gt;pre_fork_hook;
        local $!;
        my $pid = fork;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;HERE
        if &#40;! defined $pid&#41; {
            if &#40;$prop-&gt;{&#39;child_communication&#39;}&#41; {
                $parentsock-&gt;close&#40;&#41;;
                $childsock-&gt;close&#40;&#41;;
            }
----------------------------------------------------------------------

The Critical section mutex dumped,

-       &#40;CRITICAL_SECTION*&#41;0x00361fa0   0x00361fa0 {DebugInfo=0x00154c60 {Type=0 CreatorBackTraceIndex=0 CriticalSection=0x00361fa0 {DebugInfo=0x00154c60 {Type=0 CreatorBackTraceIndex=0 CriticalSection=0x00361fa0 ...} LockCount=1 RecursionCount=1 ...} ...} LockCount=1 RecursionCount=1 ...}      _RTL_CRITICAL_SECTION *
+       DebugInfo       0x00154c60 {Type=0 CreatorBackTraceIndex=0 CriticalSection=0x00361fa0 {DebugInfo=0x00154c60 {Type=0 CreatorBackTraceIndex=0 CriticalSection=0x00361fa0 {DebugInfo=0x00154c60 LockCount=1 RecursionCount=1 ...} ...} LockCount=1 RecursionCount=1 ...} ...}      _RTL_CRITICAL_SECTION_DEBUG *
        LockCount       1       long
        RecursionCount  1       long
        OwningThread    0x00001564      void *
        LockSemaphore   0x000006e4      void *
        SpinCount       4000    unsigned long

Thread 0x00001564 is the thread blocking in the read call
---------------------------------------------------------------------------
        ntdll.dll!_KiFastSystemCallRet@0&#40;&#41;      
        ntdll.dll!_NtReadFile@36&#40;&#41;  + 0xc       
        kernel32.dll!_ReadFile@20&#40;&#41;  + 0x67     
        msvcr71.dll!_read_lk&#40;int fh=3, void * buf=0x00e5815c, unsigned int cnt=8192&#41;  Line 154 + 0x15   C
        msvcr71.dll!_read&#40;int fh=3, void * buf=0x00e5815c, unsigned int cnt=8192&#41;  Line 75 + 0xc        C
        perl523.dll!PerlLIORead&#40;IPerlLIO * piPerl=0x003664a4, int handle=3, void * buffer=0x00e5815c, unsigned int count=8192&#41;  Line 1029 + 0x12        C
        perl523.dll!PerlIOUnix_read&#40;interpreter * my_perl=0x003642d4, _PerlIO * * f=0x00e8ef84, void * vbuf=0x00e5815c, unsigned int count=8192&#41;  Line 2730 + 0x14      C
        perl523.dll!Perl_PerlIO_read&#40;interpreter * my_perl=0x003642d4, _PerlIO * * f=0x00e8ef84, void * vbuf=0x00e5815c, unsigned int count=8192&#41;  Line 1591 + 0x27     C
        perl523.dll!PerlIOBuf_fill&#40;interpreter * my_perl=0x003642d4, _PerlIO * * f=0x008f5c74&#41;  Line 4032 + 0xb C
        perl523.dll!Perl_PerlIO_fill&#40;interpreter * my_perl=0x003642d4, _PerlIO * * f=0x008f5c74&#41;  Line 1686 + 0x23      C
        perl523.dll!PerlIOBase_read&#40;interpreter * my_perl=0x003642d4, _PerlIO * * f=0x008f5c74, void * vbuf=0x0140e624, unsigned int count=1&#41;  Line 2082 + 0xb  C
        perl523.dll!PerlIOBuf_read&#40;interpreter * my_perl=0x003642d4, _PerlIO * * f=0x008f5c74, void * vbuf=0x0140e624, unsigned int count=1&#41;  Line 4056 + 0xf   C
        perl523.dll!Perl_PerlIO_read&#40;interpreter * my_perl=0x003642d4, _PerlIO * * f=0x008f5c74, void * vbuf=0x0140e624, unsigned int count=1&#41;  Line 1591 + 0x27        C
        perl523.dll!Perl_pp_sysread&#40;interpreter * my_perl=0x01000000&#41;  Line 1819 + 0xd  C
        perl523.dll!Perl_runops_standard&#40;interpreter * my_perl=0x003642d4&#41;  Line 41 + 0x4       C
        perl523.dll!S_run_body&#40;interpreter * my_perl=0x00000724, long oldscope=1&#41;  Line 2448 + 0xa      C
        perl523.dll!perl_run&#40;interpreter * my_perl=0x003642d4&#41;  Line 2371 + 0x8 C
        perl523.dll!RunPerl&#40;int argc=2, char * * argv=0x01362cf0, char * * env=0x003632a8&#41;  Line 258 + 0x6      C
        perl.exe!mainCRTStartup&#40;&#41;  Line 398 + 0xe       C
        kernel32.dll!_BaseProcessStart@4&#40;&#41;  + 0x23      
---------------------------------------------------------------------------

So the psuedofork is blocking on fd 3 becoming unlocked, while the parent thread/psuedoproc is waiting for its pipe lock to be unblocked. The easy fix is for the Perl code to use Win32::Mutex. This problem of _lock_fhandle is P5P bug <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.perl.org/Ticket/Display.html?id=65136">https://rt.perl.org/Ticket/Display.html?id=65136</a></span> 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;23&nbsp;23:03:59&nbsp;2016</span>
    <span class="description">twata_1 [...] yahoo.co.jp -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> twata_1 [...] yahoo.co.jp</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Still happening in 2.008 under Strawberry Perl 5.14.4 etc.

Here is workaround patches.
&#40;However, the test of Port_Configuration.t and Server_PreFork.t still fails.

I tested Strawberry Perl:
v5.14.4
v5.18.4
v5.20.3
v5.22.2
v5.24.0
on Windows 7.
&#41;

Hope this help.

Thank you,

--
twata

On 2013-1月-10 木 03:08:54, RHANDOM wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The tests should no longer stick - though now we hopefully will see why
&gt; it is failing better.
</div></div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Server_PreForkSimple.t.StrawberryP5-14-4.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- Net-Server-2.008/t/Server_PreForkSimple.t	2014-05-06 03:43:15.000000000 +0900
+++ Net-Server-2.008-patched/t/Server_PreForkSimple.t	2016-12-24 10:20:11.440000002 +0900
@@ -41,6 +41,7 @@
         print $remote &#34;exit\n&#34;;
 
         alarm 0;
+        kill &#39;TERM&#39;, $pid if $^O eq &#39;MSWin32&#39;;
         return 1;
 
     ### child does the server
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> block_until_ready_to_test.StrawberryP5-14-4.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- Net-Server-2.008/t/NetServerTest.pm	2014-05-13 00:31:32.000000000 +0900
+++ Net-Server-2.008-patched/t/NetServerTest.pm	2016-12-24 10:18:24.850000002 +0900
@@ -67,7 +67,7 @@
     print NST_WRITE &#34;22&#34;;
     is&#40;read&#40;NST_READ, my $buf, 2&#41;, 2, &#34;Pipe works&#34;&#41; || do { SKIP: { skip &#40;&#34;Couldn&#39;t use working pipe&#34;, $N - 3&#41; }; exit };
     warn &#34;# Checked pipe serialization\n&#34; if debug;
-    $env{&#39;block_until_ready_to_test&#39;} = sub { read&#40;NST_READ, my $buf, 1&#41; };
+    $env{&#39;block_until_ready_to_test&#39;} = sub { sleep 1 if $^O eq &#39;MSWin32&#39;; read&#40;NST_READ, my $buf, 1&#41; };
     $env{&#39;signal_ready_to_test&#39;}      = sub { print NST_WRITE &#34;1&#34;; NST_WRITE-&gt;flush; };
 
     return \%env;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;16&nbsp;05:58:46&nbsp;2018</span>
    <span class="description">SREZIC [...] cpan.org -  Broken in 2.009 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
