<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #35033 for Tk: #16246 reappeared: Tk::fileevent clears all handlers, not just the requested one</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #35033 for Tk: #16246 reappeared: Tk::fileevent clears all handlers, not just the requested one</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Tk">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Tk">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Tk">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Tk">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Tk">Tk CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">35033</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="time worked">
    <td class="label">Worked:</td>
    <td class="value">25 min

</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Tk">Tk</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
elmex [...] ta-sa.org

<br />
rt.cpan.org [...] plan9.de

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-33610-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
804.028    </td>
  </tr>
  <tr id="CF-33611-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/150276/46775/patch">
Thu Dec 29 08:04:11 2005 (573b) by Administrator [...] SQLSoft.com
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=35033">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-150268" href="/Public/Bug/Display.html?id=35033#txn-150268">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;01&nbsp;16:50:36&nbsp;2005</span>
    <span class="description">Guest - Ticket #16246:  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Tk::fileevent clears all handlers, not just the requested one</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/150268/44972/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/44972">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 995b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The following program:

    #!/usr/bin/perl

    use Tk;

    open my $fh, &#34;+&gt;/tmp/tktest&#34; or die;

    my $mw = new MainWindow;

    $mw-&gt;fileevent &#40;$fh, readable =&gt; &#34;1&#34;&#41;;
    $mw-&gt;fileevent &#40;$fh, writable =&gt; &#34;2&#34;&#41;;
    warn $mw-&gt;fileevent &#40;$fh, &#34;readable&#34;&#41;;
    warn $mw-&gt;fileevent &#40;$fh, &#34;writable&#34;&#41;;
    $mw-&gt;fileevent &#40;$fh, readable =&gt; &#34;&#34;&#41;;
    warn $mw-&gt;fileevent &#40;$fh, &#34;readable&#34;&#41;;
    warn $mw-&gt;fileevent &#40;$fh, &#34;writable&#34;&#41;;

Outputs:
   Tk::Callback=SCALAR&#40;0xa51950&#41; at /tmp/tk.pl line 11.
   Tk::Callback=SCALAR&#40;0x9230c0&#41; at /tmp/tk.pl line 12.
   Warning: something&#39;s wrong at /tmp/tk.pl line 14.
   Warning: something&#39;s wrong at /tmp/tk.pl line 15.


i.e. the &#34;writable&#34; handle gets cleared errornously, contrary to documentation, which explicitly states that readavlke and writable event handlers can be deleted seperately.

                                                                                                                                                               
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-150269" href="/Public/Bug/Display.html?id=35033#txn-150269">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;01&nbsp;17:01:34&nbsp;2005</span>
    <span class="description">Guest - Ticket #16246:  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/150269/44973/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/44973">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 387b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">When I try this as workaround within a called fileevent handler, I get
segfaults:

   my $r = $mw-&gt;fileevent &#40;$self-&gt;{fh}, &#34;readable&#34;&#41;;
   my $w = $mw-&gt;fileevent &#40;$self-&gt;{fh}, &#34;writable&#34;&#41;;
   $r = &#34;&#34; if $self-&gt;{poll} =~ /r/i;
   $w = &#34;&#34; if $self-&gt;{poll} =~ /w/i;
   $mw-&gt;fileevent &#40;$self-&gt;{fh}, readable =&gt; $r&#41;;
   $mw-&gt;fileevent &#40;$self-&gt;{fh}, writable =&gt; $w&#41;;

Something is rotten here.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-150270" href="/Public/Bug/Display.html?id=35033#txn-150270">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;01&nbsp;17:09:24&nbsp;2005</span>
    <span class="description">Guest - Ticket #16246:  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/150270/44974/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/44974">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 192b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">When I play around a lot, I sometimes don&#39;t get segfaults, but after I
set the handlers to the values returned by fileevent and ask fort he
handlers again, they have both been cleared again.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-150271" href="/Public/Bug/Display.html?id=35033#txn-150271">#</a>      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;03&nbsp;15:42:15&nbsp;2005</span>
    <span class="description">NI-S [...] cpan.org - Ticket #16246:  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Take odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-150272" href="/Public/Bug/Display.html?id=35033#txn-150272">#</a>      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;03&nbsp;15:42:28&nbsp;2005</span>
    <span class="description">NI-S [...] cpan.org - Ticket #16246:  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-150273" href="/Public/Bug/Display.html?id=35033#txn-150273">#</a>      
    </span>
    <span class="date">Sat&nbsp;Dec&nbsp;03&nbsp;15:51:20&nbsp;2005</span>
    <span class="description">NI-S [...] cpan.org - Ticket #16246:  Correspondence added</span>
    <span class="time-taken">5 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/150273/45047/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/45047">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 796b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
The subject line is a correct explanation of what happens.

In the perl code the &#39;sub filevent&#39; looks at return from XS 
call to handler. If it isn&#39;t true then it untie-s the file handle
which in turn frees up the other handlers and leaves the references 
you saved in the workround pointing at nothing.

What I think should happen is that the XS code should in the 3-arg
case return NOT the callback it created &#40;if any&#41; as it does now,
but rather the &#34;mask&#34; of active handlers. If the mask is zero 
then the untie is correct.

It did not help diagnosis that your example does 

  $mainwindow-&gt;fileevent&#40;$fh,&#39;readable&#39;,&#34;1&#34;&#41;;

The &#34;1&#34; isn&#39;t a sane callback, I am still confused by why it seems 
to generate a viable callback object rather than complaining.
Will try and fix that at the same time.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-150274" href="/Public/Bug/Display.html?id=35033#txn-150274">#</a>      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;04&nbsp;03:41:15&nbsp;2005</span>
    <span class="description">Guest - Ticket #16246:  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> rt.cpan.org [...] plan9.de</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/150274/45081/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/45081">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 870b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[NI-S - Sat Dec  3 15:51:20 2005]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; It did not help diagnosis that your example does
</div>
I am sorry, but fortunately the problem happens regardless of the
handler. &#40;My actual usage uses a code reference&#41;. However, I *did*
assume that &#34;1&#34; was a correct arguemnt, as the manpage uses strings for
that argument and talks about &#34;evaluating&#34; it, as opposed to calling it.
If the interface would use more perl-ish undef and cod references and
&#34;calling&#34; I would not have assumed that a string is a valid callback.

However, even when using code references, the function does not return
the same callback originally used, and the value returned cannot be used
to set the callback, which is potentially another problem.

Thanks for looking into this! I use it in the &#34;AnyEvent&#34; module, which
allows module auhtors to use file events etc. in Tk, Glib and
Event-based programs.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-150275" href="/Public/Bug/Display.html?id=35033#txn-150275">#</a>      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;04&nbsp;13:55:55&nbsp;2005</span>
    <span class="description">Guest - Ticket #16246:  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/150275/45096/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/45096">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 186b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">In case my last entry sounded a bit off: I _am_ sorry that I complicated
debugging by mixing two seperate issues, I just wanted to say why I did
it, and that I didn&#39;t do it on purpose :&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-150276" href="/Public/Bug/Display.html?id=35033#txn-150276">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;29&nbsp;08:04:11&nbsp;2005</span>
    <span class="description">NI-S [...] cpan.org - Ticket #16246:  Correspondence added</span>
    <span class="time-taken">20 min</span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/150276/46774/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/46774">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 132b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
Please try attached patch.
This changes return from XS part of code so that untie 
should only happen when last handler is deleted.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/150276/46775/patch">Download patch</a><br />
<span class="downloadcontenttype">application/octet-stream 573b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-150277" href="/Public/Bug/Display.html?id=35033#txn-150277">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;29&nbsp;08:57:59&nbsp;2005</span>
    <span class="description">Guest - Ticket #16246:  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/150277/46788/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/46788">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 428b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[NI-S - Thu Dec 29 08:04:11 2005]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Please try attached patch.
&gt; This changes return from XS part of code so that untie
&gt; should only happen when last handler is deleted.
</div>
I checked it against my testcases, they work fine. I also removed the
workaround I had for Tk in Net::FCP and am running a daemon with
hundreds of simultaneous connections all on the Tk event loop for a few
minutes now - works fine, too :&#41;

Thanks!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-150279" href="/Public/Bug/Display.html?id=35033#txn-150279">#</a>      
    </span>
    <span class="date">Thu&nbsp;Dec&nbsp;29&nbsp;09:21:38&nbsp;2005</span>
    <span class="description">NI-S [...] cpan.org - Ticket #16246:  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Create even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-448840" href="/Public/Bug/Display.html?id=35033#txn-448840">#</a>      
    </span>
    <span class="date">Mon&nbsp;Apr&nbsp;14&nbsp;17:17:33&nbsp;2008</span>
    <span class="description">elmex [...] ta-sa.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> #16246 reappeared: Tk::fileevent clears all handlers, not just
 the requested one</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/448840/220455/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/220455">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 274b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi!

Even though the bug #16246 was resolved once it seems to be still &#40;or
again?&#41;
in the recent Tk version.

This is my testcase:
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.ta-sa.org/files/txt/b7c669b2ff74c8bfb3c57ee9c94e94f9.txt">http://www.ta-sa.org/files/txt/b7c669b2ff74c8bfb3c57ee9c94e94f9.txt</a></span>

The &#39;READABLE&#39; event is never detected, even though there
is data waiting.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-507861" href="/Public/Bug/Display.html?id=35033#txn-507861">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;12&nbsp;18:08:04&nbsp;2008</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/507861/252646/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/252646">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 487b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Apr 14 17:17:33 2008, ELMEX wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi!
&gt; 
&gt; Even though the bug #16246 was resolved once it seems to be still &#40;or
&gt; again?&#41;
&gt; in the recent Tk version.
&gt; 
&gt; This is my testcase:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.ta-sa.org/files/txt/b7c669b2ff74c8bfb3c57ee9c94e94f9.txt">http://www.ta-sa.org/files/txt/b7c669b2ff74c8bfb3c57ee9c94e94f9.txt</a></span>
&gt; 
&gt; The &#39;READABLE&#39; event is never detected, even though there
&gt; is data waiting.
</div>
The patch was never applied. Does
<span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Attachment/150276/46775/patch">http://rt.cpan.org/Ticket/Attachment/150276/46775/patch</a></span>
still works for you with Tk804.028?

Regards,
    Slaven
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-507862" href="/Public/Bug/Display.html?id=35033#txn-507862">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;12&nbsp;18:08:07&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-728432" href="/Public/Bug/Display.html?id=35033#txn-728432">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;03&nbsp;07:55:11&nbsp;2010</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/728432/376249/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/376249">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 756b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Sep 12 18:08:04 2008, SREZIC wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon Apr 14 17:17:33 2008, ELMEX wrote:
<div class="message-stanza open">&gt; &gt; Hi!
&gt; &gt; 
&gt; &gt; Even though the bug #16246 was resolved once it seems to be still &#40;or
&gt; &gt; again?&#41;
&gt; &gt; in the recent Tk version.
&gt; &gt; 
&gt; &gt; This is my testcase:
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://www.ta-sa.org/files/txt/b7c669b2ff74c8bfb3c57ee9c94e94f9.txt">http://www.ta-sa.org/files/txt/b7c669b2ff74c8bfb3c57ee9c94e94f9.txt</a></span>
&gt; &gt; 
&gt; &gt; The &#39;READABLE&#39; event is never detected, even though there
&gt; &gt; is data waiting.
</div>&gt; 
&gt; The patch was never applied. Does
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Attachment/150276/46775/patch">http://rt.cpan.org/Ticket/Attachment/150276/46775/patch</a></span>
&gt; still works for you with Tk804.028?
&gt; 
</div>
Unfortunately the patch makes t/leak.t fail now. Obviously the
introduction of using newSViv&#40;&#41; now created a memory leak. Need some
additional investigation if and how this could be fixed.

Regards,
    Slaven
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-728592" href="/Public/Bug/Display.html?id=35033#txn-728592">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;03&nbsp;14:27:01&nbsp;2010</span>
    <span class="description">The RT System itself -  TimeWorked changed from &#40;no value&#41; to &#39;25&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-728593" href="/Public/Bug/Display.html?id=35033#txn-728593">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;03&nbsp;14:27:02&nbsp;2010</span>
    <span class="description">SREZIC [...] cpan.org - Ticket #16246:  Merged into ticket #35033</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-728594" href="/Public/Bug/Display.html?id=35033#txn-728594">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;03&nbsp;14:27:02&nbsp;2010</span>
    <span class="description">SREZIC [...] cpan.org -  Merged into ticket #35033</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.623532</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
