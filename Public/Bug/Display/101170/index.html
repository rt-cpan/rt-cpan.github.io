<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #101170 for Unicode-Collate: [PATCH] mass consting and some XS efficiency tweaks</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #101170 for Unicode-Collate: [PATCH] mass consting and some XS efficiency tweaks</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Unicode-Collate">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Unicode-Collate">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Unicode-Collate">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Unicode-Collate">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Unicode-Collate">Unicode-Collate CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">101170</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Unicode-Collate">Unicode-Collate</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
BULKDD [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-34480-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.09    </td>
  </tr>
  <tr id="CF-34481-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




0001-mass-consting-and-some-XS-efficiency-tweaks.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1446747/769194/0001-mass-consting-and-some-XS-efficiency-tweaks.patch">
Sun Dec 28 08:50:13 2014 (5.4k) by BULKDD [...] cpan.org
</a>
</font></li>
</ul>


collateafter.PNG<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1446750/769199/collateafter.PNG">
Sun Dec 28 08:59:05 2014 (41.8k) by BULKDD [...] cpan.org
</a>
</font></li>
</ul>


collatebefore.png<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1446750/769200/collatebefore.png">
Sun Dec 28 08:59:06 2014 (42.9k) by BULKDD [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=101170">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1446747" href="/Public/Bug/Display.html?id=101170#txn-1446747">#</a>      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;28&nbsp;08:50:13&nbsp;2014</span>
    <span class="description">BULKDD [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> [PATCH] mass consting and some XS efficiency tweaks</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 0001-mass-consting-and-some-XS-efficiency-tweaks.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1446747/769194/0001-mass-consting-and-some-XS-efficiency-tweaks.patch">Download 0001-mass-consting-and-some-XS-efficiency-tweaks.patch</a><br />
<span class="downloadcontenttype">text/x-diff 5.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 4f1eec018889a5fe82e643c7e40515d0722d4888 Mon Sep 17 00:00:00 2001
From: bulk88 &lt;bulk88@hotmail.com&gt;
Date: Sun, 28 Dec 2014 07:45:29 -0500
Subject: [PATCH] mass consting and some XS efficiency tweaks

-remove &#34;static const char *upperhex&#34;, this doesn&#39;t mean &#34;0123456789ABCDEF&#34;
 is static, but instead &#34;char * upperhex&#34; is static, and contains a
 pointer to &#34;0123456789ABCDEF&#34;. Visual C doesn&#39;t optimize this extra
 variable away.
-replace multiple XPUSHs with 1 EXTEND and PUSHs, less calls to
 Perl_stack_grow&#40;&#41;, in some cases, the incoming arg proves there is space
 on perl stack, so no EXTEND needed then
-replace MAX_DIV_16 with CPP constant so CC can optimizer better
-add const to all the tables, this allows the tables to be shared between
 perl processes on most OSes &#40;including Win32&#41; by the OS image loader
 saving 100s of KB of malloc-style per perl process memory
---
 Collate.xs | 29 ++++++++++++++++-------------
 mkheader   | 12 ++++++------
 2 files changed, 22 insertions&#40;+&#41;, 19 deletions&#40;-&#41;

diff --git a/Collate.xs b/Collate.xs
index b0bc88c..e9ee74a 100644
--- a/Collate.xs
+++ b/Collate.xs
@@ -14,7 +14,7 @@
 #define VALID_UTF_MAX    &#40;0x10ffff&#41;
 #define OVER_UTF_MAX&#40;uv&#41; &#40;VALID_UTF_MAX &lt; &#40;uv&#41;&#41;
 
-static const UV max_div_16 = UV_MAX / 16;
+#define MAX_DIV_16 &#40;UV_MAX / 16&#41;
 
 /* Supported Levels */
 #define MinLevel	&#40;1&#41;
@@ -67,7 +67,7 @@ static const UV max_div_16 = UV_MAX / 16;
 
 #define CJK_CompIni  &#40;0xFA0E&#41;
 #define CJK_CompFin  &#40;0xFA29&#41;
-static STDCHAR UnifiedCompat[] = {
+static const STDCHAR UnifiedCompat[] = {
       1,1,0,1,0,1,1,0,0,0,0,0,0,0,0,0,0,1,0,1,0,1,1,0,0,1,1,1
 }; /* E F 0 1 2 3 4 5 6 7 8 9 A B C D E F 0 1 2 3 4 5 6 7 8 9 */
 
@@ -82,7 +82,7 @@ _fetch_rest &#40;&#41;
   PREINIT:
     char ** rest;
   PPCODE:
-    for &#40;rest = UCA_rest; *rest; ++rest&#41; {
+    for &#40;rest = &#40;char **&#41;UCA_rest; *rest; ++rest&#41; {
 	XPUSHs&#40;sv_2mortal&#40;newSVpv&#40;&#40;char *&#41; *rest, 0&#41;&#41;&#41;;
     }
 
@@ -105,12 +105,13 @@ _fetch_simple &#40;uv&#41;
 	int i;
 	int num = &#40;int&#41;*result;
 	++result;
+        EXTEND&#40;SP, num&#41;;
 	for &#40;i = 0; i &lt; num; ++i&#41; {
-	    XPUSHs&#40;sv_2mortal&#40;newSVpvn&#40;&#40;char *&#41; result, VCE_Length&#41;&#41;&#41;;
+	    PUSHs&#40;sv_2mortal&#40;newSVpvn&#40;&#40;char *&#41; result, VCE_Length&#41;&#41;&#41;;
 	    result += VCE_Length;
 	}
     } else {
-	XPUSHs&#40;sv_2mortal&#40;newSViv&#40;0&#41;&#41;&#41;;
+	PUSHs&#40;sv_2mortal&#40;newSViv&#40;0&#41;&#41;&#41;;
     }
 
 SV*
@@ -163,7 +164,7 @@ _getHexArray &#40;src&#41;
 		break;
 	    if &#40;overflowed&#41;
 		continue;
-	    if &#40;value &gt; max_div_16&#41; {
+	    if &#40;value &gt; MAX_DIV_16&#41; {
 		overflowed = TRUE;
 		continue;
 	    }
@@ -205,10 +206,11 @@ _decompHangul &#40;code&#41;
     vindex = &#40;sindex % Hangul_NCount&#41; / Hangul_TCount;
     tindex =  sindex % Hangul_TCount;
 
-    XPUSHs&#40;sv_2mortal&#40;newSVuv&#40;lindex + Hangul_LBase&#41;&#41;&#41;;
-    XPUSHs&#40;sv_2mortal&#40;newSVuv&#40;vindex + Hangul_VBase&#41;&#41;&#41;;
+    EXTEND&#40;SP, 3&#41;;
+    PUSHs&#40;sv_2mortal&#40;newSVuv&#40;lindex + Hangul_LBase&#41;&#41;&#41;;
+    PUSHs&#40;sv_2mortal&#40;newSVuv&#40;vindex + Hangul_VBase&#41;&#41;&#41;;
     if &#40;tindex&#41;
-	XPUSHs&#40;sv_2mortal&#40;newSVuv&#40;tindex + Hangul_TBase&#41;&#41;&#41;;
+	PUSHs&#40;sv_2mortal&#40;newSVuv&#40;tindex + Hangul_TBase&#41;&#41;&#41;;
 
 
 SV*
@@ -319,8 +321,9 @@ _derivCE_8 &#40;code&#41;
     b[2] = &#40;U8&#41;&#40;bbbb &#38; 0xFF&#41;;
     a[7] = b[7] = &#40;U8&#41;&#40;code &gt;&gt; 8&#41;;
     a[8] = b[8] = &#40;U8&#41;&#40;code &#38; 0xFF&#41;;
-    XPUSHs&#40;sv_2mortal&#40;newSVpvn&#40;&#40;char *&#41; a, VCE_Length&#41;&#41;&#41;;
-    XPUSHs&#40;sv_2mortal&#40;newSVpvn&#40;&#40;char *&#41; b, VCE_Length&#41;&#41;&#41;;
+    EXTEND&#40;SP, 2&#41;;
+    PUSHs&#40;sv_2mortal&#40;newSVpvn&#40;&#40;char *&#41; a, VCE_Length&#41;&#41;&#41;;
+    PUSHs&#40;sv_2mortal&#40;newSVpvn&#40;&#40;char *&#41; b, VCE_Length&#41;&#41;&#41;;
 
 
 void
@@ -331,7 +334,7 @@ _uideoCE_8 &#40;code&#41;
   PPCODE:
     uice[1] = uice[7] = &#40;U8&#41;&#40;code &gt;&gt; 8&#41;;
     uice[2] = uice[8] = &#40;U8&#41;&#40;code &#38; 0xFF&#41;;
-    XPUSHs&#40;sv_2mortal&#40;newSVpvn&#40;&#40;char *&#41; uice, VCE_Length&#41;&#41;&#41;;
+    PUSHs&#40;sv_2mortal&#40;newSVpvn&#40;&#40;char *&#41; uice, VCE_Length&#41;&#41;&#41;;
 
 
 SV*
@@ -598,7 +601,7 @@ visualizeSortKey &#40;self, key&#41;
     STRLEN klen, dlen;
     UV uv;
     IV uca_vers, sep = 0;
-    static const char *upperhex = &#34;0123456789ABCDEF&#34;;
+    const char *upperhex = &#34;0123456789ABCDEF&#34;;
   CODE:
     if &#40;SvROK&#40;self&#41; &#38;&#38; SvTYPE&#40;SvRV&#40;self&#41;&#41; == SVt_PVHV&#41;
 	selfHV = &#40;HV*&#41;SvRV&#40;self&#41;;
diff --git a/mkheader b/mkheader
index a575f43..7e2aebe 100644
--- a/mkheader
+++ b/mkheader
@@ -105,10 +105,10 @@ sub stringify {
 
 my $init = &#39;&#39;;
 {
-    my $type = &#34;char*&#34;;
+    my $type = &#34;char* const&#34;;
     my $head = $prefix.&#34;rest&#34;;
 
-    $init .= &#34;static $type $head [] = {\n&#34;;
+    $init .= &#34;static const $type $head [] = {\n&#34;;
     for my $line &#40;@Rest&#41; {
 	$line =~ s/\s*\z//;
 	next if $line eq &#39;&#39;;
@@ -123,7 +123,7 @@ my @tripletable = &#40;
     {
 	file =&gt; &#34;ucatbl&#34;,
 	name =&gt; &#34;simple&#34;,
-	type =&gt; &#34;char*&#34;,
+	type =&gt; &#34;char* const&#34;,
 	hash =&gt; \%SimpleEntries,
 	null =&gt; &#34;NULL&#34;,
 	init =&gt; $init,
@@ -162,7 +162,7 @@ EOF
 	next if ! $val{ $p };
 	for &#40;my $r = 0; $r &lt; 256; $r++&#41; {
 	    next if ! $val{ $p }{ $r };
-	    printf &#34;static $type ${head}_%02x_%02x [256] = {\n&#34;, $p, $r;
+	    printf &#34;static const $type ${head}_%02x_%02x [256] = {\n&#34;, $p, $r;
 	    for &#40;my $c = 0; $c &lt; 256; $c++&#41; {
 		print &#34;\t&#34;, defined $val{$p}{$r}{$c}
 		    ? &#34;&#40;$type&#41;&#34;.$val{$p}{$r}{$c}
@@ -175,7 +175,7 @@ EOF
     }
     foreach my $p &#40;sort { $a &lt;=&gt; $b } keys %val&#41; {
 	next if ! $val{ $p };
-	printf &#34;static $type* ${head}_%02x [256] = {\n&#34;, $p;
+	printf &#34;static const $type* const ${head}_%02x [256] = {\n&#34;, $p;
 	for &#40;my $r = 0; $r &lt; 256; $r++&#41; {
 	    print $val{ $p }{ $r }
 		? sprintf&#40;&#34;${head}_%02x_%02x&#34;, $p, $r&#41;
@@ -185,7 +185,7 @@ EOF
 	}
 	print &#34;};\n\n&#34;;
     }
-    print &#34;static $type** $head [] = {\n&#34;;
+    print &#34;static const $type* const * const $head [] = {\n&#34;;
     for &#40;my $p = 0; $p &lt;= 0x10; $p++&#41; {
 	print $val{ $p } ? sprintf&#40;&#34;${head}_%02x&#34;, $p&#41; : &#34;NULL&#34;;
 	print &#39;,&#39;  if $p != 0x10;
-- 
1.8.0.msysgit.0

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1446750" href="/Public/Bug/Display.html?id=101170#txn-1446750">#</a>      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;28&nbsp;08:59:05&nbsp;2014</span>
    <span class="description">BULKDD [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1446750/769198/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/769198">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 880b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sun Dec 28 08:50:13 2014, BULKDD wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This transaction appears to have no content
</div>
Previous U::C had about half its tables in read-write memory. Although Win32 &#40;and probably linux&#41; were smart enough to figure out &#34;read write&#34; memory can be shared between perl processes and the disk image until it is first written to, let us not rely on this feature and properly const the data. Also, since &#34;copy-on-write&#34; can become deshared at any random point, all COW data &#40;284KB in before pic&#41; was already charged against my ulimit &#40;assuming I turned on per user account memory limit in Windows, and almost nobody does that&#41;, as noted by the &#34;private&#34; column. Shareable and shared are the same for purpose of comparison. I forgot to start a 2nd perl process to make the picture so shared column is empty. 832KB highlighted entry with address of 0x180000000 is Collate.dll on Win64.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> collateafter.PNG</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1446750/769199/collateafter.PNG">Download collateafter.PNG</a><br />
<span class="downloadcontenttype">image/png 41.8k</span>
</div>
<div class="messagebody">
<img alt="collateafter.PNG" title="collateafter.PNG" src="/Ticket/Attachment/1446750/769199/" /></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> collatebefore.png</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1446750/769200/collatebefore.png">Download collatebefore.png</a><br />
<span class="downloadcontenttype">image/png 42.9k</span>
</div>
<div class="messagebody">
<img alt="collatebefore.png" title="collatebefore.png" src="/Ticket/Attachment/1446750/769200/" /></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1449024" href="/Public/Bug/Display.html?id=101170#txn-1449024">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;04&nbsp;02:39:00&nbsp;2015</span>
    <span class="description">rsn10260 [...] nifty.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #101170] [PATCH] mass consting and some XS efficiency tweaks</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 04 Jan 2015 16:38:44 +0900</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Unicode-Collate [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Sadahiro Tomoyuki &lt;rsn10260 [...] nifty.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1449024/770493/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/770493">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thank you for your report and patch !!

Sadahiro Tomoyuki

&#34;Daniel Dragan via RT&#34; &lt;bug-Unicode-Collate@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;        Queue: Unicode-Collate
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=101170">https://rt.cpan.org/Ticket/Display.html?id=101170</a></span> &gt;
&gt; 
&gt; On Sun Dec 28 08:50:13 2014, BULKDD wrote:
<div class="message-stanza open">&gt; &gt; This transaction appears to have no content
</div>&gt; 
&gt; Previous U::C had about half its tables in read-write memory. Although Win32 &#40;and probably linux&#41; were smart enough to figure out &#34;read write&#34; memory can be shared between perl processes and the disk image until it is first written to, let us not rely on this feature and properly const the data. Also, since &#34;copy-on-write&#34; can become deshared at any random point, all COW data &#40;284KB in before pic&#41; was already charged against my ulimit &#40;assuming I turned on per user account memory limit in Windows, and almost nobody does that&#41;, as noted by the &#34;private&#34; column. Shareable and shared are the same for purpose of comparison. I forgot to start a 2nd perl process to make the picture so shared column is empty. 832KB highlighted entry with address of 0x180000000 is Collate.dll on Win64.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1449025" href="/Public/Bug/Display.html?id=101170#txn-1449025">#</a>      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;04&nbsp;02:39:01&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1453620" href="/Public/Bug/Display.html?id=101170#txn-1453620">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;15&nbsp;08:15:20&nbsp;2015</span>
    <span class="description">SADAHIRO [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.364402</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
