<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #21551 for CGI-Wiki-Plugin-Diff: It would be useful &#40;faster&#41; if differences&#40;&#41; could accept &#40;and return&#41; cached node data</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #21551 for CGI-Wiki-Plugin-Diff: It would be useful &#40;faster&#41; if differences&#40;&#41; could accept &#40;and return&#41; cached node data</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/CGI-Wiki-Plugin-Diff/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/CGI-Wiki-Plugin-Diff/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/CGI-Wiki-Plugin-Diff/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/CGI-Wiki-Plugin-Diff/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/CGI-Wiki-Plugin-Diff">CGI-Wiki-Plugin-Diff CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">21551</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/CGI-Wiki-Plugin-Diff/Active/">CGI-Wiki-Plugin-Diff</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
derek [...] ximbiot.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-6130-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.09    </td>
  </tr>
  <tr id="CF-6131-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;18&nbsp;13:40:28&nbsp;2006</span>
    <span class="description">derek [...] ximbiot.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> It would be useful &#40;faster&#41; if differences&#40;&#41; could accept &#40;and
 return&#41; cached node data</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I am currently working around this using the very simple
CGI::Wiki::Plugin::Diff wrapper I&#39;ve attached, but it would be very
useful if CGI::Wiki::Plugin::Diff could work with cached nodes as my
wrapper demonstrates.

Both covered cases, where some or all of the node data has already been
retrieved and where someone using the plugin might want to display some
additional data from the retrieved nodes must be fairly common. 
Avoiding the additional DBI lookup is much faster.

I should be releasing a new CGI::Wiki based wiki soon and it would be
nice if I didn&#39;t have to distribute such a simple
CGI::Wiki::Plugin::Diff wrapper with it.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> XimbiotPluginDiff.pm</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">package XimbiotPluginDiff;

use strict;

use vars qw&#40;$VERSION @ISA&#41;;

use CGI::Wiki::Plugin::Diff;
use Params::Validate::Dummy &#40;&#41;;
use Module::Optional qw&#40;Params::Validate 
        validate validate_pos SCALAR SCALARREF ARRAYREF HASHREF UNDEF&#41;;

@ISA = qw&#40;CGI::Wiki::Plugin::Diff&#41;;
$VERSION = 0.01;

=head1 NAME

XimbiotPluginDiff - Implementation of CGI::Wiki::Plugin::Diff which caches
the retrieved node data for use by the caller.

=head1 REQUIRES

Subclasses CGI::Wiki::Plugin::Diff

=head1 SYNOPSIS

See CGI::Wiki::Plugin::Diff

=head1 METHODS

=over 4

=item B&lt;differences&gt;

Like the parent method of the same name, except if either left_version or
right_version is found to be a reference, it is assumed to be cached
revision information as returned by the CGI::Wiki::Database::retrieve_node
method.  Also, two extra fields will be present in the output hash,
left_revision &#38; right_revision, which will contain references to the hashes
returned by retrieve node for each version &#40;the same ones passed into the
function, when such is passed&#41;.

=cut

sub differences
{
    my $self = shift;
    my %args = validate &#40;@_, {node          =&gt; {type =&gt; SCALAR},
			      left_version  =&gt; {type =&gt; SCALAR | HASHREF},
			      right_version =&gt; {type =&gt; SCALAR | HASHREF},
			      meta_include  =&gt; {type =&gt; ARRAYREF,
						optional =&gt; 1},
			      meta_exclude  =&gt; {type =&gt; ARRAYREF,
						optional =&gt; 1}}&#41;;

    my &#40;$node, $v1, $v2&#41;  = @args{qw&#40;node left_version right_version&#41;};
    my $store = $self-&gt;datastore;
    my $fmt = $self-&gt;formatter;

    $v1 = {$store-&gt;retrieve_node &#40;name =&gt; $node, version =&gt; $v1&#41;}
	unless ref $v1;
    $v2 = {$store-&gt;retrieve_node &#40;name =&gt; $node, version =&gt; $v2&#41;}
	unless ref $v2;

    my $verstring1 = &#34;Version &#34; . $v1-&gt;{version};
    my $verstring2 = &#34;Version &#34; . $v2-&gt;{version};

    my $el1 = VCS::Lite-&gt;new
	&#40;$verstring1, undef,
	 $self-&gt;content_escape &#40;$v1-&gt;{content}&#41;
	 . $self-&gt;{metadata_separator}
	 . $self-&gt;serialise_metadata &#40;$v1-&gt;{metadata},
				      @args{qw&#40;meta_include meta_exclude&#41;}&#41;&#41;;
    my $el2 = VCS::Lite-&gt;new
	&#40;$verstring2, undef,
	 $self-&gt;content_escape &#40;$v2-&gt;{content}&#41;
	 . $self-&gt;{metadata_separator}
	 . $self-&gt;serialise_metadata &#40;$v2-&gt;{metadata},
				    @args{qw&#40;meta_include meta_exclude&#41;}&#41;&#41;;

    my %pag;
    $pag{left_version} = $verstring1;
    $pag{right_version} = $verstring2;
    $pag{left_revision} = $v1;
    $pag{right_revision} = $v2;
    $pag{content} = $fmt-&gt;format &#40;$v1-&gt;{content}&#41;;
    my $dlt = $el1-&gt;delta &#40;$el2&#41;
	or return %pag;

    my @out;
    
    for &#40;$dlt-&gt;hunks&#41;
    {
    	my &#40;$lin1, $lin2, $out1, $out2&#41;;
	for &#40;@$_&#41;
	{
	    my &#40;$ind, $line, $text&#41; = @$_;
	    if &#40;$ind ne &#39;+&#39;&#41;
	    {
		$lin1 ||= $line;
		$out1 .= $text;
	    }
	    if &#40;$ind ne &#39;-&#39;&#41;
	    {
		$lin2 ||= $line;
		$out2 .= $text;
	    }
	}
    	push @out, {left =&gt; $self-&gt;line_number &#40;$lin1&#41;, 
		    right =&gt; $self-&gt;line_number &#40;$lin2&#41;};
	my &#40;$text1,$text2&#41; = $self-&gt;intradiff &#40;$out1, $out2&#41;;
	push @out, {left =&gt; $text1, right =&gt; $text2};
    }

    $pag{diff} = \@out;
    return %pag;
}
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;20&nbsp;02:43:29&nbsp;2006</span>
    <span class="description">ivorw-cpan [...] xemaps.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">We&#39;re in the middle of a namespace migration.

CGI::Wiki =&gt; Wiki::Toolkit

I&#39;ve added the details from this RT ticket to the trac system:

<span class="clickylink"><a target="new" rel="nofollow" href="http://www.wiki-toolkit.org/ticket/15">http://www.wiki-toolkit.org/ticket/15</a></span>


I&#39;m not planning any more changes to any of my CGI::Wiki:: modules that
have already been migrated.

Please join the mailing list if you want to get more involved.
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.earth.li/cgi-bin/mailman/listinfo/cgi-wiki-dev">http://www.earth.li/cgi-bin/mailman/listinfo/cgi-wiki-dev</a></span>
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;20&nbsp;02:43:30&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;20&nbsp;02:43:30&nbsp;2006</span>
    <span class="description">ivorw-cpan [...] xemaps.com -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
