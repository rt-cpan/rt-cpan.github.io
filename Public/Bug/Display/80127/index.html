<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #80127 for Data-Throttler: YAML_LOAD_WARN_DUPLICATE_KEY in try_push</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #80127 for Data-Throttler: YAML_LOAD_WARN_DUPLICATE_KEY in try_push</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Data-Throttler">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Data-Throttler">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Data-Throttler">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Data-Throttler">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Data-Throttler">Data-Throttler CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">80127</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Data-Throttler">Data-Throttler</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
NHORNE [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-43102-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.05    </td>
  </tr>
  <tr id="CF-43103-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=80127">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1128080" href="/Public/Bug/Display.html?id=80127#txn-1128080">#</a>      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;11&nbsp;09:25:47&nbsp;2012</span>
    <span class="description">NHORNE [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> YAML_LOAD_WARN_DUPLICATE_KEY in try_push</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1128080/593473/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/593473">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sometimes &#40;very rarely, about once a fortnight&#41; I get this error:

  * YAML Warning: Duplicate map key found. Ignoring.
   Code: YAML_LOAD_WARN_DUPLICATE_KEY
   Line: 51
   Document: 1
 at /home/nigelhorne/perlmods/share/perl/5.10.0/YAML/Mo.pm line 24,
&lt;$IN&gt; line 1.
        YAML::Mo::__ANON__&#40;&#39;YAML::Loader=HASH&#40;0x13ce380&#41;&#39;,
&#39;YAML_LOAD_WARN_DUPLICATE_KEY&#39;&#41; called at
/home/nigelhorne/perlmods/share/perl/5.10.0/YAML/Loader.pm line 359
        YAML::Loader::_parse_mapping&#40;&#39;YAML::Loader=HASH&#40;0x13ce380&#41;&#39;, &#39;&#39;&#41; called
at /home/nigelhorne/perlmods/share/perl/5.10.0/YAML/Loader.pm line 168
        YAML::Loader::_parse_node&#40;&#39;YAML::Loader=HASH&#40;0x13ce380&#41;&#39;&#41; called at
/home/nigelhorne/perlmods/share/perl/5.10.0/YAML/Loader.pm line 358
        YAML::Loader::_parse_mapping&#40;&#39;YAML::Loader=HASH&#40;0x13ce380&#41;&#39;, &#39;&#39;&#41; called
at /home/nigelhorne/perlmods/share/perl/5.10.0/YAML/Loader.pm line 168
        YAML::Loader::_parse_node&#40;&#39;YAML::Loader=HASH&#40;0x13ce380&#41;&#39;&#41; called at
/home/nigelhorne/perlmods/share/perl/5.10.0/YAML/Loader.pm line 103
        YAML::Loader::_parse&#40;&#39;YAML::Loader=HASH&#40;0x13ce380&#41;&#39;&#41; called at
/home/nigelhorne/perlmods/share/perl/5.10.0/YAML/Loader.pm line 25
        YAML::Loader::load&#40;&#39;YAML::Loader=HASH&#40;0x13ce380&#41;&#39;, &#39;---\x{a}chain:
!!perl/hash:Data::Throttler::BucketChain\x{a}  bucket_...&#39;&#41; called at
/home/nigelhorne/perlmods/share/perl/5.10.0/YAML.pm line 34
        YAML::Load&#40;&#39;---\x{a}chain:
!!perl/hash:Data::Throttler::BucketChain\x{a}  bucket_...&#39;&#41; called at
/home/nigelhorne/perlmods/share/perl/5.10.0/YAML.pm line 75
        YAML::LoadFile&#40;&#39;/home/nigelhorne/concert-bands.co.uk/../tmp/throttle&#39;&#41;
called at /home/nigelhorne/perlmods/share/perl/5.10.0/Data/Throttler.pm
line 623
        Data::Throttler::Backend::YAML::load&#40;&#39;Data::Throttler::Backend::YAML=HASH&#40;0xdf40f8&#41;&#39;&#41; called at /home/nigelhorne/perlmods/share/perl/5.10.0/Data/Throttler.pm line 131
        Data::Throttler::try_push&#40;&#39;Data::Throttler=HASH&#40;0xdf3c18&#41;&#39;, &#39;key&#39;,
78.150.225.52&#41; called at cbl2.pl line 237

I do not have code to 100% reproduce it, it only happens on rare
occaisions.  Here is the caller:

        my $throttler = Data::Throttler-&gt;new&#40;
                max_items =&gt; 15,
                interval =&gt; 90,
                backend =&gt; &#39;YAML&#39;,
                backend_options =&gt; {
                        db_file =&gt; $info-&gt;tmpdir&#40;&#41; . &#39;/throttle&#39;
                }
        &#41;;

        unless&#40;$throttler-&gt;try_push&#40;key =&gt; $remote&#41;&#41; {
                $istrawler = 1;
        }
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1132377" href="/Public/Bug/Display.html?id=80127#txn-1132377">#</a>      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;23&nbsp;21:31:25&nbsp;2012</span>
    <span class="description">MSCHILLI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1132377/595871/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/595871">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 201b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">That&#39;s very odd indeed, I&#39;ve never seen that happening. You might want to 
consider upgrading from 5.10.0 to something more stable and also make 
sure you&#39;re running the latest YAML from CPAN.

-- Mike
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1132379" href="/Public/Bug/Display.html?id=80127#txn-1132379">#</a>      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;23&nbsp;21:31:26&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1132380" href="/Public/Bug/Display.html?id=80127#txn-1132380">#</a>      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;23&nbsp;21:36:44&nbsp;2012</span>
    <span class="description">NHORNE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1132380/595873/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/595873">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 391b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Oct 23 21:31:25 2012, MSCHILLI wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; That&#39;s very odd indeed, I&#39;ve never seen that happening. You might want to 
&gt; consider upgrading from 5.10.0 to something more stable and also make 
&gt; sure you&#39;re running the latest YAML from CPAN.
</div>

I am running the latest YAML already.  As for upgrading Perl, the site
is hosted by Dreamhost and I&#39;m therefore not able to upgrade it.

-Nigel
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1132382" href="/Public/Bug/Display.html?id=80127#txn-1132382">#</a>      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;23&nbsp;21:50:18&nbsp;2012</span>
    <span class="description">MSCHILLI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1132382/595875/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/595875">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 389b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Interesting, I&#39;m on dreamhost as well and my shared host has got perl-
5.10.1.

I&#39;m puzzled as to why YAML might end up with dupe keys, if you want to 
get to the bottom of this, you can compile your own perl on dreamhost 
shared server &#40;I&#39;ve done it before, it&#39;s easy, just get the tarball, 
configure it to install into ~/perl and &#39;make&#39;&#41; and see if that helps 
getting rid of the issue.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1132861" href="/Public/Bug/Display.html?id=80127#txn-1132861">#</a>      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;25&nbsp;10:14:10&nbsp;2012</span>
    <span class="description">njh [...] bandsman.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #80127] YAML_LOAD_WARN_DUPLICATE_KEY in try_push</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 25 Oct 2012 10:13:42 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Data-Throttler [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Nigel Horne &lt;njh [...] bandsman.co.uk&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1132861/596144/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/596144">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 797b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 10/23/2012 09:50 PM, Michael_Schilli via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=80127">https://rt.cpan.org/Ticket/Display.html?id=80127</a></span>&gt;
&gt;
&gt; Interesting, I&#39;m on dreamhost as well and my shared host has got perl-
&gt; 5.10.1.
</div>
I recently added a new site on Dreamhost and it&#39;s on 5.10.1, but for 
some reason they&#39;ve not updated all hosts some are still running 5.10.0, 
including this site :-&#40;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; I&#39;m puzzled as to why YAML might end up with dupe keys, if you want to
&gt; get to the bottom of this, you can compile your own perl on dreamhost
&gt; shared server &#40;I&#39;ve done it before, it&#39;s easy, just get the tarball,
&gt; configure it to install into ~/perl and &#39;make&#39;&#41; and see if that helps
&gt; getting rid of the issue.
</div>Can I ask what difference there is between 5.10.0 and 5.10.1 that would 
cause Data::Throttler to break?

-Nigel
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1132873" href="/Public/Bug/Display.html?id=80127#txn-1132873">#</a>      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;25&nbsp;11:13:57&nbsp;2012</span>
    <span class="description">MSCHILLI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1132873/596155/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/596155">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 145b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">It&#39;s probably unrelated, but I wanted to rule out perl-5.10.0 being the 
culprit because I&#39;ve seen lots of unexplicable bugs with it in the past.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1177929" href="/Public/Bug/Display.html?id=80127#txn-1177929">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;06&nbsp;09:03:07&nbsp;2013</span>
    <span class="description">NHORNE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1177929/621358/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/621358">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 539b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Oct 25 11:13:57 2012, MSCHILLI wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; It&#39;s probably unrelated, but I wanted to rule out perl-5.10.0 being the 
&gt; culprit because I&#39;ve seen lots of unexplicable bugs with it in the past.
</div>
I&#39;m sorry for the delay.  Dreamhost has now given me an update but that has the same problem:

   Code: YAML_PARSE_ERR_INCONSISTENT_INDENTATION
   Line: 50
   Document: 1
 at /home/nigelhorne/perlmods/share/perl/5.10.1/YAML/Loader.pm line 719.
   Code: YAML_LOAD_ERR_FILE_INPUT
 at /home/nigelhorne/perlmods/share/perl/5.10.1/YAML.pm line 71.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1177931" href="/Public/Bug/Display.html?id=80127#txn-1177931">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;06&nbsp;09:04:05&nbsp;2013</span>
    <span class="description">NHORNE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1177931/621360/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/621360">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 749b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Feb 06 09:03:07 2013, NHORNE wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Thu Oct 25 11:13:57 2012, MSCHILLI wrote:
<div class="message-stanza open">&gt; &gt; It&#39;s probably unrelated, but I wanted to rule out perl-5.10.0 being
</div>&gt; the
<div class="message-stanza open">&gt; &gt; culprit because I&#39;ve seen lots of unexplicable bugs with it in the
</div>&gt; past.
&gt; 
&gt; I&#39;m sorry for the delay.  Dreamhost has now given me an update but
&gt; that has the same problem:
&gt; 
&gt;    Code: YAML_PARSE_ERR_INCONSISTENT_INDENTATION
&gt;    Line: 50
&gt;    Document: 1
&gt;  at /home/nigelhorne/perlmods/share/perl/5.10.1/YAML/Loader.pm line
&gt; 719.
&gt;    Code: YAML_LOAD_ERR_FILE_INPUT
&gt;  at /home/nigelhorne/perlmods/share/perl/5.10.1/YAML.pm line 71.
</div>

Actually now I look closer it may not be the same problem, but it&#39;s a problem nevertheless 
which I could do with some help on please.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1222528" href="/Public/Bug/Display.html?id=80127#txn-1222528">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jun&nbsp;10&nbsp;09:48:32&nbsp;2013</span>
    <span class="description">NHORNE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1222528/645669/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/645669">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 411b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for enhancing the error message.  I am now seeing this, I hope it helps:

Can&#39;t call method &#34;try_push&#34; on an undefined value at /home/nigelhorne/perlmods/share/perl/5.10.1/Data/Throttler.pm line 132.
YAML Error: Couldn&#39;t open /home/nigelhorne/bandsman.co.uk/../tmp/throttle for input:\nBad file descriptor
   Code: YAML_LOAD_ERR_FILE_INPUT
 at /home/nigelhorne/perlmods/share/perl/5.10.1/YAML.pm line 71.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1236038" href="/Public/Bug/Display.html?id=80127#txn-1236038">#</a>      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;15&nbsp;22:08:10&nbsp;2013</span>
    <span class="description">MSCHILLI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1236038/653308/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/653308">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 591b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Jun 10 09:48:32 2013, NHORNE wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Can&#39;t call method &#34;try_push&#34; on an undefined value at
&gt; /home/nigelhorne/perlmods/share/perl/5.10.1/Data/Throttler.pm line
&gt; 132.
</div>
Hi Nigel,

sorry about the delay on this, I&#39;ve looked at the code some more and saw that it&#39;s not the newly added diagnostics line that&#39;s triggering the error but it seems to originate from a general problem loading the YAML file. Did you specify it in the constructor using the db_file option? Would be great if you could post the code &#40;or snippets thereof&#41; here to make sure I&#39;m reproducing the problem correctly.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1236251" href="/Public/Bug/Display.html?id=80127#txn-1236251">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jul&nbsp;16&nbsp;08:49:51&nbsp;2013</span>
    <span class="description">NHORNE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1236251/653428/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/653428">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 529b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Here is a snippet which shows, in general terms, how I&#39;m using the code:

        my $info = CGI::Info-&gt;new&#40;&#41;;

        my $db_file = $info-&gt;tmpdir&#40;&#41; . &#39;/throttle&#39;;
    
        my $throttler = Data::Throttler-&gt;new&#40;
                max_items =&gt; 15,
                interval =&gt; 90,
                backend =&gt; &#39;YAML&#39;,
                backend_options =&gt; {
                       db_file =&gt; $db_file
                }
        &#41;;

        unless&#40;$throttler-&gt;try_push&#40;key =&gt; $ENV{&#39;REMOTE_ADDR&#39;}&#41;&#41; {
               $block = 1;
        }
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1236561" href="/Public/Bug/Display.html?id=80127#txn-1236561">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;17&nbsp;01:17:43&nbsp;2013</span>
    <span class="description">MSCHILLI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1236561/653582/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/653582">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 787b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Jul 16 08:49:51 2013, NHORNE wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Here is a snippet which shows, in general terms, how I&#39;m using the code:
</div>
That looks pretty straight-forward, and I don&#39;t see anything wrong with it.

So far, you&#39;ve seen several instances of a corrupted YAML file or &#40;the last time&#41; a missing YAML file. The file locking employed by the throttler should have prevented this. 

You&#39;ve mentioned that you&#39;re running on a dreamhost shared server, so I wonder if there&#39;s something strange happening to the tmp directory you&#39;re using to store the db_file. I presume their servers mount the file system on a filer, and this could mean that file locking is no longer atomic, which might create the error conditions you&#39;re seeing. 

Have you been able to reproduce the problem on a local file system?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1236761" href="/Public/Bug/Display.html?id=80127#txn-1236761">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;17&nbsp;10:13:07&nbsp;2013</span>
    <span class="description">NHORNE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1236761/653728/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/653728">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 654b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; You&#39;ve mentioned that you&#39;re running on a dreamhost shared server, so
&gt;    I wonder if there&#39;s something strange happening to the tmp
&gt;    directory you&#39;re using to store the db_file. I presume their
&gt;    servers mount the file system on a filer, and this could mean that
&gt;    file locking is no longer atomic, which might create the error
&gt;    conditions you&#39;re seeing.
</div>
There shouldn&#39;t be a problem since the tmp directory I&#39;m using is on a local disc drive &#40;/dev/sdb1&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Have you been able to reproduce the problem on a local file system?
</div>
No, but then I&#39;m not surprised since it only happens on rare occasions and probably in a race condition.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1236824" href="/Public/Bug/Display.html?id=80127#txn-1236824">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;17&nbsp;11:48:51&nbsp;2013</span>
    <span class="description">MSCHILLI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1236824/653768/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/653768">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 605b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Here&#39;s a quick script to verify if locking works correctly with Data::Throttler:

<span class="clickylink"><a target="new" rel="nofollow" href="https://raw.github.com/mschilli/data-throttler-perl/master/eg/forktest">https://raw.github.com/mschilli/data-throttler-perl/master/eg/forktest</a></span>

You might want to point the db_file to a location within the temporary directory you&#39;re using. If you&#39;re getting no output, locking works correctly. If you&#39;re getting YAML and locking errors, flock isn&#39;t working on your platform.

I was able to successfully reproduce the problem by removing locking from Data::Throttler, but it works fine with the original Data::Throttler code, both on my local file system and on my dreamhost shared server account.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1236998" href="/Public/Bug/Display.html?id=80127#txn-1236998">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;18&nbsp;08:24:22&nbsp;2013</span>
    <span class="description">NHORNE [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1236998/653880/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/653880">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 303b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Jul 17 11:48:51 2013, MSCHILLI wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Here&#39;s a quick script to verify if locking works correctly with
&gt;    Data::Throttler:
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://raw.github.com/mschilli/data-throttler-perl/master/eg/forktest">https://raw.github.com/mschilli/data-throttler-perl/master/eg/forktest</a></span>
&gt; 
</div>
I ran the script in the script in the tmp directory that I use.  I got no output.

-Nigel
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1237119" href="/Public/Bug/Display.html?id=80127#txn-1237119">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;18&nbsp;12:06:33&nbsp;2013</span>
    <span class="description">m [...] perlmeister.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #80127] YAML_LOAD_WARN_DUPLICATE_KEY in try_push</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 18 Jul 2013 09:03:37 -0700 &#40;PDT&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Nigel Horne via RT &lt;bug-Data-Throttler [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mike Schilli &lt;m [...] perlmeister.com&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1237119/653950/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/653950">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 398b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, 18 Jul 2013, Nigel Horne via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I ran the script in the script in the tmp directory that I use.  I got
&gt; no output.
</div>
If there&#39;s no inherent problem with the locking on the file system
you&#39;re using, then the only other idea I have on how this could happen
is that a third party process interferes with the yaml file in some
other way.

  -- -- Mike

Mike Schilli
m@perlmeister.com
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1504745" href="/Public/Bug/Display.html?id=80127#txn-1504745">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;06&nbsp;14:27:19&nbsp;2015</span>
    <span class="description">MSCHILLI [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1504745/801869/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/801869">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 25b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Closed due to inactivity.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1504747" href="/Public/Bug/Display.html?id=80127#txn-1504747">#</a>      
    </span>
    <span class="date">Sat&nbsp;Jun&nbsp;06&nbsp;14:27:21&nbsp;2015</span>
    <span class="description">MSCHILLI [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.752782</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
