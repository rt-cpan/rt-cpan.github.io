<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #50557 for Crypt-SSLeay: Crypt-SSLeay with openssl 1.0 has memory corruption issue</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #50557 for Crypt-SSLeay: Crypt-SSLeay with openssl 1.0 has memory corruption issue</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Crypt-SSLeay">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Crypt-SSLeay">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Crypt-SSLeay">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Crypt-SSLeay">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Crypt-SSLeay">Crypt-SSLeay CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">50557</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Crypt-SSLeay">Crypt-SSLeay</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
mmaslano [...] redhat.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-8676-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.57    </td>
  </tr>
  <tr id="CF-8677-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




test.pl<br />
<ul>

</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=50557">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-677624" href="/Public/Bug/Display.html?id=50557#txn-677624">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;16&nbsp;07:12:15&nbsp;2009</span>
    <span class="description">mmaslano [...] redhat.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Crypt-SSLeay with openssl 1.0 has memory corruption issue</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/677624/348626/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/348626">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 915b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">perl script that uses Crypt::SSLeay is crashing since upgrade to openssl
1.0. Backtrace head with various debuginfo installed:

#0  freelist_insert &#40;ctx=0xa18c140, for_read=1, sz=34120, mem=0xa0d6a80&#41;
    at s3_both.c:645
#1  0x0072f305 in ssl3_release_read_buffer &#40;s=0xa0c4780&#41; at s3_both.c:762
#2  0x0072b60c in ssl3_free &#40;s=0xa0c4780&#41; at s3_lib.c:2151
#3  0x00733d75 in tls1_free &#40;s=0xa0c4780&#41; at t1_lib.c:163
#4  0x00742041 in SSL_free &#40;s=0xa0c4780&#41; at ssl_lib.c:581
#5  0x00a6a7c5 in XS_Crypt__SSLeay__Conn_free &#40;my_perl=0x9242008,
cv=0xa002d54&#41;
    at SSLeay.c:521  

It looks like the problem is with free&#39;ing. SSL_CTX_free&#40;&#41; is called as
first and then SSL_free&#40;&#41;. IMHO these calls should be switched and
SSL_free should be called as first. I&#39;m not familiar with XS module,
therefore I&#39;d rather wait for your opinion.

Whole bug report could be found here:
<span class="clickylink"><a target="new" rel="nofollow" href="https://bugzilla.redhat.com/show_bug.cgi?id=521342">https://bugzilla.redhat.com/show_bug.cgi?id=521342</a></span>
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> test.pl</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"></div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-677981" href="/Public/Bug/Display.html?id=50557#txn-677981">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;16&nbsp;17:53:56&nbsp;2009</span>
    <span class="description">david [...] landgren.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #50557] Crypt-SSLeay with openssl 1.0 has memory corruption issue</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 16 Oct 2009 23:53:49 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Crypt-SSLeay [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> David Landgren &lt;david [...] landgren.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/677981/348827/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/348827">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Marcela Maslanova via RT wrote, some time around 16/10/2009 13:12:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Fri Oct 16 07:12:15 2009: Request 50557 was acted upon.
&gt; Transaction: Ticket created by mmaslano@redhat.com
&gt;        Queue: Crypt-SSLeay
&gt;      Subject: Crypt-SSLeay with openssl 1.0 has memory corruption issue
&gt;    Broken in: 0.57
&gt;     Severity: Important
&gt;        Owner: Nobody
&gt;   Requestors: mmaslano@redhat.com
&gt;       Status: new
&gt;  Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=50557">https://rt.cpan.org/Ticket/Display.html?id=50557</a></span> &gt;
&gt; 
&gt; 
&gt; perl script that uses Crypt::SSLeay is crashing since upgrade to openssl
&gt; 1.0. Backtrace head with various debuginfo installed:
&gt; 
&gt; #0  freelist_insert &#40;ctx=0xa18c140, for_read=1, sz=34120, mem=0xa0d6a80&#41;
&gt;     at s3_both.c:645
&gt; #1  0x0072f305 in ssl3_release_read_buffer &#40;s=0xa0c4780&#41; at s3_both.c:762
&gt; #2  0x0072b60c in ssl3_free &#40;s=0xa0c4780&#41; at s3_lib.c:2151
&gt; #3  0x00733d75 in tls1_free &#40;s=0xa0c4780&#41; at t1_lib.c:163
&gt; #4  0x00742041 in SSL_free &#40;s=0xa0c4780&#41; at ssl_lib.c:581
&gt; #5  0x00a6a7c5 in XS_Crypt__SSLeay__Conn_free &#40;my_perl=0x9242008,
&gt; cv=0xa002d54&#41;
&gt;     at SSLeay.c:521  
&gt; 
&gt; It looks like the problem is with free&#39;ing. SSL_CTX_free&#40;&#41; is called as
&gt; first and then SSL_free&#40;&#41;. IMHO these calls should be switched and
&gt; SSL_free should be called as first. I&#39;m not familiar with XS module,
&gt; therefore I&#39;d rather wait for your opinion.
</div>
I&#39;ve no firm idea myself but your hypothesis sounds plausible. You can 
edit the source yourself and see if it fixes the problem. If it does, 
I&#39;ll push a new release out.

There&#39;s a number of other things that need to be taken care of at the 
same time.

Later,
David


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Whole bug report could be found here:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://bugzilla.redhat.com/show_bug.cgi?id=521342">https://bugzilla.redhat.com/show_bug.cgi?id=521342</a></span>
&gt; 
</div>

-- 
it&#39;s an anthem in a vacuum on a hyperstation, day dreaming days in a 
daydream nation
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-677982" href="/Public/Bug/Display.html?id=50557#txn-677982">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;16&nbsp;17:53:57&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-678995" href="/Public/Bug/Display.html?id=50557#txn-678995">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;19&nbsp;02:15:04&nbsp;2009</span>
    <span class="description">mmaslano [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> mmaslano [...] redhat.com</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/678995/349450/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/349450">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 967b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; It looks like the problem is with free&#39;ing. SSL_CTX_free&#40;&#41; is called as
&gt; &gt; first and then SSL_free&#40;&#41;. IMHO these calls should be switched and
&gt; &gt; SSL_free should be called as first. I&#39;m not familiar with XS module,
&gt; &gt; therefore I&#39;d rather wait for your opinion.
</div>&gt; 
&gt; I&#39;ve no firm idea myself but your hypothesis sounds plausible. You can 
&gt; edit the source yourself and see if it fixes the problem. If it does, 
&gt; I&#39;ll push a new release out.
&gt; 
&gt; There&#39;s a number of other things that need to be taken care of at the 
&gt; same time.
&gt; 
&gt; Later,
&gt; David
&gt; 
&gt; 
<div class="message-stanza open">&gt; &gt; Whole bug report could be found here:
&gt; &gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://bugzilla.redhat.com/show_bug.cgi?id=521342">https://bugzilla.redhat.com/show_bug.cgi?id=521342</a></span>
&gt; &gt; 
</div>&gt; 
&gt; 
</div>
I tried switch these calls and it worked. I&#39;d rather take fix from you
because I&#39;m not sure what else could be broken by this change.

Maintainer of openssl informed me that there was bug also in openssl
package which will be fixed in next release, but the fix should be done
in both packages.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-696263" href="/Public/Bug/Display.html?id=50557#txn-696263">#</a>      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;23&nbsp;14:50:33&nbsp;2009</span>
    <span class="description">kmx [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/696263/359049/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/359049">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 877b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

the OpenSSL 1.0.0 issue is related to a version detection routine in
Makefile.pl that is not ready for version numbers starting with 1.

The current code detects &#34;undef&#34; version and based on that we define:
#define CRYPT_SSLEAY_free free
instead of
#define CRYPT_SSLEAY_free OPENSSL_free

Here is a simple patch for Makefile.PL that solves it:

     my $version;
     my $type;
     while &#40;&lt;VERSION_FILE&gt;&#41; {
-        if &#40;/^#define\s+$version_match\s+0x0+&#40;\d\d\d&#41;/&#41; {
+        if &#40;/^#define\s+$version_match\s+0x&#40;\d\d\d\d\d&#41;/&#41; {
             $version = $1;
-            $version =~ s/&#40;\d&#41;0&#40;\d&#41;/$1$2/;
+            $version =~ s/^&#40;\d&#41;0&#40;\d&#41;0&#40;\d&#41;/$1$2$3/;
             $type = &#40;$version &gt; 92&#41; ? &#34;OpenSSL&#34; : &#34;SSLeay&#34;;
-            $version = join&#40;&#39;.&#39;, split&#40;//, &#34;0$version&#34;&#41;&#41;;
+            $version = join&#40;&#39;.&#39;, split&#40;//, $version&#41;&#41;;
             last;
         }
     }

--
kmx
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-697742" href="/Public/Bug/Display.html?id=50557#txn-697742">#</a>      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;26&nbsp;10:55:35&nbsp;2009</span>
    <span class="description">mmaslano [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/697742/359803/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/359803">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 329b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Nov 23 14:50:33 2009, KMX wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi,
&gt; 
&gt; the OpenSSL 1.0.0 issue is related to a version detection routine in
&gt; Makefile.pl that is not ready for version numbers starting with 1.
</div>
Hello,
I believe this is different issue because the crash was fixed in OpenSSL
upstream.
Anyway this patch looks useful.

Regards,
Marcela
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-700182" href="/Public/Bug/Display.html?id=50557#txn-700182">#</a>      
    </span>
    <span class="date">Tue&nbsp;Dec&nbsp;01&nbsp;04:17:53&nbsp;2009</span>
    <span class="description">kmx [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/700182/361014/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/361014">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 341b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I believe this is different issue because the crash was fixed in OpenSSL
&gt; upstream.
&gt; Anyway this patch looks useful.
</div>
OK, do you think it is worth starting a new RT?

For us &#40;Win32/strawberry perl project&#41; this patch is quite important as
we are not able to use Crypt::SSLeay+openssl-1.0.0 without it. 

Thanks for feedback.

--
kmx
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-815048" href="/Public/Bug/Display.html?id=50557#txn-815048">#</a>      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;09&nbsp;13:38:03&nbsp;2010</span>
    <span class="description">nanis [...] runu.moc.invalid -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/815048/422328/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/422328">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello:

I recently took on the task of clearing up the RT queue for
Crypt-SSLeay. I am trying to understand what issues still need fixing
and familiarize myself with the details of the code.

Looking at <span class="clickylink"><a target="new" rel="nofollow" href="https://bugzilla.redhat.com/show_bug.cgi?id=521342">https://bugzilla.redhat.com/show_bug.cgi?id=521342</a></span> I am
wondering if the fix you propose below is still necessary.

If so, could you give me an idea where it is supposed to go in SSLeay.xs
as SSLeay.c is generated from that file.

-- Sinan


On Fri Oct 16 07:12:15 2009, mmaslano@redhat.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; perl script that uses Crypt::SSLeay is crashing since upgrade to openssl
&gt; 1.0. Backtrace head with various debuginfo installed:
&gt; 
&gt; #0  freelist_insert &#40;ctx=0xa18c140, for_read=1, sz=34120, mem=0xa0d6a80&#41;
&gt;     at s3_both.c:645
&gt; #1  0x0072f305 in ssl3_release_read_buffer &#40;s=0xa0c4780&#41; at s3_both.c:762
&gt; #2  0x0072b60c in ssl3_free &#40;s=0xa0c4780&#41; at s3_lib.c:2151
&gt; #3  0x00733d75 in tls1_free &#40;s=0xa0c4780&#41; at t1_lib.c:163
&gt; #4  0x00742041 in SSL_free &#40;s=0xa0c4780&#41; at ssl_lib.c:581
&gt; #5  0x00a6a7c5 in XS_Crypt__SSLeay__Conn_free &#40;my_perl=0x9242008,
&gt; cv=0xa002d54&#41;
&gt;     at SSLeay.c:521  
&gt; 
&gt; It looks like the problem is with free&#39;ing. SSL_CTX_free&#40;&#41; is called as
&gt; first and then SSL_free&#40;&#41;. IMHO these calls should be switched and
&gt; SSL_free should be called as first. I&#39;m not familiar with XS module,
&gt; therefore I&#39;d rather wait for your opinion.
&gt; 
&gt; Whole bug report could be found here:
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://bugzilla.redhat.com/show_bug.cgi?id=521342">https://bugzilla.redhat.com/show_bug.cgi?id=521342</a></span>
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-816062" href="/Public/Bug/Display.html?id=50557#txn-816062">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;12&nbsp;01:01:10&nbsp;2010</span>
    <span class="description">http://mmaslano.livejournal.com/ -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/816062/422823/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/422823">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 691b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Aug 09 13:38:03 2010, NANIS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hello:
&gt; 
&gt; I recently took on the task of clearing up the RT queue for
&gt; Crypt-SSLeay. I am trying to understand what issues still need fixing
&gt; and familiarize myself with the details of the code.
&gt; 
&gt; Looking at <span class="clickylink"><a target="new" rel="nofollow" href="https://bugzilla.redhat.com/show_bug.cgi?id=521342">https://bugzilla.redhat.com/show_bug.cgi?id=521342</a></span> I am
&gt; wondering if the fix you propose below is still necessary.
&gt; 
&gt; If so, could you give me an idea where it is supposed to go in SSLeay.xs
&gt; as SSLeay.c is generated from that file.
&gt; 
&gt; -- Sinan
</div>
Hello,
I can&#39;t reproduce it anymore with v0.57. Maybe changes in openssl clean
this problem.
Anyway patch for Makefile which was mentioned above is still needed.

Regards,
Marcela
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-816197" href="/Public/Bug/Display.html?id=50557#txn-816197">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;12&nbsp;11:40:46&nbsp;2010</span>
    <span class="description">nanis [...] runu.moc.invalid -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/816197/422881/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/422881">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 612b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Aug 12 01:01:10 2010, <span class="clickylink"><a target="new" rel="nofollow" href="http://mmaslano.livejournal.com/">http://mmaslano.livejournal.com/</a></span> wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon Aug 09 13:38:03 2010, NANIS wrote:
</div>
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Looking at <span class="clickylink"><a target="new" rel="nofollow" href="https://bugzilla.redhat.com/show_bug.cgi?id=521342">https://bugzilla.redhat.com/show_bug.cgi?id=521342</a></span> I am
&gt; &gt; wondering if the fix you propose below is still necessary.
&gt; &gt; 
</div></div>...

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hello, I can&#39;t reproduce it anymore with v0.57. Maybe changes in openssl
&gt; clean this problem.  Anyway patch for Makefile which was mentioned
</div>above is
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; still needed.
</div>
The version detection stuff should be fixed in 0.57_04. Could you please try
that.

I am going to close this ticket for now. If you get more information, please
re-open it.

-- Sinan
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-816200" href="/Public/Bug/Display.html?id=50557#txn-816200">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;12&nbsp;11:40:47&nbsp;2010</span>
    <span class="description">nanis [...] runu.moc.invalid -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.652356</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
