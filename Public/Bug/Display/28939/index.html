<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #28939 for Net-Akismet: significant bug in Net::Akismet</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #28939 for Net-Akismet: significant bug in Net::Akismet</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Net-Akismet">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Net-Akismet">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Net-Akismet">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Net-Akismet">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-Akismet">Net-Akismet CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">28939</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Net-Akismet">Net-Akismet</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
john [...] neggie.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-38008-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-38009-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




net-akismet-0.04.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/356258/160606/net-akismet-0.04.diff">
Tue Aug 28 01:38:41 2007 (1.3k) by nbachiyski [...] developer.bg
</a>
</font></li>
</ul>


net-akismet_user-agent.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/354907/159937/net-akismet_user-agent.diff">
Wed Aug 22 07:09:16 2007 (2.5k) by john [...] neggie.net
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=28939">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-354907" href="/Public/Bug/Display.html?id=28939#txn-354907">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;22&nbsp;07:09:16&nbsp;2007</span>
    <span class="description">john [...] neggie.net -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> significant bug in Net::Akismet</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 22 Aug 2007 07:04:54 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-Akismet [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Belmonte &lt;john [...] neggie.net&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/354907/159936/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/159936">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">It seems that Net::Akismet is confusing the user agent making the
request to Akismet with the user agent making the comment to the blog.
These are two very different things, and both are required by Akismet.

The user agent given to LWP::UserAgent-&gt;agent should be that of
Net::Akismet-- that part is correct.

The user agent given in the Akismet request &#40;e.g., along side referrer&#41;
must be that which came from the comment posting.  Akismet requires this
to do its analysis.  Unfortunately Net::Akismet is using its own user
agent here, which could seriously skew the effects of the check/ham/spam
requests.

A patched to fix this problem is attached.  It also addresses a smaller
issue:  Akismet&#39;s own user agent string should not have a
space in it &#40;i.e. &#34;Akismet Perl&#34;&#41;-- the HTTP spec says &#34;&lt;word&gt;
[/&lt;version&gt;]&#34;.  LWP::UserAgent-&gt;agent has it&#39;s own agent and knows to
prepend when your string ends with a space.  I propose that the final
user agent HTTP field look something like this e.g.:

    SomeBlogEngine/1.2 NetAkismet/0.02 libwww-perl/5.50

I think Akismet&#39;s suggestion of &#34;|&#34; as delimiter is incorrect.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/354907/159937/net-akismet_user-agent.diff">Download net-akismet_user-agent.diff</a><br />
<span class="downloadcontenttype">text/x-diff 2.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Proposed Net::Akismet patch:

   * check/ham/spam functions take USER_AGENT field.  This must be the
     User-Agent string from the comment HTTP request, and is required by
     Akismet.  &#40;See &lt;<span class="clickylink"><a target="new" rel="nofollow" href="http://akismet.com/development/api/">http://akismet.com/development/api/</a></span>&gt;.&#41;

   * improve Net::Akismet&#39;s own user agent string for standard conformance
     and to include libwww-perl component.


--- Akismet.pm.orig	2007-08-18 15:20:56.000000000 -0400
+++ Akismet.pm	2007-08-18 15:21:03.000000000 -0400
@@ -14,9 +14,9 @@
 use LWP::UserAgent;
 use HTTP::Request::Common;
 
-our $VERSION	= &#39;0.02&#39;;
+our $VERSION	= &#39;0.03&#39;;
 
-my $UA_SUFFIX	= &#34;Akismet Perl/$VERSION&#34;;
+my $UA_SUFFIX	= &#34;Net-Akismet/$VERSION&#34;;
 
 =head1 SYNOPSIS
 
@@ -27,6 +27,7 @@
 
 	my $verdict = $akismet-&gt;check&#40;
 			USER_IP 		=&gt; &#39;10.10.10.11&#39;,
+			USER_AGENT 		=&gt; &#39;Mozilla/5.0&#39;,
 			COMMENT_CONTENT		=&gt; &#39;Run, Lola, Run, the spam will catch you!&#39;,
 			COMMENT_AUTHOR		=&gt; &#39;dosser&#39;,
 			COMENT_AUTHOR_EMAIL	=&gt; &#39;dosser@subway.de&#39;,
@@ -62,7 +63,7 @@
 
 If supplied the value is prepended to this module&#39;s identification string to become something like:
 
-	yourkillerapp/0.042 | Akismet Perl/0.01
+	your-killer-app/0.042 Net-Akismet/0.01 libwww-perl/5.8
 
 Otherwise just Akismet Perl&#39;s user agent string will be sent.
 
@@ -85,9 +86,10 @@
 	my $key 	= $self-&gt;{KEY} or return undef;
 	my $url		= $self-&gt;{URL} or return undef;
 
-	my $agent = $params{USER_AGENT}? &#34;$params{USER_AGENT} | &#34; : &#39;&#39;;
-
-	$self-&gt;{ua}-&gt;agent&#40;$agent.$UA_SUFFIX&#41;;
+	# NOTE: trailing space leaves LWP::UserAgent agent string in place
+	my $agent = &#34;$UA_SUFFIX &#34;;
+	$agent = &#34;$params{USER_AGENT} $agent&#34; if $params{USER_AGENT};
+	$self-&gt;{ua}-&gt;agent&#40;$agent&#41;;
 
 	bless $self, $class;
 
@@ -124,7 +126,11 @@
 
 =item  USER_IP
 
-The B&lt;only required&gt; item.  Represents the IP address of the comment submitter.
+B&lt;Required.&gt;  Represents the IP address of the comment submitter.
+
+=item  USER_AGENT
+
+B&lt;Required.&gt;  User agent string from the comment submitter&#39;s request.
 
 =item  COMMENT_CONTENT
 
@@ -208,14 +214,14 @@
 
 	my $comment = shift;
 
-	$comment-&gt;{USER_IP} 	|| return undef;
+	$comment-&gt;{USER_IP} &#38;&#38; $comment-&gt;{USER_AGENT} || return undef;
 
 	my $response = $self-&gt;{ua}-&gt;request&#40;
     	POST &#34;http://$self-&gt;{KEY}.rest.akismet.com/1.1/$action&#34;,
             [
                 blog 					=&gt; $self-&gt;{URL},
 				user_ip					=&gt; $comment-&gt;{USER_IP},
-				user_agent				=&gt; $self-&gt;{ua}-&gt;agent&#40;&#41;,
+				user_agent				=&gt; $comment-&gt;{USER_AGENT},
 				referrer				=&gt; $comment-&gt;{REFERRER},
 				permalink				=&gt; $comment-&gt;{PERMALINK},
 				comment_type			=&gt; $comment-&gt;{COMMENT_TYPE},
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-355976" href="/Public/Bug/Display.html?id=28939#txn-355976">#</a>      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;27&nbsp;03:23:41&nbsp;2007</span>
    <span class="description">nbachiyski [...] developer.bg -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> nbachiyski [...] developer.bg</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/355976/160456/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/160456">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 301b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sorry for the delay, and thank you for the patch.

I applied it almost as-is. I just changed the Net::Akismet&#39;s user agent
portion to Perl-Net-Akismet, it is important to know that it is the perl
library. Also I had to rename the user agent key to COMMENT_USER_AGENT,
because of POD links ambiguities.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-355977" href="/Public/Bug/Display.html?id=28939#txn-355977">#</a>      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;27&nbsp;03:23:42&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-356237" href="/Public/Bug/Display.html?id=28939#txn-356237">#</a>      
    </span>
    <span class="date">Mon&nbsp;Aug&nbsp;27&nbsp;19:24:16&nbsp;2007</span>
    <span class="description">john [...] neggie.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #28939] significant bug in Net::Akismet</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 27 Aug 2007 19:23:14 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-Akismet [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Belmonte &lt;john [...] neggie.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/356237/160588/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/160588">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 278b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Nikolay Bachiyski via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Also I had to rename the user agent key to COMMENT_USER_AGENT,
&gt; because of POD links ambiguities.
</div>
In the synopsis you are still showing my original name of USER_AGENT
when calling check&#40;&#41;-- that needs to be changed to COMMENT_USER_AGENT now.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-356258" href="/Public/Bug/Display.html?id=28939#txn-356258">#</a>      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;28&nbsp;01:38:40&nbsp;2007</span>
    <span class="description">nbachiyski [...] developer.bg -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> nbachiyski [...] developer.bg</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/356258/160603/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/160603">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 380b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; In the synopsis you are still showing my original name of USER_AGENT
&gt; when calling check&#40;&#41;-- that needs to be changed to COMMENT_USER_AGENT now.
</div>
Yeah, you are absolutely right. I uploaded the 0.03 quite er...
prematurely :-&#41;

Also I will allow people to still use USER_AGENT for a key in the
comments hash.

Now I am attaching a patch for a preview.

Thank you again, John.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/356258/160606/net-akismet-0.04.diff">Download net-akismet-0.04.diff</a><br />
<span class="downloadcontenttype">text/x-diff 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Index: lib/Net/Akismet.pm
===================================================================
--- lib/Net/Akismet.pm	&#40;revision 32&#41;
+++ lib/Net/Akismet.pm	&#40;working copy&#41;
@@ -14,7 +14,7 @@
 use LWP::UserAgent;
 use HTTP::Request::Common;
 
-our $VERSION	= &#39;0.03&#39;;
+our $VERSION	= &#39;0.04&#39;;
 
 my $UA_SUFFIX	= &#34;Perl-Net-Akismet/$VERSION&#34;;
 
@@ -26,8 +26,8 @@
 		&#41; or die&#40;&#39;Key verification failure!&#39;&#41;;
 
 	my $verdict = $akismet-&gt;check&#40;
-			USER_IP 		=&gt; &#39;10.10.10.11&#39;,
-			USER_AGENT 		=&gt; &#39;Mozilla/5.0&#39;,
+			USER_IP 			=&gt; &#39;10.10.10.11&#39;,
+			COMMENT_USER_AGENT 	=&gt; &#39;Mozilla/5.0&#39;,
 			COMMENT_CONTENT		=&gt; &#39;Run, Lola, Run, the spam will catch you!&#39;,
 			COMMENT_AUTHOR		=&gt; &#39;dosser&#39;,
 			COMENT_AUTHOR_EMAIL	=&gt; &#39;dosser@subway.de&#39;,
@@ -214,8 +214,14 @@
 
 	my $comment = shift;
 
-	$comment-&gt;{USER_IP} &#38;&#38; $comment-&gt;{COMMENT_USER_AGENT} || return undef;
+	$comment-&gt;{USER_IP} &#38;&#38; &#40;$comment-&gt;{COMMENT_USER_AGENT} || $comment-&gt;{USER_AGENT}&#41; || return undef;
 
+	# allow USER_AGENT key for backward compatibility with versions &lt;0.03 
+	$comment-&gt;{COMMENT_USER_AGENT} = $comment-&gt;{USER_AGENT} unless $comment-&gt;{COMMENT_USER_AGENT};
+
+	# accomodate common misspelling
+	$comment-&gt;{REFERRER} = $comment-&gt;{REFERER} if !$comment-&gt;{REFERRER} &#38;&#38; $comment-&gt;{REFERER};
+
 	my $response = $self-&gt;{ua}-&gt;request&#40;
     	POST &#34;http://$self-&gt;{KEY}.rest.akismet.com/1.1/$action&#34;,
             [
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-356462" href="/Public/Bug/Display.html?id=28939#txn-356462">#</a>      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;28&nbsp;23:15:12&nbsp;2007</span>
    <span class="description">john [...] neggie.net -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #28939] significant bug in Net::Akismet</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 28 Aug 2007 23:11:52 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Net-Akismet [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> John Belmonte &lt;john [...] neggie.net&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/356462/160724/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/160724">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Nikolay,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;       my $verdict = $akismet-&gt;check&#40;
&gt; -                     USER_IP                 =&gt; &#39;10.10.10.11&#39;,
&gt; -                     USER_AGENT              =&gt; &#39;Mozilla/5.0&#39;,
&gt; +                     USER_IP                         =&gt; &#39;10.10.10.11&#39;,
&gt; +                     COMMENT_USER_AGENT      =&gt; &#39;Mozilla/5.0&#39;,
&gt;                       COMMENT_CONTENT         =&gt; &#39;Run, Lola, Run, the spam will catch you!&#39;,
&gt;                       COMMENT_AUTHOR          =&gt; &#39;dosser&#39;,
&gt;                       COMENT_AUTHOR_EMAIL     =&gt; &#39;dosser@subway.de&#39;,
</div>
Looks like an extra tab sneaked in on the USER_IP line.  I didn&#39;t notice
before, but COMENT_AUTHOR_EMAIL is misspelled.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; -     $comment-&gt;{USER_IP} &#38;&#38; $comment-&gt;{COMMENT_USER_AGENT} || return undef;
&gt; +     $comment-&gt;{USER_IP} &#38;&#38; &#40;$comment-&gt;{COMMENT_USER_AGENT} || $comment-&gt;{USER_AGENT}&#41; || return undef;
&gt;  
&gt; +     # allow USER_AGENT key for backward compatibility with versions &lt;0.03 
&gt; +     $comment-&gt;{COMMENT_USER_AGENT} = $comment-&gt;{USER_AGENT} unless $comment-&gt;{COMMENT_USER_AGENT};
&gt; +
&gt; +     # accomodate common misspelling
&gt; +     $comment-&gt;{REFERRER} = $comment-&gt;{REFERER} if !$comment-&gt;{REFERRER} &#38;&#38; $comment-&gt;{REFERER};
&gt; +
</div>
Since the mistake was only in the docs, technically you don&#39;t need to
support USER_AGENT for backwards compatibility.  &#40;If the app was
mis-setting the user agent in .03, it will continue to do so in .04--
i.e. no change in behavior.&#41;

Generally I think name aliases in API&#39;s are not good.  If one programmer
 becomes accustomed to one name, he can get confused when reading some
other programmer&#39;s code using a different name.  To prevent hash key
typo&#39;s &#40;e.g. REFERER&#41;, ideally a module would verify that only
recognized keys are present in hash inputs.

Regards,
--John
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-470516" href="/Public/Bug/Display.html?id=28939#txn-470516">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;05&nbsp;15:05:38&nbsp;2008</span>
    <span class="description">nbachiyski [...] developer.bg -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> nbachiyski [...] developer.bg</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/470516/232050/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/232050">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Aug 28 23:15:12 2007, john@neggie.net wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi Nikolay,
&gt; 
<div class="message-stanza open">&gt; &gt;     my $verdict = $akismet-&gt;check&#40;
&gt; &gt; -                   USER_IP                 =&gt; &#39;10.10.10.11&#39;,
&gt; &gt; -                   USER_AGENT              =&gt; &#39;Mozilla/5.0&#39;,
&gt; &gt; +                   USER_IP                         =&gt; &#39;10.10.10.11&#39;,
&gt; &gt; +                   COMMENT_USER_AGENT      =&gt; &#39;Mozilla/5.0&#39;,
&gt; &gt;                     COMMENT_CONTENT         =&gt; &#39;Run, Lola, Run, the spam will catch you!&#39;,
&gt; &gt;                     COMMENT_AUTHOR          =&gt; &#39;dosser&#39;,
&gt; &gt;                     COMENT_AUTHOR_EMAIL     =&gt; &#39;dosser@subway.de&#39;,
</div>&gt; 
&gt; Looks like an extra tab sneaked in on the USER_IP line.  I didn&#39;t
&gt; notice
&gt; before, but COMENT_AUTHOR_EMAIL is misspelled.
&gt; 
<div class="message-stanza open">&gt; &gt; -   $comment-&gt;{USER_IP} &#38;&#38; $comment-&gt;{COMMENT_USER_AGENT} || return
</div>&gt; undef;
<div class="message-stanza open">&gt; &gt; +   $comment-&gt;{USER_IP} &#38;&#38; &#40;$comment-&gt;{COMMENT_USER_AGENT} ||
</div>&gt; $comment-&gt;{USER_AGENT}&#41; || return undef;
<div class="message-stanza open">&gt; &gt;
&gt; &gt; +   # allow USER_AGENT key for backward compatibility with versions
</div>&gt; &lt;0.03
<div class="message-stanza open">&gt; &gt; +   $comment-&gt;{COMMENT_USER_AGENT} = $comment-&gt;{USER_AGENT} unless
</div>&gt; $comment-&gt;{COMMENT_USER_AGENT};
<div class="message-stanza open">&gt; &gt; +
&gt; &gt; +   # accomodate common misspelling
&gt; &gt; +   $comment-&gt;{REFERRER} = $comment-&gt;{REFERER} if !$comment-
&gt; &gt;{REFERRER} &#38;&#38; $comment-&gt;{REFERER};
&gt; &gt; +
</div>&gt; 
&gt; Since the mistake was only in the docs, technically you don&#39;t need to
&gt; support USER_AGENT for backwards compatibility.  &#40;If the app was
&gt; mis-setting the user agent in .03, it will continue to do so in .04--
&gt; i.e. no change in behavior.&#41;
&gt; 
&gt; Generally I think name aliases in API&#39;s are not good.  If one
&gt; programmer
&gt;  becomes accustomed to one name, he can get confused when reading some
&gt; other programmer&#39;s code using a different name.  To prevent hash key
&gt; typo&#39;s &#40;e.g. REFERER&#41;, ideally a module would verify that only
&gt; recognized keys are present in hash inputs.
&gt; 
</div>
I agree :-&#41;

It was fixed in 0.04.

Happy hacking,
Nikolay.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-470518" href="/Public/Bug/Display.html?id=28939#txn-470518">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;05&nbsp;15:06:18&nbsp;2008</span>
    <span class="description">nbachiyski [...] developer.bg -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/470518/232052/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/232052">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 14b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Fixed in 0.04.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-470520" href="/Public/Bug/Display.html?id=28939#txn-470520">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;05&nbsp;15:06:23&nbsp;2008</span>
    <span class="description">nbachiyski [...] developer.bg -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.580352</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
