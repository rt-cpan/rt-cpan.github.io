<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #39841 for DBD-ODBC: SQL Server error with DBD::ODBC 1.17</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #39841 for DBD-ODBC: SQL Server error with DBD::ODBC 1.17</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/DBD-ODBC/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/DBD-ODBC/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/DBD-ODBC/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/DBD-ODBC/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/DBD-ODBC">DBD-ODBC CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">39841</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/DBD-ODBC/Active/">DBD-ODBC</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
Bruce.Tanner [...] Cerritos.edu

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-10188-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.17    </td>
  </tr>
  <tr id="CF-10189-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
1.17_1    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;06&nbsp;12:49:43&nbsp;2008</span>
    <span class="description">Bruce.Tanner [...] Cerritos.edu -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> SQL Server error with DBD::ODBC 1.17</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The sub-select in test_failing.pl gives the error &#34;String data,
right truncation&#34;.

c:\&gt;test_failing.pl
Using DBI 1.607 and DBD::ODBC 1.17
DB = DBI:ODBC:driver={SQL Server};Server=SQLVS2;Database=CS90PRD
DBD::ODBC::st execute failed: [Microsoft][ODBC SQL Server Driver]String
data, right truncation &#40;SQL-22001&#41; at c:\test_failing.pl line 44.

The program works correctly with DBD::ODBC 1.16.

c:\&gt;test_failing.pl
Using DBI 1.607 and DBD::ODBC 1.16
DB = DBI:ODBC:driver={SQL Server};Server=SQLVS2;Database=CS90PRD
Count = 4218


If I change the where clause on the sub-select, it works:

c:\&gt;test_working.pl
Using DBI 1.607 and DBD::ODBC 1.17
DB = DBI:ODBC:driver={SQL Server};Server=SQLVS2;Database=CS90PRD
Count = 4218

c:\&gt;fc test_working.pl test_failing.pl
Comparing files test_working.pl and TEST_FAILING.PL
***** test_working.pl
            AND R.CLASS_NBR = S.CLASS_NBR
        &#41;
    FROM
***** TEST_FAILING.PL
            AND R.CLASS_NBR = S.CLASS_NBR
            AND R.STDNT_ENRL_STATUS = &#39;E&#39;
            AND R.CRSE_GRADE_OFF &lt;&gt; &#39;W&#39;
            AND R.GRADING_BASIS_ENRL &lt;&gt; &#39;AUD&#39;
            &#41;

    FROM
*****

The target database is SQL Server 9.0.3042 &#40;Microsoft SQL Server 2005
Service Pack 2&#41;.

This is perl, v5.8.8 built for MSWin32-x86-multi-thread
&#40;with 12 registered patches, see perl -V for more detail&#41;

Copyright 1987-2007, Larry Wall

Binary build 824 [287188] provided by ActiveState <span class="clickylink"><a target="new" rel="nofollow" href="http://www.ActiveState.com">http://www.ActiveState.com</a></span>
Built Sep  3 2008 11:14:55

This is under Windows Server 2003 R2.
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> test_working.pl</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">use strict;
use warnings;
use DBI;

use Rosters2::Globals;


my $college = &#39;CER90&#39;; 

my $dbh = DBI-&gt;connect&#40; $config{$college}-&gt;{db},
                        $config{$college}-&gt;{login},
                        $config{$college}-&gt;{password},
                        {RaiseError=&gt;1,PrintError=&gt;0}
                        &#41;
                        or croak&#40; &#34;Can&#39;t connect to PSDB: $DBI::errstr&#34; &#41;;

print &#34;Using DBI $DBI::VERSION and DBD::ODBC $DBD::ODBC::VERSION\n&#34;;
print &#34;DB = $config{$college}-&gt;{db}\n&#34;;

my $classes_sql = q{
    SELECT 
        S.CLASS_NBR,
        &#40;SELECT COUNT&#40;R.EMPLID&#41;
        FROM PS_CER_ROS_STD_VW AS R
        WHERE
            R.STRM = S.STRM
            AND R.CLASS_NBR = S.CLASS_NBR
	&#41;
    FROM
        PS_CER_ROS_SCH_VW AS S
    WHERE
        S.STRM = ? 
};


my $term_code = 1089;
        
#print &#34;Execute $DBI::VERSION $classes_sql with $term_code\n&#34; ;
my $classes = $dbh-&gt;prepare&#40; $classes_sql &#41;;
$classes-&gt;execute&#40; $term_code &#41;;

my $count = 0;
MEETING:
while &#40;my &#40; $class_nbr, $enrl_tot &#41; = $classes-&gt;fetchrow_array &#41; {
    $count++;
}

print &#34;Count = $count&#34;;
</div></div>
</div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> test_failing.pl</td>
  </tr>
</table>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">use strict;
use warnings;
use DBI;

use Rosters2::Globals;


my $college = &#39;CER90&#39;; 

my $dbh = DBI-&gt;connect&#40; $config{$college}-&gt;{db},
                        $config{$college}-&gt;{login},
                        $config{$college}-&gt;{password},
                        {RaiseError=&gt;1,PrintError=&gt;0}
                        &#41;
                        or croak&#40; &#34;Can&#39;t connect to PSDB: $DBI::errstr&#34; &#41;;

print &#34;Using DBI $DBI::VERSION and DBD::ODBC $DBD::ODBC::VERSION\n&#34;;
print &#34;DB = $config{$college}-&gt;{db}\n&#34;;

my $classes_sql = q{
    SELECT 
        S.CLASS_NBR,
        &#40;SELECT COUNT&#40;R.EMPLID&#41;
        FROM PS_CER_ROS_STD_VW AS R
        WHERE
            R.STRM = S.STRM
            AND R.CLASS_NBR = S.CLASS_NBR
            AND R.STDNT_ENRL_STATUS = &#39;E&#39;
            AND R.CRSE_GRADE_OFF &lt;&gt; &#39;W&#39;
            AND R.GRADING_BASIS_ENRL &lt;&gt; &#39;AUD&#39;
            &#41;

    FROM
        PS_CER_ROS_SCH_VW AS S
    WHERE
        S.STRM = ? 
};


my $term_code = 1089;
        
#print &#34;Execute $DBI::VERSION $classes_sql with $term_code\n&#34; ;
my $classes = $dbh-&gt;prepare&#40; $classes_sql &#41;;
$classes-&gt;execute&#40; $term_code &#41;;

my $count = 0;
MEETING:
while &#40;my &#40; $class_nbr, $enrl_tot &#41; = $classes-&gt;fetchrow_array &#41; {
    $count++;
}

print &#34;Count = $count&#34;;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;06&nbsp;13:47:11&nbsp;2008</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Is there any chance you could reduce this down to a standalone example
that creates the schema, sample row&#40;s&#41; and select which fails in 1.17? I
realise this is asking a lot but the differences between 1.16 and 1.17
are HUGE and without knowing the schema and which column it is
truncating on it is very difficult to track this down.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;06&nbsp;13:47:28&nbsp;2008</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;06&nbsp;13:51:49&nbsp;2008</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Oct 06 13:47:11 2008, MJEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Is there any chance you could reduce this down to a standalone example
&gt; that creates the schema, sample row&#40;s&#41; and select which fails in 1.17? I
&gt; realise this is asking a lot but the differences between 1.16 and 1.17
&gt; are HUGE and without knowing the schema and which column it is
&gt; truncating on it is very difficult to track this down.
&gt; 
&gt; Martin
</div>
If this is just not possible if you could run it in 1.16 and 1.17 with
DBI_TRACE set to 15 and odbcunicode and odbcconnection flags turned on
in 1.17 - see &lt;a
href=&#34;http://search.cpan.org/~mjevans/DBD-ODBC-1.17/ODBC.pm#Tracing&#34;&gt;tracing&lt;/a&gt;
and in particular 

&lt;code&gt;
use DBD::ODBC;
DBI-&gt;trace&#40;DBD::ODBC-&gt;parse_trace_flags&#40;&#39;odbcconnection|odbcunicode&#39;&#41;&#41;;
&lt;/code&gt;

but that bit only applies to 1.17 and DBI 1.607.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;06&nbsp;14:17:20&nbsp;2008</span>
    <span class="description">Bruce.Tanner [...] Cerritos.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #39841] SQL Server error with DBD::ODBC 1.17 </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 6 Oct 2008 11:16:43 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-DBD-ODBC [...] rt.cpan.org&#34; &lt;bug-DBD-ODBC [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Tanner, Bruce&#34; &lt;Bruce.Tanner [...] Cerritos.edu&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I was afraid you would ask something like that.  The views apply to our PeopleSoft ERP database which is huge.
I would have to try and create a standalone collection of equivalent tables.  It&#39;s possible, but will take a while...

I&#39;ve enclosed the trace.


-Bruce
--
Bruce Tanner        &#40;562&#41; 860-2451 x 2164   Bruce.Tanner@Cerritos.edu
Cerritos College    Norwalk, CA

 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Martin J Evans via RT [mailto:bug-DBD-ODBC@rt.cpan.org] 
Sent: Monday, October 06, 2008 10:52 AM
To: Tanner, Bruce
Subject: [rt.cpan.org #39841] SQL Server error with DBD::ODBC 1.17 

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=39841">http://rt.cpan.org/Ticket/Display.html?id=39841</a></span> &gt;

On Mon Oct 06 13:47:11 2008, MJEVANS wrote:
<div class="message-stanza open">&gt; Is there any chance you could reduce this down to a standalone example
&gt; that creates the schema, sample row&#40;s&#41; and select which fails in 1.17? I
&gt; realise this is asking a lot but the differences between 1.16 and 1.17
&gt; are HUGE and without knowing the schema and which column it is
&gt; truncating on it is very difficult to track this down.
&gt; 
&gt; Martin
</div>
If this is just not possible if you could run it in 1.16 and 1.17 with
DBI_TRACE set to 15 and odbcunicode and odbcconnection flags turned on
in 1.17 - see &lt;a
href=&#34;http://search.cpan.org/~mjevans/DBD-ODBC-1.17/ODBC.pm#Tracing&#34;&gt;tracing&lt;/a&gt;
and in particular 

&lt;code&gt;
use DBD::ODBC;
DBI-&gt;trace&#40;DBD::ODBC-&gt;parse_trace_flags&#40;&#39;odbcconnection|odbcunicode&#39;&#41;&#41;;
&lt;/code&gt;

but that bit only applies to 1.17 and DBI 1.607.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;06&nbsp;14:56:09&nbsp;2008</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for the trace. I&#39;ll look thru it tonight and tomorrow as it is
getting late here. As you will have guessed it is a lot easier if I can
reproduce here as I don&#39;t have to bother you with repeated requests to
run with different tracing but I might be able to work it out from the
trace so hold on with reducing it further. What might help that you
could do reasonably easily is to send me a list of the database column
types for the select list &#40;especially if any is unicode - nvarchar etc&#41;.
Did you build DBD::ODBC as the default i.e., did you add anything to the
perl Makefile.PL commnand line? Have you tried rebuilding DBD::ODBC with
the &#34;-nou&#34; switch which disables extensive unicode support?

Will get back to you later.

-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;06&nbsp;15:04:45&nbsp;2008</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">    get_param_type 1
    SQLDescribeParam 1: SqlType=VARCHAR param_size=3 Scale=0 Nullable=0
    -&gt; dbd_st_execute
    -&gt; dbd_st_finish
    dbd_st_execute &#40;outparams = 0&#41;...
    bind 1 &#39;1089&#39; &#40;size svCUR=4/SvLEN=8/max=0&#41; svtype 5, value type:1
sql type:12
    get_param_type 1
    SQLDescribeParam already run and returned rc=0
    bind 1 &#39;1089&#39; value_len:4 maxlen:6 null:0&#41;
    bind 1 value_type:1 VARCHAR cs=3 dd=0 bl:4.
    SQLBindParameter: idx = 1: param_type=1, name=1, value_type=1,
SQL_Type = 12, column_size=3, d_digits=0, value_ptr=1ab8aec,
buffer_length=4, cbValue = 4, param_size = 3
    Param value = 1089
    rebind check char Param 1 &#40;1089...
&#41;
    dbd_st_execute &#40;for hstmt 1b22178, rc = -1&#41;


Forget the column types - it is failing on the execute and the above
looks suspicious as the parameter value is &#34;1089&#34; but the param_size is 3!
What is S.STRM?

Can you run the working versions and look for the above tracing 
to see how it compares. For 1.16 you&#39;ll have to leave off the
odbcunicode and odbcconnection flags or ignore them erroring.

Martin 
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;06&nbsp;17:56:01&nbsp;2008</span>
    <span class="description">Bruce.Tanner [...] Cerritos.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #39841] SQL Server error with DBD::ODBC 1.17 </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 6 Oct 2008 14:55:26 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-DBD-ODBC [...] rt.cpan.org&#34; &lt;bug-DBD-ODBC [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Tanner, Bruce&#34; &lt;Bruce.Tanner [...] Cerritos.edu&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello Martin,

Here&#39;s a program to build the schema from the table/view definitions.  I created an empty database manually first.  It appears that you don&#39;t need any data to trigger the error.

c:\test&gt;build_schema.pl
Processing PSXLATITEM.txt
Processing PS_CLASS_ASSOC.txt
Processing PS_CLASS_ATTENDANCE.txt
Processing PS_CLASS_ATTRIBUTE.txt
Processing PS_CLASS_INSTR.txt
Processing PS_CLASS_MTG_PAT.txt
Processing PS_CLASS_TBL.txt
Processing PS_CRSE_CATALOG.txt
Processing PS_CRSE_COMPONENT.txt
Processing PS_EMAIL_ADDRESSES.txt
Processing PS_NAMES.txt
Processing PS_PERSON.txt
Processing PS_PERSONAL_PHONE.txt
Processing PS_PERSON_NAME.txt
Processing PS_PERSON_PHONE.txt
Processing PS_STDNT_ENRL.txt
Processing PS_STDNT_INCOMPLTE.txt
Processing PS_TERM_TBL.txt
Processing XPS_CER_ROS_SCH_VW.txt
Processing XPS_CER_ROS_STD_VW.txt


c:\test&gt;test.pl
    DBI 1.607-ithread default trace level set to 0x0/15 &#40;pid 3996&#41; at test.pl line 6 dbd_db_login6
    SQLDriverConnect &#39;driver={SQL Server};Server=avm01;Database=Bruce_test;UID=;PWD=;&#39;, &#39;&#39;, &#39;xxxx&#39;
Out connection string: DRIVER=SQL Server;SERVER=avm01;UID=console;PWD=;APP=ActivePerl;WSID=AVM17;DATABASE=Bruce_test;Trusted_Connection=Yes
Turning autocommit on
DRIVER_ODBC_VER = 03.52
DRIVER_NAME = SQLSRV32.DLL
DRIVER_VERSION = 03.86.3959
MAX_COLUMN_NAME_LEN = 128
DBD::ODBC is unicode built : YES
SQL_DBMS_NAME = Microsoft SQL Server
SQLMoreResults supported: 1
SQLDescribeParam supported: 1
Using DBI 1.607 and DBD::ODBC 1.17
    Processing non-utf8 sql in unicode mode
DBD::ODBC::st execute failed: [Microsoft][ODBC SQL Server Driver]String data, right truncation &#40;SQL-22001&#41; at c:\test\test.pl line 42.
SQLDisconnect=0



-Bruce
--
Bruce Tanner        &#40;562&#41; 860-2451 x 2164   Bruce.Tanner@Cerritos.edu
Cerritos College    Norwalk, CA



<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Martin J Evans via RT [mailto:bug-DBD-ODBC@rt.cpan.org] 
Sent: Monday, October 06, 2008 10:52 AM
To: Tanner, Bruce
Subject: [rt.cpan.org #39841] SQL Server error with DBD::ODBC 1.17 

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=39841">http://rt.cpan.org/Ticket/Display.html?id=39841</a></span> &gt;

On Mon Oct 06 13:47:11 2008, MJEVANS wrote:
<div class="message-stanza open">&gt; Is there any chance you could reduce this down to a standalone example
&gt; that creates the schema, sample row&#40;s&#41; and select which fails in 1.17? I
&gt; realise this is asking a lot but the differences between 1.16 and 1.17
&gt; are HUGE and without knowing the schema and which column it is
&gt; truncating on it is very difficult to track this down.
&gt; 
&gt; Martin
</div>
</div></div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;06&nbsp;18:12:52&nbsp;2008</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Well I asked for that - didn&#39;t I. Don&#39;t hold your breath ;-&#41;
Get back to you when I&#39;ve set this up. In the mean time if you manage to
run 1.16 with full tracing and pinpoint the tracing in my previous
response it may be useful but I&#39;ll get on to this tomorrow.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;06&nbsp;19:08:15&nbsp;2008</span>
    <span class="description">Bruce.Tanner [...] Cerritos.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #39841] SQL Server error with DBD::ODBC 1.17 </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 6 Oct 2008 16:08:00 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-DBD-ODBC [...] rt.cpan.org&#34; &lt;bug-DBD-ODBC [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Tanner, Bruce&#34; &lt;Bruce.Tanner [...] Cerritos.edu&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello Martin,

I was working on the table extraction/creation project and didn&#39;t get back to looking at email until after I sent off my last message.  It looks like we got out of synch a bit.

Here is a successful trace with both the production database and the empty test database with 1.16.
I selected TOP 2 to save going through 4000 class records.
 
c:\test&gt;test.pl 2&gt; test.log
Using DBI 1.607 and DBD::ODBC 1.16
Count = 2

c:\test&gt;test.pl 2&gt; test_empty_1.16.log
Using DBI 1.607 and DBD::ODBC 1.16
Count = 0


STRM is the term identifier, I don&#39;t know what the S is there for.  The format is YYYM, 108 is 1900 + 108 &#40;yes, it is a y2k thing&#41; and 9 is September &#40;for the fall semester&#41;, so 1089 is Fall 2008.

DBD::ODBC is from the ActiveState archive.  I&#39;ve never gotten into the habit of compiling my own modules, but it should be possible after I gather up all of the tools needed.


-Bruce
--
Bruce Tanner        &#40;562&#41; 860-2451 x 2164   Bruce.Tanner@Cerritos.edu
Cerritos College    Norwalk, CA



<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Martin J Evans via RT [mailto:bug-DBD-ODBC@rt.cpan.org] 
Sent: Monday, October 06, 2008 3:13 PM
To: Tanner, Bruce
Subject: [rt.cpan.org #39841] SQL Server error with DBD::ODBC 1.17 

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=39841">http://rt.cpan.org/Ticket/Display.html?id=39841</a></span> &gt;

Well I asked for that - didn&#39;t I. Don&#39;t hold your breath ;-&#41;
Get back to you when I&#39;ve set this up. In the mean time if you manage to
run 1.16 with full tracing and pinpoint the tracing in my previous
response it may be useful but I&#39;ll get on to this tomorrow.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;07&nbsp;04:56:13&nbsp;2008</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Bruce,

I&#39;m nearly there. I can see why it is failing but not as yet why SQL
Server returns 3 for the strm size. I appear to be missing a couple of
text files for the tables PS_CER_ROS_SCH_VW and PS_CER_ROS_SCH_VW.txt.
They show in your log of running build_schema.pl as files prefixed with
X but I have not got them.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;07&nbsp;11:02:07&nbsp;2008</span>
    <span class="description">Bruce.Tanner [...] Cerritos.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #39841] SQL Server error with DBD::ODBC 1.17 </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 7 Oct 2008 08:01:50 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-DBD-ODBC [...] rt.cpan.org&#34; &lt;bug-DBD-ODBC [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Tanner, Bruce&#34; &lt;Bruce.Tanner [...] Cerritos.edu&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I must have missed them when I sent everything off.  They have the X to put them at the end since they rely on all of the other tables to be there first.

-Bruce


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Martin J Evans via RT [mailto:bug-DBD-ODBC@rt.cpan.org] 
Sent: Tuesday, October 07, 2008 1:56 AM
To: Tanner, Bruce
Subject: [rt.cpan.org #39841] SQL Server error with DBD::ODBC 1.17 

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=39841">http://rt.cpan.org/Ticket/Display.html?id=39841</a></span> &gt;

Bruce,

I&#39;m nearly there. I can see why it is failing but not as yet why SQL
Server returns 3 for the strm size. I appear to be missing a couple of
text files for the tables PS_CER_ROS_SCH_VW and PS_CER_ROS_SCH_VW.txt.
They show in your log of running build_schema.pl as files prefixed with
X but I have not got them.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;07&nbsp;11:10:50&nbsp;2008</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Oct 07 11:02:07 2008, Bruce.Tanner@Cerritos.edu wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I must have missed them when I sent everything off.  They have the X
&gt; to put them at the end since they rely on all of the other tables to
&gt; be there first.
</div>
Thanks.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;07&nbsp;11:22:06&nbsp;2008</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sorry to be a pain but I&#39;m still missing:

Invalid object name &#39;PSXLATITEM&#39;

referred to in XPS_CER_ROS_SCH_VW.txt.

Just to give you hope, I think I have identified the issue and it is a
bug in the SQL Server ODBC driver but I also think I have a workaround.
Just want to check in your case as the problem is that when you call
SQLDescribeParam in ODBC, SQL Server analyses your SQL and attempts to
turn it into a select statement on the tables/views to get parameter
info. Your sql has 2 selects and it is difficult to guess how sql server
is turning that into a select to obtain the  STRM parameter.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;07&nbsp;12:03:09&nbsp;2008</span>
    <span class="description">Bruce.Tanner [...] Cerritos.edu -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #39841] SQL Server error with DBD::ODBC 1.17 </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 7 Oct 2008 09:02:42 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &#34;bug-DBD-ODBC [...] rt.cpan.org&#34; &lt;bug-DBD-ODBC [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Tanner, Bruce&#34; &lt;Bruce.Tanner [...] Cerritos.edu&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Some days I can&#39;t do anything right.

-Bruce

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: Martin J Evans via RT [mailto:bug-DBD-ODBC@rt.cpan.org] 
Sent: Tuesday, October 07, 2008 8:22 AM
To: Tanner, Bruce
Subject: [rt.cpan.org #39841] SQL Server error with DBD::ODBC 1.17 

&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=39841">http://rt.cpan.org/Ticket/Display.html?id=39841</a></span> &gt;

Sorry to be a pain but I&#39;m still missing:

Invalid object name &#39;PSXLATITEM&#39;

referred to in XPS_CER_ROS_SCH_VW.txt.

Just to give you hope, I think I have identified the issue and it is a
bug in the SQL Server ODBC driver but I also think I have a workaround.
Just want to check in your case as the problem is that when you call
SQLDescribeParam in ODBC, SQL Server analyses your SQL and attempts to
turn it into a select statement on the tables/views to get parameter
info. Your sql has 2 selects and it is difficult to guess how sql server
is turning that into a select to obtain the  STRM parameter.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;07&nbsp;13:56:32&nbsp;2008</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Bruce,

I&#39;ve found the problem and it is a bug in the SQL Server ODBC driver.
When you call SQLDescribeParam the driver scans your SQL and attempts to
rearrange it into a simple query where 1 = 0 to find out the column
details. For your SQL &#40;which fails&#41; the driver ends up running:

select  R.GRADING_BASIS_ENRL from PS_CER_ROS_STD_VW AS R where 1=2 

which returns 3 for the size of grading_basis_enrl.

and in the working case where you removed some columns from the where
clause it runs:

select R.CLASS_NBR from PS_CER_ROS_STD_VW AS R where 1=2

which also entirely wrong but by accident returns a number &gt;= 4 so it
works - by accident.

Why does this differ in 1.16? The reason is that 1.16 called
SQLDescribeParam but ignored the returned parameter size if it was &lt; 80
and set the column size in the SQLBindParameter call to 80. This was
wrong in DBD::ODBC, it caused some problems and I fixed it not realising
it would hit this bug in the SQL Server ODBC Driver.

A workaround for this bug in SQL Server ODBC Driver is possible and not
totally illogical. If the parameter is a VARCHAR and the size of the
parameter you are passing is &gt; the column_size returned from
SQLDescribeParam then the driver is broken and bound to error when we
execute. A simple solution is to bump the column_size to at least the
size of the parameter about to be bound if the column_size is smaller
and it is a VARCHAR. I&#39;ve done this change and verified it works in your
case but you should realise it is a workaround for a bug in the SQL
Server ODBC Driver. It is also possible that if you prepare and bind
parameters but re-execute it with different sized parameters it may not
work but I&#39;ll check this later. I only wish I had access to MS to report
this problem so it could be fixed but I don&#39;t - the last few problems I
reported on MS news groups were acknowledged as bugs by MS but have
never been fixed to my knowledge.

In the mean time I&#39;ve mailed a workaround version of DBD::ODBC to your
email address privately but this may only be the start of your problems
since you are using active state. I&#39;ve struggled in the past to build
perl XS modules for activestate perl - they compile and link but
sometimes fail to work - it seems you need to match activestates builds
environment very closely - same versions of compilers etc. In theory, if
you have MS dev studio you should be able to go to start menu, programs
and select the developer studio menu item that starts a command prompt
with the developer studio environment set. You then unpack DBD::ODBC and
do the &#34;perl Makefile.PL&#34; followed by nmake &#40;optionally nmake test&#41; and
&#34;nmake install&#34;. If you do the &#34;nmake test&#34; you&#39;ll need to:

set DBI_DSN=dbi:ODBC:mydsn
set DBI_USER=my_sql_server_username
set DBI_PASS=my_sql_server_password

first. Best of luck. If I can help you get the new version built I will
just let me know.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;08&nbsp;06:08:54&nbsp;2008</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I believe this is now fixed in DBD::ODBC 1.17 and I will be creating a
test case for it later today.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;08&nbsp;09:30:32&nbsp;2008</span>
    <span class="description">Scott.Stricker [...] NGC.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Scott.Stricker [...] NGC.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Oct 08 06:08:54 2008, MJEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I believe this is now fixed in DBD::ODBC 1.17 and I will be creating a
&gt; test case for it later today.
</div>
For whatever it&#39;s worth, I&#39;ve worked around the problem by adding the 
following lines to my perl code which is erroring out.  Have not tried 
one line vs. the other, but with both I don&#39;t get the truncate error.

  $dbh-&gt;{LongReadLen} = 20000;
  $dbh-&gt;{LongTruncOk} = 1;

Note that the table I&#39;ve used which causes the error only has varchar 
and numeric columns so I was surprised that this fixed the error.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;08&nbsp;09:35:30&nbsp;2008</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Oct 08 09:30:32 2008, stricsc wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; For whatever it&#39;s worth, I&#39;ve worked around the problem by adding the 
&gt; following lines to my perl code which is erroring out.  Have not tried 
&gt; one line vs. the other, but with both I don&#39;t get the truncate error.
&gt; 
&gt;   $dbh-&gt;{LongReadLen} = 20000;
&gt;   $dbh-&gt;{LongTruncOk} = 1;
&gt; 
&gt; Note that the table I&#39;ve used which causes the error only has varchar 
&gt; and numeric columns so I was surprised that this fixed the error.
&gt; 
&gt; 
</div>
I seriously doubt you are talking about the same problem. The issue
found is a bug in the SQL Server ODBC Driver and totally unaffected by
setting LongReadLen or LongTrucOk which ONLY apply to retrieved data and
not the input bound parameters this bug is about.

Martin
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;08&nbsp;10:44:39&nbsp;2008</span>
    <span class="description">Scott.Stricker [...] NGC.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Scott.Stricker [...] NGC.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Oct 08 09:35:30 2008, MJEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed Oct 08 09:30:32 2008, stricsc wrote:
<div class="message-stanza open">&gt; &gt; For whatever it&#39;s worth, I&#39;ve worked around the problem by adding the 
&gt; &gt; following lines to my perl code which is erroring out.  Have not tried 
&gt; &gt; one line vs. the other, but with both I don&#39;t get the truncate error.
&gt; &gt; 
&gt; &gt;   $dbh-&gt;{LongReadLen} = 20000;
&gt; &gt;   $dbh-&gt;{LongTruncOk} = 1;
&gt; &gt; 
&gt; &gt; Note that the table I&#39;ve used which causes the error only has varchar 
&gt; &gt; and numeric columns so I was surprised that this fixed the error.
&gt; &gt; 
&gt; &gt; 
</div>&gt; 
&gt; I seriously doubt you are talking about the same problem. The issue
&gt; found is a bug in the SQL Server ODBC Driver and totally unaffected by
&gt; setting LongReadLen or LongTrucOk which ONLY apply to retrieved data and
&gt; not the input bound parameters this bug is about.
&gt; 
&gt; Martin
</div>
Very possibly so.  I do know that if I am using the latest Activestate
perl dist for Windows XP updated with the 1.17 dbd-odbc module against
my SQL Server database, I get the truncate error.  If I add the lines
listed above the error goes away.  I don&#39;t get the error with the 1.16
version of the odbc module or if I talk to the database with, for
example, the DBD-ADO module.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;08&nbsp;11:07:56&nbsp;2008</span>
    <span class="description">bohica [...] ntlworld.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Oct 08 10:44:39 2008, stricsc wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed Oct 08 09:35:30 2008, MJEVANS wrote:
<div class="message-stanza open">&gt; &gt; On Wed Oct 08 09:30:32 2008, stricsc wrote:
<div class="message-stanza open">&gt; &gt; &gt; For whatever it&#39;s worth, I&#39;ve worked around the problem by adding the 
&gt; &gt; &gt; following lines to my perl code which is erroring out.  Have not
</div></div></div>tried 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; one line vs. the other, but with both I don&#39;t get the truncate error.
&gt; &gt; &gt; 
&gt; &gt; &gt;   $dbh-&gt;{LongReadLen} = 20000;
&gt; &gt; &gt;   $dbh-&gt;{LongTruncOk} = 1;
&gt; &gt; &gt; 
&gt; &gt; &gt; Note that the table I&#39;ve used which causes the error only has varchar 
&gt; &gt; &gt; and numeric columns so I was surprised that this fixed the error.
&gt; &gt; &gt; 
&gt; &gt; &gt; 
</div>&gt; &gt; 
&gt; &gt; I seriously doubt you are talking about the same problem. The issue
&gt; &gt; found is a bug in the SQL Server ODBC Driver and totally unaffected by
&gt; &gt; setting LongReadLen or LongTrucOk which ONLY apply to retrieved data and
&gt; &gt; not the input bound parameters this bug is about.
&gt; &gt; 
&gt; &gt; Martin
</div>&gt; 
&gt; Very possibly so.  I do know that if I am using the latest Activestate
&gt; perl dist for Windows XP updated with the 1.17 dbd-odbc module against
&gt; my SQL Server database, I get the truncate error.  If I add the lines
&gt; listed above the error goes away.  I don&#39;t get the error with the 1.16
&gt; version of the odbc module or if I talk to the database with, for
&gt; example, the DBD-ADO module.
</div>
If you are saying you have a perl script which runs correctly with
DBD::ODBC 1.16 but gets a truncate error with DBD::ODBC 1.17 &#40;using the
same ODBC driver&#41; and it is fixed by setting LongReadLen or LongTruncOk&#41;
then would you be prepared to open a new rt and post the details of the
script and schema so I may reproduce and fix this issue.

Martin 
-- 
Martin J. Evans
Wetherby, UK
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;08&nbsp;15:42:41&nbsp;2008</span>
    <span class="description">Scott.Stricker [...] NGC.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Scott.Stricker [...] NGC.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Oct 08 11:07:56 2008, MJEVANS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Wed Oct 08 10:44:39 2008, stricsc wrote:
<div class="message-stanza open">&gt; &gt; On Wed Oct 08 09:35:30 2008, MJEVANS wrote:
<div class="message-stanza open">&gt; &gt; &gt; On Wed Oct 08 09:30:32 2008, stricsc wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; For whatever it&#39;s worth, I&#39;ve worked around the problem by
</div></div></div></div>adding the 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; &gt; &gt; following lines to my perl code which is erroring out.  Have not
</div>&gt; tried 
<div class="message-stanza open">&gt; &gt; &gt; &gt; one line vs. the other, but with both I don&#39;t get the truncate
</div></div>error.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt;   $dbh-&gt;{LongReadLen} = 20000;
&gt; &gt; &gt; &gt;   $dbh-&gt;{LongTruncOk} = 1;
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Note that the table I&#39;ve used which causes the error only has
</div></div>varchar 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; &gt; and numeric columns so I was surprised that this fixed the error.
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; 
</div>&gt; &gt; &gt; 
&gt; &gt; &gt; I seriously doubt you are talking about the same problem. The issue
&gt; &gt; &gt; found is a bug in the SQL Server ODBC Driver and totally unaffected by
&gt; &gt; &gt; setting LongReadLen or LongTrucOk which ONLY apply to retrieved
</div></div>data and
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open"><div class="message-stanza open">&gt; &gt; &gt; not the input bound parameters this bug is about.
&gt; &gt; &gt; 
&gt; &gt; &gt; Martin
</div>&gt; &gt; 
&gt; &gt; Very possibly so.  I do know that if I am using the latest Activestate
&gt; &gt; perl dist for Windows XP updated with the 1.17 dbd-odbc module against
&gt; &gt; my SQL Server database, I get the truncate error.  If I add the lines
&gt; &gt; listed above the error goes away.  I don&#39;t get the error with the 1.16
&gt; &gt; version of the odbc module or if I talk to the database with, for
&gt; &gt; example, the DBD-ADO module.
</div>&gt; 
&gt; If you are saying you have a perl script which runs correctly with
&gt; DBD::ODBC 1.16 but gets a truncate error with DBD::ODBC 1.17 &#40;using the
&gt; same ODBC driver&#41; and it is fixed by setting LongReadLen or LongTruncOk&#41;
&gt; then would you be prepared to open a new rt and post the details of the
&gt; script and schema so I may reproduce and fix this issue.
&gt; 
&gt; Martin 
</div>
Martin - I&#39;ve created rt 39897 with info.  Let me know if you need more
info than I&#39;ve posted and I&#39;ll try to get it to you.  Thanks...
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;10&nbsp;10:15:19&nbsp;2008</span>
    <span class="description">bohica [...] ntlworld.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;10&nbsp;10:15:20&nbsp;2008</span>
    <span class="description">bohica [...] ntlworld.com -  Fixed in 1.17_1 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;Nov&nbsp;10&nbsp;10:15:20&nbsp;2008</span>
    <span class="description">bohica [...] ntlworld.com -  Fixed in 1.16 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
