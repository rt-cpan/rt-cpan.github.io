<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #130221 for Module-Install-ReadmeFromPod: t/05_cleanpdf.t randomly fails on PDF files with \r\n in PDF objects</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #130221 for Module-Install-ReadmeFromPod: t/05_cleanpdf.t randomly fails on PDF files with \r\n in PDF objects</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Module-Install-ReadmeFromPod/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Module-Install-ReadmeFromPod/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Module-Install-ReadmeFromPod/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Module-Install-ReadmeFromPod/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Module-Install-ReadmeFromPod">Module-Install-ReadmeFromPod CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">130221</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">new</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Module-Install-ReadmeFromPod/Active/">Module-Install-ReadmeFromPod</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ppisar [...] redhat.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-227262-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.30    </td>
  </tr>
  <tr id="CF-227263-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;29&nbsp;03:08:28&nbsp;2019</span>
    <span class="description">ppisar [...] redhat.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> t/05_cleanpdf.t randomly fails on PDF files with \r\n in PDF objects</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">I noticed t/05_cleanpdf.t fails randomly with:
t/05_cleanpdf.t .. 1/13
#   Failed test &#39;Foobar.pdf contains only unix newlines&#39;
#   at t/05_cleanpdf.t line 73.
#                   &#39;%PDF-1.4
# %��͵
[...]
# %%EOF
# &#39;
#           matches &#39;&#40;?^:\r\n&#41;&#39;

The reason is that the generated and tested Foobar.pdf changes at each run &#40;e.g. font object identifiers contains random characters&#41; ans a /Filter object sometimes contains &#34;\r\n&#34; sequence and that triggers the test failure:

000002c0  6f 62 6a 0a 37 20 30 20  6f 62 6a 20 3c 3c 20 2f  |obj.7 0 obj &lt;&lt; /|
000002d0  46 69 6c 74 65 72 20 5b  20 2f 46 6c 61 74 65 44  |Filter [ /FlateD|
000002e0  65 63 6f 64 65 20 5d 20  2f 4c 65 6e 67 74 68 20  |ecode ] /Length |
000002f0  34 32 37 20 3e 3e 20 73  74 72 65 61 6d 0a 78 9c  |427 &gt;&gt; stream.x.|
00000300  cd 97 c1 52 c2 30 10 86  5f 65 8f 38 a3 31 9b a4  |...R.0.._e.8.1..|
00000310  0d e5 46 11 95 03 88 da  17 40 ac a5 5a a8 62 71  |..F......@..Z.bq|
00000320  46 0f 3e bb 8b e2 45 68  65 67 1a a6 d3 69 2f c9  |F.&gt;...Eheg...i/.|
00000330  6e be fd 93 dd 6c 01 c2  08 e0 f4 32 0e f3 5e d8  |n....l.....2..^.|
00000340  fd 44 cf 37 ba ad 24 2a  40 09 d1 03 40 9f 86 e1  |.D.7..$*@...@...|
00000350  05 be a7 21 48 7a 10 4c  5b 0a ad c1 5a 05 d1 bc  |...!Hz.L[...Z...|
00000360  c2 b8 35 7c 1f e6 f7 ab  2c 16 cf f3 23 88 1e 37  |..5|....,...#..7|
00000370  de ae 37 de 24 4d fa a8  30 ff 5d 6e fd a5 75 24  |..7.$M..0.]n..u$|
00000380  24 f4 5e 70 61 3d 34 c2  fa e0 cb 7f 58 c7 93 24  |$.^pa=4.....X..$|
00000390  06 ac 15 33 7b eb 85 e1  b6 41 e5 c8 f6 22 aa 7a  |...3{....A...&#34;.z|
000003a0  a4 64 87 c0 7a de 0f ce  fa 59 26 15 1e 5a a3 ee  |.d..z....Y&#38;..Z..|
000003b0  b0 cf 0b 5c d5 1c f8 ce  20 02 1f ac 0e fe 06 51  |...\.... ......Q|
000003c0  e2 a1 75 9e e7 9d 4e 38  59 56 05 52 62 5b 12 c8  |..u...N8YV.Rb[..|
000003d0  4e 28 d4 46 68 8f 03 06  ce 89 ac 40 cd 21 3a 71  |N&#40;.Fh......@.!:q|
000003e0  4d 64 a4 30 ac cd 73 ae  91 d1 42 19 0e d1 78 55  |Md.0..s...B...xU|
000003f0  14 e9 22 71 cd 65 e9 34  d9 46 29 65 e9 34 b1 ce  |..&#34;q.e.4.F&#41;e.4..|
00000400  77 31 8b 5d 33 05 28 64  b3 72 2e d0 a2 cd ca 39  |w1.]3.&#40;d.r.....9|
00000410  2a 4f 8e 99 14 92 4a 8d  ca 3a 85 a4 12 2b eb d2  |*O....J..:...+..|
00000420  45 e1 5c 26 15 08 de cd  e2 5c 26 ad 84 65 c9 54  |E.\&#38;.....\&#38;..e.T|
00000430  eb 35 77 a0 76 04 b7 a2  2b 6b 47 ce fa b7 bd 9b  |.5w.v...+kG.....|
00000440  c1 38 1a 5c 8d 1a da 95  48 bd ef 4e 0d 0a d7 95  |.8.\....H..N....|
                                               ^^^^^
00000450  48 a2 f0 58 48 ce 6b a3  a4 3b cd 70 88 d2 57 d7  |H..XH.k..;.p..W.|
00000460  48 d8 38 91 90 2b 52 96  3e 39 bf 67 a9 34 f2 a0  |H.8..+R.&gt;9.g.4..|
00000470  dc f7 b6 4a 90 21 83 68  3a cb a7 79 36 29 e2 e3  |...J.!.h:..y6&#41;..|
00000480  03 34 4a b6 51 5a d1 5f  f9 ba d0 ee 4f 74 b7 72  |.4J.QZ._....Ot.r|
00000490  5e 9d 02 3a e6 2c 26 f7  9d 1b f5 b7 ac 52 b0 c8  |^..:.,&#38;......R..|
000004a0  0b 51 37 d4 17 e1 0e de  63 0a 65 6e 64 73 74 72  |.Q7.....c.endstr|
000004b0  65 61 6d 20 65 6e 64 6f  62 6a 0a 38 20 30 20 6f  |eam endobj.8 0 o|

The offensive PDF is attached.

I believe the t/05_cleanpdf.t should examine Foobar.pdf for new-lines unless it can parse PDF properly.

I believe that the t/05_cleanpdf.t
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Foobar.pdf.bad</td>
  </tr>
</table>

<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;29&nbsp;03:19:36&nbsp;2019</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne Po 29.čec.2019 03:08:28, ppisar napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I believe the t/05_cleanpdf.t should examine Foobar.pdf for new-lines
&gt; unless it can parse PDF properly.
&gt; 
</div>An attach patch removes the test.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jul&nbsp;29&nbsp;03:20:19&nbsp;2019</span>
    <span class="description">ppisar [...] redhat.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Dne Po 29.čec.2019 03:19:36, ppisar napsal&#40;a&#41;:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Dne Po 29.čec.2019 03:08:28, ppisar napsal&#40;a&#41;:
<div class="message-stanza open">&gt; &gt; I believe the t/05_cleanpdf.t should examine Foobar.pdf for new-lines
&gt; &gt; unless it can parse PDF properly.
&gt; &gt; 
</div>&gt; An attach patch removes the test.
&gt; 
</div></div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Module-Install-ReadmeFromPod-0.30-Do-not-test-PDF-file-for-new-lines.patch</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 83987c6c69aa34a60eeb0dda95dd40cf6cbcb24d Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Petr=20P=C3=ADsa=C5=99?= &lt;ppisar@redhat.com&gt;
Date: Mon, 29 Jul 2019 09:13:05 +0200
Subject: [PATCH] Do not test PDF file for new-lines
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

A PDF file can contain a stream object that contains &#34;\r\n&#34;byte
sequence. Therefore it does not make sense to test the PDF file for
new-lines.

CPAN RT#130221

Signed-off-by: Petr PÃ­saÅ &lt;ppisar@redhat.com&gt;
---
 t/05_cleanpdf.t | 4 ++--
 1 file changed, 2 insertions&#40;+&#41;, 2 deletions&#40;-&#41;

diff --git a/t/05_cleanpdf.t b/t/05_cleanpdf.t
index bb8f863..59b8ab7 100644
--- a/t/05_cleanpdf.t
+++ b/t/05_cleanpdf.t
@@ -14,7 +14,7 @@ unless &#40; -e &#39;have_make&#39; &#41; {
 eval { require App::pod2pdf; };
 plan skip_all =&gt; &#39;App::pod2pdf not installed&#39; if $@;
 
-plan tests =&gt; 13;
+plan tests =&gt; 12;
 
 {
 my $make = $Config{make};
@@ -70,7 +70,7 @@ ok&#40; -e &#39;Foobar.man&#39;, &#39;There is a Foobar.man file&#39; &#41;;
 ok&#40; -e &#39;Foobar.pdf&#39;, &#39;There is a Foobar.pdf file&#39; &#41;;
 
 unlike io-&gt;file&#40;$_&#41;-&gt;all, qr/\r\n/, &#34;$_ contains only unix newlines&#34;
-  for qw&#40; Foobar.txt Foobar.htm Foobar.man Foobar.pdf &#41;;
+  for qw&#40; Foobar.txt Foobar.htm Foobar.man &#41;;
 
 my $distclean = capture_merged { system &#34;$make distclean&#34; };
 diag&#40;&#34;$distclean&#34;&#41;;
-- 
2.20.1

</div></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
