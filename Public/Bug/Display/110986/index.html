<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #110986 for Math-GMPz: Does not accept Math::BigInt objects as input</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #110986 for Math-GMPz: Does not accept Math::BigInt objects as input</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Math-GMPz/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Math-GMPz/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Math-GMPz/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Math-GMPz/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Math-GMPz">Math-GMPz CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">110986</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Math-GMPz/Active/">Math-GMPz</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
DANAJ [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-42528-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.42    </td>
  </tr>
  <tr id="CF-42529-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;07&nbsp;12:36:53&nbsp;2016</span>
    <span class="description">DANAJ [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Does not accept Math::BigInt objects as input</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">It would be convenient if Math::GMPz accepted Math::BigInt objects in new&#40;&#41;, ideally including overloads.  Math::BigInt is a standard Perl method for big integers, so is quite common.  Math::GMPz is *much* faster both in operations but also overhead, so is nice to use when doing lots of operations.

I suspect just stringifying the input is enough, so it works regardless of back end.  But if you find a good non-brittle way to dig into the backend and optimize the Math::BigInt::GMP case, that would be awesome.



    $ perl -E &#39;use Math::GMPz; use Math::BigInt; my $n = Math::BigInt-&gt;new&#40;10&#41;; my $m = Math::GMPz-&gt;new&#40;$n&#41;; say &#34;$n $m&#34;;&#39;
    Inappropriate argument supplied to new&#40;&#41; at /Users/djacobsen/perl5/perlbrew/perls/perl-5.22.0/lib/site_perl/5.22.0/darwin-thread-multi-2level/Math/GMPz.pm line 197.

For comparison:

    $ perl -E &#39;use Math::GMP; use Math::BigInt; my $n = Math::BigInt-&gt;new&#40;10&#41;; my $m = Math::GMP-&gt;new&#40;$n&#41;; say &#34;$n $m&#34;;&#39;
    10 10

    $ perl -E &#39;use Math::Pari; use Math::BigInt; my $n = Math::BigInt-&gt;new&#40;10&#41;; my $m = Math::Pari-&gt;new&#40;$n&#41;; say &#34;$n $m&#34;;&#39;
    10 10

    $ perl -E &#39;use Math::Int128 qw/int128/; use Math::BigInt; my $n = Math::BigInt-&gt;new&#40;10&#41;; my $m = int128&#40;$n&#41;; say &#34;$n $m&#34;;&#39;
    10 10
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;07&nbsp;21:41:49&nbsp;2016</span>
    <span class="description">sisyphus1 [...] optusnet.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #110986] Does not accept Math::BigInt objects as input</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 8 Jan 2016 13:40:34 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Math-GMPz [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &lt;sisyphus1 [...] optusnet.com.au&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message----- 
From: Dana Jacobsen via RT
Sent: Friday, January 08, 2016 4:36 AM
To: sisyphus1@optusnet.com.au
Subject: [rt.cpan.org #110986] Does not accept Math::BigInt objects as input

Thu Jan 07 12:36:53 2016: Request 110986 was acted upon.
Transaction: Ticket created by DANAJ
       Queue: Math-GMPz
     Subject: Does not accept Math::BigInt objects as input
   Broken in: 0.42
    Severity: Wishlist
       Owner: Nobody
  Requestors: DANAJ@cpan.org
      Status: new
Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=110986">https://rt.cpan.org/Ticket/Display.html?id=110986</a></span> &gt;


<div class="message-stanza open">&gt; It would be convenient if Math::GMPz accepted Math::BigInt objects in
&gt; new&#40;&#41;, ideally including overloads.
</div>
Yes, I can do that.

<div class="message-stanza open">&gt; Math::BigInt is a standard Perl method for big integers, so is quite
&gt; common.  Math::GMPz is *much* faster both in operations but also overhead,
&gt; so is nice to use when doing lots of operations.
&gt;
&gt; I suspect just stringifying the input is enough, so it works regardless of
&gt; back end.
</div>
For a purely perl Math::BigInt object, stringifying is about as good as one
can do &#40;AFAIK&#41;.

<div class="message-stanza open">&gt; But if you find a good non-brittle way to dig into the backend and
&gt; optimize the Math::BigInt::GMP case, that would be awesome.
</div>
If we&#39;re going to accommodate Math::BigInt objects then it would be nice to 
handle those that have the GMP backend as efficiently as we can &#40; .... 
despite the relative ease of simply implementing it via &#34;stringification&#34; 
:-&#41;
I&#39;m assuming that Math::BigInt::GMP itself is quite resilient and reliable ?

Based on Math::BigInt::GMP&#39;s mpz_from_sv_nofail&#40;&#41; function &#40;and associated 
#defines&#41; I came up with the attached as a starting demo for getting access 
to the mpz_t that&#39;s in the Math::BigInt::GMP object that&#39;s in the 
Math::BigInt object.

But, I&#39;m a complete klutz when it comes to magic and I don&#39;t understand why,
in that script, I have to comment out the

#if GMP_HAS_MAGICEXT
        &#38;&#38; mg-&gt;mg_virtual == &#38;vtbl_gmp
#endif

that&#39;s in the original mpz_from_sv_nofail&#40;&#41;.
Probably a simple brainfart ... can you shed any light on what&#39;s going on
there ?

&#40;It&#39;s no big deal if you can&#39;t shed any light on that ... I can always seek
assistance from perlmonks or p5p.&#41;

If handling the Math::BigInt::GMP objects efficiently starts looking too 
involved, I&#39;ll just settle for stringifying *all* Math::BigInt objects - and 
work on improving the efficiency re the GMP-backended ones later.

Cheers,
Rob 
</div></div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;07&nbsp;21:41:49&nbsp;2016</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;08&nbsp;15:38:23&nbsp;2016</span>
    <span class="description">sisyphus1 [...] optusnet.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #110986] Does not accept Math::BigInt objects as input</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 8 Jan 2016 21:00:27 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Math-GMPz [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &lt;sisyphus1 [...] optusnet.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message----- 
From: sisyphus1@optusnet.com.au via RT
Sent: Friday, January 08, 2016 1:41 PM
To: sisyphus1@optusnet.com.au
Subject: Re: [rt.cpan.org #110986] Does not accept Math::BigInt objects as 
input

<div class="message-stanza open"><div class="message-stanza open">&gt;&gt; It would be convenient if Math::GMPz accepted Math::BigInt objects in
&gt;&gt; new&#40;&#41;, ideally including overloads.
</div>&gt;
&gt; Yes, I can do that.
</div>
An additional thought as I implement Math::BigInt overloads in Math::GMPz:

Note that, wrt overloading of subtraction,
Math::BigInt-&gt;new&#40;&#39;42&#39;&#41; - Math::GMPz-&gt;new&#40;&#39;21&#39;&#41; returns a Math::BigInt 
object, whereas
Math::GMPz-&gt;new&#40;&#39;42&#39;&#41; - Math::BigInt-&gt;new&#40;&#39;21&#39;&#41; will return a Math::GMPz 
object - and similarly for the overloading of the &#34;-&#34; and &#34;%&#34; operators.

Is that a concern for you ?
It doesn&#39;t really bother me, though I think it&#39;s the sort of thing that can 
easily confuse users.
I guess the same thing happens with Math::BigInt/Math::GMP, too.

It also occurred to me that
$z = Rmpz_init_set_str&#40;Math::BigInt-&gt;new&#40;&#39;123&#39;&#41;, 10&#41;;
is an existing alternative to
$z = Math::GMPz-&gt;new&#40;Math::BigInt-&gt;new&#40;&#39;123&#39;&#41;&#41;;

In fact, you can pass any object to Rmpz_init_set_str&#40;&#41; and it should do 
&#34;the right thing&#34; so long as the stringification of that object &#34;does the 
right thing&#34;.

Anyway .... just a couple of thoughts .... and they don&#39;t deter me from 
pushing on.

Cheers,
Rob
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;08&nbsp;20:49:11&nbsp;2016</span>
    <span class="description">sisyphus1 [...] optusnet.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #110986] Does not accept Math::BigInt objects as input</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 9 Jan 2016 12:48:09 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Math-GMPz [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &lt;sisyphus1 [...] optusnet.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space"><span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message----- 
From: sisyphus1@optusnet.com.au via RT
Sent: Friday, January 08, 2016 1:41 PM
To: sisyphus1@optusnet.com.au
Subject: Re: [rt.cpan.org #110986] Does not accept Math::BigInt objects as
input

<div class="message-stanza open">&gt; Note that, wrt overloading of subtraction ..... and similarly for the 
&gt; overloading of the &#34;-&#34; and &#34;%&#34; operators.
</div>
Not sure why I singled out the non-commutative operators when the 
commutative operators are, of course, affected in the same way.
&#40;Something to do with not thinking, I expect.&#41;

Not that it really belongs here, but I&#39;ve set up things so that for a 
limited range of operations, an overloaded operation between a Math::MPFR 
object and a Math::GMPq/Math::GMPf/Math::GMPz returns a Math::MPFR object, 
irrespective of the order of the operands.
From the Math::MPFR documentation:

As of version 3.13 of Math::MPFR, some cross-class overloading
is allowed.
Let $M be a Math::MPFR object, and $G be any one of a Math::GMPz,
Math::GMPq or Math::GMPf object. Then it is now permissible to
do:

$M + $G;
$M - $G;
$M * $G;
$M / $G;
$M ** $G;

In each of the above, a Math::MPFR object containing the result
of the operation is returned.It is also now permissible to do:

$M += $G;
$M -= $G;
$M *= $G;
$M /= $G;
$M **= $G;

If you have version 0.35 &#40;or later&#41; of Math::GMPz, Math::GMPq
and Math::GMPf, it is also permissible to do:

$G + $M;
$G - $M;
$G * $M;
$G / $M;
$G ** $M;

Again, each of those operations returns a Math::MPFR object
containing the result of the operation.
Each operation is conducted using current default rounding mode.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;08&nbsp;23:59:28&nbsp;2016</span>
    <span class="description">sisyphus1 [...] optusnet.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #110986] Does not accept Math::BigInt objects as input</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 9 Jan 2016 15:58:18 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Math-GMPz [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &lt;sisyphus1 [...] optusnet.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
       Queue: Math-GMPz
Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=110986">https://rt.cpan.org/Ticket/Display.html?id=110986</a></span> &gt;

Math::BigInt overloading now available from github.
At this stage, the overloading &#40;even for the Math::BigInt::GMP variant&#41; is 
done by stringifying the Math::BigInt object.

I plan to send it to CPAN tomorrow, but if anyone wants to test it out in 
the meantime:
git clone git@github.com:sisyphus/math-gmpz Math-GMPz

Cheers,
Rob
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;11&nbsp;09:01:54&nbsp;2016</span>
    <span class="description">sisyphus1 [...] optusnet.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #110986] Does not accept Math::BigInt objects as input</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 12 Jan 2016 01:00:57 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Math-GMPz [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &lt;sisyphus1 [...] optusnet.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">       Queue: Math-GMPz
Ticket &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=110986">https://rt.cpan.org/Ticket/Display.html?id=110986</a></span> &gt;

The version at github &#40;git clone git@github.com:sisyphus/math-gmpz 
Math-GMPz&#41; now has enhanced Math::BigInt::GMP overloading that accesses the 
mpz_t directly, and therefore more efficiently.

The robustness of this enhancement is yet to be established - though I&#39;ve 
had no problem with it on perls ranging from 5.8.8 to 5.22.0 and on 
powerpc64 &#40;running Debian Wheezy&#41;, Ubuntu and Windows.

The enhanced approach can be switched off by commenting out the line
$defines .= &#34; -DENABLE_MATH_BIGINT_GMP_OVERLOAD&#34;;
in the Makefile.PL.
If that is done, then the Math::BigInt::GMP overloading reverts to 
stringifying the Math::BigInt object, and then converting that string to an 
mpz_t using mpz_set_str.

Cheers,
Rob 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;11&nbsp;10:12:01&nbsp;2016</span>
    <span class="description">DANAJ [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Rob,

As usual I&#39;m impressed by your speed at solving these things.  This sounds great.  I haven&#39;t had time to test the github changes yet, but will try to get to it in the next couple days.

Dana
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;11&nbsp;22:38:36&nbsp;2016</span>
    <span class="description">sisyphus1 [...] optusnet.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #110986] Does not accept Math::BigInt objects as input</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 12 Jan 2016 14:37:38 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Math-GMPz [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &lt;sisyphus1 [...] optusnet.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message----- 
From: Dana Jacobsen via RT
Sent: Tuesday, January 12, 2016 2:12 AM
To: sisyphus1@optusnet.com.au
Subject: [rt.cpan.org #110986] Does not accept Math::BigInt objects as input

<div class="message-stanza open">&gt;  I haven&#39;t had time to test the github changes yet, but will try to get to 
&gt; it in the next couple days.
</div>
There&#39;s no hurry - I&#39;m hanging back from pushing it to CPAN in case 
something comes out of
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.perlmonks.org/?node_id=1152413">http://www.perlmonks.org/?node_id=1152413</a></span>

In the meantime I&#39;ll just upload improvements to the code on github as I 
become aware of them.

Some nits to pick at:

I&#39;m not doing the &#34;&#38;&#38; mg-&gt;mg_virtual == &#38;vtbl_gmp&#34; check that 
Math::BigInt::GMP does - and I wonder if/how that omission can lead to 
breakage of the Math::BigInt::GMP overloading.

I&#39;m also ignoring the &#34;threadsafe&#34; aspect that Math::BigInt::GMP apparently 
takes into account.

The code assumes that Math::BigInt object has a key named &#34;value&#34; and a key 
named &#34;sign&#34; and that, if the &#34;sign&#34; key is neither &#34;-&#34; nor &#34;+&#34;, then the 
Math::BigInt object is not valid for the purposes of GMP - in which case the 
overload sub croaks.
&#40;For all of the Math::BigInt objects I&#39;ve looked at the &#34;sign&#34; key is 
neither &#34;-&#34; nor &#34;+&#34; whenn the Math::BigInt object is NaN/Inf.&#41;

If Math::BigInt::GMP overloading is in place but, for some reason, fails to 
set the mpz variable then it just falls through to overloading via 
stringification.
This is good &#40;in so far as the overloading still works&#41; but not so good in 
that there&#39;s nothing to tell the user that this has happened.

The mpz variable is currently declared as &#34;mpz_t * mpz = &#40;mpz_t*&#41;NULL;&#34;
But at various points in the code I have to cast it to mpz_scrptr &#40;or 
mpz_ptr in one place&#41; to avoid compiler warnings. I don&#39;t really understand 
that, but I often get confused by pointers.
&#40;I think the &#34;mpz_ptr&#34; and &#34;mpz_srcptr&#34; types go back quite a long way in 
gmp - at least I see them in demos/perl/GMP.xs in the gmp source distro, and 
I don&#39;t think that code has been touched this century.&#41;

These nits aren&#39;t currently bothering me too much - I mainly just wanted you 
to be aware of them.

Cheers,
Rob
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;12&nbsp;09:05:51&nbsp;2016</span>
    <span class="description">sisyphus1 [...] optusnet.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #110986] Does not accept Math::BigInt objects as input</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 13 Jan 2016 01:05:03 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Math-GMPz [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &lt;sisyphus1 [...] optusnet.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
Ooops ... handling of the sign needs fixing.
I&#39;ll do that tomorrow.

Cheers,
Rob
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;12&nbsp;22:44:56&nbsp;2016</span>
    <span class="description">sisyphus1 [...] optusnet.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #110986] Does not accept Math::BigInt objects as input</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 13 Jan 2016 14:43:15 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Math-GMPz [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &lt;sisyphus1 [...] optusnet.com.au&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Ooops ... handling of the sign needs fixing.
&gt; I&#39;ll do that tomorrow.
</div>
new&#40;&#41; and Math::BigInt::GMP overloading now fixed in github.
Extra tests added.

Cheers,
Rob
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;18&nbsp;08:47:38&nbsp;2016</span>
    <span class="description">sisyphus [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Ran out of excuses for procrastinating further - Math-GMPz-0.43 now uploaded to CPAN.

Cheers,
Rob
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
