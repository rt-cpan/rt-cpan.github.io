<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #20322 for XML-Twig: The method being employed to break circular references is just a little *too* eager.</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #20322 for XML-Twig: The method being employed to break circular references is just a little *too* eager.</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/XML-Twig/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/XML-Twig/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/XML-Twig/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/XML-Twig/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/XML-Twig">XML-Twig CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">20322</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/XML-Twig/Active/">XML-Twig</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
cmccutcheon [...] oneil.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-37682-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
3.25</li>
<li>
3.26</li>
</ul>
    </td>
  </tr>
  <tr id="CF-37683-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;06&nbsp;13:56:37&nbsp;2006</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> The method being employed to break circular references is just a
 little *too* eager.</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">See the below script for an example of broken and working code:


#!/usr/bin/perl
use strict;
use warnings;
use XML::Twig;

my $broken = 1;
my $xml = &#34;&lt;a&gt;&lt;b&gt;foo&lt;/b&gt;&lt;c&gt;&lt;d&gt;bar&lt;/d&gt;&lt;e&gt;baz&lt;/e&gt;&lt;/c&gt;&lt;/a&gt;&#34;;
if&#40;$broken&#41;
{
  my $root = undef;
  {
    my $twig = XML::Twig-&gt;new&#40;pretty_print =&gt; &#34;none&#34;&#41;;
    my $doc = $twig-&gt;safe_parse&#40;$xml&#41;;
    if&#40;$@&#41; { die &#34;ACK, GASP: Parse error: $@\n&#34;; }
    $root = $doc-&gt;root;
  }
  warn &#34;Finding nodes...\n&#34;;
  my @nodes = $root-&gt;findnodes&#40;&#34;/a/c/e&#34;&#41;;
  warn &#34;This message will never print.\n&#34;;
  print &#34;Nodes: &#34;, $nodes[0]-&gt;sprint;
}
else
{
  my $twig = XML::Twig-&gt;new&#40;pretty_print =&gt; &#34;none&#34;&#41;;
  my $doc = $twig-&gt;safe_parse&#40;$xml&#41;;
  if&#40;$@&#41; { die &#34;ACK, GASP: Parse error: $@\n&#34;; }
  my $root = $doc-&gt;root;
  warn &#34;Finding nodes...\n&#34;;
  my @nodes = $root-&gt;findnodes&#40;&#34;/a/c/e&#34;&#41;;
  warn &#34;This message will print.\n&#34;;
  print &#34;Nodes: &#34;, $nodes[0]-&gt;sprint;
}


The exact error I get is:
Can&#39;t call method &#34;children&#34; on an undefined value at &#40;eval 12&#41; line 1.

If all mentions of XML::Twig are changed to XML::Twig::XPath, the error
changes to:
Can&#39;t use an undefined value as a HASH reference at
/usr/lib/perl5/site_perl/5.8.8/XML/Twig/XPath.pm line 131.

This problem is particularly frustrating when an XML::Twig is passed
between functions.  The work-around &#40;read &#34;very ugly hack&#34;&#41; is to
-&gt;sprint&#40;&#41; out the twig &#40;yes, -&gt;sprint&#40;&#41; works but -&gt;findnodes&#40;&#41; does
not... go figure :/&#41; and reparse if it is needed in a different scope
than the one in which it was declared -- not exactly conductive to clean
code.

Also, upgrading Scalar::Util to the latest and greatest &#40;I was at 1.14,
then upgraded to 1.18&#41; did not fix the problem either.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;16&nbsp;10:49:19&nbsp;2006</span>
    <span class="description">MIROD [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

Sorry for the delay, I was away for a couple of weeks.

The problem I see with your code is that you go &#40;slightly!&#41; out of your
way to get the variable containing the twig out of scope. You keep $root
in scope, by declaring it outside of the block in which you create and
parse the twig. But you don&#39;t do the same for the entire twig. It is
declared inside the block, and goes out of scope before you call
findnodes. Then findnodes looks for the twig when it sees the leading /
in the XPath expression, and gets an undef. But in any case. if you only
keep part of a twig in scope &#40;the root being just one possible case&#41;,
the using an XPath expression with a leading / is bound to create problems.

I can probably fix the XML::Twig version of findnodes, the
XML::Twig::XPath version might be a little more tricky &#40;some of the code
is either in XML::XPath or in XML::XPathEngine&#41;.

The thing is, why do you discard the twig and keep only the root? 

I understand that your code is only meant to show the problem, but I
kinda fail to imagine situations where you really can&#39;t keep the whole
twig around, but still need XPath queries with a leading /.

So at this point my advice would be &#34;don&#39;t do it&#34;, and the fix I am
thinking of is just to generate a nicer looking error.

I am willing to be convinced that this is not the best solution though.

Does it make sense?

__
mirod
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;16&nbsp;10:49:19&nbsp;2006</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;16&nbsp;10:49:52&nbsp;2006</span>
    <span class="description">MIROD [...] cpan.org -  Status changed from &#39;open&#39; to &#39;new&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jul&nbsp;16&nbsp;12:58:47&nbsp;2006</span>
    <span class="description">MIROD [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;19&nbsp;10:36:54&nbsp;2006</span>
    <span class="description">cmccutcheon [...] oneil.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> RE: [rt.cpan.org #20322] The method being employed to break circular references is just a little *too* eager. </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 19 Jul 2006 10:35:43 -0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-XML-Twig [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Calvin McCutcheon&#34; &lt;cmccutcheon [...] oneil.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Greetings,

Yes, what you said made sense.

Going slightly out of my way to get the twig out of scope is the
simplest way I can demonstrate what happens when an XML::Twig root is
passed to a function &#40;such as, a recursive function&#41;.  Or, when you do a
copy of a root node &#40;in preparation for some destructive testing&#41; and
try to run an XPath on the copied node &#40;with or without the original
twig in scope&#41;.

As for having XPath queries which begin with a leading &#34;/&#34;, think of a
tree walker that can get an instruction to go to any point on the tree
from any point on the tree.  And yes, I can see your point about using
an XPath with a leading &#34;/&#34; from an arbitrarily deep node &#40;I still think
the root node should be an exception to this though&#41;.

Speaking of going from any point to any point, attached is a proposed
patch for the XML::Twig-&gt;xpath method.  The key difference is the
ability to say something like this:

        my $xpath = $first_node-&gt;xpath&#40;$second_node&#41;;

and get the XPath from the first node to the second node.  Also, &#40;for
backward compatibility&#41; if no second node is passed in, the output is
identical to the original -&gt;xpath method.

As for the problem at hand, how is this for a possible solution?
Instead of &#40;or in conjunction with&#41; creating a better error message
&#40;which would help&#41;, why not allow the use of Scalar::Util &#40;and WeakRef&#41;
to be user configurable with something like:

        XML::Twig-&gt;new&#40;memory_management =&gt; 0&#41;;

and the corresponding method:

        $twig-&gt;set_memory_management&#40;0&#41;;

where the default would be &#34;memory_management =&gt; 1&#34;.  In conjunction
with this change, the write-ups for -&gt;dispose and -&gt;delete would need a
little more prominence in the documentation.  &#40;Although, I would vastly
prefer the ability to use -&gt;findnodes from arbitrarily deep nodes &#40;with
or without the original twig in scope&#41;.&#41;

Calvin


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">-----Original Message-----
From: via RT [mailto:bug-XML-Twig@rt.cpan.org] 
Sent: Sunday, July 16, 2006 10:49 AM
To: Calvin McCutcheon
Subject: [rt.cpan.org #20322] The method being employed to break
circular references is just a little *too* eager. 


&lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=20322">http://rt.cpan.org/Ticket/Display.html?id=20322</a></span> &gt;

Hi,

Sorry for the delay, I was away for a couple of weeks.

The problem I see with your code is that you go &#40;slightly!&#41; out of your
way to get the variable containing the twig out of scope. You keep $root
in scope, by declaring it outside of the block in which you create and
parse the twig. But you don&#39;t do the same for the entire twig. It is
declared inside the block, and goes out of scope before you call
findnodes. Then findnodes looks for the twig when it sees the leading /
in the XPath expression, and gets an undef. But in any case. if you only
keep part of a twig in scope &#40;the root being just one possible case&#41;,
the using an XPath expression with a leading / is bound to create
problems.

I can probably fix the XML::Twig version of findnodes, the
XML::Twig::XPath version might be a little more tricky &#40;some of the code
is either in XML::XPath or in XML::XPathEngine&#41;.

The thing is, why do you discard the twig and keep only the root? 

I understand that your code is only meant to show the problem, but I
kinda fail to imagine situations where you really can&#39;t keep the whole
twig around, but still need XPath queries with a leading /.

So at this point my advice would be &#34;don&#39;t do it&#34;, and the fix I am
thinking of is just to generate a nicer looking error.

I am willing to be convinced that this is not the best solution though.

Does it make sense?

__
mirod

**********************************************************************
Confidentiality Notice
The information contained in this e-mail is confidential and intended for
use only by the person&#40;s&#41; or organization listed in the address. If you have
received this communication in error, please contact the sender at O&#39;Neil &#38;
Associates, Inc., immediately. Any copying, dissemination, or distribution
of this communication, other than by the intended recipient, is strictly
prohibited.
**********************************************************************
</div></div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;21&nbsp;13:34:56&nbsp;2006</span>
    <span class="description">MIROD [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Sorry for the delay, job has kept me quite busy this week.

On Wed Jul 19 10:36:54 2006, cmccutcheon@oneil.com wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Going slightly out of my way to get the twig out of scope is the
&gt; simplest way I can demonstrate what happens when an XML::Twig root is
&gt; passed to a function &#40;such as, a recursive function&#41;.  Or, when you do a
&gt; copy of a root node &#40;in preparation for some destructive testing&#41; and
&gt; try to run an XPath on the copied node &#40;with or without the original
&gt; twig in scope&#41;.
</div>
If you pass nodes &#40;root or otherwise&#41; to a function, you just have to
make sure the twig itself is still in scope somewhere. If you want to
copy the root node, then I will provide a copy &#40;or clone&#41; method for a
twig so you can play with it to your heart&#39;s content. In the meantime
you can write your own, just create an empty twig and attach the copy of
the root node to it:

# $twig is the original twig
my $root_node_copy= $twig-&gt;root-&gt;copy;
my $new_twig= XML::Twig-&gt;new;
$new_twig-&gt;set_root&#40; $root_node_copy&#41;;

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As for having XPath queries which begin with a leading &#34;/&#34;, think of a
&gt; tree walker that can get an instruction to go to any point on the tree
&gt; from any point on the tree.  And yes, I can see your point about using
&gt; an XPath with a leading &#34;/&#34; from an arbitrarily deep node &#40;I still think
&gt; the root node should be an exception to this though&#41;.
</div>
I thought about making an exception for the root node, but really, in
all XML models I know, the document node and the root node are 2
different nodes, which really makes sense &#40;the document node can have
the XML declaration, or a DTD attached for starters&#41;.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Speaking of going from any point to any point, attached is a proposed
&gt; patch for the XML::Twig-&gt;xpath method.  The key difference is the
&gt; ability to say something like this:
&gt; 
&gt;       my $xpath = $first_node-&gt;xpath&#40;$second_node&#41;;
&gt; 
&gt; and get the XPath from the first node to the second node.  Also, &#40;for
&gt; backward compatibility&#41; if no second node is passed in, the output is
&gt; identical to the original -&gt;xpath method.
</div>
This is quite different from the original xpath method, and seems to me
quite specific to your code. You could subclass XML::Twig &#40;and
XML::Twig::Elt, look at the elt_class option:
<span class="clickylink"><a target="new" rel="nofollow" href="http://xmltwig.com/xmltwig/twig_dev.html#METHODS_XML_Twig_new_elt_class&#41;">http://xmltwig.com/xmltwig/twig_dev.html#METHODS_XML_Twig_new_elt_class&#41;</a></span>
and either use the method in your patch, or one with a different name.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; As for the problem at hand, how is this for a possible solution?
&gt; Instead of &#40;or in conjunction with&#41; creating a better error message
&gt; &#40;which would help&#41;, why not allow the use of Scalar::Util &#40;and WeakRef&#41;
&gt; to be user configurable with something like:
&gt; 
&gt;       XML::Twig-&gt;new&#40;memory_management =&gt; 0&#41;;
&gt; 
&gt; and the corresponding method:
&gt; 
&gt;       $twig-&gt;set_memory_management&#40;0&#41;;
&gt; 
&gt; where the default would be &#34;memory_management =&gt; 1&#34;.  In conjunction
&gt; with this change, the write-ups for -&gt;dispose and -&gt;delete would need a
&gt; little more prominence in the documentation.  &#40;Although, I would vastly
&gt; prefer the ability to use -&gt;findnodes from arbitrarily deep nodes &#40;with
&gt; or without the original twig in scope&#41;.&#41;
</div>
The thing is, all you have to do to avoid the problem, is not have the
twig go out of scope. Having XML::Twig test an option for each element
during parsing seems like a pretty sub-optimal solution to this.

Really, I don&#39;t quite understand why you NEED to drop the twig in your
code. It&#39;s not like it&#39;s a huge object, compared to the tree. It&#39;s not
small, but it has a fixed size, a few Kb at most.

__
mirod
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Mon&nbsp;Jan&nbsp;22&nbsp;04:50:41&nbsp;2007</span>
    <span class="description">MIROD [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
