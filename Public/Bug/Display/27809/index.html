<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #27809 for Tie-Handle-CSV: Tie::Handle::CSV and DOS files</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #27809 for Tie-Handle-CSV: Tie::Handle::CSV and DOS files</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Tie-Handle-CSV/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Tie-Handle-CSV/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Tie-Handle-CSV/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Tie-Handle-CSV/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Tie-Handle-CSV">Tie-Handle-CSV CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">27809</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">deleted</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Tie-Handle-CSV/Active/">Tie-Handle-CSV</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
gary.stainburn [...] ringways.co.uk

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-32968-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-32969-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;29&nbsp;05:57:00&nbsp;2007</span>
    <span class="description">gary.stainburn [...] ringways.co.uk -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Tie::Handle::CSV and DOS files</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 29 Jun 2007 10:53:40 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bugs-Tie-Handle-CSV [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Gary Stainburn &lt;gary.stainburn [...] ringways.co.uk&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi

I&#39;ve got the following script which works until it reaches the end of the 
input file. It processes the last line and prints out the contents, but then 
the program terminates with the unhelpful error:

Manufacturers Ref.:     L53522  Status: 5290    &#40;Work not pulled&#41;
Comments:       &#39;&#39;


^Z at ../bin/walon4 line 25

Line 25 is the last print statement within the while loop. If I delete that 
line and re-run the script it then complains about line 24. Either way, the 
program terminates before printing &#39;Hello World&#39;

I have discovered that the problem is that the input file which is in DOS 
format has the DOS  EOF character at the end. This ^Z causes Tie::Handle::CSV 
to die. Removing the ^Z before processing the file allows the program to run 
properly, printing Hello World etc.



#!/usr/bin/perl -w

use strict;
use warnings;

use Tie::Handle::CSV;
my $csv_fh = Tie::Handle::CSV-&gt;new&#40;$ARGV[0], header =&gt; 1&#41;;

while &#40;my $csv_line = &lt;$csv_fh&gt;&#41; {
  print &#34;Arrival Date:\t&#34;,$csv_line-&gt;{&#34;Arrival Date&#34;}, &#34;\t&#34;;
  print &#34;Chassis:\t&#34;,$csv_line-&gt;{&#34;Chassis&#34;}, &#34;\t&#34;;
  print &#34;Walon Ref.:\t&#34;,$csv_line-&gt;{&#34;Walon Ref.&#34;}, &#34;\t&#34;;
  print &#34;Radio Code:\t&#34;,$csv_line-&gt;{&#34;Radio Code&#34;}, &#34;\t&#34;;
  print &#34;Key No.:\t&#34;,$csv_line-&gt;{&#34;Key No.&#34;}, &#34;\n&#34;;
  print &#34;Inspection 1:\t&#34;,$csv_line-&gt;{&#34;Inspection 1&#34;}, &#34;\t&#34;;
  print &#34;Parts Ordered:\t&#34;,$csv_line-&gt;{&#34;Parts Ordered&#34;}, &#34;\t&#34;;
  print &#34;Parts Received:\t&#34;,$csv_line-&gt;{&#34;Parts Received&#34;}, &#34;\n&#34;;
  print &#34;Estimate Sent:\t&#34;,$csv_line-&gt;{&#34;Estimate Sent&#34;}, &#34;\t&#34;;
  print &#34;Authorised:\t&#34;,$csv_line-&gt;{&#34;Authorised&#34;}, &#34;\t&#34;;
  print &#34;Repaired:\t&#34;,$csv_line-&gt;{&#34;Repaired&#34;}, &#34;\n&#34;;
  print &#34;Manufacturers Ref.:\t&#34;,$csv_line-&gt;{&#34;Manufacturers Ref.&#34;}, &#34;\t&#34;;
  print &#34;Status:\t&#34;,$csv_line-&gt;{&#34;Status&#34;}, &#34;\t&#34;;
  print &#34;&#40;&#34;,$csv_line-&gt;{&#34;.&#34;}, &#34;&#41;\n&#34;;
  print &#34;Comments:\t&#39;&#34;,$csv_line-&gt;{&#34;Comments&#34;}, &#34;&#39;\n&#34;;
  print &#34;\n\n&#34;;         # ******* this is line 25 ********
}

print &#34;Hello World\n&#34;;
close $csv_fh;
-- 
Gary Stainburn
 
This email does not contain private or confidential material as it
may be snooped on by interested government parties for unknown
and undisclosed purposes - Regulation of Investigatory Powers Act, 2000     
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;29&nbsp;10:24:08&nbsp;2007</span>
    <span class="description">danboo [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> DANBOO [...] cpan.org</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Jun 29 05:57:00 2007, gary.stainburn@ringways.co.uk wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I have discovered that the problem is that the input file which is in
&gt; DOS
&gt; format has the DOS  EOF character at the end. This ^Z causes
&gt; Tie::Handle::CSV
&gt; to die. Removing the ^Z before processing the file allows the program
&gt; to run
&gt; properly, printing Hello World etc.
</div>
I believe ^Z is an archaic EOF used by DOS, CP/M and VMS.

I&#39;d suggest trying to parse the file cleanly with only Text::CSV_XS
first. Perhaps setting &#39;binary =&gt; 1&#39; when creating the Text::CSV_XS
instance would help.

Once that works you can pass that instance to Tie::Handle::CSV to do the
parsing.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;29&nbsp;10:24:19&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;29&nbsp;10:44:26&nbsp;2007</span>
    <span class="description">gary.stainburn [...] ringways.co.uk -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #27809] Tie::Handle::CSV and DOS files</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 29 Jun 2007 15:40:40 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Tie-Handle-CSV [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Gary Stainburn &lt;gary.stainburn [...] ringways.co.uk&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Friday 29 June 2007 15:24, via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=27809">http://rt.cpan.org/Ticket/Display.html?id=27809</a></span> &gt;
&gt;
&gt; On Fri Jun 29 05:57:00 2007, gary.stainburn@ringways.co.uk wrote:
<div class="message-stanza open">&gt; &gt; I have discovered that the problem is that the input file which is in
&gt; &gt; DOS
&gt; &gt; format has the DOS  EOF character at the end. This ^Z causes
&gt; &gt; Tie::Handle::CSV
&gt; &gt; to die. Removing the ^Z before processing the file allows the program
&gt; &gt; to run
&gt; &gt; properly, printing Hello World etc.
</div>&gt;
&gt; I believe ^Z is an archaic EOF used by DOS, CP/M and VMS.
&gt;
&gt; I&#39;d suggest trying to parse the file cleanly with only Text::CSV_XS
&gt; first. Perhaps setting &#39;binary =&gt; 1&#39; when creating the Text::CSV_XS
&gt; instance would help.
&gt;
&gt; Once that works you can pass that instance to Tie::Handle::CSV to do the
&gt; parsing.
</div>
Thankyou for this.  I had already done something similar to resolve my 
problem.

I only raised it as a bug to make you aware of the problem. That way, you may 
be able to embed a solution within the module as you develop it further to 
stop others falling into the same trap.

Maybe it should have been sent to Text::CSV_XS instead.

Thanks anyway

Gary
-- 
Gary Stainburn
 
This email does not contain private or confidential material as it
may be snooped on by interested government parties for unknown
and undisclosed purposes - Regulation of Investigatory Powers Act, 2000     
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sat&nbsp;Jan&nbsp;21&nbsp;17:19:14&nbsp;2012</span>
    <span class="description">danboo [...] cpan.org -  Ticket deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
