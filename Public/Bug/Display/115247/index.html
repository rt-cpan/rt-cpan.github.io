<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #115247 for Math-Currency: Math::Currency Operator Comparisons Failing since Math-BigInt-1.999718</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #115247 for Math-Currency: Math::Currency Operator Comparisons Failing since Math-BigInt-1.999718</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Math-Currency">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Math-Currency">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Math-Currency">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Math-Currency">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Math-Currency">Math-Currency CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">115247</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Math-Currency">Math-Currency</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
DRZIGMAN [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Critical    </td>
  </tr>
  <tr id="CF-20602-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-20603-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.48    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




007_comparision.t<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1637073/877578/007_comparision.t">
Fri Jun 10 14:46:55 2016 (2.4k) by DRZIGMAN [...] cpan.org
</a>
</font></li>
</ul>


bcmp.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1637073/877579/bcmp.patch">
Fri Jun 10 14:46:55 2016 (529b) by DRZIGMAN [...] cpan.org
</a>
</font></li>
</ul>


Math-Currency.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1638707/878483/Math-Currency.patch">
Thu Jun 16 10:48:47 2016 (3.3k) by https://openid.stackexchange.com/user/3cffd334-9f13-42d9-894d-ec689b4ad3c5
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=115247">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1637073" href="/Public/Bug/Display.html?id=115247#txn-1637073">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jun&nbsp;10&nbsp;14:46:55&nbsp;2016</span>
    <span class="description">DRZIGMAN [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Math::Currency Operator Comparisons Failing since Math-BigInt-1.999718</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1637073/877577/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/877577">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Greetings,

Since Math::BigInt v1.999718 all operator comparisons using Math::Currency objects are now failing:

cmp_ok&#40; Math::Currency-&gt;new&#40;&#39;19.95&#39;&#41;, &#39;==&#39;, Math::Currency-&gt;new&#40;&#39;19.95&#39;&#41;, &#39;Object == Object&#39; &#41;;

    not ok 1 - Object == Object

    #   Failed test &#39;Object == Object&#39;
    #   at t/007_comparision.t line 12.
    #          got: 19.95
    #     expected: 19.95

This was caused by the following noted change in Math::BigInt:

2016-04-22 v1.999718 pjacklam

 * Add overloading of &#39;==&#39;, &#39;!=&#39;, &#39;&lt;&#39;, &#39;&lt;=&#39;, &#39;&gt;&#39;, to to Math::BigInt and
   Math::BigFloat and fix the broken overloading of &#39;&gt;=&#39;. These overloaded
   operators now behave like the equivalent core Perl operators.

&#40;via Bisection I am able to confirm that v1.999717 works with Math::Currency while v1.999718 does not&#41;.

I&#39;ve gone ahead and created a failing test &#40;attached as t/007_comparision.t&#41; and a patch to Math::Currency that resolves the issue &#40;attached as bcmp.patch&#41;.

Hopefully this patch can be applied and the test added so that we have a nice regression test.  I&#39;ve tried to write the test in your style to minimize the amount of work needed on your side.

Please feel free to reach out to me if you need more information, wish to discuss, or if I can be of any assistance.

Thank you!
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> 007_comparision.t</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1637073/877578/007_comparision.t">Download 007_comparision.t</a><br />
<span class="downloadcontenttype">text/x-perl 2.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">use Test::More qw&#40;no_plan&#41;;

BEGIN { use_ok&#40;&#39;Math::Currency&#39;&#41; };

# For subsequent testing, we need to make sure that format is default US
Math::Currency-&gt;format&#40;&#39;USD&#39;&#41;;

subtest &#39;==&#39; =&gt; sub {
    my $object = Math::Currency-&gt;new&#40;&#39;19.95&#39;&#41;;
    my $scalar = 19.95;

    cmp_ok&#40; $object, &#39;==&#39;, $object, &#39;Object == Object&#39; &#41;;
    cmp_ok&#40; $scalar, &#39;==&#39;, $object, &#39;Scalar == Object&#39; &#41;;
    cmp_ok&#40; $object, &#39;==&#39;, $scalar, &#39;Object == Scalar&#39; &#41;;

    ok&#40; !&#40; Math::Currency-&gt;new&#40;&#39;19.95&#39;&#41; == Math::Currency-&gt;new&#40;&#39;15.00&#39;&#41; &#41;, &#39;Object != Object&#39; &#41;;
};

subtest &#39;&lt;=&#39; =&gt; sub {
    subtest &#39;==&#39; =&gt; sub {
        my $object = Math::Currency-&gt;new&#40;&#39;19.95&#39;&#41;;
        my $scalar = 19.95;

        cmp_ok&#40; $object, &#39;&lt;=&#39;, $object, &#39;Object == Object&#39; &#41;;
        cmp_ok&#40; $scalar, &#39;&lt;=&#39;, $object, &#39;Scalar == Object&#39; &#41;;
        cmp_ok&#40; $object, &#39;&lt;=&#39;, $scalar, &#39;Object == Scalar&#39; &#41;;

        ok&#40; !&#40; Math::Currency-&gt;new&#40;&#39;19.95&#39;&#41; &lt;= Math::Currency-&gt;new&#40;&#39;15.00&#39;&#41; &#41;, &#39;Object &#40;!&#41;&lt;= Object&#39; &#41;;
    };

    subtest &#39;&lt;=&#39; =&gt; sub {
        my $lesser_object  = Math::Currency-&gt;new&#40;&#39;15.00&#39;&#41;;
        my $lesser_scalar  = 15.00;
        my $greater_object = Math::Currency-&gt;new&#40;&#39;19.95&#39;&#41;;
        my $greater_scalar = 19.95;

        cmp_ok&#40; $lesser_object, &#39;&lt;=&#39;, $greater_object, &#39;Object &lt;= Object&#39; &#41;;
        cmp_ok&#40; $lesser_scalar, &#39;&lt;=&#39;, $greater_object, &#39;Scalar &lt;= Object&#39; &#41;;
        cmp_ok&#40; $lesser_object, &#39;&lt;=&#39;, $greater_scalar, &#39;Object &lt;= Scalar&#39; &#41;;

        ok&#40; !&#40; $greater_object &lt;= $lesser_object &#41;, &#39;Object &#40;!&#41;&lt;= Object&#39; &#41;;
    };
};

subtest &#39;&gt;=&#39; =&gt; sub {
    subtest &#39;==&#39; =&gt; sub {
        my $object = Math::Currency-&gt;new&#40;&#39;19.95&#39;&#41;;
        my $scalar = 19.95;

        cmp_ok&#40; $object, &#39;&gt;=&#39;, $object, &#39;Object == Object&#39; &#41;;
        cmp_ok&#40; $scalar, &#39;&gt;=&#39;, $object, &#39;Scalar == Object&#39; &#41;;
        cmp_ok&#40; $object, &#39;&gt;=&#39;, $scalar, &#39;Object == Scalar&#39; &#41;;

        ok&#40; !&#40; Math::Currency-&gt;new&#40;&#39;15.00&#39;&#41; &gt;= Math::Currency-&gt;new&#40;&#39;19.95&#39;&#41; &#41;, &#39;Object &#40;!&#41;&gt;= Object&#39; &#41;;
    };

    subtest &#39;&gt;=&#39; =&gt; sub {
        my $lesser_object  = Math::Currency-&gt;new&#40;&#39;15.00&#39;&#41;;
        my $lesser_scalar  = 15.00;
        my $greater_object = Math::Currency-&gt;new&#40;&#39;19.95&#39;&#41;;
        my $greater_scalar = 19.95;

        cmp_ok&#40; $lesser_object, &#39;&gt;=&#39;, $lesser_object, &#39;Object &gt;= Object&#39; &#41;;
        cmp_ok&#40; $lesser_scalar, &#39;&gt;=&#39;, $lesser_object, &#39;Scalar &gt;= Object&#39; &#41;;
        cmp_ok&#40; $lesser_object, &#39;&gt;=&#39;, $lesser_scalar, &#39;Object &gt;= Scalar&#39; &#41;;


        ok&#40; !&#40; $lesser_object &gt;= $greater_object &#41;, &#39;Object &#40;!&#41;&gt;= Object&#39; &#41;;
    };
};
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> bcmp.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1637073/877579/bcmp.patch">Download bcmp.patch</a><br />
<span class="downloadcontenttype">text/x-diff 529b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- lib/Math/Currency.org.pm    2016-06-10 13:41:55.370303622 -0500
+++ lib/Math/Currency.pm    2016-06-10 13:42:02.464231293 -0500
@@ -314,7 +314,7 @@
 # we override the default here because we only want to compare the precision of
 # the currency we&#39;re dealing with, not the precision of the underlying object
 sub bcmp {
-    my $class = shift;
+    my $class = __PACKAGE__;
     # make sure we&#39;re dealing with two Math::Currency objects
     my &#40; $x, $y &#41; =
       map { ref $_ ne $class ? $class-&gt;new&#40;$_&#41; : $_ } @_[ 0, 1 ];
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1638707" href="/Public/Bug/Display.html?id=115247#txn-1638707">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;16&nbsp;10:48:47&nbsp;2016</span>
    <span class="description">https://openid.stackexchange.com/user/3cffd334-9f13-42d9-894d-ec689b4ad3c5 -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> dmaestro12</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1638707/878482/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/878482">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 481b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks DRZIGMAN for the patch. I was also working on fixing this, and want to contribute a substitute patch which is backward-compatible with older versions of Math::BigInt as well, and also provides successful testing with perl 5.18.

Your insight provided a simpler and better approach than what I was already working on, as revealed by your test.

This version has been tested successfully against Math::BigInt versions 1.89, 1.999717, 1.999718, and 1.999723, using perl 5.18.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Math-Currency.patch</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1638707/878483/Math-Currency.patch">Download Math-Currency.patch</a><br />
<span class="downloadcontenttype">text/x-diff 3.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -ru sources/Math-Currency-0.47/lib/Math/Currency.pm sources/Math-Currency/lib/Math/Currency.pm
--- sources/Math-Currency-0.47/lib/Math/Currency.pm	2010-08-10 14:33:55.000000000 -0500
+++ sources/Math-Currency/lib/Math/Currency.pm	2016-06-16 09:13:05.329390701 -0500
@@ -22,6 +22,11 @@
   $accuracy $precision $div_scale $round_mode $use_int $always_init&#41;;
 use Exporter;
 use Math::BigFloat 1.60;
+use vars qw&#40;$_legacy_bigint&#41;;
+BEGIN {
+    $_legacy_bigint = Math::BigInt-&gt;VERSION &lt;= &#39;1.999717&#39;;
+}
+
 use overload &#39;&#34;&#34;&#39; =&gt; \&#38;bstr;
 use POSIX qw&#40;locale_h&#41;;
 
@@ -314,7 +319,8 @@
 # we override the default here because we only want to compare the precision of
 # the currency we&#39;re dealing with, not the precision of the underlying object
 sub bcmp {
-    my $class = shift;
+    my $class = __PACKAGE__;
+    $class = shift if $_legacy_bigint;
 
     # make sure we&#39;re dealing with two Math::Currency objects
     my &#40; $x, $y &#41; =
diff -ru sources/Math-Currency-0.47/t/002_basic.t sources/Math-Currency/t/002_basic.t
--- sources/Math-Currency-0.47/t/002_basic.t	2010-08-10 14:33:55.000000000 -0500
+++ sources/Math-Currency/t/002_basic.t	2016-06-16 08:23:30.276217829 -0500
@@ -41,12 +41,12 @@
 
     ok &#40; defined $FORMAT, &#34;format defaults configured&#34; &#41;;
 
-    foreach $param qw&#40; INT_CURR_SYMBOL CURRENCY_SYMBOL MON_DECIMAL_POINT
+    foreach $param &#40; qw&#40; INT_CURR_SYMBOL CURRENCY_SYMBOL MON_DECIMAL_POINT
 		       MON_THOUSANDS_SEP MON_GROUPING POSITIVE_SIGN
 		       NEGATIVE_SIGN INT_FRAC_DIGITS FRAC_DIGITS
 		       P_CS_PRECEDES P_SEP_BY_SPACE N_CS_PRECEDES
 		       N_SEP_BY_SPACE P_SIGN_POSN N_SIGN_POSN
-		     &#41; # hardcoded keys to be sure they are all there
+		     &#41; &#41; # hardcoded keys to be sure they are all there
     {
 	    ok &#40; defined $CLASS-&gt;format&#40;$param&#41;, sprintf&#40;&#34; \t%-20s = &#39;%s&#39;&#34;,$param,$CLASS-&gt;format&#40;$param&#41;&#41; &#41;;
     }
diff -ru sources/Math-Currency-0.47/t/004_localize.t sources/Math-Currency/t/004_localize.t
--- sources/Math-Currency-0.47/t/004_localize.t	2010-08-10 14:33:55.000000000 -0500
+++ sources/Math-Currency/t/004_localize.t	2016-06-16 08:23:32.636279126 -0500
@@ -12,13 +12,13 @@
     skip &#40;&#34;No locale support&#34;, 16&#41; unless Math::Currency-&gt;localize&#40;&#41;;
     pass&#40;&#34;Re-initialized locale with en_GB&#34;&#41;;
 
-    foreach my $param qw&#40;
+    foreach my $param &#40; qw&#40;
       INT_CURR_SYMBOL CURRENCY_SYMBOL MON_DECIMAL_POINT
       MON_THOUSANDS_SEP MON_GROUPING POSITIVE_SIGN
       NEGATIVE_SIGN INT_FRAC_DIGITS FRAC_DIGITS
       P_CS_PRECEDES P_SEP_BY_SPACE N_CS_PRECEDES
       N_SEP_BY_SPACE P_SIGN_POSN N_SIGN_POSN
-      &#41;    # hardcoded keys to be sure they are all there
+      &#41; &#41;    # hardcoded keys to be sure they are all there
       {
         ok&#40; defined $format-&gt;{$param},
             sprintf&#40; &#34; \t%-20s = &#39;%s&#39;&#34;, $param, $format-&gt;{$param} &#41; &#41;;
@@ -33,13 +33,13 @@
     	unless $format-&gt;{INT_CURR_SYMBOL} =~ /GBP/;
 
     use_ok&#40;&#34;Math::Currency::en_GB&#34;&#41;;
-    foreach my $param qw&#40;
+    foreach my $param &#40; qw&#40;
       INT_CURR_SYMBOL CURRENCY_SYMBOL MON_DECIMAL_POINT
       MON_THOUSANDS_SEP MON_GROUPING POSITIVE_SIGN
       NEGATIVE_SIGN INT_FRAC_DIGITS FRAC_DIGITS
       P_CS_PRECEDES P_SEP_BY_SPACE N_CS_PRECEDES
       N_SEP_BY_SPACE P_SIGN_POSN N_SIGN_POSN
-      &#41;    # hardcoded keys to be sure they are all there
+      &#41; &#41;    # hardcoded keys to be sure they are all there
       {
 	my $global_param = $LC_MONETARY-&gt;{&#39;en_GB&#39;}-&gt;{$param};
         ok&#40; $format-&gt;{$param} eq $global_param,
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1638708" href="/Public/Bug/Display.html?id=115247#txn-1638708">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;16&nbsp;10:48:47&nbsp;2016</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1638735" href="/Public/Bug/Display.html?id=115247#txn-1638735">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;16&nbsp;12:41:23&nbsp;2016</span>
    <span class="description">MSCHOUT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1638735/878499/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/878499">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 67b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I have just uploaded v0.48 to CPAN which fixes this issue.

Thanks!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1638738" href="/Public/Bug/Display.html?id=115247#txn-1638738">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;16&nbsp;12:41:24&nbsp;2016</span>
    <span class="description">MSCHOUT [...] cpan.org -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1638767" href="/Public/Bug/Display.html?id=115247#txn-1638767">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;16&nbsp;13:13:47&nbsp;2016</span>
    <span class="description">DRZIGMAN [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1638767/878525/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/878525">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 350b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Greetings,

Excellent thinking ensuring you have backwards compatibility.  I&#39;m glad I was able to provide some assistance and thanks everyone for taking care of this so quickly!

I&#39;ve tested the 0.48 version and can confirm that it works as expected with Math::BigInt 1.999723 on perl 5.16.3.

Great work and thanks again!

Best Regards,
Robert Stone
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1640728" href="/Public/Bug/Display.html?id=115247#txn-1640728">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;21&nbsp;19:01:16&nbsp;2016</span>
    <span class="description">MSCHOUT [...] cpan.org -  Status changed from &#39;patched&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1640730" href="/Public/Bug/Display.html?id=115247#txn-1640730">#</a>      
    </span>
    <span class="date">Tue&nbsp;Jun&nbsp;21&nbsp;19:01:21&nbsp;2016</span>
    <span class="description">MSCHOUT [...] cpan.org -  Fixed in 0.48 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction links AddLink odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1643656" href="/Public/Bug/Display.html?id=115247#txn-1643656">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;30&nbsp;11:56:24&nbsp;2016</span>
    <span class="description">MSCHOUT [...] cpan.org -  Reference by ticket #115761 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1643667" href="/Public/Bug/Display.html?id=115247#txn-1643667">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;30&nbsp;12:02:47&nbsp;2016</span>
    <span class="description">MSCHOUT [...] cpan.org -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1643668" href="/Public/Bug/Display.html?id=115247#txn-1643668">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;30&nbsp;12:05:11&nbsp;2016</span>
    <span class="description">MSCHOUT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1643668/881480/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/881480">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 290b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">This fix is reportedly broke things on Debian 8.4

Possibly Debian patched an earlier version of Math::BigInt so _LEGACY_MATH_BIGINT is set to 1 when it shoudld be set to 0 there.

Haven&#39;t confirmed why its broken there yet.  Just noting here for investigation.

-- 
Regards,
Michael Schout
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1643882" href="/Public/Bug/Display.html?id=115247#txn-1643882">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jun&nbsp;30&nbsp;22:02:34&nbsp;2016</span>
    <span class="description">jpeacock [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1643882/881626/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/881626">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 533b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jun 30 12:05:11 2016, MSCHOUT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; This fix is reportedly broke things on Debian 8.4
</div>
In 1.99, the overloading of &lt;=&gt; was

  ref&#40;$_[0]&#41;-&gt;bcmp&#40;$_[0],$_[1]&#41;

which in 1.999719 changed to

  my $cmp = $_[0] -&gt; bcmp&#40;$_[1]&#41;;

which changes the signature of the bcmp&#40;&#41; sub in an incompatible way.  The former is a class method &#40;which matches what M::C has done all along&#41; and the latter is an object method.

I think the proposed change from Daniel to check the number of parameters is probably the best bet at this point.

John
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1643918" href="/Public/Bug/Display.html?id=115247#txn-1643918">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;01&nbsp;01:09:32&nbsp;2016</span>
    <span class="description">MSCHOUT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1643918/881648/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/881648">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 418b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jun 30 22:02:34 2016, JPEACOCK wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; In 1.99, the overloading of &lt;=&gt; was
&gt; 
&gt; ref&#40;$_[0]&#41;-&gt;bcmp&#40;$_[0],$_[1]&#41;
&gt; 
&gt; which in 1.999719 changed to
&gt; 
&gt; my $cmp = $_[0] -&gt; bcmp&#40;$_[1]&#41;;
</div>
Thanks John.

I understand whats going on here now.

I&#39;m going to mark this ticket resolved and work the proposed solution &#40;which solves both &lt;=&gt; overload and also bcmp&#40;&#41; usage&#41; in the other ticket.

-- 
Regards,
Michael Schout
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1643921" href="/Public/Bug/Display.html?id=115247#txn-1643921">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;01&nbsp;01:09:33&nbsp;2016</span>
    <span class="description">MSCHOUT [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.595069</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
