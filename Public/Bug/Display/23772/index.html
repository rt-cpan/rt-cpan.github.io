<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #23772 for Catalyst-Action-REST: Accept support finds the first defined serializer, not the first one that works.</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #23772 for Catalyst-Action-REST: Accept support finds the first defined serializer, not the first one that works.</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Catalyst-Action-REST">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Catalyst-Action-REST">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Catalyst-Action-REST">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Catalyst-Action-REST">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Catalyst-Action-REST">Catalyst-Action-REST CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">23772</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Catalyst-Action-REST">Catalyst-Action-REST</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">holoway [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
holoway [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-41594-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.30    </td>
  </tr>
  <tr id="CF-41595-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




Catalyst-Action-REST-0.50-Accept.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/386372/177324/Catalyst-Action-REST-0.50-Accept.patch">
Thu Nov 22 12:17:47 2007 (3.5k) by sjn [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=23772">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-270778" href="/Public/Bug/Display.html?id=23772#txn-270778">#</a>      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;04&nbsp;19:52:02&nbsp;2006</span>
    <span class="description">holoway [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Accept support finds the first defined serializer, not the first
 one that works.</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/270778/119099/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/119099">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 215b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">The Accept header support finds the first serizlier defined in the map;
not the first serializer that actually is capable of serializing something.

Fix likely involves re-factoring when we do the serialize request.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-372509" href="/Public/Bug/Display.html?id=23772#txn-372509">#</a>      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;18&nbsp;04:13:21&nbsp;2007</span>
    <span class="description">sjn [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> sjn [...] cpan.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/372509/169490/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/169490">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 979b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Man. 04. Des. 2006 19:52:02, HOLOWAY wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The Accept header support finds the first serizlier defined in the map;
&gt; not the first serializer that actually is capable of serializing
</div>something.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Fix likely involves re-factoring when we do the serialize request.
</div>
I&#39;ve found the same problem. Currently, C::R::REST prioritize the types
found in the Accept header as &#34;If it&#39;s mentioned first, we&#39;ll use that&#34;.
According to RFC2616 section 14.1, the Accept header handling should be
quite a bit more flexible.

Here&#39;s a suggestion for what to do about it:

1&#41; Add a configuration for secondary content-type priority, giving the
developer the option to prioritize when the client declines to do so.

2&#41; Use this priority list to establish a complete prioritization list,
and remove all content types the server isn&#39;t set up to handle. &#40;a quick
grep ought to work nicely.&#41;

All this should be possible to do in the
Catalyst::Request::REST::accepted_content_types method. :-&#41;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-372510" href="/Public/Bug/Display.html?id=23772#txn-372510">#</a>      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;18&nbsp;04:13:22&nbsp;2007</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-372542" href="/Public/Bug/Display.html?id=23772#txn-372542">#</a>      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;18&nbsp;05:14:15&nbsp;2007</span>
    <span class="description">sjn [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/372542/169518/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/169518">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 488b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tor. 18. Okt. 2007 04:13:21, sjn wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; 1&#41; Add a configuration for secondary content-type priority, giving the
&gt; developer the option to prioritize when the client declines to do so.
&gt; 
&gt; 2&#41; Use this priority list to establish a complete prioritization list,
&gt; and remove all content types the server isn&#39;t set up to handle. &#40;a quick
&gt; grep ought to work nicely.&#41;
</div>
Oh yay. I see this is basically what it says in the TODO file. I&#39;ll look
into doing something about it then. :-\
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-377237" href="/Public/Bug/Display.html?id=23772#txn-377237">#</a>      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;30&nbsp;21:23:02&nbsp;2007</span>
    <span class="description">adam [...] stalecoffee.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">CC:</td>
    <td class="message-header-value"> HOLOWAY [...] cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #23772] Accept support finds the first defined serializer, not the first one that works.</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 30 Oct 2007 18:22:46 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Catalyst-Action-REST [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Adam Jacob&#34; &lt;adam [...] stalecoffee.org&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/377237/172259/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/172259">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 716b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Yeah, a patch for fixing this would be gladly accepted.

On 10/18/07, Salve J. Nilsen via RT &lt;bug-Catalyst-Action-REST@rt.cpan.org&gt;
wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt;
&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="http://rt.cpan.org/Ticket/Display.html?id=23772">http://rt.cpan.org/Ticket/Display.html?id=23772</a></span> &gt;
&gt;
&gt; On Tor. 18. Okt. 2007 04:13:21, sjn wrote:
<div class="message-stanza open">&gt; &gt;
&gt; &gt; 1&#41; Add a configuration for secondary content-type priority, giving the
&gt; &gt; developer the option to prioritize when the client declines to do so.
&gt; &gt;
&gt; &gt; 2&#41; Use this priority list to establish a complete prioritization list,
&gt; &gt; and remove all content types the server isn&#39;t set up to handle. &#40;a quick
&gt; &gt; grep ought to work nicely.&#41;
</div>&gt;
&gt; Oh yay. I see this is basically what it says in the TODO file. I&#39;ll look
&gt; into doing something about it then. :-\
&gt;
&gt;
&gt;
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/377237/172260/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/172260">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.1k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-378755" href="/Public/Bug/Display.html?id=23772#txn-378755">#</a>      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;03&nbsp;21:02:41&nbsp;2007</span>
    <span class="description">claco [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> CLACO [...] cpan.org</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/378755/173101/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/173101">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 858b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Mon Dec 04 19:52:02 2006, HOLOWAY wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The Accept header support finds the first serizlier defined in the map;
&gt; not the first serializer that actually is capable of serializing
</div>something.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; Fix likely involves re-factoring when we do the serialize request.
</div>
On a somewhat related note, I think. Firefox accept lists text/xml
first, which matches because it&#39;s defined and installed. Of course, the
default key is set to something else, but is nver hit.

I think in the end, what&#39;s needed is a way to say use these mapped
types, and these only, and in this order. Sounds like he TODO is on that
path.

This seems esp. important when you start using REST on most actions that
also double as browser/html methods rather than just using REST to
expose a remote API. For now, an option is to simply remap those
unwanted content types to the default too.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-386372" href="/Public/Bug/Display.html?id=23772#txn-386372">#</a>      
    </span>
    <span class="date">Thu&nbsp;Nov&nbsp;22&nbsp;12:17:46&nbsp;2007</span>
    <span class="description">sjn [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/386372/177321/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/177321">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Lør. 03. Nov. 2007 21:02:41, CLACO wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Mon Dec 04 19:52:02 2006, HOLOWAY wrote:
<div class="message-stanza open">&gt; &gt; The Accept header support finds the first serizlier defined in
&gt; &gt; the map; not the first serializer that actually is capable of
&gt; &gt; serializing something.
&gt; &gt; 
&gt; &gt; Fix likely involves re-factoring when we do the serialize request.
</div>&gt; 
&gt; On a somewhat related note, I think. Firefox accept lists text/xml
&gt; first, which matches because it&#39;s defined and installed. Of course,
&gt; the default key is set to something else, but is nver hit.
&gt; 
&gt; I think in the end, what&#39;s needed is a way to say use these mapped
&gt; types, and these only, and in this order. Sounds like he TODO is on
&gt; that path.
&gt; 
&gt; This seems esp. important when you start using REST on most actions
&gt; that also double as browser/html methods rather than just using REST
&gt; to expose a remote API. For now, an option is to simply remap those
&gt; unwanted content types to the default too.
</div>
I&#39;ve added a naĩve patch that allows the server to set up it&#39;s own
content-type priority list which can be used to select one content type
when the client accepts several types, but weighted identically.

&#40;See Catalyst-Action-REST-0.50-Accept.patch for details. Not that this
priority list should be user-configurable, something the patch doesn&#39;t do.&#41;

Hope this helps in the right direction! :&#41;


- Salve
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/386372/177324/Catalyst-Action-REST-0.50-Accept.patch">Download Catalyst-Action-REST-0.50-Accept.patch</a><br />
<span class="downloadcontenttype">text/x-diff 3.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- lib/Catalyst/Request/REST.pm~	2007-03-09 21:44:54.000000000 +0100
+++ lib/Catalyst/Request/REST.pm	2007-10-22 15:59:24.000000000 +0200
@@ -80,15 +80,22 @@
 
     return $self-&gt;{content_types} if $self-&gt;{content_types};
 
-    my %types;
+    my %requested_types;
+    my %provided_types = &#40; # FIXME: Make configurable/reflect what&#39;s installed
+        &#39;text/html&#39; =&gt; 1,
+        &#39;application/xhtml+xml&#39; =&gt; 0.9,
+        &#39;text/xml&#39; =&gt; 0.8,
+        &#39;application/xml&#39; =&gt; 0.79,
+        &#39;image/png&#39; =&gt; 0.1,
+    &#41;;
 
     # First, we use the content type in the HTTP Request.  It wins all.
-    $types{ $self-&gt;content_type } = 3
+    $requested_types{ $self-&gt;content_type } = 3
         if $self-&gt;content_type;
 
     if &#40;$self-&gt;method eq &#34;GET&#34; &#38;&#38; $self-&gt;param&#40;&#39;content-type&#39;&#41;&#41; {
 
-        $types{ $self-&gt;param&#40;&#39;content-type&#39;&#41; } = 2;
+        $requested_types{ $self-&gt;param&#40;&#39;content-type&#39;&#41; } = 2;
     }
 
     # Third, we parse the Accept header, and see if the client
@@ -96,25 +103,25 @@
     #
     # This is taken from chansen&#39;s Apache2::UploadProgress.
     if &#40; $self-&gt;header&#40;&#39;Accept&#39;&#41; &#41; {
-        $self-&gt;accept_only&#40;1&#41; unless keys %types;
+        $self-&gt;accept_only&#40;1&#41; unless keys %requested_types;
 
         my $accept_header = $self-&gt;header&#40;&#39;Accept&#39;&#41;;
-        my $counter       = 0;
 
         foreach my $pair &#40; split_header_words&#40;$accept_header&#41; &#41; {
             my &#40; $type, $qvalue &#41; = @{$pair}[ 0, 3 ];
-            next if $types{$type};
+            next if $requested_types{$type};
 
-            unless &#40; defined $qvalue &#41; {
-                $qvalue = 1 - &#40; ++$counter / 1000 &#41;;
-            }
+            $qvalue = 1 unless defined $qvalue;
 
-            $types{$type} = sprintf&#40; &#39;%.3f&#39;, $qvalue &#41;;
+            $requested_types{$type} = sprintf&#40; &#39;%.1f&#39;, $qvalue &#41;;
         }
     }
 
     return $self-&gt;{content_types} =
-        [ sort { $types{$b} &lt;=&gt; $types{$a} } keys %types ];
+        [ sort {
+            $requested_types{$b} &lt;=&gt; $requested_types{$a} ||
+                $provided_types{$b} &lt;=&gt; $provided_types{$a}
+        } keys %requested_types ];
 }
 
 =item preferred_content_type
--- t/catalyst-request-rest.t	2007-03-09 21:28:30.000000000 +0100
+++ t/catalyst-request-rest.t	2007-10-22 16:06:50.000000000 +0200
@@ -66,15 +66,18 @@
     &#41;;
 
     is_deeply&#40; $request-&gt;accepted_content_types,
-               [ qw&#40; text/xml application/xml application/xhtml+xml
+               [ qw&#40;
+                     application/xhtml+xml
+                     text/xml
+                     application/xml
                      image/png
                      text/html
                      text/plain
                      */*
                    &#41; ],
                &#39;accept header is parsed properly&#39; &#41;;
-    is&#40; $request-&gt;preferred_content_type, &#39;text/xml&#39;,
-        &#39;preferred content type is text/xml&#39; &#41;;
+    is&#40; $request-&gt;preferred_content_type, &#39;application/xhtml+xml&#39;,
+        &#39;preferred content type is application/xhtml+xml&#39; &#41;;
     ok&#40; $request-&gt;accept_only, &#39;accept_only is true&#39; &#41;;
     ok&#40; $request-&gt;accepts&#40;&#39;text/html&#39;&#41;, &#39;accepts text/html&#39; &#41;;
     ok&#40; $request-&gt;accepts&#40;&#39;image/png&#39;&#41;, &#39;accepts image/png&#39; &#41;;
@@ -95,8 +98,11 @@
     &#41;;
 
     is_deeply&#40; $request-&gt;accepted_content_types,
-               [ qw&#40; text/x-json
-                     text/xml application/xml application/xhtml+xml
+               [ qw&#40;
+                     text/x-json
+                     application/xhtml+xml
+                     text/xml
+                     application/xml
                      image/png
                      text/html
                      text/plain
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1525173" href="/Public/Bug/Display.html?id=23772#txn-1525173">#</a>      
    </span>
    <span class="date">Thu&nbsp;Aug&nbsp;13&nbsp;03:15:33&nbsp;2015</span>
    <span class="description">perl [...] evancarroll.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1525173/813534/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/813534">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for the patch SJN. It&#39;ll probably sit here for another decade before you get feedback or acceptance. It&#39;s perl!

On Thu Nov 22 11:17:46 2007, sjn wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Lør. 03. Nov. 2007 21:02:41, CLACO wrote:
<div class="message-stanza open">&gt; &gt; On Mon Dec 04 19:52:02 2006, HOLOWAY wrote:
<div class="message-stanza open">&gt; &gt; &gt; The Accept header support finds the first serizlier defined in
&gt; &gt; &gt; the map; not the first serializer that actually is capable of
&gt; &gt; &gt; serializing something.
&gt; &gt; &gt; 
&gt; &gt; &gt; Fix likely involves re-factoring when we do the serialize request.
</div>&gt; &gt; 
&gt; &gt; On a somewhat related note, I think. Firefox accept lists text/xml
&gt; &gt; first, which matches because it&#39;s defined and installed. Of course,
&gt; &gt; the default key is set to something else, but is nver hit.
&gt; &gt; 
&gt; &gt; I think in the end, what&#39;s needed is a way to say use these mapped
&gt; &gt; types, and these only, and in this order. Sounds like he TODO is on
&gt; &gt; that path.
&gt; &gt; 
&gt; &gt; This seems esp. important when you start using REST on most actions
&gt; &gt; that also double as browser/html methods rather than just using REST
&gt; &gt; to expose a remote API. For now, an option is to simply remap those
&gt; &gt; unwanted content types to the default too.
</div>&gt; 
&gt; I&#39;ve added a naĩve patch that allows the server to set up it&#39;s own
&gt; content-type priority list which can be used to select one content type
&gt; when the client accepts several types, but weighted identically.
&gt; 
&gt; &#40;See Catalyst-Action-REST-0.50-Accept.patch for details. Not that this
&gt; priority list should be user-configurable, something the patch doesn&#39;t do.&#41;
&gt; 
&gt; Hope this helps in the right direction! :&#41;
&gt; 
&gt; 
&gt; - Salve
</div>

-- 
Evan Carroll
System Lord of the Internets
<span class="clickylink"><a target="new" rel="nofollow" href="http://www.evancarroll.com">http://www.evancarroll.com</a></span>
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.529931</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
