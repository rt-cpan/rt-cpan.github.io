<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #9160 for Statistics-Descriptive: Variance and Standard Deviation use costly pseudo-variance, instead of computing real variance</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #9160 for Statistics-Descriptive: Variance and Standard Deviation use costly pseudo-variance, instead of computing real variance</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Statistics-Descriptive/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Statistics-Descriptive/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Statistics-Descriptive/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Statistics-Descriptive/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Statistics-Descriptive">Statistics-Descriptive CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">9160</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Statistics-Descriptive/Active/">Statistics-Descriptive</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
tgape [...] comcast.net

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-29728-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-29729-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;26&nbsp;22:06:22&nbsp;2004</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Variance and Standard Deviation use costly pseudo-variance,
 instead of computing real variance</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The current Statistics::Descriptive package uses a pseudo-variance algorithm that was popularized many years ago, which was touted as being able to produce its number without all the datapoints, unlike real variance.  However, expanding out the variance sum, it&#39;s just as easy to calculate the real thing.

This patch reduces the cost of adding data points, it calculates true variance/standard deviation, and it allows for both variance computation methods &#40;although it only allows the more common for the basis of standard 
deviation&#41;.  As it caches the variance result, reading variance and 
standard deviation repeatedly per data point still results in a net 
performance improvement over the original.  Finally, it adds a clear 
method, which reduced the runtime of a particular program which uses 
this module far too heavily by around 2%.  &#40;This program spends about 
60% of its time in Statistics::Descriptive.&#41;

The basis for the change was simply expanding out the &#39;elegant form&#39; 
reported for computing variance, and finding out that the effective 
equation is actually significantly simpler than the &#39;elegant form&#39;.  
Specifically, we get, on the numerator &#40;denominator being trivial&#41;:

        sum of &#40;x&#40;n&#41;^2 - mean^2&#41;

        x&#40;1&#41;^2-mean^2+x&#40;2&#41;^2-mean^2+...+x&#40;n&#41;^2-mean^2

        x&#40;1&#41;^2+x&#40;2&#41;^2+...+x&#40;n&#41;^2 - n*mean^2

        &#40;sum of x&#40;n^2&#41; - n*mean^2

After that, it was simply a matter of applying all of the 
simplifications this allowed.  I have not added tests for this, but 
since there aren&#39;t already any standard deviation tests, it still 
passes the tests.

Ed
</div></div>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">--- Statistics-Descriptive-2.6/Descriptive.pm	2002/10/10 17:03:13	1.1
+++ Statistics-Descriptive-2.6/Descriptive.pm	2004/01/24 18:20:33	1.2
@@ -21,13 +21,12 @@
   count			=&gt; 0,
   mean			=&gt; 0,
   sum			=&gt; 0,
+  sumsq			=&gt; 0,
   variance		=&gt; undef,
-  pseudo_variance	=&gt; 0,
   min			=&gt; undef,
   max			=&gt; undef,
   mindex		=&gt; undef,
   maxdex		=&gt; undef,
-  standard_deviation	=&gt; undef,
   sample_range		=&gt; undef,
   &#41;;
 
@@ -45,7 +44,7 @@
 sub add_data {
   my $self = shift;  ##Myself
   my $oldmean;
-  my &#40;$min,$mindex,$max,$maxdex&#41;;
+  my &#40;$min,$mindex,$max,$maxdex,$sum,$sumsq,$count&#41;;
   my $aref;
 
   if &#40;ref $_[0] eq &#39;ARRAY&#39;&#41; {
@@ -55,41 +54,84 @@
     $aref = \@_;
   }
 
+  ##If we were given no data, we do nothing.
+  return 1 if &#40;!@{ $aref }&#41;;
+
   ##Take care of appending to an existing data set
   $min    = &#40;defined &#40;$self-&gt;{min}&#41; ? $self-&gt;{min} : $aref-&gt;[0]&#41;;
   $max    = &#40;defined &#40;$self-&gt;{max}&#41; ? $self-&gt;{max} : $aref-&gt;[0]&#41;;
   $maxdex = $self-&gt;{maxdex} || 0;
   $mindex = $self-&gt;{mindex} || 0;
+  $sum = $self-&gt;{sum};
+  $sumsq = $self-&gt;{sumsq};
+  $count = $self-&gt;{count};
 
-  ##Calculate new mean, pseudo-variance, min and max;
+  ##Calculate new mean, sumsq, min and max;
   foreach &#40; @{ $aref } &#41; {
-    $oldmean = $self-&gt;{mean};
-    $self-&gt;{sum} += $_;
-    $self-&gt;{count}++;
+    $sum += $_;
+    $sumsq += $_**2;
+    $count++;
     if &#40;$_ &gt;= $max&#41; {
       $max = $_;
-      $maxdex = $self-&gt;{count}-1;
+      $maxdex = $count-1;
     }
     if &#40;$_ &lt;= $min&#41; {
       $min = $_;
-      $mindex = $self-&gt;{count}-1;
+      $mindex = $count-1;
     }
-    $self-&gt;{mean} += &#40;$_ - $oldmean&#41; / $self-&gt;{count};
-    $self-&gt;{pseudo_variance} += &#40;$_ - $oldmean&#41; * &#40;$_ - $self-&gt;{mean}&#41;;
   }
 
   $self-&gt;{min}          = $min;
   $self-&gt;{mindex}       = $mindex;
   $self-&gt;{max}          = $max;
   $self-&gt;{maxdex}       = $maxdex;
-  $self-&gt;{sample_range} = $self-&gt;{max} - $self-&gt;{min};
-  if &#40;$self-&gt;{count} &gt; 1&#41; {
-    $self-&gt;{variance}     = $self-&gt;{pseudo_variance} / &#40;$self-&gt;{count} -1&#41;;
-    $self-&gt;{standard_deviation}  = sqrt&#40; $self-&gt;{variance}&#41;;
-  }
+  $self-&gt;{sample_range} = $max - $min;
+  $self-&gt;{sum}		= $sum;
+  $self-&gt;{sumsq}	= $sumsq;
+  $self-&gt;{mean}		= $sum / $count;
+  $self-&gt;{count}	= $count;
+  ##indicator the value is not cached.  Variance isn&#39;t commonly enough
+  ##used to recompute every single data add.
+  $self-&gt;{variance}	= undef;
   return 1;
 }
 
+sub standard_deviation {
+  my $self = shift;  ##Myself
+  return undef if &#40;!$self-&gt;{count}&#41;;
+  return sqrt&#40;variance&#40;$self&#41;&#41;;
+}
+
+##Return variance; if needed, compute and cache it.
+sub variance {
+  my $self = shift;  ##Myself
+  my $div = @_ ? 0 : 1;
+  my $count = $self-&gt;{count};
+  if &#40;$count &lt; 1 + $div&#41; {
+      return 0;
+  }
+
+  my $variance = $self-&gt;{variance};
+  if &#40;!defined&#40;$variance&#41;&#41; {
+    $variance = &#40;$self-&gt;{sumsq} - $count * $self-&gt;{mean}**2&#41;;
+    $variance /= $count - $div;
+    $self-&gt;{variance} = $variance;
+  }
+  return $variance;
+}
+
+##Clear a stat.  More efficient than destroying an object and calling
+##new.
+sub clear {
+  my $self = shift;  ##Myself
+  my $key;
+
+  return if &#40;!$self-&gt;{count}&#41;;
+  while &#40;my&#40;$field, $value&#41; = each %fields&#41; {
+    $self-&gt;{$field} = $value;
+  }
+}
+
 sub AUTOLOAD {
   my $self = shift;
   my $type = ref&#40;$self&#41;
@@ -135,6 +177,27 @@
   return $self;
 }
 
+##Clear a stat.  More efficient than destroying an object and calling
+##new.
+sub clear {
+  my $self = shift;  ##Myself
+  my $key;
+
+  return if &#40;!$self-&gt;{count}&#41;;
+  foreach $key &#40;keys %{ $self }&#41; { # Check each key in the object
+    # If it&#39;s a reserved key for this class, keep it
+    next if exists $self-&gt;{&#39;_reserved&#39;}-&gt;{$key};
+    # If it comes from the base class, keep it
+    next if exists $self-&gt;{&#39;_permitted&#39;}-&gt;{$key};
+    delete $self-&gt;{$key};          # Delete the out of date cached key
+  }
+  $self-&gt;SUPER::clear&#40;&#41;;
+  if &#40;exists&#40;$self-&gt;{data}&#41;&#41; {
+    $self-&gt;{data} = [];
+    $self-&gt;{presorted} = 0;
+  }
+}
+
 sub add_data {
   my $self = shift;
   my $key;
@@ -466,6 +529,16 @@
 =item $stat = Statistics::Descriptive::Sparse-&gt;new&#40;&#41;;
 
 Create a new sparse statistics object.
+
+=item $stat-&gt;clear&#40;&#41;;
+
+Effectively the same as
+
+  my $class = ref&#40;$stat&#41;;
+  undef $stat;
+  $stat = new $class;
+
+except more efficient.
 
 =item $stat-&gt;add_data&#40;1,2,3&#41;;
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Mon&nbsp;Dec&nbsp;27&nbsp;17:35:36&nbsp;2004</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> tgape [...] comcast.net</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">[guest - Sun Dec 26 22:06:22 2004]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; The current Statistics::Descriptive package uses a pseudo-variance
&gt;    algorithm that was popularized many years ago, which was touted as
&gt;    being able to produce its number without all the datapoints, unlike
&gt;    real variance.  However, expanding out the variance sum, it&#39;s just
&gt;    as easy to calculate the real thing.
</div>
Back before I first created this patch, I had noticed a skew in standard
deviation reported by a program which makes massive use of this package.
 I did not think of creating a test case at that time, because I could
simply run my program with a particular dataset which demonstrated the
issue fairly well.  For some time, I ran both the 2.6 version and my
version in parallel, and saw that the deviations were different.

Since submitting this patch here, I&#39;ve been trying to reproduce the
issue, and I cannot.  I&#39;m therefore thinking this is not quite so
important - especially since my analytic review isn&#39;t showing a
difference either.  I&#39;m now wondering if it was a case of an expanding
rounding error.

My version does still work more efficiently, but as a mere optimization,
this would have a fairly low priority.

If I can reproduce the error, I&#39;ll submit a test case for it.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Aug&nbsp;27&nbsp;21:22:33&nbsp;2005</span>
    <span class="description">Guest -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> tgape [...] comcast.net</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The variance calculation in Statistics::Descriptive is actually correct,
even if it is a bit more expensive.  However, it is subject to a
propogated rounding error, as it loses the original numbers.  The
simplified algorithm does not suffer from this issue.

My difficulty in reproducing the problem was that I had since upgraded
systems, and the newer system did not have the same rounding error of
the prior system.

It would still be nice to get the performance improvements of the patch.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;03&nbsp;06:40:58&nbsp;2009</span>
    <span class="description">SHLOMIF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">The patch was applied in the trunk, thanks.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;03&nbsp;06:40:59&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;03&nbsp;06:41:01&nbsp;2009</span>
    <span class="description">SHLOMIF [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;18&nbsp;19:08:00&nbsp;2011</span>
    <span class="description">LGEHLEN [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hello Shlomi, Hello Ed,
I am not sure if reopening the ticket is the right way to go about this,
but I would certainly like to bring my concern about this issue to your
attention.

I do not agree with this patch. The problem with the current formula is
that it is - albeit a bit cheaper - numerically very unstable. The
problem is that the sum of x**2 and n*mean**2 can both get very big.
Therefore, the variance is a possibly small difference of two possibly
very big numbers and might therefore get very imprecise, even 0 due to
numerical instability.

Consider a not at all unrealistic example where the values are around
1,000,000, but fluctuate to a much smaller degree. Then the values of
x**2 are around 10**12, if you add 1000 values, the sum is around
10**15. However, if the standard deviation is 1% - which is certainly
something you would like to detect - then the variance is 10**8 which is
7 orders of magnitude smaller then the values you subtract from each other.

I have had a quick look at version 2.6. I have not verified that it does
exactly the right thing, but it is clear that the algorithm in there
remedies this numerical instability by using differences to the current
estimate of the mean.

Best wishes,
Lutz
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Nov&nbsp;18&nbsp;19:08:01&nbsp;2011</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;19&nbsp;02:10:02&nbsp;2011</span>
    <span class="description">SHLOMIF [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi LGEHLEN,

On Fri Nov 18 19:08:00 2011, LGEHLEN wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hello Shlomi, Hello Ed,
&gt; I am not sure if reopening the ticket is the right way to go about this,
</div>
It is not.

Please file a new bug and provide a test case &#40;and preferably also a
patch&#41; and some direction. I&#39;m resolving this bug - please file a new
bug instead of commenting.

Also see:

<span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Public/Bug/Display.html?id=66712">https://rt.cpan.org/Public/Bug/Display.html?id=66712</a></span>

Regards,

-- Shlomi Fish 

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; but I would certainly like to bring my concern about this issue to your
&gt; attention.
</div>


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; I do not agree with this patch. The problem with the current formula is
&gt; that it is - albeit a bit cheaper - numerically very unstable. The
&gt; problem is that the sum of x**2 and n*mean**2 can both get very big.
&gt; Therefore, the variance is a possibly small difference of two possibly
&gt; very big numbers and might therefore get very imprecise, even 0 due to
&gt; numerical instability.
&gt; 
&gt; Consider a not at all unrealistic example where the values are around
&gt; 1,000,000, but fluctuate to a much smaller degree. Then the values of
&gt; x**2 are around 10**12, if you add 1000 values, the sum is around
&gt; 10**15. However, if the standard deviation is 1% - which is certainly
&gt; something you would like to detect - then the variance is 10**8 which is
&gt; 7 orders of magnitude smaller then the values you subtract from each
</div>other.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; I have had a quick look at version 2.6. I have not verified that it does
&gt; exactly the right thing, but it is clear that the algorithm in there
&gt; remedies this numerical instability by using differences to the current
&gt; estimate of the mean.
&gt; 
&gt; Best wishes,
&gt; Lutz
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;Nov&nbsp;19&nbsp;02:10:03&nbsp;2011</span>
    <span class="description">SHLOMIF [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
