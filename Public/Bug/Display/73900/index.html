<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #73900 for XML-Twig: Wishlist: start building a new XML without set_root</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #73900 for XML-Twig: Wishlist: start building a new XML without set_root</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/XML-Twig/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/XML-Twig/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/XML-Twig/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/XML-Twig/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/XML-Twig">XML-Twig CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">73900</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/XML-Twig/Active/">XML-Twig</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
ambrus [...] math.bme.hu

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-37682-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-37683-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;11&nbsp;09:32:40&nbsp;2012</span>
    <span class="description">ambrus [...] math.bme.hu -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Wishlist: start building a new XML without set_root</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 11 Jan 2012 15:31:52 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-Twig [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Zsb√°n Ambrus &lt;ambrus [...] math.bme.hu&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">After replying to a perlmonks question, I was again wondering on how
to build new XML documents from scratch with XML::Twig.  In this
report, I&#39;d like to brainstorm some ideas on how we could make this
easier.

So, in &#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://www.perlmonks.com/?node_id=947349">http://www.perlmonks.com/?node_id=947349</a></span>&#34;, I describe that
there are two different ways you can build a new XML document: from
the inside &#40;preorder&#41; or from the outside &#40;postorder&#41;.  Either of
these are supported by Twig, as are more complicated orders.  Let&#39;s
look at this example code.

use XML::Twig;
{ # from the inside
    my $para1text1 = &#34;There are two ways to build XML with &#34;;
    my $moduletext = &#34;Twig&#34;;
    my $module     = XML::Twig::Elt-&gt;new&#40;&#34;a&#34;, {&#34;href&#34; =&gt;
&#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://mirod.org/">http://mirod.org/</a></span>&#34;}, $moduletext&#41;;
    my $para1text2 = &#34;: &#34;;
    my $para1      = XML::Twig::Elt-&gt;new&#40;&#34;p&#34;, $para1text1, $module,
$para1text2&#41;;
    my $para2text  = &#34;from the inside and from outside.&#34;;
    my $para2      = XML::Twig::Elt-&gt;new&#40;&#34;p&#34;, $para2text&#41;;
    my $root       = XML::Twig::Elt-&gt;new&#40;&#34;saying&#34;, $para1, $para2&#41;;
    my $twig       = XML::Twig-&gt;new&#40;pretty_print =&gt; &#34;nice&#34;&#41;;
$twig-&gt;set_root&#40;$root&#41;;
    $twig-&gt;flush&#40;*STDOUT&#41;;
}
{ # from the outside
    my $twig = XML::Twig-&gt;new&#40;pretty_print =&gt; &#34;nice&#34;&#41;;
    my $root = XML::Twig::Elt-&gt;new&#40;&#34;saying&#34;&#41;; $twig-&gt;set_root&#40;$root&#41;;
    my $para1 = $root-&gt;insert_new_elt&#40;last_child =&gt; &#34;p&#34;&#41;;
    $para1-&gt;suffix&#40;&#34;There are two ways to build XML with &#34;&#41;;
    my $module = $para1-&gt;insert_new_elt&#40;last_child =&gt; &#34;a&#34;,
        {&#34;href&#34; =&gt; &#34;<span class="clickylink"><a target="new" rel="nofollow" href="http://mirod.org/">http://mirod.org/</a></span>&#34;}&#41;;
    $module-&gt;suffix&#40;&#34;Twig&#34;&#41;;
    $para1-&gt;suffix&#40;&#34;: &#34;&#41;;
    my $para2 = $root-&gt;insert_new_elt&#40;last_child =&gt; &#34;p&#34;&#41;;
    $para2-&gt;suffix&#40;&#34;from the inside and from outside.&#34;&#41;;
    $twig-&gt;flush&#40;*STDOUT&#41;;
}

IMO, the ugliest part of _both_ of these code is the set_root
function.  It seems to me from the documentation that there&#39;s no way
to avoid the set_root function, despite that it does not really match
the style of _either_ of these two orders.

In the first case, when you&#39;re building the tree from the inside,
we&#39;re avoiding to call paste methods by passing the contents of each
element to the constructor call of that element.  This works for all
elements but not for the twig itself.  Wouldn&#39;t it be nicer if instead
of

    my $twig       = XML::Twig-&gt;new&#40;pretty_print =&gt; &#34;nice&#34;&#41;;
$twig-&gt;set_root&#40;$root&#41;;

we could just write

    my $twig       = XML::Twig-&gt;new&#40;pretty_print =&gt; &#34;nice&#34;, root =&gt; $root&#41;;

as a shortcut?

In the second case, when building the tree from the inside, we avoid
calling element constructors by calling the shortcut method
insert_new_elt.  Again, this shortcut doesn&#39;t work for the twig
itself.  Wouldn&#39;t it be nice if instead of

    my $root = XML::Twig::Elt-&gt;new&#40;&#34;saying&#34;&#41;; $twig-&gt;set_root&#40;$root&#41;;

we could just write something like

    $twig-&gt;insert_root_elt&#40;&#34;saying&#34;&#41;;

as a shortcut &#40;where this method would also accept an optional hashref
of attributes and a list of contents&#41;?  That would make the code more
uniform.

&#40;Incidentally, is there a method to query the element class of a twig,
as set by the option elt_class?  I think there should be, so that one
can implement a sub that takes a twig and behaves like the parse_html
method but parses something different.   However, there does not seem
to be such a method documented.&#41;

Finally, a minor point.  Perhaps think XML::Twig::Elt should have an
insert_text method that behaves like the suffix method but takes a
position argument like insert_new_elt.  That is,
$elt-&gt;insert_text&#40;$position, $text&#41; would be like
$elt-&gt;insert_new_elt&#40;$position, &#34;#PCDATA&#34;, $text&#41; except that it tries
to combine the text with adjacent text elements.

Tell me what you think of all these.  I don&#39;t promise to implement
anything, but it could happen.

Ambrus
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;11&nbsp;10:03:13&nbsp;2012</span>
    <span class="description">xmltwig [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #73900] Wishlist: start building a new XML without set_root</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 11 Jan 2012 16:02:15 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-XML-Twig [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> mirod &lt;xmltwig [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 01/11/2012 03:32 PM, ambrus@math.bme.hu via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; IMO, the ugliest part of _both_ of these code is the set_root
&gt; function.  It seems to me from the documentation that there&#39;s no way
&gt; to avoid the set_root function, despite that it does not really match
&gt; the style of _either_ of these two orders.
</div>
OK. I don&#39;t see this as really a problem, but why not. I am not going to 
start policing the number of methods in the module ;--&#41;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; In the first case, when you&#39;re building the tree from the inside,
&gt; we&#39;re avoiding to call paste methods by passing the contents of each
&gt; element to the constructor call of that element.  This works for all
&gt; elements but not for the twig itself.  Wouldn&#39;t it be nicer if instead
&gt; of
&gt;
&gt;      my $twig       = XML::Twig-&gt;new&#40;pretty_print =&gt;  &#34;nice&#34;&#41;;
&gt; $twig-&gt;set_root&#40;$root&#41;;
&gt;
&gt; we could just write
&gt;
&gt;      my $twig       = XML::Twig-&gt;new&#40;pretty_print =&gt;  &#34;nice&#34;, root =&gt;  $root&#41;;
&gt;
&gt; as a shortcut?
</div>
In this case, you could also write XML::Twig-&gt;new-&gt;parse&#40; &#39;&lt;saying/&gt;&#39;&#41;;
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; In the second case, when building the tree from the inside, we avoid
&gt; calling element constructors by calling the shortcut method
&gt; insert_new_elt.  Again, this shortcut doesn&#39;t work for the twig
&gt; itself.  Wouldn&#39;t it be nice if instead of
&gt;
&gt;      my $root = XML::Twig::Elt-&gt;new&#40;&#34;saying&#34;&#41;; $twig-&gt;set_root&#40;$root&#41;;
&gt;
&gt; we could just write something like
&gt;
&gt;      $twig-&gt;insert_root_elt&#40;&#34;saying&#34;&#41;;
&gt;
&gt; as a shortcut &#40;where this method would also accept an optional hashref
&gt; of attributes and a list of contents&#41;?  That would make the code more
&gt; uniform.
</div>
Implementation would be to call XML::Twig-&gt;set_root&#40; 
XML::Twig-&gt;{twig_elt_class}-&gt;new&#40; @_&#41;&#41; so the arguments would be 
strictly identical to new and insert_new_elt

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#40;Incidentally, is there a method to query the element class of a twig,
&gt; as set by the option elt_class?  I think there should be, so that one
&gt; can implement a sub that takes a twig and behaves like the parse_html
&gt; method but parses something different.   However, there does not seem
&gt; to be such a method documented.&#41;
</div>
The value of elt_class is stored in $t-&gt;{twig_elt_class}. It&#39;s not 
documented but it&#39;s very unlikely to change. I am not sure I understand 
the use case though.
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Finally, a minor point.  Perhaps think XML::Twig::Elt should have an
&gt; insert_text method that behaves like the suffix method but takes a
&gt; position argument like insert_new_elt.  That is,
&gt; $elt-&gt;insert_text&#40;$position, $text&#41; would be like
&gt; $elt-&gt;insert_new_elt&#40;$position, &#34;#PCDATA&#34;, $text&#41; except that it tries
&gt; to combine the text with adjacent text elements.
</div>
OK. I am not sure why this method doesn&#39;t exist yet.

Let me know if you plan to add those, otherwise I&#39;ll look into doing it 
in the near future.

Thanks

-- 
mirod
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;11&nbsp;10:03:14&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
