<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #79676 for Queue-DBI: notes &#38;&#38; errors in Queue::DBI::Admin</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #79676 for Queue-DBI: notes &#38;&#38; errors in Queue::DBI::Admin</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Queue-DBI">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Queue-DBI">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Queue-DBI">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Queue-DBI">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/guillaumeaubert/Queue-DBI/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/Queue-DBI">Queue-DBI CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">79676</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Queue-DBI">Queue-DBI</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
bond-spb [...] mail.ru

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-241700-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-241701-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=79676">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1120555" href="/Public/Bug/Display.html?id=79676#txn-1120555">#</a>      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;16&nbsp;13:42:29&nbsp;2012</span>
    <span class="description">bond-spb [...] mail.ru -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> notes &#38;&#38; errors in Queue::DBI::Admin</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 16 Sep 2012 21:43:14 +0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-queue-dbi [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Сергей Бондаренко &lt;bond-spb [...] mail.ru&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1120555/589486/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/589486">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 891b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">1. DB constraints/indexes naming convention
I suggest next scheme:
idx_&lt;table_name&gt;_&lt;field_name&gt; for indexes
unq_&lt;table_name&gt;_&lt;field_name&gt; for unique indexes
fk_&lt;table_name&gt;_&lt;field_name&gt; for foreign constraints

see:
line 181
line 228
line 229 


2. Error in fk constraint definition &#40;line 229&#41;

2.1 non unique fk constraint name error when creating more when one queue table pairs &#40;using suggested naming convention will solve this&#41;
2.2 ...REFERENCES `queues`... - replace with real table name from &#39;queues_table_name&#39;


3. create_tables &#39;sqlite&#39; parameter &#40;line 131&#41;
Are you really need this param?
Using $dbh-&gt;{Driver}-&gt;{Name} or better $dbh-&gt;get_info&#40;&#41;  you can get current db name and croak something like &#34;Only sqlite and mysql supported for now&#34;.
And you can simply extend module for pgsql, mssql, etc in future


4. Don&#39;t forget to list supported databases in POD please.


BR
Sergey
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1120555/589487/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/589487">with headers</a>
<br />
<span class="downloadcontenttype">text/html 2.4k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1121038" href="/Public/Bug/Display.html?id=79676#txn-1121038">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;18&nbsp;00:12:14&nbsp;2012</span>
    <span class="description">AUBERTG [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1121038/589758/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/589758">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.5k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Sergey,

All excellent points! Regarding &#40;3&#41;, I&#39;m already using this in
Audit::DBI so it was an easy fix.

I also fixed the order in which tables are dropped by create_tables&#40;&#41;,
since they need to be dropped in reverse creation order.

I&#39;ve released v2.2.0 with the changes. I&#39;ve done some basic MySQL
testing, but I&#39;m going to see if I can rearchitect the tests to run both
for SQLite and for MySQL at some point. In the meantime, please let me
know what you think!

Thank you as always for your great feedback,

Guillaume

On Sun Sep 16 13:42:29 2012, bond-spb@mail.ru wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 1. DB constraints/indexes naming convention
&gt; I suggest next scheme:
&gt; idx_&lt;table_name&gt;_&lt;field_name&gt; for indexes
&gt; unq_&lt;table_name&gt;_&lt;field_name&gt; for unique indexes
&gt; fk_&lt;table_name&gt;_&lt;field_name&gt; for foreign constraints
&gt; 
&gt; see:
&gt; line 181
&gt; line 228
&gt; line 229
&gt; 
&gt; 
&gt; 2. Error in fk constraint definition &#40;line 229&#41;
&gt; 
&gt; 2.1 non unique fk constraint name error when creating more when one
&gt; queue table pairs &#40;using suggested naming convention will solve this&#41;
&gt; 2.2 ...REFERENCES `queues`... - replace with real table name from
&gt; &#39;queues_table_name&#39;
&gt; 
&gt; 
&gt; 3. create_tables &#39;sqlite&#39; parameter &#40;line 131&#41;
&gt; Are you really need this param?
&gt; Using $dbh-&gt;{Driver}-&gt;{Name} or better $dbh-&gt;get_info&#40;&#41;  you can get
&gt; current db name and croak something like &#34;Only sqlite and mysql
&gt; supported for now&#34;.
&gt; And you can simply extend module for pgsql, mssql, etc in future
&gt; 
&gt; 
&gt; 4. Don&#39;t forget to list supported databases in POD please.
&gt; 
&gt; 
&gt; BR
&gt; Sergey
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1121040" href="/Public/Bug/Display.html?id=79676#txn-1121040">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;18&nbsp;00:12:14&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1122517" href="/Public/Bug/Display.html?id=79676#txn-1122517">#</a>      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;23&nbsp;12:01:16&nbsp;2012</span>
    <span class="description">bond-spb [...] mail.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #79676] notes &#38;&#38; errors in Queue::DBI::Admin </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 23 Sep 2012 20:02:10 +0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Queue-DBI [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Сергей Бондаренко &lt;bond-spb [...] mail.ru&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1122517/590573/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/590573">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Guillaume,
Thanks for your module improvements and please look at new remarks:

1. You need to add croak with dbi error after any $database_handle-&gt;do in 
Admin.pm just like line 328

2. For completeness of the Admin interface I suggest two additional 
functions: drop_tables&#40;&#41; and has_tables&#40;&#41;. It will be convenient for 
install/uninstall scripts. What you think?

3. You forgot to describe return value in POD for purge&#40;&#41; function &#40;DBI.pm&#41;

BR
Sergey

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">----- Original Message ----- 
From: &#34;Guillaume B. Aubert via RT&#34; &lt;bug-Queue-DBI@rt.cpan.org&gt;
To: &lt;bond-spb@mail.ru&gt;
Sent: Tuesday, September 18, 2012 8:12 AM
Subject: [rt.cpan.org #79676] notes &#38;&#38; errors in Queue::DBI::Admin


<div class="message-stanza open">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=79676">https://rt.cpan.org/Ticket/Display.html?id=79676</a></span> &gt;
&gt;
&gt; Hi Sergey,
&gt;
&gt; All excellent points! Regarding &#40;3&#41;, I&#39;m already using this in
&gt; Audit::DBI so it was an easy fix.
&gt;
&gt; I also fixed the order in which tables are dropped by create_tables&#40;&#41;,
&gt; since they need to be dropped in reverse creation order.
&gt;
&gt; I&#39;ve released v2.2.0 with the changes. I&#39;ve done some basic MySQL
&gt; testing, but I&#39;m going to see if I can rearchitect the tests to run both
&gt; for SQLite and for MySQL at some point. In the meantime, please let me
&gt; know what you think!
&gt;
&gt; Thank you as always for your great feedback,
&gt;
&gt; Guillaume
&gt;
&gt; On Sun Sep 16 13:42:29 2012, bond-spb@mail.ru wrote:
<div class="message-stanza open">&gt;&gt; 1. DB constraints/indexes naming convention
&gt;&gt; I suggest next scheme:
&gt;&gt; idx_&lt;table_name&gt;_&lt;field_name&gt; for indexes
&gt;&gt; unq_&lt;table_name&gt;_&lt;field_name&gt; for unique indexes
&gt;&gt; fk_&lt;table_name&gt;_&lt;field_name&gt; for foreign constraints
&gt;&gt;
&gt;&gt; see:
&gt;&gt; line 181
&gt;&gt; line 228
&gt;&gt; line 229
&gt;&gt;
&gt;&gt;
&gt;&gt; 2. Error in fk constraint definition &#40;line 229&#41;
&gt;&gt;
&gt;&gt; 2.1 non unique fk constraint name error when creating more when one
&gt;&gt; queue table pairs &#40;using suggested naming convention will solve this&#41;
&gt;&gt; 2.2 ...REFERENCES `queues`... - replace with real table name from
&gt;&gt; &#39;queues_table_name&#39;
&gt;&gt;
&gt;&gt;
&gt;&gt; 3. create_tables &#39;sqlite&#39; parameter &#40;line 131&#41;
&gt;&gt; Are you really need this param?
&gt;&gt; Using $dbh-&gt;{Driver}-&gt;{Name} or better $dbh-&gt;get_info&#40;&#41;  you can get
&gt;&gt; current db name and croak something like &#34;Only sqlite and mysql
&gt;&gt; supported for now&#34;.
&gt;&gt; And you can simply extend module for pgsql, mssql, etc in future
&gt;&gt;
&gt;&gt;
&gt;&gt; 4. Don&#39;t forget to list supported databases in POD please.
&gt;&gt;
&gt;&gt;
&gt;&gt; BR
&gt;&gt; Sergey
</div>&gt;
&gt;
&gt;
&gt; 
</div></div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1122670" href="/Public/Bug/Display.html?id=79676#txn-1122670">#</a>      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;23&nbsp;22:57:29&nbsp;2012</span>
    <span class="description">AUBERTG [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1122670/590645/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/590645">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 892b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Sergey,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 1. You need to add croak with dbi error after any $database_handle-&gt;do in 
&gt; Admin.pm just like line 328
</div>
Indeed!
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/guillaumeaubert/Queue-DBI/commit/bf5e86ba2d7e0d692ead3749e0c54b02f4ef34cc">https://github.com/guillaumeaubert/Queue-DBI/commit/bf5e86ba2d7e0d692ead3749e0c54b02f4ef34cc</a></span>

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 2. For completeness of the Admin interface I suggest two additional 
&gt; functions: drop_tables&#40;&#41; and has_tables&#40;&#41;. It will be convenient for 
&gt; install/uninstall scripts. What you think?
</div>
It&#39;s a great idea, and it should simplify the create_tables&#40;&#41; function.
I&#39;ll work on it sometime this week.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 3. You forgot to describe return value in POD for purge&#40;&#41; function
</div>&#40;DBI.pm&#41;

Good catch!
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/guillaumeaubert/Queue-DBI/commit/8d36c7143304e978acb0fcab1b39f78d54d7e3e3">https://github.com/guillaumeaubert/Queue-DBI/commit/8d36c7143304e978acb0fcab1b39f78d54d7e3e3</a></span>

Would you like me to release a separate v2.2.2 for the fixes in &#40;1&#41; and
&#40;3&#41;? Otherwise, I will bundle them into v2.3.0 with the new features in &#40;2&#41;.

Thank you as always! Best,

Guillaume
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1122716" href="/Public/Bug/Display.html?id=79676#txn-1122716">#</a>      
    </span>
    <span class="date">Mon&nbsp;Sep&nbsp;24&nbsp;05:01:13&nbsp;2012</span>
    <span class="description">bond-spb [...] mail.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #79676] notes &#38;&#38; errors in Queue::DBI::Admin </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Mon, 24 Sep 2012 13:02:09 +0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Queue-DBI [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Сергей Бондаренко &lt;bond-spb [...] mail.ru&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1122716/590670/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/590670">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 206b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Guillaume,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Would you like me to release a separate v2.2.2 for the fixes in &#40;1&#41; and
&gt; &#40;3&#41;? Otherwise, I will bundle them into v2.3.0 with the new features in 
&gt; &#40;2&#41;.
</div>
Do as you comfortably

BR
Sergey
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1123084" href="/Public/Bug/Display.html?id=79676#txn-1123084">#</a>      
    </span>
    <span class="date">Tue&nbsp;Sep&nbsp;25&nbsp;11:29:09&nbsp;2012</span>
    <span class="description">AUBERTG [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1123084/590881/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/590881">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 330b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Sergey,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; Would you like me to release a separate v2.2.2 for the fixes in &#40;1&#41; and
&gt; &gt; &#40;3&#41;? Otherwise, I will bundle them into v2.3.0 with the new features in 
&gt; &gt; &#40;2&#41;.
</div>&gt; 
&gt; Do as you comfortably
</div>
Thank you, I just released v2.3.0 with the fixes and the features in
&#40;2&#41;. Please let me know what you think!

Best,

Guillaume
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1124384" href="/Public/Bug/Display.html?id=79676#txn-1124384">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;28&nbsp;17:10:04&nbsp;2012</span>
    <span class="description">bond-spb [...] mail.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #79676] notes &#38;&#38; errors in Queue::DBI::Admin </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 29 Sep 2012 01:11:11 +0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Queue-DBI [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Сергей Бондаренко &lt;bond-spb [...] mail.ru&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1124384/591512/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/591512">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 581b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Guillaume,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Thank you, I just released v2.3.0 with the fixes and the features in
&gt; &#40;2&#41;. Please let me know what you think!
</div>
1. Please add
local $database_handle-&gt;{&#39;RaiseError&#39;} = 1;
after lines 353, 374, Admin.pm
otherwise connecting db with &#39;RaiseError&#39;=0 will result wrong return of 
has_tables&#40;&#41; function

2. Seems you need replace
&#34;select *&#34; to &#34;select queue_id, name&#34; line358
&#34;select *&#34; to &#34;select queue_element_id, queue_id, data, lock_time, 
requeue_count, created&#34; line379
to ensure has_tables&#40;&#41; the real queue tables, but not arbitrary existing 
tables


BR
Sergey 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1124590" href="/Public/Bug/Display.html?id=79676#txn-1124590">#</a>      
    </span>
    <span class="date">Sat&nbsp;Sep&nbsp;29&nbsp;19:13:27&nbsp;2012</span>
    <span class="description">AUBERTG [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1124590/591621/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/591621">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Sergey,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 1. Please add
&gt; local $database_handle-&gt;{&#39;RaiseError&#39;} = 1;
&gt; after lines 353, 374, Admin.pm
&gt; otherwise connecting db with &#39;RaiseError&#39;=0 will result wrong return of 
&gt; has_tables&#40;&#41; function
</div>
Very good point - fixed in
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/guillaumeaubert/Queue-DBI/commit/3abe2708339900ea0ccf393c29a97f89a69a1d61">https://github.com/guillaumeaubert/Queue-DBI/commit/3abe2708339900ea0ccf393c29a97f89a69a1d61</a></span>

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 2. Seems you need replace
&gt; &#34;select *&#34; to &#34;select queue_id, name&#34; line358
&gt; &#34;select *&#34; to &#34;select queue_element_id, queue_id, data, lock_time, 
&gt; requeue_count, created&#34; line379
&gt; to ensure has_tables&#40;&#41; the real queue tables, but not arbitrary existing 
&gt; tables
</div>
I&#39;ve been wondering about this. My concern is that if has_tables&#40;&#41;
returns 0, people will expect to be able to call create_tables&#40;&#41;. But
create_tables&#40;&#41; will fail if:
a&#41; one table exists but not the other; or
b&#41; the tables exists but the return of 0 was due to incorrect fields.

Would it make sense to have the following logic for has_tables&#40;&#41;:
a&#41; If both tables exist and have the right fields, return 1;
b&#41; If both tables don&#39;t exist, return 0;
c&#41; If one table exists but not the other, croak with &#39;Table &#34;table_name&#34;
is missing&#39;;
d&#41; If a table exists but its fields are incorrect, croak with &#39;Table
&#34;table_name&#34; exists but is missing mandatory fields&#39;.

This would also allow me to remove the dual scalar/list return context
in has_tables&#40;&#41;, so that the only way to call has_tables would become:
   my $tables_exist = $queues_admin-&gt;has_tables&#40;&#41;;

What do you think?

Guillaume
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1124669" href="/Public/Bug/Display.html?id=79676#txn-1124669">#</a>      
    </span>
    <span class="date">Sun&nbsp;Sep&nbsp;30&nbsp;06:18:01&nbsp;2012</span>
    <span class="description">bond-spb [...] mail.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #79676] notes &#38;&#38; errors in Queue::DBI::Admin </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 30 Sep 2012 14:19:11 +0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Queue-DBI [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Сергей Бондаренко &lt;bond-spb [...] mail.ru&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1124669/591658/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/591658">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 646b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Guillaume,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Would it make sense to have the following logic for has_tables&#40;&#41;:
&gt; a&#41; If both tables exist and have the right fields, return 1;
&gt; b&#41; If both tables don&#39;t exist, return 0;
&gt; c&#41; If one table exists but not the other, croak with &#39;Table &#34;table_name&#34; 
&gt; is missing&#39;;
&gt; d&#41; If a table exists but its fields are incorrect, croak with &#39;Table
&gt; &#34;table_name&#34; exists but is missing mandatory fields&#39;.
&gt;
&gt; This would also allow me to remove the dual scalar/list return context
&gt; in has_tables&#40;&#41;, so that the only way to call has_tables would become:
&gt;   my $tables_exist = $queues_admin-&gt;has_tables&#40;&#41;;
</div>
Of course this best solution

Sergey
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1124922" href="/Public/Bug/Display.html?id=79676#txn-1124922">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;01&nbsp;09:52:43&nbsp;2012</span>
    <span class="description">AUBERTG [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1124922/591795/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/591795">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 271b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Sergey,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Of course this best solution
</div>
I just uploaded v2.3.1, which has all the modifications we discussed.
Let me know when you have a chance to look at it and please tell me what
you think.

Thank you again for all your feedback, I very appreciate it!

Guillaume
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1126849" href="/Public/Bug/Display.html?id=79676#txn-1126849">#</a>      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;07&nbsp;11:39:37&nbsp;2012</span>
    <span class="description">bond-spb [...] mail.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #79676] notes &#38;&#38; errors in Queue::DBI::Admin </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 7 Oct 2012 19:40:58 +0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Queue-DBI [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Сергей Бондаренко &lt;bond-spb [...] mail.ru&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1126849/592843/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/592843">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 384b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Guillaume,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I just uploaded v2.3.1, which has all the modifications we discussed.
&gt; Let me know when you have a chance to look at it and please tell me what 
&gt; you think.
</div>
I just finished testing Admin.pm. everything is ok, but one note:
drop_tables&#40;&#41; must check tables before dropping with  has_tables&#40;&#41; to 
prevent accidental deletion of arbitrary existing table.

BR
Sergey 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1127168" href="/Public/Bug/Display.html?id=79676#txn-1127168">#</a>      
    </span>
    <span class="date">Mon&nbsp;Oct&nbsp;08&nbsp;22:39:14&nbsp;2012</span>
    <span class="description">AUBERTG [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1127168/593003/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/593003">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 448b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Sergey,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I just finished testing Admin.pm. everything is ok, but one note:
&gt; drop_tables&#40;&#41; must check tables before dropping with  has_tables&#40;&#41; to 
&gt; prevent accidental deletion of arbitrary existing table.
</div>
Ah yes I see - checking for the fields will ensure that someone cannot
just pass any random table name in Queue::DBI::Admin-&gt;new&#40;&#41; and then
call drop_tables&#40;&#41; to delete them. It&#39;s a good idea for security, I will
add it now.

Guillaume
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1127511" href="/Public/Bug/Display.html?id=79676#txn-1127511">#</a>      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;10&nbsp;01:17:57&nbsp;2012</span>
    <span class="description">AUBERTG [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1127511/593181/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/593181">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 355b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Sergey,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I just finished testing Admin.pm. everything is ok, but one note:
&gt; drop_tables&#40;&#41; must check tables before dropping with  has_tables&#40;&#41; to 
&gt; prevent accidental deletion of arbitrary existing table.
</div>
I just released v2.4.2 that includes this, please let me know if you see
anything else. Thank you again for all your suggestions!

Guillaume
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1127513" href="/Public/Bug/Display.html?id=79676#txn-1127513">#</a>      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;10&nbsp;01:17:58&nbsp;2012</span>
    <span class="description">AUBERTG [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1131599" href="/Public/Bug/Display.html?id=79676#txn-1131599">#</a>      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;21&nbsp;14:38:17&nbsp;2012</span>
    <span class="description">bond-spb [...] mail.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #79676] notes &#38;&#38; errors in Queue::DBI::Admin </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 21 Oct 2012 22:40:01 +0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Queue-DBI [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Сергей Бондаренко &lt;bond-spb [...] mail.ru&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1131599/595454/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/595454">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 480b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Guillaume,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I just released v2.4.2 that includes this, please let me know if you see 
&gt; anything else.
</div>
1. has_queue&#40;&#41; method return 0 when queue table does not exists. I think it 
would be better to add has_table&#40;&#41; and croak before to inform about problem. 
&#40;Admin.pm line 205&#41;

2. Croak with DBI error needed in Queue::DBI-&gt;new&#40;&#41; &#40;DBI.pm line 216&#41;. 
Otherwise using RaiseError=0 we get the wrong message when there will be any 
sql error.

Thank you for your work!
Sergey
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1131601" href="/Public/Bug/Display.html?id=79676#txn-1131601">#</a>      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;21&nbsp;14:38:18&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;resolved&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1133093" href="/Public/Bug/Display.html?id=79676#txn-1133093">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;26&nbsp;00:25:27&nbsp;2012</span>
    <span class="description">AUBERTG [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1133093/596274/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/596274">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Sergey,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 1. has_queue&#40;&#41; method return 0 when queue table does not exists. I
&gt; think it
&gt; would be better to add has_table&#40;&#41; and croak before to inform about
&gt; problem.
&gt; &#40;Admin.pm line 205&#41;
</div>
I&#39;m a bit concerned that it adds the overhead of an extra query to a
function that can be called often. What would you think of verifying
only once per Queue::DBI::Admin object instead:

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/guillaumeaubert/Queue-DBI/commit/eb75aa4c53cfaacb179aee52dc04fcea05fdbff4">https://github.com/guillaumeaubert/Queue-DBI/commit/eb75aa4c53cfaacb179aee52dc04fcea05fdbff4</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/guillaumeaubert/Queue-DBI/commit/88b68c2d41dbb09d8265b500d5f4dfd72bdb435f">https://github.com/guillaumeaubert/Queue-DBI/commit/88b68c2d41dbb09d8265b500d5f4dfd72bdb435f</a></span>

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 2. Croak with DBI error needed in Queue::DBI-&gt;new&#40;&#41; &#40;DBI.pm line 216&#41;.
&gt; Otherwise using RaiseError=0 we get the wrong message when there will
&gt; be any sql error.
</div>
The problem here is that for DBI, selectrow_arrayref&#40;&#41; returning undef
can mean either &#34;SQL error&#34; or &#34;no rows found&#34;.

I&#39;m thinking here that the easiest is to switch RaiseError locally each
time there&#39;s a selectrow_arrayref&#40;&#41; in Queue::DBI:

my $data;
{
    local $database_handle-&gt;{&#39;RaiseError&#39;} = 1;
    $data = $dbh-&gt;selectrow_arrayref&#40; ... &#41;;
}

The alternative is to test $dbh-&gt;errstr&#40;&#41; after each SQL statement, but
I&#39;m not sure if it is a very reliable way to detect errors.

What do you think?

Guillaume
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1134681" href="/Public/Bug/Display.html?id=79676#txn-1134681">#</a>      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;30&nbsp;14:30:34&nbsp;2012</span>
    <span class="description">bond-spb [...] mail.ru -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #79676] notes &#38;&#38; errors in Queue::DBI::Admin</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 30 Oct 2012 22:32:17 +0400</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> &lt;bug-Queue-DBI [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Сергей Бондаренко &lt;bond-spb [...] mail.ru&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1134681/597109/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/597109">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 577b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Guillaume,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; What would you think of verifying
&gt; only once per Queue::DBI::Admin object instead:
&gt;
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/guillaumeaubert/Queue-DBI/commit/eb75aa4c53cfaacb179aee52dc04fcea05fdbff4">https://github.com/guillaumeaubert/Queue-DBI/commit/eb75aa4c53cfaacb179aee52dc04fcea05fdbff4</a></span>
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/guillaumeaubert/Queue-DBI/commit/88b68c2d41dbb09d8265b500d5f4dfd72bdb435f">https://github.com/guillaumeaubert/Queue-DBI/commit/88b68c2d41dbb09d8265b500d5f4dfd72bdb435f</a></span>
</div>
ok


<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I&#39;m thinking here that the easiest is to switch RaiseError locally each
&gt; time there&#39;s a selectrow_arrayref&#40;&#41; in Queue::DBI:
&gt;
&gt; my $data;
&gt; {
&gt;    local $database_handle-&gt;{&#39;RaiseError&#39;} = 1;
&gt;    $data = $dbh-&gt;selectrow_arrayref&#40; ... &#41;;
&gt; }
</div>
this good solution


BR
Sergey
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1135209" href="/Public/Bug/Display.html?id=79676#txn-1135209">#</a>      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;31&nbsp;21:53:15&nbsp;2012</span>
    <span class="description">AUBERTG [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1135209/597376/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/597376">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 489b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Sergey,

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed"><div class="message-stanza open">&gt; &gt; What would you think of verifying
&gt; &gt; only once per Queue::DBI::Admin object instead:
&gt; &gt; [...]
</div>&gt; 
&gt; ok
&gt; 
&gt; 
<div class="message-stanza open">&gt; &gt; I&#39;m thinking here that the easiest is to switch RaiseError locally
</div>&gt; each
<div class="message-stanza open">&gt; &gt; time there&#39;s a selectrow_arrayref&#40;&#41; in Queue::DBI:
&gt; &gt; [...]
</div>&gt; 
&gt; this good solution
</div>
I just released v2.5.0 with those two improvements.

Thank you so much for your feedback and review of the code, I really
appreciate it. Please let me know if you notice anything else!

Guillaume
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1135211" href="/Public/Bug/Display.html?id=79676#txn-1135211">#</a>      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;31&nbsp;21:53:16&nbsp;2012</span>
    <span class="description">AUBERTG [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.80838</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
