<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #87837 for Pod-Perldoc: perldoc should not always drop privs when UID=0</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #87837 for Pod-Perldoc: perldoc should not always drop privs when UID=0</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Pod-Perldoc">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Pod-Perldoc">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Pod-Perldoc">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Pod-Perldoc">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Pod-Perldoc">Pod-Perldoc CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">87837</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Pod-Perldoc">Pod-Perldoc</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
KENTNL [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-26136-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<ul>
<li>
3.20</li>
<li>
3.25</li>
</ul>
    </td>
  </tr>
  <tr id="CF-26137-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=87837">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1249131" href="/Public/Bug/Display.html?id=87837#txn-1249131">#</a>      
    </span>
    <span class="date">Tue&nbsp;Aug&nbsp;13&nbsp;23:54:35&nbsp;2013</span>
    <span class="description">KENTNL [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> perldoc should not always drop privs when UID=0</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1249131/660876/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/660876">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza"><p>
	Granted the &quot;drop privs&quot; thing may be well intentioned, but there&#39;s no adequate description of the exact security risk dropping privs serves to achieve protecting against.<br>

	<br>

	Additionally, there are usage case for perldoc where &quot;UID=0&quot; is *required*, and dropping privs just causes problems.<br>

	<br>

	For instance, if you try to use perldoc -d $FILE as UID=0,&nbsp; perldoc will likely be unable to write to $FILE if only UID=0 can write to it.<br>

	<br>

	<span class="clickylink"><a target="new" rel="nofollow" href="https://gist.github.com/kentfredric/6227848">https://gist.github.com/kentfredric/6227848</a></span><br>

	<br>

	And its quite plausible that root may want to use perldoc to do something useful, and other software, such as Parrot, use perldoc to format POD to text files.<br>

	<br>

	In one instance, Parrot calls &#39;perldoc&#39; to format documentation during `make install`, and as `make install` frequently *REQUIRES* running as root, which means perldoc drops privs.<br>

	<br>

	One work-around people use for this problem is shell &gt; redirection, but that doesn&#39;t work on win32, so parrot has to use -d<br>

	<br>

	<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/parrot/parrot/issues/520">https://github.com/parrot/parrot/issues/520</a></span><br>

	<br>

	<br>

	TL;DR&nbsp; -</p>

<p>
	1. The security risk is not obvious<br>

	2. Would be nice to have a way to go &quot;Ok, I don&#39;t care about the security, I&#39;m a grown up&quot; at the very least.<br>

	<br>

	<br>

	&nbsp;</p>


</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1249318" href="/Public/Bug/Display.html?id=87837#txn-1249318">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;14&nbsp;11:00:01&nbsp;2013</span>
    <span class="description">mrallen1 [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1249318/660970/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/660970">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 886b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Aug 13 23:54:35 2013, KENTNL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 1. The security risk is not obvious
</div>
There are tons of security risks running perl setuid which are detailed pretty well in perlsec <span class="clickylink"><a target="new" rel="nofollow" href="http://perldoc.perl.org/perlsec.html">http://perldoc.perl.org/perlsec.html</a></span>. 

In addition, perldoc responds to many different command names &#40;as a historical curiosity partly&#41; 

See <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/mrallen1/Pod-Perldoc/blob/master/lib/Pod/Perldoc.pm#L323-L386">https://github.com/mrallen1/Pod-Perldoc/blob/master/lib/Pod/Perldoc.pm#L323-L386</a></span>

and it uses untainting pervasively throughout the codebase.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 2. Would be nice to have a way to go &#34;Ok, I don&#39;t care about the
&gt; security, I&#39;m a grown up&#34; at the very least.
</div>
I guess it would be possible to add a patch to *not* drop the setuid bits, but I don&#39;t think its going to
solve the problem with parrot. IMO, the pattern would be 

# perldoc -d /tmp/foo.txt foo.pod 

and then later, 

# mv /tmp/foo.txt /final/place/in/my/path 

totally external to perldoc.  

Cheers,

Mark
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1249319" href="/Public/Bug/Display.html?id=87837#txn-1249319">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;14&nbsp;11:00:01&nbsp;2013</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1249410" href="/Public/Bug/Display.html?id=87837#txn-1249410">#</a>      
    </span>
    <span class="date">Wed&nbsp;Aug&nbsp;14&nbsp;15:25:11&nbsp;2013</span>
    <span class="description">KENTNL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1249410/661020/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/661020">with headers</a>
<br />
<span class="downloadcontenttype">text/html 4.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza"><p>
	On 2013-08-15 03:00:01, mallen wrote:<br>

	&gt; On Tue Aug 13 23:54:35 2013, KENTNL wrote:<br>

	&gt; &gt; 1. The security risk is not obvious<br>

	&gt;<br>

	&gt; There are tons of security risks running perl setuid which are<br>

	&gt; detailed pretty well in perlsec <span class="clickylink"><a target="new" rel="nofollow" href="http://perldoc.perl.org/perlsec.html">http://perldoc.perl.org/perlsec.html</a></span>.<br>

	&gt;<br>

	I think my question is more &quot;What security risks exist specific are there that are specific to perldoc&quot;.<br>

	<br>

	If you&#39;re arguing there&#39;s security risks in general from running perl as root, or running perl setuid, sure, I can&#39;t argue that, ... but if we wanted to &quot;solve&quot; that, perl itself would have to tell every user who ran it for *any* reason, &quot;No, you may not run Perl as root, its too insecure&quot;&nbsp; =)<br>

	<br>

	Now if you&#39;re arguing about /setuid/ perl, ie: a perl that runs as root when called by a user as a result of filesystem bits that cause it to escalate privelage, thats a security risk, but thats a security risk for *every* perl program that is installed setuid.<br>

	<br>

	In our problem scenario, the code is not being installed/run as *setuid*, it is merely running normally as root.<br>

	<br>

	However, if a root user wants to do &quot;perl -E&quot;system(q[rm -rf /])&quot;, thats their problem. We dont&#39; bar them from running perl simply because they&#39;re root =).</p>

<p>
	&gt; &gt; In addition, perldoc responds to many different command names (as a<br>

	&gt; historical curiosity partly)<br>

	&gt;<br>

	&gt; See <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/mrallen1/Pod-">https://github.com/mrallen1/Pod-</a></span><br>

	&gt; Perldoc/blob/master/lib/Pod/Perldoc.pm#L323-L386<br>

	&gt;<br>

	&gt; and it uses untainting pervasively throughout the codebase.<br>

	&gt;<br>

	<br>

	This, in itself, is not a security hole. No more than bash can cause gross damage if root invokes commands that do gross damage. The security hole is when root is tricked into doing insecure things they didn&#39;t intend on.<br>

	<br>

	&gt; &gt; 2. Would be nice to have a way to go &quot;Ok, I don&#39;t care about the<br>

	&gt; &gt; security, I&#39;m a grown up&quot; at the very least.<br>

	&gt;<br>

	&gt; I guess it would be possible to add a patch to *not* drop the setuid<br>

	&gt; bits, but I don&#39;t think its going to<br>

	&gt; solve the problem with parrot. IMO, the pattern would be<br>

	&gt;<br>

	&gt; # perldoc -d /tmp/foo.txt foo.pod<br>

	&gt;<br>

	&gt; and then later,<br>

	&gt;<br>

	&gt; # mv /tmp/foo.txt /final/place/in/my/path<br>

	&gt;<br>

	&gt; totally external to perldoc.<br>

	&gt;<br>

	<br>

	Thats the problem here though, it *is* doing perldoc -d ./target ./source and it *is* later moving the files to the final place.<br>

	<br>

	However, ./ is controlled, and owned, and readable and writeable only by the user who created it: Root.<br>

	So when perldoc drops root, even though its install target is not the &quot;OS&quot;, dropping privs means it can&#39;t write to any directory at all, because it can *ONLY* write to directories that are writeable by UID=nobody<br>

	<br>

	And that *is* a potential security hole that is being introduced, because it means you have to make the directory writeable either by a) UID=nobody&nbsp; and UID=nobody *only* in *advance*, or you have to make the directory +RW to everyone. And both those scenarios create a directory, which a well timed attack could conceivably add their own files to that tree, which might be accidentally installed to the final system.<br>

	<br>

	Just to clarify, I&#39;m not so much nessecarily asking you to fix this /for/ parrot. That ship has sailed and parrot will have to find a workaround, though it would be nice if there was just a flag that controlled whether or not to drop privs, or a flag that specified what priv to drop to.&nbsp; ( And additionally, here, the problem with parrot is a problem with their tool-chaining, because &quot;make install&quot; should not be building documentation, it should just be installing it ).<br>

	<br>

	Just when I encountered this bug(or misfeature), it was confusing as hell, because the vast majority of commandline tools don&#39;t drop privs, and debugging the cause of the read/write failure was rather challenging, because you&#39;re not expecting something like</p>

<p>
	gzcat foo -o bar # to die with a permissions problem when you are root, unless the filesystem is broken&nbsp; =)<br>

	<br>

	&nbsp;</p>


</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1278699" href="/Public/Bug/Display.html?id=87837#txn-1278699">#</a>      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;24&nbsp;12:30:47&nbsp;2013</span>
    <span class="description">LEONT [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1278699/677505/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/677505">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Tue Aug 13 23:54:35 2013, KENTNL wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Granted the &#34;drop privs&#34; thing may be well intentioned, but there&#39;s no
&gt; adequate
&gt; description of the exact security risk dropping privs serves to
&gt; achieve
&gt; protecting against.
&gt; 
&gt; Additionally, there are usage case for perldoc where &#34;UID=0&#34; is
&gt; *required*, and
&gt; dropping privs just causes problems.
&gt; 
&gt; For instance, if you try to use perldoc -d $FILE as UID=0, perldoc
&gt; will likely
&gt; be unable to write to $FILE if only UID=0 can write to it.
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://gist.github.com/kentfredric/6227848">https://gist.github.com/kentfredric/6227848</a></span>
&gt; 
&gt; And its quite plausible that root may want to use perldoc to do
&gt; something
&gt; useful, and other software, such as Parrot, use perldoc to format POD
&gt; to text
&gt; files.
&gt; 
&gt; In one instance, Parrot calls &#39;perldoc&#39; to format documentation during
&gt; `make
&gt; install`, and as `make install` frequently *REQUIRES* running as root,
&gt; which
&gt; means perldoc drops privs.
&gt; 
&gt; One work-around people use for this problem is shell &gt; redirection,
&gt; but that
&gt; doesn&#39;t work on win32, so parrot has to use -d
&gt; 
&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/parrot/parrot/issues/520">https://github.com/parrot/parrot/issues/520</a></span>
&gt; 
</div>
I can only agree, this behavior is broken and stupid.

Firstly because it doesn&#39;t seem to solve any problem. Perldoc is to show code, not to execute it.

Secondly, the logic that triggers it is idiotic. «if &#40;&#40;$&lt; == 0 || $&gt; == 0&#41; &#38;&#38; !tainted&#40;$ENV{WHATEVER}&#41;&#41;». So apparently you can actually disable this behavior by adding a -T to the perldoc shebang line. This &#34;security feature&#34; gets disabled if you ask for more security. WTF!

Thirdly, because it doesn&#39;t always work. The way the permissions are dropped is broken, wrong and silly. Bashing at $&lt; and $&gt; until hopefully all UIDs have the right value? Even if you know it sometimes doesn&#39;t work? And after all that hard work, continue &#40;admittedly with a warning&#41; even if it failed? And not paying any attention to GIDs? POSIX::set[ug]id would have fixed that more easily.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 2. Would be nice to have a way to go &#34;Ok, I don&#39;t care about the
&gt; security, I&#39;m
&gt; a grown up&#34; at the very least.
</div>
There used to be a -U flag once upon a time, it seems to have been removed in 3.09.

Leon
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1320093" href="/Public/Bug/Display.html?id=87837#txn-1320093">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;30&nbsp;23:07:52&nbsp;2014</span>
    <span class="description">mrallen1 [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1320093/700097/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/700097">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 217b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Oct 24 12:30:47 2013, LEONT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; There used to be a -U flag once upon a time, it seems to have been
&gt; removed in 3.09.
</div>
I added it back. Committed as 89f3df0. &#40;Not pushed yet.&#41;  Will that meet your needs?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1320096" href="/Public/Bug/Display.html?id=87837#txn-1320096">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jan&nbsp;30&nbsp;23:07:52&nbsp;2014</span>
    <span class="description">mrallen1 [...] yahoo.com -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1320193" href="/Public/Bug/Display.html?id=87837#txn-1320193">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jan&nbsp;31&nbsp;02:31:15&nbsp;2014</span>
    <span class="description">KENTNL [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1320193/700156/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/700156">with headers</a>
<br />
<span class="downloadcontenttype">text/html 892b</span>
</div>
<div class="messagebody">
<div class="message-stanza"><p>
	On 2014-01-31 17:07:52, mallen wrote:<br>

	&gt; On Thu Oct 24 12:30:47 2013, LEONT wrote:<br>

	&gt; &gt; There used to be a -U flag once upon a time, it seems to have been<br>

	&gt; &gt; removed in 3.09.<br>

	&gt;<br>

	&gt; I added it back. Committed as 89f3df0. (Not pushed yet.) Will that<br>

	&gt; meet your needs?<br>

	<br>

	Yeah. I would consider that a helpful addition.</p>

<p>
	On security: I&#39;d have to make sure there&#39;s no way for some ambient env/configuration toggling that flag and was only accepted on the CLI.</p>

<p>
	&nbsp;</p>

<p>
	With regards to the original parrot problem, I&#39;ve worked around it downstream with this patch, because for what Parrot is doing, it doesn&#39;t need most of the features anyway, and its just using perldoc as a simple pod extractor.</p>

<p>
	&nbsp;</p>

<p>
	<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/parrot/parrot/pull/1028/files">https://github.com/parrot/parrot/pull/1028/files</a></span></p>


</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1473351" href="/Public/Bug/Display.html?id=87837#txn-1473351">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;14&nbsp;06:18:55&nbsp;2015</span>
    <span class="description">vanstyn [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1473351/784620/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/784620">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 641b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I agree with kentnl and leont that the drop privs logic seems to be an un-feature. I ran into it while trying to figure out why -F wasn&#39;t working for me, which led to a debug/trace, at which point I discovered -U &#40;undocumented&#41; and this ticket via a git blame.

In lieu of killing this drop privs stuff altogether &#40;which would be my vote&#41; the -U option at least needs to be documented. That would have saved me an hour of debugging. Also, it seems to me that -F is basically non-functional without -U, so I think it makes sense to make -U implied with -F.

I&#39;ve opened a PR to address both:

<span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/mrallen1/Pod-Perldoc/pull/14">https://github.com/mrallen1/Pod-Perldoc/pull/14</a></span>
 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1473354" href="/Public/Bug/Display.html?id=87837#txn-1473354">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;14&nbsp;06:18:57&nbsp;2015</span>
    <span class="description">vanstyn [...] cpan.org -  Status changed from &#39;patched&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1473355" href="/Public/Bug/Display.html?id=87837#txn-1473355">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;14&nbsp;06:18:58&nbsp;2015</span>
    <span class="description">vanstyn [...] cpan.org -  Fixed in 3.25 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1473363" href="/Public/Bug/Display.html?id=87837#txn-1473363">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;14&nbsp;06:21:11&nbsp;2015</span>
    <span class="description">vanstyn [...] cpan.org -  Fixed in 3.25 deleted</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1473364" href="/Public/Bug/Display.html?id=87837#txn-1473364">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;14&nbsp;06:21:11&nbsp;2015</span>
    <span class="description">vanstyn [...] cpan.org -  Broken in 3.25 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1653506" href="/Public/Bug/Display.html?id=87837#txn-1653506">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;28&nbsp;12:38:43&nbsp;2016</span>
    <span class="description">mrallen1 [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1653506/887366/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/887366">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 255b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Mar 14 06:18:55 2015, VANSTYN wrote: 
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; <span class="clickylink"><a target="new" rel="nofollow" href="https://github.com/mrallen1/Pod-Perldoc/pull/14">https://github.com/mrallen1/Pod-Perldoc/pull/14</a></span>
</div>
So this got merged a long time ago and it was marked as broken in 3.25. Would you please explain what is still broken? Was the previous patch not effective?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1708320" href="/Public/Bug/Display.html?id=87837#txn-1708320">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;01&nbsp;17:12:34&nbsp;2017</span>
    <span class="description">mrallen1 [...] yahoo.com -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.626332</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
