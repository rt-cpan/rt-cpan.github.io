<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #59176 for Perl-Critic: &#34;no critic&#34; for pod after __END__</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #59176 for Perl-Critic: &#34;no critic&#34; for pod after __END__</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Perl-Critic">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Perl-Critic">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Perl-Critic">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Perl-Critic">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/Perl-Critic/Perl-Critic/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/Perl-Critic">Perl-Critic CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">59176</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Perl-Critic">Perl-Critic</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
user42 [...] zip.com.au

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-25198-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-25199-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




Foo.pm<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/801310/415404/Foo.pm">
Wed Jul 07 18:07:30 2010 (97b) by user42 [...] zip.com.au
</a>
</font></li>
</ul>


Foo2.pm<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/808112/418931/Foo2.pm">
Fri Jul 23 10:23:10 2010 (139b) by wyant [...] cpan.org
</a>
</font></li>
</ul>


RequirePackageMatchesPodName.pm.linenum.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/808315/419033/RequirePackageMatchesPodName.pm.linenum.diff">
Fri Jul 23 19:09:55 2010 (1k) by user42 [...] zip.com.au
</a>
</font></li>
</ul>


Violation.pm.set-linenum.diff<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/808315/419034/Violation.pm.set-linenum.diff">
Fri Jul 23 19:09:55 2010 (1.2k) by user42 [...] zip.com.au
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=59176">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-801310" href="/Public/Bug/Display.html?id=59176#txn-801310">#</a>      
    </span>
    <span class="date">Wed&nbsp;Jul&nbsp;07&nbsp;18:07:30&nbsp;2010</span>
    <span class="description">user42 [...] zip.com.au -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> &#34;no critic&#34; for pod after __END__</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 08 Jul 2010 08:07:02 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Perl-Critic [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/801310/415403/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/415403">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 576b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Foo.pm below critiqued as &#34;perlcritic -1 Foo.pm&#34; gets violation &#40;among
several others&#41;,

    Pod NAME does not match the package declaration at line 5, column 1.  &#40;no explanation&#41;.  &#40;Severity: 1&#41;

where I hoped the &#34;no critic&#34; directive in Foo.pm would suppress that
policy.

It seems to suppress successfully if the __END__ is removed, but I hoped
it would be possible to put pod after __END__ and still affect pod
policies on it.  I don&#39;t mind if the no critic directive has to come
before __END__ to be seen, though you&#39;d be tempted to grep them out
after an __END__ too.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/801310/415404/Foo.pm">Download Foo.pm</a><br />
<span class="downloadcontenttype">text/x-perl 97b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">## no critic &#40;RequirePackageMatchesPodName&#41;

__END__

=head1 NAME

Bar - wrong module name here!
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-801752" href="/Public/Bug/Display.html?id=59176#txn-801752">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;08&nbsp;20:18:09&nbsp;2010</span>
    <span class="description">wyant [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/801752/415633/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/415633">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 248b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Patch committed as SVN revision 3880, to have Perl::Critic::Annotation
objects extend their end ranges into the __END__ of the document.

The ## no critic must come at the beginning of the document, because the
policy applies to the whole document.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-801755" href="/Public/Bug/Display.html?id=59176#txn-801755">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;08&nbsp;20:18:10&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-807720" href="/Public/Bug/Display.html?id=59176#txn-807720">#</a>      
    </span>
    <span class="date">Thu&nbsp;Jul&nbsp;22&nbsp;21:10:23&nbsp;2010</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #59176] &#34;no critic&#34; for pod after __END__</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 23 Jul 2010 11:10:04 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Perl-Critic [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/807720/418801/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/418801">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 424b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Tom Wyant via RT&#34; &lt;bug-Perl-Critic@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Patch committed as SVN revision 3880, to have Perl::Critic::Annotation
&gt; objects extend their end ranges into the __END__ of the document.
</div>
I&#39;m not sure it&#39;s right on the Foo.pm I posted.  Try one without a final
&#34;=cut&#34;, so the pod to be affected is the last element.  I wonder if the
$ending_line should allow for elements like pods which have newlines in
them.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-808112" href="/Public/Bug/Display.html?id=59176#txn-808112">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;23&nbsp;10:23:10&nbsp;2010</span>
    <span class="description">wyant [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/808112/418930/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/418930">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu Jul 22 21:10:23 2010, user42@zip.com.au wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; 
&gt; I&#39;m not sure it&#39;s right on the Foo.pm I posted.
</div>
In my Perl-Critic development directory, I just now did

$ perl -Mblib bin/perlcritic --single RequirePackageMatchesPodName ../Foo.pm

&#40;../Foo.pm being a fresh download of the file you attached to the
original ticket&#41; and found no violation.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Try one without a final
&gt; &#34;=cut&#34;, so the pod to be affected is the last element.
</div>
I also tried this with the attached Foo2.pm &#40;no &#39;=cut&#39;&#41;, and got no
violation. Can you post an example that the patch does not deal with,
and say how it fails to deal with it?

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I wonder if the $ending_line should allow for elements like pods
&gt; which have newlines in them.
</div>
I believe not. Perl::Critic does not analyze Perl directly, but instead
analyzes a PPI parse. The &#39;effective range&#39; calculation is based on the
line PPI reports for the element being analyzed. If you run the attached
Foo2.pm file through ppidump &#40;found in the &#39;tools&#39; directory of the
Perl::Critic kit&#41; you will see that the lump of POD at the end all ends
up in a single PPI::Token::Pod object.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Foo2.pm</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/808112/418931/Foo2.pm">Download Foo2.pm</a><br />
<span class="downloadcontenttype">text/x-perl 139b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
package Foo2;

1;

## no critic &#40;RequirePackageMatchesPodName&#41;

__END__

=pod

=head1 NAME

Bar - This is the wrong name.

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-808315" href="/Public/Bug/Display.html?id=59176#txn-808315">#</a>      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;23&nbsp;19:09:54&nbsp;2010</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #59176] &#34;no critic&#34; for pod after __END__</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 24 Jul 2010 09:09:37 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Perl-Critic [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/808315/419032/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/419032">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 840b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Tom Wyant via RT&#34; &lt;bug-Perl-Critic@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; no violation.
</div>
Ah, yeah, sorry about that, I realized shortly after posting that I&#39;d
probably done it to myself.  I&#39;ve got it jigged up to report the
violation at the actual offending &#34;=head NAME&#34; line number, per below
&#40;exercised a bit, not really tested beyond that :&#41;.  I forget if I&#39;ve
submitted it yet.

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; line PPI reports for the element being analyzed.
</div>
Oh, well, you don&#39;t want to limit reports to the first line of an
element.  It should be possible to pinpoint offending positions in big
pod blocks or here documents and perhaps big literal strings.

The way ppi generates its line/column is a bit awful, and you&#39;d probably
like it to help working out an offset into an element, but even without
that getting close to the right linenum in a pod block isn&#39;t too hard.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/808315/419033/RequirePackageMatchesPodName.pm.linenum.diff">Download RequirePackageMatchesPodName.pm.linenum.diff</a><br />
<span class="downloadcontenttype">text/x-diff 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Index: RequirePackageMatchesPodName.pm
===================================================================
--- RequirePackageMatchesPodName.pm	&#40;revision 3881&#41;
+++ RequirePackageMatchesPodName.pm	&#40;working copy&#41;
@@ -52,6 +52,7 @@
         next if $content !~ m{^=head1 [ \t]+ NAME [ \t]*$ \s*}cgxms;
 
         my &#40;$pod_pkg&#41; = $content =~ m{\G &#40;\S+&#41; }cgxms;
+        my $pkg_pos = pos&#40;$content&#41;;
 
         if &#40;!$pod_pkg&#41; {
             return $self-&gt;violation&#40; $DESC, q{Empty name declaration}, $elem &#41;;
@@ -67,12 +68,23 @@
             return if $pkg eq $pod_pkg;
         }
 
-        return $self-&gt;violation&#40; $DESC, $EXPL, $pod &#41;;
+        my $violation = $self-&gt;violation&#40; $DESC, $EXPL, $pod &#41;;
+        $violation-&gt;set_line_number_offset
+          &#40;_str_pos_to_linenum &#40;$content, $pkg_pos&#41; - 1&#41;;
+        return $violation;
+
     }
 
     return;  # no NAME section found
 }
 
+# returning 1 for first line
+sub _str_pos_to_linenum {
+    my &#40;$str, $pos&#41; = @_;
+    $str = substr &#40;$str, 0, $pos&#41;;
+    return scalar&#40;$str =~ tr/\n/x/&#41; + 1;
+}
+
 1;
 
 __END__
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/808315/419034/Violation.pm.set-linenum.diff">Download Violation.pm.set-linenum.diff</a><br />
<span class="downloadcontenttype">text/x-diff 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Index: Violation.pm
===================================================================
--- Violation.pm	&#40;revision 3881&#41;
+++ Violation.pm	&#40;working copy&#41;
@@ -128,6 +128,34 @@
 
 #-----------------------------------------------------------------------------
 
+sub set_line_number_offset {
+    my &#40;$self, $offset&#41; = @_;
+
+    my @location = @{$self-&gt;{_location}};
+    $location[$LOCATION_LINE_NUMBER] += $offset;
+    $location[$LOCATION_LOGICAL_LINE_NUMBER] += $offset;
+    $location[$LOCATION_COLUMN_NUMBER] = 1;
+    $location[$LOCATION_VISUAL_COLUMN_NUMBER] = 1;
+    $self-&gt;{_location} = \@location;
+
+    # Setup $self-&gt;source&#40;&#41; to give the actual offending line at $offset.
+    # This may be a long way from the start of statement etc for a big pod or
+    # here document.
+    #
+    my $elem = $self-&gt;{_elem};
+    my $str = &#40;defined $elem ? $elem-&gt;document-&gt;content : $EMPTY&#41;;
+    $self-&gt;{_source} = _str_line_n &#40;$str, $location[$LOCATION_LINE_NUMBER]&#41;;
+}
+
+# counting from $n==1 for the first line
+sub _str_line_n {
+    my &#40;$str, $n&#41; = @_;
+    $n--;
+    return &#40;$str =~ /^&#40;.*\n&#41;{$n}&#40;.*&#41;/ ? $2 : $EMPTY&#41;;
+}
+
+#-----------------------------------------------------------------------------
+
 sub location {
     my $self = shift;
 
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-845154" href="/Public/Bug/Display.html?id=59176#txn-845154">#</a>      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;19&nbsp;21:14:24&nbsp;2010</span>
    <span class="description">wyant [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/845154/437565/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/437565">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 854b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">A hack to the violation message was made a while back &#40;as SVN revision
3891&#41; to add the line number to the text of the error message. This was
the minimal change, and has precedent in other Documentation policies.
But it produces a somewhat confusing error message, since there are two
line numbers.

We appreciate the proffered patch. At the moment, though, we&#39;re
investigating making Perl::Critic::Policy-&gt;violation&#40;&#41; and
Perl::Critic::Violation-&gt;new&#40;&#41; understand named arguments. If this works
out, it would make this and a couple other tickets a snap, without
having to retrieve and modify the Violation object after it was created.

NOTE TO RT QUEUE MAINTAINERS

I have marked this patched, but we may want to hold this open until
either the named argument effort collapses or until it is implemented
and we can redo the patch using named arguments.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-845157" href="/Public/Bug/Display.html?id=59176#txn-845157">#</a>      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;19&nbsp;21:14:25&nbsp;2010</span>
    <span class="description">wyant [...] cpan.org -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-846775" href="/Public/Bug/Display.html?id=59176#txn-846775">#</a>      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;23&nbsp;20:00:46&nbsp;2010</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #59176] &#34;no critic&#34; for pod after __END__</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sun, 24 Oct 2010 11:00:24 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Perl-Critic [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/846775/438401/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/438401">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 999b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Tom Wyant via RT&#34; &lt;bug-Perl-Critic@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; Perl::Critic::Violation-&gt;new&#40;&#41; understand named arguments.
</div>
There&#39;d be room at the end for options.  There&#39;d could be more than one
way to do it when expressing an offset into an element.  An

    $self-&gt;violation &#40;$desc, $detail, $elem,
                      offset_linenum =&gt; $linenum&#41;;

would suit pod crunched stuff, or something like

    offset_in_string =&gt; $charnum

would be good for PPI::Token::Quote and PPI::Token::QuoteLike elements
expressing a position within the string payload as such, skipping
whatever &#39; or q{ quoting &#40;including comments between the &#34;q&#34; and &#34;{&#34;&#41;.
The QuoteLikes could get some help from PPI for where the payload begins
in the full content.

Pinpointing a string position will be good for long strings or
objections to subtle things like RequireInterpolationOfMetachars where
it&#39;s often not easy to tell by eye exactly where the problem is.
I might even have opened a ticket for that already, ages ago.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-846777" href="/Public/Bug/Display.html?id=59176#txn-846777">#</a>      
    </span>
    <span class="date">Sat&nbsp;Oct&nbsp;23&nbsp;20:00:47&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;patched&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-847006" href="/Public/Bug/Display.html?id=59176#txn-847006">#</a>      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;24&nbsp;12:33:04&nbsp;2010</span>
    <span class="description">wyant [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/847006/438511/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/438511">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Oct 23 20:00:46 2010, user42@zip.com.au wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &#34;Tom Wyant via RT&#34; &lt;bug-Perl-Critic@rt.cpan.org&gt; writes:
<div class="message-stanza open">&gt; &gt;
&gt; &gt; Perl::Critic::Violation-&gt;new&#40;&#41; understand named arguments.
</div>&gt; 
&gt; There&#39;d be room at the end for options.  There&#39;d could be more than one
&gt; way to do it when expressing an offset into an element.  An
&gt; 
&gt;     $self-&gt;violation &#40;$desc, $detail, $elem,
&gt;                       offset_linenum =&gt; $linenum&#41;;
&gt; 
&gt; would suit pod crunched stuff, or something like
&gt; 
&gt;     offset_in_string =&gt; $charnum
&gt; 
&gt; would be good for PPI::Token::Quote and PPI::Token::QuoteLike elements
&gt; expressing a position within the string payload as such, skipping
&gt; whatever &#39; or q{ quoting &#40;including comments between the &#34;q&#34; and &#34;{&#34;&#41;.
&gt; The QuoteLikes could get some help from PPI for where the payload begins
&gt; in the full content.
&gt; 
&gt; Pinpointing a string position will be good for long strings or
&gt; objections to subtle things like RequireInterpolationOfMetachars where
&gt; it&#39;s often not easy to tell by eye exactly where the problem is.
&gt; I might even have opened a ticket for that already, ages ago.
</div>
As of right now the thinking is that rather than having a hybrid calling
sequence &#40;the polite term!&#41; we go with a full named interface to
Perl::Critic::Violation-&gt;new&#40;&#41;. The positional interface stays for a
while at least, but all new functionality goes into the named interface.
The new arguments are going to be something like &#39;-line-offset&#39; and
&#39;-character&#39;, with either or both being allowed. The leading-dash
convention appears to be deeply-enough entrenched in Perl::Critic that
we&#39;re going to have to go with it.

For various reasons, the Perl::Critic::Policy violation&#40;&#41; method remains
positional, with new method make_violation&#40;&#41; having the named interface.

But it may take a while for all this to come to fruition, because
there&#39;s a release in the works and we don&#39;t want to upset things too
badly until it happens. Then installing named arguments looks like a
separate activity in itself. Once they&#39;re in, work on customizing the
reported position can be done.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-847063" href="/Public/Bug/Display.html?id=59176#txn-847063">#</a>      
    </span>
    <span class="date">Sun&nbsp;Oct&nbsp;24&nbsp;18:00:59&nbsp;2010</span>
    <span class="description">wyant [...] cpan.org -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-848699" href="/Public/Bug/Display.html?id=59176#txn-848699">#</a>      
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;29&nbsp;00:14:52&nbsp;2010</span>
    <span class="description">user42 [...] zip.com.au -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #59176] &#34;no critic&#34; for pod after __END__</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 29 Oct 2010 09:46:10 +1100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Perl-Critic [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Kevin Ryde &lt;user42 [...] zip.com.au&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/848699/439380/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/439380">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 263b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">&#34;Tom Wyant via RT&#34; &lt;bug-Perl-Critic@rt.cpan.org&gt; writes:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;
&gt; hybrid calling sequence
</div>
If the first three args are always wanted and most of the time all
that&#39;s needed then that style can be retained, and just have optional
key/value args after them for tweaking.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-848701" href="/Public/Bug/Display.html?id=59176#txn-848701">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Fri&nbsp;Oct&nbsp;29&nbsp;00:14:53&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;patched&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.748235</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
