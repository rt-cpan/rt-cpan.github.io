<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #77072 for Net-FTPSSL: automatic pret support ?</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #77072 for Net-FTPSSL: automatic pret support ?</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Net-FTPSSL">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Net-FTPSSL">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Net-FTPSSL">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Net-FTPSSL">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Net-FTPSSL">Net-FTPSSL CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">77072</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Net-FTPSSL">Net-FTPSSL</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
stefanos [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Wishlist    </td>
  </tr>
  <tr id="CF-22628-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.21    </td>
  </tr>
  <tr id="CF-22629-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.22    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




ftp.pl<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1075867/566083/ftp.pl">
Wed May 09 02:30:09 2012 (563b) by stefanos [...] cpan.org
</a>
</font></li>
</ul>


mylog.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1076644/566505/mylog.txt">
Thu May 10 23:37:00 2012 (1.3k) by stefanos [...] cpan.org
</a>
</font></li>
</ul>


myLog.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1076209/566269/myLog.txt">
Thu May 10 00:11:44 2012 (1.2k) by stefanos [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=77072">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1075867" href="/Public/Bug/Display.html?id=77072#txn-1075867">#</a>      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;09&nbsp;02:30:09&nbsp;2012</span>
    <span class="description">stefanos [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> automatic pret support ?</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1075867/566082/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/566082">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 79b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">automatic pret support ?

See the example &#40;little hack with goto&#41; but it works.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> ftp.pl</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1075867/566083/ftp.pl">Download ftp.pl</a><br />
<span class="downloadcontenttype">text/x-perl 563b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl

use Net::FTPSSL;

my $host = &#39;localhost&#39;;
my $port = &#39;33333&#39;;
my $user = &#39;test&#39;;
my $pass = &#39;test&#39;;
my $pfad = &#39;/&#39;;

my $ftppret1 = 0;
FTPPRET1:
if&#40;my $ftp = Net::FTPSSL-&gt;new&#40;$host, Timeout =&gt; 10, Pret =&gt; $ftppret1, Port =&gt; $port, Debug =&gt; 0&#41;&#41;{
	$ftp-&gt;login&#40;$user,$pass&#41;;
	$ftp-&gt;binary&#40;&#41;;
	$ftp-&gt;cwd&#40;$pfad&#41;;

	my @ftpdataLIST = $ftp-&gt;list&#40;$pfad&#41;;
	if&#40;$ftp-&gt;last_message&#40;&#41; =~ /You need to use a client supporting PRET/i&#41;{
		$ftp-&gt;abort;
		$ftp-&gt;quit;
		$ftppret1 = 1;
		goto FTPPRET1;
	}

	# Code
	$ftp-&gt;quit;
}

exit;</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1076080" href="/Public/Bug/Display.html?id=77072#txn-1076080">#</a>      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;09&nbsp;14:54:03&nbsp;2012</span>
    <span class="description">CLEACH [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1076080/566193/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/566193">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Stefanos,

I saw your hack, but of course it&#39;s a wrapper to my class instead of
modifying my code to implement.

The problem with this option to FTPSSL is that I can&#39;t tell if you need
it until after you log in and actually do something.  And that something
is completely different with each user.  And I bet the error message is
different per server as well.

Off the top of my head, the solution may be in the _pasv&#40;&#41; function. 
Can you try out this patch for me? &#40;Modify FTPSSL.pm&#41;  I don&#39;t have a
PRET server to test against.  But if this patch works, I&#39;ll put it into
my code base for the next release.

Original code in _pasv&#40;&#41;.
  unless &#40; $self-&gt;command &#40;&#34;PASV&#34;&#41;-&gt;response &#40;&#41; == CMD_OK &#41; {
     $self-&gt;_croak_or_return &#40;&#41;;
     return &#40;$host, $port&#41;;
  }

becomes
  unless &#40; $self-&gt;command &#40;&#34;PASV&#34;&#41;-&gt;response &#40;&#41; == CMD_OK &#41; {
     if &#40;$self-&gt;last_message&#40;&#41; =~ /&#40;^|\s&#41;PRET&#40;$|[\s.!?]&#41;/i&#41; {
         ${*$self}{Pret} = 1;   # Turns PRET on for all future calls to
_pasv&#40;&#41;.
         $self-&gt;_print_DBG &#40;&#34;&lt;&lt;+ Auto-adding PRET option!\n&#34;&#41;;
         $self-&gt;_pasv&#40; @_&#41;;
     } else {
        $self-&gt;_croak_or_return &#40;&#41;;
     }
     return &#40;$host, $port&#41;;
  }

I didn&#39;t put in your more expansive test string to match against since
I&#39;m betting the error message is different for different servers.  All
I&#39;m requiring is that PRET appears as it&#39;s own word and not part of
another word such as &#34;pretty&#34; and that the call to PASV failed.

So in your test, leave off the Pret option entirely and no need for a
goto at all.  But be sure to add Debug=&gt;1, DebugLogFile =&gt; &#34;myLog.txt&#34;
so that you get a log file.

And then send me the log file generated so I know there are no issues
with my patch.

Curtis

On Wed May 09 02:30:09 2012, STEFANOS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; automatic pret support ?
&gt; 
&gt; See the example &#40;little hack with goto&#41; but it works.
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1076083" href="/Public/Bug/Display.html?id=77072#txn-1076083">#</a>      
    </span>
    <span class="date">Wed&nbsp;May&nbsp;09&nbsp;14:54:04&nbsp;2012</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1076209" href="/Public/Bug/Display.html?id=77072#txn-1076209">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;10&nbsp;00:11:44&nbsp;2012</span>
    <span class="description">stefanos [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1076209/566268/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/566268">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 107b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I think is it not enough?

With force pret =&gt; 1 works good but auto pret with your code not, see
the log.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> myLog.txt</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1076209/566269/myLog.txt">Download myLog.txt</a><br />
<span class="downloadcontenttype">text/plain 1.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
Net-FTPSSL Version: 0.21

Perl: 5.010001  [5.10.1],  OS: MSWin32

Server &#40;port&#41;: localhost &#40;33333&#41;

Keys: &#40;Debug&#41;, &#40;Port&#41;, &#40;Timeout&#41;, &#40;DebugLogFile&#41;
Values: &#40;1&#41;, &#40;33333&#41;, &#40;10&#41;, &#40;myLog.txt&#41;

SKT &lt;&lt;&lt; 220 OFFLiNE
SKT &gt;&gt;&gt; AUTH TLS
SKT &lt;&lt;&lt; 234 AUTH TLS successful
&gt;&gt;&gt; USER +++++++
&lt;&lt;&lt; 331 Password required for &lt;++++++&gt;.
&gt;&gt;&gt; PASS *******
&lt;&lt;&lt; 2
&lt;&lt;&lt; 30- 
&lt;&lt;&lt; 230-         Welcome to the future of FXP:ing
&lt;&lt;&lt; 230-      ___      _____________  ___
&lt;&lt;&lt; 230-     / _ \____/ __/_  __/ _ \/ _ \
&lt;&lt;&lt; 230-    / // / __/ _/  / / / ___/ // /
&lt;&lt;&lt; 230-   /____/_/ /_/   /_/ /_/  /____/
&lt;&lt;&lt; 230-                   DistRibuted FTP Daemon
&lt;&lt;&lt; 230-                        <span class="clickylink"><a target="new" rel="nofollow" href="http://drftpd.org">http://drftpd.org</a></span>
&lt;&lt;&lt; 230 &lt;++++++&gt; logged in successfully.
&gt;&gt;&gt; TYPE I
&lt;&lt;&lt; 2
&lt;&lt;&lt; 00 Command okay
&gt;&gt;&gt; CWD /
&lt;&lt;&lt; 2
&lt;&lt;&lt; 50 Directory changed to /
&gt;&gt;&gt; PBSZ 0
&lt;&lt;&lt; 2
&lt;&lt;&lt; 00 Command okay
&gt;&gt;&gt; PROT P
&lt;&lt;&lt; 2
&lt;&lt;&lt; 00 Command okay
&gt;&gt;&gt; PASV
&lt;&lt;&lt; 5
&lt;&lt;&lt; 00 You need to use a client supporting PRET &#40;PRE Transfer&#41; to use PASV
&lt;&lt;+ Auto-adding PRET option!
&gt;&gt;&gt; PRET LIST
&lt;&lt;&lt; 2
&lt;&lt;&lt; 00 OK, will use master for upcoming transfer
&gt;&gt;&gt; PASV
&lt;&lt;&lt; 2
&lt;&lt;&lt; 27 Entering Passive Mode &#40;87,98,244,138,191,14&#41;.
--- Host &#40;&#41;  Port &#40;&#41;
&gt;&gt;&gt; QUIT
&lt;&lt;&lt; 2
&lt;&lt;&lt; 21 Goodbye!
Attempted to read past end of response! &#40;421 Connection closing&#41;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1076641" href="/Public/Bug/Display.html?id=77072#txn-1076641">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;10&nbsp;23:13:12&nbsp;2012</span>
    <span class="description">CLEACH [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1076641/566500/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/566500">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 833b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thanks for the log file.  I immediately saw the bug in my suggested
patch.  Can you try it again with the patch below and return the log
file again?  This should fix the Auto PRET bug.


unless &#40; $self-&gt;command &#40;&#34;PASV&#34;&#41;-&gt;response &#40;&#41; == CMD_OK &#41; {
   if &#40;$self-&gt;last_message&#40;&#41; =~ /&#40;^|\s&#41;PRET&#40;$|[\s.!?]&#41;/i&#41; {
      ${*$self}{Pret} = 1; # Turns PRET on for all future calls to
_pasv&#40;&#41; even if it fails!
      $self-&gt;_print_DBG &#40;&#34;&lt;&lt;+ Auto-adding PRET option!\n&#34;&#41;;
      return &#40;$self-&gt;_pasv&#40; @_&#41;&#41;;
   } else {
      $self-&gt;_croak_or_return &#40;&#41;;
      return &#40;$host, $port&#41;;
   } 
}

I had forgotten return to the caller what the recursive call to _pasv&#40;&#41;
returned!

Curtis

On Thu May 10 00:11:44 2012, STEFANOS wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; I think is it not enough?
&gt; 
&gt; With force pret =&gt; 1 works good but auto pret with your code not, see
&gt; the log.
&gt; 
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1076644" href="/Public/Bug/Display.html?id=77072#txn-1076644">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;10&nbsp;23:37:00&nbsp;2012</span>
    <span class="description">stefanos [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1076644/566504/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/566504">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 37b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Wonderful!
The patch is good, thanks.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> mylog.txt</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1076644/566505/mylog.txt">Download mylog.txt</a><br />
<span class="downloadcontenttype">text/plain 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
Net-FTPSSL Version: 0.21

Perl: 5.010001  [5.10.1],  OS: MSWin32

Server &#40;port&#41;: localhost &#40;33333&#41;

Keys: &#40;Debug&#41;, &#40;Port&#41;, &#40;Timeout&#41;, &#40;DebugLogFile&#41;
Values: &#40;1&#41;, &#40;33333&#41;, &#40;10&#41;, &#40;mylog.txt&#41;

SKT &lt;&lt;&lt; 220 OFFLiNE
SKT &gt;&gt;&gt; AUTH TLS
SKT &lt;&lt;&lt; 234 AUTH TLS successful
&gt;&gt;&gt; USER +++++++
&lt;&lt;&lt; 331 Password required for &lt;++++++&gt;.
&gt;&gt;&gt; PASS *******
&lt;&lt;&lt; 2
&lt;&lt;&lt; 30- 
&lt;&lt;&lt; 230-         Welcome to the future of FXP:ing
&lt;&lt;&lt; 230-      ___      _____________  ___
&lt;&lt;&lt; 230-     / _ \____/ __/_  __/ _ \/ _ \
&lt;&lt;&lt; 230-    / // / __/ _/  / / / ___/ // /
&lt;&lt;&lt; 230-   /____/_/ /_/   /_/ /_/  /____/
&lt;&lt;&lt; 230-                   DistRibuted FTP Daemon
&lt;&lt;&lt; 230-                        <span class="clickylink"><a target="new" rel="nofollow" href="http://drftpd.org">http://drftpd.org</a></span>
&lt;&lt;&lt; 230 &lt;++++++&gt; logged in successfully.
&gt;&gt;&gt; TYPE I
&lt;&lt;&lt; 2
&lt;&lt;&lt; 00 Command okay
&gt;&gt;&gt; CWD /
&lt;&lt;&lt; 2
&lt;&lt;&lt; 50 Directory changed to /
&gt;&gt;&gt; PBSZ 0
&lt;&lt;&lt; 2
&lt;&lt;&lt; 00 Command okay
&gt;&gt;&gt; PROT P
&lt;&lt;&lt; 2
&lt;&lt;&lt; 00 Command okay
&gt;&gt;&gt; PASV
&lt;&lt;&lt; 5
&lt;&lt;&lt; 00 You need to use a client supporting PRET &#40;PRE Transfer&#41; to use PASV
&lt;&lt;+ Auto-adding PRET option!
&gt;&gt;&gt; PRET LIST
&lt;&lt;&lt; 2
&lt;&lt;&lt; 00 OK, will use master for upcoming transfer
&gt;&gt;&gt; PASV
&lt;&lt;&lt; 2
&lt;&lt;&lt; 27 Entering Passive Mode &#40;87,98,244,138,236,32&#41;.
--- Host &#40;87.98.244.138&#41;  Port &#40;60448&#41;
&gt;&gt;&gt; LIST /
&lt;&lt;&lt; 1
&lt;&lt;&lt; 50 File status okay; about to open data connection.
&lt;&lt;&lt; 226 Closing data connection
&gt;&gt;&gt; QUIT
&lt;&lt;&lt; 2
&lt;&lt;&lt; 21 Goodbye!
Attempted to read past end of response! &#40;421 Connection closing&#41;
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1076647" href="/Public/Bug/Display.html?id=77072#txn-1076647">#</a>      
    </span>
    <span class="date">Thu&nbsp;May&nbsp;10&nbsp;23:38:04&nbsp;2012</span>
    <span class="description">stefanos [...] cpan.org -  Status changed from &#39;open&#39; to &#39;patched&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1083945" href="/Public/Bug/Display.html?id=77072#txn-1083945">#</a>      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;27&nbsp;02:14:22&nbsp;2012</span>
    <span class="description">CLEACH [...] cpan.org -  Status changed from &#39;patched&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1083947" href="/Public/Bug/Display.html?id=77072#txn-1083947">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Sun&nbsp;May&nbsp;27&nbsp;02:14:22&nbsp;2012</span>
    <span class="description">CLEACH [...] cpan.org -  Fixed in 0.22 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.540778</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
