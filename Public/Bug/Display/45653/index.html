<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #45653 for DateTime: from_epoch does not accept an overloaded object</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #45653 for DateTime: from_epoch does not accept an overloaded object</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=DateTime">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=DateTime">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=DateTime">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=DateTime">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://github.com/houseabsolute/DateTime.pm/issues">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/DateTime">DateTime CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">45653</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=DateTime">DateTime</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
mschwern [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-9734-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.47    </td>
  </tr>
  <tr id="CF-9735-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.48    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




0001-Add-some-tests-to-show-that-strings-don-t-work.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/599472/303911/0001-Add-some-tests-to-show-that-strings-don-t-work.patch">
Sat May 02 20:26:05 2009 (1.3k) by mschwern [...] cpan.org
</a>
</font></li>
</ul>


0001-Make-epoch-accept-an-overloaded-object.patch<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/599459/303897/0001-Make-epoch-accept-an-overloaded-object.patch">
Sat May 02 20:17:04 2009 (1.7k) by mschwern [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=45653">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-599445" href="/Public/Bug/Display.html?id=45653#txn-599445">#</a>      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;02&nbsp;19:38:39&nbsp;2009</span>
    <span class="description">mschwern [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> from_epoch does not accept an overloaded object</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/599445/303882/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/303882">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 722b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I overloaded time&#40;&#41; to return a DateTime object which numifies to an
epoch.  I handed that to DateTime-&gt;from_epoch&#40; epoch =&gt; $time &#41; and got...

The &#39;epoch&#39; parameter &#40;&#34;1241307069&#34;&#41; to DateTime::from_epoch was a
&#39;hashref object&#39;, which is not one of the allowed types: scalar
 at
/usr/local/perl/5.10.0/lib/site_perl/5.10.0/darwin-thread-multi-2level/DateTime.pm
line 452
        DateTime::from_epoch&#40;undef, &#39;epoch&#39;, &#39;DateTime::time=HASH&#40;0xa6f8a0&#41;&#39;,
&#39;formatter&#39;, &#39;DateTime::Format::CTime&#39;&#41; called at lib/perl5i.pm line 202

DateTime is being too picky and piercing the transparency of
overloading.  It should allow an object, or it can take a more specific
type like NUMBER which just checks that the argument acts like a number.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-599450" href="/Public/Bug/Display.html?id=45653#txn-599450">#</a>      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;02&nbsp;19:40:51&nbsp;2009</span>
    <span class="description">autarch [...] urth.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #45653] from_epoch does not accept an overloaded object </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 2 May 2009 18:40:31 -0500 &#40;CDT&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Michael G Schwern via RT &lt;bug-DateTime [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dave Rolsky &lt;autarch [...] urth.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/599450/303887/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/303887">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 745b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat, 2 May 2009, Michael G Schwern via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; DateTime is being too picky and piercing the transparency of
&gt; overloading.  It should allow an object, or it can take a more specific
&gt; type like NUMBER which just checks that the argument acts like a number.
</div>
Welcome to Perl. Overloading sucks here.

Patches welcome to explicitly check for overloading. I don&#39;t want to just 
take anything, cause a string would end up getting numified &#40;usually to 
0&#41;, which would be really annoying.


-dave

/*============================================================
<span class="clickylink"><a target="new" rel="nofollow" href="http://VegGuide.org">http://VegGuide.org</a></span>               <span class="clickylink"><a target="new" rel="nofollow" href="http://blog.urth.org">http://blog.urth.org</a></span>
Your guide to all that&#39;s veg      House Absolute&#40;ly Pointless&#41;
============================================================*/
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-599451" href="/Public/Bug/Display.html?id=45653#txn-599451">#</a>      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;02&nbsp;19:40:52&nbsp;2009</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-599459" href="/Public/Bug/Display.html?id=45653#txn-599459">#</a>      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;02&nbsp;20:17:03&nbsp;2009</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/599459/303894/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/303894">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 19b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">And here&#39;s the fix.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/599459/303897/0001-Make-epoch-accept-an-overloaded-object.patch">Download 0001-Make-epoch-accept-an-overloaded-object.patch</a><br />
<span class="downloadcontenttype">text/x-diff 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 6afbc737c9453d300e910cf7cdfb51c926c44dca Mon Sep 17 00:00:00 2001
From: Michael G. Schwern &lt;schwern@pobox.com&gt;
Date: Sat, 2 May 2009 17:16:13 -0700
Subject: [PATCH] Make epoch accept an overloaded object.
 <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=45653">https://rt.cpan.org/Ticket/Display.html?id=45653</a></span>

---
 lib/DateTime.pm |    5 ++++-
 t/04epoch.t     |   22 +++++++++++++++++++++-
 2 files changed, 25 insertions&#40;+&#41;, 2 deletions&#40;-&#41;

diff --git a/lib/DateTime.pm b/lib/DateTime.pm
index 6407588..e544777 100644
--- a/lib/DateTime.pm
+++ b/lib/DateTime.pm
@@ -438,7 +438,10 @@ sub _utc_hms
 }
 
 {
-    my $spec = { epoch =&gt; { type =&gt; SCALAR },
+    my $spec = { epoch      =&gt; {
+                   # Decimal number
+                   regex =&gt; qr/^-?&#40;?:\d+&#40;?:\.\d*&#41;?|\.\d+&#41;$/
+                 },
                  locale     =&gt; { type =&gt; SCALAR | OBJECT, optional =&gt; 1 },
                  language   =&gt; { type =&gt; SCALAR | OBJECT, optional =&gt; 1 },
                  time_zone  =&gt; { type =&gt; SCALAR | OBJECT, optional =&gt; 1 },
diff --git a/t/04epoch.t b/t/04epoch.t
index 28daa67..85c4c59 100644
--- a/t/04epoch.t
+++ b/t/04epoch.t
@@ -2,7 +2,7 @@
 
 use strict;
 
-use Test::More tests =&gt; 32;
+use Test::More tests =&gt; 34;
 
 use DateTime;
 
@@ -121,3 +121,23 @@ SKIP:
     is&#40; $dt-&gt;day,     1, &#39;day should be 1904&#39; &#41;;
 }
 
+
+# Test with an overloaded object
+{
+    {
+        package Local::Overloaded;
+        use overload
+          &#34;0+&#34;          =&gt; sub { ${$_[0]} },
+          fallback      =&gt; 1;
+
+        sub new { bless \$_[1], $_[0] }
+    }
+
+    my $time = Local::Overloaded-&gt;new&#40;12345&#41;;
+    is $time, 12345, &#34;overloaded test object works&#34;;
+
+    my $dt = DateTime-&gt;from_epoch&#40;
+        epoch =&gt; $time
+    &#41;;
+    is $dt-&gt;epoch, 12345, &#34;epoch accepts an overloaded object&#34;;
+}
-- 
1.6.2.4

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-599472" href="/Public/Bug/Display.html?id=45653#txn-599472">#</a>      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;02&nbsp;20:26:04&nbsp;2009</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/599472/303908/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/303908">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 200b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">And here&#39;s some tests to show it will DTRT with strings.

It would be nice if Params::Validate had options like NUMBER and INTEGER
and all that rather than having to cut &#38; paste a regex from perlfaq4.
</div></div>
</div>
<div class="messageattachments">
<div class="messagebody">
<div class="message-stanza plain-text-white-space">
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/599472/303911/0001-Add-some-tests-to-show-that-strings-don-t-work.patch">Download 0001-Add-some-tests-to-show-that-strings-don-t-work.patch</a><br />
<span class="downloadcontenttype">text/x-diff 1.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">From 32da6ac368ce65cc7eed0cfae1b285ec32fa5979 Mon Sep 17 00:00:00 2001
From: Michael G. Schwern &lt;schwern@pobox.com&gt;
Date: Sat, 2 May 2009 17:24:48 -0700
Subject: [PATCH] Add some tests to show that strings don&#39;t work.

---
 t/04epoch.t |   36 +++++++++++++++++++++++++++++++++++-
 1 files changed, 35 insertions&#40;+&#41;, 1 deletions&#40;-&#41;

diff --git a/t/04epoch.t b/t/04epoch.t
index 85c4c59..85fbce5 100644
--- a/t/04epoch.t
+++ b/t/04epoch.t
@@ -2,7 +2,7 @@
 
 use strict;
 
-use Test::More tests =&gt; 34;
+use Test::More tests =&gt; 42;
 
 use DateTime;
 
@@ -140,4 +140,38 @@ SKIP:
         epoch =&gt; $time
     &#41;;
     is $dt-&gt;epoch, 12345, &#34;epoch accepts an overloaded object&#34;;
+
+
+    $time = Local::Overloaded-&gt;new&#40;-12345&#41;;
+    my $dt = DateTime-&gt;from_epoch&#40;
+        epoch =&gt; $time
+    &#41;;
+    is $dt-&gt;epoch, -12345, &#34;  negative epoch&#34;;
+
+
+    $time = Local::Overloaded-&gt;new&#40;12345.1234&#41;;
+    my $dt = DateTime-&gt;from_epoch&#40;
+        epoch =&gt; $time
+    &#41;;
+    is $dt-&gt;epoch, 12345, &#34;  decimal epoch&#34;;
+}
+
+
+# Test with bogus strings
+{
+    my @tests = &#40;
+        &#34;asldkjlkjd&#34;,
+        &#34;1234 foo&#34;,
+        &#34;adlkj 1234&#34;,
+    &#41;;
+
+    for my $test &#40;@tests&#41; {
+        ok !eval {
+            DateTime-&gt;from_epoch&#40;
+                epoch =&gt; $test
+            &#41;;
+            1;
+        }, $test;
+        like $@, qr/did not pass regex check/;
+    }
 }
-- 
1.6.2.4

</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-599474" href="/Public/Bug/Display.html?id=45653#txn-599474">#</a>      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;02&nbsp;20:27:45&nbsp;2009</span>
    <span class="description">mschwern [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/599474/303913/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/303913">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 841b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat May 02 19:40:51 2009, autarch@urth.org wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Sat, 2 May 2009, Michael G Schwern via RT wrote:
&gt; 
<div class="message-stanza open">&gt; &gt; DateTime is being too picky and piercing the transparency of
&gt; &gt; overloading.  It should allow an object, or it can take a more specific
&gt; &gt; type like NUMBER which just checks that the argument acts like a number.
</div>&gt; 
&gt; Welcome to Perl. Overloading sucks here.
&gt; 
&gt; Patches welcome to explicitly check for overloading. I don&#39;t want to just 
&gt; take anything, cause a string would end up getting numified &#40;usually to 
&gt; 0&#41;, which would be really annoying.
</div>
Working with overloaded objects is like Fight Club.  The first rule of
dealing with overloaded objects is to not ask if its an overloaded
object.  The second rule of using an overloaded object is TO NOT ASK IF
ITS AN OVERLOADED OBJECT!

Ignore the type, test the behavior.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-599476" href="/Public/Bug/Display.html?id=45653#txn-599476">#</a>      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;02&nbsp;20:46:06&nbsp;2009</span>
    <span class="description">autarch [...] urth.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #45653] from_epoch does not accept an overloaded object </td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Sat, 2 May 2009 19:45:48 -0500 &#40;CDT&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Michael G Schwern via RT &lt;bug-DateTime [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Dave Rolsky &lt;autarch [...] urth.org&gt;</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/599476/303915/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/303915">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 800b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat, 2 May 2009, Michael G Schwern via RT wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Working with overloaded objects is like Fight Club.  The first rule of
&gt; dealing with overloaded objects is to not ask if its an overloaded
&gt; object.  The second rule of using an overloaded object is TO NOT ASK IF
&gt; ITS AN OVERLOADED OBJECT!
&gt;
&gt; Ignore the type, test the behavior.
</div>
Unfortunately, that&#39;s not so easy. In a role-using language, I&#39;d just say 
&#34;does =&gt; Number&#34; and be done with it. But in Perl 5, you have to guess 
&#40;with a regex, or &#34;0 + $num eq $num&#34;, or some other madness&#41;.


-dave

/*============================================================
<span class="clickylink"><a target="new" rel="nofollow" href="http://VegGuide.org">http://VegGuide.org</a></span>               <span class="clickylink"><a target="new" rel="nofollow" href="http://blog.urth.org">http://blog.urth.org</a></span>
Your guide to all that&#39;s veg      House Absolute&#40;ly Pointless&#41;
============================================================*/
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-602522" href="/Public/Bug/Display.html?id=45653#txn-602522">#</a>      
    </span>
    <span class="date">Fri&nbsp;May&nbsp;08&nbsp;09:49:36&nbsp;2009</span>
    <span class="description">DROLSKY [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-602524" href="/Public/Bug/Display.html?id=45653#txn-602524">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Fri&nbsp;May&nbsp;08&nbsp;09:49:36&nbsp;2009</span>
    <span class="description">DROLSKY [...] cpan.org -  Fixed in 0.48 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.578327</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
