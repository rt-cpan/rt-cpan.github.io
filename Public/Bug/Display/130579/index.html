<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #130579 for Text-CSV_XS: Using getline&#40;&#41; after bind_columns&#40;&#41; returns undef even though data exists</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #130579 for Text-CSV_XS: Using getline&#40;&#41; after bind_columns&#40;&#41; returns undef even though data exists</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do I…?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Text-CSV_XS">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Text-CSV_XS">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Text-CSV_XS">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Text-CSV_XS">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Text-CSV_XS">Text-CSV_XS CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">130579</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">rejected</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Text-CSV_XS">Text-CSV_XS</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
m.mokotov [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-31868-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-31869-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=130579">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1865175" href="/Public/Bug/Display.html?id=130579#txn-1865175">#</a>      
    </span>
    <span class="date">Wed&nbsp;Sep&nbsp;25&nbsp;16:59:57&nbsp;2019</span>
    <span class="description">m.mokotov [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Using getline&#40;&#41; after bind_columns&#40;&#41; returns undef even though data exists</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 25 Sep 2019 15:59:36 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Text-CSV_XS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Mickey M.&#34; &lt;m.mokotov [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1865175/1001603/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1001603">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

We use Text-CSV::XS for a while and it&#39;s awesome. Recently we encounter a
weird behavior. Using getline&#40;&#41; after bind_columns&#40;&#41; returns undef for
specific parsed data. We isolated the case to something reproducible, here
it is:

*Env:*

$ sudo cpanm Text::CSV_XS
Text::CSV_XS is up to date. &#40;1.40&#41;

$ perl -v
This is perl 5, version 16, subversion 3 &#40;v5.16.3&#41; built for
x86_64-linux-thread-multi

*Code:*

my $row = {};
my $reader = new Text::CSV_XS&#40; { binary =&gt; 1, sep_char =&gt; &#34;|&#34; } &#41;;
$reader-&gt;bind_columns&#40; \@{ $row }{ qw&#40; a1 a2 a3 a4 a5 a6 a7 a8 a9 a10 a11
a12 a13 a14 a15 a16 a17 a18 a19 a20 a21 a22 a23 a24 a25 a26 a27 a28 a29 a30
a31 a32 a33 a34 a35 a36 a37 a38 a39 &#41; } &#41;;
use Data::Dumper;
print Dumper&#40; $reader-&gt;getline&#40; *STDIN &#41; &#41;;
print Dumper&#40; $row &#41;;

*Data &#40;note the &#34; on val10&#41;:*

val1|val2|val3|val4|val5|val6|val7|val8|val9|val10&#34;|val11|val12|val13|val14|val15|val16|val17|val18|val19|val20|val21|val22|val23|val24|val25|val26|val27|val28|val29|val30|val31|val32|val33|val34|val35|val36|val37|val38|val39

Thanks,
Mickey.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1865175/1001604/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1001604">with headers</a>
<br />
<span class="downloadcontenttype">text/html 1.6k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1865202" href="/Public/Bug/Display.html?id=130579#txn-1865202">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;26&nbsp;03:34:48&nbsp;2019</span>
    <span class="description">HMBRAND [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1865202/1001615/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1001615">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">I think I would have to mark this as not a bug. You might assume that choosing the &#39;|&#39; as separator changes more than just the separator, but the &#39;&#34;&#39; in the data is a parse error, which you would have seen if you also enabled the diagnostics:

--8&lt;---
use Text::CSV_XS;

my @hdr = map { &#34;a$_&#34; } 1..39;
my $row = {};
my $reader = new Text::CSV_XS &#40;{ binary =&gt; 1, sep_char =&gt; &#34;|&#34;, auto_diag =&gt; 1 }&#41;;
$reader-&gt;bind_columns &#40;\@{$row}{@hdr}&#41;;
$reader-&gt;getline &#40;*DATA&#41;;
__END__
val1|val2|val3|val4|val5|val6|val7|val8|val9|val10&#34;|val11|val12|val13|val14|val15|val16|val17|val18|val19|val20|val21|val22|val23|val24|val25|val26|val27|val28|val29|val30|val31|val32|val33|val34|val35|val36|val37|val38|val39
--&gt;8---

will show you

--8&lt;---
# CSV_XS ERROR: 2034 - EIF - Loose unescaped quote @ rec 0 pos 51 field 10
--&gt;8---

If you want the &#39;&#34;&#39; to be valid part of the data, you need to add the &#34;allow_loose_quotes&#34; attribute:

--8&lt;---
my $reader = new Text::CSV_XS &#40;{
    binary             =&gt; 1,
    sep_char           =&gt; &#34;|&#34;,
    allow_loose_quotes =&gt; 1,
    auto_diag          =&gt; 1,
    }&#41;;
--&gt;8---
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1865203" href="/Public/Bug/Display.html?id=130579#txn-1865203">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;26&nbsp;03:34:48&nbsp;2019</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1865236" href="/Public/Bug/Display.html?id=130579#txn-1865236">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;26&nbsp;10:22:08&nbsp;2019</span>
    <span class="description">m.mokotov [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #130579] Using getline&#40;&#41; after bind_columns&#40;&#41; returns undef even though data exists</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 26 Sep 2019 09:21:35 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Text-CSV_XS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;Mickey M.&#34; &lt;m.mokotov [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1865236/1001626/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1001626">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.6k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi and thanks for the quick reply!

It&#39;s of course your call to decide if this is a bug or not. From a user
perspective, it&#39;s usually expected that a configuration change will only
affect the specific changed configuration and not other behaviors.

That said, your library is amazing 👍

Take care and again thanks for the help,
Mickey.

On Thu, Sep 26, 2019 at 2:34 AM H.Merijn Brand via RT &lt;
bug-Text-CSV_XS@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=130579">https://rt.cpan.org/Ticket/Display.html?id=130579</a></span> &gt;
&gt;
&gt; I think I would have to mark this as not a bug. You might assume that
&gt; choosing the &#39;|&#39; as separator changes more than just the separator, but the
&gt; &#39;&#34;&#39; in the data is a parse error, which you would have seen if you also
&gt; enabled the diagnostics:
&gt;
&gt; --8&lt;---
&gt; use Text::CSV_XS;
&gt;
&gt; my @hdr = map { &#34;a$_&#34; } 1..39;
&gt; my $row = {};
&gt; my $reader = new Text::CSV_XS &#40;{ binary =&gt; 1, sep_char =&gt; &#34;|&#34;, auto_diag
&gt; =&gt; 1 }&#41;;
&gt; $reader-&gt;bind_columns &#40;\@{$row}{@hdr}&#41;;
&gt; $reader-&gt;getline &#40;*DATA&#41;;
&gt; __END__
&gt;
&gt; val1|val2|val3|val4|val5|val6|val7|val8|val9|val10&#34;|val11|val12|val13|val14|val15|val16|val17|val18|val19|val20|val21|val22|val23|val24|val25|val26|val27|val28|val29|val30|val31|val32|val33|val34|val35|val36|val37|val38|val39
&gt; --&gt;8---
&gt;
&gt; will show you
&gt;
&gt; --8&lt;---
&gt; # CSV_XS ERROR: 2034 - EIF - Loose unescaped quote @ rec 0 pos 51 field 10
&gt; --&gt;8---
&gt;
&gt; If you want the &#39;&#34;&#39; to be valid part of the data, you need to add the
&gt; &#34;allow_loose_quotes&#34; attribute:
&gt;
&gt; --8&lt;---
&gt; my $reader = new Text::CSV_XS &#40;{
&gt;     binary             =&gt; 1,
&gt;     sep_char           =&gt; &#34;|&#34;,
&gt;     allow_loose_quotes =&gt; 1,
&gt;     auto_diag          =&gt; 1,
&gt;     }&#41;;
&gt; --&gt;8---
&gt;
</div>

-- 

Thanks,
Mickey.

--
This email is short to save you time.
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1865236/1001627/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1001627">with headers</a>
<br />
<span class="downloadcontenttype">text/html 2.5k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1865242" href="/Public/Bug/Display.html?id=130579#txn-1865242">#</a>      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;26&nbsp;11:01:44&nbsp;2019</span>
    <span class="description">h.m.brand [...] xs4all.nl -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #130579] Using getline&#40;&#41; after bind_columns&#40;&#41; returns undef even though data exists</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 26 Sep 2019 17:01:11 +0200</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Text-CSV_XS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> &#34;H.Merijn Brand&#34; &lt;h.m.brand [...] xs4all.nl&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1865242/1001631/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1001631">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Thu, 26 Sep 2019 10:22:08 -0400, &#34;Mickey M. via RT&#34;
&lt;bug-Text-CSV_XS@rt.cpan.org&gt; wrote:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Hi and thanks for the quick reply!
&gt; 
&gt; It&#39;s of course your call to decide if this is a bug or not. From a
&gt; user perspective, it&#39;s usually expected that a configuration change
&gt; will only affect the specific changed configuration and not other
&gt; behaviors.
&gt; 
&gt; That said, your library is amazing 👍
</div>
It is definitely not a bug, and it it explicitly documented what the
current &#40;expected&#41; behavior is:

  bind_columns
    Takes a list of scalar references to be used for output with &#34;print&#34; or
    to store in the fields fetched by &#34;getline&#34;. When you do not pass enough
    references to store the fetched fields in, &#34;getline&#34; will fail with
    error 3006. If you pass more than there are fields to return, the
    content of the remaining references is left untouched.

So, here you passed 32 entries to the bind_columns col, so any getline
will on-the-fly fill the bound fields.

In the posted case, you tell the parser to store its fields in
@{$row}{&#34;a01&#34;..&#34;a31&#34;}. There has no data been parsed yet, so there is
no error or ambiguity. Now you call getline on an erroneous CSV data
line: the &#34; is not allowed in the specs. As CSV is parsed on a
byte-by-byte or character-to-character basis to enable streaming, the
first 9 fields are perfectly fine. Then a new unquoted field starts,
and - as you bound the columns, will *directly* be stored in your hash,
character by character until it hits an error and stops. Using
error_diag =&gt; 1 would have shown you right away.

If in your dataset, the &#34; are completely meaningless, which implies
that embedded newlines or separation characters are not possible, there
are two ways to get around that problem:

1. Allow these exceptions

   allow_loose_quotes  =&gt; 1,
   allow_loose_escapes =&gt; 1,

2. Work without these special characters

   quote_char  =&gt; undef,
   escape_char =&gt; undef,

It is up to you to decide what option is best

-- 
H.Merijn Brand  <span class="clickylink"><a target="new" rel="nofollow" href="http://tux.nl">http://tux.nl</a></span>   Perl Monger  <span class="clickylink"><a target="new" rel="nofollow" href="http://amsterdam.pm.org/">http://amsterdam.pm.org/</a></span>
using perl5.00307 .. 5.31      porting perl5 on HP-UX, AIX, and Linux
<span class="clickylink"><a target="new" rel="nofollow" href="https://useplaintext.email">https://useplaintext.email</a></span>  <span class="clickylink"><a target="new" rel="nofollow" href="https://tux.nl">https://tux.nl</a></span>  <span class="clickylink"><a target="new" rel="nofollow" href="http://www.test-smoke.org">http://www.test-smoke.org</a></span>
<span class="clickylink"><a target="new" rel="nofollow" href="http://qa.perl.org">http://qa.perl.org</a></span>   <span class="clickylink"><a target="new" rel="nofollow" href="http://www.goldmark.org/jeff/stupid-disclaimers/">http://www.goldmark.org/jeff/stupid-disclaimers/</a></span>
</div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1865242/1001632/">Download &#40;untitled&#41;</a><br />
<span class="downloadcontenttype">application/pgp-signature 488b</span>
</div>
<div class="messagebody">
<p>Message body not shown because it is not plain text.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1865259" href="/Public/Bug/Display.html?id=130579#txn-1865259">#</a>      
    </span>
    <span class="date">Fri&nbsp;Sep&nbsp;27&nbsp;03:44:11&nbsp;2019</span>
    <span class="description">HMBRAND [...] cpan.org -  Status changed from &#39;open&#39; to &#39;rejected&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1866030" href="/Public/Bug/Display.html?id=130579#txn-1866030">#</a>      
    </span>
    <span class="date">Thu&nbsp;Oct&nbsp;03&nbsp;15:28:12&nbsp;2019</span>
    <span class="description">m.mokotov [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #130579] Using getline&#40;&#41; after bind_columns&#40;&#41; returns undef even though data exists</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 3 Oct 2019 14:28:01 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Text-CSV_XS [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Mickey &lt;m.mokotov [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1866030/1001972/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1001972">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Thank you for the complete answer!

Thanks,
Mickey.

--
This email is short to save you time.

On 09/26/2019 10:01 AM, h.m.brand@xs4all.nl via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=130579">https://rt.cpan.org/Ticket/Display.html?id=130579</a></span> &gt;
&gt;
&gt; On Thu, 26 Sep 2019 10:22:08 -0400, &#34;Mickey M. via RT&#34;
&gt; &lt;bug-Text-CSV_XS@rt.cpan.org&gt; wrote:
&gt;
<div class="message-stanza open">&gt;&gt; Hi and thanks for the quick reply!
&gt;&gt;
&gt;&gt; It&#39;s of course your call to decide if this is a bug or not. From a
&gt;&gt; user perspective, it&#39;s usually expected that a configuration change
&gt;&gt; will only affect the specific changed configuration and not other
&gt;&gt; behaviors.
&gt;&gt;
&gt;&gt; That said, your library is amazing 👍
</div>&gt; It is definitely not a bug, and it it explicitly documented what the
&gt; current &#40;expected&#41; behavior is:
&gt;
&gt;    bind_columns
&gt;      Takes a list of scalar references to be used for output with &#34;print&#34; or
&gt;      to store in the fields fetched by &#34;getline&#34;. When you do not pass enough
&gt;      references to store the fetched fields in, &#34;getline&#34; will fail with
&gt;      error 3006. If you pass more than there are fields to return, the
&gt;      content of the remaining references is left untouched.
&gt;
&gt; So, here you passed 32 entries to the bind_columns col, so any getline
&gt; will on-the-fly fill the bound fields.
&gt;
&gt; In the posted case, you tell the parser to store its fields in
&gt; @{$row}{&#34;a01&#34;..&#34;a31&#34;}. There has no data been parsed yet, so there is
&gt; no error or ambiguity. Now you call getline on an erroneous CSV data
&gt; line: the &#34; is not allowed in the specs. As CSV is parsed on a
&gt; byte-by-byte or character-to-character basis to enable streaming, the
&gt; first 9 fields are perfectly fine. Then a new unquoted field starts,
&gt; and - as you bound the columns, will *directly* be stored in your hash,
&gt; character by character until it hits an error and stops. Using
&gt; error_diag =&gt; 1 would have shown you right away.
&gt;
&gt; If in your dataset, the &#34; are completely meaningless, which implies
&gt; that embedded newlines or separation characters are not possible, there
&gt; are two ways to get around that problem:
&gt;
&gt; 1. Allow these exceptions
&gt;
&gt;     allow_loose_quotes  =&gt; 1,
&gt;     allow_loose_escapes =&gt; 1,
&gt;
&gt; 2. Work without these special characters
&gt;
&gt;     quote_char  =&gt; undef,
&gt;     escape_char =&gt; undef,
&gt;
&gt; It is up to you to decide what option is best
&gt;
</div></div></div>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1866030/1001973/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/1001973">with headers</a>
<br />
<span class="downloadcontenttype">text/html 3.2k</span>
</div>
<div class="messagebody">
</div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.544639</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
