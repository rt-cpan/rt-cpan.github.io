<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #57208 for Data-Pageset: Slide mode next set broken</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #57208 for Data-Pageset: Slide mode next set broken</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Data-Pageset">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Data-Pageset">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Data-Pageset">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Data-Pageset">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Data-Pageset">Data-Pageset CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">57208</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">new</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Data-Pageset">Data-Pageset</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
enquiries [...] mikeraynham.co.uk

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Normal    </td>
  </tr>
  <tr id="CF-9200-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
1.06    </td>
  </tr>
  <tr id="CF-9201-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




Pageset.pm<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/772444/399855/Pageset.pm">
Tue May 04 15:39:09 2010 (11.2k) by enquiries [...] mikeraynham.co.uk
</a>
</font></li>
</ul>


Test.pm<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/772444/399856/Test.pm">
Tue May 04 15:39:09 2010 (826b) by enquiries [...] mikeraynham.co.uk
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=57208">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-772444" href="/Public/Bug/Display.html?id=57208#txn-772444">#</a>      
    </span>
    <span class="date">Tue&nbsp;May&nbsp;04&nbsp;15:39:09&nbsp;2010</span>
    <span class="description">enquiries [...] mikeraynham.co.uk -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Slide mode next set broken</td>
  </tr>
</table>
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/772444/399854/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/399854">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 959b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

I have found a minor bug in Data::Pageset, the details of which are below.

Distribution: Data-Pageset-1.06
Perl version: 5.10.1
OS:           Debian Linux 5.0 &#34;Lenny&#34;

When Data::Pageset &#39;mode&#39; it set to &#39;slide&#39;, &#39;next_set&#39; can return a
value greater than the total number of pages &#40;last_page&#41;.

For example:

my $page_info = Data::Pageset-&gt;new&#40;{
        &#39;total_entries&#39;         =&gt; 100,
        &#39;entries_per_page&#39;      =&gt; 5,
        &#39;pages_per_set&#39;         =&gt; 5,
        &#39;mode&#39;                          =&gt; &#39;slide&#39;,
}&#41;;

$page_info-&gt;current_page&#40;16&#41;;
print &#34;Last page: &#34;, $page_info-&gt;last_page, &#34;\n&#34;;
print &#34;Next set:  &#34;, $page_info-&gt;next_set, &#34;\n&#34;;

Returns:
Last page: 20
Next set:  21

A quick and dirty fix is to add this to the end of the &#39;pages_per_set&#39; sub:

$self-&gt;{PAGE_SET_NEXT} = $self-&gt;last_page&#40;&#41;
    if $self-&gt;{PAGE_SET_NEXT} &gt; $self-&gt;last_page&#40;&#41;;

See lines 305 and 306 of the attached Pageset.pm file.

I have also attached a test script &#40;Test.pm&#41;, which demonstrates the
problem.


Regards,

Mike Raynham
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Pageset.pm</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/772444/399855/Pageset.pm">Download Pageset.pm</a><br />
<span class="downloadcontenttype">text/x-perl 11.2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">package Data::Pageset;

use strict;
use Carp;

use Data::Page;

use vars qw&#40;@ISA $VERSION&#41;;

@ISA = qw&#40;Data::Page&#41;;

$VERSION = &#39;1.06&#39;;

=head1 NAME

Data::Pageset - Page numbering and page sets

=head1 SYNOPSIS

  use Data::Pageset;
  my $page_info = Data::Pageset-&gt;new&#40;{
    &#39;total_entries&#39;       =&gt; $total_entries, 
    &#39;entries_per_page&#39;    =&gt; $entries_per_page, 
    # Optional, will use defaults otherwise.
    &#39;current_page&#39;        =&gt; $current_page,
    &#39;pages_per_set&#39;       =&gt; $pages_per_set,
    &#39;mode&#39;                =&gt; &#39;fixed&#39;, # default, or &#39;slide&#39;
  }&#41;;

  # General page information
  print &#34;         First page: &#34;, $page_info-&gt;first_page, &#34;\n&#34;;
  print &#34;          Last page: &#34;, $page_info-&gt;last_page, &#34;\n&#34;;
  print &#34;          Next page: &#34;, $page_info-&gt;next_page, &#34;\n&#34;;
  print &#34;      Previous page: &#34;, $page_info-&gt;previous_page, &#34;\n&#34;;

  # Results on current page
  print &#34;First entry on page: &#34;, $page_info-&gt;first, &#34;\n&#34;;
  print &#34; Last entry on page: &#34;, $page_info-&gt;last, &#34;\n&#34;;

  # Can add in the pages per set after the object is created
  $page_info-&gt;pages_per_set&#40;$pages_per_set&#41;;
  
  # Page set information
  print &#34;First page of previous page set: &#34;,  $page_info-&gt;previous_set, &#34;\n&#34;;
  print &#34;    First page of next page set: &#34;,  $page_info-&gt;next_set, &#34;\n&#34;;
  
  # Print the page numbers of the current set
  foreach my $page &#40;@{$page_info-&gt;pages_in_set&#40;&#41;}&#41; {
    if&#40;$page == $page_info-&gt;current_page&#40;&#41;&#41; {
      print &#34;&lt;b&gt;$page&lt;/b&gt; &#34;;
    } else {
      print &#34;$page &#34;;
    }
  }

=head1 DESCRIPTION

The object produced by Data::Pageset can be used to create page
navigation, it inherits from Data::Page and has access to all 
methods from this object.

In addition it also provides methods for dealing with set of pages,
so that if there are too many pages you can easily break them
into chunks for the user to browse through.

You can even choose to view page numbers in your set in a &#39;sliding&#39;
fassion.

The object can easily be passed to a templating system
such as Template Toolkit or be used within a script.

=head1 METHODS

=head2 new&#40;&#41;

  use Data::Pageset;
  my $page_info = Data::Pageset-&gt;new&#40;{
    &#39;total_entries&#39;       =&gt; $total_entries, 
    &#39;entries_per_page&#39;    =&gt; $entries_per_page, 
    # Optional, will use defaults otherwise.
    &#39;current_page&#39;        =&gt; $current_page,
    &#39;pages_per_set&#39;       =&gt; $pages_per_set,
    &#39;mode&#39;                =&gt; &#39;slide&#39;, # default fixed
  }&#41;;

This is the constructor of the object, it requires an anonymous
hash containing the &#39;total_entries&#39;, how many data units you have,
and the number of &#39;entries_per_page&#39; to display. Optionally
the &#39;current_page&#39; &#40;defaults to page 1&#41; and pages_per_set &#40;how
many pages to display, defaults to 10&#41; can be added. 

The mode &#40;which defaults to &#39;fixed&#39;&#41; determins how the paging
will work, for example with 10 pages_per_set and the current_page
set to 18 you will get the following results:

=head3 Fixed:

=over 4

=item Pages in set:

11,12,13,14,15,16,17,18,19,20

=item Previous page set:  

1

=item Next page set:

21

=back 4

=head3 Slide:

=over 4

=item Pages in set:

14,15,16,17,18,19,20,21,22,23

=item Previous page set:  

9

=item Next page set:

24

=back 4

You can not change modes once the object is created.

=cut

sub new {
    my &#40; $class, $conf &#41; = @_;
    my $self = {};

    croak &#34;total_entries and entries_per_page must be supplied&#34;
        unless defined $conf-&gt;{&#39;total_entries&#39;}
            &#38;&#38; defined $conf-&gt;{&#39;entries_per_page&#39;};

    $conf-&gt;{&#39;current_page&#39;} = 1 unless defined $conf-&gt;{&#39;current_page&#39;};
    $conf-&gt;{pages_per_set} = 10 unless defined $conf-&gt;{&#39;pages_per_set&#39;};
    if &#40; defined $conf-&gt;{&#39;mode&#39;} &#38;&#38; $conf-&gt;{&#39;mode&#39;} eq &#39;slide&#39; &#41; {
        $self-&gt;{mode} = &#39;slide&#39;;
    } else {
        $self-&gt;{mode} = &#39;fixed&#39;;
    }
    bless&#40; $self, $class &#41;;

    $self-&gt;total_entries&#40; $conf-&gt;{&#39;total_entries&#39;} &#41;;
    $self-&gt;entries_per_page&#40; $conf-&gt;{&#39;entries_per_page&#39;} &#41;;
    $self-&gt;current_page&#40; $conf-&gt;{&#39;current_page&#39;} &#41;;

    $self-&gt;pages_per_set&#40; $conf-&gt;{&#39;pages_per_set&#39;} &#41;;

    return $self;
}

=head2 current_page&#40;&#41;

  $page_info-&gt;current_page&#40;$page_num&#41;;

This method sets the current_page to the argument supplied, it can also be 
set in the constructor, but you may want to reuse the object if printing out
multiple pages. It will then return the page number once set. 

If this method is called without any arguments it returns the current page number.

=cut

sub current_page {
    my $self = shift;

    if &#40;@_&#41; {

        # Set current page
        $self-&gt;_current_page_accessor&#40;@_&#41;;

        # Redo calculations, using current pages_per_set value
        $self-&gt;pages_per_set&#40; $self-&gt;pages_per_set&#40;&#41; &#41;;
    }

    # Not sure if there is some cleaver way of calling SUPER here,
    # think it would have to be wrapped in an eval
    return $self-&gt;first_page
        if $self-&gt;_current_page_accessor &lt; $self-&gt;first_page;
    return $self-&gt;last_page
        if $self-&gt;_current_page_accessor &gt; $self-&gt;last_page;
    return $self-&gt;_current_page_accessor&#40;&#41;;
}

=head2 pages_per_set&#40;&#41;

  $page_info-&gt;pages_per_set&#40;$number_of_pages_per_set&#41;;

Calling this method initalises the calculations required to use
the paging methods below. The value can also be passed into
the constructor method new&#40;&#41;.

If called without any arguments it will return the current
number of pages per set.

=cut

sub pages_per_set {
    my $self              = shift;
    my $max_pages_per_set = shift;

    # set as undef so it at least exists
    $self-&gt;{PAGE_SET_PAGES_PER_SET} = undef
        unless exists $self-&gt;{PAGE_SET_PAGES_PER_SET};

    # Not trying to set, so return current number;
    return $self-&gt;{PAGE_SET_PAGES_PER_SET} unless $max_pages_per_set;

    $self-&gt;{PAGE_SET_PAGES_PER_SET} = $max_pages_per_set;

    unless &#40; $max_pages_per_set &gt; 1 &#41; {

        # Only have one page in the set, must be page 1
        $self-&gt;{PAGE_SET_PREVIOUS} = $self-&gt;current_page&#40;&#41; - 1
            if $self-&gt;current_page != 1;
        $self-&gt;{PAGE_SET_PAGES} = [1];
        $self-&gt;{PAGE_SET_NEXT}  = $self-&gt;current_page&#40;&#41; + 1
            if $self-&gt;current_page&#40;&#41; &lt; $self-&gt;last_page&#40;&#41;;
    } else {
        if &#40; $self-&gt;{mode} eq &#39;fixed&#39; &#41; {
            my $starting_page = $self-&gt;_calc_start_page&#40;$max_pages_per_set&#41;;
            my $end_page      = $starting_page + $max_pages_per_set - 1;

            if &#40; $end_page &lt; $self-&gt;last_page&#40;&#41; &#41; {
                $self-&gt;{PAGE_SET_NEXT} = $end_page + 1;
            }

            if &#40; $starting_page &gt; 1 &#41; {
                $self-&gt;{PAGE_SET_PREVIOUS}
                    = $starting_page - $max_pages_per_set;

           # I can&#39;t see a reason for this to be here!
           #$self-&gt;{PAGE_SET_PREVIOUS} =  1 if $self-&gt;{PAGE_SET_PREVIOUS} &lt; 1;
            }

            $end_page = $self-&gt;last_page&#40;&#41; if $self-&gt;last_page&#40;&#41; &lt; $end_page;
            $self-&gt;{PAGE_SET_PAGES} = [ $starting_page .. $end_page ];
        } else {

            # We&#39;re in slide mode

            # See if we have enough pages to slide
            if &#40; $max_pages_per_set &gt;= $self-&gt;last_page&#40;&#41; &#41; {

                # No sliding, no next/prev pageset
                $self-&gt;{PAGE_SET_PAGES} = [ &#39;1&#39; .. $self-&gt;last_page&#40;&#41; ];
            } else {

       # Find the middle rounding down - we want more pages after, than before
                my $middle = int&#40; $max_pages_per_set / 2 &#41;;

                # offset for extra value right of center on even numbered sets
                my $offset = 1;
                if &#40; $max_pages_per_set % 2 != 0 &#41; {

                    # must have been an odd number, add one
                    $middle++;
                    $offset = 0;
                }

                my $starting_page = $self-&gt;current_page&#40;&#41; - $middle + 1;
                $starting_page = 1 if $starting_page &lt; 1;
                my $end_page = $starting_page + $max_pages_per_set - 1;
                $end_page = $self-&gt;last_page&#40;&#41;
                    if $self-&gt;last_page&#40;&#41; &lt; $end_page;

                if &#40; $self-&gt;current_page&#40;&#41; &lt;= $middle &#41; {

                    # near the start of the page numbers
                    $self-&gt;{PAGE_SET_NEXT}
                        = $max_pages_per_set + $middle - $offset;
                    $self-&gt;{PAGE_SET_PAGES} = [ &#39;1&#39; .. $max_pages_per_set ];
                } elsif &#40; $self-&gt;current_page&#40;&#41;
                    &gt; &#40; $self-&gt;last_page&#40;&#41; - $middle - $offset &#41; &#41;
                {

                    # near the end of the page numbers
                    $self-&gt;{PAGE_SET_PREVIOUS}
                        = $self-&gt;last_page&#40;&#41; 
                        - $max_pages_per_set 
                        - $middle + 1;
                    $self-&gt;{PAGE_SET_PAGES}
                        = [ &#40; $self-&gt;last_page&#40;&#41; - $max_pages_per_set + 1 &#41;
                        .. $self-&gt;last_page&#40;&#41; ];
                } else {

                    # Start scrolling baby!
                    $self-&gt;{PAGE_SET_PAGES} = [ $starting_page .. $end_page ];
                    $self-&gt;{PAGE_SET_PREVIOUS}
                        = $starting_page - $middle - $offset;
                    $self-&gt;{PAGE_SET_PREVIOUS} = 1
                        if $self-&gt;{PAGE_SET_PREVIOUS} &lt; 1;
                    $self-&gt;{PAGE_SET_NEXT} = $end_page + $middle;
                }
                $self-&gt;{PAGE_SET_NEXT} = $self-&gt;last_page&#40;&#41;
                	if $self-&gt;{PAGE_SET_NEXT} &gt; $self-&gt;last_page&#40;&#41;;
            }
        }
    }

}

=head2 previous_set&#40;&#41;

  print &#34;Back to previous set which starts at &#34;, $page_info-&gt;previous_set&#40;&#41;, &#34;\n&#34;;

This method returns the page number at the start of the previous page set.
undef is return if pages_per_set has not been set.

=cut  

sub previous_set {
    my $self = shift;
    return $self-&gt;{PAGE_SET_PREVIOUS} if defined $self-&gt;{PAGE_SET_PREVIOUS};
    return undef;
}

=head2 next_set&#40;&#41;

  print &#34;Next set starts at &#34;, $page_info-&gt;next_set&#40;&#41;, &#34;\n&#34;;

This method returns the page number at the start of the next page set.
undef is return if pages_per_set has not been set.

=cut  

sub next_set {
    my $self = shift;
    return $self-&gt;{PAGE_SET_NEXT} if defined $self-&gt;{PAGE_SET_NEXT};
    return undef;
}

=head2 pages_in_set&#40;&#41;

  foreach my $page_num &#40;@{$page_info-&gt;pages_in_set&#40;&#41;}&#41; {
    print &#34;Page: $page_num \n&#34;;
  }

This method returns an array ref of the the page numbers within
the current set. undef is return if pages_per_set has not been set.

=cut  

sub pages_in_set {
    my $self = shift;
    return $self-&gt;{PAGE_SET_PAGES};
}

# Calc the first page in the current set
sub _calc_start_page {
    my &#40; $self, $max_page_links_per_page &#41; = @_;
    my $start_page;

    my $current_page = $self-&gt;current_page&#40;&#41;;
    my $max_pages_per_set;

    my $current_page_set = 0;

    if &#40; $max_page_links_per_page &gt; 0 &#41; {
        $current_page_set = int&#40; $current_page / $max_page_links_per_page &#41;;

        if &#40; $current_page % $max_page_links_per_page == 0 &#41; {
            $current_page_set = $current_page_set - 1;
        }
    }

    $start_page = &#40; $current_page_set * $max_page_links_per_page &#41; + 1;

    return $start_page;
}

=head1 EXPORT

None by default.

=head1 AUTHOR

Leo Lapworth C&lt;&lt; &lt;LLAP@cuckoo.org&gt; &gt;&gt;

=head1 REPOSITORY

<span class="clickylink"><a target="new" rel="nofollow" href="http://github.com/ranguard/data-pageset">http://github.com/ranguard/data-pageset</a></span>

=head1 CONTRIBUTORS

Ryan D Johnson C&lt;&lt; &lt;ryan@innerfence.com&gt; &gt;&gt;
PLOBBES

=head1 SEE ALSO

L&lt;Data::Page&gt;.

=head1 COPYRIGHT

Copyright &#40;C&#41; 2007, Leo Lapworth

This module is free software; you can redistribute it or modify it
under the same terms as Perl itself.

=cut

1;

</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Test.pm</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/772444/399856/Test.pm">Download Test.pm</a><br />
<span class="downloadcontenttype">text/x-perl 826b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">#!/usr/bin/perl

use strict;
use warnings;

use Test::More &#39;no_plan&#39;;

use Data::Pageset;

my $page_info = Data::Pageset-&gt;new&#40;{
	&#39;total_entries&#39;		=&gt; 100,
	&#39;entries_per_page&#39;	=&gt; 5,
	&#39;pages_per_set&#39;		=&gt; 5,
	&#39;mode&#39;				=&gt; &#39;slide&#39;,
}&#41;;

ok &#40; defined $page_info,
	 &#39;new&#40;&#41; returned something&#39; &#41;;
	 
ok &#40; $page_info-&gt;isa&#40; &#39;Data::Pageset&#39; &#41;,
     &#39;new&#40;&#41; returned a Data::Pageset object&#39;&#41;;
     
my $last_page = $page_info-&gt;last_page;

for my $page_num &#40;1..20&#41; {
	
	$page_info-&gt;current_page&#40;$page_num&#41;;
	
	is &#40; $page_info-&gt;current_page, $page_num, &#34;current_page is $page_num&#34; &#41;;
	
	foreach my $page &#40;@{$page_info-&gt;pages_in_set&#40;&#41;}&#41; {
		my $next_set = $page_info-&gt;next_set;
		
		ok &#40; $page_info-&gt;next_set &lt;= $page_info-&gt;last_page,
			 &#34;next_set &#40;$next_set&#41; is &lt;= last_page &#40;$last_page&#41;&#34; &#41;;
	}
}



</div></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.249662</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
