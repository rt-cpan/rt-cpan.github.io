<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #100714 for Captcha-reCAPTCHA: Doesn&#39;t support new API</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #100714 for Captcha-reCAPTCHA: Doesn&#39;t support new API</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Captcha-reCAPTCHA/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Captcha-reCAPTCHA/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Captcha-reCAPTCHA/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Captcha-reCAPTCHA/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Captcha-reCAPTCHA">Captcha-reCAPTCHA CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">100714</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Captcha-reCAPTCHA/Active/">Captcha-reCAPTCHA</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">SUNNYP [...] cpan.org
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
tlhackque [...] yahoo.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-43676-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
0.97    </td>
  </tr>
  <tr id="CF-43677-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
0.97    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Dec&nbsp;05&nbsp;00:26:48&nbsp;2014</span>
    <span class="description">tlhackque [...] yahoo.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Doesn&#39;t support new API</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Google has introduced a new API, which supports the new, easier to solve captchas.  It needs to be supported.

See <span class="clickylink"><a target="new" rel="nofollow" href="https://developers.google.com/recaptcha/">https://developers.google.com/recaptcha/</a></span> for the documentation.

It&#39;s actually easier to use.  I updated the squirrelmail php plugin in a few minutes.  For reference, here&#39;s the PHP code &#40;The globals are configurable options; the script ideally goes in &lt;head&gt;, but can be placed *anywhere*&#41;:

Display:
   $output .= &#34;&lt;script src=\&#34;<span class="clickylink"><a target="new" rel="nofollow" href="https://www.google.com/recaptcha/api.js">https://www.google.com/recaptcha/api.js</a></span>&#34;;
   if &#40;$recaptcha_fallback&#41; // force old-style captcha
   {
       $output .= &#34;?fallback=true&#34;;
       if &#40;!empty&#40;$recaptcha_language&#41;&#41; // force language &#40;default is autodetect&#41;
       {
           $output .= &#34;&#38;hl=&#34; . $recaptcha_language;
       }
   } elseif&#40; !empty&#40;$recaptcha_language&#41; &#41; {
           $output .= &#34;?hl=&#34; . $recaptcha_language;
   }

   $output .= &#34;\&#34; async defer&gt;&lt;/script&gt;&#34;;

   $output .= &#34;&lt;div class = \&#34;g-recaptcha\&#34; data-SiteKey = \&#34;&#34; . $recaptcha_public_key . &#34;\&#34;&#34;;
   if &#40;!empty&#40;$recaptcha_theme&#41;&#41;
   {
       $output .= &#34;  data-theme=\&#34;&#34; . $recaptcha_theme . &#34;\&#34;&#34;;
   }
   if &#40;!empty&#40;$recaptcha_type&#41;&#41;
   {
       $output .= &#34;  data-type=\&#34;&#34; . $recaptcha_type . &#34;\&#34;&#34;;
   }
   $output .= &#34;&gt; &lt;/div&gt;\n&#34;;
   if &#40;$recaptcha_noscript&#41; // Not recommended if site requires JS
   {
       $output .= &#34;&lt;noscript&gt;
  &lt;div style=\&#34;width: 302px; height: 352px;\&#34;&gt;
    &lt;div style=\&#34;width: 302px; height: 352px; position: relative;\&#34;&gt;
      &lt;div style=\&#34;width: 302px; height: 352px; position: absolute;\&#34;&gt;
        &lt;iframe src=\&#34;<span class="clickylink"><a target="new" rel="nofollow" href="https://www.google.com/recaptcha/api/fallback?k=">https://www.google.com/recaptcha/api/fallback?k=</a></span>&#34; . urlencode&#40;$recaptcha_public_key&#41; . &#34;\&#34;
                frameborder=\&#34;0\&#34; scrolling=\&#34;no\&#34;
                style=\&#34;width: 302px; height:352px; border-style: none;\&#34;&gt;
        &lt;/iframe&gt;
      &lt;/div&gt;
      &lt;div style=\&#34;width: 250px; height: 80px; position: absolute; border-style: none;
                  bottom: 21px; left: 25px; margin: 0px; padding: 0px; right: 25px;\&#34;&gt;
        &lt;textarea id=\&#34;g-recaptcha-response\&#34; name=\&#34;g-recaptcha-response\&#34;
                  class=\&#34;g-recaptcha-response\&#34;
                  style=\&#34;width: 250px; height: 80px; border: 1px solid #c1c1c1;
                         margin: 0px; padding: 0px; resize: none;\&#34; value=\&#34;\&#34;&gt;
        &lt;/textarea&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/noscript&gt;\n&#34;;
   }

Validate:
   if &#40;!sqGetGlobalVar&#40;&#39;g-recaptcha-response&#39;, $recaptcha_response_field, SQ_FORM&#41;
    || !sqGetGlobalVar&#40;&#39;REMOTE_ADDR&#39;, $remote_addr, SQ_SERVER&#41;&#41;
      return FALSE;
   

   // test for no user input
   //
   if &#40;$recaptcha_response_field === &#39;&#39;&#41;
      return NULL;


   global $recaptcha_private_key;
   $recapcha_verify_host = &#39;www.google.com&#39;;


   // set up GET payload
   //
   $payload = &#39;?secret=&#39; . urlencode&#40;$recaptcha_private_key&#41;
            . &#39;&#38;remoteip=&#39; . urlencode&#40;$remote_addr&#41;
            . &#39;&#38;response=&#39; . urlencode&#40;$recaptcha_response_field&#41;;

   ini_set&#40; &#34;user_agent&#34;, &#34;SquirrelMail CAPTCHA Plugin&#34; &#41;;

   // ask reCAPTCHA server if response was correct
   //
   $srv = fopen&#40; &#34;https://&#34; . $recapcha_verify_host .
                              &#34;/recaptcha/api/siteverify&#34; .
                              $payload, &#34;r&#34; &#41;;
   if&#40; !$srv &#41; {
       return FALSE;
   }

   // get response
   //
   $verify_response = &#39;&#39;;
   while &#40;!feof&#40;$srv&#41;&#41; $verify_response .= fgets&#40;$srv, 4096&#41;;


   fclose&#40;$srv&#41;;


   $rsp = json_decode&#40; $verify_response, FALSE &#41;;

   if &#40;!$rsp &#41;
   {
           return FALSE;
   }

   if&#40; $rsp-&gt;{&#39;success&#39;} == &#39;true&#39; &#41; {
       return TRUE;
   }
   // $rsp-&gt;{&#39;error-codes&#39;} : [ ... ]
   /* Error code        Description
missing-input-secret    The secret parameter is missing.
invalid-input-secret    The secret parameter is invalid or malformed.
missing-input-response  The response parameter is missing.
invalid-input-response  The response parameter is invalid or malformed.
   */

   return FALSE;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Dec&nbsp;07&nbsp;00:07:50&nbsp;2014</span>
    <span class="description">tlhackque [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Code for new API</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> tlhackque [...] yahoo.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Dec 05 00:26:48 2014, tlhackque wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Google has introduced a new API, which supports the new, easier to
&gt; solve captchas.  It needs to be supported.
&gt; 
</div>
Here is a Perl module that I wrote that has a similar application API, but supports the new Google API.  Feel free to add it or borrow code.

There are comments, but I didn&#39;t do POD.

Brief summary:

For your application, call new&#40;&#41; with at least the secret and SiteKey &#40;and any other options&#41;.  Case in the keywords is ignored.

The following are object methods:

Call getHead for the stuff to put in your &lt;head&gt;.

Call renderCaptcha to display the new UI inside your &lt;form&gt;

Call check_answer&#40; $response, $remote_ip &#41; to see if the response is OK.

Call get_error to retrieve any error codes if it fails.

This module depends on JSON and LPW::Simple.

Enjoy.

# Copyright &#40;C&#41; 2014 Timothe Litt, Southborough, Massachusetts.
# ALL RIGHTS RESERVED.
# Perl artistic license.

use strict;
use warnings;

package TL::Captcha;

use Carp;
use JSON;
use LWP::Simple;

# reCAPTCHA Server address and API
# With the current API, https MUST be used.

use constant SERVER =&gt; &#39;<span class="clickylink"><a target="new" rel="nofollow" href="https://www.google.com/recaptcha/&#39;">https://www.google.com/recaptcha/&#39;</a></span>;
use constant JSAPI =&gt; SERVER . &#39;api.js&#39;;
use constant FBAPI =&gt; SERVER . &#39;api/fallback&#39;;
use constant VFYAPI =&gt; SERVER . &#39;api/siteverify?secret=%s&#38;response=%s&#38;remote_ip=%s&#39;;

my %validkeys = &#40;
                 map { lc&#40; $_ &#41; =&gt; 1 }
                 qw&#40; PublicKey PrivateKey SiteKey Secret theme type language noscript fallback &#41;
                &#41;;

# Create a captcha object
# PublicKey/SiteKey =&gt; required \_ Obtain from <span class="clickylink"><a target="new" rel="nofollow" href="https://www.google.com/recaptcha/admin">https://www.google.com/recaptcha/admin</a></span>
# PrivateKey/Secret =&gt; required /
#
# Optional parameters - see <span class="clickylink"><a target="new" rel="nofollow" href="http://developers.google.com/recaptcha/docs">http://developers.google.com/recaptcha/docs</a></span> for allowed values
#
# theme =&gt; light, dark
# type =&gt; image, audio
# language =&gt; fr &#40;default auto if not specified&#41; - codes at <span class="clickylink"><a target="new" rel="nofollow" href="https://developers.google.com/recaptcha/docs/language">https://developers.google.com/recaptcha/docs/language</a></span>
# noscript =&gt; 1 generate non-js interface - Not recommended if site requires javascript.
# fallback =&gt; 1 force  fallback API - for debugging site appearance for browsers not supporting required features.

sub new {
    my $class = shift;

    croak &#34;Invalid argument list of &#34; . __PACKAGE__ . &#34;::new&#34;
      unless&#40; @_ &#38;&#38; !&#40; @_ % 2 &#41; &#41;;

    my $self = { };
    while&#40; @_ &#41; {
        my $k = shift;
        my $v = shift;
        $self-&gt;{lc $k} = $v;
    }

    foreach my $arg &#40;keys %$self&#41; {
        croak &#34;Invalid argument $arg to &#34; . __PACKAGE__ . &#34;::new&#34;
          unless&#40; $validkeys{$arg} &#41;;
    }

    croak &#34;PublicKey and SiteKey are aliases: only one can be specified to &#34; . __PACKAGE__ . &#34;::new&#34;
      if&#40; exists $self-&gt;{publickey} &#38;&#38; exists $self-&gt;{sitekey} &#41;;
    croak &#34;PrivateKey and Secret are aliases: only one can be specified to &#34; . __PACKAGE__ . &#34;::new&#34;
      if&#40; exists $self-&gt;{privatekey} &#38;&#38; exists $self-&gt;{secret} &#41;;

    $self-&gt;{sitekey} = delete $self-&gt;{publickey} if&#40; exists $self-&gt;{publickey} &#41;;
    $self-&gt;{secret} = delete $self-&gt;{privatekey} if&#40; exists $self-&gt;{privatekey} &#41;;

    croak &#34;Missing key in argument list of &#34; . __PACKAGE__ . &#34;::new&#34;
      unless&#40; defined $self-&gt;{sitekey} &#38;&#38; defined $self-&gt;{secret} &#38;&#38;
              length $self-&gt;{sitekey} &#38;&#38; length $self-&gt;{secret} &#41;;

    return bless $self, $class;
}

# Get string to be put into the &lt;head&gt;
# Actually, while it should go in &lt;head&gt;, it can be placed anywhere
# Currently, this loads the &lt;script&gt; for the configuration specified by new&#40;&#41;.

sub getHead {
    my $self = shift;

    my $q = &#39;&#39;;
    $q .= &#34;?fallback=true&#34; if&#40; $self-&gt;{fallback} &#41;;
    if&#40; $self-&gt;{language} &#41; {
        $q .= &#40;length $q&#41;? &#39;&#38;&#39; : &#39;?&#39;;
        $q .= &#34;hl=$self-&gt;{language}&#34;;
    }

    return sprintf&#40; qq&#40;&lt;script src=&#34;%s%s&#34; async defer&gt;&lt;/script&gt;&#41;, JSAPI, $q &#41; ;
}

# render the captcha -- inside a form
# Currently, a &lt;div&gt; is generated for the JS api, and optionally, a &lt;noscript&gt; fallback.
# The captcha response will be in a parameter &#39;g-recaptcha-response&#39;.

sub renderCaptcha {
    my $self = shift;

    my $output = qq&#40;&lt;div class=&#34;g-recaptcha&#34; data-sitekey=&#34;$self-&gt;{sitekey}&#34;&#41;;
    $output .= qq&#40; data-theme=&#34;$self-&gt;{theme}&#34;&#41; if&#40; defined $self-&gt;{theme} &#41;;
    $output .= qq&#40; data-type=&#34;$self-&gt;{type}&#34;&#41; if&#40; defined $self-&gt;{type} &#41;;
    $output .= &#34;&gt;&lt;/div&gt;&#34;;

    if&#40; $self-&gt;{noscript} &#41; {
        $output .= sprintf&#40; qq&#40;&lt;noscript&gt;
  &lt;div style=&#34;width: 302px; height: 352px;&#34;&gt;
    &lt;div style=&#34;width: 302px; height: 352px; position: relative;&#34;&gt;
      &lt;div style=&#34;width: 302px; height: 352px; position: absolute;&#34;&gt;
        &lt;iframe src=&#34;%s?k=%s&#34;
                frameborder=&#34;0&#34; scrolling=&#34;no&#34;
                style=&#34;width: 302px; height:352px; border-style: none;&#34;&gt;
        &lt;/iframe&gt;
      &lt;/div&gt;
      &lt;div style=&#34;width: 250px; height: 80px; position: absolute; border-style: none;
                  bottom: 21px; left: 25px; margin: 0px; padding: 0px; right: 25px;&#34;&gt;
        &lt;textarea id=&#34;g-recaptcha-response&#34; name=&#34;g-recaptcha-response&#34;
                  class=&#34;g-recaptcha-response&#34;
                  style=&#34;width: 250px; height: 80px; border: 1px solid #c1c1c1;
                         margin: 0px; padding: 0px; resize: none;&#34; value=&#34;&#34;&gt;
        &lt;/textarea&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/noscript&gt;&#41;, FBAPI, $self-&gt;{sitekey} &#41;;
    }

    return $output;
}

# Verify the user response &#40;normally in g-recaptcha-response parameter&#41;
# Supply the response and the IP address of the browser.
#
# Returns undef if unable to communicate with captcha server
# Returns true if captcha validates, false otherwise

sub check_answer {
    my $self = shift;
    my&#40; $response, $remoteip &#41; = @_;

    croak &#34;Bad argument to &#34; . __PACKAGE__ . &#34;::check_answer&#34;
      unless&#40; defined $remoteip &#38;&#38; length $remoteip &#41;;

    my $valid = get&#40; sprintf&#40; VFYAPI, $self-&gt;{secret}, &#40;defined $response? $response : &#39;&#39;&#41;, $remoteip &#41; &#41;;
    unless&#40; defined $valid &#41; {
        carp &#34;Unable to validate captcha&#34;;
        return undef;
    }
    my $js = decode_json&#40;$valid&#41;;

    return 1 if&#40; defined $js-&gt;{success} &#38;&#38; $js-&gt;{success} eq &#39;true&#39; &#41;;

    $self-&gt;{error} = $js-&gt;{&#39;error-codes&#39;};
    return 0;
}

# Return error&#40;s&#41; detected by check_answer
# Will be one or more strings.
# In scalar context:
#   Reference to an array of strings
#   undef if none
# In array context:
#   Returns a list of strings
#
# These are currently error codes as defined in <span class="clickylink"><a target="new" rel="nofollow" href="https://developers.google.com/recaptcha/docs/verify">https://developers.google.com/recaptcha/docs/verify</a></span>
# However ,they should be translated to local language for display.
sub get_error {
    my $self = shift;

    if&#40; wantarray &#41; {
        return &#40;&#41; unless&#40; defined $self-&gt;{error} &#41;;
        return @{$self-&gt;{error}};
    }
    return $self-&gt;{error};
}

1;
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;11&nbsp;11:39:44&nbsp;2015</span>
    <span class="description">chuck-bitcard [...] chlarson.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Try Captcha::noCAPTCHA, just released this weekend.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;Jan&nbsp;11&nbsp;11:39:44&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Jan&nbsp;28&nbsp;01:25:12&nbsp;2015</span>
    <span class="description">tlhackque [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #100714] Doesn&#39;t support new API</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 28 Jan 2015 01:24:55 -0500</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Captcha-reCAPTCHA [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> tlhackque &lt;tlhackque [...] yahoo.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 11-Jan-15 11:39, Chuck Larson via RT wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=100714">https://rt.cpan.org/Ticket/Display.html?id=100714</a></span> &gt;
&gt;
&gt; Try Captcha::noCAPTCHA, just released this weekend.
</div>Thanks!  That seems to work.  It still has the problem of not including
error strings corresponding to the error codes.  Seems silly for all
users to have to do that.

And it doesn&#39;t expose language selection.

It also forces the script for the Captcha into the &lt;body&gt;; it belongs in
&lt;head&gt;, which is why I separated that in my quick port.

So I&#39;m not quite ready to retire my code :-&#40;

But I&#39;m glad that you got something onto CPAN.

-- 
This communication may not represent my employer&#39;s views,
if any, on the matters discussed. 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;12&nbsp;16:57:43&nbsp;2016</span>
    <span class="description">GHENRY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Any chance and getting this updated?

Sponsorship?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction other CustomField odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Jan&nbsp;12&nbsp;16:57:45&nbsp;2016</span>
    <span class="description">GHENRY [...] cpan.org -  Fixed in 0.97 added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction people Set even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;15&nbsp;08:15:58&nbsp;2016</span>
    <span class="description">SUNNYP [...] cpan.org -  Taken</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;15&nbsp;08:16:10&nbsp;2016</span>
    <span class="description">SUNNYP [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Implemented new API
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Sep&nbsp;15&nbsp;08:16:10&nbsp;2016</span>
    <span class="description">SUNNYP [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
