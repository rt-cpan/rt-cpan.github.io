<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #102495 for Date-Calc: Mktime failing with dates &gt; 2038 even with 64-bit Perls</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #102495 for Date-Calc: Mktime failing with dates &gt; 2038 even with 64-bit Perls</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=Date-Calc">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=Date-Calc">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=Date-Calc">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=Date-Calc">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Date-Calc">Date-Calc CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">102495</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=Date-Calc">Date-Calc</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
maurice [...] cpan.org

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-9494-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-9495-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-attachments">
  <div class="titlebox ticket-info-attachments " id="">
  <div class="titlebox-title inverse">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dattachments\x2D\x2D\x2D\x2DQXR0YWNobWVudHM\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Attachments</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-attachments----QXR0YWNobWVudHM_---0">




date-calc-diff.txt<br />
<ul>


<li><font size="-2">
<a href="/Ticket/Attachment/1470926/783114/date-calc-diff.txt">
Fri Mar 06 20:22:32 2015 (3.9k) by maurice [...] cpan.org
</a>
</font></li>
</ul>

    <hr class="clear" />
  </div>
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=102495">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1469449" href="/Public/Bug/Display.html?id=102495#txn-1469449">#</a>      
    </span>
    <span class="date">Tue&nbsp;Mar&nbsp;03&nbsp;16:17:57&nbsp;2015</span>
    <span class="description">maurice [...] cpan.org -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Mktime failing with dates &gt; 2038 even with 64-bit Perls</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1469449/782240/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/782240">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 785b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">Even if the underlying Perl supports epoch timestamps past 2038, Date::Calc is still raising an exception.

$ perl -v
This is perl 5, version 18, subversion 1 &#40;v5.18.1&#41; built for x86_64-linux

$ perl -MDate::Calc -E &#39;say Date::Calc-&gt;VERSION&#39;
6.3

Test code that demonstrates the problem. Note that Time::Piece handles the timestamps fine.

#!/usr/bin/env perl

use strict;
use Try::Tiny;
use Time::Piece;
use Date::Format qw/ time2str /;
use Date::Calc qw/ Mktime /;

$| = 1;

my $t = localtime;
my $year = $t-&gt;year;

foreach &#40;1..30&#41; {
  $t = $t + &#40;86400 * 365&#41;;
  print &#34;T::P &#34;, $t-&gt;ymd, &#34;\n&#34;;

  try {
    my $time = Mktime&#40;$t-&gt;year, 1, 1, 1, 1, 1&#41;;
    print &#34;D::C &#34;, time2str&#40;&#34;%Y-%m-%d&#34;, $time&#41;, &#34;\n&#34;;
  } catch {
    warn &#34;Date::Calc Mktime&#40;&#41; failed: $_\n&#34;;
  };

  print &#34;\n&#34;;
}
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1469756" href="/Public/Bug/Display.html?id=102495#txn-1469756">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;04&nbsp;16:22:43&nbsp;2015</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1469756/782414/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/782414">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 608b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2015-03-03 16:17:57, MAURICE wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Even if the underlying Perl supports epoch timestamps past 2038,
&gt; Date::Calc is still raising an exception.
&gt; 
&gt; $ perl -v
&gt; This is perl 5, version 18, subversion 1 &#40;v5.18.1&#41; built for x86_64-
&gt; linux
&gt; 
&gt; $ perl -MDate::Calc -E &#39;say Date::Calc-&gt;VERSION&#39;
&gt; 6.3
&gt; 
&gt; Test code that demonstrates the problem. Note that Time::Piece handles
&gt; the timestamps fine.
&gt; 
</div>
Both Date::Calc::PP and Date::Calc::XS are affected.

It seems that things are working as expected if the y2038 restriction in Date::Calc::PP::DateCalc_mktime was removed, at least on a 64bit machine.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1469757" href="/Public/Bug/Display.html?id=102495#txn-1469757">#</a>      
    </span>
    <span class="date">Wed&nbsp;Mar&nbsp;04&nbsp;16:22:44&nbsp;2015</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1470389" href="/Public/Bug/Display.html?id=102495#txn-1470389">#</a>      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;06&nbsp;18:04:13&nbsp;2015</span>
    <span class="description">STBEY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1470389/782784/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/782784">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1015b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Wed Mar 04 16:22:43 2015, SREZIC wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2015-03-03 16:17:57, MAURICE wrote:
<div class="message-stanza open">&gt; &gt; Even if the underlying Perl supports epoch timestamps past 2038,
&gt; &gt; Date::Calc is still raising an exception.
&gt; &gt;
&gt; &gt; $ perl -v
&gt; &gt; This is perl 5, version 18, subversion 1 &#40;v5.18.1&#41; built for x86_64-
&gt; &gt; linux
&gt; &gt;
&gt; &gt; $ perl -MDate::Calc -E &#39;say Date::Calc-&gt;VERSION&#39;
&gt; &gt; 6.3
&gt; &gt;
&gt; &gt; Test code that demonstrates the problem. Note that Time::Piece
&gt; &gt; handles
&gt; &gt; the timestamps fine.
&gt; &gt;
</div>&gt; 
&gt; Both Date::Calc::PP and Date::Calc::XS are affected.
&gt; 
&gt; It seems that things are working as expected if the y2038 restriction
&gt; in Date::Calc::PP::DateCalc_mktime was removed, at least on a 64bit
&gt; machine.
</div>

Mktime&#40;&#41; is documented as not being very reliable &#40;&#34;USE AT YOUR OWN RISK!&#34;&#41;,
because it depends on the implementation on each machine and each Perl version,
which I can&#39;t do anything about.
So if it works for you, you are lucky, if it doesn&#39;t, you are out of luck.
If you can find a workaround, the better for you.

Sorry!
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1470733" href="/Public/Bug/Display.html?id=102495#txn-1470733">#</a>      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;06&nbsp;19:38:58&nbsp;2015</span>
    <span class="description">maurice [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1470733/783018/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/783018">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Mar 06 18:04:13 2015, STBEY wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Mktime&#40;&#41; is documented as not being very reliable &#40;&#34;USE AT YOUR OWN
&gt; RISK!&#34;&#41;,
&gt; because it depends on the implementation on each machine and each Perl
&gt; version,
&gt; which I can&#39;t do anything about.
&gt; So if it works for you, you are lucky, if it doesn&#39;t, you are out of
&gt; luck.
&gt; If you can find a workaround, the better for you.
&gt; 
&gt; Sorry!
</div>
I think the confusing thing is the docs suggest it&#39;s just a wrapper, and includes this note:

&#39;A fatal &#34;date out of range&#34; error will occur if the given date cannot
be expressed in terms of seconds since the epoch &#40;this happens for
instance when the date lies before the epoch, or if it is later than
19-Jan-2038 03:14:07 GMT on 32 bit Unix systems, or later than
06-Feb-2040 06:28:15 &#40;local time&#41; on a Macintosh with MacOS Classic&#41;.
&#39;

Which kind of suggests to me that the 32-bitness has something to do with the limit -- but it doesn&#39;t. Same failure on 64-bit, since the limit check is hard-coded.

Would you consider a patch if I worked on one?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1470917" href="/Public/Bug/Display.html?id=102495#txn-1470917">#</a>      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;06&nbsp;20:06:19&nbsp;2015</span>
    <span class="description">STBEY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1470917/783105/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/783105">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Mar 06 19:38:58 2015, MAURICE wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Fri Mar 06 18:04:13 2015, STBEY wrote:
<div class="message-stanza open">&gt; &gt; Mktime&#40;&#41; is documented as not being very reliable &#40;&#34;USE AT YOUR OWN
&gt; &gt; RISK!&#34;&#41;,
&gt; &gt; because it depends on the implementation on each machine and each
&gt; &gt; Perl
&gt; &gt; version,
&gt; &gt; which I can&#39;t do anything about.
&gt; &gt; So if it works for you, you are lucky, if it doesn&#39;t, you are out of
&gt; &gt; luck.
&gt; &gt; If you can find a workaround, the better for you.
&gt; &gt;
&gt; &gt; Sorry!
</div>&gt; 
&gt; I think the confusing thing is the docs suggest it&#39;s just a wrapper,
&gt; and includes this note:
&gt; 
&gt; &#39;A fatal &#34;date out of range&#34; error will occur if the given date cannot
&gt; be expressed in terms of seconds since the epoch &#40;this happens for
&gt; instance when the date lies before the epoch, or if it is later than
&gt; 19-Jan-2038 03:14:07 GMT on 32 bit Unix systems, or later than
&gt; 06-Feb-2040 06:28:15 &#40;local time&#41; on a Macintosh with MacOS Classic&#41;.
&gt; &#39;
&gt; 
&gt; Which kind of suggests to me that the 32-bitness has something to do
&gt; with the limit -- but it doesn&#39;t. Same failure on 64-bit, since the
&gt; limit check is hard-coded.
&gt; 
&gt; Would you consider a patch if I worked on one?
</div>

Yes, the function Mktime&#40;&#41; in my module is just a wrapper around whatever Perl/POSIX/C provide.
This is why the results are so unpredictable and why I can&#39;t do anything about it.
There is no code of mine whatsoever, I just pass the parameters on to the internal function and return its output - that&#39;s it.

I doubt that your patch will be able to fix that, and even if it does, it may not do so on other machines with other OS&#39;s, on which it might fail catastrophically.
Therefore I would rather not change anything in my code.

These functions are only for the not faint of heart!

Better alternatives are Date2Time&#40;&#41; and Time2Date&#40;&#41;, which are my own code - and they work.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1470926" href="/Public/Bug/Display.html?id=102495#txn-1470926">#</a>      
    </span>
    <span class="date">Fri&nbsp;Mar&nbsp;06&nbsp;20:22:32&nbsp;2015</span>
    <span class="description">maurice [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="messageattachments">
<div class="downloadattachment">
<a href="/Ticket/Attachment/1470926/783113/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/783113">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 929b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Mar 06 20:06:19 2015, STBEY wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; Yes, the function Mktime&#40;&#41; in my module is just a wrapper around
&gt; whatever Perl/POSIX/C provide.
&gt; This is why the results are so unpredictable and why I can&#39;t do
&gt; anything about it.
&gt; There is no code of mine whatsoever, I just pass the parameters on to
&gt; the internal function and return its output - that&#39;s it.
</div>
There&#39;s a bit of checking of the parameter values prior to passing them to the underlying mktime&#40;&#41;. If I remove those checks, Mktime&#40;&#41; works fine past 2038 on my 64-bit system.

See the attached diff. I&#39;m not suggesting this as a patch... just demonstrating that the limit is artificial.

And I understand your suggestion of using something else, and I am... just would like others to not hit this problem if it&#39;s an artificial limitation.

Alternatively, I could submit a patch to the docs that just says years &gt; 2038 are not supported, regardless of 64-bit support.
</div></div>
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> date-calc-diff.txt</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/1470926/783114/date-calc-diff.txt">Download date-calc-diff.txt</a><br />
<span class="downloadcontenttype">text/plain 3.9k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">diff -uBbr Date-Calc-6.3-orig/lib/Date/Calc/PP.pm Date-Calc-6.3-new/lib/Date/Calc/PP.pm
--- Date-Calc-6.3-orig/lib/Date/Calc/PP.pm	2009-10-30 23:53:01.000000000 -0700
+++ Date-Calc-6.3-new/lib/Date/Calc/PP.pm	2015-03-06 17:16:09.276330580 -0800
@@ -2033,46 +2033,46 @@
 {
     my&#40;$_seconds,$year,$month,$day,$hour,$min,$sec,$doy,$dow,$dst&#41; = @_;
     $$_seconds = 0;
-    if &#40;$^O eq &#39;MacOS&#39;&#41;
-    {
-        return 0 if
-        &#40;
-            &#40;$year  &lt; 1904&#41; or &#40;$year  &gt; 2040&#41; or
-            &#40;$month &lt;    1&#41; or &#40;$month &gt;   12&#41; or
-            &#40;$day   &lt;    1&#41; or &#40;$day   &gt;   31&#41; or
-            &#40;$hour  &lt;    0&#41; or &#40;$hour  &gt;   23&#41; or
-            &#40;$min   &lt;    0&#41; or &#40;$min   &gt;   59&#41; or
-            &#40;$sec   &lt;    0&#41; or &#40;$sec   &gt;   59&#41;
-        &#41;;
-        return 0 if
-        &#40;
-            &#40;$year == 2040&#41; and &#40; &#40;$month &gt;  2&#41; or
-                                &#40; &#40;$month == 2&#41; and &#40; &#40;$day &gt;  6&#41; or
-                                                    &#40; &#40;$day == 6&#41; and &#40; &#40;$hour &gt;  6&#41; or
-                                                                      &#40; &#40;$hour == 6&#41; and &#40; &#40;$min &gt;  28&#41; or
-                                                                                         &#40; &#40;$min == 28&#41; and &#40;$sec &gt; 15&#41; &#41; &#41;&#41;&#41;&#41;&#41;&#41;&#41;
-        &#41;;
-    }
-    else
-    {
-        return 0 if
-        &#40;
-            &#40;$year  &lt; 1970&#41; or &#40;$year  &gt; 2038&#41; or
-            &#40;$month &lt;    1&#41; or &#40;$month &gt;   12&#41; or
-            &#40;$day   &lt;    1&#41; or &#40;$day   &gt;   31&#41; or
-            &#40;$hour  &lt;    0&#41; or &#40;$hour  &gt;   23&#41; or
-            &#40;$min   &lt;    0&#41; or &#40;$min   &gt;   59&#41; or
-            &#40;$sec   &lt;    0&#41; or &#40;$sec   &gt;   59&#41;
-        &#41;;
-        return 0 if
-        &#40;
-            &#40;$year == 2038&#41; and &#40; &#40;$month &gt;  1&#41; or
-                                &#40; &#40;$month == 1&#41; and &#40; &#40;$day &gt;  19&#41; or
-                                                    &#40; &#40;$day == 19&#41; and &#40; &#40;$hour &gt;  3&#41; or
-                                                                       &#40; &#40;$hour == 3&#41; and &#40; &#40;$min &gt;  14&#41; or
-                                                                                          &#40; &#40;$min == 14&#41; and &#40;$sec &gt; 7&#41; &#41; &#41;&#41;&#41;&#41;&#41;&#41;&#41;
-        &#41;;
-    }
+    # if &#40;$^O eq &#39;MacOS&#39;&#41;
+    # {
+    #     return 0 if
+    #     &#40;
+    #         &#40;$year  &lt; 1904&#41; or &#40;$year  &gt; 2040&#41; or
+    #         &#40;$month &lt;    1&#41; or &#40;$month &gt;   12&#41; or
+    #         &#40;$day   &lt;    1&#41; or &#40;$day   &gt;   31&#41; or
+    #         &#40;$hour  &lt;    0&#41; or &#40;$hour  &gt;   23&#41; or
+    #         &#40;$min   &lt;    0&#41; or &#40;$min   &gt;   59&#41; or
+    #         &#40;$sec   &lt;    0&#41; or &#40;$sec   &gt;   59&#41;
+    #     &#41;;
+    #     return 0 if
+    #     &#40;
+    #         &#40;$year == 2040&#41; and &#40; &#40;$month &gt;  2&#41; or
+    #                             &#40; &#40;$month == 2&#41; and &#40; &#40;$day &gt;  6&#41; or
+    #                                                 &#40; &#40;$day == 6&#41; and &#40; &#40;$hour &gt;  6&#41; or
+    #                                                                   &#40; &#40;$hour == 6&#41; and &#40; &#40;$min &gt;  28&#41; or
+    #                                                                                      &#40; &#40;$min == 28&#41; and &#40;$sec &gt; 15&#41; &#41; &#41;&#41;&#41;&#41;&#41;&#41;&#41;
+    #     &#41;;
+    # }
+    # else
+    # {
+    #     return 0 if
+    #     &#40;
+    #         &#40;$year  &lt; 1970&#41; or &#40;$year  &gt; 2038&#41; or
+    #         &#40;$month &lt;    1&#41; or &#40;$month &gt;   12&#41; or
+    #         &#40;$day   &lt;    1&#41; or &#40;$day   &gt;   31&#41; or
+    #         &#40;$hour  &lt;    0&#41; or &#40;$hour  &gt;   23&#41; or
+    #         &#40;$min   &lt;    0&#41; or &#40;$min   &gt;   59&#41; or
+    #         &#40;$sec   &lt;    0&#41; or &#40;$sec   &gt;   59&#41;
+    #     &#41;;
+    #     return 0 if
+    #     &#40;
+    #         &#40;$year == 2038&#41; and &#40; &#40;$month &gt;  1&#41; or
+    #                             &#40; &#40;$month == 1&#41; and &#40; &#40;$day &gt;  19&#41; or
+    #                                                 &#40; &#40;$day == 19&#41; and &#40; &#40;$hour &gt;  3&#41; or
+    #                                                                    &#40; &#40;$hour == 3&#41; and &#40; &#40;$min &gt;  14&#41; or
+    #                                                                                       &#40; &#40;$min == 14&#41; and &#40;$sec &gt; 7&#41; &#41; &#41;&#41;&#41;&#41;&#41;&#41;&#41;
+    #     &#41;;
+    # }
     $year -= 1900;
     $month--;
     if &#40;$doy &lt;= 0&#41; { $doy = -1; }
Only in Date-Calc-6.3-new/: try
</div></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1471003" href="/Public/Bug/Display.html?id=102495#txn-1471003">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;07&nbsp;10:20:43&nbsp;2015</span>
    <span class="description">STBEY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1471003/783155/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/783155">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.4k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Fri Mar 06 20:22:32 2015, MAURICE wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Fri Mar 06 20:06:19 2015, STBEY wrote:
<div class="message-stanza open">&gt; &gt; Yes, the function Mktime&#40;&#41; in my module is just a wrapper around
&gt; &gt; whatever Perl/POSIX/C provide.
&gt; &gt; This is why the results are so unpredictable and why I can&#39;t do
&gt; &gt; anything about it.
&gt; &gt; There is no code of mine whatsoever, I just pass the parameters on to
&gt; &gt; the internal function and return its output - that&#39;s it.
</div>&gt; 
&gt; There&#39;s a bit of checking of the parameter values prior to passing
&gt; them to the underlying mktime&#40;&#41;. If I remove those checks, Mktime&#40;&#41;
&gt; works fine past 2038 on my 64-bit system.
&gt; 
&gt; See the attached diff. I&#39;m not suggesting this as a patch... just
&gt; demonstrating that the limit is artificial.
&gt; 
&gt; And I understand your suggestion of using something else, and I am...
&gt; just would like others to not hit this problem if it&#39;s an artificial
&gt; limitation.
&gt; 
&gt; Alternatively, I could submit a patch to the docs that just says years
<div class="message-stanza open">&gt; &gt; 2038 are not supported, regardless of 64-bit support.
</div></div>
I added those checks in order to avoid problems with people complaining that the functions don&#39;t work &#40;when in reality they fed them wrong parameters&#41;. I wanted to minimize my amount of trouble. :-&#41;

Of course you are free to remove the checks and this might work perfectly for you and on your machine.
However, there is no guarantee that this will work equally well for somebody else and on a different machine.
That&#39;s my concern.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1471054" href="/Public/Bug/Display.html?id=102495#txn-1471054">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;07&nbsp;14:30:20&nbsp;2015</span>
    <span class="description">SREZIC [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1471054/783182/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/783182">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 1.7k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On 2015-03-07 10:20:43, STBEY wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On Fri Mar 06 20:22:32 2015, MAURICE wrote:
<div class="message-stanza open">&gt; &gt; On Fri Mar 06 20:06:19 2015, STBEY wrote:
<div class="message-stanza open">&gt; &gt; &gt; Yes, the function Mktime&#40;&#41; in my module is just a wrapper around
&gt; &gt; &gt; whatever Perl/POSIX/C provide.
&gt; &gt; &gt; This is why the results are so unpredictable and why I can&#39;t do
&gt; &gt; &gt; anything about it.
&gt; &gt; &gt; There is no code of mine whatsoever, I just pass the parameters on
&gt; &gt; &gt; to
&gt; &gt; &gt; the internal function and return its output - that&#39;s it.
</div>&gt; &gt;
&gt; &gt; There&#39;s a bit of checking of the parameter values prior to passing
&gt; &gt; them to the underlying mktime&#40;&#41;. If I remove those checks, Mktime&#40;&#41;
&gt; &gt; works fine past 2038 on my 64-bit system.
&gt; &gt;
&gt; &gt; See the attached diff. I&#39;m not suggesting this as a patch... just
&gt; &gt; demonstrating that the limit is artificial.
&gt; &gt;
&gt; &gt; And I understand your suggestion of using something else, and I am...
&gt; &gt; just would like others to not hit this problem if it&#39;s an artificial
&gt; &gt; limitation.
&gt; &gt;
&gt; &gt; Alternatively, I could submit a patch to the docs that just says
&gt; &gt; years
<div class="message-stanza open">&gt; &gt; &gt; 2038 are not supported, regardless of 64-bit support.
</div></div>&gt; 
&gt; I added those checks in order to avoid problems with people
&gt; complaining that the functions don&#39;t work &#40;when in reality they fed
&gt; them wrong parameters&#41;. I wanted to minimize my amount of trouble. :-&#41;
&gt; 
&gt; Of course you are free to remove the checks and this might work
&gt; perfectly for you and on your machine.
&gt; However, there is no guarantee that this will work equally well for
&gt; somebody else and on a different machine.
&gt; That&#39;s my concern.
</div>
How about a whitelist? So far it seems to work on linux and freebsd systems, at least on 64bit machines. We have cpantesters to detect if it works on other platforms, too.

Regards,
    Slaven
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-1471061" href="/Public/Bug/Display.html?id=102495#txn-1471061">#</a>      
    </span>
    <span class="date">Sat&nbsp;Mar&nbsp;07&nbsp;14:36:25&nbsp;2015</span>
    <span class="description">STBEY [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/1471061/783189/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/783189">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 2k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">On Sat Mar 07 14:30:20 2015, SREZIC wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; On 2015-03-07 10:20:43, STBEY wrote:
<div class="message-stanza open">&gt; &gt; On Fri Mar 06 20:22:32 2015, MAURICE wrote:
<div class="message-stanza open">&gt; &gt; &gt; On Fri Mar 06 20:06:19 2015, STBEY wrote:
<div class="message-stanza open">&gt; &gt; &gt; &gt; Yes, the function Mktime&#40;&#41; in my module is just a wrapper around
&gt; &gt; &gt; &gt; whatever Perl/POSIX/C provide.
&gt; &gt; &gt; &gt; This is why the results are so unpredictable and why I can&#39;t do
&gt; &gt; &gt; &gt; anything about it.
&gt; &gt; &gt; &gt; There is no code of mine whatsoever, I just pass the parameters
&gt; &gt; &gt; &gt; on
&gt; &gt; &gt; &gt; to
&gt; &gt; &gt; &gt; the internal function and return its output - that&#39;s it.
</div>&gt; &gt; &gt;
&gt; &gt; &gt; There&#39;s a bit of checking of the parameter values prior to passing
&gt; &gt; &gt; them to the underlying mktime&#40;&#41;. If I remove those checks, Mktime&#40;&#41;
&gt; &gt; &gt; works fine past 2038 on my 64-bit system.
&gt; &gt; &gt;
&gt; &gt; &gt; See the attached diff. I&#39;m not suggesting this as a patch... just
&gt; &gt; &gt; demonstrating that the limit is artificial.
&gt; &gt; &gt;
&gt; &gt; &gt; And I understand your suggestion of using something else, and I
&gt; &gt; &gt; am...
&gt; &gt; &gt; just would like others to not hit this problem if it&#39;s an
&gt; &gt; &gt; artificial
&gt; &gt; &gt; limitation.
&gt; &gt; &gt;
&gt; &gt; &gt; Alternatively, I could submit a patch to the docs that just says
&gt; &gt; &gt; years
<div class="message-stanza open">&gt; &gt; &gt; &gt; 2038 are not supported, regardless of 64-bit support.
</div></div>&gt; &gt;
&gt; &gt; I added those checks in order to avoid problems with people
&gt; &gt; complaining that the functions don&#39;t work &#40;when in reality they fed
&gt; &gt; them wrong parameters&#41;. I wanted to minimize my amount of trouble. :-
&gt; &gt; &#41;
&gt; &gt;
&gt; &gt; Of course you are free to remove the checks and this might work
&gt; &gt; perfectly for you and on your machine.
&gt; &gt; However, there is no guarantee that this will work equally well for
&gt; &gt; somebody else and on a different machine.
&gt; &gt; That&#39;s my concern.
</div>&gt; 
&gt; How about a whitelist? So far it seems to work on linux and freebsd
&gt; systems, at least on 64bit machines. We have cpantesters to detect if
&gt; it works on other platforms, too.
&gt; 
&gt; Regards,
&gt;     Slaven
</div>

That may be a possibility, but I don&#39;t have the time anymore to do development or major maintenance on this module.
I can only do the bare minimum to keep the module working and the tests from failing.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.52441</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
