<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #11341 for XML-Twig: Bad newline interpretation by XML-Twig on Windows</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="https://rt.cpan.org/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #11341 for XML-Twig: Bad newline interpretation by XML-Twig on Windows</h1></div>


<div id="main-navigation"><ul id="app-nav" class="toplevel">
 <li id="li-search_dist"><a id="search_dist" class="menu-item " href="/Public/">Search Distributions</a></li>
 <li id="li-browse_dist"><a id="browse_dist" class="menu-item " href="/Public/Dist/Browse.html">Browse Distributions</a></li>
 <li id="li-about" class="has-children"><a id="about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About rt.cpan.org</a>
 <ul>
  <li id="li-about-usage"><a id="about-usage" class="menu-item " href="/NoAuth/RT/CPAN/Usage.html">How do Iâ€¦?</a></li>
  <li id="li-about-about"><a id="about-about" class="menu-item " href="/NoAuth/RT/CPAN/About.html">About</a></li>
 </ul>
 </li>
 <li id="li-preferences"><a id="preferences" class="menu-item ">Welcome <span class="current-user">anonymous guest</span>.</a></li>
 <li id="li-login"><a id="login" class="menu-item " href="/NoAuth/Logout.html">Login as another user</a></li>
</ul></div>
<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Active;Name=XML-Twig">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Resolved;Name=XML-Twig">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Display.html?Status=Rejected;Name=XML-Twig">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Bug/Report.html?Queue=XML-Twig">Report a new bug</a></li>
</ul></div>
<div id="topactions"><form action="/Public/Search/Simple.html" id="simple-search">
  <input size="12" name="q" accesskey="0" class="field" value="" placeholder="Search..." />
</form>

<form action="/Public/Bug/Report.html" name="CreateTicketInQueue" id="CreateTicketInQueue" >
<input type="submit" class="button" value="New ticket in" />&nbsp;<label accesskey="9">
  <input name="Queue" size="25" placeholder="Module or distribution" value="" class="select-queue" data-autocomplete="Queues" data-autocomplete-autosubmit=1 data-autocomplete-params="right=CreateTicket" />

</label>

</form>

</div>
<div id="body">
<div id="announcement" style="padding: 1em; margin: 1em; border: solid black 1px; background: #eee">
<a href="https://log.perl.org/2020/12/rtcpanorg-sunset.html">rt.cpan.org will be shut down on March 1st, 2021.</a>
</div>

<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/XML-Twig">XML-Twig CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">11341</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Dist/Display.html?Queue=XML-Twig">XML-Twig</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
louis.strous [...] consul.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
Important    </td>
  </tr>
  <tr id="CF-37682-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
3.15    </td>
  </tr>
  <tr id="CF-37683-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a> &mdash; <a href="/Public/Bug/Display.html?ShowHeaders=1;id=11341">Show full headers</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-123155" href="/Public/Bug/Display.html?id=11341#txn-123155">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;02&nbsp;12:10:00&nbsp;2005</span>
    <span class="description">Guest -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Bad newline interpretation by XML-Twig on Windows</td>
  </tr>
</table>
<div class="downloadattachment">
<a href="/Ticket/Attachment/123155/30869/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/30869">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 4.3k</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">L.S. 

When I use XML-Twig on Windows on a regular text file &#40;newline = 0x0d 0x0a&#41;, then the text printed by Twig has an extra 0x0d at the end of each line, i.e., each line ends in 0x0d 0x0d 0x0a instead of the expected 0x0d 0x0a.  The print for the &lt;data&gt; tags in the example below includes an explicit newline, which shows up as an ordinary &#40;for Windows&#41; 0x0d 0x0a in the result, so only the newlines from the original file are not treated correctly.  Perhaps the newlines from the input file are at some point interpreted Unix-style &#40;i.e., as 0x0d followed by Unix-\n = 0x0a&#41; by Twig.  Files with 0x0d 0x0d 0x0a &#34;newlines&#34; are not accepted as XML files by XML::Parser or XML::Twig &#40;on Windows; they yield a &#34;syntax error at line 2, column 0, byte XX at d:/Perl/site/lib/XML/Parser.pm line 185&#34; error&#41;, so if no explicit changes are made to the input by any handlers, then the output from Twig is not acceptable as input to Twig on Windows.  This I believe to be a bug.  I haven&#39;t had similar problems with other Perl scripts, so I believe this to be a bug in Twig and not in Perl on Windows. 

I have looked at the Twig source code but have not been able to figure out how to solve the problem for myself.  I have not found the problem mentioned in the tutorials or manual or FAQ or in the XML::Twig bug list.  None of the changes mentioned for version 3.16 seem applicable, and replacing Twig.pm and XPath.pm by the versions from XML-Twig 3.16 does not help.  If I can work around this problem by defining a suitable input_filter or output_filter, then please tell me in detail how to do this, because I have not been able to figure that out, either. 

Best regards, 

Louis Strous, louis.strous@consul.com

XML-Twig version:  XML-Twig-3.15.tar.gz from <span class="clickylink"><a target="new" rel="nofollow" href="http://xmltwig.com/xmltwig/">http://xmltwig.com/xmltwig/</a></span> installed using ppm 3.0.1. 
First line of Twig.pm: # $Id: Twig.pm.slow,v 1.157 2004/03/17 17:02:31 mrodrigu Exp $ 
Operating system: Windows 2000 Professional 
Perl: This is perl, v5.8.0 built for MSWin32-x86-multi-thread 
Binary build 802 provided by ActiveState Corp. <span class="clickylink"><a target="new" rel="nofollow" href="http://www.ActiveState.com">http://www.ActiveState.com</a></span> 
Built 00:54:02 Nov  8 2002 

Perl file test.pl using XML::Twig: 

#!/bin/perl 
use strict; 
use XML::Twig; 
open OUT, &#34;&gt;out.xml&#34;; 
print OUT &#34;foo1\n&#34;; 
my $twig = XML::Twig-&gt;new&#40; 
                          twig_roots =&gt; 
                          { 
                           &#39;data&#39; =&gt; sub { print OUT $_[1]-&gt;text . &#34;\nfoo&#34;; }, 
                          }, 
                          twig_print_outside_roots =&gt; \*OUT 
                          &#41;; 
print OUT &#34;foo2\n&#34;; 
$twig-&gt;parsefile&#40;&#34;test.xml&#34;&#41;; 
print OUT &#34;foo3\n&#34;; 
close OUT; 

Input file test.xml: 

&lt;document&gt; 
  &lt;item&gt; 
    &lt;data&gt;alpha&lt;/data&gt; 
    &lt;target&gt;beta&lt;/target&gt; 
  &lt;/item&gt; 
  &lt;item&gt; 
    &lt;data&gt;gamma&lt;/data&gt; 
    &lt;target&gt;delta&lt;/target&gt; 
  &lt;/item&gt; 
&lt;/document&gt; 

hexl test.xml: 

00000000: 3c64 6f63 756d 656e 743e 0d0a 2020 3c69  &lt;document&gt;..  &lt;i 
00000010: 7465 6d3e 0d0a 2020 2020 3c64 6174 613e  tem&gt;..    &lt;data&gt; 
00000020: 616c 7068 613c 2f64 6174 613e 0d0a 2020  alpha&lt;/data&gt;.. 
00000030: 2020 3c74 6172 6765 743e 6265 7461 3c2f    &lt;target&gt;beta&lt;/ 
00000040: 7461 7267 6574 3e0d 0a20 203c 2f69 7465  target&gt;..  &lt;/ite 
00000050: 6d3e 0d0a 2020 3c69 7465 6d3e 0d0a 2020  m&gt;..  &lt;item&gt;.. 
00000060: 2020 3c64 6174 613e 6761 6d6d 613c 2f64    &lt;data&gt;gamma&lt;/d 
00000070: 6174 613e 0d0a 2020 2020 3c74 6172 6765  ata&gt;..    &lt;targe 
00000080: 743e 6465 6c74 613c 2f74 6172 6765 743e  t&gt;delta&lt;/target&gt; 
00000090: 0d0a 2020 3c2f 6974 656d 3e0d 0a3c 2f64  ..  &lt;/item&gt;..&lt;/d 
000000a0: 6f63 756d 656e 743e 0d0a                 ocument&gt;.. 

Run as follows: perl test.pl 

Output file out.xml:  hexl out.xml: 

00000000: 666f 6f31 0d0a 666f 6f32 0d0a 3c64 6f63  foo1..foo2..&lt;doc 
00000010: 756d 656e 743e 0d0d 0a20 203c 6974 656d  ument&gt;...  &lt;item 
00000020: 3e0d 0d0a 2020 2020 616c 7068 610d 0a66  &gt;...    alpha..f 
00000030: 6f6f 0d0d 0a20 2020 203c 7461 7267 6574  oo...    &lt;target 
00000040: 3e62 6574 613c 2f74 6172 6765 743e 0d0d  &gt;beta&lt;/target&gt;.. 
00000050: 0a20 203c 2f69 7465 6d3e 0d0d 0a20 203c  .  &lt;/item&gt;...  &lt; 
00000060: 6974 656d 3e0d 0d0a 2020 2020 6761 6d6d  item&gt;...    gamm 
00000070: 610d 0a66 6f6f 0d0d 0a20 2020 203c 7461  a..foo...    &lt;ta 
00000080: 7267 6574 3e64 656c 7461 3c2f 7461 7267  rget&gt;delta&lt;/targ 
00000090: 6574 3e0d 0d0a 2020 3c2f 6974 656d 3e0d  et&gt;...  &lt;/item&gt;. 
000000a0: 0d0a 3c2f 646f 6375 6d65 6e74 3e66 6f6f  ..&lt;/document&gt;foo 
000000b0: 330d 0a                                  3.. 
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-123156" href="/Public/Bug/Display.html?id=11341#txn-123156">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;02&nbsp;12:27:03&nbsp;2005</span>
    <span class="description">MIROD [...] cpan.org -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-123157" href="/Public/Bug/Display.html?id=11341#txn-123157">#</a>      
    </span>
    <span class="date">Wed&nbsp;Feb&nbsp;02&nbsp;12:34:02&nbsp;2005</span>
    <span class="description">MIROD [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/123157/30872/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/30872">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 845b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[guest - Wed Feb  2 12:10:00 2005]:

<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; When I use XML-Twig on Windows on a regular text file &#40;newline = 0x0d
&gt;    0x0a&#41;, then the text printed by Twig has an extra 0x0d at the end
&gt;    of each line, i.e., each line ends in 0x0d 0x0d 0x0a instead of the
&gt;    expected 0x0d 0x0a.  
</div>
Weird, I have never had a report on such a problem. 

I have a few questions, so we can eliminate some possible causes:

Does the module pass the tests? Could you send me the result of
t/zz_dump_config.t? Did you try with a more recent version of Perl,
5.8.0 seems to often cause Unicode-related problems?

I will try to look into this, but I don&#39;t have a working windows machine
 around here, so it might take a while. Don&#39;t abandon all hopes though,
I definitely need to test the module on Windows before releasing the
next version &#40;Real Soon Now&#40;tm&#41;&#41;.

__
Mirod
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      <a name="txn-123163" href="/Public/Bug/Display.html?id=11341#txn-123163">#</a>      <a id="lasttrans" name="lasttrans"></a>
    </span>
    <span class="date">Fri&nbsp;Feb&nbsp;11&nbsp;12:46:26&nbsp;2005</span>
    <span class="description">MIROD [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<div class="downloadattachment">
<a href="/Ticket/Attachment/123163/31287/">Download &#40;untitled&#41;</a> / <a href="/Ticket/Attachment/WithHeaders/31287">with headers</a>
<br />
<span class="downloadcontenttype">text/plain 666b</span>
</div>
<div class="messagebody">
<div class="message-stanza plain-text-white-space">[mirod@xmltwig.com - Thu Feb  3 10:54:31 2005]:

Hi Louis,

So far I managed to install XML::Twig 3.16 on a Win2000 machine, with
perl-5.8.6, and your first code generated a well-formed XML file, I
could parse it again, without any problem, once I had gotten rid of the
extra &#34;foo&#34; that were printed by the original version.

At this point I got so fed-up with fighting Windows AND the flickering
screen on my laptop that I decided that that was it for today ;--&#40;

I tried your second exemple &#40;the one that piped the output of 1 process
to the next one&#41; on my linux machine, no problem.

I will try again the second exemple when I regain my temper.

Thanks

__
mirod
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
<p id="sponsors">
  This service is sponsored and maintained by
  <a href="http://bestpractical.com">Best Practical Solutions</a> and runs on
  <a href="http://noc.perl.org">Perl.org</a> infrastructure.
</p>

<p id="contact-info">
  Please report any issues with rt.cpan.org to <a href="mailto:rt-cpan-admin@bestpractical.com">rt-cpan-admin@bestpractical.com</a>.
</p>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA\x2D937849\x2D12');
  ga('send', 'pageview');
</script>

<div id="footer">
  <p id="time"><span>Time to display: 0.301335</span></p>
  <p id="bpscredits"><span>&#187;&#124;&#171; RT 4.0.18 Copyright 1996-2013 <a href="http://www.bestpractical.com?rt=4.0.18">Best Practical Solutions, LLC</a>.
</span></p>
</div>
  </body>
</html>
