<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #57005 for MongoDB: Inconsistent handling of integers</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #57005 for MongoDB: Inconsistent handling of integers</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/MongoDB/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/MongoDB/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/MongoDB/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/MongoDB/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>




<div id="external_bugtracker">
<h3>Preferred bug tracker</h3>
<p>
<div>Please visit the <a href="https://jira.mongodb.org/browse/PERL">preferred bug tracker</a> to report your issue.</div>
</p>
</div>

<p>This queue is for tickets about the <a href="https://metacpan.org/release/MongoDB">MongoDB CPAN distribution</a>.</p>


<h3>Maintainer&#40;s&#41;&#39; notes</h3>

<p>Please don't report bugs here.  Please use the <a href="https://jira.mongodb.org/browse/PERL">MongoDB Perl driver issue tracker</a> instead.</p>



<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">57005</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">resolved</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/MongoDB/Active/">MongoDB</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
whatson [...] gmail.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-227304-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-227305-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    
</div>




</div>







  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;28&nbsp;03:32:31&nbsp;2010</span>
    <span class="description">whatson [...] gmail.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Inconsistent handling of integers</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Wed, 28 Apr 2010 17:32:17 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-MongoDB [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Andrew Whatson &lt;whatson [...] gmail.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi,

It seems that the handling of numeric values is not quite as-advertised in
the MongoDB documentation.  I&#39;ve attached a perl script that inserts a
variety of test values, and then connects to the database via the mongo shell
to dump the test values as mongo sees them.

The results of running the script indicate that bare integers &#40;ie. unquoted
integer literals, eg. 3&#41; are stored as &#39;floatApprox&#39; values. Conversely,
integers with arbitrary decimal places &#40;eg. 3.0&#41; are stored as bare integers.

I&#39;m not sure if this is an issue with the driver or the documentation, though
my guess would be the former.

Regards,
Andrew
</div></div>

<div class="messagebody">
<p>Message body is not shown because sender requested not to inline it.</p></div>
</div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;28&nbsp;09:36:19&nbsp;2010</span>
    <span class="description">KRISTINA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">JavaScript only has one number type, so we&#39;ve hacked around that 
limitation a bit in the Mongo shell.  I&#39;m not sure what you&#39;re seeing, I 
get:

{ &#34;_id&#34; : ObjectId&#40;&#34;4bd8385cb93b22124b50bebd&#34;&#41;, &#34;test&#34; : &#34;bare 
integers&#34;, &#34;a&#34; : 1, &#34;b&#34; : 2, &#34;c&#34; : 3 }
{ &#34;_id&#34; : ObjectId&#40;&#34;4bd8385c0f901d124beb94f5&#34;&#41;, &#34;test&#34; : &#34;bare floats&#34;, 
&#34;a&#34; : 1.5, &#34;b&#34; : 2.5, &#34;c&#34; : 3.5 }
{ &#34;_id&#34; : ObjectId&#40;&#34;4bd8385c52275b124bf1c503&#34;&#41;, &#34;test&#34; : &#34;integers as 
bare floats&#34;, &#34;a&#34; : 1, &#34;b&#34; : 2, &#34;c&#34; : 3 }
{ &#34;_id&#34; : ObjectId&#40;&#34;4bd8385cc819ad124bbbb7ad&#34;&#41;, &#34;test&#34; : &#34;integers as 
strings&#34;, &#34;a&#34; : &#34;1&#34;, &#34;b&#34; : &#34;2&#34;, &#34;c&#34; : &#34;3&#34; }
{ &#34;_id&#34; : ObjectId&#40;&#34;4bd8385cbd09e7124b7a2c8f&#34;&#41;, &#34;test&#34; : &#34;floats as 
strings&#34;, &#34;a&#34; : &#34;1.5&#34;, &#34;b&#34; : &#34;2.5&#34;, &#34;c&#34; : &#34;3.5&#34; }

when I run your script, which looks right to me.

Also, when I dump the documents in a language that actually has two 
different numeric types &#40;PHP&#41;, it looks like they&#39;re all being stored as 
the correct type:

array&#40;5&#41; {
  [&#34;_id&#34;]=&gt;
  object&#40;MongoId&#41;#7 &#40;0&#41; {
  }
  [&#34;test&#34;]=&gt;
  string&#40;13&#41; &#34;bare integers&#34;
  [&#34;a&#34;]=&gt;
  int&#40;1&#41;
  [&#34;b&#34;]=&gt;
  int&#40;2&#41;
  [&#34;c&#34;]=&gt;
  int&#40;3&#41;
}
array&#40;5&#41; {
  [&#34;_id&#34;]=&gt;
  object&#40;MongoId&#41;#8 &#40;0&#41; {
  }
  [&#34;test&#34;]=&gt;
  string&#40;11&#41; &#34;bare floats&#34;
  [&#34;a&#34;]=&gt;
  float&#40;1.5&#41;
  [&#34;b&#34;]=&gt;
  float&#40;2.5&#41;
  [&#34;c&#34;]=&gt;
  float&#40;3.5&#41;
}
array&#40;5&#41; {
  [&#34;_id&#34;]=&gt;
  object&#40;MongoId&#41;#7 &#40;0&#41; {
  }
  [&#34;test&#34;]=&gt;
  string&#40;23&#41; &#34;integers as bare floats&#34;
  [&#34;a&#34;]=&gt;
  float&#40;1&#41;
  [&#34;b&#34;]=&gt;
  float&#40;2&#41;
  [&#34;c&#34;]=&gt;
  float&#40;3&#41;
}
array&#40;5&#41; {
  [&#34;_id&#34;]=&gt;
  object&#40;MongoId&#41;#8 &#40;0&#41; {
  }
  [&#34;test&#34;]=&gt;
  string&#40;19&#41; &#34;integers as strings&#34;
  [&#34;a&#34;]=&gt;
  string&#40;1&#41; &#34;1&#34;
  [&#34;b&#34;]=&gt;
  string&#40;1&#41; &#34;2&#34;
  [&#34;c&#34;]=&gt;
  string&#40;1&#41; &#34;3&#34;
}
array&#40;5&#41; {
  [&#34;_id&#34;]=&gt;
  object&#40;MongoId&#41;#7 &#40;0&#41; {
  }
  [&#34;test&#34;]=&gt;
  string&#40;17&#41; &#34;floats as strings&#34;
  [&#34;a&#34;]=&gt;
  string&#40;3&#41; &#34;1.5&#34;
  [&#34;b&#34;]=&gt;
  string&#40;3&#41; &#34;2.5&#34;
  [&#34;c&#34;]=&gt;
  string&#40;3&#41; &#34;3.5&#34;
}

Can you explain what you&#39;re seeing that looks wrong?
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;28&nbsp;09:36:20&nbsp;2010</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Apr&nbsp;28&nbsp;19:16:39&nbsp;2010</span>
    <span class="description">whatson [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #57005] Inconsistent handling of integers</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 29 Apr 2010 09:16:27 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-MongoDB [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Andrew Whatson &lt;whatson [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Kristina,

On two different test machines &#40;CentOS and ArchLinux&#41; both with perl 5.10.1,
MongoDB perl driver 0.33 and MongoDB 1.4.1 I get the following results:

{ &#34;_id&#34; : ObjectId&#40;&#34;4bd8bed5f383ca3272ed1f22&#34;&#41;, &#34;test&#34; : &#34;bare integers&#34;, &#34;a&#34;
: { &#34;floatApprox&#34; : 1 }, &#34;b&#34; : { &#34;floatApprox&#34; : 2 }, &#34;c&#34; : { &#34;floatApprox&#34; :
3 } }
{ &#34;_id&#34; : ObjectId&#40;&#34;4bd8bed5ec5d393272dd8fd9&#34;&#41;, &#34;test&#34; : &#34;bare floats&#34;, &#34;a&#34; :
1.5, &#34;b&#34; : 2.5, &#34;c&#34; : 3.5 }
{ &#34;_id&#34; : ObjectId&#40;&#34;4bd8bed57299423272b482f1&#34;&#41;, &#34;test&#34; : &#34;integers as bare
floats&#34;, &#34;a&#34; : 1, &#34;b&#34; : 2, &#34;c&#34; : 3 }
{ &#34;_id&#34; : ObjectId&#40;&#34;4bd8bed55a10723272e44125&#34;&#41;, &#34;test&#34; : &#34;integers as
strings&#34;, &#34;a&#34; : &#34;1&#34;, &#34;b&#34; : &#34;2&#34;, &#34;c&#34; : &#34;3&#34; }
{ &#34;_id&#34; : ObjectId&#40;&#34;4bd8bed5af780d32720cea37&#34;&#41;, &#34;test&#34; : &#34;floats as strings&#34;,
&#34;a&#34; : &#34;1.5&#34;, &#34;b&#34; : &#34;2.5&#34;, &#34;c&#34; : &#34;3.5&#34; }

It&#39;s the &#39;floatApprox&#39; that really seems odd, and inconsistent with how
integers are treated when entered as bare floats.

Regards,
Andrew
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Thu&nbsp;Apr&nbsp;29&nbsp;21:42:55&nbsp;2010</span>
    <span class="description">whatson [...] gmail.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #57005] Inconsistent handling of integers</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 30 Apr 2010 11:42:45 +1000</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-MongoDB [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Andrew Whatson &lt;whatson [...] gmail.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hi Kristina,

It might also be relevant that both test machines are 64bit.

Regards,
Andrew
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sat&nbsp;May&nbsp;01&nbsp;19:51:04&nbsp;2010</span>
    <span class="description">KRISTINA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">This is because Perl does not distinguish between 32- and 64-bit integers, 
so ints are always saved at 64-bit ints on 64-bit machines.  As the shell 
doesn&#39;t have anything other than a float type, it can&#39;t be sure it can 
represent 64-bit ints exactly, hence the floatApprox.  It&#39;s just letting 
you know that it&#39;s a 64-bit int, so it might be a little off as a float.

I can add some more documentation about how the shell to the 
MongoDB::DataTypes file.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;02&nbsp;08:56:13&nbsp;2010</span>
    <span class="description">KRISTINA [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Updated the docs.
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Sun&nbsp;May&nbsp;02&nbsp;08:56:22&nbsp;2010</span>
    <span class="description">KRISTINA [...] cpan.org -  Status changed from &#39;open&#39; to &#39;resolved&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
