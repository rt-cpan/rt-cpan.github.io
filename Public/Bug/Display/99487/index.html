<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #99487 for Win32-Env: ENV_SYSTEM is Undefined</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #99487 for Win32-Env: ENV_SYSTEM is Undefined</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Win32-Env/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Win32-Env/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Win32-Env/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Win32-Env/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Win32-Env">Win32-Env CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">99487</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">open</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Win32-Env/Active/">Win32-Env</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
bill_chatfield [...] yahoo.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-41148-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-41149-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;14&nbsp;15:16:34&nbsp;2014</span>
    <span class="description">bill_chatfield [...] yahoo.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> ENV_SYSTEM is Undefined</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Tue, 14 Oct 2014 12:16:22 -0700</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Win32-Env [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Bill Chatfield &lt;bill_chatfield [...] yahoo.com&gt;</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">If you have not &#34;Run as Adiministrator&#34;, any usage of ENV_SYSTEM fails with an undefined value. If you do &#34;Run as Administrator&#34;, it works fine.

Two issues:
1. In the case of SetEnv, it should say &#34;Access Denied&#34; or something similar if it is really true that system variables cannot be set unless you &#34;Run as Administrator&#34;. But I don&#39;t think it is true.
2. In the case of GetEnv or ListEnv, it should work. You should be able to look at the system environment variables if you are not an Administrator.

Demonstration:

C:\Users\bill.chatfield\Documents\bin&gt;type Win32EnvDefect.pl
use Win32::Env;
eval {GetEnv&#40;ENV_SYSTEM, &#34;Path&#34;&#41;}; warn $@ if $@;
eval {PutEnv&#40;ENV_SYSTEM, &#34;HOUSE&#34;, &#34;Lannister&#34;&#41;}; warn $@ if $@;
eval {ListEnv&#40;ENV_SYSTEM&#41;}; warn $@ if $@;

C:\Users\bill.chatfield\Documents\bin&gt;Win32EnvDefect.pl
Can&#39;t call method &#34;GetValue&#34; on an undefined value at C:/strawberry/perl/site/li
b/Win32/Env.pm line 159.
Undefined subroutine &#38;main::PutEnv called at C:\Users\bill.chatfield\Documents\b
in\Win32EnvDefect.pl line 3.
Can&#39;t call method &#34;ValueNames&#34; on an undefined value at C:/strawberry/perl/site/
lib/Win32/Env.pm line 191.

C:\Users\bill.chatfield\Documents\bin&gt;perldoc -m Win32::Env
package Win32::Env;
our $VERSION=&#39;0.03&#39;;
-----

C:\Users\bill.chatfield\Documents\bin&gt;systeminfo | more

Host Name:                 LOH001NU2030P2W
OS Name:                   Microsoft Windows 7 Professional
OS Version:                6.1.7601 Service Pack 1 Build 7601
OS Manufacturer:           Microsoft Corporation
OS Configuration:          Member Workstation
OS Build Type:             Multiprocessor Free
Registered Owner:          Cardinal User
Registered Organization:   Cardinal Health, Inc.
Product ID:                00371-868-0000007-85344
Original Install Date:     4/19/2013, 2:17:42 PM
System Boot Time:          10/14/2014, 10:40:10 AM
System Manufacturer:       Hewlett-Packard
System Model:              HP EliteBook 8460p
System Type:               x64-based PC
Processor&#40;s&#41;:              1 Processor&#40;s&#41; Installed.
                           [01]: Intel64 Family 6 Model 42 Stepping 7 GenuineInt
el ~2501 Mhz
BIOS Version:              Hewlett-Packard 68SCF Ver. F.29, 1/4/2013
Windows Directory:         C:\Windows
System Directory:          C:\Windows\system32
-----

C:\Users\bill.chatfield\Documents\bin&gt;perl -V
Summary of my perl5 &#40;revision 5 version 18 subversion 2&#41; configuration:

  Platform:
    osname=MSWin32, osvers=6.2, archname=MSWin32-x64-multi-thread
    uname=&#39;Win32 strawberry-perl 5.18.2.1 #1 Tue Jan  7 22:32:35 2014 x64&#39;
    config_args=&#39;undef&#39;
    hint=recommended, useposix=true, d_sigaction=undef
    useithreads=define, usemultiplicity=define
    useperlio=define, d_sfio=undef, uselargefiles=define, usesocks=undef
    use64bitint=define, use64bitall=undef, uselongdouble=undef
    usemymalloc=n, bincompat5005=undef
  Compiler:
    cc=&#39;gcc&#39;, ccflags =&#39; -s -O2 -DWIN32 -DWIN64 -DCONSERVATIVE  -DPERL_TEXTMODE_
SCRIPTS -DPERL_IMPLICIT_CONTEXT -DPERL_IMPLICIT_SYS -DUSE_PERLIO -fno-strict-ali
asing -mms-bitfields&#39;,
    optimize=&#39;-s -O2&#39;,
    cppflags=&#39;-DWIN32&#39;
    ccversion=&#39;&#39;, gccversion=&#39;4.7.3&#39;, gccosandvers=&#39;&#39;
    intsize=4, longsize=4, ptrsize=8, doublesize=8, byteorder=12345678
    d_longlong=define, longlongsize=8, d_longdbl=define, longdblsize=12
    ivtype=&#39;long long&#39;, ivsize=8, nvtype=&#39;double&#39;, nvsize=8, Off_t=&#39;long long&#39;,
lseeksize=8
    alignbytes=8, prototype=define
  Linker and Libraries:
    ld=&#39;g++&#39;, ldflags =&#39;-s -L&#34;C:\strawberry\perl\lib\CORE&#34; -L&#34;C:\strawberry\c\li
b&#34;&#39;
    libpth=C:\strawberry\c\lib C:\strawberry\c\x86_64-w64-mingw32\lib C:\strawbe
rry\c\lib\gcc\x86_64-w64-mingw32\4.7.3
    libs=-lmoldname -lkernel32 -luser32 -lgdi32 -lwinspool -lcomdlg32 -ladvapi32
 -lshell32 -lole32 -loleaut32 -lnetapi32 -luuid -lws2_32 -lmpr -lwinmm -lversion
 -lodbc32 -lodbccp32 -lcomctl32
    perllibs=-lmoldname -lkernel32 -luser32 -lgdi32 -lwinspool -lcomdlg32 -ladva
pi32 -lshell32 -lole32 -loleaut32 -lnetapi32 -luuid -lws2_32 -lmpr -lwinmm -lver
sion -lodbc32 -lodbccp32 -lcomctl32
    libc=, so=dll, useshrplib=true, libperl=libperl518.a
    gnulibc_version=&#39;&#39;
  Dynamic Linking:
    dlsrc=dl_win32.xs, dlext=dll, d_dlsymun=undef, ccdlflags=&#39; &#39;
    cccdlflags=&#39; &#39;, lddlflags=&#39;-mdll -s -L&#34;C:\strawberry\perl\lib\CORE&#34; -L&#34;C:\st
rawberry\c\lib&#34;&#39;


Characteristics of this binary &#40;from libperl&#41;:
  Compile-time options: HAS_TIMES HAVE_INTERP_INTERN MULTIPLICITY
                        PERLIO_LAYERS PERL_DONT_CREATE_GVSV
                        PERL_HASH_FUNC_ONE_AT_A_TIME_HARD
                        PERL_IMPLICIT_CONTEXT PERL_IMPLICIT_SYS
                        PERL_MALLOC_WRAP PERL_PRESERVE_IVUV PERL_SAWAMPERSAND
                        USE_64_BIT_INT USE_ITHREADS USE_LARGE_FILES
                        USE_LOCALE USE_LOCALE_COLLATE USE_LOCALE_CTYPE
                        USE_LOCALE_NUMERIC USE_PERLIO USE_PERL_ATOF
  Built under MSWin32
  Compiled at Jan  7 2014 22:40:30
  @INC:
    C:/strawberry/perl/site/lib
    C:/strawberry/perl/vendor/lib
    C:/strawberry/perl/lib
    .
</div></div>
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;09&nbsp;16:17:03&nbsp;2018</span>
    <span class="description">LSTEVENS [...] cpan.org -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      

<div class="messagebody">
<div class="message-stanza plain-text-white-space">Hit the same problem, using GetEnv on Win32::Env 0.03
I fixed the module with the changes below.
This fixes both GetEnv and ListEnv; not bothered about SetEnv.

35c35
&lt; use Win32::TieRegistry&#40;FixSzNulls=&gt;1&#41;;
---
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; use Win32::TieRegistry&#40;FixSzNulls=&gt;1, qw&#40;KEY_READ&#41;&#41;;
</div>159c159
&lt;  my&#40;$value, $type&#41;=Win32::TieRegistry-&gt;new&#40;$sysusr&#41;-&gt;GetValue&#40;$var&#41;;
---
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  my&#40;$value, $type&#41;=Win32::TieRegistry-&gt;new&#40;$sysusr, {Access=&gt;KEY_READ}&#41;-&gt;GetValue&#40;$var&#41;;
</div>191c191
&lt;  return Win32::TieRegistry-&gt;new&#40;$sysusr&#41;-&gt;ValueNames;
---
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  return Win32::TieRegistry-&gt;new&#40;$sysusr, {Access=&gt;KEY_READ}&#41;-&gt;ValueNames;
</div>

 

On Tue Oct 14 15:16:34 2014, bill_chatfield@yahoo.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If you have not &#34;Run as Adiministrator&#34;, any usage of ENV_SYSTEM fails
&gt; with an undefined value. If you do &#34;Run as Administrator&#34;, it works
&gt; fine.
&gt; 
&gt; Two issues:
&gt; 1. In the case of SetEnv, it should say &#34;Access Denied&#34; or something
&gt; similar if it is really true that system variables cannot be set
&gt; unless you &#34;Run as Administrator&#34;. But I don&#39;t think it is true.
&gt; 2. In the case of GetEnv or ListEnv, it should work. You should be
&gt; able to look at the system environment variables if you are not an
&gt; Administrator.
&gt; 
&gt; Demonstration:
&gt; 
&gt; C:\Users\bill.chatfield\Documents\bin&gt;type Win32EnvDefect.pl
&gt; use Win32::Env;
&gt; eval {GetEnv&#40;ENV_SYSTEM, &#34;Path&#34;&#41;}; warn $@ if $@;
&gt; eval {PutEnv&#40;ENV_SYSTEM, &#34;HOUSE&#34;, &#34;Lannister&#34;&#41;}; warn $@ if $@;
&gt; eval {ListEnv&#40;ENV_SYSTEM&#41;}; warn $@ if $@;
&gt; 
&gt; C:\Users\bill.chatfield\Documents\bin&gt;Win32EnvDefect.pl
&gt; Can&#39;t call method &#34;GetValue&#34; on an undefined value at
&gt; C:/strawberry/perl/site/li
&gt; b/Win32/Env.pm line 159.
&gt; Undefined subroutine &#38;main::PutEnv called at
&gt; C:\Users\bill.chatfield\Documents\b
&gt; in\Win32EnvDefect.pl line 3.
&gt; Can&#39;t call method &#34;ValueNames&#34; on an undefined value at
&gt; C:/strawberry/perl/site/
&gt; lib/Win32/Env.pm line 191.
&gt; 
&gt; C:\Users\bill.chatfield\Documents\bin&gt;perldoc -m Win32::Env
&gt; package Win32::Env;
&gt; our $VERSION=&#39;0.03&#39;;
&gt; -----
&gt; 
&gt; C:\Users\bill.chatfield\Documents\bin&gt;systeminfo | more
&gt; 
&gt; Host Name:                 LOH001NU2030P2W
&gt; OS Name:                   Microsoft Windows 7 Professional
&gt; OS Version:                6.1.7601 Service Pack 1 Build 7601
&gt; OS Manufacturer:           Microsoft Corporation
&gt; OS Configuration:          Member Workstation
&gt; OS Build Type:             Multiprocessor Free
&gt; Registered Owner:          Cardinal User
&gt; Registered Organization:   Cardinal Health, Inc.
&gt; Product ID:                00371-868-0000007-85344
&gt; Original Install Date:     4/19/2013, 2:17:42 PM
&gt; System Boot Time:          10/14/2014, 10:40:10 AM
&gt; System Manufacturer:       Hewlett-Packard
&gt; System Model:              HP EliteBook 8460p
&gt; System Type:               x64-based PC
&gt; Processor&#40;s&#41;:              1 Processor&#40;s&#41; Installed.
&gt;                            [01]: Intel64 Family 6 Model 42 Stepping 7
&gt; GenuineInt
&gt; el ~2501 Mhz
&gt; BIOS Version:              Hewlett-Packard 68SCF Ver. F.29, 1/4/2013
&gt; Windows Directory:         C:\Windows
&gt; System Directory:          C:\Windows\system32
&gt; -----
&gt; 
&gt; C:\Users\bill.chatfield\Documents\bin&gt;perl -V
&gt; Summary of my perl5 &#40;revision 5 version 18 subversion 2&#41;
&gt; configuration:
&gt; 
&gt; Platform:
&gt;   osname=MSWin32, osvers=6.2, archname=MSWin32-x64-multi-thread
&gt;   uname=&#39;Win32 strawberry-perl 5.18.2.1 #1 Tue Jan  7 22:32:35 2014
&gt; x64&#39;
&gt;   config_args=&#39;undef&#39;
&gt;   hint=recommended, useposix=true, d_sigaction=undef
&gt;   useithreads=define, usemultiplicity=define
&gt;   useperlio=define, d_sfio=undef, uselargefiles=define, usesocks=undef
&gt;   use64bitint=define, use64bitall=undef, uselongdouble=undef
&gt;   usemymalloc=n, bincompat5005=undef
&gt; Compiler:
&gt;   cc=&#39;gcc&#39;, ccflags =&#39; -s -O2 -DWIN32 -DWIN64 -DCONSERVATIVE
&gt; -DPERL_TEXTMODE_
&gt; SCRIPTS -DPERL_IMPLICIT_CONTEXT -DPERL_IMPLICIT_SYS -DUSE_PERLIO -fno-
&gt; strict-ali
&gt; asing -mms-bitfields&#39;,
&gt;   optimize=&#39;-s -O2&#39;,
&gt;   cppflags=&#39;-DWIN32&#39;
&gt;   ccversion=&#39;&#39;, gccversion=&#39;4.7.3&#39;, gccosandvers=&#39;&#39;
&gt;   intsize=4, longsize=4, ptrsize=8, doublesize=8, byteorder=12345678
&gt;   d_longlong=define, longlongsize=8, d_longdbl=define, longdblsize=12
&gt;   ivtype=&#39;long long&#39;, ivsize=8, nvtype=&#39;double&#39;, nvsize=8, Off_t=&#39;long
&gt; long&#39;,
&gt; lseeksize=8
&gt;   alignbytes=8, prototype=define
&gt; Linker and Libraries:
&gt;   ld=&#39;g++&#39;, ldflags =&#39;-s -L&#34;C:\strawberry\perl\lib\CORE&#34;
&gt; -L&#34;C:\strawberry\c\li
&gt; b&#34;&#39;
&gt;   libpth=C:\strawberry\c\lib C:\strawberry\c\x86_64-w64-mingw32\lib
&gt; C:\strawbe
&gt; rry\c\lib\gcc\x86_64-w64-mingw32\4.7.3
&gt;   libs=-lmoldname -lkernel32 -luser32 -lgdi32 -lwinspool -lcomdlg32
&gt; -ladvapi32
&gt; -lshell32 -lole32 -loleaut32 -lnetapi32 -luuid -lws2_32 -lmpr -lwinmm
&gt; -lversion
&gt; -lodbc32 -lodbccp32 -lcomctl32
&gt;   perllibs=-lmoldname -lkernel32 -luser32 -lgdi32 -lwinspool
&gt; -lcomdlg32 -ladva
&gt; pi32 -lshell32 -lole32 -loleaut32 -lnetapi32 -luuid -lws2_32 -lmpr
&gt; -lwinmm -lver
&gt; sion -lodbc32 -lodbccp32 -lcomctl32
&gt;   libc=, so=dll, useshrplib=true, libperl=libperl518.a
&gt;   gnulibc_version=&#39;&#39;
&gt; Dynamic Linking:
&gt;   dlsrc=dl_win32.xs, dlext=dll, d_dlsymun=undef, ccdlflags=&#39; &#39;
&gt;   cccdlflags=&#39; &#39;, lddlflags=&#39;-mdll -s -L&#34;C:\strawberry\perl\lib\CORE&#34;
&gt; -L&#34;C:\st
&gt; rawberry\c\lib&#34;&#39;
&gt; 
&gt; 
&gt; Characteristics of this binary &#40;from libperl&#41;:
&gt;   Compile-time options: HAS_TIMES HAVE_INTERP_INTERN MULTIPLICITY
&gt;                         PERLIO_LAYERS PERL_DONT_CREATE_GVSV
&gt;                         PERL_HASH_FUNC_ONE_AT_A_TIME_HARD
&gt;                         PERL_IMPLICIT_CONTEXT PERL_IMPLICIT_SYS
&gt;                         PERL_MALLOC_WRAP PERL_PRESERVE_IVUV
&gt; PERL_SAWAMPERSAND
&gt;                         USE_64_BIT_INT USE_ITHREADS USE_LARGE_FILES
&gt;                         USE_LOCALE USE_LOCALE_COLLATE USE_LOCALE_CTYPE
&gt;                         USE_LOCALE_NUMERIC USE_PERLIO USE_PERL_ATOF
&gt;   Built under MSWin32
&gt;   Compiled at Jan  7 2014 22:40:30
&gt;   @INC:
&gt;     C:/strawberry/perl/site/lib
&gt;     C:/strawberry/perl/vendor/lib
&gt;     C:/strawberry/perl/lib
&gt;     .
</div></div></div>
    </div>
</div>
</div>
<div class="ticket-transaction basics Status odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Tue&nbsp;Oct&nbsp;09&nbsp;16:17:03&nbsp;2018</span>
    <span class="description">The RT System itself -  Status changed from &#39;new&#39; to &#39;open&#39;</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
    </div>
</div>
</div>
<div class="ticket-transaction message Correspond even">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Wed&nbsp;Oct&nbsp;10&nbsp;23:13:09&nbsp;2018</span>
    <span class="description">bill_chatfield [...] yahoo.com -  Correspondence added</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Re: [rt.cpan.org #99487] ENV_SYSTEM is Undefined</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Thu, 11 Oct 2018 03:12:42 +0000 &#40;UTC&#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> Ludovico Stevens via RT &lt;bug-Win32-Env [...] rt.cpan.org&gt;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Bill Chatfield &lt;bill_chatfield [...] yahoo.com&gt;</td>
  </tr>
</table>
<div class="messageattachments">

<div class="messagebody">
<div class="message-stanza plain-text-white-space"> That&#39;s great! Nice work.

    On Tuesday, October 9, 2018, 4:17:06 PM EDT, Ludovico Stevens via RT &lt;bug-Win32-Env@rt.cpan.org&gt; wrote:  
 
 &lt;URL: <span class="clickylink"><a target="new" rel="nofollow" href="https://rt.cpan.org/Ticket/Display.html?id=99487">https://rt.cpan.org/Ticket/Display.html?id=99487</a></span> &gt;

Hit the same problem, using GetEnv on Win32::Env 0.03
I fixed the module with the changes below.
This fixes both GetEnv and ListEnv; not bothered about SetEnv.

35c35
&lt; use Win32::TieRegistry&#40;FixSzNulls=&gt;1&#41;;
---
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; use Win32::TieRegistry&#40;FixSzNulls=&gt;1, qw&#40;KEY_READ&#41;&#41;;
</div>159c159
&lt;  my&#40;$value, $type&#41;=Win32::TieRegistry-&gt;new&#40;$sysusr&#41;-&gt;GetValue&#40;$var&#41;;
---
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  my&#40;$value, $type&#41;=Win32::TieRegistry-&gt;new&#40;$sysusr, {Access=&gt;KEY_READ}&#41;-&gt;GetValue&#40;$var&#41;;
</div>191c191
&lt;  return Win32::TieRegistry-&gt;new&#40;$sysusr&#41;-&gt;ValueNames;
---
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt;  return Win32::TieRegistry-&gt;new&#40;$sysusr, {Access=&gt;KEY_READ}&#41;-&gt;ValueNames;
</div>

 

On Tue Oct 14 15:16:34 2014, bill_chatfield@yahoo.com wrote:
<span
    class="message-stanza-folder closed"
    onclick="fold_message_stanza(this, 'Show\x20quoted\x20text', 'Hide\x20quoted\x20text');">Show quoted text</span><br /><div class="message-stanza closed">&gt; If you have not &#34;Run as Adiministrator&#34;, any usage of ENV_SYSTEM fails
&gt; with an undefined value. If you do &#34;Run as Administrator&#34;, it works
&gt; fine.
&gt; 
&gt; Two issues:
&gt; 1. In the case of SetEnv, it should say &#34;Access Denied&#34; or something
&gt; similar if it is really true that system variables cannot be set
&gt; unless you &#34;Run as Administrator&#34;. But I don&#39;t think it is true.
&gt; 2. In the case of GetEnv or ListEnv, it should work. You should be
&gt; able to look at the system environment variables if you are not an
&gt; Administrator.
&gt; 
&gt; Demonstration:
&gt; 
&gt; C:\Users\bill.chatfield\Documents\bin&gt;type Win32EnvDefect.pl
&gt; use Win32::Env;
&gt; eval {GetEnv&#40;ENV_SYSTEM, &#34;Path&#34;&#41;}; warn $@ if $@;
&gt; eval {PutEnv&#40;ENV_SYSTEM, &#34;HOUSE&#34;, &#34;Lannister&#34;&#41;}; warn $@ if $@;
&gt; eval {ListEnv&#40;ENV_SYSTEM&#41;}; warn $@ if $@;
&gt; 
&gt; C:\Users\bill.chatfield\Documents\bin&gt;Win32EnvDefect.pl
&gt; Can&#39;t call method &#34;GetValue&#34; on an undefined value at
&gt; C:/strawberry/perl/site/li
&gt; b/Win32/Env.pm line 159.
&gt; Undefined subroutine &#38;main::PutEnv called at
&gt; C:\Users\bill.chatfield\Documents\b
&gt; in\Win32EnvDefect.pl line 3.
&gt; Can&#39;t call method &#34;ValueNames&#34; on an undefined value at
&gt; C:/strawberry/perl/site/
&gt; lib/Win32/Env.pm line 191.
&gt; 
&gt; C:\Users\bill.chatfield\Documents\bin&gt;perldoc -m Win32::Env
&gt; package Win32::Env;
&gt; our $VERSION=&#39;0.03&#39;;
&gt; -----
&gt; 
&gt; C:\Users\bill.chatfield\Documents\bin&gt;systeminfo | more
&gt; 
&gt; Host Name:                LOH001NU2030P2W
&gt; OS Name:                  Microsoft Windows 7 Professional
&gt; OS Version:                6.1.7601 Service Pack 1 Build 7601
&gt; OS Manufacturer:          Microsoft Corporation
&gt; OS Configuration:          Member Workstation
&gt; OS Build Type:            Multiprocessor Free
&gt; Registered Owner:          Cardinal User
&gt; Registered Organization:  Cardinal Health, Inc.
&gt; Product ID:                00371-868-0000007-85344
&gt; Original Install Date:    4/19/2013, 2:17:42 PM
&gt; System Boot Time:          10/14/2014, 10:40:10 AM
&gt; System Manufacturer:      Hewlett-Packard
&gt; System Model:              HP EliteBook 8460p
&gt; System Type:              x64-based PC
&gt; Processor&#40;s&#41;:              1 Processor&#40;s&#41; Installed.
&gt;                            [01]: Intel64 Family 6 Model 42 Stepping 7
&gt; GenuineInt
&gt; el ~2501 Mhz
&gt; BIOS Version:              Hewlett-Packard 68SCF Ver. F.29, 1/4/2013
&gt; Windows Directory:        C:\Windows
&gt; System Directory:          C:\Windows\system32
&gt; -----
&gt; 
&gt; C:\Users\bill.chatfield\Documents\bin&gt;perl -V
&gt; Summary of my perl5 &#40;revision 5 version 18 subversion 2&#41;
&gt; configuration:
&gt; 
&gt; Platform:
&gt;  osname=MSWin32, osvers=6.2, archname=MSWin32-x64-multi-thread
&gt;  uname=&#39;Win32 strawberry-perl 5.18.2.1 #1 Tue Jan  7 22:32:35 2014
&gt; x64&#39;
&gt;  config_args=&#39;undef&#39;
&gt;  hint=recommended, useposix=true, d_sigaction=undef
&gt;  useithreads=define, usemultiplicity=define
&gt;  useperlio=define, d_sfio=undef, uselargefiles=define, usesocks=undef
&gt;  use64bitint=define, use64bitall=undef, uselongdouble=undef
&gt;  usemymalloc=n, bincompat5005=undef
&gt; Compiler:
&gt;  cc=&#39;gcc&#39;, ccflags =&#39; -s -O2 -DWIN32 -DWIN64 -DCONSERVATIVE
&gt; -DPERL_TEXTMODE_
&gt; SCRIPTS -DPERL_IMPLICIT_CONTEXT -DPERL_IMPLICIT_SYS -DUSE_PERLIO -fno-
&gt; strict-ali
&gt; asing -mms-bitfields&#39;,
&gt;  optimize=&#39;-s -O2&#39;,
&gt;  cppflags=&#39;-DWIN32&#39;
&gt;  ccversion=&#39;&#39;, gccversion=&#39;4.7.3&#39;, gccosandvers=&#39;&#39;
&gt;  intsize=4, longsize=4, ptrsize=8, doublesize=8, byteorder=12345678
&gt;  d_longlong=define, longlongsize=8, d_longdbl=define, longdblsize=12
&gt;  ivtype=&#39;long long&#39;, ivsize=8, nvtype=&#39;double&#39;, nvsize=8, Off_t=&#39;long
&gt; long&#39;,
&gt; lseeksize=8
&gt;  alignbytes=8, prototype=define
&gt; Linker and Libraries:
&gt;  ld=&#39;g++&#39;, ldflags =&#39;-s -L&#34;C:\strawberry\perl\lib\CORE&#34;
&gt; -L&#34;C:\strawberry\c\li
&gt; b&#34;&#39;
&gt;  libpth=C:\strawberry\c\lib C:\strawberry\c\x86_64-w64-mingw32\lib
&gt; C:\strawbe
&gt; rry\c\lib\gcc\x86_64-w64-mingw32\4.7.3
&gt;  libs=-lmoldname -lkernel32 -luser32 -lgdi32 -lwinspool -lcomdlg32
&gt; -ladvapi32
&gt; -lshell32 -lole32 -loleaut32 -lnetapi32 -luuid -lws2_32 -lmpr -lwinmm
&gt; -lversion
&gt; -lodbc32 -lodbccp32 -lcomctl32
&gt;  perllibs=-lmoldname -lkernel32 -luser32 -lgdi32 -lwinspool
&gt; -lcomdlg32 -ladva
&gt; pi32 -lshell32 -lole32 -loleaut32 -lnetapi32 -luuid -lws2_32 -lmpr
&gt; -lwinmm -lver
&gt; sion -lodbc32 -lodbccp32 -lcomctl32
&gt;  libc=, so=dll, useshrplib=true, libperl=libperl518.a
&gt;  gnulibc_version=&#39;&#39;
&gt; Dynamic Linking:
&gt;  dlsrc=dl_win32.xs, dlext=dll, d_dlsymun=undef, ccdlflags=&#39; &#39;
&gt;  cccdlflags=&#39; &#39;, lddlflags=&#39;-mdll -s -L&#34;C:\strawberry\perl\lib\CORE&#34;
&gt; -L&#34;C:\st
&gt; rawberry\c\lib&#34;&#39;
&gt; 
&gt; 
&gt; Characteristics of this binary &#40;from libperl&#41;:
&gt;  Compile-time options: HAS_TIMES HAVE_INTERP_INTERN MULTIPLICITY
&gt;                        PERLIO_LAYERS PERL_DONT_CREATE_GVSV
&gt;                        PERL_HASH_FUNC_ONE_AT_A_TIME_HARD
&gt;                        PERL_IMPLICIT_CONTEXT PERL_IMPLICIT_SYS
&gt;                        PERL_MALLOC_WRAP PERL_PRESERVE_IVUV
&gt; PERL_SAWAMPERSAND
&gt;                        USE_64_BIT_INT USE_ITHREADS USE_LARGE_FILES
&gt;                        USE_LOCALE USE_LOCALE_COLLATE USE_LOCALE_CTYPE
&gt;                        USE_LOCALE_NUMERIC USE_PERLIO USE_PERL_ATOF
&gt;  Built under MSWin32
&gt;  Compiled at Jan  7 2014 22:40:30
&gt;  @INC:
&gt;    C:/strawberry/perl/site/lib
&gt;    C:/strawberry/perl/vendor/lib
&gt;    C:/strawberry/perl/lib
&gt;    .
</div>


  
</div></div>

<div class="messagebody">
<p>Message body is not shown because it is too large.</p></div>
</div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
