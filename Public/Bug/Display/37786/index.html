<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Bug #37786 for Test-MockObject: Test::MockObject 1.09 bug found in call_args&#40;&#41;                                                                           &#40; NOT IMPORTANT: &#41;</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- The X-UA-Compatible <meta> tag above must be very early in <head> -->

    <script>
if (window.top !== window.self) {
    document.write = "";

    window.top.location = window.self.location;

    setTimeout(function(){
        document.body.innerHTML = "";
    }, 1);

    window.self.onload = function(){
        document.body.innerHTML = "";
    };
}
</script>



<link rel="shortcut icon" href="/NoAuth/images/favicon.png" type="image/png" />
<link rel="stylesheet" href="/NoAuth/css/aileron-squished-00f758259152f8b6670ee485f462e6b8.css" type="text/css" media="all" />
<link rel="stylesheet" href="/NoAuth/css/print.css" type="text/css" media="print" />




<script type="text/javascript" src="/NoAuth/js/squished-42167f2409ce368da2d31038e5cb2a57.js"></script>

<script type="text/javascript"><!--
	jQuery( loadTitleBoxStates );

--></script>


<!--[if lt IE 8]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie.css" type="text/css" media="all" />
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" href="/NoAuth/css/aileron/msie6.css" type="text/css" media="all" />
<![endif]-->
<script type="text/javascript">
jQuery(document).ready(function(){
    jQuery.fn.supersubs.defaults = {
        maxWidth: 30,
        extraWidth: 2
    };

    jQuery("#app-nav.toplevel").addClass('sf-menu sf-js-enabled sf-shadow').supersubs().superfish({ speed: 'fast' });
    jQuery("#page-menu.toplevel").addClass('sf-menu sf-js-enabled').supersubs().superfish({ dropShadows: false, speed: 'fast' }).supposition();
});
</script>


<!-- Site CSS from theme editor -->
<style type="text/css" media="all" id="sitecss">
</style>

<meta name="google-site-verification" content="kD3-uEJK1AkTqaC-rckcSt_HPkAj674DPPuEN6i-y0g" />

</head>
  <body class="aileron sidebyside" id="comp-Public-Bug-Display">

<div id="logo">
<a href="/"><img
    src="/NoAuth/images/cpan.png"
    alt="CPAN"
    width="181"
    height="38" /></a>
    <span class="rtname">RT for rt.cpan.org</span>
</div>


<div id="quickbar">
  <div id="quick-personal">
    <span class="hide"><a href="#skipnav">Skip Menu</a> | </span>
</div>

</div>
<div id="header"><h1>Bug #37786 for Test-MockObject: Test::MockObject 1.09 bug found in call_args&#40;&#41;                                                                           &#40; NOT IMPORTANT: &#41;</h1></div>



<div id="page-navigation"><ul id="page-menu" class="toplevel">
 <li id="li-page-active_bugs"><a id="page-active_bugs" class="menu-item " href="/Public/Dist/Test-MockObject/Active/">Active bugs</a></li>
 <li id="li-page-resolved_bugs"><a id="page-resolved_bugs" class="menu-item " href="/Public/Dist/Test-MockObject/Resolved/">Resolved bugs</a></li>
 <li id="li-page-rejected_bugs"><a id="page-rejected_bugs" class="menu-item " href="/Public/Dist/Test-MockObject/Rejected/">Rejected bugs</a></li>
 <li id="li-page-report"><a id="page-report" class="menu-item " href="/Public/Dist/Test-MockObject/Active/"></a></li>
</ul></div>
<div id="topactions">



</div>
<div id="body">


<a name="skipnav" id="skipnav" accesskey="8"></a>





<p>This queue is for tickets about the <a href="https://metacpan.org/release/Test-MockObject">Test-MockObject CPAN distribution</a>.</p>





<div class="">
  <div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DUmVwb3J0IGluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Report information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------UmVwb3J0IGluZm9ybWF0aW9u---0">


<table width="100%" class="ticket-summary">
<tr>
  <td valign="top" class="boxcontainer">
    <div class="ticket-info-basics">
  <div class="titlebox ticket-info-basics " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dbasics\x2D\x2D\x2D\x2DVGhlIEJhc2ljcw\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">The Basics</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-basics----VGhlIEJhc2ljcw__---0">


        <table>
  <tr class="id">
    <td class="label">Id:</td>
    <td class="value">37786</td>
  </tr>
  <tr class="status">
    <td class="label">Status:</td>
    <td class="value">new</td>
  </tr>
  <tr class="priority">
    <td class="label">Priority:</td>
    <td class="value">0/
</td>
  </tr>
  <tr class="queue">
    <td class="label">Queue:</td>
    <td class="value"><a href="/Public/Dist/Test-MockObject/Active/">Test-MockObject</a>
</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>


    <div class="ticket-info-people">
  <div class="titlebox ticket-info-people " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dpeople\x2D\x2D\x2D\x2DUGVvcGxl\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">People</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-people----UGVvcGxl---0">


        <table>
  <tr>
    <td class="label">Owner:</td>
    <td class="value">Nobody in particular
    
    </td>
  </tr>
  <tr>
    <td class="labeltop">Requestors:</td>
    <td class="value">
Brent.Cowgill [...] FT.com

<br />

</td>
  </tr>
  <tr>
    <td class="labeltop">Cc:</td>
    <td class="value">

</td>
  </tr>
  <tr>
    <td class="labeltop">AdminCc:</td>
    <td class="value">

</td>
  </tr>
</table>

        <hr class="clear" />
  </div>
</div>




</div>



  </td>
  <td valign="top" class="boxcontainer">
    
    <div class="ticket-info-cfs">
  <div class="titlebox ticket-info-cfs " id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2Dticket\x2Dinfo\x2Dcfs\x2D\x2D\x2D\x2DQnVnIEluZm9ybWF0aW9u\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">Bug Information</span>
    <span class="right-empty">		    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html--ticket-info-cfs----QnVnIEluZm9ybWF0aW9u---0">

 
        <table>
  <tr id="CF-1-ShowRow">
    <td class="label">Severity:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-31500-ShowRow">
    <td class="label">Broken in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
  <tr id="CF-31501-ShowRow">
    <td class="label">Fixed in:</td>
    <td class="value">
<i>(no value)</i>
    </td>
  </tr>
</table>


        <hr class="clear" />
  </div>
</div>




</div>


    




  </td>
</tr>
</table>

    <hr class="clear" />
  </div>
</div>




</div>


<br />


<div class="history">
<div class="titlebox" id="">
  <div class="titlebox-title">
    <span class="widget"><a href="#" onclick="return rollup('TitleBox\x2D\x2D\x5FPublic\x5FBug\x5FDisplay\x5Fhtml\x2D\x2D\x2D\x2D\x2D\x2DSGlzdG9yeQ\x5F\x5F\x2D\x2D\x2D0');" title="Toggle visibility"></a></span>
    <span class="left">History</span>
    <span class="right">		<a href="#" data-direction="open" onclick="return toggle_all_folds(this, 'Show\x20all\x20quoted\x20text', 'Hide\x20all\x20quoted\x20text');">Show all quoted text</a>    </span>
  </div>
  <div class="titlebox-content " id="TitleBox--_Public_Bug_Display_html------SGlzdG9yeQ__---0">


<div id="ticket-history">
<div class="ticket-transaction message Create odd">
<div class="ticket-transaction">
  <div class="metadata">
    <span class="type">
      &nbsp;      
    </span>
    <span class="date">Fri&nbsp;Jul&nbsp;18&nbsp;10:30:23&nbsp;2008</span>
    <span class="description">Brent.Cowgill [...] FT.com -  Ticket created</span>
    <span class="time-taken"></span>    <span class="actions hidden"></span>
  </div>
    <div class="content">
      
<table>
  <tr>
    <td align="right" class="message-header-key">Subject:</td>
    <td class="message-header-value"> Test::MockObject 1.09 bug found in call_args&#40;&#41;                                                                           &#40; NOT IMPORTANT: &#41;</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">Date:</td>
    <td class="message-header-value"> Fri, 18 Jul 2008 15:23:21 +0100</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">To:</td>
    <td class="message-header-value"> bug-Test-MockObject [...] rt.cpan.org</td>
  </tr>
  <tr>
    <td align="right" class="message-header-key">From:</td>
    <td class="message-header-value"> Brent.Cowgill [...] FT.com</td>
  </tr>
</table>

<div class="messagebody">
<div class="message-stanza plain-text-white-space">



Hi There,

See the sample code below which demonstrates what I think is a bug in
Test::MockObject 1.09 call_args&#40;&#41;
perl v5.8.0
SunOS 5.8 Generic_117350-16 sun4u sparc SUNW,Ultra-4

#!/opt/customer/local/perl58/bin/perl
# Demonstrates a bug in MockObject.
#  the call_pos&#40;&#41; method is well behaved when trying to get the name of a
#  method call at a position that doesn&#39;t exist, but the call_args&#40;&#41;
#  method does not, throwing an exception and aborting the test plan
#  instead of just returning undef or an empty array
#
#   1..8
#   ok 1 - checking that id&#40;&#41; was called first
#   ok 2 - checking that id&#40;&#41; was called second
#   ok 3 - checking that id&#40;&#41; was called first with 42
#   ok 4 - checking that id&#40;&#41; was called second with 56
#   not ok 5 - checking that id&#40;&#41; was called first
#   #   Failed test &#39;checking that id&#40;&#41; was called first&#39;
#   #   at ./MockObjectBug.t line 68.
#   #          got: undef
#   #     expected: &#39;id&#39;
#   not ok 6 - checking that id&#40;&#41; was called second
#   #   Failed test &#39;checking that id&#40;&#41; was called second&#39;
#   #   at ./MockObjectBug.t line 69.
#   #          got: undef
#   #     expected: &#39;id&#39;
#   Testing Aborted: Can&#39;t use an undefined value as an ARRAY reference at
/export/home/bcowgill/.cpan/build/Test-MockObject-1.09
/blib/lib/Test/MockObject.pm line 166.
#
#   # Looks like you planned 8 tests but only ran 6.
#   # Looks like you failed 2 tests of 6 run.

use strict;
use warnings;
use English qw&#40; -no_match_vars &#41;;
use diagnostics;

use Test::More tests =&gt; 8;
use Test::MockObject;

my $DEBUG = 0;

eval {
   test_run&#40;&#41;;
};
if &#40;$EVAL_ERROR&#41; {
   print &#34;Testing Aborted: $@\n&#34;;
} # if &#40;$EVAL_ERROR&#41;

#--------------------------------------------------------------------------
# Individual test suites
#--------------------------------------------------------------------------

sub run_successful_test
{
   my &#40;$mock_schema&#41; = @ARG;
   # An example when the test runs successfully and mock methods get
called.
   $mock_schema-&gt;id&#40;42&#41;;
   $mock_schema-&gt;id&#40;56&#41;;
} # successful_test&#40;&#41;

sub run_failed_test
{
   my &#40;$mock_schema&#41; = @ARG;

   # In this case, we assume a bug has been introduced in the code causing
   # the mock object method calls not to happen. We expect test case to
fail
   # but instead the whole test plan gets aborted.
   # Do not call -&gt;id&#40;&#41; method on mock schema
} # run_failed_test&#40;&#41;

sub test_run
{
   # Mock the database
   my $mock_schema = Test::MockObject-&gt;new&#40;&#41;;
   $mock_schema-&gt;fake_module&#40; &#39;FT::Release::DBIC::Schema&#39; &#41;;
   $mock_schema-&gt;set_always&#40;&#39;id&#39;, 1&#41;;

   run_successful_test&#40;$mock_schema&#41;;
   show_mock_calls&#40;&#39;mock_schema&#39;, $mock_schema&#41; if $DEBUG;
   is&#40;$mock_schema-&gt;call_pos&#40;1&#41;, &#39;id&#39;, &#39;checking that id&#40;&#41; was called
first&#39;&#41;;
   is&#40;$mock_schema-&gt;call_pos&#40;2&#41;, &#39;id&#39;, &#39;checking that id&#40;&#41; was called
second&#39;&#41;;
   is&#40;&#40;$mock_schema-&gt;call_args&#40;1&#41;&#41;[1], 42, &#39;checking that id&#40;&#41; was called
first with 42&#39;&#41;;
   is&#40;&#40;$mock_schema-&gt;call_args&#40;2&#41;&#41;[1], 56, &#39;checking that id&#40;&#41; was called
second with 56&#39;&#41;;
   $mock_schema-&gt;clear&#40;&#41;;

   run_failed_test&#40;$mock_schema&#41;;
   show_mock_calls&#40;&#39;mock_schema&#39;, $mock_schema&#41; if $DEBUG;
   is&#40;$mock_schema-&gt;call_pos&#40;1&#41;, &#39;id&#39;, &#39;checking that id&#40;&#41; was called
first&#39;&#41;;
   is&#40;$mock_schema-&gt;call_pos&#40;2&#41;, &#39;id&#39;, &#39;checking that id&#40;&#41; was called
second&#39;&#41;;

   # HERE WE GO, TESTS SHOULD JUST FAIL BUT NO, THEY ABORT COMPLETELY
   is&#40;&#40;$mock_schema-&gt;call_args&#40;1&#41;&#41;[1], 42, &#39;checking that id&#40;&#41; was called
first with 42&#39;&#41;;
   is&#40;&#40;$mock_schema-&gt;call_args&#40;2&#41;&#41;[1], 56, &#39;checking that id&#40;&#41; was called
second with 56&#39;&#41;;
   $mock_schema-&gt;clear&#40;&#41;;

   print &#34;# Test plan complete\n&#34;;
} # test_run&#40;&#41;

#--------------------------------------------------------------------------
# Helpers
#--------------------------------------------------------------------------

sub show_mock_calls
{
   my &#40; $var, $rMock &#41; = @ARG;
   print &#34;# Calls made on mock object &#39;$var&#39;\n&#34;;
   my $calls = 0;

   eval
   {
      while &#40;my &#40;$method, $raArgs&#41; = $rMock-&gt;next_call&#40;&#41;&#41;
      {
         ++$calls;
         print &#34;#   $method&#40;@{[join&#40;&#39;, &#39;, @$raArgs&#41;]}&#41;\n&#34;;
      };
      print &#34;#   None\n&#34; unless $calls;
   };
   if &#40; $EVAL_ERROR &#41;
   {
      print &#34;# WARNING: no calls made on mock object &#39;$var&#39;: $@\n&#34;;
   } # if
} # show_mock_calls&#40;$var, $rMock&#41;



Cheers, Brent


I am experiencing email problems. I can send, but don&#39;t receive.
It seems if IMPORTANT: is in the subject line it gets through.
Contact me on AIM bsac ft or x4845 if you need me.
**********************************************************************************
This email may contain confidential material. If you were not an intended
recipient, please notify the sender and delete all copies. We may monitor
email to and from our network.

This email was sent by a company within the FT Group.

The Financial Times Limited, registered in England and Wales number 227590.
Registered office: Number One Southwark Bridge, London SE1 9HL. VAT: GB 278
5371 21.

The Financial Times &#40;HK&#41; Limited, registered in Hong Kong number 108204.
Registered office: Unit 5905-5912, 59/F The Center, No.99 Queenâ€™s Road
Central, Hong Kong.

FT Publications Inc, incorporated in New York, number 13-2545828.
Registered Office: 1330 Avenue of the Americas, New York, NY 10019, USA.
</div></div>
    </div>
</div>
</div>
</div>
    <hr class="clear" />
  </div>
</div>




</div>
 


  <hr class="clear" />
</div>
</body>
</html>
